
<!DOCTYPE html>
<html lang="zh_CH ">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P-luminary || SpringAI-Alibaba</title>
    <meta name="author" content="Asuna">
    <meta name="description" content=" ">
    <meta name="keywords" content=" ">
    <link rel="icon" href="/https://raw.githubusercontent.com/P-luminary/images/master/data/asuna.jpg">
    <link rel="stylesheet" href="/css/antd.min.css">
    
    <link rel="stylesheet" href="/css/maiden-theme.css">
    
    <script src="/js/vue.js"></script>
    <script src="/js/antd.min.js"></script>
<meta name="generator" content="Hexo 6.1.0"></head>

<body>

    <div id="loading"
        style="height: 100vh; width: 100%; position: fixed;display: flex;z-index: 200; justify-content: space-between;">
        <div id="loadleft" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div id="loadright" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div
            style="position: fixed; height: 100vh; width: 100%;display: flex;justify-content: center;align-items: center;">
            <div id="loadcontent"
                style="width:400px;height:400px;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px#a3ddfb; text-align:center;opacity:1;transition:opacity 0.3s ease-out;">
                <div>
                    <h2>LOADING...</h2>
                    <p>åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜(æµè§ˆå™¨é»˜è®¤å¼€å¯)</p>
                    <div>
                        <img src="/dancingkitty.gif" alt="loading">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="layout">
        <transition name="into">
            <div v-show="show_page" style="display: none;">
                <div id="menu_show">
                     
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">P-luminary</span>
        </a>
        
        <a href="/">
            <span>
                <a-icon type="home" theme="filled" />
            </span>
            <span>home</span>
        </a>
        
        <a href="/tags/è¯­æ³•">
            <span>
                <a-icon type="tags" theme="filled" />
            </span>
            <span>tags</span>
        </a>
        
    </div>

    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div :class="'title'" @click="menu_show=!menu_show">
            <span style="margin-right: 10px;">
                <a-icon type="appstore" theme="filled" />
            </span>
            <span>P-luminary</span>
        </div>
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="home" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">home</div>
                </div>
            </a>
            
            <a href="/tags/è¯­æ³•">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="tags" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">tags</div>
                </div>
            </a>
            
        </div>
        <div class="curtain" v-show="menu_show"></div>
    </div>

</nav>
                </div>

                <div id="main">
                     
<link rel="stylesheet" href="/css/post-body.css">
<div class="article">
    <div>
        <h1>SpringAI-Alibaba </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <a-icon type="calendar" theme="filled" />
            </span>
            2025/7/8
        </span>

        

        

        <span class="tags">
            <span class="icon">
                <a-icon type="tags" theme="filled" />
            </span>
            
            <span class="tag">
                
                <a href="/tags/AI" style=color:#00bcd4>
                    AI
                </a>
            </span>
            
        </span>
        
    </div>

    <div class="content" v-pre>
        <h3 id="Spring-AI-Ailibabaç®€ä»‹"><a href="#Spring-AI-Ailibabaç®€ä»‹" class="headerlink" title="Spring AI Ailibabaç®€ä»‹"></a>Spring AI Ailibabaç®€ä»‹</h3><p>SpringAlAlibabaæ˜¯åŸºäºSpringAIæ„å»ºçš„æ¡†æ¶ï¼Œä¸“æ³¨äºä¸é˜¿é‡Œäº‘ç”Ÿæ€çš„æ·±åº¦é›†æˆã€‚é€‚åˆå›½å†…å¼€å‘è€…ï¼Œå°¤å…¶æ˜¯éœ€è¦å¿«é€Ÿæ¥å…¥é˜¿é‡Œäº‘AIèƒ½åŠ›çš„åœºæ™¯ã€‚</p>
<p>LangChain4jæ˜¯ LangChainé¡¹ç›®çš„Javaç§»æ¤ç‰ˆæœ¬ï¼Œä¸“æ³¨äºæ„å»ºå¤šæ¨¡æ€ã€å¤šå‚ä¸è€…çš„AIåº”ç”¨ï¼Œé€‚åˆéœ€è¦æ„å»ºå¤æ‚AIå·¥ä½œæµå’Œå¤šæ¨¡æ€åº”ç”¨çš„å¼€å‘è€…</p>
<blockquote>
<p>æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://www.processon.com/view/link/6810800f83d6ee240f5796b0">Spring AI Alibabaå®æˆ˜| ProcessOnå…è´¹åœ¨çº¿ä½œå›¾,åœ¨çº¿æµç¨‹å›¾,åœ¨çº¿æ€ç»´å¯¼å›¾</a></p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://java2ai.com/?spm=5176.29160081.0.0.2856aa5cpGp7Py">Spring AI Alibaba å®˜ç½‘_å¿«é€Ÿæ„å»º JAVA AI åº”ç”¨</a></p>
<p>é¡¹ç›®ï¼š<a target="_blank" rel="noopener" href="https://gitee.com/dongchenglin/ai-demo">ai-demo: æœ¬é¡¹ç›®å›´ç»• Spring AI Alibaba æŠ€æœ¯æ ˆæ‰“é€ å®æˆ˜è¯¾ç¨‹ã€ŠSpring AI Alibaba ä»å…¥é—¨åˆ°è¿›é˜¶å®æˆ˜ã€‹ï¼Œç”± Fox ç²¾å¿ƒå¼€å‘ã€‚è¯¾ç¨‹ä»åŸºç¡€å…¥é—¨åˆ°æ·±åº¦å®æˆ˜ï¼Œè¦†ç›– Spring AI Alibaba æ ¸å¿ƒåŸç†ã€å¤§æ¨¡å‹ï¼ˆå«æœ¬åœ°ä¸äº‘ç«¯ï¼Œå¦‚ Ollamaã€é€šä¹‰åƒé—® ï¼‰é›†æˆã€å¤šæ¨¡æ€åŠŸèƒ½ï¼ˆæ–‡ç”Ÿå›¾ã€è¯­éŸ³äº¤äº’ ï¼‰ã€RAG æ¶æ„ã€Function Callingã€MCP åè®®ç­‰å…³é”®æŠ€æœ¯ï¼Œæ›´é€šè¿‡ç”µå•†æ™º</a></p>
</blockquote>
<p>[<u>Spring AI Alibaba å®˜ç½‘_å¿«é€Ÿæ„å»º JAVA AI åº”ç”¨</u>] (<a target="_blank" rel="noopener" href="http://java2ai.com/">http://java2ai.com/</a>)</p>
<h4 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h4><ul>
<li>æ¨¡å‹(Model)</li>
<li>æç¤ºï¼ˆPromptï¼‰</li>
<li>åµŒå…¥ï¼ˆEmbeddingï¼‰</li>
<li>Token</li>
<li>ç»“æ„åŒ–è¾“å‡º(Structured Output)</li>
<li>å¾®è°ƒï¼ˆFine Tuningï¼‰</li>
<li>æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰</li>
<li>å‡½æ•°è°ƒç”¨ï¼ˆFunction Calling)</li>
<li>è¯„ä¼°äººå·¥æ™ºèƒ½çš„å›ç­”(Evaluation)</li>
</ul>
<h5 id="åŒæ­¥æ¥å£å®ç°"><a href="#åŒæ­¥æ¥å£å®ç°" class="headerlink" title="åŒæ­¥æ¥å£å®ç°"></a>åŒæ­¥æ¥å£å®ç°</h5><pre><code class="java">  @GetMapping(&quot;/chat&quot;)
    public String chat(@RequestParam String input) &#123;
        return chatClient.prompt().user(input).call().content();
    &#125;
</code></pre>
<h5 id="æµå¼å“åº”å®ç°"><a href="#æµå¼å“åº”å®ç°" class="headerlink" title="æµå¼å“åº”å®ç°"></a>æµå¼å“åº”å®ç°</h5><pre><code class="java">   @GetMapping(value = &quot;/stream&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)
    public Flux&lt;String&gt; stream(String input) &#123;
        return this.chatClient.prompt()
                .user(input)
                .stream()
                .content();
    &#125;
</code></pre>
<h4 id="ChatClient"><a href="#ChatClient" class="headerlink" title="ChatClient"></a>ChatClient</h4><p><strong>ä½œç”¨</strong>ï¼šé€šè¿‡ ChatClientï¼Œå¼€å‘è€…å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘è€Œéåº•å±‚åè°ƒï¼Œæ˜¾è‘—æå‡åŸºäº LLM çš„åº”ç”¨å¼€å‘æ•ˆç‡ã€‚<br><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¿«é€Ÿå¼€å‘ï¼šé€‚åˆéœ€è¦å¿«é€Ÿæ„å»ºç«¯åˆ°ç«¯ AI äº¤äº’çš„åº”ç”¨ï¼ˆå¦‚èŠå¤©æœºå™¨äººã€é—®ç­”ç³»ç»Ÿï¼‰ã€‚å¤æ‚æµç¨‹å°è£…ï¼šå½“éœ€è¦åè°ƒå¤šä¸ªç»„ä»¶ï¼ˆå¦‚ LLM + è®°å¿† + å·¥å…·ï¼‰æ—¶ï¼Œå‡å°‘æ ·æ¿ä»£ç ã€‚</p>
<h5 id="è¿”å›å®ä½“ç±»-entity"><a href="#è¿”å›å®ä½“ç±»-entity" class="headerlink" title="è¿”å›å®ä½“ç±»  .entity"></a>è¿”å›å®ä½“ç±»  <code>.entity</code></h5><pre><code class="java">    @GetMapping(&quot;/movies&quot;)
    public ActorFilms movies(@RequestParam(value = &quot;input&quot;) String input) throws Exception &#123;
        return this.chatClient.prompt()
                .user(input)
                .call()
                .entity(ActorFilms.class);
    &#125;

curl --location --request GET &#39;http://localhost:1000/movies&#39; \
--header &#39;User-Agent: Apifox/1.0.0 (https://apifox.com)&#39; \
--header &#39;Content-Type: application/json&#39;
</code></pre>
<h5 id="æŒ‡å®šæ¶ˆæ¯è§’è‰²-defaultSystem"><a href="#æŒ‡å®šæ¶ˆæ¯è§’è‰²-defaultSystem" class="headerlink" title="æŒ‡å®šæ¶ˆæ¯è§’è‰²  .defaultSystem"></a>æŒ‡å®šæ¶ˆæ¯è§’è‰²  <code>.defaultSystem</code></h5><pre><code class="java">    public ChatController(ChatClient.Builder builder) &#123;
        this.chatClient = builder
                .defaultSystem(&quot;ä½ æ˜¯ä¸€ä¸ªæ¼”å‘˜ï¼Œè¯·åˆ—å‡ºä½ æ‰€å‚æ¼”çš„ç”µå½±&quot;)
                .build();
    &#125;
    @GetMapping(&quot;/chat&quot;)
    public String chat(@RequestParam(value = &quot;input&quot;) String input) &#123;

        return this.chatClient.prompt()
                .user(input)
                .call()
                .content();
    &#125;


curl --location --request GET &#39;http://localhost:1000/chat&#39; \
--header &#39;User-Agent: Apifox/1.0.0 (https://apifox.com)&#39; \
--header &#39;Content-Type: application/json&#39;
</code></pre>
<pre><code class="java">package com.fox.alibabaaidemo.controller;

import org.springframework.ai.chat.client.ChatClient;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.util.Map;

@RestController
public  class AIController &#123;
      private final ChatClient chatClient;
    public AIController(ChatClient.Builder builder) &#123;
        this.chatClient =  builder
                .defaultSystem(&quot;ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„èŠå¤©æœºå™¨äººï¼Œå›ç­”é—®é¢˜æ—¶è¦ä½¿ç”¨&#123;voice&#125;çš„è¯­æ°”&quot;)
                .build();
    &#125;
      @GetMapping(&quot;/ai&quot;)
      Map&lt;String, String&gt; completion(@RequestParam(value = &quot;message&quot;, defaultValue = &quot;è¯´ä¸€ä¸ªç¬‘è¯&quot;) String message, String voice) &#123;
        return Map.of(
            &quot;completion&quot;,
            this.chatClient.prompt()
                .system(sp -&gt; sp.param(&quot;voice&quot;, voice))
                .user(message)
                .call()
                .content());
      &#125;
    &#125;

GETï¼šhttp://localhost:1000/ai
voice  æ²ˆè…¾
</code></pre>
<h3 id="å…¶ä»–é»˜è®¤è®¾ç½®"><a href="#å…¶ä»–é»˜è®¤è®¾ç½®" class="headerlink" title="å…¶ä»–é»˜è®¤è®¾ç½®"></a>å…¶ä»–é»˜è®¤è®¾ç½®</h3><p>é™¤äº† <code>defaultSystem</code> ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥åœ¨ <code>ChatClient.Builder</code> çº§åˆ«ä¸ŠæŒ‡å®šå…¶ä»–é»˜è®¤æç¤ºã€‚</p>
<ul>
<li><code>defaultOptions(ChatOptions chatOptions)</code>ï¼šä¼ å…¥ <code>ChatOptions</code> ç±»ä¸­å®šä¹‰çš„å¯ç§»æ¤é€‰é¡¹æˆ–ç‰¹å®šäºæ¨¡å‹å®ç°çš„å¦‚ <code>DashScopeChatOptions</code> é€‰é¡¹ã€‚æœ‰å…³ç‰¹å®šäºæ¨¡å‹çš„<code>ChatOptions</code>å®ç°çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… JavaDocsã€‚</li>
<li><code>defaultFunction(String name, String description, java.util.function.Function&lt;I, O&gt; function)</code>ï¼š<code>name</code> ç”¨äºåœ¨ç”¨æˆ·æ–‡æœ¬ä¸­å¼•ç”¨è¯¥å‡½æ•°ï¼Œ<code>description</code>è§£é‡Šè¯¥å‡½æ•°çš„ç”¨é€”å¹¶å¸®åŠ© AI æ¨¡å‹é€‰æ‹©æ­£ç¡®çš„å‡½æ•°ä»¥è·å¾—å‡†ç¡®çš„å“åº”ï¼Œå‚æ•° <code>function</code> æ˜¯æ¨¡å‹å°†åœ¨å¿…è¦æ—¶æ‰§è¡Œçš„ Java å‡½æ•°å®ä¾‹ã€‚</li>
<li><code>defaultFunctions(String... functionNames)</code>ï¼šåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„ java.util.Function çš„ bean åç§°ã€‚</li>
<li><code>defaultUser(String text)</code>ã€<code>defaultUser(Resource text)</code>ã€<code>defaultUser(Consumer&lt;UserSpec&gt; userSpecConsumer)</code> è¿™äº›æ–¹æ³•å…è®¸æ‚¨å®šä¹‰ç”¨æˆ·æ¶ˆæ¯è¾“å…¥ï¼Œ<code>Consumer&lt;UserSpec&gt;</code>å…è®¸æ‚¨ä½¿ç”¨ lambda æŒ‡å®šç”¨æˆ·æ¶ˆæ¯è¾“å…¥å’Œä»»ä½•é»˜è®¤å‚æ•°ã€‚</li>
<li><code>defaultAdvisors(RequestResponseAdvisor... advisor)</code>ï¼šAdvisors å…è®¸ä¿®æ”¹ç”¨äºåˆ›å»º <code>Prompt</code> çš„æ•°æ®ï¼Œ<code>QuestionAnswerAdvisor</code> å®ç°é€šè¿‡åœ¨ Prompt ä¸­é™„åŠ ä¸ç”¨æˆ·æ–‡æœ¬ç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯æ¥å®ç° <code>Retrieval Augmented Generation</code> æ¨¡å¼ã€‚</li>
<li><code>defaultAdvisors(Consumer&lt;AdvisorSpec&gt; advisorSpecConsumer)</code>ï¼šæ­¤æ–¹æ³•å…è®¸æ‚¨å®šä¹‰ä¸€ä¸ª <code>Consumer</code> å¹¶ä½¿ç”¨ <code>AdvisorSpec</code> é…ç½®å¤šä¸ª Advisorï¼ŒAdvisor å¯ä»¥ä¿®æ”¹ç”¨äºåˆ›å»º <code>Prompt</code> çš„æœ€ç»ˆæ•°æ®ï¼Œ<code>Consumer&lt;AdvisorSpec&gt;</code> å…è®¸æ‚¨æŒ‡å®š lambda æ¥æ·»åŠ  Advisor ä¾‹å¦‚ <code>QuestionAnswerAdvisor</code>ã€‚</li>
</ul>
<p>æ‚¨å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨ <code>ChatClient</code> æä¾›çš„ä¸å¸¦ <code>default</code> å‰ç¼€çš„ç›¸åº”æ–¹æ³•è¦†ç›–è¿™äº›é»˜è®¤å€¼ã€‚</p>
<ul>
<li><p><code>options(ChatOptions chatOptions)</code></p>
</li>
<li><p><code>function(String name, String description, java.util.function.Function&lt;I, O&gt; function)</code></p>
</li>
<li><p><code>functions(String... functionNames)</code></p>
</li>
<li><p><code>user(String text)</code>ã€<code>user(Resource text)</code>ã€<code>user(Consumer&lt;UserSpec&gt; userSpecConsumer)</code></p>
</li>
<li><p><code>advisors(RequestResponseAdvisor... advisor)</code></p>
</li>
<li><p><code>advisors(Consumer&lt;AdvisorSpec&gt; advisorSpecConsumer)</code></p>
</li>
</ul>
<h2 id="ã€åŸºäºå†…å­˜å­˜å‚¨ã€‘å¤šè½®å¯¹è¯è®°å¿†ç®¡ç†å¯¹è¯è®°å¿†"><a href="#ã€åŸºäºå†…å­˜å­˜å‚¨ã€‘å¤šè½®å¯¹è¯è®°å¿†ç®¡ç†å¯¹è¯è®°å¿†" class="headerlink" title="ã€åŸºäºå†…å­˜å­˜å‚¨ã€‘å¤šè½®å¯¹è¯è®°å¿†ç®¡ç†å¯¹è¯è®°å¿†"></a>ã€åŸºäºå†…å­˜å­˜å‚¨ã€‘å¤šè½®å¯¹è¯è®°å¿†ç®¡ç†<del>å¯¹è¯è®°å¿†</del></h2><h5 id="å¯¹è¯æ¨¡å‹-Chat-Model"><a href="#å¯¹è¯æ¨¡å‹-Chat-Model" class="headerlink" title="å¯¹è¯æ¨¡å‹(Chat Model)"></a>å¯¹è¯æ¨¡å‹(Chat Model)</h5><p>å¯¹è¯æ¨¡å‹ï¼ˆChat Modelï¼‰æ¥æ”¶ä¸€ç³»åˆ—æ¶ˆæ¯ï¼ˆMessageï¼‰ä½œä¸ºè¾“å…¥ï¼Œä¸æ¨¡å‹ LLM æœåŠ¡è¿›è¡Œäº¤äº’ï¼Œå¹¶æ¥æ”¶è¿”å›çš„èŠå¤©æ¶ˆæ¯ï¼ˆChat Messageï¼‰ä½œä¸ºè¾“å‡ºã€‚ç›¸æ¯”äºæ™®é€šçš„ç¨‹åºè¾“å…¥ï¼Œæ¨¡å‹çš„è¾“å…¥ä¸è¾“å‡ºæ¶ˆæ¯ï¼ˆMessageï¼‰ä¸æ­¢æ”¯æŒçº¯å­—ç¬¦æ–‡æœ¬ï¼Œè¿˜æ”¯æŒåŒ…æ‹¬è¯­éŸ³ã€å›¾ç‰‡ã€è§†é¢‘ç­‰ä½œä¸ºè¾“å…¥è¾“å‡ºã€‚åŒæ—¶ï¼Œåœ¨ Spring AI Alibaba ä¸­ï¼Œæ¶ˆæ¯ä¸­è¿˜æ”¯æŒåŒ…å«ä¸åŒçš„è§’è‰²ï¼Œå¸®åŠ©åº•å±‚æ¨¡å‹åŒºåˆ†æ¥è‡ªæ¨¡å‹ã€ç”¨æˆ·å’Œç³»ç»ŸæŒ‡ä»¤ç­‰çš„ä¸åŒæ¶ˆæ¯ã€‚</p>
<p>Spring AI Alibaba å¤ç”¨äº† Spring AI æŠ½è±¡çš„ Model APIï¼Œå¹¶ä¸é€šä¹‰ç³»åˆ—å¤§æ¨¡å‹æœåŠ¡è¿›è¡Œé€‚é…ï¼ˆå¦‚é€šä¹‰åƒé—®ã€é€šä¹‰ä¸‡ç›¸ç­‰ï¼‰ï¼Œç›®å‰æ”¯æŒçº¯æ–‡æœ¬èŠå¤©ã€æ–‡ç”Ÿå›¾ã€æ–‡ç”Ÿè¯­éŸ³ã€è¯­éŸ³è½¬æ–‡æœ¬ç­‰ã€‚ä»¥ä¸‹æ˜¯æ¡†æ¶å®šä¹‰çš„å‡ ä¸ªæ ¸å¿ƒ APIï¼š</p>
<ul>
<li>ChatModelï¼Œæ–‡æœ¬èŠå¤©äº¤äº’æ¨¡å‹ï¼Œæ”¯æŒçº¯æ–‡æœ¬æ ¼å¼ä½œä¸ºè¾“å…¥ï¼Œå¹¶å°†æ¨¡å‹çš„è¾“å‡ºä»¥æ ¼å¼åŒ–æ–‡æœ¬å½¢å¼è¿”å›ã€‚</li>
<li>ImageModelï¼Œæ¥æ”¶ç”¨æˆ·æ–‡æœ¬è¾“å…¥ï¼Œå¹¶å°†æ¨¡å‹ç”Ÿæˆçš„å›¾ç‰‡ä½œä¸ºè¾“å‡ºè¿”å›ã€‚</li>
<li>AudioModelï¼Œæ¥æ”¶ç”¨æˆ·æ–‡æœ¬è¾“å…¥ï¼Œå¹¶å°†æ¨¡å‹åˆæˆçš„è¯­éŸ³ä½œä¸ºè¾“å‡ºè¿”å›ã€‚</li>
</ul>
<p>Spring AI Alibaba æ”¯æŒä»¥ä¸Š Model æŠ½è±¡ä¸é€šä¹‰ç³»åˆ—æ¨¡å‹çš„é€‚é…ï¼Œå¹¶é€šè¿‡ <code>spring-ai-alibaba-starter</code> AutoConfiguration è‡ªåŠ¨åˆå§‹åŒ–äº†é»˜è®¤å®ä¾‹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­ç›´æ¥æ³¨å…¥ ChatModelã€ImageModel ç­‰ beanï¼Œå½“ç„¶åœ¨éœ€è¦çš„æ—¶å€™ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ Model å®ä¾‹ã€‚</p>
<h5 id="å¯¹è¯è®°å¿†ä»‹ç»"><a href="#å¯¹è¯è®°å¿†ä»‹ç»" class="headerlink" title="å¯¹è¯è®°å¿†ä»‹ç»"></a>å¯¹è¯è®°å¿†ä»‹ç»</h5><p>â€å¤§æ¨¡å‹çš„å¯¹è¯è®°å¿†â€è¿™ä¸€æ¦‚å¿µï¼Œæ ¹æ¤äºäººå·¥æ™ºèƒ½ä¸è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹å…·æœ‰æ·±åº¦å­¦ä¹ èƒ½åŠ›çš„å¤§å‹è¯­è¨€æ¨¡å‹è€Œè¨€ï¼Œå®ƒæŒ‡çš„æ˜¯æ¨¡å‹åœ¨ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’å¼å¯¹è¯è¿‡ç¨‹ä¸­ï¼Œèƒ½å¤Ÿè¿½è¸ªã€ç†è§£å¹¶åˆ©ç”¨å…ˆå‰å¯¹è¯ä¸Šä¸‹æ–‡çš„èƒ½åŠ›ã€‚ æ­¤æœºåˆ¶ä½¿å¾—å¤§æ¨¡å‹ä¸ä»…èƒ½å¤Ÿå“åº”å³æ—¶çš„è¾“å…¥è¯·æ±‚ï¼Œè¿˜èƒ½åŸºäºä¹‹å‰çš„äº¤æµå†…å®¹èƒ½å¤Ÿåœ¨å¯¹è¯ä¸­è®°ä½å…ˆå‰çš„å¯¹è¯å†…å®¹ï¼Œå¹¶æ ¹æ®è¿™äº›ä¿¡æ¯è¿›è¡Œåç»­çš„å“åº”ã€‚è¿™ç§è®°å¿†æœºåˆ¶ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿåœ¨å¯¹è¯ä¸­æŒç»­è·Ÿè¸ªå’Œç†è§£ç”¨æˆ·çš„æ„å›¾å’Œä¸Šä¸‹æ–‡ï¼Œä»è€Œå®ç°æ›´è‡ªç„¶å’Œè¿è´¯çš„å¯¹è¯ã€‚</p>
<p>æˆ‘ä»¬åœ¨è°ƒç”¨å¤§æ¨¡å‹çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè‡ªå·±ç»´æŠ¤å¤šè½®çš„å¯¹è¯è®°å¿†ï¼Œé€šå¸¸æƒ…å†µä¸‹è°ƒç”¨ä»£ç å¦‚ä¸‹</p>
<pre><code class="java">import java.util.ArrayList;

List&lt;Message&gt; messages = new ArrayList&lt;&gt;();

//ç¬¬ä¸€è½®å¯¹è¯
messages.add(new SystemMessage(&quot;ä½ æ˜¯ä¸€ä¸ªæ—…æ¸¸è§„åˆ’å¸ˆ&quot;));
messages.add(new UserMessage(&quot;æˆ‘æƒ³å»æ–°ç–†&quot;));
ChatResponse response = chatModel.call(new Prompt(messages));
String content = response.getResult().getOutput().getContent();

messages.add(new AssistantMessage(content));

        //ç¬¬äºŒè½®å¯¹è¯
messages.add(new UserMessage(&quot;èƒ½å¸®æˆ‘æ¨èä¸€äº›æ—…æ¸¸æ™¯ç‚¹å—?&quot;));
response = chatModel.call(new Prompt(messages));
content = response.getResult().getOutput().getContent();

messages.add(new AssistantMessage(content));

        //ç¬¬ä¸‰è½®å¯¹è¯
messages.add(new UserMessage(&quot;é‚£é‡Œè¿™ä¸¤å¤©çš„å¤©æ°”å¦‚ä½•?&quot;));
response = chatModel.call(new Prompt(messages));
content = response.getResult().getOutput().getContent();

System.out.printf(&quot;content: %s\n&quot;, content);
</code></pre>
<h2 id="åŸºäºmemoryçš„å¯¹è¯è®°å¿†advisorsæ˜¯å¢å¼ºå™¨"><a href="#åŸºäºmemoryçš„å¯¹è¯è®°å¿†advisorsæ˜¯å¢å¼ºå™¨" class="headerlink" title="åŸºäºmemoryçš„å¯¹è¯è®°å¿†advisorsæ˜¯å¢å¼ºå™¨"></a>åŸºäºmemoryçš„å¯¹è¯è®°å¿†<del>advisorsæ˜¯å¢å¼ºå™¨</del></h2><p>å¦‚ä½•è®©å¤§æ¨¡å‹æœ‰å¯¹è¯è®°å¿†å‘¢ï¼Ÿ<br><code>Advisor(MessageChatMemoryAdvisor)ã€Memory(InMemoryChatMemory,RedisChatMemory)</code><br>ä½¿ç”¨ChatMemoryAdvisorä¸RedisChatMemoryå­˜å‚¨å†å²å¯¹è¯ </p>
<pre><code class="yaml">ChatClient.builder(chatModel)
  .defaultAdvisors(new MessageChatMemoryAdvisor(redisChatMemory))
  .build();
</code></pre>
<p>spring-ai-alibabaæ”¯æŒåŸºäºchat memoryçš„å¯¹è¯è®°å¿†ï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦è°ƒç”¨æ˜¾ç¤ºçš„è®°å½•æ¯ä¸€è½®çš„å¯¹è¯å†å²ã€‚ä¸‹è¾¹æ˜¯ä¸€ä¸ªåŸºäºå†…å­˜å­˜å‚¨çš„å¯¹è¯è®°å¿†å®ç°:</p>
<pre><code class="java">@RestController
@RequestMapping(&quot;/chat-memory&quot;)
public class ChatMemoryController &#123;

    private final ChatClient chatClient;

    public ChatMemoryController(ChatModel chatModel) &#123;
// æ„å»ºå¯¹è¯æ¨¡å‹ åŸºäºå†…å­˜çš„æ–¹å¼InMemory...
        this.chatClient = ChatClient
                .builder(chatModel)
                .defaultSystem(&quot;ä½ æ˜¯ä¸€ä¸ªæ—…æ¸¸è§„åˆ’å¸ˆï¼Œè¯·æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚æä¾›æ—…æ¸¸è§„åˆ’å»ºè®®ã€‚&quot;)
                .defaultAdvisors(new MessageChatMemoryAdvisor(new InMemoryChatMemory()))
//                .defaultAdvisors(new MessageChatMemoryAdvisor(new RedisChatMemory(
//                        &quot;127.0.0.1&quot;,
//                        6379,
//                        null
//                )))
                .build();
    &#125;

    /**
     * è·å–å†…å­˜ä¸­çš„èŠå¤©å†…å®¹
     * æ ¹æ®æä¾›çš„promptå’ŒchatIdï¼Œä»å†…å­˜ä¸­è·å–ç›¸å…³çš„èŠå¤©å†…å®¹ï¼Œå¹¶è®¾ç½®å“åº”çš„å­—ç¬¦ç¼–ç ä¸ºUTF-8ã€‚
     *
     * @param prompt ç”¨äºè·å–èŠå¤©å†…å®¹çš„æç¤ºä¿¡æ¯
     * @param chatId èŠå¤©çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„èŠå¤©ä¼šè¯
     * @param response HTTPå“åº”å¯¹è±¡ï¼Œç”¨äºè®¾ç½®å“åº”çš„å­—ç¬¦ç¼–ç 
     * @return è¿”å›åŒ…å«èŠå¤©å†…å®¹çš„Flux&lt;String&gt;å¯¹è±¡
     */
    @GetMapping(&quot;/in-memory&quot;)
    public Flux&lt;String&gt; memory(
            @RequestParam(&quot;prompt&quot;) String prompt,
            @RequestParam(&quot;chatId&quot;) String chatId,
            HttpServletResponse response
    ) &#123;

        response.setCharacterEncoding(&quot;UTF-8&quot;);
        return chatClient.prompt(prompt).advisors(
                a -&gt; a
                        .param(CHAT_MEMORY_CONVERSATION_ID_KEY, chatId)
                        .param(CHAT_MEMORY_RETRIEVE_SIZE_KEY, 100)
        ).stream().content();
    &#125;

GETï¼šhttp://localhost:1000/chat-memory/in-memory
prompt  æˆ‘æƒ³å»æ–°ç–†ç©
chatId  Pluminary
</code></pre>
<blockquote>
<h1 id="Oneã€æˆ‘æƒ³å»æ–°ç–†ç©ã€‘"><a href="#Oneã€æˆ‘æƒ³å»æ–°ç–†ç©ã€‘" class="headerlink" title="Oneã€æˆ‘æƒ³å»æ–°ç–†ç©ã€‘"></a>Oneã€æˆ‘æƒ³å»æ–°ç–†ç©ã€‘</h1><p>å¤ªæ£’äº†ï¼æ–°ç–†æ˜¯ä¸­å›½æœ€ç¾ä¸½ã€æœ€å¤šå…ƒåŒ–çš„æ—…æ¸¸ç›®çš„åœ°ä¹‹ä¸€ï¼Œæ‹¥æœ‰å£®ä¸½çš„è‡ªç„¶é£å…‰ã€ä¸°å¯Œçš„æ°‘æ—æ–‡åŒ–å’Œæ‚ ä¹…çš„å†å²é—è¿¹ã€‚æ ¹æ®ä½ çš„å…´è¶£å’Œæ—¶é—´å®‰æ’ï¼Œæˆ‘å¯ä»¥ä¸ºä½ é‡èº«å®šåˆ¶ä¸€ä»½è¯¦ç»†çš„æ—…è¡Œè®¡åˆ’ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä»½ <strong>7å¤©ç»å…¸æ–°ç–†æ—…æ¸¸è·¯çº¿æ¨è</strong>ï¼Œé€‚åˆç¬¬ä¸€æ¬¡æ¥æ–°ç–†çš„æ¸¸å®¢ï¼š</p>
<hr>
<h3 id="ğŸŒ„-7å¤©ç»å…¸æ–°ç–†æ—…æ¸¸çº¿è·¯ï¼ˆåŒ—ç–†çº¿ï¼‰"><a href="#ğŸŒ„-7å¤©ç»å…¸æ–°ç–†æ—…æ¸¸çº¿è·¯ï¼ˆåŒ—ç–†çº¿ï¼‰" class="headerlink" title="ğŸŒ„ 7å¤©ç»å…¸æ–°ç–†æ—…æ¸¸çº¿è·¯ï¼ˆåŒ—ç–†çº¿ï¼‰"></a>ğŸŒ„ 7å¤©ç»å…¸æ–°ç–†æ—…æ¸¸çº¿è·¯ï¼ˆåŒ—ç–†çº¿ï¼‰</h3><h4 id="âœ…-è·¯çº¿æ¦‚è§ˆï¼š"><a href="#âœ…-è·¯çº¿æ¦‚è§ˆï¼š" class="headerlink" title="âœ… è·¯çº¿æ¦‚è§ˆï¼š"></a>âœ… è·¯çº¿æ¦‚è§ˆï¼š</h4><p>ä¹Œé²æœ¨é½ â†’ å¤©æ±  â†’ ä¹Œé²æœ¨é½ â†’ å¥å±¯ â†’ èµ›é‡Œæœ¨æ¹– â†’ æœå­æ²Ÿ â†’ ä¼Šå® â†’ é‚£æ‹‰æè‰åŸ â†’ å·´éŸ³å¸ƒé²å…‹ â†’ ç‹¬åº“å…¬è·¯ â†’ ä¹Œé²æœ¨é½</p>
<hr>
<h3 id="ğŸ“…-è¡Œç¨‹è¯¦æƒ…ï¼š"><a href="#ğŸ“…-è¡Œç¨‹è¯¦æƒ…ï¼š" class="headerlink" title="ğŸ“… è¡Œç¨‹è¯¦æƒ…ï¼š"></a>ğŸ“… è¡Œç¨‹è¯¦æƒ…ï¼š</h3><h4 id="ç¬¬1å¤©ï¼šæŠµè¾¾ä¹Œé²æœ¨é½"><a href="#ç¬¬1å¤©ï¼šæŠµè¾¾ä¹Œé²æœ¨é½" class="headerlink" title="ç¬¬1å¤©ï¼šæŠµè¾¾ä¹Œé²æœ¨é½"></a>ç¬¬1å¤©ï¼šæŠµè¾¾ä¹Œé²æœ¨é½</h4><ul>
<li>æŠµè¾¾ä¹Œé²æœ¨é½åœ°çªå ¡å›½é™…æœºåœºæˆ–ç«è½¦ç«™ã€‚</li>
<li>æ¸¸è§ˆã€å›½é™…å¤§å·´æ‰ã€‘ï¼Œè´­ä¹°å½“åœ°ç‰¹äº§ä¸æ‰‹å·¥è‰ºå“ã€‚</li>
<li>æ™šä¸Šå¯å“å°æ–°ç–†ç‰¹è‰²ç¾é£Ÿï¼šå¤§ç›˜é¸¡ã€çƒ¤åŒ…å­ã€ç¾Šè‚‰ä¸²ç­‰ã€‚</li>
</ul>
<h4 id="ç¬¬2å¤©ï¼šä¹Œé²æœ¨é½-â†’-å¤©å±±å¤©æ± -â†’-è¿”å›ä¹Œé²æœ¨é½"><a href="#ç¬¬2å¤©ï¼šä¹Œé²æœ¨é½-â†’-å¤©å±±å¤©æ± -â†’-è¿”å›ä¹Œé²æœ¨é½" class="headerlink" title="ç¬¬2å¤©ï¼šä¹Œé²æœ¨é½ â†’ å¤©å±±å¤©æ±  â†’ è¿”å›ä¹Œé²æœ¨é½"></a>ç¬¬2å¤©ï¼šä¹Œé²æœ¨é½ â†’ å¤©å±±å¤©æ±  â†’ è¿”å›ä¹Œé²æœ¨é½</h4><ul>
<li>ä¸Šåˆé©±è½¦å‰å¾€ã€å¤©å±±å¤©æ± ã€‘ï¼Œæ¬£èµé›ªå±±ã€æ¹–æ³Šã€æ¾æ—äº¤ç›¸è¾‰æ˜ çš„ç¾æ™¯ã€‚</li>
<li>ä¸‹åˆè¿”å›å¸‚åŒºï¼Œå‚è§‚ã€æ–°ç–†åšç‰©é¦†ã€‘äº†è§£è¥¿åŸŸå†å²æ–‡åŒ–ã€‚</li>
<li>å¯å°è¯•ç»´å¾å°”æ—é£å‘³æ™šé¤ã€‚</li>
</ul>
<h4 id="ç¬¬3å¤©ï¼šä¹Œé²æœ¨é½-â†’-å¥å±¯-â†’-èµ›é‡Œæœ¨æ¹–"><a href="#ç¬¬3å¤©ï¼šä¹Œé²æœ¨é½-â†’-å¥å±¯-â†’-èµ›é‡Œæœ¨æ¹–" class="headerlink" title="ç¬¬3å¤©ï¼šä¹Œé²æœ¨é½ â†’ å¥å±¯ â†’ èµ›é‡Œæœ¨æ¹–"></a>ç¬¬3å¤©ï¼šä¹Œé²æœ¨é½ â†’ å¥å±¯ â†’ èµ›é‡Œæœ¨æ¹–</h4><ul>
<li>ä¹˜è½¦çº¦6å°æ—¶åˆ°è¾¾ã€èµ›é‡Œæœ¨æ¹–ã€‘ï¼Œè¢«èª‰ä¸ºâ€œå¤§è¥¿æ´‹æœ€åä¸€æ»´çœ¼æ³ªâ€ã€‚</li>
<li>ç¯æ¹–æ¸¸è§ˆï¼Œæ‹æ‘„æ¹–å…‰å±±è‰²ï¼Œå…¥ä½æ¹–è¾¹æ°‘å®¿æˆ–é™„è¿‘é…’åº—ã€‚</li>
</ul>
<h4 id="ç¬¬4å¤©ï¼šèµ›é‡Œæœ¨æ¹–-â†’-ä¼Šå®"><a href="#ç¬¬4å¤©ï¼šèµ›é‡Œæœ¨æ¹–-â†’-ä¼Šå®" class="headerlink" title="ç¬¬4å¤©ï¼šèµ›é‡Œæœ¨æ¹– â†’ ä¼Šå®"></a>ç¬¬4å¤©ï¼šèµ›é‡Œæœ¨æ¹– â†’ ä¼Šå®</h4><ul>
<li>æ²¿æœå­æ²Ÿå³¡è°·å‰è¡Œï¼Œç©¿è¶Šã€æœå­æ²Ÿå¤§æ¡¥ã€‘ï¼Œé£æ™¯ç»ä½³ã€‚</li>
<li>åˆ°è¾¾ä¼Šå®å¸‚åï¼Œæ¸¸è§ˆã€å–€èµå…¶æ°‘ä¿—åŒºã€‘ï¼Œæ„Ÿå—æµ“éƒçš„ç»´å¾å°”æ—é£æƒ…ã€‚</li>
<li>ä½ä¼Šå®ã€‚</li>
</ul>
<h4 id="ç¬¬5å¤©ï¼šä¼Šå®-â†’-é‚£æ‹‰æè‰åŸ"><a href="#ç¬¬5å¤©ï¼šä¼Šå®-â†’-é‚£æ‹‰æè‰åŸ" class="headerlink" title="ç¬¬5å¤©ï¼šä¼Šå® â†’ é‚£æ‹‰æè‰åŸ"></a>ç¬¬5å¤©ï¼šä¼Šå® â†’ é‚£æ‹‰æè‰åŸ</h4><ul>
<li>ä¹˜è½¦çº¦3å°æ—¶åˆ°è¾¾ã€é‚£æ‹‰æè‰åŸã€‘ï¼Œæ˜¯æ–°ç–†æœ€ç¾çš„é«˜å±±è‰ç”¸ä¹‹ä¸€ã€‚</li>
<li>éª‘é©¬ã€å¾’æ­¥ã€æ‘„å½±ï¼Œä½“éªŒè‰åŸç‰§æ°‘ç”Ÿæ´»ã€‚</li>
<li>ä½é‚£æ‹‰æé•‡ã€‚</li>
</ul>
<h4 id="ç¬¬6å¤©ï¼šé‚£æ‹‰æ-â†’-å·´éŸ³å¸ƒé²å…‹-â†’-ç‹¬åº“å…¬è·¯-â†’-ä¹Œé²æœ¨é½"><a href="#ç¬¬6å¤©ï¼šé‚£æ‹‰æ-â†’-å·´éŸ³å¸ƒé²å…‹-â†’-ç‹¬åº“å…¬è·¯-â†’-ä¹Œé²æœ¨é½" class="headerlink" title="ç¬¬6å¤©ï¼šé‚£æ‹‰æ â†’ å·´éŸ³å¸ƒé²å…‹ â†’ ç‹¬åº“å…¬è·¯ â†’ ä¹Œé²æœ¨é½"></a>ç¬¬6å¤©ï¼šé‚£æ‹‰æ â†’ å·´éŸ³å¸ƒé²å…‹ â†’ ç‹¬åº“å…¬è·¯ â†’ ä¹Œé²æœ¨é½</h4><ul>
<li>é©±è½¦å‰å¾€ã€å·´éŸ³å¸ƒé²å…‹è‰åŸã€‘ï¼Œæ¢è®¿è‘—åçš„â€œä¹æ›²åå…«å¼¯â€å¼€éƒ½æ²³ã€‚</li>
<li>æ²¿ã€ç‹¬åº“å…¬è·¯ã€‘åŒ—æ®µè¿”å›ä¹Œé²æœ¨é½ï¼Œé€”ä¸­ç©¿è¶Šå¤©å±±å±±è„‰ï¼Œé£æ™¯éœ‡æ’¼ã€‚</li>
<li>å…¨å¤©è¡Œè½¦æ—¶é—´è¾ƒé•¿ï¼ˆçº¦8-10å°æ—¶ï¼‰ï¼Œå»ºè®®æå‰å‡†å¤‡å¹²ç²®å’Œæ°´ã€‚</li>
</ul>
<h4 id="ç¬¬7å¤©ï¼šä¹Œé²æœ¨é½-â†’-è¿”ç¨‹"><a href="#ç¬¬7å¤©ï¼šä¹Œé²æœ¨é½-â†’-è¿”ç¨‹" class="headerlink" title="ç¬¬7å¤©ï¼šä¹Œé²æœ¨é½ â†’ è¿”ç¨‹"></a>ç¬¬7å¤©ï¼šä¹Œé²æœ¨é½ â†’ è¿”ç¨‹</h4><ul>
<li>æ ¹æ®èˆªç­&#x2F;ç«è½¦æ—¶é—´å®‰æ’è¿”ç¨‹ã€‚</li>
<li>å¯åœ¨å¸‚åŒºå†æ¬¡è´­ç‰©æˆ–è¡¥æ‹æœªå°½å…´çš„æ™¯ç‚¹ã€‚</li>
</ul>
<hr>
<h3 id="ğŸ’¡-å°è´´å£«ï¼š"><a href="#ğŸ’¡-å°è´´å£«ï¼š" class="headerlink" title="ğŸ’¡ å°è´´å£«ï¼š"></a>ğŸ’¡ å°è´´å£«ï¼š</h3><ul>
<li><strong>æœ€ä½³æ—…æ¸¸å­£èŠ‚</strong>ï¼šæ¯å¹´6æœˆ-10æœˆæ˜¯æ–°ç–†çš„æœ€ä½³æ—…æ¸¸å­£èŠ‚ï¼Œæ°”å€™å®œäººï¼Œé£æ™¯æœ€ç¾ã€‚</li>
<li><strong>äº¤é€šæ–¹å¼</strong>ï¼š<ul>
<li>è‡ªé©¾æ¸¸æ˜¯æ¢ç´¢æ–°ç–†æœ€å¥½çš„æ–¹å¼ï¼Œè·¯å†µè¾ƒå¥½ã€‚</li>
<li>è‹¥ä¸è‡ªé©¾ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©åŒ…è½¦æˆ–å‚åŠ å½“åœ°å“è´¨å›¢ã€‚</li>
</ul>
</li>
<li><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š<ul>
<li>æ–°ç–†æ˜¼å¤œæ¸©å·®å¤§ï¼Œæ³¨æ„å¸¦å¥½ä¿æš–è¡£ç‰©ã€‚</li>
<li>æ³¨æ„é˜²æ™’ï¼Œç´«å¤–çº¿è¾ƒå¼ºã€‚</li>
<li>å°Šé‡å°‘æ•°æ°‘æ—é£ä¿—ä¹ æƒ¯ï¼Œé¿å…æ•æ„Ÿè¯é¢˜ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h3 id="ğŸ½ï¸-å¿…åƒç¾é£Ÿæ¨èï¼š"><a href="#ğŸ½ï¸-å¿…åƒç¾é£Ÿæ¨èï¼š" class="headerlink" title="ğŸ½ï¸ å¿…åƒç¾é£Ÿæ¨èï¼š"></a>ğŸ½ï¸ å¿…åƒç¾é£Ÿæ¨èï¼š</h3><ul>
<li>çƒ¤åŒ…å­</li>
<li>æ‰‹æŠ“é¥­</li>
<li>ç¾Šè‚‰ä¸²</li>
<li>ç›˜å‰å°”å¡”æ ¼éº»é¥¼</li>
<li>ç‰›éª¨å¤´æ±¤</li>
<li>æ–°ç–†é…¸å¥¶+é¦•</li>
</ul>
<hr>
<p>å¦‚æœä½ æœ‰æ›´é•¿çš„æ—¶é—´ï¼Œè¿˜å¯ä»¥è€ƒè™‘å»¶ä¼¸åˆ°å—ç–†ï¼ˆå–€ä»€ã€å¡”å…‹æ‹‰ç›å¹²æ²™æ¼ ã€å¸•ç±³å°”é«˜åŸï¼‰æˆ–è€…åŒ—ç–†æ·±åº¦æ¸¸ï¼ˆå¯å¯æ‰˜æµ·ã€å–€çº³æ–¯ã€ç¦¾æœ¨ï¼‰ã€‚</p>
<p>ä½ å¯ä»¥å‘Šè¯‰æˆ‘ï¼š</p>
<ul>
<li>å‡ºè¡Œæ—¶é—´</li>
<li>åŒè¡Œäººæ•°</li>
<li>æ˜¯å¦è‡ªé©¾</li>
<li>æ˜¯å¦å¸Œæœ›åŠ å…¥äººæ–‡å†å²æˆ–æ‘„å½±å…ƒç´ </li>
</ul>
<p>æˆ‘å¯ä»¥ä¸ºä½ å®šåˆ¶æ›´è¯¦ç»†çš„è¡Œç¨‹ã€ä½å®¿æ¨èå’Œé¢„ç®—æ–¹æ¡ˆå“¦ï¼</p>
<h1 id="Tow-promptï¼šæœ‰å“ªäº›å¥½ç©çš„åœ°æ–¹ï¼Ÿ"><a href="#Tow-promptï¼šæœ‰å“ªäº›å¥½ç©çš„åœ°æ–¹ï¼Ÿ" class="headerlink" title="Tow [promptï¼šæœ‰å“ªäº›å¥½ç©çš„åœ°æ–¹ï¼Ÿ]"></a>Tow [promptï¼šæœ‰å“ªäº›å¥½ç©çš„åœ°æ–¹ï¼Ÿ]</h1><p>å½“ç„¶å¯ä»¥ï¼ä½œä¸ºä¸€ä¸ªæ—…æ¸¸è§„åˆ’å¸ˆï¼Œæˆ‘ä¼šæ ¹æ®ä¸åŒçš„æ—…è¡Œå…´è¶£ã€æ—¶é—´å’Œé¢„ç®—ï¼Œä¸ºä½ æ¨èæ–°ç–†æœ€å€¼å¾—ä¸€å»çš„<strong>å¥½ç©åœ°æ–¹</strong>ã€‚æ–°ç–†åœ°å¤§æ™¯ç¾ï¼Œç©æ³•å¤šæ ·ï¼Œæ—¢æœ‰è‡ªç„¶é£å…‰ï¼Œä¹Ÿæœ‰æµ“éƒçš„æ°‘æ—é£æƒ…å’Œå†å²äººæ–‡ã€‚</p>
<hr>
<h2 id="ğŸŒ„-æ–°ç–†åå¤§å¿…ç©æ™¯ç‚¹æ¨èï¼ˆæŒ‰ç±»å‹åˆ†ç±»ï¼‰"><a href="#ğŸŒ„-æ–°ç–†åå¤§å¿…ç©æ™¯ç‚¹æ¨èï¼ˆæŒ‰ç±»å‹åˆ†ç±»ï¼‰" class="headerlink" title="ğŸŒ„ æ–°ç–†åå¤§å¿…ç©æ™¯ç‚¹æ¨èï¼ˆæŒ‰ç±»å‹åˆ†ç±»ï¼‰"></a>ğŸŒ„ æ–°ç–†åå¤§å¿…ç©æ™¯ç‚¹æ¨èï¼ˆæŒ‰ç±»å‹åˆ†ç±»ï¼‰</h2><h3 id="ä¸€ã€è‡ªç„¶é£å…‰ç±»"><a href="#ä¸€ã€è‡ªç„¶é£å…‰ç±»" class="headerlink" title="ä¸€ã€è‡ªç„¶é£å…‰ç±»"></a>ä¸€ã€è‡ªç„¶é£å…‰ç±»</h3><h4 id="1-å–€çº³æ–¯æ¹–æ™¯åŒº"><a href="#1-å–€çº³æ–¯æ¹–æ™¯åŒº" class="headerlink" title="1. å–€çº³æ–¯æ¹–æ™¯åŒº"></a>1. <strong>å–€çº³æ–¯æ¹–æ™¯åŒº</strong></h4><ul>
<li><strong>å…³é”®è¯</strong>ï¼šç¥ç§˜æ¹–æ€ªã€å˜è‰²æ¹–ã€å›¾ç“¦äººæ‘è½</li>
<li><strong>æ¨èç†ç”±</strong>ï¼šè¢«èª‰ä¸ºâ€œäººé—´ä»™å¢ƒâ€ï¼Œå››å­£çš†ç¾ï¼Œç§‹å­£å°¤èƒœã€‚</li>
<li><strong>é€‚åˆäººç¾¤</strong>ï¼šæ‘„å½±çˆ±å¥½è€…ã€è‡ªç„¶æ¢é™©è€…</li>
</ul>
<h4 id="2-èµ›é‡Œæœ¨æ¹–"><a href="#2-èµ›é‡Œæœ¨æ¹–" class="headerlink" title="2. èµ›é‡Œæœ¨æ¹–"></a>2. <strong>èµ›é‡Œæœ¨æ¹–</strong></h4><ul>
<li><strong>å…³é”®è¯</strong>ï¼šå¤§è¥¿æ´‹æœ€åä¸€æ»´çœ¼æ³ªã€èŠ±æµ·ã€æ¹–å…‰å±±è‰²</li>
<li><strong>æ¨èç†ç”±</strong>ï¼šå¤å­£æ²¹èœèŠ±ç››å¼€ï¼Œæ¹–æ°´æ¸…æ¾ˆè§åº•ï¼Œæ˜¯åŒ—ç–†æœ€ç¾æ¹–æ³Šä¹‹ä¸€ã€‚</li>
</ul>
<h4 id="3-é‚£æ‹‰æè‰åŸ"><a href="#3-é‚£æ‹‰æè‰åŸ" class="headerlink" title="3. é‚£æ‹‰æè‰åŸ"></a>3. <strong>é‚£æ‹‰æè‰åŸ</strong></h4><ul>
<li><strong>å…³é”®è¯</strong>ï¼šç©ºä¸­è‰åŸã€éª‘é©¬ã€ç‰§æ°‘é£æƒ…</li>
<li><strong>æ¨èç†ç”±</strong>ï¼šå¤å­£è‰åŸå¦‚ç”»ï¼Œé€‚åˆå¾’æ­¥ã€éª‘é©¬ã€æ‹ç…§ã€‚</li>
</ul>
<h4 id="4-å·´éŸ³å¸ƒé²å…‹è‰åŸ-amp-ä¹æ›²åå…«å¼¯"><a href="#4-å·´éŸ³å¸ƒé²å…‹è‰åŸ-amp-ä¹æ›²åå…«å¼¯" class="headerlink" title="4. å·´éŸ³å¸ƒé²å…‹è‰åŸ &amp; ä¹æ›²åå…«å¼¯"></a>4. <strong>å·´éŸ³å¸ƒé²å…‹è‰åŸ &amp; ä¹æ›²åå…«å¼¯</strong></h4><ul>
<li><strong>å…³é”®è¯</strong>ï¼šå¤©é¹…æ•…ä¹¡ã€å¼€éƒ½æ²³ä¹æ›²ã€æ—¥è½ç»ç¾</li>
<li><strong>æ¨èç†ç”±</strong>ï¼šä¸­å›½ç¬¬äºŒå¤§è‰åŸï¼Œç”µå½±ã€Šé£é©°äººç”Ÿã€‹å–æ™¯åœ°ã€‚</li>
</ul>
<h4 id="5-ç‹¬åº“å…¬è·¯"><a href="#5-ç‹¬åº“å…¬è·¯" class="headerlink" title="5. ç‹¬åº“å…¬è·¯"></a>5. <strong>ç‹¬åº“å…¬è·¯</strong></h4><ul>
<li><strong>å…³é”®è¯</strong>ï¼šå¤©å±±ä¹‹è·¯ã€ä¸€æ—¥å››å­£ã€è‡ªé©¾å¤©å ‚</li>
<li><strong>æ¨èç†ç”±</strong>ï¼šè¢«èª‰ä¸ºâ€œä¸­å›½æœ€ç¾æ™¯è§‚å¤§é“â€ï¼Œè¿æ¥å—åŒ—ç–†ã€‚</li>
</ul>
<hr>
<h3 id="äºŒã€å†å²æ–‡åŒ–ç±»"><a href="#äºŒã€å†å²æ–‡åŒ–ç±»" class="headerlink" title="äºŒã€å†å²æ–‡åŒ–ç±»"></a>äºŒã€å†å²æ–‡åŒ–ç±»</h3><h4 id="6-äº¤æ²³æ•…åŸ-amp-é«˜æ˜Œæ•…åŸ"><a href="#6-äº¤æ²³æ•…åŸ-amp-é«˜æ˜Œæ•…åŸ" class="headerlink" title="6. äº¤æ²³æ•…åŸ &amp; é«˜æ˜Œæ•…åŸ"></a>6. <strong>äº¤æ²³æ•…åŸ &amp; é«˜æ˜Œæ•…åŸ</strong></h4><ul>
<li><strong>å…³é”®è¯</strong>ï¼šä¸ç»¸ä¹‹è·¯é—è¿¹ã€åƒå¹´å¤åŸ</li>
<li><strong>æ¨èç†ç”±</strong>ï¼šæ„Ÿå—å¤ä»£è¥¿åŸŸæ–‡æ˜çš„è¾‰ç…Œä¸æ²§æ¡‘ã€‚</li>
</ul>
<h4 id="7-å…‹å­œå°”åƒä½›æ´"><a href="#7-å…‹å­œå°”åƒä½›æ´" class="headerlink" title="7. å…‹å­œå°”åƒä½›æ´"></a>7. <strong>å…‹å­œå°”åƒä½›æ´</strong></h4><ul>
<li><strong>å…³é”®è¯</strong>ï¼šä½›æ•™è‰ºæœ¯ç‘°å®ã€å£ç”»ã€çŸ³çªŸç¾¤</li>
<li><strong>æ¨èç†ç”±</strong>ï¼šæ¯”æ•¦ç…Œè«é«˜çªŸæ›´æ—©å¼€å‡¿ï¼Œè‰ºæœ¯ä»·å€¼æé«˜ã€‚</li>
</ul>
<h4 id="8-é¦™å¦ƒå¢“ï¼ˆé˜¿å¸•å…‹éœåŠ å¢“ï¼‰"><a href="#8-é¦™å¦ƒå¢“ï¼ˆé˜¿å¸•å…‹éœåŠ å¢“ï¼‰" class="headerlink" title="8. é¦™å¦ƒå¢“ï¼ˆé˜¿å¸•å…‹éœåŠ å¢“ï¼‰"></a>8. <strong>é¦™å¦ƒå¢“ï¼ˆé˜¿å¸•å…‹éœåŠ å¢“ï¼‰</strong></h4><ul>
<li><strong>å…³é”®è¯</strong>ï¼šçˆ±æƒ…ä¼ è¯´ã€ä¼Šæ–¯å…°å»ºç­‘</li>
<li><strong>æ¨èç†ç”±</strong>ï¼šå–€ä»€æœ€å…·ä»£è¡¨æ€§çš„å¤è¿¹ä¹‹ä¸€ã€‚</li>
</ul>
<hr>
<h3 id="ä¸‰ã€æ°‘ä¿—é£æƒ…ç±»"><a href="#ä¸‰ã€æ°‘ä¿—é£æƒ…ç±»" class="headerlink" title="ä¸‰ã€æ°‘ä¿—é£æƒ…ç±»"></a>ä¸‰ã€æ°‘ä¿—é£æƒ…ç±»</h3><h4 id="9-å–€ä»€è€åŸï¼ˆè‰¾æå°•å°”æ¸…çœŸå¯ºï¼‰"><a href="#9-å–€ä»€è€åŸï¼ˆè‰¾æå°•å°”æ¸…çœŸå¯ºï¼‰" class="headerlink" title="9. å–€ä»€è€åŸï¼ˆè‰¾æå°•å°”æ¸…çœŸå¯ºï¼‰"></a>9. <strong>å–€ä»€è€åŸï¼ˆè‰¾æå°•å°”æ¸…çœŸå¯ºï¼‰</strong></h4><ul>
<li><strong>å…³é”®è¯</strong>ï¼šç»´å¾å°”æ—é£æƒ…ã€å¤œå¸‚ã€æ‰‹å·¥è‰º</li>
<li><strong>æ¨èç†ç”±</strong>ï¼šå—ç–†æ–‡åŒ–ä¸­å¿ƒï¼Œå……æ»¡å¼‚åŸŸé£æƒ…ã€‚</li>
</ul>
<h4 id="10-å¡”å…‹æ‹‰ç›å¹²æ²™æ¼ -x2F-å¡”ä¸­æ²™æ¼ å…¬è·¯"><a href="#10-å¡”å…‹æ‹‰ç›å¹²æ²™æ¼ -x2F-å¡”ä¸­æ²™æ¼ å…¬è·¯" class="headerlink" title="10. å¡”å…‹æ‹‰ç›å¹²æ²™æ¼  &#x2F; å¡”ä¸­æ²™æ¼ å…¬è·¯"></a>10. <strong>å¡”å…‹æ‹‰ç›å¹²æ²™æ¼  &#x2F; å¡”ä¸­æ²™æ¼ å…¬è·¯</strong></h4><ul>
<li><strong>å…³é”®è¯</strong>ï¼šæ­»äº¡ä¹‹æµ·ã€æ˜Ÿç©ºéœ²è¥ã€è¶Šé‡æŒ‘æˆ˜</li>
<li><strong>æ¨èç†ç”±</strong>ï¼šä½“éªŒæé™é£å…‰ï¼Œæ„Ÿå—è’æ¼ ä¸­çš„å£®ç¾ã€‚</li>
</ul>
<hr>
<h2 id="ğŸï¸-æŒ‰çº¿è·¯æ¨èçƒ­é—¨ç©æ³•"><a href="#ğŸï¸-æŒ‰çº¿è·¯æ¨èçƒ­é—¨ç©æ³•" class="headerlink" title="ğŸï¸ æŒ‰çº¿è·¯æ¨èçƒ­é—¨ç©æ³•"></a>ğŸï¸ æŒ‰çº¿è·¯æ¨èçƒ­é—¨ç©æ³•</h2><table>
<thead>
<tr>
<th>çº¿è·¯ç±»å‹</th>
<th>æ¨èæ™¯ç‚¹</th>
<th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td>åŒ—ç–†ç»å…¸çº¿</td>
<td>å¤©æ± ã€èµ›é‡Œæœ¨æ¹–ã€é‚£æ‹‰æã€å·´éŸ³å¸ƒé²å…‹ã€ç‹¬åº“å…¬è·¯</td>
<td>é£æ™¯ä¼˜ç¾ã€é€‚åˆé¦–æ¬¡æ¥æ–°ç–†</td>
</tr>
<tr>
<td>å—ç–†æ·±åº¦çº¿</td>
<td>å–€ä»€ã€å¡”å…‹æ‹‰ç›å¹²æ²™æ¼ ã€å¸•ç±³å°”é«˜åŸã€å¡”å¿ã€ç™½æ²™æ¹–</td>
<td>æ°‘ä¿—æµ“éƒã€ç¥ç§˜åŸå§‹</td>
</tr>
<tr>
<td>åŒ—ç–†æ·±åº¦çº¿</td>
<td>å–€çº³æ–¯ã€ç¦¾æœ¨ã€å¯å¯æ‰˜æµ·</td>
<td>ç§‹å­£ç»ç¾ã€æ‘„å½±åœ£åœ°</td>
</tr>
<tr>
<td>è‡ªé©¾çº¿è·¯</td>
<td>ç‹¬åº“å…¬è·¯ã€æ²™æ¼ å…¬è·¯ã€å–€çº³æ–¯ç¯çº¿</td>
<td>é£æ™¯å¤šå˜ã€è‡ªç”±çµæ´»</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ“…-æ ¹æ®æ—¶é—´é•¿çŸ­æ¨èç©æ³•"><a href="#ğŸ“…-æ ¹æ®æ—¶é—´é•¿çŸ­æ¨èç©æ³•" class="headerlink" title="ğŸ“… æ ¹æ®æ—¶é—´é•¿çŸ­æ¨èç©æ³•"></a>ğŸ“… æ ¹æ®æ—¶é—´é•¿çŸ­æ¨èç©æ³•</h2><table>
<thead>
<tr>
<th>æ—¶é—´å®‰æ’</th>
<th>æ¨èè¡Œç¨‹</th>
</tr>
</thead>
<tbody><tr>
<td>5-7å¤©</td>
<td>åŒ—ç–†ç»å…¸çº¿ï¼šä¹Œé²æœ¨é½ â†’ èµ›é‡Œæœ¨æ¹– â†’ é‚£æ‹‰æ â†’ å·´éŸ³å¸ƒé²å…‹ â†’ ç‹¬åº“å…¬è·¯ â†’ ä¹Œé²æœ¨é½</td>
</tr>
<tr>
<td>8-10å¤©</td>
<td>åŒ—ç–†+å—ç–†ç»„åˆï¼šä¹Œé²æœ¨é½ â†’ å–€çº³æ–¯ â†’ é‚£æ‹‰æ â†’ ä¼Šå® â†’ å–€ä»€ â†’ å¸•ç±³å°”é«˜åŸ</td>
</tr>
<tr>
<td>10å¤©ä»¥ä¸Š</td>
<td>å…¨ç–†æ·±åº¦æ¸¸ï¼šæ¶µç›–åŒ—ç–†ã€å—ç–†ã€ä¸œç–†ï¼Œä½“éªŒå¤šå…ƒæ–‡åŒ–ä¸æè‡´é£å…‰</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ¯-å°è´´å£«ï¼šå¦‚ä½•é€‰æ‹©é€‚åˆä½ çš„è·¯çº¿ï¼Ÿ"><a href="#ğŸ¯-å°è´´å£«ï¼šå¦‚ä½•é€‰æ‹©é€‚åˆä½ çš„è·¯çº¿ï¼Ÿ" class="headerlink" title="ğŸ¯ å°è´´å£«ï¼šå¦‚ä½•é€‰æ‹©é€‚åˆä½ çš„è·¯çº¿ï¼Ÿ"></a>ğŸ¯ å°è´´å£«ï¼šå¦‚ä½•é€‰æ‹©é€‚åˆä½ çš„è·¯çº¿ï¼Ÿ</h2><ol>
<li><strong>å–œæ¬¢è‡ªç„¶é£å…‰ï¼Ÿ</strong> â†’ å–€çº³æ–¯ã€èµ›é‡Œæœ¨æ¹–ã€é‚£æ‹‰æ</li>
<li><strong>å–œæ¬¢äººæ–‡å†å²ï¼Ÿ</strong> â†’ äº¤æ²³æ•…åŸã€å…‹å­œå°”åƒä½›æ´ã€å–€ä»€è€åŸ</li>
<li><strong>å–œæ¬¢å†’é™©åˆºæ¿€ï¼Ÿ</strong> â†’ å¡”å…‹æ‹‰ç›å¹²æ²™æ¼ ã€ç‹¬åº“å…¬è·¯è‡ªé©¾</li>
<li><strong>å–œæ¬¢æ‘„å½±ï¼Ÿ</strong> â†’ å–€çº³æ–¯ç§‹æ™¯ã€å·´éŸ³å¸ƒé²å…‹æ—¥è½ã€å¸•ç±³å°”é«˜åŸæ˜Ÿç©º</li>
<li><strong>äº²å­å‡ºæ¸¸ï¼Ÿ</strong> â†’ ä¹Œé²æœ¨é½åšç‰©é¦†ã€å¤©å±±å¤©æ± ã€é‚£æ‹‰æè‰åŸ</li>
</ol>
<hr>
<p>å¦‚æœä½ èƒ½å‘Šè¯‰æˆ‘ä»¥ä¸‹ä¿¡æ¯ï¼Œæˆ‘å¯ä»¥å¸®ä½ å®šåˆ¶ä¸“å±è¡Œç¨‹ï¼š</p>
<ul>
<li>å‡ºè¡Œæ—¶é—´ï¼ˆå‡ æœˆä»½ï¼‰</li>
<li>å‡ºè¡Œäººæ•°ï¼ˆæ˜¯å¦å¸¦è€äºº&#x2F;å°å­©ï¼‰</li>
<li>æ˜¯å¦è‡ªé©¾æˆ–åŒ…è½¦</li>
<li>åå¥½è‡ªç„¶&#x2F;äººæ–‡&#x2F;ç¾é£Ÿ&#x2F;æ‘„å½±ç­‰å“ªä¸€ç±»</li>
<li>é¢„ç®—èŒƒå›´ï¼ˆç»æµå‹&#x2F;èˆ’é€‚å‹&#x2F;è±ªåå‹ï¼‰</li>
</ul>
<p>æœŸå¾…ä½ çš„å›å¤ï¼Œæˆ‘å°†ä¸ºä½ æ‰“é€ ä¸€ä»½<strong>ä¸“å±æ–°ç–†æ—…è¡Œè®¡åˆ’</strong>ï¼âœ¨</p>
</blockquote>
<p>å½“ç„¶ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥è‡ªè¡Œå®ç°ChatMemoryåŸºäºç±»ä¼¼äºæ–‡ä»¶ã€Redisç­‰æ–¹å¼è¿›è¡Œä¸Šä¸‹æ–‡å†…å®¹çš„å­˜å‚¨å’Œè®°å½•ã€‚</p>
<h2 id="ã€åŸºäºRediså­˜å‚¨ã€‘å¤šè½®å¯¹è¯è®°å¿†ç®¡ç†å¯¹è¯è®°å¿†"><a href="#ã€åŸºäºRediså­˜å‚¨ã€‘å¤šè½®å¯¹è¯è®°å¿†ç®¡ç†å¯¹è¯è®°å¿†" class="headerlink" title="ã€åŸºäºRediså­˜å‚¨ã€‘å¤šè½®å¯¹è¯è®°å¿†ç®¡ç†å¯¹è¯è®°å¿†"></a>ã€åŸºäºRediså­˜å‚¨ã€‘å¤šè½®å¯¹è¯è®°å¿†ç®¡ç†<del>å¯¹è¯è®°å¿†</del></h2><p>è¿™é‡ŒRedisçš„å®˜æ–¹ä¾èµ–æœ‰é—®é¢˜ éœ€è¦è‡ªå·±ä¿®æ”¹å†å»ä½¿ç”¨ ä¸ç®—å¾—ä¸Šæ˜¯é‡æ„ è¦å»é‡å†™å»ºç«‹æ–°çš„<br>å¯ä»¥å°†ä¸‹é¢çš„æ‰“æˆåŒ… ä½¿ç”¨çš„æ—¶å€™åªéœ€è¦å¼•å…¥ä¾èµ–å³å¯</p>
<pre><code class="java">C:\Users\Pluminary\Desktop\HouDuan\ai-demo\my-redis-memory\src\main\java\com\fox\myredismemory\RedisChatMemory.java
package com.fox.myredismemory;

import java.util.*;
import java.util.concurrent.atomic.AtomicLong;
import java.util.stream.Collectors;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.ai.chat.messages.UserMessage;
import redis.clients.jedis.Jedis;
import redis.clients.jedis.JedisPool;
import redis.clients.jedis.JedisPoolConfig;

import org.springframework.ai.chat.memory.ChatMemory;
import org.springframework.ai.chat.messages.Message;

/**
 *
 * åŸºäºRedisçš„èŠå¤©è®°å¿†å®ç°ã€‚
 * è¯¥ç±»å®ç°äº†ChatMemoryæ¥å£ï¼Œæä¾›äº†å°†èŠå¤©æ¶ˆæ¯å­˜å‚¨åˆ°Redisä¸­çš„åŠŸèƒ½ã€‚
 *
 * @author Fox
 */
public class RedisChatMemory implements ChatMemory, AutoCloseable &#123;

    private static final Logger logger = LoggerFactory.getLogger(RedisChatMemory.class);

    private static final String DEFAULT_KEY_PREFIX = &quot;chat:&quot;;

    private static final String DEFAULT_HOST = &quot;127.0.0.1&quot;;

    private static final int DEFAULT_PORT = 6379;

    private static final String DEFAULT_PASSWORD = null;

    private final JedisPool jedisPool;


    private final ObjectMapper objectMapper;

    public RedisChatMemory() &#123;

        this(DEFAULT_HOST, DEFAULT_PORT, DEFAULT_PASSWORD);
    &#125;

    public RedisChatMemory(String host, int port, String password) &#123;

        JedisPoolConfig poolConfig = new JedisPoolConfig();

        this.jedisPool = new JedisPool(poolConfig, host, port, 2000, password);
        this.objectMapper = new ObjectMapper();
        logger.info(&quot;Connected to Redis at &#123;&#125;:&#123;&#125;&quot;, host, port);
    &#125;

    @Override
    public void add(String conversationId, List&lt;Message&gt; messages) &#123;

        String key = DEFAULT_KEY_PREFIX + conversationId;

        AtomicLong timestamp = new AtomicLong(System.currentTimeMillis());

        try (Jedis jedis = jedisPool.getResource()) &#123;
            // ä½¿ç”¨pipelineæ‰¹é‡æ“ä½œæå‡æ€§èƒ½
            var pipeline = jedis.pipelined();
            messages.forEach(message -&gt;
                    pipeline.hset(key, String.valueOf(timestamp.getAndIncrement()), message.toString())
            );
            pipeline.sync();
        &#125;

        logger.info(&quot;Added messages to conversationId: &#123;&#125;&quot;, conversationId);
    &#125;

    @Override
    public List&lt;Message&gt; get(String conversationId, int lastN) &#123;

        String key = DEFAULT_KEY_PREFIX + conversationId;

        try (Jedis jedis = jedisPool.getResource()) &#123;
            Map&lt;String, String&gt; allMessages = jedis.hgetAll(key);
            if (allMessages.isEmpty()) &#123;
                return List.of();
            &#125;

            return allMessages.entrySet().stream()
                    .sorted((e1, e2) -&gt;
                            Long.compare(Long.parseLong(e2.getKey()), Long.parseLong(e1.getKey()))
                    )
                    .limit(lastN)
                    .map(entry -&gt; new UserMessage(entry.getValue()))
                    .collect(Collectors.toList());
        &#125;


    &#125;

    @Override
    public void clear(String conversationId) &#123;

        String key = DEFAULT_KEY_PREFIX + conversationId;

        try (Jedis jedis = jedisPool.getResource()) &#123;
            jedis.del(key);
        &#125;
        logger.info(&quot;Cleared messages for conversationId: &#123;&#125;&quot;, conversationId);
    &#125;

    @Override
    public void close() &#123;
        try (Jedis jedis = jedisPool.getResource()) &#123;
            if (jedis != null) &#123;

                jedis.close();

                logger.info(&quot;Redis connection closed.&quot;);
            &#125;
            if (jedisPool != null) &#123;

                jedisPool.close();

                logger.info(&quot;Jedis pool closed.&quot;);
            &#125;
        &#125;

    &#125;

    public void clearOverLimit(String conversationId, int maxLimit, int deleteSize) &#123;
        try &#123;
            String key = DEFAULT_KEY_PREFIX + conversationId;
            try (Jedis jedis = jedisPool.getResource()) &#123;
                List&lt;String&gt; all = jedis.lrange(key, 0, -1);

                if (all.size() &gt;= maxLimit) &#123;
                    all = all.stream().skip(Math.max(0, deleteSize)).toList();
                &#125;
                this.clear(conversationId);
                for (String message : all) &#123;
                    jedis.rpush(key, message);
                &#125;
            &#125;
        &#125;
        catch (Exception e) &#123;
            logger.error(&quot;Error clearing messages from Redis chat memory&quot;, e);
            throw new RuntimeException(e);
        &#125;
    &#125;

&#125;
</code></pre>
<pre><code class="java">@RestController
@RequestMapping(&quot;/chat-memory&quot;)
public class ChatMemoryController &#123;

    private final ChatClient chatClient;

    public ChatMemoryController(ChatModel chatModel) &#123;
// æ„å»ºå¯¹è¯æ¨¡å‹ åŸºäºå†…å­˜çš„æ–¹å¼InMemory...
        this.chatClient = ChatClient
                .builder(chatModel)
                .defaultSystem(&quot;ä½ æ˜¯ä¸€ä¸ªæ—…æ¸¸è§„åˆ’å¸ˆï¼Œè¯·æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚æä¾›æ—…æ¸¸è§„åˆ’å»ºè®®ã€‚&quot;)
//                .defaultAdvisors(new MessageChatMemoryAdvisor(new InMemoryChatMemory()))
                .defaultAdvisors(new MessageChatMemoryAdvisor(new RedisChatMemory(
                        &quot;127.0.0.1&quot;,
                        6379,
                        null
                )))
                .build();
    &#125;

    
    /**
     * ä»Redisä¸­è·å–èŠå¤©å†…å®¹
     * æ ¹æ®æä¾›çš„promptå’ŒchatIdï¼Œä»Redisä¸­æ£€ç´¢èŠå¤©å†…å®¹ï¼Œå¹¶ä»¥Flux&lt;String&gt;çš„å½¢å¼è¿”å›
     *
     * @param prompt èŠå¤©å†…å®¹çš„æç¤ºæˆ–æŸ¥è¯¢å…³é”®å­—
     * @param chatId èŠå¤©çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºä»Redisä¸­æ£€ç´¢ç‰¹å®šçš„èŠå¤©å†…å®¹
     * @param response HttpServletResponseå¯¹è±¡ï¼Œç”¨äºè®¾ç½®å“åº”çš„å­—ç¬¦ç¼–ç ä¸ºUTF-8
     * @return Flux&lt;String&gt; åŒ…å«èŠå¤©å†…å®¹çš„ååº”å¼æµ
     */
    @GetMapping(&quot;/redis&quot;)
    public Flux&lt;String&gt; redis(
            @RequestParam(&quot;prompt&quot;) String prompt,
            @RequestParam(&quot;chatId&quot;) String chatId,
            HttpServletResponse response
    ) &#123;

        response.setCharacterEncoding(&quot;UTF-8&quot;);

        return chatClient.prompt(prompt)
                .advisors(
                a -&gt; a
                        .param(CHAT_MEMORY_CONVERSATION_ID_KEY, chatId)
                        .param(CHAT_MEMORY_RETRIEVE_SIZE_KEY, 10)
                )
                .stream().content();
    &#125;

GETï¼šhttp://localhost:1000/chat-memory/redis
prompt  æœ‰ä»€ä¹ˆå¥½åƒçš„ï¼Ÿ
chatId  Pluminary
</code></pre>
<p>æ‰“å¼€<code>Another Redis Desktop Manager</code>å³å¯çœ‹è§<code>Key</code>å’Œ<code>Value</code><br>è¿™é‡Œä¹Ÿæ˜¯åŸºäºä¸Šä¸‹æ–‡ ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯æˆ‘æƒ³å»ä¸‰äºš ç¬¬äºŒä¸ªé—®é¢˜æœ‰ä»€ä¹ˆå¥½åƒçš„<del>è¿™é‡Œæ˜¯åŸºäºç¬¬ä¸€ä¸ªé—®é¢˜å’Œå›ç­”å»è¾“å‡ºç»“æœ</del></p>
<pre><code class="java">Keyï¼š1752192461656
Valueï¼šUserMessage&#123;content=&#39;æˆ‘æƒ³å»ä¸‰äºš&#39;, properties=&#123;messageType=USER&#125;, messageType=USER&#125;
</code></pre>
<h3 id="ChatModelå¯¹è¯æ¨¡å‹"><a href="#ChatModelå¯¹è¯æ¨¡å‹" class="headerlink" title="ChatModelå¯¹è¯æ¨¡å‹"></a>ChatModelå¯¹è¯æ¨¡å‹</h3><p><code>ChatResponse</code>é‡Œé¢æ˜¯å¯¹è¯çš„jsonå“åº”ç±»</p>
<pre><code class="java">package com.fox.alibabaaidemo.controller;

import com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.ai.chat.model.ChatModel;
import org.springframework.ai.chat.model.ChatResponse;
import org.springframework.ai.chat.prompt.Prompt;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import reactor.core.publisher.Flux;

import java.io.IOException;

@RestController
public class ChatModelController &#123;
    private final ChatModel chatModel;

    public ChatModelController(@Qualifier(&quot;dashscopeChatModel&quot;) ChatModel chatModel) &#123;
        this.chatModel = chatModel;
    &#125;

    @RequestMapping(&quot;/chat2&quot;)
    public String chat2(String input) &#123;

        DashScopeChatOptions options = DashScopeChatOptions.builder()
                .withTemperature(0.9)
                .withMaxToken(1500)
           //     .withTopP(0.01)
                .build();

        Prompt prompt = new Prompt(input, options);
        ChatResponse response = chatModel.call(prompt);
        //ChatResponse response = chatModel.call(new Prompt(input));
        return response.getResult().getOutput().getText();
    &#125;


    @RequestMapping(&quot;/streamChat&quot;)
    public Flux&lt;String&gt; streamChat(String input, HttpServletResponse response) throws IOException &#123;
        response.setContentType(&quot;text/event-stream&quot;);
        response.setCharacterEncoding(&quot;UTF-8&quot;);
        return chatModel.stream(input);
    &#125;
&#125;

GETï¼šhttp://localhost:1000/chat2
input  æˆ‘æƒ³å»æ·±åœ³ï¼Œå¸®æˆ‘åšä¸ªè§„åˆ’
</code></pre>
<h3 id="ImageModelå®ç°æ–‡ç”Ÿå›¾"><a href="#ImageModelå®ç°æ–‡ç”Ÿå›¾" class="headerlink" title="ImageModelå®ç°æ–‡ç”Ÿå›¾"></a>ImageModelå®ç°æ–‡ç”Ÿå›¾</h3><pre><code class="java">package com.fox.alibabaaidemo.controller;

import com.alibaba.cloud.ai.dashscope.image.DashScopeImageOptions;
import org.springframework.ai.image.*;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class ImageModelController &#123;
    private final ImageModel imageModel;

    ImageModelController(@Qualifier(&quot;dashScopeImageModel&quot;) ImageModel imageModel) &#123;
        this.imageModel = imageModel;
    &#125;

    @RequestMapping(&quot;/image&quot;)
    public String image(String input) &#123;
        ImageOptions options = ImageOptionsBuilder.builder()
                .model(&quot;wanx2.1-t2i-turbo&quot;)
                .height(1024)
                .width(1024)
                .build();

        ImagePrompt imagePrompt = new ImagePrompt(input, options);
        ImageResponse response = imageModel.call(imagePrompt);
        String imageUrl = response.getResult().getOutput().getUrl();

        return &quot;redirect:&quot; + imageUrl;
    &#125;
&#125;

GETï¼šhttp://localhost:1000/image
input  æ£®æ—ä¸­çš„ç»ç¾ç²¾çµï¼Œæ‰‹é‡Œæ‹¿ç€å¼“

</code></pre>
<h3 id="AudioModelæ–‡ç”Ÿè¯­éŸ³-amp-è¯­éŸ³è½¬æ–‡æœ¬"><a href="#AudioModelæ–‡ç”Ÿè¯­éŸ³-amp-è¯­éŸ³è½¬æ–‡æœ¬" class="headerlink" title="AudioModelæ–‡ç”Ÿè¯­éŸ³&amp;è¯­éŸ³è½¬æ–‡æœ¬"></a>AudioModelæ–‡ç”Ÿè¯­éŸ³&amp;è¯­éŸ³è½¬æ–‡æœ¬</h3><h6 id="æ–‡æœ¬ç”Ÿæˆè¯­éŸ³"><a href="#æ–‡æœ¬ç”Ÿæˆè¯­éŸ³" class="headerlink" title="æ–‡æœ¬ç”Ÿæˆè¯­éŸ³"></a>æ–‡æœ¬ç”Ÿæˆè¯­éŸ³</h6><pre><code class="java">package com.fox.alibabaaidemo.controller;

import com.alibaba.cloud.ai.dashscope.audio.DashScopeAudioTranscriptionModel;
import com.alibaba.cloud.ai.dashscope.audio.DashScopeAudioTranscriptionOptions;
import com.alibaba.cloud.ai.dashscope.audio.synthesis.SpeechSynthesisModel;
import com.alibaba.cloud.ai.dashscope.audio.synthesis.SpeechSynthesisPrompt;
import com.alibaba.cloud.ai.dashscope.audio.synthesis.SpeechSynthesisResponse;
import org.springframework.ai.audio.transcription.AudioTranscriptionPrompt;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.io.IOException;
import java.net.MalformedURLException;
import java.nio.ByteBuffer;

/**
 * @author: Fox
 * @Desc:
 **/
@RestController
@RequestMapping(&quot;/audio&quot;)
public class AudioModelController &#123;

    private final SpeechSynthesisModel speechSynthesisModel;

    @Autowired
    public AudioModelController(SpeechSynthesisModel speechSynthesisModel) &#123;
        this.speechSynthesisModel = speechSynthesisModel;
    &#125;

    @GetMapping(&quot;/synthesize&quot;)
    public ResponseEntity&lt;byte[]&gt; synthesizeSpeech(@RequestParam String text) throws IOException &#123;
        // æ„å»ºè¯­éŸ³åˆæˆè¯·æ±‚
        SpeechSynthesisPrompt prompt = new SpeechSynthesisPrompt(text);

        // è°ƒç”¨æ¨¡å‹ç”Ÿæˆè¯­éŸ³
        SpeechSynthesisResponse response = speechSynthesisModel.call(prompt);
        ByteBuffer audioData = response.getResult().getOutput().getAudio();

        // å°† ByteBuffer è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„
        byte[] audioBytes = new byte[audioData.remaining()];
        audioData.get(audioBytes);

        // è¿”å›éŸ³é¢‘æµï¼ˆMP3æ ¼å¼ï¼‰
        return ResponseEntity.ok()
                .contentType(MediaType.APPLICATION_OCTET_STREAM)
                .header(&quot;Content-Disposition&quot;, &quot;attachment; filename=output.mp3&quot;)
                .body(audioBytes);
    &#125;
&#125;

GETï¼šhttp://localhost:1000/audio/synthesize
text  æˆ‘çœŸçš„å¤ªå–œæ¬¢ç‚¹èµå•¦
</code></pre>
<h5 id="è¯­éŸ³ç”Ÿæˆæ–‡æœ¬"><a href="#è¯­éŸ³ç”Ÿæˆæ–‡æœ¬" class="headerlink" title="è¯­éŸ³ç”Ÿæˆæ–‡æœ¬"></a>è¯­éŸ³ç”Ÿæˆæ–‡æœ¬</h5><pre><code class="java">package com.fox.alibabaaidemo.controller;

import com.alibaba.cloud.ai.dashscope.audio.DashScopeAudioTranscriptionModel;
import com.alibaba.cloud.ai.dashscope.audio.DashScopeAudioTranscriptionOptions;
import org.springframework.ai.audio.transcription.AudioTranscriptionPrompt;
import org.springframework.core.io.ClassPathResource;
import org.springframework.core.io.Resource;
import org.springframework.core.io.UrlResource;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import java.net.MalformedURLException;

/**
 * @author: Fox
 * @Desc:
 **/
@RestController
public class AudioModelController2 &#123;

    private static final String AUDIO_RESOURCES_URL = &quot;https://dashscope.oss-cn-beijing.aliyuncs.com/samples/audio/paraformer/hello_world_female2.wav&quot;;

    private final DashScopeAudioTranscriptionModel dashScopeAudioTranscriptionModel; //modelname:sensevoice-v1,paraformer-realtime-v2,paraformer-v2

    AudioModelController2(DashScopeAudioTranscriptionModel dashScopeAudioTranscriptionModel)&#123;
        this.dashScopeAudioTranscriptionModel = dashScopeAudioTranscriptionModel;
    &#125;

    @GetMapping(&quot;/audio&quot;)
    public String audio() throws MalformedURLException &#123;
        Resource resource =new UrlResource(AUDIO_RESOURCES_URL);

        AudioTranscriptionPrompt prompt = new AudioTranscriptionPrompt(resource,
                DashScopeAudioTranscriptionOptions.builder()
                        .withModel(&quot;sensevoice-v1&quot;)
                        .build());

        return dashScopeAudioTranscriptionModel.call(prompt).getResult().getOutput();
    &#125;
&#125;

GETï¼šhttp://localhost:1000/audio
</code></pre>
<h1 id="æç¤ºè¯-Prompt-create"><a href="#æç¤ºè¯-Prompt-create" class="headerlink" title="æç¤ºè¯ (Prompt).create"></a>æç¤ºè¯ (Prompt)<del>.create</del></h1><p>Prompt æ˜¯å¼•å¯¼ AI æ¨¡å‹ç”Ÿæˆç‰¹å®šè¾“å‡ºçš„è¾“å…¥æ ¼å¼ï¼ŒPrompt çš„è®¾è®¡å’Œæªè¾ä¼šæ˜¾è‘—å½±å“æ¨¡å‹çš„å“åº”ã€‚</p>
<p>Prompt æœ€å¼€å§‹åªæ˜¯ç®€å•çš„å­—ç¬¦ä¸²ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œprompt é€æ¸å¼€å§‹åŒ…å«ç‰¹å®šçš„å ä½ç¬¦ï¼Œä¾‹å¦‚ AI æ¨¡å‹å¯ä»¥è¯†åˆ«çš„ â€œUSER:â€ã€â€œSYSTEM:â€ ç­‰ã€‚é˜¿é‡Œäº‘é€šä¹‰æ¨¡å‹å¯é€šè¿‡å°†å¤šä¸ªæ¶ˆæ¯å­—ç¬¦ä¸²åˆ†ç±»ä¸ºä¸åŒçš„è§’è‰²ï¼Œç„¶åå†ç”± AI æ¨¡å‹å¤„ç†ï¼Œä¸º prompt å¼•å…¥äº†æ›´å¤šç»“æ„ã€‚æ¯æ¡æ¶ˆæ¯éƒ½åˆ†é…æœ‰ç‰¹å®šçš„è§’è‰²ï¼Œè¿™äº›è§’è‰²å¯¹æ¶ˆæ¯è¿›è¡Œåˆ†ç±»ï¼Œæ˜ç¡® AI æ¨¡å‹æç¤ºçš„æ¯ä¸ªéƒ¨åˆ†çš„ä¸Šä¸‹æ–‡å’Œç›®çš„ã€‚è¿™ç§ç»“æ„åŒ–æ–¹æ³•å¢å¼ºäº†ä¸ AI æ²Ÿé€šçš„ç»†å¾®å·®åˆ«å’Œæœ‰æ•ˆæ€§ï¼Œå› ä¸º prompt çš„æ¯ä¸ªéƒ¨åˆ†åœ¨äº¤äº’ä¸­éƒ½æ‰®æ¼”ç€ç‹¬ç‰¹ä¸”æ˜ç¡®çš„è§’è‰²ã€‚</p>
<p>Prompt ä¸­çš„ä¸»è¦è§’è‰²ï¼ˆRoleï¼‰åŒ…æ‹¬ï¼š</p>
<ul>
<li>ç³»ç»Ÿè§’è‰²ï¼ˆSystem Roleï¼‰ï¼šæŒ‡å¯¼ AI çš„è¡Œä¸ºå’Œå“åº”æ–¹å¼ï¼Œè®¾ç½® AI å¦‚ä½•è§£é‡Šå’Œå›å¤è¾“å…¥çš„å‚æ•°æˆ–è§„åˆ™ã€‚è¿™ç±»ä¼¼äºåœ¨å‘èµ·å¯¹è¯ä¹‹å‰å‘ AI æä¾›è¯´æ˜ã€‚</li>
<li>ç”¨æˆ·è§’è‰²ï¼ˆUser Roleï¼‰ï¼šä»£è¡¨ç”¨æˆ·çš„è¾“å…¥ - ä»–ä»¬å‘ AI æå‡ºçš„é—®é¢˜ã€å‘½ä»¤æˆ–é™ˆè¿°ã€‚è¿™ä¸ªè§’è‰²è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒæ„æˆäº† AI å“åº”çš„åŸºç¡€ã€‚</li>
<li>åŠ©æ‰‹è§’è‰²ï¼ˆAssistant Roleï¼‰ï¼šAI å¯¹ç”¨æˆ·è¾“å…¥çš„å“åº”ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç­”æ¡ˆæˆ–ååº”ï¼Œå®ƒå¯¹äºä¿æŒå¯¹è¯çš„æµç•…æ€§è‡³å…³é‡è¦ã€‚é€šè¿‡è·Ÿè¸ª AI ä¹‹å‰çš„å“åº”ï¼ˆå…¶â€œåŠ©æ‰‹è§’è‰²â€æ¶ˆæ¯ï¼‰ï¼Œç³»ç»Ÿå¯ç¡®ä¿è¿è´¯ä¸”ä¸Šä¸‹æ–‡ç›¸å…³çš„äº¤äº’ã€‚åŠ©æ‰‹æ¶ˆæ¯ä¹Ÿå¯èƒ½åŒ…å«åŠŸèƒ½å·¥å…·è°ƒç”¨è¯·æ±‚ä¿¡æ¯ã€‚å®ƒå°±åƒ AI ä¸­çš„ä¸€ä¸ªç‰¹æ®ŠåŠŸèƒ½ï¼Œåœ¨éœ€è¦æ‰§è¡Œç‰¹å®šåŠŸèƒ½ï¼ˆä¾‹å¦‚è®¡ç®—ã€è·å–æ•°æ®æˆ–ä¸ä»…ä»…æ˜¯è¯´è¯ï¼‰æ—¶ä½¿ç”¨ã€‚</li>
<li>å·¥å…·&#x2F;åŠŸèƒ½è§’è‰²ï¼ˆTool&#x2F;Function Roleï¼‰ï¼šå·¥å…·&#x2F;åŠŸèƒ½è§’è‰²ä¸“æ³¨äºå“åº”å·¥å…·è°ƒç”¨åŠ©æ‰‹æ¶ˆæ¯è¿”å›é™„åŠ ä¿¡æ¯ã€‚</li>
</ul>
<h5 id="API-æ¦‚è§ˆ"><a href="#API-æ¦‚è§ˆ" class="headerlink" title="API æ¦‚è§ˆ"></a>API æ¦‚è§ˆ</h5><h5 id="Prompt"><a href="#Prompt" class="headerlink" title="Prompt"></a>Prompt</h5><p>é€šå¸¸ä½¿ç”¨ ChatModel çš„ call() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å— Prompt å®ä¾‹å¹¶è¿”å› ChatResponseã€‚</p>
<p>Prompt ç±»å……å½“æœ‰ç»„ç»‡çš„ä¸€ç³»åˆ— Message å¯¹è±¡å’Œè¯·æ±‚ ChatOptions çš„å®¹å™¨ã€‚æ¯æ¡æ¶ˆæ¯åœ¨æç¤ºä¸­éƒ½ä½“ç°äº†ç‹¬ç‰¹çš„è§’è‰²ï¼Œå…¶å†…å®¹å’Œæ„å›¾å„ä¸ç›¸åŒã€‚è¿™äº›è§’è‰²å¯ä»¥åŒ…å«å„ç§å…ƒç´ ï¼Œä»ç”¨æˆ·æŸ¥è¯¢åˆ° AI ç”Ÿæˆçš„å“åº”å†åˆ°ç›¸å…³èƒŒæ™¯ä¿¡æ¯ã€‚è¿™ç§å®‰æ’å¯ä»¥å®ç°ä¸ AI æ¨¡å‹çš„å¤æ‚è€Œè¯¦ç»†çš„äº¤äº’ï¼Œå› ä¸ºæç¤ºæ˜¯ç”±å¤šæ¡æ¶ˆæ¯æ„æˆçš„ï¼Œæ¯æ¡æ¶ˆæ¯éƒ½è¢«åˆ†é…äº†åœ¨å¯¹è¯ä¸­æ‰®æ¼”çš„ç‰¹å®šè§’è‰²ã€‚</p>
<p>è¯¥ç±»å®ç°çš„æ¥å£æ”¯æŒæç¤ºåˆ›å»ºçš„ä¸åŒæ–¹é¢ï¼š</p>
<p><strong>PromptTemplateStringActions</strong> ä¸“æ³¨äºåˆ›å»ºå’Œå‘ˆç°æç¤ºå­—ç¬¦ä¸²ï¼Œä»£è¡¨æç¤ºç”Ÿæˆçš„æœ€åŸºæœ¬å½¢å¼ã€‚</p>
<p><strong>PromptTemplateMessageActions</strong> ä¸“é—¨ç”¨äºé€šè¿‡ç”Ÿæˆå’Œæ“ä½œ Message å¯¹è±¡æ¥åˆ›å»ºæç¤ºã€‚</p>
<p><strong>PromptTemplateActions</strong> æ—¨åœ¨è¿”å› Prompt å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥ä¼ é€’ç»™ ChatModel ä»¥ç”Ÿæˆå“åº”ã€‚</p>
<p>è™½ç„¶è¿™äº›æ¥å£å¯èƒ½åœ¨è®¸å¤šé¡¹ç›®ä¸­æ²¡æœ‰å¾—åˆ°å¹¿æ³›ä½¿ç”¨ï¼Œä½†å®ƒä»¬å±•ç¤ºäº†åˆ›å»ºæç¤ºçš„ä¸åŒæ–¹æ³•ã€‚</p>
<h6 id="å®ç°ConfigurablePromptTemplateFactory"><a href="#å®ç°ConfigurablePromptTemplateFactory" class="headerlink" title="å®ç°ConfigurablePromptTemplateFactory"></a>å®ç°ConfigurablePromptTemplateFactory</h6><pre><code class="java">C:\Users\Pluminary\Desktop\HouDuan\ai-demo\prompt-demo\src\main\java\com\fox\promptdemo\config\PromptTemplateConfig.java

package com.fox.promptdemo.config;

import com.alibaba.cloud.ai.prompt.ConfigurablePromptTemplateFactory;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class PromptTemplateConfig &#123;

    @Bean
    public ConfigurablePromptTemplateFactory configurablePromptTemplateFactory() &#123;
        // è¿™é‡Œå‡è®¾ConfigurablePromptTemplateFactoryæœ‰ä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°
        return new ConfigurablePromptTemplateFactory();
        // å¦‚æœéœ€è¦é…ç½®å‚æ•°ï¼Œå¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œé…ç½®
        // return new ConfigurablePromptTemplateFactory(param1, param2);
    &#125;
&#125;
</code></pre>
<pre><code class="java">C:\Users\Pluminary\Desktop\HouDuan\ai-demo\prompt-demo\src\main\java\com\fox\promptdemo\controller\PromptTemplateController.java
@GetMapping(&quot;/prompt-template&quot;)
    public AssistantMessage generate(
            @RequestParam(value = &quot;author&quot;, defaultValue = &quot;é²è¿…&quot;) String author
    ) &#123;

        ConfigurablePromptTemplate template = configurablePromptTemplateFactory.getTemplate(&quot;test-template&quot;);

        if (template == null) &#123;
            template = configurablePromptTemplateFactory.create(&quot;test-template&quot;,
                    &quot;è¯·åˆ—å‡º &#123;author&#125; æœ€è‘—åçš„ä¸‰æœ¬ä¹¦ã€‚&quot;);
        &#125;

        Prompt prompt;
        if (StringUtils.hasText(author)) &#123;
            prompt = template.create(Map.of(&quot;author&quot;, author));
        &#125; else &#123;
            prompt = template.create();
        &#125;

        return chatClient.prompt(prompt)
                .call()
                .chatResponse()
                .getResult()
                .getOutput();
    &#125;

GETï¼šhttp://localhost:10007/example/ai/prompt-template
author  é²è¿…
</code></pre>
<h6 id="å®ç°PromptTemplate"><a href="#å®ç°PromptTemplate" class="headerlink" title="å®ç°PromptTemplate"></a>å®ç°PromptTemplate</h6><pre><code class="java">@RestController
@RequestMapping(&quot;/example/ai&quot;)
public class PromptTemplateController &#123;

    private final ChatClient chatClient;

    private final ConfigurablePromptTemplateFactory configurablePromptTemplateFactory;
        
    // è¿™é‡Œçš„èµ„æºæ˜¯ä»¥stæ–‡ä»¶ç±»å‹æ”¾åœ¨äº†resourcesçš„promptsé‡Œé¢
    @Value(&quot;classpath:/prompts/joke-prompt.st&quot;)
    private Resource jokeResource;

    @GetMapping(&quot;/prompt&quot;)
    public AssistantMessage completion(
            @RequestParam(value = &quot;adjective&quot;, defaultValue = &quot;æœ‰è¶£&quot;) String adjective,
            @RequestParam(value = &quot;topic&quot;, defaultValue = &quot;å¥¶ç‰›&quot;) String topic
    ) &#123;

        PromptTemplate promptTemplate = new PromptTemplate(jokeResource);
        Prompt prompt = promptTemplate.create(Map.of(&quot;adjective&quot;, adjective, &quot;topic&quot;, topic));

        return chatClient.prompt(prompt)
                .call()
                .chatResponse()
                .getResult()
                .getOutput();
    &#125;
</code></pre>
<pre><code class="java">C:\Users\Pluminary\Desktop\HouDuan\ai-demo\prompt-demo\src\main\resources\prompts\joke-prompt.st
ç»™æˆ‘è®²ä¸€ä¸ªå…³äº &#123;topic&#125; çš„ &#123;adjective&#125; ç¬‘è¯

GETï¼šhttp://localhost:10007/example/ai/prompt
adjective  æœ‰è¶£çš„
topic  çŒ«
</code></pre>
<h6 id="å®ç°SystemPromptTemplate"><a href="#å®ç°SystemPromptTemplate" class="headerlink" title="å®ç°SystemPromptTemplate"></a>å®ç°SystemPromptTemplate</h6><pre><code class="java">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.fox.promptdemo.controller;

import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.messages.AssistantMessage;
import org.springframework.ai.chat.messages.Message;
import org.springframework.ai.chat.messages.UserMessage;
import org.springframework.ai.chat.prompt.Prompt;
import org.springframework.ai.chat.prompt.SystemPromptTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.core.io.Resource;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;
import java.util.Map;

@RestController
@RequestMapping(&quot;/example/ai&quot;)
public class RoleController &#123;

    private final ChatClient chatClient;

    @Value(&quot;classpath:/prompts/system-message.st&quot;)
    private Resource systemResource;

    @Autowired
    public RoleController(ChatClient.Builder builder) &#123;
        this.chatClient = builder.build();
    &#125;
// defaultValueæ˜¯æ²¡æœ‰ä¼ å…¥æ—¶å€™çš„é»˜è®¤å€¼
    @GetMapping(&quot;/roles&quot;)
    public AssistantMessage generate(
            @RequestParam(value = &quot;message&quot;,
            defaultValue = &quot;è¯·ä»‹ç»ä¸€ä¸‹æµ·ç›—é»„é‡‘æ—¶ä»£çš„ä¸‰ä½è‘—åæµ·ç›—ï¼Œä»¥åŠä»–ä»¬ä¸ºä»€ä¹ˆè¿™æ ·åšã€‚ä¸ºæ¯ä¸ªæµ·ç›—è‡³å°‘å†™ä¸€å¥è¯ã€‚&quot;) String message,
            @RequestParam(value = &quot;name&quot;, defaultValue = &quot;Fox&quot;) String name,
            @RequestParam(value = &quot;voice&quot;, defaultValue = &quot;æµ·ç›—&quot;) String voice
    ) &#123;

        UserMessage userMessage = new UserMessage(message);

        SystemPromptTemplate systemPromptTemplate = new SystemPromptTemplate(systemResource);
        // .createMessageåˆ›å»ºä¸€ä¸ªç³»ç»Ÿæ¶ˆæ¯
        Message systemMessage = systemPromptTemplate.createMessage(Map.of(&quot;name&quot;, name, &quot;voice&quot;, voice));

        return chatClient.prompt(new Prompt(List.of(userMessage, systemMessage)))
                .call()
                .chatResponse()
                .getResult()
                .getOutput();
    &#125;
&#125;

GETï¼šhttp://localhost:10007/example/ai/roles
name  Pluminary
voice  æµ·ç›—
</code></pre>
<pre><code class="java">C:\Users\Pluminary\Desktop\HouDuan\ai-demo\prompt-demo\src\main\resources\prompts\system-message.st
ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„ AI åŠ©æ‰‹ã€‚
ä½ æ˜¯å¸®åŠ©äººä»¬æŸ¥æ‰¾ä¿¡æ¯çš„ AI åŠ©æ‰‹ã€‚
ä½ çš„åå­—æ˜¯ &#123;name&#125;
ä½ åº”è¯¥ä½¿ç”¨ä½ çš„å§“åå’Œ &#123;voice&#125; çš„æ ·å¼å›å¤ç”¨æˆ·çš„è¯·æ±‚ã€‚
</code></pre>
<h3 id="é™æ€RAGå®ç°ï¼šæç¤ºè¯åŠ¨æ€æ³¨å…¥"><a href="#é™æ€RAGå®ç°ï¼šæç¤ºè¯åŠ¨æ€æ³¨å…¥" class="headerlink" title="é™æ€RAGå®ç°ï¼šæç¤ºè¯åŠ¨æ€æ³¨å…¥"></a>é™æ€RAGå®ç°ï¼šæç¤ºè¯åŠ¨æ€æ³¨å…¥</h3><p>å½“å‰å®ç°çš„æ–¹å¼ï¼š</p>
<ul>
<li>å±äº â€œæ–‡æ¡£é¢„åŠ è½½+æ¡ä»¶è§¦å‘â€ æ¨¡å¼</li>
<li>é€šè¿‡ stuffit å‚æ•°å®ç° äººå·¥æ§åˆ¶çš„ä¸Šä¸‹æ–‡å¼€å…³</li>
<li>ä¸Šä¸‹æ–‡ç›´æ¥æ¥è‡ªé¢„å®šä¹‰çš„é™æ€èµ„æºæ–‡ä»¶</li>
<li>æœ¬è´¨ä¸Šæ˜¯ä¸€ç§è½»é‡çº§çš„ é™æ€RAGï¼ˆStatic RAGï¼‰</li>
</ul>
<p>ç»å…¸RAGï¼š</p>
<ul>
<li>é‡‡ç”¨ â€œæ£€ç´¢-æ’åº-æ³¨å…¥â€ è‡ªåŠ¨åŒ–æµç¨‹</li>
<li>ä¾èµ–å‘é‡ç›¸ä¼¼åº¦è®¡ç®—åŠ¨æ€é€‰æ‹©ä¸Šä¸‹æ–‡</li>
<li>æ”¯æŒå¢é‡å­¦ä¹ å’Œå®æ—¶çŸ¥è¯†æ›´æ–°</li>
<li>å…¸å‹æµç¨‹ï¼šé—®é¢˜ç¼–ç â†’å‘é‡æ£€ç´¢â†’ç›¸å…³æ€§è¿‡æ»¤â†’ä¸Šä¸‹æ–‡æ³¨å…¥</li>
</ul>
<p>é€‚ç”¨åœºæ™¯å»ºè®®<br>å½“å‰æ–¹å¼æ›´é€‚åˆï¼š</p>
<ul>
<li>æ–‡æ¡£è§„æ¨¡å°ï¼ˆå¦‚äº§å“è¯´æ˜ä¹¦ã€FAQç­‰ï¼‰</li>
<li>éœ€è¦ä¸¥æ ¼æ§åˆ¶çš„å›ç­”èŒƒå›´</li>
<li>å¿«é€ŸåŸå‹å¼€å‘é˜¶æ®µ</li>
<li>å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯</li>
</ul>
<p>éœ€è¦å‡çº§åˆ°RAGå½“ï¼š</p>
<ul>
<li>æ–‡æ¡£è¶…è¿‡100MBæˆ–é¢‘ç¹æ›´æ–°</li>
<li>éœ€è¦åŸºäºé—®é¢˜è¯­ä¹‰è‡ªåŠ¨åŒ¹é…ä¸Šä¸‹æ–‡</li>
<li>è¦æ±‚æ”¯æŒå¤šæ–‡æ¡£æºæ··åˆæ£€ç´¢</li>
<li>éœ€è¦ç»“åˆç”¨æˆ·ç”»åƒçš„ä¸ªæ€§åŒ–å›ç­”</li>
</ul>
<pre><code class="java">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.fox.promptdemo.controller;

import com.fox.promptdemo.entity.Completion;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.prompt.PromptTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.core.io.Resource;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.util.HashMap;
import java.util.Map;

@RestController
@RequestMapping(&quot;/example/ai&quot;)
public class StuffController &#123;

    private final ChatClient chatClient;

    @Value(&quot;classpath:/docs/bailian.md&quot;)
    private Resource docsToStuffResource;

    @Value(&quot;classpath:/prompts/qa-prompt.st&quot;)
    private Resource qaPromptResource;

    @Autowired
    public StuffController(ChatClient.Builder builder) &#123;
        this.chatClient = builder.build();
    &#125;

    @GetMapping(value = &quot;/stuff&quot;)
    public Completion completion(@RequestParam(value = &quot;message&quot;, defaultValue = &quot;ç»™æˆ‘æ¨èä¸€æ¬¾ç™¾ç‚¼ç³»åˆ—çš„æ‰‹æœºï¼Ÿ&quot;)
                                     String message, @RequestParam(value = &quot;stuffit&quot;, defaultValue = &quot;false&quot;)
                                     boolean stuffit) &#123;

        PromptTemplate promptTemplate = new PromptTemplate(qaPromptResource);

        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
        map.put(&quot;question&quot;, message);
        if (stuffit) &#123;
            map.put(&quot;context&quot;, docsToStuffResource);
        &#125; else &#123;
            map.put(&quot;context&quot;, &quot;&quot;);
        &#125;

        return new Completion(chatClient.prompt(promptTemplate.create(map)).call().content());
    &#125;

&#125;


GETï¼šhttp://localhost:10007/example/ai/stuff
message  ç»™æˆ‘æ¨èä¸€æ¬¾ç™¾ç‚¼ç³»åˆ—çš„æ‰‹æœºï¼Ÿ
stuffit  true
</code></pre>
<pre><code class="java">C:\Users\Pluminary\Desktop\HouDuan\ai-demo\prompt-demo\src\main\resources\prompts\qa-prompt.st
ä½¿ç”¨ä»¥ä¸‹ä¸Šä¸‹æ–‡æ¥å›ç­”æœ€åçš„é—®é¢˜ã€‚
å¦‚æœä½ ä¸çŸ¥é“ç­”æ¡ˆï¼Œå°±è¯´ä½ ä¸çŸ¥é“ï¼Œä¸è¦è¯•å›¾ç¼–é€ ç­”æ¡ˆã€‚

&#123;context&#125;

é—®é¢˜: &#123;question&#125;
æœ‰ç”¨çš„ç­”æ¡ˆï¼š
</code></pre>
<pre><code class="java">C:\Users\Pluminary\Desktop\HouDuan\ai-demo\prompt-demo\src\main\resources\docs\bailian.md
# **ç™¾ç‚¼æ‰‹æœºäº§å“ä»‹ç»**

æ¬¢è¿æ¥åˆ°æœªæ¥ç§‘æŠ€çš„å‰æ²¿ï¼Œæ¢ç´¢æˆ‘ä»¬ç²¾å¿ƒæ‰“é€ çš„æ™ºèƒ½æ‰‹æœºç³»åˆ—ï¼Œæ¯ä¸€æ¬¾éƒ½æ˜¯ä¸ºäº†æ»¡è¶³æ‚¨å¯¹ç§‘æŠ€ç”Ÿæ´»çš„æ— é™éæƒ³è€Œç”Ÿã€‚

**ç™¾ç‚¼X1** â€”â€” ç•…äº«æè‡´è§†ç•Œï¼šæ­è½½6.7è‹±å¯¸1440 x 3200åƒç´ è¶…æ¸…å±å¹•ï¼Œæ­é…120Hzåˆ·æ–°ç‡ï¼Œæµç•…è§†è§‰ä½“éªŒè·ƒç„¶çœ¼å‰ã€‚256GBæµ·é‡å­˜å‚¨ç©ºé—´ä¸12GB RAMå¼ºå¼ºè”åˆï¼Œæ— è®ºæ˜¯å¤§å‹æ¸¸æˆè¿˜æ˜¯å¤šä»»åŠ¡å¤„ç†ï¼Œéƒ½èƒ½è½»æ¾åº”å¯¹ã€‚5000mAhç”µæ± é•¿ç»­èˆªï¼ŒåŠ ä¸Šè¶…æ„Ÿå…‰å››æ‘„ç³»ç»Ÿï¼Œè®°å½•ç”Ÿæ´»æ¯ä¸€åˆ»ç²¾å½©ã€‚å‚è€ƒå”®ä»·ï¼š4599 - 4999

**é€šä¹‰Vivid 7** â€”â€” æ™ºèƒ½æ‘„å½±æ–°ä½“éªŒï¼šæ‹¥æœ‰6.5è‹±å¯¸1080 x 2400åƒç´ å…¨é¢å±ï¼ŒAIæ™ºèƒ½æ‘„å½±åŠŸèƒ½è®©æ¯ä¸€å¼ ç…§ç‰‡éƒ½èƒ½å±•ç°ä¸“ä¸šçº§è‰²å½©ä¸ç»†èŠ‚ã€‚8GB RAMä¸128GBå­˜å‚¨ç©ºé—´ç¡®ä¿æµç•…æ“ä½œï¼Œ4500mAhç”µæ± æ»¡è¶³æ—¥å¸¸æ‰€éœ€ã€‚ä¾§é¢æŒ‡çº¹è§£é”ï¼Œä¾¿æ·åˆå®‰å…¨ã€‚å‚è€ƒå”®ä»·ï¼š2999 - 3299

**æ˜Ÿå°˜S9 Pro** â€”â€” åˆ›æ–°è§†è§‰ç››å®´ï¼šçªç ´æ€§6.9è‹±å¯¸1440 x 3088åƒç´ å±ä¸‹æ‘„åƒå¤´è®¾è®¡ï¼Œå¸¦æ¥æ— ç•Œè§†è§‰äº«å—ã€‚512GBå­˜å‚¨ä¸16GB RAMçš„é¡¶çº§é…ç½®ï¼Œé…åˆ6000mAhç”µæ± ä¸100Wå¿«å……æŠ€æœ¯ï¼Œè®©æ€§èƒ½ä¸ç»­èˆªå¹¶é©¾é½é©±ï¼Œå¼•é¢†ç§‘æŠ€æ½®æµã€‚å‚è€ƒå”®ä»·ï¼š5999 - 6499ã€‚

**ç™¾ç‚¼Ace Ultra** â€”â€” æ¸¸æˆç©å®¶ä¹‹é€‰ï¼šé…å¤‡6.67è‹±å¯¸1080 x 2400åƒç´ å±å¹•ï¼Œå†…ç½®10GB RAMä¸256GBå­˜å‚¨ï¼Œç¡®ä¿æ¸¸æˆè¿è¡Œä¸æ»‘æ— é˜»ã€‚5500mAhç”µæ± æ­é…æ¶²å†·æ•£çƒ­ç³»ç»Ÿï¼Œé•¿æ—¶é—´æ¸¸æˆä¹Ÿèƒ½ä¿æŒå†·é™ã€‚é«˜åŠ¨æ€åŒæ‰¬å£°å™¨ï¼Œæ²‰æµ¸å¼éŸ³æ•ˆå‡çº§æ¸¸æˆä½“éªŒã€‚å‚è€ƒå”®ä»·ï¼š3999 - 4299ã€‚

**ç™¾ç‚¼Zephyr Z9** â€”â€” è½»è–„ä¾¿æºçš„è‰ºæœ¯ï¼šè½»å·§çš„6.4è‹±å¯¸1080 x 2340åƒç´ è®¾è®¡ï¼Œæ­é…128GBå­˜å‚¨ä¸6GB RAMï¼Œæ—¥å¸¸ä½¿ç”¨æ¸¸åˆƒæœ‰ä½™ã€‚4000mAhç”µæ± ç¡®ä¿ä¸€å¤©æ— å¿§ï¼Œ30å€æ•°å­—å˜ç„¦é•œå¤´æ•æ‰è¿œå¤„ç»†èŠ‚ï¼Œè½»è–„è€Œä¸å¤±å¼ºå¤§ã€‚å‚è€ƒå”®ä»·ï¼š2499 - 2799ã€‚

**ç™¾ç‚¼Flex Fold+** â€”â€” æŠ˜å å±æ–°çºªå…ƒï¼šé›†åˆ›æ–°ä¸å¥¢åäºä¸€èº«ï¼Œä¸»å±7.6è‹±å¯¸1800 x 2400åƒç´ ä¸å¤–å±4.7è‹±å¯¸1080 x 2400åƒç´ ï¼Œå¤šè§’åº¦è‡ªç”±æ‚¬åœè®¾è®¡ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚ã€‚512GBå­˜å‚¨ã€12GB RAMï¼ŒåŠ ä¹‹4700mAhç”µæ± ä¸UTGè¶…è–„æŸ”æ€§ç»ç’ƒï¼Œå¼€å¯æŠ˜å å±æ—¶ä»£æ–°ç¯‡ç« ã€‚æ­¤å¤–ï¼Œè¿™æ¬¾æ‰‹æœºè¿˜æ”¯æŒåŒå¡åŒå¾…ã€å«æ˜Ÿé€šè¯ï¼Œå¸®åŠ©æ‚¨åœ¨ä¸–ç•Œå„åœ°éƒ½èƒ½ç•…è”é€šè¯ã€‚å‚è€ƒé›¶å”®ä»·ï¼š9999 - 10999ã€‚

æ¯ä¸€æ¬¾æ‰‹æœºéƒ½æ˜¯åŒ å¿ƒç‹¬è¿ï¼Œåªä¸ºæˆå°±æ‚¨æ‰‹ä¸­çš„ç§‘æŠ€è‰ºæœ¯å“ã€‚é€‰æ‹©å±äºæ‚¨çš„æ™ºèƒ½ä¼™ä¼´ï¼Œå¼€å¯æœªæ¥ç§‘æŠ€ç”Ÿæ´»çš„æ–°ç¯‡ç« ã€‚
</code></pre>
<h3 id="å®ç°ç»“æ„åŒ–è¾“å‡ºè½¬JSONæˆ–Javaå¯¹è±¡-entity-ã€æ–‡æœ¬è½¬ç‰¹å®šæ ¼å¼ã€‘"><a href="#å®ç°ç»“æ„åŒ–è¾“å‡ºè½¬JSONæˆ–Javaå¯¹è±¡-entity-ã€æ–‡æœ¬è½¬ç‰¹å®šæ ¼å¼ã€‘" class="headerlink" title="å®ç°ç»“æ„åŒ–è¾“å‡ºè½¬JSONæˆ–Javaå¯¹è±¡(.entity)ã€æ–‡æœ¬è½¬ç‰¹å®šæ ¼å¼ã€‘"></a>å®ç°ç»“æ„åŒ–è¾“å‡º<del>è½¬JSONæˆ–Javaå¯¹è±¡(.entity)</del>ã€æ–‡æœ¬è½¬ç‰¹å®šæ ¼å¼ã€‘</h3><h4 id="ChatClient-1"><a href="#ChatClient-1" class="headerlink" title="ChatClient"></a>ChatClient</h4><p>è°ƒç”¨<code>entity()</code>æ–¹æ³• </p>
<pre><code class="java">// å®ä½“å¯¹è±¡
ActorsFilms actorsFilms = ChatClient.create(chatModel).prompt()
        .user(u -&gt; u.text(&quot;Generate the filmography of 5 movies for &#123;actor&#125;.&quot;)
                    .param(&quot;actor&quot;, &quot;Tom Hanks&quot;))
        .call()
        .entity(ActorsFilms.class);
</code></pre>
<h6 id="List"><a href="#List" class="headerlink" title="List"></a>List</h6><pre><code class="java">List&lt;ActorsFilms&gt; actorsFilms = ChatClient.create(chatModel).prompt()
        .user(&quot;Generate the filmography of 5 movies for Tom Hanks and Bill Murray.&quot;)
        .call()
        .entity(new ParameterizedTypeReference&lt;List&lt;ActorsFilms&gt;&gt;() &#123;&#125;);


//ä½¿ç”¨ ListOutputConverter å°†æ¨¡å‹å“åº”è½¬æ¢ä¸º Listï¼š
List&lt;String&gt; flavors = ChatClient.create(chatModel).prompt()
                .user(u -&gt; u.text(&quot;List five &#123;subject&#125;&quot;)
                            .param(&quot;subject&quot;, &quot;ice cream flavors&quot;))
                .call()
                .entity(new ListOutputConverter(new DefaultConversionService()));
</code></pre>
<h6 id="Map-lt-String-Object-gt"><a href="#Map-lt-String-Object-gt" class="headerlink" title="Map&lt; String, Object&gt;"></a>Map&lt; String, Object&gt;</h6><pre><code class="java">Map&lt;String, Object&gt; result = ChatClient.create(chatModel).prompt()
        .user(u -&gt; u.text(&quot;Provide me a List of &#123;subject&#125;&quot;)
                    .param(&quot;subject&quot;, &quot;an array of numbers from 1 to 9 under their key name &#39;numbers&#39;&quot;))
        .call()
        .entity(new ParameterizedTypeReference&lt;Map&lt;String, Object&gt;&gt;() &#123;&#125;);
</code></pre>
<hr>
<pre><code class="java">com/fox/structureddemo/stream/StreamToBeanEntity.java
/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.fox.structureddemo.stream;

public class StreamToBeanEntity &#123;

    private String title;
    private String author;
    private String date;
    private String content;

    public StreamToBeanEntity() &#123;
    &#125;

    public String getTitle() &#123;
        return title;
    &#125;

    public void setTitle(String title) &#123;
        this.title = title;
    &#125;

    public String getAuthor() &#123;
        return author;
    &#125;

    public void setAuthor(String author) &#123;
        this.author = author;
    &#125;

    public String getDate() &#123;
        return date;
    &#125;

    public void setDate(String date) &#123;
        this.date = date;
    &#125;

    public String getContent() &#123;
        return content;
    &#125;

    public void setContent(String content) &#123;
        this.content = content;
    &#125;

    @Override
    public String toString() &#123;
        return &quot;StreamToBeanEntity&#123;&quot; +
                &quot;title=&#39;&quot; + title + &#39;\&#39;&#39; +
                &quot;, author=&#39;&quot; + author + &#39;\&#39;&#39; +
                &quot;, date=&#39;&quot; + date + &#39;\&#39;&#39; +
                &quot;, content=&#39;&quot; + content + &#39;\&#39;&#39; +
                &#39;&#125;&#39;;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/fox/structureddemo/stream/StreamToBeanController.java
/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.fox.structureddemo.stream;

import jakarta.servlet.http.HttpServletResponse;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.converter.BeanOutputConverter;
import org.springframework.core.ParameterizedTypeReference;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import reactor.core.publisher.Flux;

import java.util.Objects;


@RestController
@RequestMapping(&quot;/example/stream&quot;)
public class StreamToBeanController &#123;

    private final ChatClient chatClient;

    private static final Logger log = LoggerFactory.getLogger(StreamToBeanController.class);

    public StreamToBeanController(ChatClient.Builder builder) &#123;
        // ä½¿ç”¨builderå¯¹è±¡æ„å»ºChatClientå®ä¾‹
        this.chatClient = builder.build();
    &#125;


    /**
     * @return &#123;@link com.fox.structureddemo.stream.StreamToBeanEntity&#125;
     */
    @GetMapping(&quot;/play&quot;)
    public StreamToBeanEntity simpleChat(HttpServletResponse response) &#123;

        response.setCharacterEncoding(&quot;UTF-8&quot;);

        var converter = new BeanOutputConverter&lt;&gt;(
                new ParameterizedTypeReference&lt;StreamToBeanEntity&gt;() &#123; &#125;
        );

        Flux&lt;String&gt; flux = this.chatClient.prompt()
                .user(u -&gt; u.text(&quot;&quot;&quot;
                        requirement: è¯·ç”¨å¤§æ¦‚ 120 å­—ï¼Œä½œè€…ä¸º Fox ï¼Œä¸ºè®¡ç®—æœºçš„å‘å±•å†å²å†™ä¸€é¦–ç°ä»£è¯—;
                        format: ä»¥çº¯æ–‡æœ¬è¾“å‡º jsonï¼Œè¯·ä¸è¦åŒ…å«ä»»ä½•å¤šä½™çš„æ–‡å­—â€”â€”åŒ…æ‹¬ markdown æ ¼å¼;
                        outputExample: &#123;
                             &quot;title&quot;: &#123;title&#125;,
                             &quot;author&quot;: &#123;author&#125;,
                             &quot;date&quot;: &#123;date&#125;,
                             &quot;content&quot;: &#123;content&#125;
                        &#125;;
                        &quot;&quot;&quot;))
                .stream()
                .content();

        String result = String.join(&quot;\n&quot;, Objects.requireNonNull(flux.collectList().block()))
                .replaceAll(&quot;\\n&quot;, &quot;&quot;)
                .replaceAll(&quot;\\s+&quot;, &quot; &quot;)
                .replaceAll(&quot;\&quot;\\s*:&quot;, &quot;\&quot;:&quot;)
                .replaceAll(&quot;:\\s*\&quot;&quot;, &quot;:\&quot;&quot;);

        log.info(&quot;LLMs å“åº”çš„ json æ•°æ®ä¸ºï¼š&#123;&#125;&quot;, result);

        return converter.convert(result);
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/fox/structureddemo/stream/StreamToJsonController.java
/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.fox.structureddemo.stream;

import com.alibaba.cloud.ai.dashscope.api.DashScopeResponseFormat;
import com.alibaba.cloud.ai.dashscope.chat.DashScopeChatOptions;
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.model.ChatModel;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;


@RestController
@RequestMapping(&quot;/example/stream/json&quot;)
public class StreamToJsonController &#123;

    private static final String DEFAULT_PROMPT = &quot;ä½ å¥½ï¼Œè¯·ä»¥JSONæ ¼å¼ä»‹ç»ä½ è‡ªå·±ï¼&quot;;

    private final ChatClient dashScopeChatClient;

    public StreamToJsonController(ChatModel chatModel) &#123;

        DashScopeResponseFormat responseFormat = new DashScopeResponseFormat();
        responseFormat.setType(DashScopeResponseFormat.Type.JSON_OBJECT);

        this.dashScopeChatClient = ChatClient.builder(chatModel)
                .defaultOptions(
                        DashScopeChatOptions.builder()
                                .withTopP(0.7)
                                .withResponseFormat(responseFormat)
                                .build()
                )
                .build();
    &#125;

    /**
     * @return &#123;@link String&#125;
     */
    @GetMapping(&quot;/play&quot;)
    public String simpleChat(HttpServletResponse response) &#123;
        response.setCharacterEncoding(&quot;UTF-8&quot;);
        return dashScopeChatClient.prompt(DEFAULT_PROMPT)
                .call()
                .content();
    &#125;

&#125;
</code></pre>
<h3 id="é€šä¹‰åƒé—®å¤§æ¨¡å‹è°ƒä¼˜"><a href="#é€šä¹‰åƒé—®å¤§æ¨¡å‹è°ƒä¼˜" class="headerlink" title="é€šä¹‰åƒé—®å¤§æ¨¡å‹è°ƒä¼˜"></a>é€šä¹‰åƒé—®å¤§æ¨¡å‹è°ƒä¼˜</h3><ul>
<li><p><strong>temperature</strong>ï¼šæ¸©åº¦å€¼è¶Šé«˜ï¼Œæ¨¡å‹ç”Ÿæˆçš„å†…å®¹å°±è¶Šä¸°å¯Œå¤šæ ·</p>
<h6 id="æ¸©åº¦åªæ˜¯æ¥è°ƒæ•´å€™é€‰Tokené›†åˆçš„æ¦‚ç‡åˆ†å¸ƒ"><a href="#æ¸©åº¦åªæ˜¯æ¥è°ƒæ•´å€™é€‰Tokené›†åˆçš„æ¦‚ç‡åˆ†å¸ƒ" class="headerlink" title="æ¸©åº¦åªæ˜¯æ¥è°ƒæ•´å€™é€‰Tokené›†åˆçš„æ¦‚ç‡åˆ†å¸ƒ"></a>æ¸©åº¦åªæ˜¯æ¥è°ƒæ•´å€™é€‰Tokené›†åˆçš„æ¦‚ç‡åˆ†å¸ƒ</h6><p>ä½å€¼ï¼ˆ0.2ï¼‰ï¼šé€‚ç”¨äºæ ‡å‡†åŒ–å›ç­”ï¼ˆå¦‚é€€è´§æ”¿ç­–æŸ¥è¯¢ï¼‰<br>é«˜å€¼ï¼ˆ0.8ï¼‰ï¼šé€‚ç”¨äºåˆ›æ„åœºæ™¯ï¼ˆå¦‚ä¿ƒé”€æ–‡æ¡ˆç”Ÿæˆï¼‰ä½æ¸©åº¦ã€ä¸­æ¸©åº¦å’Œé«˜æ¸©åº¦æ˜¯ä¾æ®é€šä¹‰åƒé—®plusæ¨¡å‹çš„å–å€¼èŒƒå›´[0, 2)æ¥åˆ’åˆ†ã€‚</p>
<ul>
<li>ä½æ¸©åº¦ï¼ˆtemperature&#x3D;0.1ï¼‰ï¼šå¤§æ¨¡å‹é€‰æ‹©â€œRAGâ€çš„æ¦‚ç‡è¿œé«˜äºå…¶å®ƒå€™é€‰Tokenï¼Œè¿™ä¼šå¯¼è‡´å…¶è¾“å‡ºç›¸å¯¹å•ä¸€ã€‚</li>
<li>ä¸­æ¸©åº¦ï¼ˆtemperature&#x3D;0.7ï¼‰ï¼šå€™é€‰Tokenä¹‹é—´æ¦‚ç‡åˆ†å¸ƒç›¸å¯¹å¹³ç¼“ï¼Œé™¤â€œRAGâ€ä¹‹å¤–çš„å€™é€‰Tokenå‡ºç°çš„æ¦‚ç‡éƒ½åœ¨å¢åŠ ã€‚</li>
<li>é«˜æ¸©åº¦ï¼ˆtemperature&#x3D;1.2ï¼‰ï¼šåŸä½æ¦‚ç‡çš„å€™é€‰Tokenå‡ºç°æ¦‚ç‡è¿›ä¸€æ­¥æå‡ï¼Œæ‰“ä¹±åŸæœ‰çš„æ’åºï¼Œè¿›ä¸€æ­¥æé«˜äº†å¤§æ¨¡å‹è¾“å‡ºçš„éšæœºæ€§ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œâ€œç”»ç”»â€å‡ºç°çš„æ¦‚ç‡åè€Œæœ€é«˜ã€‚</li>
</ul>
</li>
<li><p><strong>top_p</strong>ï¼štop_på€¼è¶Šé«˜ï¼Œå¤§æ¨¡å‹çš„è¾“å‡ºç»“æœéšæœºæ€§è¶Šé«˜</p>
<h6 id="top-pæ§åˆ¶å€™é€‰Tokené›†åˆçš„é‡‡æ ·èŒƒå›´ã€‚"><a href="#top-pæ§åˆ¶å€™é€‰Tokené›†åˆçš„é‡‡æ ·èŒƒå›´ã€‚" class="headerlink" title="top_pæ§åˆ¶å€™é€‰Tokené›†åˆçš„é‡‡æ ·èŒƒå›´ã€‚"></a>top_pæ§åˆ¶å€™é€‰Tokené›†åˆçš„é‡‡æ ·èŒƒå›´ã€‚</h6><p>è®¾ç½®top_p&#x3D;0.9å¹³è¡¡å¤šæ ·æ€§ä¸å‡†ç¡®æ€§ï¼Œé˜²æ­¢ä½æ¦‚ç‡tokenå¹²æ‰°</p>
</li>
</ul>
<p>ä¸ºäº†ç¡®ä¿ç”Ÿæˆå†…å®¹çš„å¯æ§æ€§ï¼Œå»ºè®®ä¸è¦åŒæ—¶è°ƒæ•´top_på’Œtemperatureã€‚åŒæ—¶è°ƒæ•´å¯èƒ½å¯¼è‡´è¾“å‡ºç»“æœä¸å¯é¢„æµ‹å’Œå¤æ‚ã€‚ä½ å¯ä»¥ä¼˜å…ˆè°ƒæ•´å…¶ä¸­ä¸€ç§å‚æ•°ï¼Œè§‚å¯Ÿå…¶å¯¹ç»“æœçš„å½±å“ï¼Œå†é€æ­¥å¾®è°ƒã€‚</p>
<ul>
<li><strong>top_k</strong>ï¼štop_kè¶Šå¤§ï¼Œç”Ÿæˆå†…å®¹è¶Šå¤šæ ·åŒ–ï¼›top_kè¶Šå°ï¼Œå†…å®¹åˆ™æ›´å›º</li>
</ul>
<p>åœ¨é€šä¹‰åƒé—®ç³»åˆ—æ¨¡å‹ä¸­ï¼Œå‚æ•°top<em>kä¹Ÿæœ‰ç±»ä¼¼top</em>pçš„èƒ½åŠ›ï¼Œå¯æŸ¥é˜…é€šä¹‰åƒé—®APIæ–‡æ¡£ã€‚å®ƒæ˜¯ä¸€ç§é‡‡æ ·æœºåˆ¶ï¼Œä»æ¦‚ç‡æ’åå‰kçš„Tokenä¸­éšæœºé€‰æ‹©ä¸€ä¸ªè¿›è¡Œè¾“å‡ºã€‚ä¸€èˆ¬æ¥è¯´ï¼Œtop<em>kè¶Šå¤§ï¼Œç”Ÿæˆå†…å®¹è¶Šå¤šæ ·åŒ–ï¼›top</em>kè¶Šå°ï¼Œå†…å®¹åˆ™æ›´å›ºå®šã€‚å½“top_kè®¾ç½®ä¸º1æ—¶ï¼Œæ¨¡å‹ä»…é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„Tokenï¼Œè¾“å‡ºä¼šæ›´åŠ ç¨³å®šï¼Œä½†ä¹Ÿä¼šå¯¼è‡´ç¼ºä¹å˜åŒ–å’Œåˆ›æ„ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/model-studio/use-qwen-by-calling-api?spm=a2c4g.11186623.help-menu-2400256.d_3_3_0.68332bdb2Afk2s&scm=20140722.H_2712576._.OR_help-V_1">é€šä¹‰åƒé—®APIå‚è€ƒ_å¤§æ¨¡å‹æœåŠ¡å¹³å°ç™¾ç‚¼(Model Studio)-é˜¿é‡Œäº‘å¸®åŠ©ä¸­å¿ƒ</a></p>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/b76b2ef0bfbe66e8f88d7e832b3e955d3a3800d6/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B02.png"></p>
<h4 id="å¤šä¸ªAIå¤§æ¨¡å‹æ— ç¼åˆ‡æ¢ã€ğŸ‘†å›¾åœ¨ä¸Šé¢ğŸ‘†ã€‘"><a href="#å¤šä¸ªAIå¤§æ¨¡å‹æ— ç¼åˆ‡æ¢ã€ğŸ‘†å›¾åœ¨ä¸Šé¢ğŸ‘†ã€‘" class="headerlink" title="å¤šä¸ªAIå¤§æ¨¡å‹æ— ç¼åˆ‡æ¢ã€ğŸ‘†å›¾åœ¨ä¸Šé¢ğŸ‘†ã€‘"></a>å¤šä¸ªAIå¤§æ¨¡å‹æ— ç¼åˆ‡æ¢ã€ğŸ‘†å›¾åœ¨ä¸Šé¢ğŸ‘†ã€‘</h4><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/QDICVSc8em4YYnEdRy07Ag">å¦‚ä½•å®ç°å¤šä¸ªAIå¤§æ¨¡å‹çš„æ— ç¼åˆ‡æ¢ï¼Œæ¯”å¦‚DeepSeek-R1 è°ƒç”¨å¤±è´¥å¯ä»¥è¯·æ±‚é™çº§è°ƒç”¨ QwQ-32Bã€‚ AIç½‘å…³æ–¹æ¡ˆå®æˆ˜</a></p>
<p>æœŸï¼Œé€šä¹‰åƒé—®å‘å¸ƒäº†ä¸€æ¬¾å…¨æ–°çš„æ¨ç†æ¨¡å‹ QwQ-32Bã€‚åœ¨å„ç±»åŸºå‡†æµ‹è¯•ä¸­ï¼Œè¿™ä¸ªæ‹¥æœ‰ 320 äº¿å‚æ•°çš„æ¨¡å‹å±•ç°å‡ºäº†ä¸ DeepSeek-R1ï¼ˆ6710 äº¿å‚æ•°ï¼‰ç›¸å½“çš„æ€§èƒ½ã€‚è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>å¯¹äºä¸ªäººç”¨æˆ·è€Œè¨€ï¼ŒQwQ-32B èƒ½å¤Ÿç›´æ¥åœ¨æœ¬åœ°è¿è¡Œï¼Œä¸”å¯¹è®¾å¤‡çš„è¦æ±‚æ›´ä½ï¼Œé€‚åˆåœ¨æ›´å°çš„ç§»åŠ¨è®¾å¤‡ä¸Šä½¿ç”¨ã€‚</li>
<li>å¯¹äºä¼ä¸šç”¨æˆ·æ¥è¯´ï¼Œè°ƒç”¨æ¨ç†å¤§æ¨¡å‹ API çš„æˆæœ¬å¯ä»¥è¿›ä¸€æ­¥é™ä½ï¼Œæœ€é«˜å¯å‡å°‘ 90% çš„è´¹ç”¨ã€‚</li>
</ul>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ— ç¼åˆ‡æ¢å¤šä¸ªå¤§æ¨¡å‹çš„éœ€æ±‚æ—¥ç›Šå‡¸æ˜¾ã€‚ä¾‹å¦‚ï¼Œä¼ä¸šå¯èƒ½éœ€è¦åŒæ—¶å¯¹æ¥å¤šä¸ªå¤§æ¨¡å‹ï¼Œä»¥æ»¡è¶³ä¸åŒä¸šåŠ¡åœºæ™¯çš„éœ€æ±‚ï¼›å½“å•ä¸ªæ¨¡å‹å‡ºç°ç¨³å®šæ€§é—®é¢˜æ—¶ï¼Œèƒ½å¤Ÿè¿…é€Ÿå›é€€åˆ°å¦ä¸€ä¸ªæ¨¡å‹ï¼Œç¡®ä¿ä¸šåŠ¡çš„è¿ç»­æ€§å’Œç¨³å®šæ€§ï¼›åœ¨ Multi Agent åœºæ™¯ä¸‹ï¼Œä¸€ä¸ªå¤æ‚ä»»åŠ¡å¯èƒ½éœ€è¦è°ƒç”¨å¤šä¸ªæ¨¡å‹æ¥ååŒå®Œæˆã€‚Higress AI ç½‘å…³æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤šæ¨¡å‹æœåŠ¡ï¼Œå¹¶å…·å¤‡æ¶ˆè´¹è€…é‰´æƒã€æ¨¡å‹è‡ªåŠ¨åˆ‡æ¢ç­‰é«˜çº§åŠŸèƒ½ã€‚</p>
<p>æœ¬æ–‡å°†ä¸ºæ‚¨æä¾›ä¸€ä»½è¯¦ç»†çš„æ•™ç¨‹ï¼ŒæŒ‡å¯¼æ‚¨å¦‚ä½•ä½¿ç”¨ Higress AI ç½‘å…³åœ¨ DeepSeek-R1 å’Œ QwQ-32B å¤§æ¨¡å‹ä¹‹é—´å®ç°æ— ç¼åˆ‡æ¢ã€‚</p>
<p>å…³äºHigressç½‘å…³çš„ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzU1ODk1NTQ0Mg==&mid=2247485661&idx=1&sn=2435d46a1ee26308c84b3ef2c2068a12&scene=21#wechat_redirect">é˜¿é‡Œå·´å·´å¼€æºçš„äº‘åŸç”Ÿç½‘å…³Higresså®æˆ˜</a></p>
<p>è‹¥æƒ³è¦Higressæ¡Œé¢ç‰ˆ å…ˆä¸‹è½½<code>Docker Desktop</code>å†ä¸‹è½½ <code>Cygwin</code>éªŒè¯<br>Cygwin å®‰è£…æ˜¯å¦æˆåŠŸ</p>
<pre><code class="shell">cygcheck -c cygwin
</code></pre>
<blockquote>
<p>Pluminary@Pluminary ~<br>$ cygcheck -c cygwin<br>Cygwin Package Information<br>Package              Version    Status<br>cygwin               3.6.1-1        OK</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/474242350">cygwinä¸‹è½½åŠå®‰è£…è¯¦ç»†æ•™ç¨‹ï¼Œwindowsä½¿ç”¨linuxçš„shellå‘½ä»¤ç¼–è¯‘æºç ï¼ˆwin10) - çŸ¥ä¹</a><br><a target="_blank" rel="noopener" href="https://higress.cn/zh-cn/blog/DeployOnWindows/">Windows ä¸‹ Higress éƒ¨ç½²å®è·µ | Higress</a></p>
<p>å…ˆ<strong>å•æœºéƒ¨ç½²nacos</strong> è¿›å…¥<code>D:\nacos-docker-master\cmd</code><br>å•æœºéƒ¨ç½²æŒ‡ä»¤ï¼š<code>docker-compose -f example/standalone-derby.yaml up</code><br>è¿™é‡Œå¯ä»¥ä¿®æ”¹ç«¯å£æ˜ å°„ï¼š<code>D:\nacos-docker-master\example\standalone-derby.yaml</code> å¦‚ä¸‹ğŸ‘‡<br>æ­£ç¡®çš„ç›‘æ§æ£€æŸ¥å‘½ä»¤ï¼š<code>curl http://192.168.31.103:8848/nacos/v3/console/health/readiness</code></p>
<pre><code class="yaml">version: &quot;2&quot;
services:
  nacos:
    image: nacos/nacos-server:$&#123;NACOS_VERSION&#125;
    container_name: nacos-standalone
    environment:
      - PREFER_HOST_MODE=hostname
      - MODE=standalone
      - NACOS_AUTH_IDENTITY_KEY=serverIdentity
      - NACOS_AUTH_IDENTITY_VALUE=security
      - NACOS_AUTH_TOKEN=VGhpc0lzTXlDdXN0b21TZWNyZXRLZXkwMTIzNDU2Nzg=
    volumes:
      - ./standalone-logs/:/home/nacos/logs
    ports:
      - &quot;8848:8848&quot;
      - &quot;18080:8080&quot;       
  prometheus:
    container_name: prometheus
    image: prom/prometheus:latest
    volumes:
      - ./prometheus/prometheus-standalone.yaml:/etc/prometheus/prometheus.yml
    ports:
      - &quot;9090:9090&quot;
    depends_on:
      - nacos
    restart: on-failure
  grafana:
    container_name: grafana
    image: grafana/grafana:latest
    ports:
      - 3000:3000
    restart: on-failure
</code></pre>
<p>éšååœ¨æ¡Œé¢æ‰“å¼€<code>cmd</code>è¾“å…¥<code>ipconfig</code>å¯»æ‰¾ipåœ°å€ è®°å½•ä¸‹æ¥<br>åœ¨æ¡Œé¢å³é”® â†’ é€‰æ‹© <strong>Git Bash Here</strong>ï¼Œè¿›å…¥ Bash ç¯å¢ƒ<br>åœ¨ Git Bash é‡Œæ‰§è¡Œå‘½ä»¤ï¼šã€ipåœ°å€æ˜¯é€šè¿‡ipconfigè·å–ã€‘**<u>è¿™é‡Œè¦è®°å¾—å…³é—­æ¢¯å­å’Œä»£ç† å› ä¸ºä»é˜¿é‡Œäº‘æ‹‰é•œåƒ</u>**</p>
<pre><code class="yaml">curl -fsSL https://higress.io/standalone/get-higress.sh | bash -s -- -c nacos://192.168.31.103:8848
</code></pre>
<p>â˜…â˜…</p>
<pre><code class="java">// å®‰è£…higress è¿›å…¥bash
$ curl -fsSL https://higress.io/standalone/get-higress.sh | bash -s -- -c nacos://192.168.43.85:8848 --nacos-username=nacos --nacos-password=nacos --nacos-ns=higress-system --nacos-ns=higress-system

       // è¿™é‡Œæ˜¯å¯åŠ¨çš„nacos
cd D:\nacos-docker-master\example
// é‡å¯docker(Nacos)
docker-compose -f standalone-derby.yaml down
docker-compose -f standalone-derby.yaml up -d

// ä¸€é”®é‡å¯
docker restart nacos-standalone

    
       // è¿™é‡Œæ˜¯å¯åŠ¨higress    
// åœ¨æ¡Œé¢å¯ä¸€ä¸ªbash  å¯åŠ¨higress
$ /c/Users/Pluminary/Desktop/higress/bin/startup.sh
// å¦‚æœæ”¹äº†é…ç½® åœ¨bashé‡Œ  ã€ä¸€å®šè¦å…ˆå¯åŠ¨docker æ‰å¯ä»¥å¹²åˆ«çš„ã€‘
cd /c/Users/Pluminary/Desktop/higress
./bin/shutdown.sh
./bin/startup.sh
    
</code></pre>
<blockquote>
<h4 id="ç„¶åå°±ä¸€ç›´æ— æ•ŒæŠ¥é”™ï¼š"><a href="#ç„¶åå°±ä¸€ç›´æ— æ•ŒæŠ¥é”™ï¼š" class="headerlink" title="ç„¶åå°±ä¸€ç›´æ— æ•ŒæŠ¥é”™ï¼š"></a>ç„¶åå°±ä¸€ç›´æ— æ•ŒæŠ¥é”™ï¼š</h4><p><a target="_blank" rel="noopener" href="http://192.168.31.103:8848/nacos/v1/console/health/readiness">http://192.168.31.103:8848/nacos/v1/console/health/readiness</a> returns 000<br>Waiting for Nacos to get readyâ€¦<br>Waiting for Nacos to get readyâ€¦<br>Waiting for Nacos to get readyâ€¦<br>Waiting for Nacos to get readyâ€¦<br>Waiting for Nacos to get readyâ€¦</p>
<p>ä¿®æ”¹ç«¯å£ä¸å ç”¨å†²çªçš„8080å³å¯</p>
<p><code>cd D:\nacos-docker-master\example</code></p>
<p><strong>é‡å¯docker(Nacos)</strong><br><code>docker-compose -f standalone-derby.yaml down</code><br><code>docker-compose -f standalone-derby.yaml up -d</code></p>
<h4 id="ä¸€é”®é‡å¯"><a href="#ä¸€é”®é‡å¯" class="headerlink" title="ä¸€é”®é‡å¯"></a>ä¸€é”®é‡å¯</h4><p><code>docker restart nacos-standalone</code></p>
<hr>
<hr>
<hr>
<h4 id="ä¸‹ä¸€ä¸ªæŠ¥é”™ï¼š"><a href="#ä¸‹ä¸€ä¸ªæŠ¥é”™ï¼š" class="headerlink" title="ä¸‹ä¸€ä¸ªæŠ¥é”™ï¼š"></a>ä¸‹ä¸€ä¸ªæŠ¥é”™ï¼š</h4><p>Nacos is ready.<br>Initializing Nacos serverâ€¦</p>
<p>Nacos 3.x isnâ€™t fully supported yet.</p>
<p>If you do want to use Nacos 3.x, please add the following property into its application.properties file:<br>  nacos.core.api.compatibility.console.enabled&#x3D;true</p>
<p>Higress configuration failed with 255.<br>Failed to install Higress<br>        For support, go to <a target="_blank" rel="noopener" href="https://github.com/alibaba/higress">https://github.com/alibaba/higress</a>.</p>
<h6 id="è¿™è¯´æ˜ä»€ä¹ˆï¼Ÿ"><a href="#è¿™è¯´æ˜ä»€ä¹ˆï¼Ÿ" class="headerlink" title="è¿™è¯´æ˜ä»€ä¹ˆï¼Ÿ"></a>è¿™è¯´æ˜ä»€ä¹ˆï¼Ÿ</h6><ul>
<li>Higress å½“å‰ç‰ˆæœ¬å¯¹ Nacos 3.x æ”¯æŒä¸å®Œå–„ï¼Œéœ€è¦å…¼å®¹æ¨¡å¼å¼€å¯</li>
<li>ä½ çš„ Nacos 3.x æœåŠ¡é»˜è®¤æ²¡å¼€å¯å…¼å®¹æ§åˆ¶å°APIï¼Œå¯¼è‡´å¥åº·æ£€æŸ¥æ¥å£è¿”å›å¼‚å¸¸æˆ–ç©º</li>
</ul>
<h4 id="1-ä¿®æ”¹-Nacos-é…ç½®ï¼Œå¯ç”¨å…¼å®¹æ¨¡å¼"><a href="#1-ä¿®æ”¹-Nacos-é…ç½®ï¼Œå¯ç”¨å…¼å®¹æ¨¡å¼" class="headerlink" title="1. ä¿®æ”¹ Nacos é…ç½®ï¼Œå¯ç”¨å…¼å®¹æ¨¡å¼"></a>1. ä¿®æ”¹ Nacos é…ç½®ï¼Œå¯ç”¨å…¼å®¹æ¨¡å¼</h4><p>æ‰¾åˆ°ä½ çš„ Nacos å®¹å™¨ä¸­ <code>application.properties</code> æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢è¿™ä¸€è¡Œï¼š</p>
<pre><code>nacos.core.api.compatibility.console.enabled=true
</code></pre>
<h4 id="2-é‡å¯-Nacos-å®¹å™¨"><a href="#2-é‡å¯-Nacos-å®¹å™¨" class="headerlink" title="2. é‡å¯ Nacos å®¹å™¨"></a>2. é‡å¯ Nacos å®¹å™¨</h4><pre><code>cd D:\nacos-docker-master\example
docker restart nacos-standalone
</code></pre>
<h4 id="3-è®¿é—®å¥åº·æ¥å£æµ‹è¯•"><a href="#3-è®¿é—®å¥åº·æ¥å£æµ‹è¯•" class="headerlink" title="3. è®¿é—®å¥åº·æ¥å£æµ‹è¯•"></a>3. è®¿é—®å¥åº·æ¥å£æµ‹è¯•</h4><pre><code class="java">curl http://192.168.43.85:8848/nacos/v1/console/health/readiness
</code></pre>
<p><span style="color:red"><strong>æä»€ä¹ˆä¹±ä¸ƒå…«ç³Ÿçš„é…ç½® ç›´æ¥é™çº§nacos å› ä¸ºnacos3.xxxæœ‰å¾ˆå¤šä¸å…¼å®¹çš„åœ°æ–¹</strong><br></span><code>D:\nacos-docker-master\example</code>çš„<code>NACOS_VERSION=v2.3.1</code></p>
<pre><code class="yaml">Pluminary@Pluminary MINGW64 ~/Desktop
$ curl -fsSL https://higress.io/standalone/get-higress.sh | bash -s -- -c nacos://192.168.43.85:8848 --nacos-username=nacos --nacos-password=nacos --nacos-ns=higress-system 

Downloading https://github.com/higress-group/higress-
standalone/archive/refs/tags/v2.1.5.tar.gz...
==== Build Configurations ====
time=&quot;2025-07-12T00:40:46+08:00&quot; level=warning msg=&quot;C:\\Users\\Pluminary\\Desktop\\higress\\compose\\docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion&quot;
Nacos is ready.
Initializing Nacos server...
Use Nacos API v1
  Namespace higress-system already exists in Nacos.
  Fixed data encryption key is used. Skip config overwriting check.
Initializing API server configurations...
  Data encryption key already exists.
Initializing controller configurations...

 ___  ___  ___  ________  ________  _______   ________   ________
|\  \|\  \|\  \|\   ____\|\   __  \|\  ___ \ |\   ____\ |\   ____\
\ \  \\\  \ \  \ \  \___|\ \  \|\  \ \   __/|\ \  \___|_\ \  \___|_
 \ \   __  \ \  \ \  \  __\ \   _  _\ \  \_|/_\ \_____  \\ \_____  \
  \ \  \ \  \ \  \ \  \|\  \ \  \\  \\ \  \_|\ \|____|\  \\|____|\  \
   \ \__\ \__\ \__\ \_______\ \__\\ _\\ \_______\____\_\  \ ____\_\  \
    \|__|\|__|\|__|\|_______|\|__|\|__|\|_______|\_________\\_________\
                                                \|_________\|_________|

Higress is configured successfully.

Important Notes:
  Sensitive configurations are encrypted when saving to Nacos.
  When configuring another server with the same Nacos configuration service, please make sure to add the following argument so all servers use the same encryption key:
   

Usage:
  Start: /c/Users/Pluminary/Desktop/higress/bin/startup.sh
  Stop: /c/Users/Pluminary/Desktop/higress/bin/shutdown.sh
  View Component Statuses: /c/Users/Pluminary/Desktop/higress/bin/status.sh
  View Logs: /c/Users/Pluminary/Desktop/higress/bin/logs.sh
  Re-configure: /c/Users/Pluminary/Desktop/higress/bin/configure.sh -r

Happy Higressing!
</code></pre>
<p>è®¿é—®Nacosï¼š<a target="_blank" rel="noopener" href="http://192.168.31.103:8848/nacos/#/listeningToQuery?dataId=&group=&appName=&namespace=&namespaceShowName=public">Nacos</a> æˆ– åœ°å€æ”¹æˆlocalhost</p>
</blockquote>
<blockquote>
<h2 id="âœ…-é…ç½®é¡¹-1ï¼šsecrets-nacos-auth-default"><a href="#âœ…-é…ç½®é¡¹-1ï¼šsecrets-nacos-auth-default" class="headerlink" title="âœ… é…ç½®é¡¹ 1ï¼šsecrets.nacos-auth-default"></a>âœ… é…ç½®é¡¹ 1ï¼š<code>secrets.nacos-auth-default</code></h2><h3 id="ä½ç½®ï¼š"><a href="#ä½ç½®ï¼š" class="headerlink" title="ä½ç½®ï¼š"></a><strong>ä½ç½®ï¼š</strong></h3><ul>
<li><strong>å‘½åç©ºé—´ï¼š</strong> <code>fc629691-b48f-4fa2-baa7-770dbaf8b63e</code>ï¼ˆå¯¹åº” <code>higress-system</code>ï¼‰</li>
<li><strong>Data IDï¼š</strong> <code>secrets.nacos-auth-default</code></li>
<li><strong>Groupï¼š</strong> <code>DEFAULT_GROUP</code></li>
<li><strong>é…ç½®æ ¼å¼ï¼š</strong> <code>YAML</code></li>
</ul>
<h3 id="é…ç½®å†…å®¹ï¼š"><a href="#é…ç½®å†…å®¹ï¼š" class="headerlink" title="é…ç½®å†…å®¹ï¼š"></a><strong>é…ç½®å†…å®¹ï¼š</strong></h3><pre><code>username: nacos
password: nacos
</code></pre>
<hr>
<h2 id="âœ…-é…ç½®é¡¹-2ï¼šconfigmaps-higress-config"><a href="#âœ…-é…ç½®é¡¹-2ï¼šconfigmaps-higress-config" class="headerlink" title="âœ… é…ç½®é¡¹ 2ï¼šconfigmaps.higress-config"></a>âœ… é…ç½®é¡¹ 2ï¼š<code>configmaps.higress-config</code></h2><h3 id="ä½ç½®ï¼š-1"><a href="#ä½ç½®ï¼š-1" class="headerlink" title="ä½ç½®ï¼š"></a><strong>ä½ç½®ï¼š</strong></h3><ul>
<li><strong>å‘½åç©ºé—´ï¼š</strong> <code>fc629691-b48f-4fa2-baa7-770dbaf8b63e</code></li>
<li><strong>Data IDï¼š</strong> <code>configmaps.higress-config</code></li>
<li><strong>Groupï¼š</strong> <code>DEFAULT_GROUP</code></li>
<li><strong>é…ç½®æ ¼å¼ï¼š</strong> <code>YAML</code></li>
</ul>
<h3 id="é…ç½®å†…å®¹ï¼š-1"><a href="#é…ç½®å†…å®¹ï¼š-1" class="headerlink" title="é…ç½®å†…å®¹ï¼š"></a><strong>é…ç½®å†…å®¹ï¼š</strong></h3><pre><code>apiVersion: v1
kind: ConfigMap
metadata:
  name: higress-config
  namespace: higress-system
data:
  ingressClass: higress
</code></pre>
<hr>
<h2 id="âœ…-é…ç½®é¡¹-3ï¼šmcpbridges-default"><a href="#âœ…-é…ç½®é¡¹-3ï¼šmcpbridges-default" class="headerlink" title="âœ… é…ç½®é¡¹ 3ï¼šmcpbridges.default"></a>âœ… é…ç½®é¡¹ 3ï¼š<code>mcpbridges.default</code></h2><h3 id="ä½ç½®ï¼š-2"><a href="#ä½ç½®ï¼š-2" class="headerlink" title="ä½ç½®ï¼š"></a><strong>ä½ç½®ï¼š</strong></h3><ul>
<li><strong>å‘½åç©ºé—´ï¼š</strong> <code>fc629691-b48f-4fa2-baa7-770dbaf8b63e</code></li>
<li><strong>Data IDï¼š</strong> <code>mcpbridges.default</code></li>
<li><strong>Groupï¼š</strong> <code>DEFAULT_GROUP</code></li>
<li><strong>é…ç½®æ ¼å¼ï¼š</strong> <code>YAML</code></li>
</ul>
<h3 id="é…ç½®å†…å®¹ï¼š-2"><a href="#é…ç½®å†…å®¹ï¼š-2" class="headerlink" title="é…ç½®å†…å®¹ï¼š"></a><strong>é…ç½®å†…å®¹ï¼š</strong></h3><pre><code>apiVersion: networking.higress.io/v1
kind: McpBridge
metadata:
  name: default
  namespace: higress-system
spec:
  registries:
    - domain: httpbin.org
      name: httpbin
      port: 80
      type: dns
</code></pre>
<pre><code class="yaml">./bin/configure.sh -a -c nacos://192.168.31.103:8848 \
  --nacos-username=nacos \
  --nacos-password=nacos \
  --nacos-ns=higress-system
</code></pre>
<h3 id="âœ…-è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨-r-å‚æ•°å¼ºåˆ¶é‡æ–°é…ç½®"><a href="#âœ…-è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨-r-å‚æ•°å¼ºåˆ¶é‡æ–°é…ç½®" class="headerlink" title="âœ… è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ -r å‚æ•°å¼ºåˆ¶é‡æ–°é…ç½®"></a>âœ… è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ <code>-r</code> å‚æ•°å¼ºåˆ¶é‡æ–°é…ç½®</h3><p>ä½ éœ€è¦<strong>å¼ºåˆ¶é‡æ–°æ‰§è¡Œé…ç½®æµç¨‹å¹¶æ˜¾å¼æŒ‡å®š nacos å‘½åç©ºé—´</strong>ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code>bashå¤åˆ¶ç¼–è¾‘./bin/configure.sh -a -r \
  -c nacos://192.168.31.103:8848 \
  --nacos-username=nacos \
  --nacos-password=nacos \
  --nacos-ns=higress-system \
  -k 7bbac1c2ab91ff074cb8d219c307d203
</code></pre>
<p>ğŸ“Œ è¯´æ˜ï¼š</p>
<ul>
<li><code>-r</code>ï¼šé‡æ–°è¿è¡Œé…ç½®æµç¨‹ï¼ˆä¸€å®šè¦åŠ ï¼‰</li>
<li><code>--nacos-ns=higress-system</code>ï¼šè¿™æ‰æ˜¯å†³å®šé…ç½®å†™å…¥å“ªä¸ªå‘½åç©ºé—´çš„å‚æ•°</li>
<li><code>.env</code> ä¸­çš„ <code>NACOS_NS</code> è™½ç„¶ä¹Ÿæœ‰ç”¨ï¼Œä½†ä»¥ä½ å‘½ä»¤å‚æ•°ä¸ºä¸»</li>
</ul>
</blockquote>
<h3 id="ä»€ä¹ˆæ˜¯RAG"><a href="#ä»€ä¹ˆæ˜¯RAG" class="headerlink" title="ä»€ä¹ˆæ˜¯RAG"></a>ä»€ä¹ˆæ˜¯RAG</h3><p>RAGï¼šæ¥æ”¶åˆ°é—®é¢˜åï¼Œå»çŸ¥è¯†åº“æŸ¥èµ„æ–™ï¼Œå¾—åˆ°æ£€ç´¢çŸ¥è¯†åè¿›è¡Œå›ç­”<br>å¾®è°ƒï¼šæå‰å­¦ä¹ çŸ¥è¯†ï¼Œä¸°å¯Œè‡ªå·±çš„èƒ½åŠ›ï¼Œæ¥æ”¶åˆ°é—®é¢˜åè¿›è¡Œå›ç­”</p>
<pre><code class="java">RAG â†’ é—®é¢˜ â†’ (LLM+çŸ¥è¯†) â†’ å›å¤
    
                   é—®é¢˜
                    â†“
å¾®è°ƒ â†’ LLM â†’ çŸ¥è¯† â†’ LLM(new)
               â†˜    â†“
                   å›å¤
</code></pre>
<h5 id="RAGå·¥ä½œåŸç†ï¼š"><a href="#RAGå·¥ä½œåŸç†ï¼š" class="headerlink" title="RAGå·¥ä½œåŸç†ï¼š"></a>RAGå·¥ä½œåŸç†ï¼š</h5><ul>
<li><p><strong>å»ºç«‹ç´¢å¼•é˜¶æ®µ</strong></p>
<p>æ–‡ä»¶ä¸Šä¼  â†’ æ–‡æ¡£åŠ è½½ â†’ å†…å®¹åˆ†å‰² â†’ æ–‡æœ¬å‘é‡åŒ– â†’ ç´¢å¼•å­˜å‚¨</p>
</li>
<li><p><strong>æ£€ç´¢ä¸ç”Ÿæˆé˜¶æ®µ</strong></p>
<p><strong>æ£€ç´¢</strong>ï¼šæ£€ç´¢é˜¶æ®µä¼šå¬å›ä¸é—®é¢˜æœ€ç›¸å…³çš„æ–‡æœ¬æ®µã€‚é€šè¿‡embeddingæ¨¡å‹å¯¹é—®é¢˜è¿›è¡Œæ–‡æœ¬å‘é‡åŒ–ï¼Œå¹¶ä¸å‘é‡æ•°æ®åº“çš„æ®µè½è¿›è¡Œè¯­ä¹‰ç›¸ä¼¼åº¦çš„æ¯”è¾ƒï¼Œæ‰¾å‡ºæœ€ç›¸å…³çš„æ®µè½ã€‚<br><strong>ç”Ÿæˆ</strong>ï¼šåœ¨æ£€ç´¢åˆ°ç›¸å…³çš„æ–‡æœ¬æ®µåï¼ŒRAGåº”ç”¨ä¼šå°†é—®é¢˜ä¸æ–‡æœ¬æ®µé€šè¿‡æç¤ºè¯æ¨¡æ¿ç”Ÿæˆæœ€ç»ˆçš„æç¤ºè¯ï¼Œç”±å¤§æ¨¡å‹ç”Ÿæˆå›å¤ï¼Œè¿™ä¸ªé˜¶æ®µæ›´å¤šæ˜¯åˆ©ç”¨å¤§æ¨¡å‹çš„æ€»ç»“èƒ½åŠ›ï¼Œè€Œä¸æ˜¯å¤§æ¨¡å‹æœ¬èº«å…·æœ‰çš„çŸ¥è¯†ã€‚</p>
</li>
<li><h5 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p>ç”¨æˆ·æé—® â†’  â†’ â†’ â†’ â†’ â†’     æç¤ºè¯  â†’ å¤§è¯­è¨€æ¨¡å‹ â†’ è¾“å‡ºç­”æ¡ˆ<br>   â†˜      â†’    å†…å®¹æ£€ç´¢   â†’       â†‘</p>
</li>
</ul>
<pre><code class="java">com/fox/ragdemo/config/RagConfig.java
package com.fox.ragdemo.config;

import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.document.Document;
import org.springframework.ai.embedding.EmbeddingModel;
import org.springframework.ai.vectorstore.SimpleVectorStore;
import org.springframework.ai.vectorstore.VectorStore;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import java.util.List;

@Configuration
public class RagConfig &#123;

    @Bean
    ChatClient chatClient(ChatClient.Builder builder) &#123;
        return builder.defaultSystem(&quot;ä½ å°†ä½œä¸ºä¸€åæœºå™¨äººäº§å“çš„ä¸“å®¶ï¼Œå¯¹äºç”¨æˆ·çš„ä½¿ç”¨éœ€æ±‚ä½œå‡ºè§£ç­”&quot;)
                .build();
    &#125;

    @Bean
    VectorStore vectorStore(EmbeddingModel embeddingModel) &#123;
        SimpleVectorStore simpleVectorStore = SimpleVectorStore.builder(embeddingModel)
                .build();

        // ç”Ÿæˆä¸€ä¸ªæœºå™¨äººäº§å“è¯´æ˜ä¹¦çš„æ–‡æ¡£
        List&lt;Document&gt; documents = List.of(
                new Document(&quot;äº§å“è¯´æ˜ä¹¦:äº§å“åç§°ï¼šæ™ºèƒ½æœºå™¨äºº\n&quot; +
                        &quot;äº§å“æè¿°ï¼šæ™ºèƒ½æœºå™¨äººæ˜¯ä¸€ä¸ªæ™ºèƒ½è®¾å¤‡ï¼Œèƒ½å¤Ÿè‡ªåŠ¨å®Œæˆå„ç§ä»»åŠ¡ã€‚\n&quot; +
                        &quot;åŠŸèƒ½ï¼š\n&quot; +
                        &quot;1. è‡ªåŠ¨å¯¼èˆªï¼šæœºå™¨äººèƒ½å¤Ÿè‡ªåŠ¨å¯¼èˆªåˆ°æŒ‡å®šä½ç½®ã€‚\n&quot; +
                        &quot;2. è‡ªåŠ¨æŠ“å–ï¼šæœºå™¨äººèƒ½å¤Ÿè‡ªåŠ¨æŠ“å–ç‰©å“ã€‚\n&quot; +
                        &quot;3. è‡ªåŠ¨æ”¾ç½®ï¼šæœºå™¨äººèƒ½å¤Ÿè‡ªåŠ¨æ”¾ç½®ç‰©å“ã€‚\n&quot;));

        simpleVectorStore.add(documents);
        return simpleVectorStore;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/fox/ragdemo/controller/RagController.java
package com.fox.ragdemo.controller;

import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.client.advisor.QuestionAnswerAdvisor;
import org.springframework.ai.vectorstore.VectorStore;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping(&quot;/ai&quot;)
public class RagController &#123;

    @Autowired
    private ChatClient chatClient;

    @Autowired
    private VectorStore vectorStore;


    @GetMapping(value = &quot;/chat&quot;, produces = &quot;text/plain; charset=UTF-8&quot;)
    public String generation(String userInput) &#123;
        // å‘èµ·èŠå¤©è¯·æ±‚å¹¶å¤„ç†å“åº”
        return chatClient.prompt()
                .user(userInput)
                // è°ƒç”¨çŸ¥è¯†åº“
                .advisors(new QuestionAnswerAdvisor(vectorStore))
                .call()
                .content();
    &#125;
&#125;
</code></pre>
<pre><code class="java">package com.fox.ragdemo;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class RagDemoApplication &#123;

    public static void main(String[] args) &#123;
        SpringApplication.run(RagDemoApplication.class, args);
    &#125;
&#125;
</code></pre>
<h3 id="RAG-é˜¿é‡Œäº‘ç™¾ç‚¼"><a href="#RAG-é˜¿é‡Œäº‘ç™¾ç‚¼" class="headerlink" title="RAG+é˜¿é‡Œäº‘ç™¾ç‚¼"></a>RAG+é˜¿é‡Œäº‘ç™¾ç‚¼</h3><h5 id="æœ¬åœ°é›†æˆç™¾ç‚¼æ™ºèƒ½ä½“åº”ç”¨"><a href="#æœ¬åœ°é›†æˆç™¾ç‚¼æ™ºèƒ½ä½“åº”ç”¨" class="headerlink" title="æœ¬åœ°é›†æˆç™¾ç‚¼æ™ºèƒ½ä½“åº”ç”¨"></a>æœ¬åœ°é›†æˆç™¾ç‚¼æ™ºèƒ½ä½“åº”ç”¨</h5><ul>
<li><strong>ä¼ ç»ŸSpringBootåº”ç”¨</strong>(Spring AI Alibaba) â†’ <strong>ç™¾ç‚¼å¹³å°</strong>(æ™ºèƒ½ä½“åº”ç”¨)</li>
<li>SpringBoot + Spring AI Alibabaæ¥å…¥RAGåº”ç”¨å®æˆ˜<br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/MO59zPv5OFtB01htIcIwwg">SpringBoot+Spring AI Alibabaæ¥å…¥RAGåº”ç”¨å®æˆ˜ï¼Œè®©ä½ çš„å¾®æœåŠ¡åº”ç”¨å…·å¤‡æ™ºèƒ½åŒ–èƒ½åŠ›ï¼Œå°ç™½ä¹Ÿèƒ½å¿«é€Ÿä¸Šæ‰‹</a></li>
</ul>
<h5 id="æœ¬åœ°RAGåº”ç”¨é›†æˆç™¾ç‚¼çŸ¥è¯†åº“"><a href="#æœ¬åœ°RAGåº”ç”¨é›†æˆç™¾ç‚¼çŸ¥è¯†åº“" class="headerlink" title="æœ¬åœ°RAGåº”ç”¨é›†æˆç™¾ç‚¼çŸ¥è¯†åº“"></a>æœ¬åœ°RAGåº”ç”¨é›†æˆç™¾ç‚¼çŸ¥è¯†åº“</h5><pre><code class="yaml">çŸ¥è¯†åº“ï¼š
ã€å­¦æ ¡ç®€ä»‹ã€‘
é˜³å…‰ä¸­å­¦åˆ›å»ºäº1998å¹´ï¼Œæ˜¯ä¸€æ‰€å…¨æ—¥åˆ¶å¯„å®¿åˆ¶å®Œå…¨ä¸­å­¦ï¼Œåè½äºæ±Ÿè‹çœè‹å·å¸‚ã€‚å­¦æ ¡å åœ°120äº©ï¼Œç°æœ‰æ•™èŒå·¥120äººï¼Œå­¦ç”Ÿ1500ä½™äººã€‚å¤šå¹´æ¥ï¼Œé˜³å…‰ä¸­å­¦ç§‰æŒâ€œåšå¾·è½½ç‰©ï¼ŒçŸ¥è¡Œåˆä¸€â€çš„æ ¡è®­ï¼Œè‡´åŠ›äºåŸ¹å…»å…·æœ‰å›½é™…è§†é‡ä¸ä¸­å›½çµé­‚çš„å¤åˆå‹äººæ‰ã€‚
________________________________________
ã€è¯¾ç¨‹è®¾ç½®ã€‘
é˜³å…‰ä¸­å­¦è®¾æœ‰åˆä¸­å’Œé«˜ä¸­ä¸¤ä¸ªå­¦æ®µï¼Œå¼€è®¾è¯¾ç¨‹åŒ…æ‹¬è¯­æ–‡ã€æ•°å­¦ã€è‹±è¯­ã€ç‰©ç†ã€åŒ–å­¦ã€ç”Ÿç‰©ã€å†å²ã€åœ°ç†ã€æ”¿æ²»ã€ä¿¡æ¯æŠ€æœ¯ã€éŸ³ä¹ã€ç¾æœ¯å’Œä½“è‚²ç­‰ã€‚é«˜ä¸€å¼€å§‹åˆ†æ–‡ç†ç§‘æ–¹å‘ï¼ŒåŒæ—¶æä¾›é€‰ä¿®è¯¾ç¨‹å¦‚Pythonç¼–ç¨‹ã€äººå·¥æ™ºèƒ½åŸºç¡€ã€å•†åŠ¡è‹±è¯­ç­‰ï¼Œæ»¡è¶³å­¦ç”Ÿå¤šå…ƒå‘å±•éœ€æ±‚ã€‚
________________________________________
ã€å¸ˆèµ„åŠ›é‡ã€‘
å­¦æ ¡ç°æœ‰ç‰¹çº§æ•™å¸ˆ3äººï¼Œé«˜çº§æ•™å¸ˆ32äººï¼Œç¡•å£«å­¦å†ä»¥ä¸Šæ•™å¸ˆå æ¯”è¾¾70%ã€‚å…¶ä¸­è¯­æ–‡å­¦ç§‘å¸¦å¤´äººç‹è€å¸ˆæ›¾è·å…¨å›½è¯­æ–‡ä¼˜è´¨è¯¾ä¸€ç­‰å¥–ï¼Œæ•°å­¦ç»„ç»„é•¿æè€å¸ˆæ‹¥æœ‰15å¹´ä»¥ä¸Šé«˜ä¸‰æ•™å­¦ç»éªŒï¼Œå¤šæ¬¡å¸¦å‡ºçœçº§é«˜è€ƒçŠ¶å…ƒã€‚
________________________________________
ã€æ ¡å›­ç”Ÿæ´»ã€‘
é˜³å…‰ä¸­å­¦æ³¨é‡å­¦ç”Ÿå…¨é¢å‘å±•ï¼Œç»„ç»‡ä¸°å¯Œçš„è¯¾å¤–æ´»åŠ¨ä¸ç¤¾å›¢ï¼Œå¦‚æœºå™¨äººç¤¾ã€åˆå”±å›¢ã€è¾©è®ºç¤¾ã€æ‘„å½±ç¤¾ã€ç¯®çƒé˜Ÿç­‰ã€‚æ¯å¹´5æœˆä¸¾åŠæ ¡å›­è‰ºæœ¯èŠ‚ï¼Œæ¯å¹´10æœˆä¸¾è¡Œè¿åŠ¨ä¼šï¼Œæ·±å—å¸ˆç”Ÿå–œçˆ±ã€‚æ ¡å›­å†…æœ‰å›¾ä¹¦é¦†ã€è‡ªåŠ©é¤å…ã€åŒ»åŠ¡å®¤ã€å¿ƒç†å’¨è¯¢å®¤ç­‰å®Œå–„è®¾æ–½ã€‚
________________________________________
ã€æ ¡è§„åˆ¶åº¦ã€‘
1.    å­¦ç”Ÿå¿…é¡»ç©¿ç€æ ¡æœä¸Šè¯¾ï¼Œä¸å¾—è¿Ÿåˆ°ã€æ—©é€€æˆ–æ—·è¯¾ï¼›
2.    æ™šè‡ªä¹ æ—¶é—´ä¸ºæ¯å‘¨ä¸€è‡³å‘¨äº”18:30â€”20:30ï¼›
3.    ç¦æ­¢æºå¸¦æ‰‹æœºç­‰ç”µå­äº§å“è¿›è¯¾å ‚ï¼›
4.    ä¸¥ç¦åœ¨æ ¡å›­å†…æ‰“æ¶ã€å¸çƒŸã€å–é…’ï¼Œä¸€ç»å‘ç°ä¸¥è‚ƒå¤„ç†ï¼›
5.    æ¯æœˆè¯„é€‰â€œæ–‡æ˜ç­çº§â€â€œå­¦ä¹ æ ‡å…µâ€ç­‰è£èª‰ç§°å·ã€‚
________________________________________
ã€æ‹›ç”Ÿä¿¡æ¯ã€‘
é˜³å…‰ä¸­å­¦æ¯å¹´æ˜¥å­£å¼€å§‹æ‹›ç”Ÿï¼Œé¢å‘å…¨å›½æ‹›æ”¶åˆä¸€ã€é«˜ä¸€æ–°ç”Ÿã€‚æ‹›ç”Ÿåé¢æœ‰é™ï¼Œéœ€é€šè¿‡ç¬”è¯•å’Œé¢è¯•ã€‚å­¦è´¹æ ‡å‡†ä¸ºåˆä¸­éƒ¨æ¯å­¦æœŸ6000å…ƒï¼Œé«˜ä¸­éƒ¨æ¯å­¦æœŸ8000å…ƒï¼Œå¦è®¾æœ‰å¥–å­¦é‡‘ä¸åŠ©å­¦é‡‘æ”¿ç­–ï¼Œå®¶åº­å›°éš¾å­¦ç”Ÿå¯ç”³è¯·å‡å…ã€‚
________________________________________
ã€å¸¸è§é—®é¢˜è§£ç­”ã€‘
Qï¼šé˜³å…‰ä¸­å­¦æ˜¯å¦æä¾›ä½å®¿ï¼Ÿ
Aï¼šå­¦æ ¡æä¾›æ ‡å‡†åŒ–å­¦ç”Ÿå®¿èˆï¼Œ6äººä¸€é—´ï¼Œé…å¤‡ç©ºè°ƒã€çƒ­æ°´å™¨ä¸ç‹¬ç«‹å«ç”Ÿé—´ï¼Œè®¾æœ‰ç”Ÿæ´»è€å¸ˆç®¡ç†ã€‚
Qï¼šå­¦æ ¡æ˜¯å¦æä¾›è¥å…»é¤ï¼Ÿ
Aï¼šå­¦ç”Ÿé¤å…æä¾›ä¸‰é¤ï¼ŒåŒ…æ‹¬è¤ç´ æ­é…çš„è¥å…»å¥—é¤ï¼Œæ¯å‘¨å…¬å¸ƒèœå•ï¼Œç¡®ä¿å¥åº·å«ç”Ÿã€‚
Qï¼šå¦‚ä½•ç”³è¯·æ’ç­ï¼Ÿ
Aï¼šæ’ç­ç”Ÿéœ€åœ¨æ¯å­¦æœŸå¼€å­¦å‰ä¸€ä¸ªæœˆæäº¤ç”³è¯·ï¼Œå­¦æ ¡å°†æ ¹æ®å­¦ä½æƒ…å†µåŠè€ƒè¯•æˆç»©å†³å®šæ˜¯å¦å½•å–ã€‚
Qï¼šå­¦æ ¡å¯¹è‰ºæœ¯ä½“è‚²ç‰¹é•¿ç”Ÿæœ‰ä¼˜æƒ å—ï¼Ÿ
Aï¼šæ˜¯çš„ã€‚å­¦æ ¡æ¯å¹´æ‹›æ”¶éƒ¨åˆ†è‰ºæœ¯ã€ä½“è‚²ç‰¹é•¿ç”Ÿï¼Œå¯äº«å—é™åˆ†å½•å–åŠå¥–å­¦é‡‘æ”¿ç­–ã€‚
________________________________________
ã€æ ¡å›­çƒ­ç‚¹èµ„è®¯ã€‘
2025å¹´6æœˆï¼Œé˜³å…‰ä¸­å­¦é«˜è€ƒå†åˆ›ä½³ç»©ï¼Œé‡æœ¬ä¸Šçº¿ç‡è¾¾89%ï¼Œå…¶ä¸­7äººè¢«æ¸…ååŒ—å¤§å½•å–ï¼›
2025å¹´3æœˆï¼Œé˜³å…‰ä¸­å­¦å­¦ç”Ÿåœ¨å…¨å›½é’å°‘å¹´äººå·¥æ™ºèƒ½ç«èµ›ä¸­è·å¾—ä¸€ç­‰å¥–ï¼›
2024å¹´10æœˆï¼Œå­¦æ ¡æ–°å»ºç§‘å­¦æ¥¼æ­£å¼å¯ç”¨ï¼Œå»ºç­‘é¢ç§¯è¾¾4800å¹³æ–¹ç±³ï¼Œé…å¤‡å¤šä¸ªåŠŸèƒ½å®éªŒå®¤ã€‚
</code></pre>
<pre><code class="java">C:\Users\Pluminary\Desktop\HouDuan\ai-demo\bailian-agent\src\main\java\com\fox\bailianagent\controller\BailianAgentRagController.java
package com.fox.bailianagent.controller;

import com.alibaba.cloud.ai.dashscope.agent.DashScopeAgent;
import com.alibaba.cloud.ai.dashscope.agent.DashScopeAgentOptions;
import com.alibaba.cloud.ai.dashscope.api.DashScopeAgentApi;
import org.springframework.ai.chat.messages.AssistantMessage;
import org.springframework.ai.chat.model.ChatResponse;
import org.springframework.ai.chat.prompt.Prompt;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class BailianAgentRagController &#123;
  private DashScopeAgent agent;

  @Value(&quot;$&#123;spring.ai.dashscope.agent.app-id&#125;&quot;)
  private String appId;

  public BailianAgentRagController(DashScopeAgentApi dashscopeAgentApi) &#123;
    this.agent = new DashScopeAgent(dashscopeAgentApi);
  &#125;

  @GetMapping(&quot;/bailian/agent/call&quot;)
  public String call(@RequestParam(value = &quot;message&quot;) String message) &#123;
    ChatResponse response = agent.call(
            new Prompt(message, DashScopeAgentOptions.builder()
                    // ä¸æ™ºèƒ½ä½“çš„ç»‘å®š
                    .withAppId(appId)
                    .build()));
    AssistantMessage app_output = response.getResult().getOutput();
    return app_output.getText();
  &#125;
&#125;

GETï¼šhttp://localhost:8088/bailian/agent/call
message  å­¦æ ¡ç®€ä»‹æ˜¯ä»€ä¹ˆï¼Ÿ
</code></pre>
<pre><code class="java">package com.fox.bailianagent;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class BailianAgentApplication &#123;

    public static void main(String[] args) &#123;
        SpringApplication.run(BailianAgentApplication.class, args);
    &#125;
&#125;
</code></pre>
<pre><code class="yaml">server:
  port: 8088

spring:
  application:
    name: bailian-agent
  ai:
    dashscope:
      agent:
# https://bailian.console.aliyun.com/?tab=app#/app-center
        app-id: xxxxxxx
      api-key: xxxxxxx
</code></pre>
<h3 id="SpringAIAlibabaæœ¬åœ°é›†æˆç™¾ç‚¼çŸ¥è¯†åº“å®æˆ˜é€šè¿‡ä»£ç å°†æ–‡ä»¶ä¸Šä¼ åˆ°ç™¾ç‚¼çŸ¥è¯†åº“"><a href="#SpringAIAlibabaæœ¬åœ°é›†æˆç™¾ç‚¼çŸ¥è¯†åº“å®æˆ˜é€šè¿‡ä»£ç å°†æ–‡ä»¶ä¸Šä¼ åˆ°ç™¾ç‚¼çŸ¥è¯†åº“" class="headerlink" title="SpringAIAlibabaæœ¬åœ°é›†æˆç™¾ç‚¼çŸ¥è¯†åº“å®æˆ˜é€šè¿‡ä»£ç å°†æ–‡ä»¶ä¸Šä¼ åˆ°ç™¾ç‚¼çŸ¥è¯†åº“"></a>SpringAIAlibabaæœ¬åœ°é›†æˆç™¾ç‚¼çŸ¥è¯†åº“å®æˆ˜<del>é€šè¿‡ä»£ç å°†æ–‡ä»¶ä¸Šä¼ åˆ°ç™¾ç‚¼çŸ¥è¯†åº“</del></h3><pre><code class="java">/*
* Copyright 2024 the original author or authors.
*
* Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*      https://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

package com.fox.bailianragdemo.controller;

import com.fox.bailianragdemo.service.RagService;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import reactor.core.publisher.Flux;

@RestController
@RequestMapping(&quot;/ai&quot;)
public class CloudRagController &#123;

    private final RagService cloudRagService;

    public CloudRagController(RagService cloudRagService) &#123;
        this.cloudRagService = cloudRagService;
    &#125;

    @GetMapping(&quot;/bailian/knowledge/importDocument&quot;)
    public void importDocument() &#123;
        cloudRagService.importDocuments();
    &#125;

    @GetMapping(&quot;/bailian/knowledge/generate&quot;)
    public Flux&lt;String&gt; generate(@RequestParam(value = &quot;message&quot;,
            defaultValue = &quot;ä½ å¥½ï¼Œè¯·é—®ä½ çš„çŸ¥è¯†åº“æ–‡æ¡£ä¸»è¦æ˜¯å…³äºä»€ä¹ˆå†…å®¹çš„?&quot;) String message) &#123;
        return cloudRagService.retrieve(message).map(x -&gt; x.getResult().getOutput().getText());
    &#125;

&#125;
</code></pre>
<pre><code class="java">/*
* Copyright 2024 the original author or authors.
*
* Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*      https://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

package com.fox.bailianragdemo.service;

import com.alibaba.cloud.ai.advisor.DocumentRetrievalAdvisor;
import com.alibaba.cloud.ai.dashscope.api.DashScopeApi;
import com.alibaba.cloud.ai.dashscope.rag.*;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.model.ChatResponse;
import org.springframework.ai.document.Document;
import org.springframework.ai.document.DocumentReader;
import org.springframework.ai.rag.retrieval.search.DocumentRetriever;
import org.springframework.ai.vectorstore.VectorStore;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.core.io.Resource;
import org.springframework.stereotype.Service;
import reactor.core.publisher.Flux;

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.List;


@Service()
public class CloudRagService implements RagService &#123;

    private static final Logger logger = LoggerFactory.getLogger(CloudRagService.class);

    private static final String indexName = &quot;é˜³å…‰ä¸­å­¦&quot;;

    @Value(&quot;classpath:/data/spring_ai_alibaba_quickstart.pdf&quot;)
    private Resource springAiResource;

    private static final String retrievalSystemTemplate = &quot;&quot;&quot;
            ä¸Šä¸‹æ–‡ä¿¡æ¯å¦‚ä¸‹:
            ---------------------
            &#123;question_answer_context&#125;
            ---------------------
            æ ¹æ®ä¸Šä¸‹æ–‡å’Œæä¾›çš„å†å²ä¿¡æ¯ï¼Œè€Œä¸æ˜¯å…ˆéªŒçŸ¥è¯†,å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
            å¦‚æœç­”æ¡ˆä¸åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼Œè¯·å‘ŠçŸ¥ç”¨æˆ·æ— æ³•å›ç­”è¯¥é—®é¢˜ã€‚
            &quot;&quot;&quot;;

    private final ChatClient chatClient;

    private final DashScopeApi dashscopeApi;

    public CloudRagService(ChatClient.Builder builder, DashScopeApi dashscopeApi) &#123;
        DocumentRetriever retriever = new DashScopeDocumentRetriever(dashscopeApi,
                DashScopeDocumentRetrieverOptions.builder().withIndexName(indexName).build());

        this.dashscopeApi = dashscopeApi;
        this.chatClient = builder
                .defaultAdvisors(new DocumentRetrievalAdvisor(retriever, retrievalSystemTemplate))
                .build();
    &#125;

    @Override
    public void importDocuments() &#123;
        String path = saveToTempFile(springAiResource);

        // 1. import and split documents
        DocumentReader reader = new DashScopeDocumentCloudReader(path, dashscopeApi, null);
        List&lt;Document&gt; documentList = reader.get();
        logger.info(&quot;&#123;&#125; documents loaded and split&quot;, documentList.size());

        // 1. add documents to DashScope cloud storage å‘é‡æ•°æ®åº“
        VectorStore vectorStore = new DashScopeCloudStore(dashscopeApi, new DashScopeStoreOptions(indexName));
        vectorStore.add(documentList);
        logger.info(&quot;&#123;&#125; documents added to dashscope cloud vector store&quot;, documentList.size());
    &#125;

    private String saveToTempFile(Resource springAiResource) &#123;
        try &#123;
            File tempFile = File.createTempFile(&quot;spring_ai_alibaba_quickstart&quot;, &quot;.pdf&quot;);
            tempFile.deleteOnExit();

            try (InputStream inputStream = springAiResource.getInputStream();
                    FileOutputStream outputStream = new FileOutputStream(tempFile)) &#123;
                byte[] buffer = new byte[4096];
                int bytesRead;
                while ((bytesRead = inputStream.read(buffer)) != -1) &#123;
                    outputStream.write(buffer, 0, bytesRead);
                &#125;
            &#125;

            return tempFile.getAbsolutePath();
        &#125;
        catch (IOException e) &#123;
            throw new RuntimeException(e);
        &#125;
    &#125;

    public Flux&lt;ChatResponse&gt; retrieve(String message) &#123;
        return chatClient.prompt().user(message).stream().chatResponse();
    &#125;

&#125;
</code></pre>
<pre><code class="java">/*
* Copyright 2024 the original author or authors.
*
* Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*      https://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

package com.fox.bailianragdemo.service;

import org.springframework.ai.chat.model.ChatResponse;
import reactor.core.publisher.Flux;


public interface RagService &#123;

    void importDocuments();

    Flux&lt;ChatResponse&gt; retrieve(String message);
&#125;
</code></pre>
<pre><code class="yaml">server:
  port: 8088

spring:
  application:
    name: bailian-rag-demo
  ai:
    dashscope:
      api-key: xxxxx
</code></pre>
<h3 id="å·¥å…·Fuction-Calling"><a href="#å·¥å…·Fuction-Calling" class="headerlink" title="å·¥å…·Fuction Calling"></a>å·¥å…·Fuction Calling</h3><p>å…è®¸è¯­è¨€å¤§æ¨¡å‹è°ƒç”¨å¤–éƒ¨å‡½æ•°(Function)æˆ–APIæ¥æ‰§è¡Œç‰¹å®šä»»åŠ¡æˆ–è·å–å®æ—¶æ•°æ®ã€‚<br>ä¾‹å¦‚ï¼š<br>è°ƒç”¨å¤©æ°”APIæŸ¥è¯¢å®æ—¶å¤©æ°”ã€‚<br>è°ƒç”¨æ•°æ®åº“æ¥å£æ‰§è¡ŒæŸ¥è¯¢ã€‚ å…¶æ ¸å¿ƒæ˜¯æ‰©å±•æ¨¡å‹çš„äº¤äº’èƒ½åŠ›ï¼Œä½¿å…¶èƒ½æ‰§è¡Œæ“ä½œæˆ–è·å–ç»“æ„åŒ–æ•°æ®ï¼Œè€Œéä»…ä¾èµ–å†…éƒ¨çŸ¥è¯†</p>
<h6 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h6><p>å®æ—¶æ•°æ®æŸ¥è¯¢ï¼šå¦‚è‚¡ç¥¨è¡Œæƒ…ã€å¤©æ°”ã€èˆªç­ä¿¡æ¯ã€‚<br>ä»»åŠ¡è‡ªåŠ¨åŒ–ï¼šé¢„è®¢ä¼šè®®ã€ä¸‹å•ã€æ•°æ®è®¡ç®—ç­‰ã€‚<br>ç³»ç»Ÿé›†æˆï¼šä¸CRMã€ERPç­‰ä¸šåŠ¡ç³»ç»Ÿäº¤äº’ï¼ˆå¦‚åˆ›å»ºå®¢æˆ·è®°å½•ï¼‰</p>
<h6 id="å’ŒRAGçš„åŒºåˆ«"><a href="#å’ŒRAGçš„åŒºåˆ«" class="headerlink" title="å’ŒRAGçš„åŒºåˆ«"></a>å’ŒRAGçš„åŒºåˆ«</h6><p>RAGå’ŒFunction Callingåˆ†åˆ«ä»çŸ¥è¯†å¢å¼ºå’ŒåŠŸèƒ½æ‰©å±•ä¸¤ä¸ªç»´åº¦æå‡LLMèƒ½åŠ›ã€‚é€‰æ‹©å–å†³äºå…·ä½“éœ€æ±‚ï¼š</p>
<ul>
<li>éœ€ç»“åˆå¤–éƒ¨çŸ¥è¯†ï¼Ÿ â†’ RAG</li>
<li>éœ€æ‰§è¡Œæ“ä½œæˆ–è·å–å®æ—¶æ•°æ®ï¼Ÿ â†’ Function Calling</li>
<li>å¤æ‚åœºæ™¯ï¼šä¸¤è€…ç»“åˆï¼ˆå¦‚Agentæ¡†æ¶ä¸­é›†æˆRAGå’Œå·¥å…·è°ƒç”¨ï¼‰</li>
</ul>
<table>
<thead>
<tr>
<th align="center">ç»´åº¦</th>
<th align="center">RAG</th>
<th align="center">Function Calling</th>
</tr>
</thead>
<tbody><tr>
<td align="center">æ•°æ®ä¾èµ–</td>
<td align="center">ä¾èµ–å¤–éƒ¨çŸ¥è¯†åº“çš„è¦†ç›–å’Œè´¨é‡</td>
<td align="center">ä¾èµ–APIæˆ–å‡½æ•°çš„å¯ç”¨æ€§å’Œç¨³å®šæ€§</td>
</tr>
<tr>
<td align="center">å®æ—¶æ€§</td>
<td align="center">å—é™äºçŸ¥è¯†åº“æ›´æ–°é¢‘ç‡</td>
<td align="center">å¯è·å–å®æ—¶æ•°æ®(å¦‚APIè¿”å›ç»“æœ)</td>
</tr>
<tr>
<td align="center">è¾“å‡ºå½¢å¼</td>
<td align="center">è‡ªç„¶è¯­è¨€æ–‡æœ¬</td>
<td align="center">ç»“æ„åŒ–æ•°æ®(Json)æˆ–æ“ä½œç»“æœ</td>
</tr>
<tr>
<td align="center">é€‚ç”¨é—®é¢˜ç±»å‹</td>
<td align="center">éœ€å¤–éƒ¨çŸ¥è¯†æ”¯æŒçš„å¤æ‚é—®é¢˜</td>
<td align="center">éœ€æ‰§è¡Œæ“ä½œæˆ–è·å–åŠ¨æ€æ•°æ®çš„åœºæ™¯</td>
</tr>
<tr>
<td align="center">å®ç°å¤æ‚åº¦</td>
<td align="center">éœ€æ„å»ºé«˜æ•ˆæ£€ç´¢ç³»ç»Ÿ(å‘é‡æ•°æ®åº“)</td>
<td align="center">éœ€å®šä¹‰å‡½æ•°æ¥å£å’Œå‚æ•°è§„èŒƒ</td>
</tr>
</tbody></table>
<h3 id="Function-Callingè·å–å¤©æ°”ä¿¡æ¯"><a href="#Function-Callingè·å–å¤©æ°”ä¿¡æ¯" class="headerlink" title="Function Callingè·å–å¤©æ°”ä¿¡æ¯"></a>Function Callingè·å–å¤©æ°”ä¿¡æ¯</h3><h6 id="ä»¥Functionä¸ºæ¥å£è°ƒç”¨applyæ–¹æ³•"><a href="#ä»¥Functionä¸ºæ¥å£è°ƒç”¨applyæ–¹æ³•" class="headerlink" title="ä»¥Functionä¸ºæ¥å£è°ƒç”¨applyæ–¹æ³•"></a>ä»¥Functionä¸ºæ¥å£è°ƒç”¨applyæ–¹æ³•</h6><pre><code class="java">C:\Users\Pluminary\Desktop\HouDuan\ai-demo\toolcalling-demo\src\main\java\com\fox\toolcallingdemo\tool\weather\function\WeatherFunction.java

package com.fox.toolcallingdemo.tool.weather.function;

import java.util.function.Function;

public class WeatherFunction implements Function&lt;WeatherFunction.WeatherRequest, String&gt; &#123;
    @Override
    public String apply(WeatherRequest request) &#123;
        // æ­¤å¤„çœç•¥äº†å®é™…çš„å¤©æ°”æŸ¥è¯¢é€»è¾‘ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªç¤ºä¾‹å­—ç¬¦ä¸²
        // å®é™…åº”ç”¨ä¸­éœ€è¦æ ¹æ®è¯·æ±‚å‚æ•°è°ƒç”¨å¤©æ°”APIè·å–å¤©æ°”ä¿¡æ¯
        return &quot;The weather in &quot; + request.getCity() + &quot; is sunny.&quot;;
    &#125;
    public static class WeatherRequest &#123;
        private String city;
        public String getCity() &#123; return city; &#125;
        public void setCity(String city) &#123; this.city = city; &#125;
    &#125;
&#125;
</code></pre>
<h6 id="æŠŠå‡½æ•°ä»¥Beanå½¢å¼äº¤ç»™Springå»ç®¡ç†"><a href="#æŠŠå‡½æ•°ä»¥Beanå½¢å¼äº¤ç»™Springå»ç®¡ç†" class="headerlink" title="æŠŠå‡½æ•°ä»¥Beanå½¢å¼äº¤ç»™Springå»ç®¡ç†"></a>æŠŠå‡½æ•°ä»¥Beanå½¢å¼äº¤ç»™Springå»ç®¡ç†</h6><pre><code class="java">C:\Users\Pluminary\Desktop\HouDuan\ai-demo\toolcalling-demo\src\main\java\com\fox\toolcallingdemo\tool\weather\function\FunctionConfig.java
    
package com.fox.toolcallingdemo.tool.weather.function;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Description;

import java.util.function.Function;

@Configuration
public class FunctionConfig &#123;
    @Bean
    // æ ‡è¯†
    @Description(&quot;è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯&quot;)
    public Function&lt;WeatherFunction.WeatherRequest, String&gt; weatherFunction() &#123;
        return new WeatherFunction();
    &#125;
&#125;
</code></pre>
<h6 id="å‘Šè¯‰å¤§æ¨¡å‹è¯·æ±‚å¯ä»¥è°ƒå‡½æ•°"><a href="#å‘Šè¯‰å¤§æ¨¡å‹è¯·æ±‚å¯ä»¥è°ƒå‡½æ•°" class="headerlink" title="å‘Šè¯‰å¤§æ¨¡å‹è¯·æ±‚å¯ä»¥è°ƒå‡½æ•°"></a>å‘Šè¯‰å¤§æ¨¡å‹è¯·æ±‚å¯ä»¥è°ƒå‡½æ•°</h6><pre><code class="java">package com.fox.toolcallingdemo.controller;


import com.fox.toolcallingdemo.tool.weather.method.WeatherTool;
import com.fox.toolcallingdemo.tool.weather.method.WeatherToolImpl;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping(&quot;/weather&quot;)
public class WeatherController &#123;

    private final ChatClient dashScopeChatClient;

    /**
    * é»˜è®¤å…¨å±€è°ƒå‡½æ•°
    */
    public WeatherController(ChatClient.Builder chatClientBuilder) &#123;
        this.dashScopeChatClient = chatClientBuilder
                .defaultFunctions(&quot;weatherFunction&quot;)
                //.defaultTools(new WeatherToolImpl())
                .build();
    &#125;
-------------------------------------------------------------------------------------
    /**
     * æ— å·¥å…·ç‰ˆ
     */
    @GetMapping(&quot;/chat&quot;)
    public String simpleChat(@RequestParam(value = &quot;query&quot;, defaultValue = &quot;åŒ—äº¬ä»Šå¤©çš„å¤©æ°”&quot;) String query) &#123;
        return dashScopeChatClient.prompt(query).call().content();
    &#125;
-------------------------------------------------------------------------------------
    /**
     * è°ƒç”¨å·¥å…·ç‰ˆ - function
     */
    @GetMapping(&quot;/chat-tool-function&quot;)
    public String chatTranslateFunction(@RequestParam(value = &quot;query&quot;, defaultValue = &quot;åŒ—äº¬ä»Šå¤©çš„å¤©æ°”&quot;) String query) &#123;

    // å°±å¯ä»¥å»æ‰¾åˆšåˆšå‡½æ•°æ„å»ºçš„bean
        return dashScopeChatClient.prompt(query).functions(&quot;weatherFunction&quot;).call().content();
    &#125;

-------------------------------------------------------------------------------------

    /**
     * è°ƒç”¨å·¥å…·ç‰ˆ - method
     */
    @GetMapping(&quot;/chat-tool-method&quot;)
    public String chatTranslateMethod(@RequestParam(value = &quot;query&quot;, defaultValue = &quot;åŒ—äº¬ä»Šå¤©çš„å¤©æ°”&quot;) String query) &#123;

        return dashScopeChatClient.prompt(query).tools(new WeatherToolImpl()).call().content();
    &#125;
&#125;

GETï¼šhttp://localhost:8088/weather/chat-tool-method
query  æ·±åœ³ä»Šå¤©çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
</code></pre>
<h6 id="æ‰¿æ¥ä¸Šé¢æœ€åä¸€ä¸ªMethodç‰ˆ"><a href="#æ‰¿æ¥ä¸Šé¢æœ€åä¸€ä¸ªMethodç‰ˆ" class="headerlink" title="æ‰¿æ¥ä¸Šé¢æœ€åä¸€ä¸ªMethodç‰ˆ"></a>æ‰¿æ¥ä¸Šé¢æœ€åä¸€ä¸ªMethodç‰ˆ</h6><pre><code class="java">C:\Users\Pluminary\Desktop\HouDuan\ai-demo\toolcalling-demo\src\main\java\com\fox\toolcallingdemo\tool\weather\method\WeatherTool.java
package com.fox.toolcallingdemo.tool.weather.method;

public interface WeatherTool &#123;
    String getWeather(String city);
&#125;
</code></pre>
<pre><code class="java">C:\Users\Pluminary\Desktop\HouDuan\ai-demo\toolcalling-demo\src\main\java\com\fox\toolcallingdemo\tool\weather\method\WeatherToolImpl.java
package com.fox.toolcallingdemo.tool.weather.method;


import org.springframework.ai.tool.annotation.Tool;

public class WeatherToolImpl implements WeatherTool &#123;
    @Override
    @Tool(description = &quot;è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯ã€‚&quot;)
    public String getWeather(String city) &#123;
        return &quot;The weather in &quot; + city + &quot; is sunny.&quot;;
    &#125;
&#125;
</code></pre>
<h3 id="MCPåè®®"><a href="#MCPåè®®" class="headerlink" title="MCPåè®®"></a>MCPåè®®</h3><p>æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆå³ Model Context Protocolï¼ŒMCPï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾åè®®ï¼Œå®ƒè§„èŒƒäº†åº”ç”¨ç¨‹åºå¦‚ä½•å‘å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æä¾›ä¸Šä¸‹æ–‡ã€‚MCP æä¾›äº†ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼å°† AI æ¨¡å‹è¿æ¥åˆ°ä¸åŒçš„æ•°æ®æºå’Œå·¥å…·ï¼Œå®ƒå®šä¹‰äº†ç»Ÿä¸€çš„é›†æˆæ–¹å¼ã€‚</p>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/7ee928d5d4f2a3c021548c45f038914f81673875/SpringAI_MCP-2.png" alt="MCPå›¾+ä¸function_callingåŒºåˆ«"></p>
<h3 id="ç™¾ç‚¼æ™ºèƒ½ä½“åº”ç”¨æ¥å…¥é«˜å¾·åœ°å›¾MCPæœåŠ¡"><a href="#ç™¾ç‚¼æ™ºèƒ½ä½“åº”ç”¨æ¥å…¥é«˜å¾·åœ°å›¾MCPæœåŠ¡" class="headerlink" title="ç™¾ç‚¼æ™ºèƒ½ä½“åº”ç”¨æ¥å…¥é«˜å¾·åœ°å›¾MCPæœåŠ¡"></a>ç™¾ç‚¼æ™ºèƒ½ä½“åº”ç”¨æ¥å…¥é«˜å¾·åœ°å›¾MCPæœåŠ¡</h3><p><a target="_blank" rel="noopener" href="https://bailian.console.aliyun.com/?tab=app#/app-center/assistant/6f624944e0334768aa4d3a014f5a9913">å¤§æ¨¡å‹æœåŠ¡å¹³å°ç™¾ç‚¼æ§åˆ¶å°</a><br>åœ¨æ™ºèƒ½ä½“åº”ç”¨çš„<strong>æŠ€èƒ½</strong>æ·»åŠ <strong>MCPæœåŠ¡</strong> <code>Amap Maps</code>éœ€è¦æå‰å¼€é€šå³å¯</p>
<h3 id="MCPå¼€å‘å®æˆ˜"><a href="#MCPå¼€å‘å®æˆ˜" class="headerlink" title="MCPå¼€å‘å®æˆ˜"></a>MCPå¼€å‘å®æˆ˜</h3><h5 id="æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆModel-Context-Protocolï¼‰"><a href="#æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆModel-Context-Protocolï¼‰" class="headerlink" title="æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆModel Context Protocolï¼‰"></a>æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆModel Context Protocolï¼‰</h5><h5 id="MCP-ç®€ä»‹"><a href="#MCP-ç®€ä»‹" class="headerlink" title="MCP ç®€ä»‹"></a>MCP ç®€ä»‹</h5><p><a target="_blank" rel="noopener" href="https://modelcontextprotocol.io/">æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆå³ Model Context Protocolï¼ŒMCPï¼‰</a>æ˜¯ä¸€ä¸ªå¼€æ”¾åè®®ï¼Œå®ƒè§„èŒƒäº†åº”ç”¨ç¨‹åºå¦‚ä½•å‘å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æä¾›ä¸Šä¸‹æ–‡ã€‚MCP æä¾›äº†ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼å°† AI æ¨¡å‹è¿æ¥åˆ°ä¸åŒçš„æ•°æ®æºå’Œå·¥å…·ï¼Œå®ƒå®šä¹‰äº†ç»Ÿä¸€çš„é›†æˆæ–¹å¼ã€‚åœ¨å¼€å‘æ™ºèƒ½ä½“ï¼ˆAgentï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å°†å°†æ™ºèƒ½ä½“ä¸æ•°æ®å’Œå·¥å…·é›†æˆï¼ŒMCP ä»¥æ ‡å‡†çš„æ–¹å¼è§„èŒƒäº†æ™ºèƒ½ä½“ä¸æ•°æ®åŠå·¥å…·çš„é›†æˆæ–¹å¼ï¼Œå¯ä»¥å¸®åŠ©æ‚¨åœ¨ LLM ä¹‹ä¸Šæ„å»ºæ™ºèƒ½ä½“ï¼ˆAgentï¼‰å’Œå¤æ‚çš„å·¥ä½œæµã€‚ç›®å‰å·²ç»æœ‰å¤§é‡çš„æœåŠ¡æ¥å…¥å¹¶æä¾›äº† MCP server å®ç°ï¼Œå½“å‰è¿™ä¸ªç”Ÿæ€æ­£åœ¨ä»¥éå¸¸å¿«çš„é€Ÿåº¦ä¸æ–­çš„ä¸°å¯Œä¸­ï¼Œå…·ä½“å¯å‚è§ï¼š<a target="_blank" rel="noopener" href="https://github.com/modelcontextprotocol/servers">MCP Servers</a>ã€‚</p>
<h5 id="Spring-AI-MCP"><a href="#Spring-AI-MCP" class="headerlink" title="Spring AI MCP"></a>Spring AI MCP</h5><p>Spring AI MCP ä¸ºæ¨¡å‹ä¸Šä¸‹æ–‡åè®®æä¾› Java å’Œ Spring æ¡†æ¶é›†æˆã€‚å®ƒä½¿ Spring AI åº”ç”¨ç¨‹åºèƒ½å¤Ÿé€šè¿‡æ ‡å‡†åŒ–çš„æ¥å£ä¸ä¸åŒçš„æ•°æ®æºå’Œå·¥å…·è¿›è¡Œäº¤äº’ï¼Œæ”¯æŒåŒæ­¥å’Œå¼‚æ­¥é€šä¿¡æ¨¡å¼ã€‚</p>
<p>Spring AI MCP é‡‡ç”¨æ¨¡å—åŒ–æ¶æ„ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ç»„ä»¶ï¼š</p>
<ul>
<li>Spring AI åº”ç”¨ç¨‹åºï¼šä½¿ç”¨ Spring AI æ¡†æ¶æ„å»ºæƒ³è¦é€šè¿‡ MCP è®¿é—®æ•°æ®çš„ç”Ÿæˆå¼ AI åº”ç”¨ç¨‹åº</li>
<li>Spring MCP å®¢æˆ·ç«¯ï¼šMCP åè®®çš„ Spring AI å®ç°ï¼Œä¸æœåŠ¡å™¨ä¿æŒ 1:1 è¿æ¥</li>
<li>MCP æœåŠ¡å™¨ï¼šè½»é‡çº§ç¨‹åºï¼Œæ¯ä¸ªç¨‹åºéƒ½é€šè¿‡æ ‡å‡†åŒ–çš„æ¨¡å‹ä¸Šä¸‹æ–‡åè®®å…¬å¼€ç‰¹å®šçš„åŠŸèƒ½</li>
<li>æœ¬åœ°æ•°æ®æºï¼šMCP æœåŠ¡å™¨å¯ä»¥å®‰å…¨è®¿é—®çš„è®¡ç®—æœºæ–‡ä»¶ã€æ•°æ®åº“å’ŒæœåŠ¡</li>
<li>è¿œç¨‹æœåŠ¡ï¼šMCP æœåŠ¡å™¨å¯ä»¥é€šè¿‡äº’è”ç½‘ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ APIï¼‰è¿æ¥åˆ°çš„å¤–éƒ¨ç³»ç»Ÿ</li>
</ul>
<h2 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h2><p>è¦å¯ç”¨æ­¤åŠŸèƒ½ï¼Œè¯·å°†ä»¥ä¸‹ä¾èµ–é¡¹æ·»åŠ åˆ°æ‚¨é¡¹ç›®çš„ Maven<code>pom.xml</code>æ–‡ä»¶ä¸­ï¼š</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.experimental&lt;/groupId&gt;
    &lt;artifactId&gt;spring-ai-mcp&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>æˆ–è€…æ·»åŠ åˆ°æ‚¨çš„ Gradle<code>build.gradle</code>æ–‡ä»¶ä¸­ï¼š</p>
<pre><code class="xml">dependencies &#123;
    implementation &#39;org.springframework.experimental:spring-ai-mcp:1.0.0&#39;
&#125;
</code></pre>
<p>Spring AI MCP ç›®å‰å¹¶æ²¡æœ‰åœ¨ Maven Central Repository ä¸­æä¾›ã€‚éœ€è¦å°† <code>Spring milestone</code>ä»“åº“æ·»åŠ åˆ°<code>pom.xml</code>ä¸­ï¼Œæ‰å¯ä»¥è®¿é—® Spring AI MCP å·¥ä»¶ï¼š</p>
<pre><code class="xml">&lt;repositories&gt;
  &lt;repository&gt;
    &lt;id&gt;spring-milestones&lt;/id&gt;
    &lt;name&gt;Spring Milestones&lt;/name&gt;
    &lt;url&gt;https://repo.spring.io/libs-milestone-local&lt;/url&gt;
    &lt;snapshots&gt;
      &lt;enabled&gt;false&lt;/enabled&gt;
    &lt;/snapshots&gt;
  &lt;/repository&gt;
&lt;/repositories&gt;
</code></pre>
<p>è¦ä½¿ç”¨ MCPï¼Œé¦–å…ˆéœ€è¦åˆ›å»º<code>McpClient</code>ï¼Œå®ƒæä¾›äº†ä¸ MCP server çš„åŒæ­¥å’Œå¼‚æ­¥é€šä¿¡èƒ½åŠ›ã€‚ç°åœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª McpClient æ¥æ³¨å†Œ MCP Brave æœåŠ¡å’Œ ChatClientï¼Œä»è€Œè®© LLM è°ƒç”¨å®ƒä»¬ï¼š</p>
<pre><code class="java">var stdioParams = ServerParameters.builder(&quot;npx&quot;)
        .args(&quot;-y&quot;, &quot;@modelcontextprotocol/server-brave-search&quot;)
        .addEnvVar(&quot;BRAVE_API_KEY&quot;, System.getenv(&quot;BRAVE_API_KEY&quot;))
        .build();

var mcpClient = McpClient.using(new StdioClientTransport(stdioParams)).sync();

var init = mcpClient.initialize();

var chatClient = chatClientBuilder
        .defaultFunctions(mcpClient.listTools(null)
                .tools()
                .stream()
                .map(tool -&gt; new McpFunctionCallback(mcpClient, tool))
                .toArray(McpFunctionCallback[]::new))
        .build();

String response = chatClient
        .prompt(&quot;Does Spring AI supports the Model Context Protocol? Please provide some references.&quot;)
        .call().content();
</code></pre>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œé¦–å…ˆé€šè¿‡<code>npx</code>å‘½ä»¤å¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œè¿è¡Œ<code>@modelcontextprotocol/server-brave-search</code>æœåŠ¡ï¼Œå¹¶æŒ‡å®š Brave API å¯†é’¥ã€‚ç„¶ååˆ›å»ºä¸€ä¸ªåŸºäº stdio çš„ä¼ è¾“å±‚ï¼Œä¸ MCP server è¿›è¡Œé€šä¿¡ã€‚æœ€ååˆå§‹åŒ–ä¸ MCP æœåŠ¡å™¨çš„è¿æ¥ã€‚</p>
<p>è¦ä½¿ç”¨ McpClientï¼Œéœ€è¦å°†<code>McpClient</code>æ³¨å…¥åˆ° Spring AI çš„<code>ChatClient</code>ä¸­ï¼Œä»è€Œè®© LLM è°ƒç”¨ MCP serverã€‚åœ¨ Spring AI ä¸­ï¼Œå¯ä»¥é€šè¿‡ Function Callbacks çš„æ–¹å¼å°† MCP å·¥å…·è½¬æ¢ä¸º Spring AI çš„ Functionï¼Œä»è€Œè®© LLM è°ƒç”¨ã€‚</p>
<p>æœ€åï¼Œé€šè¿‡<code>ChatClient</code>ä¸ LLM è¿›è¡Œäº¤äº’ï¼Œå¹¶ä½¿ç”¨<code>McpClient</code>ä¸ MCP server è¿›è¡Œé€šä¿¡ï¼Œè·å–æœ€ç»ˆçš„è¿”å›ç»“æœã€‚</p>
<p><strong>å®˜æ–¹çš„alibabaæœåŠ¡æ•™å­¦</strong>ï¼š<code>C:\Users\Pluminary\Desktop\HouDuan\spring-ai-alibaba-examples</code></p>
<h5 id="Stdioä¼ è¾“å±‚"><a href="#Stdioä¼ è¾“å±‚" class="headerlink" title="Stdioä¼ è¾“å±‚"></a>Stdioä¼ è¾“å±‚</h5><p>Stdio(æ ‡å‡†è¾“å…¥è¾“å‡º) ä¼ è¾“å±‚æ˜¯MCPæœ€åŸºæœ¬çš„ä¼ è¾“å®ç°æ–¹å¼ã€‚å®ƒé€šè¿‡è¿›ç¨‹é—´é€šä¿¡(IPC)å®ç°</p>
<h5 id="SSEä¼ è¾“å±‚"><a href="#SSEä¼ è¾“å±‚" class="headerlink" title="SSEä¼ è¾“å±‚"></a>SSEä¼ è¾“å±‚</h5><p>SSE(Server-Sent Events) ä¼ è¾“å±‚æ˜¯åŸºäºHTTPçš„å•å‘é€šä¿¡æœºåˆ¶ï¼Œä¸“é—¨ç”¨äºæœåŠ¡å™¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®</p>
<h3 id="MCPæ˜¯ä»€ä¹ˆï¼Ÿå’ŒFunction-callingæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç¾å›¢é¢è¯•é¢˜"><a href="#MCPæ˜¯ä»€ä¹ˆï¼Ÿå’ŒFunction-callingæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç¾å›¢é¢è¯•é¢˜" class="headerlink" title="MCPæ˜¯ä»€ä¹ˆï¼Ÿå’ŒFunction callingæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç¾å›¢é¢è¯•é¢˜"></a>MCPæ˜¯ä»€ä¹ˆï¼Ÿå’ŒFunction callingæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<del>ç¾å›¢é¢è¯•é¢˜</del></h3><p>MCPå¯ä»¥é€šè¿‡ClientæŒ‡å®šSSE å†å»æ‰¾ä¸€ä¸ªè¿œç¨‹åœ°å€ç›´æ¥å°±å¯ä»¥è°ƒç”¨<del>MCPå°±åƒæ‹“å±•åï¼ŒMCPServerå¯ä»¥éƒ¨ç½²åˆ°äº‘ç«¯ç»™å¤–éƒ¨ä½¿ç”¨</del><br>Function Callingåˆ™éœ€è¦è‡ªå·±æ‰‹åŠ¨å»å†™ä¸€ä¸ªå»è°ƒç”¨å¤–éƒ¨</p>
<blockquote>
<p>è¿™é“é¢è¯•é¢˜é—®çš„æ˜¯ï¼š</p>
<blockquote>
<p><strong>MCP æ˜¯ä»€ä¹ˆï¼Ÿå®ƒå’Œ Function Calling æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p>
</blockquote>
<p>æ¥è‡ªç¾å›¢ï¼Œå¾ˆå¯èƒ½æ˜¯åœ¨è€ƒå¯Ÿä½ å¯¹ <strong>å¤§æ¨¡å‹åº”ç”¨æ¡†æ¶</strong>ï¼ˆå°¤å…¶æ˜¯ RAGã€å·¥å…·è°ƒç”¨ã€Agent æ¡†æ¶ç­‰ï¼‰åº•å±‚æœºåˆ¶çš„ç†è§£ï¼Œç‰¹åˆ«æ˜¯è¿‘å‡ å¹´é˜¿é‡Œæ¨å‡ºçš„ Spring AI Alibaba MCP æ¨¡å‹è°ƒç”¨æ¡†æ¶ã€‚</p>
<hr>
<h2 id="âœ…-ä¸€ã€ä»€ä¹ˆæ˜¯-MCPï¼Ÿ"><a href="#âœ…-ä¸€ã€ä»€ä¹ˆæ˜¯-MCPï¼Ÿ" class="headerlink" title="âœ… ä¸€ã€ä»€ä¹ˆæ˜¯ MCPï¼Ÿ"></a>âœ… ä¸€ã€ä»€ä¹ˆæ˜¯ MCPï¼Ÿ</h2><p><strong>MCPï¼ˆModel Call Protocolï¼‰</strong> æ˜¯é˜¿é‡Œå·´å·´åœ¨ <a target="_blank" rel="noopener" href="https://github.com/springaialibaba/spring-ai-alibaba">Spring AI Alibaba</a> æ¡†æ¶ä¸­æå‡ºçš„ä¸€ä¸ªæ¨¡å‹è°ƒç”¨åè®®ï¼Œå…¨ç§°æ˜¯ï¼š</p>
<blockquote>
<p><strong>Model Call Protocolï¼ˆæ¨¡å‹è°ƒç”¨åè®®ï¼‰</strong></p>
</blockquote>
<p>å®ƒçš„ä½œç”¨æ˜¯ï¼š<br> ğŸ”§ <strong>ç»Ÿä¸€æ¨¡å‹æ¥å…¥è§„èŒƒ</strong>ï¼Œä¸ºä¸åŒçš„å¤§æ¨¡å‹ï¼ˆé˜¿é‡Œé€šä¹‰ã€ç™¾åº¦æ–‡å¿ƒã€ChatGLMã€æ–‡ç”Ÿå›¾ã€å›¾ç”Ÿå›¾ç­‰ï¼‰æä¾›ä¸€å¥—<strong>é€šç”¨ã€æ ‡å‡†ã€ç»“æ„åŒ–çš„è°ƒç”¨åè®®å’Œæ‰©å±•æœºåˆ¶</strong>ã€‚</p>
<h3 id="âœ…-MCP-è§£å†³çš„é—®é¢˜ï¼š"><a href="#âœ…-MCP-è§£å†³çš„é—®é¢˜ï¼š" class="headerlink" title="âœ… MCP è§£å†³çš„é—®é¢˜ï¼š"></a>âœ… MCP è§£å†³çš„é—®é¢˜ï¼š</h3><ul>
<li>ğŸŒ€ ä¸åŒå¤§æ¨¡å‹è°ƒç”¨æ–¹å¼ã€å‚æ•°æ ¼å¼äº”èŠ±å…«é—¨ â†’ MCP æä¾›ç»Ÿä¸€æ¥å£æŠ½è±¡</li>
<li>ğŸ›  æ”¯æŒæ’ä»¶å·¥å…·è°ƒç”¨ï¼ˆTool Callingï¼‰</li>
<li>ğŸ” æ”¯æŒå¤šè½®å¯¹è¯è®°å¿†</li>
<li>ğŸ¤– æ”¯æŒ Agent æ¶æ„ï¼ˆä¾‹å¦‚ RAGã€Functionè°ƒç”¨ç­‰ï¼‰</li>
<li>ğŸ“¦ å¯ä»¥çµæ´»åˆ‡æ¢åº•å±‚å¤§æ¨¡å‹ï¼Œå®ç°æ¨¡å‹æ— æ„ŸçŸ¥è¿ç§»ï¼ˆä¾‹å¦‚å°†é€šä¹‰å¤§æ¨¡å‹æ— ç¼æ›¿æ¢ä¸ºæ–‡å¿ƒä¸€è¨€ï¼‰</li>
</ul>
<hr>
<h3 id="âœ…-MCP-çš„æ ¸å¿ƒç»„ä»¶ï¼š"><a href="#âœ…-MCP-çš„æ ¸å¿ƒç»„ä»¶ï¼š" class="headerlink" title="âœ… MCP çš„æ ¸å¿ƒç»„ä»¶ï¼š"></a>âœ… MCP çš„æ ¸å¿ƒç»„ä»¶ï¼š</h3><ol>
<li><code>MCPModel</code>ï¼šç»Ÿä¸€çš„æ¨¡å‹æ¥å£ï¼ˆå°è£…äº† prompt å¤„ç†ã€è°ƒç”¨é€»è¾‘ç­‰ï¼‰</li>
<li><code>MCPFunctionCallingModel</code>ï¼šæ”¯æŒ Function Calling çš„æ¨¡å‹</li>
<li><code>MCPMessage</code>ã€<code>MCPResponse</code>ï¼šç»Ÿä¸€çš„è¾“å…¥&#x2F;è¾“å‡ºæ•°æ®ç»“æ„</li>
<li><code>ToolDefinition</code>, <code>FunctionCall</code>, <code>ToolResult</code>ï¼šå¯¹å·¥å…·è°ƒç”¨ç»“æ„åŒ–å»ºæ¨¡</li>
</ol>
<hr>
<h2 id="âœ…-äºŒã€ä»€ä¹ˆæ˜¯-Function-Callingï¼Ÿ"><a href="#âœ…-äºŒã€ä»€ä¹ˆæ˜¯-Function-Callingï¼Ÿ" class="headerlink" title="âœ… äºŒã€ä»€ä¹ˆæ˜¯ Function Callingï¼Ÿ"></a>âœ… äºŒã€ä»€ä¹ˆæ˜¯ Function Callingï¼Ÿ</h2><p>Function Calling æ˜¯ç”± OpenAI æå‡ºçš„æŠ€æœ¯ï¼Œåè¢«å„å¤§æ¨¡å‹å‚å•†é‡‡çº³ï¼ˆå¦‚é€šä¹‰åƒé—®ã€ç™¾åº¦æ–‡å¿ƒä¹Ÿæ”¯æŒï¼‰ï¼Œå®ƒè®©å¤§æ¨¡å‹åœ¨å¯¹è¯ä¸­èƒ½å¤Ÿè°ƒç”¨å¤–éƒ¨å‡½æ•°ã€‚</p>
<h3 id="ğŸ”§-å®ƒçš„æ ¸å¿ƒæ¦‚å¿µï¼š"><a href="#ğŸ”§-å®ƒçš„æ ¸å¿ƒæ¦‚å¿µï¼š" class="headerlink" title="ğŸ”§ å®ƒçš„æ ¸å¿ƒæ¦‚å¿µï¼š"></a>ğŸ”§ å®ƒçš„æ ¸å¿ƒæ¦‚å¿µï¼š</h3><ul>
<li>å¤§æ¨¡å‹é€šè¿‡è¯†åˆ«è¯­ä¹‰å†…å®¹ï¼Œå†³å®šæ˜¯å¦è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼ˆä¾‹å¦‚æŸ¥å¤©æ°”ã€æŸ¥æ•°æ®åº“ã€ç”Ÿæˆå›¾ç‰‡ç­‰ï¼‰</li>
<li>ç”±ç”¨æˆ·é¢„å®šä¹‰å‡½æ•°åˆ—è¡¨ï¼ˆFunction Schemaï¼‰ï¼Œæ¨¡å‹æ ¹æ®æ„å›¾é€‰æ‹©è°ƒç”¨</li>
<li>è¿”å›ç»“æ„åŒ– JSON ç»™å¼€å‘è€…ï¼Œç”±ç¨‹åºè°ƒç”¨å®é™…å‡½æ•° â†’ æ‰§è¡Œåè¿”å›ç»“æœç»™æ¨¡å‹</li>
</ul>
<hr>
<h3 id="âœ…-Function-Calling-å®ç°çš„èƒ½åŠ›ï¼š"><a href="#âœ…-Function-Calling-å®ç°çš„èƒ½åŠ›ï¼š" class="headerlink" title="âœ… Function Calling å®ç°çš„èƒ½åŠ›ï¼š"></a>âœ… Function Calling å®ç°çš„èƒ½åŠ›ï¼š</h3><table>
<thead>
<tr>
<th>èƒ½åŠ›</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>å·¥å…·æ¥å…¥èƒ½åŠ›</td>
<td>è®©æ¨¡å‹â€œç”¨å·¥å…·â€å»æ‰©å±•çŸ¥è¯†æˆ–èƒ½åŠ›ï¼Œå¦‚æŸ¥èµ„æ–™ã€æŸ¥åº“å­˜ã€æ“ä½œç³»ç»Ÿç­‰</td>
</tr>
<tr>
<td>å¤šè½®è°ƒç”¨é“¾</td>
<td>æ”¯æŒè°ƒç”¨é“¾ç»„åˆï¼Œå¦‚ Aâ†’Bâ†’C çš„æµç¨‹å¼å·¥å…·ä½¿ç”¨</td>
</tr>
<tr>
<td>Agentèƒ½åŠ›åŸºç¡€</td>
<td>æ˜¯ Agent èƒ½å¤Ÿé“¾å¼æ€ç»´å’Œè®¡åˆ’ä»»åŠ¡æ‰§è¡Œçš„åŸºç¡€</td>
</tr>
</tbody></table>
<hr>
<h2 id="âœ…-ä¸‰ã€MCP-å’Œ-Function-Calling-çš„å…³ç³»ä¸åŒºåˆ«"><a href="#âœ…-ä¸‰ã€MCP-å’Œ-Function-Calling-çš„å…³ç³»ä¸åŒºåˆ«" class="headerlink" title="âœ… ä¸‰ã€MCP å’Œ Function Calling çš„å…³ç³»ä¸åŒºåˆ«"></a>âœ… ä¸‰ã€MCP å’Œ Function Calling çš„å…³ç³»ä¸åŒºåˆ«</h2><table>
<thead>
<tr>
<th>å¯¹æ¯”é¡¹</th>
<th>MCP</th>
<th>Function Calling</th>
</tr>
</thead>
<tbody><tr>
<td>æœ¬è´¨</td>
<td>ä¸€ç§å¤§æ¨¡å‹è°ƒç”¨<strong>åè®®æ ‡å‡†</strong></td>
<td>ä¸€ç§å¤§æ¨¡å‹çš„<strong>å·¥å…·è°ƒç”¨æœºåˆ¶</strong></td>
</tr>
<tr>
<td>æ˜¯å¦æ”¯æŒ Function</td>
<td>âœ… æ”¯æŒï¼ŒMCP ä¸­å†…ç½®äº† Function Calling æŠ½è±¡</td>
<td>âœ… åªå…³æ³¨â€œå‡½æ•°è°ƒç”¨â€ï¼Œä¸ç®¡æ¨¡å‹æ¥å…¥ç»†èŠ‚</td>
</tr>
<tr>
<td>ä½œç”¨èŒƒå›´</td>
<td>ğŸ“¦ æ¨¡å‹ç»Ÿä¸€å°è£…ã€RAGã€Chatã€å·¥å…·è°ƒç”¨ã€è®°å¿†ã€ä»£ç†ç­‰ï¼ˆæ•´ä¸ªè°ƒç”¨æ¡†æ¶ï¼‰</td>
<td>ğŸ§  æ¨¡å‹å¦‚ä½•è°ƒç”¨å‡½æ•°ã€å¦‚ä½•ç»„ç»‡å·¥å…·è¿”å›</td>
</tr>
<tr>
<td>æŠ½è±¡ç¨‹åº¦</td>
<td>é«˜åº¦æŠ½è±¡æ¡†æ¶å±‚ï¼Œç»Ÿä¸€è¾“å…¥è¾“å‡ºæ¨¡å‹ã€é€‚é…å„ç±»æ¨¡å‹</td>
<td>ç›¸å¯¹åº•å±‚ï¼Œæ˜¯å¤§æ¨¡å‹çš„<strong>åŠŸèƒ½ç‚¹</strong></td>
</tr>
<tr>
<td>ä½¿ç”¨è€…</td>
<td>å¼€å‘æ¡†æ¶ä½œè€…ï¼ˆå¦‚ Spring AI Alibabaï¼‰</td>
<td>æ¨¡å‹å‚å•†ã€åº”ç”¨å¼€å‘è€…</td>
</tr>
<tr>
<td>ä»£è¡¨é¡¹ç›®</td>
<td>Spring AI Alibaba MCPã€LangChain4j MCPã€ç™¾åº¦æ–‡å¿ƒ RAGFlow ç­‰</td>
<td>OpenAI GPTã€é€šä¹‰åƒé—®ã€ChatGLMã€Claude ç­‰æ”¯æŒ Function Calling çš„æ¨¡å‹</td>
</tr>
</tbody></table>
<hr>
<h2 id="âœ…-å››ã€é€šä¿—æ¯”å–»ç†è§£"><a href="#âœ…-å››ã€é€šä¿—æ¯”å–»ç†è§£" class="headerlink" title="âœ… å››ã€é€šä¿—æ¯”å–»ç†è§£"></a>âœ… å››ã€é€šä¿—æ¯”å–»ç†è§£</h2><blockquote>
<p>MCP æ˜¯ä¸€ä¸ªå¤§æ¥¼çš„ <strong>â€œæ€»æ§ä¸­å¿ƒâ€</strong>ï¼Œå¯ä»¥è°ƒé…å„ç§å¤§æ¨¡å‹ã€å·¥å…·ã€è®°å¿†ã€æ’ä»¶ç­‰èµ„æº</p>
<p>Function Calling æ˜¯è¿™ä¸ªå¤§æ¥¼é‡Œçš„ä¸€å¥— <strong>â€œæ™ºèƒ½å·¥å…·è°ƒåº¦ç³»ç»Ÿâ€</strong>ï¼Œä¸“é—¨å¤„ç†â€œè¿™ä¸ªè¯·æ±‚è¦ä¸è¦è°ƒç”¨æŸä¸ªå·¥å…·æ¥å®Œæˆâ€ã€‚</p>
</blockquote>
<hr>
<h2 id="âœ…-äº”ã€å®é™…åº”ç”¨ä¸¾ä¾‹ï¼ˆä»£ç å±‚ï¼‰"><a href="#âœ…-äº”ã€å®é™…åº”ç”¨ä¸¾ä¾‹ï¼ˆä»£ç å±‚ï¼‰" class="headerlink" title="âœ… äº”ã€å®é™…åº”ç”¨ä¸¾ä¾‹ï¼ˆä»£ç å±‚ï¼‰"></a>âœ… äº”ã€å®é™…åº”ç”¨ä¸¾ä¾‹ï¼ˆä»£ç å±‚ï¼‰</h2><p>åœ¨ Spring AI Alibaba ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ MCP + FunctionCallingï¼š</p>
<pre><code>@Autowired
private FunctionCallingChatClient chatClient;

@PostMapping(&quot;/chat&quot;)
public String chat(@RequestBody String prompt) &#123;
    Message response = chatClient.call(
        Message.of(prompt),
        FunctionCallingOptions.builder()
            .function(ToolDefinitions.fromClass(MyFunction.class))
            .build()
    );
    return response.getContent();
&#125;
</code></pre>
<p>ä¸Šé¢è¿™æ®µä»£ç ï¼š</p>
<ul>
<li>ä½¿ç”¨ MCP æä¾›çš„ <code>FunctionCallingChatClient</code> è°ƒç”¨å¤§æ¨¡å‹</li>
<li>ç»‘å®šäº†ä¸€ä¸ª Functionï¼ˆMyFunctionï¼‰ï¼Œæ¨¡å‹æ ¹æ®ä¸Šä¸‹æ–‡ä¼šè‡ªåŠ¨å†³å®šæ˜¯å¦è°ƒç”¨å®ƒ</li>
</ul>
<hr>
<h2 id="âœ…-æ€»ç»“ç­”æ³•ï¼ˆé¢è¯•ç®€æ˜è¯´æ³•ï¼‰ï¼š"><a href="#âœ…-æ€»ç»“ç­”æ³•ï¼ˆé¢è¯•ç®€æ˜è¯´æ³•ï¼‰ï¼š" class="headerlink" title="âœ… æ€»ç»“ç­”æ³•ï¼ˆé¢è¯•ç®€æ˜è¯´æ³•ï¼‰ï¼š"></a>âœ… æ€»ç»“ç­”æ³•ï¼ˆé¢è¯•ç®€æ˜è¯´æ³•ï¼‰ï¼š</h2><blockquote>
<p>MCP æ˜¯é˜¿é‡Œæ¨å‡ºçš„æ¨¡å‹è°ƒç”¨åè®®ï¼Œç»Ÿä¸€äº†æ¨¡å‹æ¥å…¥ã€å·¥å…·è°ƒç”¨ã€Agent è°ƒåº¦ç­‰èƒ½åŠ›ï¼Œæ˜¯ä¸€ç§é¢å‘â€œç»Ÿä¸€æ¨¡å‹å¼€å‘æ¡†æ¶â€çš„æŠ½è±¡ï¼›Function Calling æ˜¯å¤§æ¨¡å‹çš„ä¸€ç§èƒ½åŠ›ï¼Œå…è®¸å®ƒæ ¹æ®è¯­ä¹‰è°ƒç”¨ç»“æ„åŒ–å‡½æ•°ã€‚MCP åŒ…å«äº† Function Calling èƒ½åŠ›ï¼Œä½†å®ƒä½œç”¨æ›´å¹¿ï¼Œé¢å‘çš„æ˜¯æ•´å¥—å¤§æ¨¡å‹è°ƒç”¨ç”Ÿå‘½å‘¨æœŸï¼ŒFunction Calling åˆ™èšç„¦åœ¨â€œå¦‚ä½•è®©æ¨¡å‹ä½¿ç”¨å¤–éƒ¨å‡½æ•°â€è¿™ä»¶äº‹ä¸Šã€‚</p>
</blockquote>
</blockquote>
<h2 id="ç”µå•†æ™ºèƒ½å®¢æœé¡¹ç›®"><a href="#ç”µå•†æ™ºèƒ½å®¢æœé¡¹ç›®" class="headerlink" title="ç”µå•†æ™ºèƒ½å®¢æœé¡¹ç›®"></a><span style ="color:red">ç”µå•†æ™ºèƒ½å®¢æœé¡¹ç›®</span></h2><h5 id="å¼€å‘ç¯å¢ƒ"><a href="#å¼€å‘ç¯å¢ƒ" class="headerlink" title="å¼€å‘ç¯å¢ƒ"></a>å¼€å‘ç¯å¢ƒ</h5><p><code>JDK17ã€SpringBoot3.4.0ã€Spring AI 1.0.0-M6ã€Spring AI Alibaba 1.0.0-M6.1</code></p>
<h5 id="é¡¹ç›®èƒŒæ™¯"><a href="#é¡¹ç›®èƒŒæ™¯" class="headerlink" title="é¡¹ç›®èƒŒæ™¯"></a>é¡¹ç›®èƒŒæ™¯</h5><p><img src="https://raw.githubusercontent.com/P-luminary/images/105e0b2c60fafdf49943dd1fc8283011dacbc1fb/%E7%94%B5%E5%95%86%E6%99%BA%E8%83%BD%E5%AE%A2%E6%9C%8D%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF.png"></p>
<p><strong>é¡¹ç›®ä½äº</strong>ï¼š<code>C:\Users\Pluminary\Desktop\HouDuan\ai-demo\tlmall-ai</code><br><strong>å‰ç«¯</strong>ä½äºï¼š<code>C:\Users\Pluminary\Desktop\HouDuan\ai-demo\tlmall-ai\frontend</code></p>
<blockquote>
<p>å¯ä»¥å³é”®é€šè¿‡ç»ˆç«¯æ‰“å¼€æ–‡ä»¶å¤¹<br>â‘ ï¼šyarn install    å®‰è£…ä¾èµ–<br>â‘¡ï¼šyarn dev        å¯åŠ¨é¡¹ç›®</p>
</blockquote>
<p><strong>åç«¯</strong>ä½äºï¼š<code>C:\Users\Pluminary\Desktop\HouDuan\ai-demo\tlmall-order</code>ã€order.sqlä¹Ÿåœ¨è¿™é‡Œã€‘ï¼›<code>C:\Users\Pluminary\Desktop\HouDuan\ai-demo\tlmall-ai</code>åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªæ¨¡å—çš„<code>Application</code></p>
<h4 id="ä½¿ç”¨MCPè°ƒç”¨è®¢å•æœåŠ¡æŸ¥è¯¢è®¢å•è¯¦æƒ…MCPServeræ˜¯å¯¹è®¢å•å±‚çš„åŒ…è£…"><a href="#ä½¿ç”¨MCPè°ƒç”¨è®¢å•æœåŠ¡æŸ¥è¯¢è®¢å•è¯¦æƒ…MCPServeræ˜¯å¯¹è®¢å•å±‚çš„åŒ…è£…" class="headerlink" title="ä½¿ç”¨MCPè°ƒç”¨è®¢å•æœåŠ¡æŸ¥è¯¢è®¢å•è¯¦æƒ…MCPServeræ˜¯å¯¹è®¢å•å±‚çš„åŒ…è£…"></a>ä½¿ç”¨MCPè°ƒç”¨è®¢å•æœåŠ¡æŸ¥è¯¢è®¢å•è¯¦æƒ…<del>MCPServeræ˜¯å¯¹è®¢å•å±‚çš„åŒ…è£…</del></h4><p>é¡¹ç›®ä½äº<code>C:\Users\Pluminary\Desktop\HouDuan\ai-demo\tlmall-order-mcp-client</code>ï¼›<code>C:\Users\Pluminary\Desktop\HouDuan\ai-demo\tlmall-order-mcp-server</code><br><code>C:\Users\Pluminary\Desktop\HouDuan\ai-demo\tlmall-order</code></p>

    </div>

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <div id="comment">
        <div id="gitalk-container">
        </div>
    </div>
    
</div>
                     
<footer id="footer">
    <div class="footer-wrap">
        <div>
            Â© 2018 - 2026 P-luminary
            <span class="footer-icon">
                <a-icon type="flag" theme="filled" /></span>
            @Asuna
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a>
<!--         & <a target="_blank" rel="noopener" href="https://github.com/korilin/hexo-theme-particle">Particle Theme</a></div> -->
        
    </div>

</footer>

<script src="/js/highlight.min.js"></script>
<script src="/js/particle.js"></script>
                </div>
            </div>
        </transition>
    </div>

    <script>
    new Vue({
        el: "#layout",
        data: {
            show_page: false,
            onload_menu: false,
            menu_show: false,
            card_top: 100
        },
        created: function () {
            var that = this
            window.onload = function () {
                that.show_page = true
                document.getElementById("loadcontent").style.opacity = 0
                setTimeout(function () {
                    document.getElementById("loadleft").style.width = 0
                    document.getElementById("loadright").style.width = 0
                }, 300)
                setTimeout(function () {
                    document.getElementById("loading").style = "display:none"
                }, 600)
            }
        },
        mounted: function () {
            var that = this
            window.addEventListener('scroll', function (e) {
                that.menu_show = false
            })
        },
        methods: {
            home_click: function () {
                window.scrollTo({
                    top: window.innerHeight - 80,
                    behavior: "smooth",
                });
            }
        }
    })
</script>

<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
    const gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'hexo-theme-particle',      // The repository of store comments,
        owner: 'P-luminary',
        admin: ['P-luminary'],
        language: 'en',
        id: location.pathname,      // Ensure uniqueness and length less than 50
        distractionFreeMode: true  // Facebook-like distraction free mode
    })
    gitalk.render('gitalk-container')
</script>

</body>

</html>