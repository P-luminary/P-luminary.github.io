
<!DOCTYPE html>
<html lang="zh_CH ">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P-luminary || SpringAI-DeepSeek</title>
    <meta name="author" content="Asuna">
    <meta name="description" content=" ">
    <meta name="keywords" content=" ">
    <link rel="icon" href="/https://raw.githubusercontent.com/P-luminary/images/master/data/asuna.jpg">
    <link rel="stylesheet" href="/css/antd.min.css">
    
    <link rel="stylesheet" href="/css/maiden-theme.css">
    
    <script src="/js/vue.js"></script>
    <script src="/js/antd.min.js"></script>
<meta name="generator" content="Hexo 6.1.0"></head>

<body>

    <div id="loading"
        style="height: 100vh; width: 100%; position: fixed;display: flex;z-index: 200; justify-content: space-between;">
        <div id="loadleft" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div id="loadright" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div
            style="position: fixed; height: 100vh; width: 100%;display: flex;justify-content: center;align-items: center;">
            <div id="loadcontent"
                style="width:400px;height:400px;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px#a3ddfb; text-align:center;opacity:1;transition:opacity 0.3s ease-out;">
                <div>
                    <h2>LOADING...</h2>
                    <p>åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜(æµè§ˆå™¨é»˜è®¤å¼€å¯)</p>
                    <div>
                        <img src="/dancingkitty.gif" alt="loading">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="layout">
        <transition name="into">
            <div v-show="show_page" style="display: none;">
                <div id="menu_show">
                     
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">P-luminary</span>
        </a>
        
        <a href="/">
            <span>
                <a-icon type="home" theme="filled" />
            </span>
            <span>home</span>
        </a>
        
        <a href="/tags/è¯­æ³•">
            <span>
                <a-icon type="tags" theme="filled" />
            </span>
            <span>tags</span>
        </a>
        
    </div>

    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div :class="'title'" @click="menu_show=!menu_show">
            <span style="margin-right: 10px;">
                <a-icon type="appstore" theme="filled" />
            </span>
            <span>P-luminary</span>
        </div>
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="home" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">home</div>
                </div>
            </a>
            
            <a href="/tags/è¯­æ³•">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="tags" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">tags</div>
                </div>
            </a>
            
        </div>
        <div class="curtain" v-show="menu_show"></div>
    </div>

</nav>
                </div>

                <div id="main">
                     
<link rel="stylesheet" href="/css/post-body.css">
<div class="article">
    <div>
        <h1>SpringAI-DeepSeek </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <a-icon type="calendar" theme="filled" />
            </span>
            2025/7/8
        </span>

        

        

        <span class="tags">
            <span class="icon">
                <a-icon type="tags" theme="filled" />
            </span>
            
            <span class="tag">
                
                <a href="/tags/AI" style=color:#ff7d73>
                    AI
                </a>
            </span>
            
        </span>
        
    </div>

    <div class="content" v-pre>
        <h3 id="SpringAI-DeepSeek"><a href="#SpringAI-DeepSeek" class="headerlink" title="SpringAI + DeepSeek"></a>SpringAI + DeepSeek</h3><h6 id="JDKç‰ˆæœ¬æœ€ä½æ˜¯17"><a href="#JDKç‰ˆæœ¬æœ€ä½æ˜¯17" class="headerlink" title="JDKç‰ˆæœ¬æœ€ä½æ˜¯17"></a>JDKç‰ˆæœ¬æœ€ä½æ˜¯17</h6><h2 id="âœ…-å½“å‰ç¯å¢ƒæ€»ç»“"><a href="#âœ…-å½“å‰ç¯å¢ƒæ€»ç»“" class="headerlink" title="âœ… å½“å‰ç¯å¢ƒæ€»ç»“"></a>âœ… å½“å‰ç¯å¢ƒæ€»ç»“</h2><table>
<thead>
<tr>
<th>å·¥å…·</th>
<th>ç‰ˆæœ¬</th>
<th>æ˜¯å¦åˆé€‚</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Node.js</strong></td>
<td>20.12.0</td>
<td>âœ… å¾ˆå¥½</td>
<td>æ”¯æŒç°ä»£å‰ç«¯å·¥å…·ï¼ˆViteã€Reactã€Vue ç­‰ï¼‰</td>
</tr>
<tr>
<td><strong>npm</strong></td>
<td>10.5.0</td>
<td>âœ… å¾ˆå¥½</td>
<td>æœ€æ–°ç‰ˆæœ¬ï¼Œå…¼å®¹æ‰€æœ‰ä¾èµ–</td>
</tr>
<tr>
<td><strong>JDK</strong></td>
<td>20</td>
<td>âœ… è¶³å¤Ÿå­¦ä¹ </td>
<td>Spring Boot 3.x æ¨è JDK 17+ï¼ŒJDK 20 ä¹Ÿèƒ½ç”¨</td>
</tr>
<tr>
<td><strong>nvm</strong></td>
<td>1.2.2</td>
<td>âœ… æ¨èå·¥å…·</td>
<td>å¤šç‰ˆæœ¬åˆ‡æ¢å·²é…ç½®å¥½</td>
</tr>
</tbody></table>
<p>åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNaturalLanguage Processingï¼ŒNLPï¼‰ä¸­ï¼Œæœ‰ä¸€é¡¹å…³é”®æŠ€æœ¯å«Transformerï¼Œè¿™æ˜¯ä¸€ç§å…ˆè¿›çš„ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œæ˜¯ç°å¦‚ä»ŠAIé«˜é€Ÿå‘å±•çš„æœ€ä¸»è¦åŸå› ã€‚æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„å¤§æ¨¡å‹ï¼ˆLargeLanguageModelsï¼ŒLLMï¼‰ï¼Œä¾‹å¦‚GPTã€DeepSeekåº•å±‚éƒ½æ˜¯é‡‡ç”¨Transformerç¥ç»ç½‘ç»œæ¨¡å‹ã€‚</p>
<p>GPT ï¼ <strong>Generative</strong>(ç”Ÿæˆå¼:æ ¹æ®ä¸Šæ–‡é¢„æµ‹ä¹‹ååº”è¯¥å‡ºç°å“ªä¸ªæ–‡æœ¬ï¼Œä»è€Œå½¢æˆè¿ç»­çš„æ–‡æœ¬è¾“å‡º) <strong>Pre</strong>-<strong>trained</strong>(é¢„è®­ç»ƒ:é€šè¿‡å¤§è§„æ¨¡çš„æ–‡æœ¬æ•°æ®è¿›è¡Œé¢„è®­ç»ƒï¼Œè®©å¤§æ¨¡å‹å¯ä»¥ç†è§£äººç±»è¯­è¨€çš„è¯­æ³•ã€è¯æ€§ã€‚)  <strong>Transformer</strong>(Transformer:æ·±åº¦å­¦ä¹ çš„ä¸€ç§ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚å¤šæ•°AIGCæ¨¡å‹éƒ½ä¾èµ–äºæ­¤ã€‚)</p>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/358004f3a3dc66364f401112fe7403de2690b60b/%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF%E6%A1%86%E6%9E%B6.png"></p>
<h3 id="å¤§æ¨¡å‹åº”ç”¨å¼€å‘"><a href="#å¤§æ¨¡å‹åº”ç”¨å¼€å‘" class="headerlink" title="å¤§æ¨¡å‹åº”ç”¨å¼€å‘"></a>å¤§æ¨¡å‹åº”ç”¨å¼€å‘</h3><p>[å¤§æ¨¡å‹æœåŠ¡å¹³å°ç™¾ç‚¼æ§åˆ¶å°] (<a target="_blank" rel="noopener" href="https://bailian.console.aliyun.com/?tab=model#/api-key">https://bailian.console.aliyun.com/?tab=model#/api-key</a>)<br><code>ollama --help</code> å¸®åŠ©<br><code>ollama ps</code> æŸ¥çœ‹ç›®å‰å¯åŠ¨çš„æ¨¡å‹<br><code>ollama list</code> æŸ¥çœ‹æ‰€æœ‰æ¨¡å‹</p>
<p><code>POSTï¼šhttp://localhost:11434/api/chat</code></p>
<h6 id="Jsonè¯·æ±‚"><a href="#Jsonè¯·æ±‚" class="headerlink" title="Jsonè¯·æ±‚"></a>Jsonè¯·æ±‚</h6><pre><code class="json">&#123;
  &quot;model&quot;: &quot;deepseek-r1:1.5b&quot;,
  &quot;messages&quot;: [
    &#123;
      &quot;role&quot;: &quot;system&quot;,
      &quot;content&quot;: &quot;ä½ æ˜¯æµ·ç»µå®å®ï¼Œä»¥æµ·ç»µå®å®çš„èº«ä»½å›ç­”ç”¨æˆ·çš„é—®é¢˜&quot;
    &#125;,
    &#123;
      &quot;role&quot;: &quot;user&quot;,
      &quot;content&quot;: &quot;ä½ æ˜¯è°ï¼Ÿ&quot;
    &#125;
  ],
  &quot;stream&quot;: false
&#125;
</code></pre>
<h6 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h6><pre><code class="yaml">&#123;
    &quot;model&quot;: &quot;deepseek-r1:1.5b&quot;,
    &quot;created_at&quot;: &quot;2025-07-08T13:17:02.464149Z&quot;,
    &quot;message&quot;: &#123;
        &quot;role&quot;: &quot;assistant&quot;,
        &quot;content&quot;: &quot;&lt;think&gt;\næˆ‘æ˜¯æµ·ç»µå®å®ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªäº’åŠ¨å¼çš„è®¾å®šã€‚æˆ‘æ˜¯ä¸€ä¸ªAIåŠ©æ‰‹ï¼Œä¸»è¦æä¾›å¸®åŠ©å’Œä¿¡æ¯ã€‚æˆ‘ä¼šç”¨ç®€å•æ˜“æ‡‚çš„è¯­è¨€å›ç­”é—®é¢˜ï¼Œå¹¶ä¿æŒå‹å¥½äº¤æµã€‚\n&lt;/think&gt;\n\næˆ‘æ˜¯æµ·ç»µå®å®ï¼Œè¿™æ˜¯ä¸€ä¸ªç”±æ·±åº¦æ±‚ç´¢å…¬å¸å¼€å‘çš„æœºå™¨äººåŠ©æ‰‹ï¼Œä¸»è¦ç”¨äºæä¾›ä¿¡æ¯ã€å¸®åŠ©è§£ç­”é—®é¢˜ç­‰æ—¥å¸¸éœ€æ±‚æœåŠ¡ã€‚æˆ‘ä»¥ç®€å•çš„è¯­æ°”å’Œå‹å¥½çš„æ€åº¦ä¸ç”¨æˆ·æ²Ÿé€šï¼Œæ‚¨çš„æé—®å°†è¢«è®¤çœŸè€ƒè™‘å¹¶å°½å¿«å›åº”ã€‚&quot;
    &#125;,
    &quot;done_reason&quot;: &quot;stop&quot;,
    &quot;done&quot;: true,
    &quot;total_duration&quot;: 821012000,
    &quot;load_duration&quot;: 14152500,
    &quot;prompt_eval_count&quot;: 17,
    &quot;prompt_eval_duration&quot;: 3000000,
    &quot;eval_count&quot;: 88,
    &quot;eval_duration&quot;: 802000000
&#125;
</code></pre>
<h2 id="LLMã€FunctionCallingã€RAGé€šä¿—è®²è§£"><a href="#LLMã€FunctionCallingã€RAGé€šä¿—è®²è§£" class="headerlink" title="LLMã€FunctionCallingã€RAGé€šä¿—è®²è§£"></a><span style = "color:red">LLMã€FunctionCallingã€RAGé€šä¿—è®²è§£</span></h2><blockquote>
<h2 id="ğŸ§ -ä¸€ã€LLM-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ğŸ§ -ä¸€ã€LLM-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ğŸ§  ä¸€ã€LLM æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ğŸ§  ä¸€ã€LLM æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>LLM æ˜¯ â€œ<strong>Large Language Model</strong>â€ çš„ç¼©å†™ï¼Œä¸­æ–‡å«â€œ<strong>å¤§è¯­è¨€æ¨¡å‹</strong>â€ï¼Œæ¯”å¦‚ä½ æ­£åœ¨ç”¨çš„ ChatGPT å°±æ˜¯ä¸€ä¸ª LLMã€‚</p>
<h3 id="ğŸŒ°-ä¸¾ä¸ªä¾‹å­ï¼š"><a href="#ğŸŒ°-ä¸¾ä¸ªä¾‹å­ï¼š" class="headerlink" title="ğŸŒ° ä¸¾ä¸ªä¾‹å­ï¼š"></a>ğŸŒ° ä¸¾ä¸ªä¾‹å­ï¼š</h3><p>ä½ è¾“å…¥ä¸€å¥è¯ï¼šâ€œæˆ‘æ˜å¤©è¦å»åŒ—äº¬ï¼Œå¤©æ°”æ€ä¹ˆæ ·ï¼Ÿâ€</p>
<p>LLM ä¼šç†è§£ä½ çš„æ„æ€ï¼Œç„¶åç»™ä½ ä¸€ä¸ªåƒäººè¯´è¯ä¸€æ ·çš„å›ç­”ï¼Œæ¯”å¦‚ï¼šâ€œæ˜å¤©åŒ—äº¬æ™´å¤©ï¼Œæ°”æ¸©25åº¦ï¼Œé€‚åˆå‡ºè¡Œã€‚â€</p>
<h3 id="âœ…-å®ƒèƒ½åšçš„äº‹æƒ…æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š"><a href="#âœ…-å®ƒèƒ½åšçš„äº‹æƒ…æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š" class="headerlink" title="âœ… å®ƒèƒ½åšçš„äº‹æƒ…æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š"></a>âœ… å®ƒèƒ½åšçš„äº‹æƒ…æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š</h3><ul>
<li>å›ç­”é—®é¢˜</li>
<li>å†™æ–‡ç« </li>
<li>ç¿»è¯‘è¯­è¨€</li>
<li>æ€»ç»“æ–‡æœ¬</li>
<li>å†™ä»£ç â€¦â€¦</li>
</ul>
<p>å®ƒçš„èƒ½åŠ›æ¥è‡ªï¼š<strong>è®­ç»ƒäº†æµ·é‡çš„æ–‡æœ¬æ•°æ®</strong>ï¼Œå¹¶é€šè¿‡é¢„æµ‹â€œä¸‹ä¸€ä¸ªè¯â€æ¥ç”Ÿæˆè‡ªç„¶è¯­è¨€ã€‚</p>
<hr>
<h2 id="ğŸ§©-äºŒã€Function-Calling-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ğŸ§©-äºŒã€Function-Calling-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ğŸ§© äºŒã€Function Calling æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ğŸ§© äºŒã€Function Calling æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Function Callingï¼ˆå‡½æ•°è°ƒç”¨ï¼‰æ˜¯ LLM çš„ä¸€ä¸ªå¢å¼ºèƒ½åŠ›ï¼Œè®©å®ƒåœ¨å›ç­”é—®é¢˜æ—¶<strong>ä¸å…‰æ˜¯â€œè¯´â€ï¼Œè¿˜èƒ½â€œåšâ€äº‹</strong>ã€‚</p>
<h3 id="ğŸŒ°-ä¸¾ä¸ªä¾‹å­ï¼š-1"><a href="#ğŸŒ°-ä¸¾ä¸ªä¾‹å­ï¼š-1" class="headerlink" title="ğŸŒ° ä¸¾ä¸ªä¾‹å­ï¼š"></a>ğŸŒ° ä¸¾ä¸ªä¾‹å­ï¼š</h3><p>ä½ è¯´ï¼šâ€œå¸®æˆ‘æŸ¥ä¸€ä¸‹æ˜å¤©åŒ—äº¬çš„å¤©æ°”ã€‚â€</p>
<p>è¿‡å» LLM åªèƒ½â€œçŒœâ€ä¸€ä¸ªç­”æ¡ˆã€‚ä½†å¦‚æœå®ƒå…·å¤‡ <strong>Function Calling</strong> èƒ½åŠ›ï¼Œå®ƒå°±å¯ä»¥ï¼š</p>
<ol>
<li><strong>è°ƒç”¨ä¸€ä¸ªçœŸå®çš„å¤©æ°”æŸ¥è¯¢å‡½æ•°</strong>ï¼ˆæ¯”å¦‚è®¿é—®å¤©æ°”APIï¼‰</li>
<li>å¾—åˆ°çœŸå®çš„å¤©æ°”æ•°æ®ï¼ˆæ¯”å¦‚ï¼šæ™´ 25Â°Cï¼‰</li>
<li>å†æŠŠè¿™ä¸ªæ•°æ®ç”Ÿæˆä¸€å¥è¯å‘Šè¯‰ä½ ã€‚</li>
</ol>
<h3 id="âœ…-é€šä¿—å¯¹æ¯”ï¼š"><a href="#âœ…-é€šä¿—å¯¹æ¯”ï¼š" class="headerlink" title="âœ… é€šä¿—å¯¹æ¯”ï¼š"></a>âœ… é€šä¿—å¯¹æ¯”ï¼š</h3><table>
<thead>
<tr>
<th>æ–¹å¼</th>
<th>ç±»æ¯”</th>
</tr>
</thead>
<tbody><tr>
<td>ä»¥å‰çš„ LLM</td>
<td>ä¼šè¯´è¯çš„äººï¼Œä½†æ‰‹ä¸èƒ½åŠ¨</td>
</tr>
<tr>
<td>æ”¯æŒ Function Calling çš„ LLM</td>
<td>ä¼šè¯´è¯çš„äººï¼Œè¿˜èƒ½æ“ä½œç”µè„‘å¸®ä½ æŸ¥èµ„æ–™ã€è®¢ç¥¨ã€åšè®¡ç®—</td>
</tr>
</tbody></table>
<h2 id="ğŸ§ -æ€»ç»“ä¸€ä¸‹"><a href="#ğŸ§ -æ€»ç»“ä¸€ä¸‹" class="headerlink" title="ğŸ§  æ€»ç»“ä¸€ä¸‹"></a>ğŸ§  æ€»ç»“ä¸€ä¸‹</h2><table>
<thead>
<tr>
<th>æ¦‚å¿µ</th>
<th>é€šä¿—è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td><strong>LLM</strong></td>
<td>ä¸€ä¸ªè¶…çº§èªæ˜ã€ä¼šè¯´è¯çš„ AIï¼ˆåƒ ChatGPTï¼‰</td>
</tr>
<tr>
<td><strong>Function Calling</strong></td>
<td>è®©è¿™ä¸ª AI ä¸åªæ˜¯â€œè¯´è¯â€ï¼Œè¿˜èƒ½â€œè°ƒç”¨å·¥å…·â€å¸®ä½ å®Œæˆä»»åŠ¡</td>
</tr>
</tbody></table>
<hr>
<hr>
<h2 id="ğŸ§ -ä¸€ã€RAG-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ğŸ§ -ä¸€ã€RAG-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ğŸ§  ä¸€ã€RAG æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ğŸ§  ä¸€ã€RAG æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>RAG æ˜¯ â€œ<strong>Retrieval-Augmented Generation</strong>â€ çš„ç¼©å†™ï¼Œä¸­æ–‡å« â€œ<strong>æ£€ç´¢å¢å¼ºç”Ÿæˆ</strong>â€ã€‚</p>
<p>å®ƒæ˜¯ä¸€ç§è®© LLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰æ›´èªæ˜çš„æ–¹å¼ â€”â€” <strong>æŠŠå¤–éƒ¨çŸ¥è¯†å–‚ç»™å®ƒï¼Œç„¶åè®©å®ƒç”Ÿæˆç­”æ¡ˆã€‚</strong></p>
<h3 id="ğŸ“š-ä¸ºä»€ä¹ˆéœ€è¦-RAGï¼Ÿ"><a href="#ğŸ“š-ä¸ºä»€ä¹ˆéœ€è¦-RAGï¼Ÿ" class="headerlink" title="ğŸ“š ä¸ºä»€ä¹ˆéœ€è¦ RAGï¼Ÿ"></a>ğŸ“š ä¸ºä»€ä¹ˆéœ€è¦ RAGï¼Ÿ</h3><p>LLM è™½ç„¶å¾ˆå‰å®³ï¼Œä½†å®ƒçš„â€œçŸ¥è¯†â€éƒ½æ˜¯<strong>è®­ç»ƒæ—¶å­¦çš„</strong>ï¼Œä¸èƒ½å®æ—¶æ›´æ–°ã€‚<br> æ¯”å¦‚å®ƒä¸çŸ¥é“ä½ å…¬å¸å†…éƒ¨çš„æ•°æ®ã€ä½ æ˜¨å¤©å†™çš„æ–‡æ¡£ã€ä½ è‡ªå·±çš„ç¬”è®°â€¦â€¦</p>
<p>è¿™æ—¶å€™ï¼Œ<strong>RAGå°±ç™»åœºäº†</strong>ï¼</p>
<h2 id="ğŸ§©-äºŒã€RAG-çš„æ ¸å¿ƒæ€æƒ³ï¼ˆé€šä¿—ç†è§£ï¼‰"><a href="#ğŸ§©-äºŒã€RAG-çš„æ ¸å¿ƒæ€æƒ³ï¼ˆé€šä¿—ç†è§£ï¼‰" class="headerlink" title="ğŸ§© äºŒã€RAG çš„æ ¸å¿ƒæ€æƒ³ï¼ˆé€šä¿—ç†è§£ï¼‰"></a>ğŸ§© äºŒã€RAG çš„æ ¸å¿ƒæ€æƒ³ï¼ˆé€šä¿—ç†è§£ï¼‰</h2><h3 id="ğŸ“¦-å®ƒå…¶å®åˆ†ä¸¤æ­¥ï¼š"><a href="#ğŸ“¦-å®ƒå…¶å®åˆ†ä¸¤æ­¥ï¼š" class="headerlink" title="ğŸ“¦ å®ƒå…¶å®åˆ†ä¸¤æ­¥ï¼š"></a>ğŸ“¦ å®ƒå…¶å®åˆ†ä¸¤æ­¥ï¼š</h3><h4 id="ç¬¬ä¸€æ­¥ï¼šRetrievalï¼ˆæ£€ç´¢ï¼‰"><a href="#ç¬¬ä¸€æ­¥ï¼šRetrievalï¼ˆæ£€ç´¢ï¼‰" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šRetrievalï¼ˆæ£€ç´¢ï¼‰"></a>ç¬¬ä¸€æ­¥ï¼šRetrievalï¼ˆæ£€ç´¢ï¼‰</h4><p>ä»ä½ æä¾›çš„â€œçŸ¥è¯†åº“â€é‡Œï¼ŒæŠŠå’Œé—®é¢˜ç›¸å…³çš„å†…å®¹æ‰¾å‡ºæ¥ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<blockquote>
<p>é—®é¢˜æ˜¯ï¼šâ€œJavaä¸­çº¿ç¨‹æ± çš„å·¥ä½œåŸç†ï¼Ÿâ€</p>
<p>æ£€ç´¢æ¨¡å—ä¼šä»ä½ çŸ¥è¯†åº“ä¸­æ‰¾å‡ºï¼šâ€œJavaçº¿ç¨‹æ± ä½¿ç”¨Executoræ¡†æ¶ï¼Œåˆ†ä¸ºæ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€é˜Ÿåˆ—â€¦â€¦â€è¿™ç±»å†…å®¹ã€‚</p>
</blockquote>
<h4 id="ç¬¬äºŒæ­¥ï¼šGenerationï¼ˆç”Ÿæˆï¼‰"><a href="#ç¬¬äºŒæ­¥ï¼šGenerationï¼ˆç”Ÿæˆï¼‰" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šGenerationï¼ˆç”Ÿæˆï¼‰"></a>ç¬¬äºŒæ­¥ï¼šGenerationï¼ˆç”Ÿæˆï¼‰</h4><p>ç„¶åæŠŠä¸Šé¢æ‰¾å‡ºæ¥çš„å†…å®¹ï¼Œ<strong>äº¤ç»™ LLMï¼Œè®©å®ƒæ ¹æ®è¿™äº›å†…å®¹ç”Ÿæˆç­”æ¡ˆã€‚</strong></p>
<h2 id="ğŸŒ°-ä¸¾ä¸ªé€šä¿—ä¾‹å­ï¼š"><a href="#ğŸŒ°-ä¸¾ä¸ªé€šä¿—ä¾‹å­ï¼š" class="headerlink" title="ğŸŒ° ä¸¾ä¸ªé€šä¿—ä¾‹å­ï¼š"></a>ğŸŒ° ä¸¾ä¸ªé€šä¿—ä¾‹å­ï¼š</h2><p>ä½ é—® ChatGPTï¼šâ€œæˆ‘ä»¬å…¬å¸æ˜å¤©å‡ ç‚¹å¼€ä¼šï¼Ÿâ€</p>
<h3 id="æ™®é€š-LLMï¼š"><a href="#æ™®é€š-LLMï¼š" class="headerlink" title="æ™®é€š LLMï¼š"></a>æ™®é€š LLMï¼š</h3><p>â€œæˆ‘ä¸çŸ¥é“ä½ ä»¬å…¬å¸æ˜¯è°ï¼Œä¹Ÿä¸çŸ¥é“ä½ ä»¬çš„ä¼šè®®å®‰æ’ã€‚â€</p>
<h3 id="RAG-æ¨¡å¼ä¸‹ï¼š"><a href="#RAG-æ¨¡å¼ä¸‹ï¼š" class="headerlink" title="RAG æ¨¡å¼ä¸‹ï¼š"></a>RAG æ¨¡å¼ä¸‹ï¼š</h3><ol>
<li>æ£€ç´¢æ¨¡å—ï¼šå»ä½ å…¬å¸çŸ¥è¯†åº“ã€æ—¥å†ã€OA ç³»ç»ŸæŸ¥æ‰¾ï¼Œå‘ç°ä½ éƒ¨é—¨æ˜å¤©æœ‰ä¸ªä¼šè®®ï¼Œ9ç‚¹ã€‚</li>
<li>ç„¶å LLM ç”¨è¿™ä¸ªä¿¡æ¯è¯´ï¼šâ€œä½ ä»¬å…¬å¸æ˜å¤©æ—©ä¸Š 9 ç‚¹æœ‰ä¸ªéƒ¨é—¨ä¼šè®®ã€‚â€</li>
</ol>
</blockquote>
<h4 id="AIåº”ç”¨å¼€å‘æŠ€æœ¯æ¡†æ¶"><a href="#AIåº”ç”¨å¼€å‘æŠ€æœ¯æ¡†æ¶" class="headerlink" title="AIåº”ç”¨å¼€å‘æŠ€æœ¯æ¡†æ¶"></a>AIåº”ç”¨å¼€å‘æŠ€æœ¯æ¡†æ¶</h4><h5 id="PARF"><a href="#PARF" class="headerlink" title="PARF"></a>PARF</h5><ul>
<li><strong>çº¯Prompté—®ç­”</strong>ï¼šåˆ©ç”¨å¤§æ¨¡å‹çš„æ¨ç†èƒ½åŠ›ï¼Œé€šè¿‡Promptæé—®æ¥å®Œæˆä¸šåŠ¡</li>
<li><strong>Agent + Function Calling</strong>ï¼šAIæ‹†è§£ä»»åŠ¡ï¼Œè°ƒç”¨ä¸šåŠ¡ç«¯æä¾›çš„æ¥å£å®ç°å¤æ‚ä¸šåŠ¡</li>
<li><strong>RAG</strong>ï¼šç»™å¤§æ¨¡å‹å¤–æŒ‚ä¸€ä¸ªçŸ¥è¯†åº“ï¼Œè®©å¤§æ¨¡å‹åŸºäºçŸ¥è¯†åº“çš„å†…å®¹åšæ¨ç†å’Œå›ç­”</li>
<li><strong>Fine-tuning</strong>ï¼šé’ˆå¯¹ç‰¹æœ‰ä¸šåŠ¡åœºæ™¯å¯¹åŸºç¡€å¤§æ¨¡å‹åšæ•°æ®è®­ç»ƒå’Œå¾®è°ƒï¼Œä»¥æ»¡è¶³ç‰¹å®šåœºæ™¯çš„éœ€æ±‚</li>
</ul>
<h3 id="âœ…-Spring-AI-vs-LangChain4j-å¯¹æ¯”è¡¨æ ¼"><a href="#âœ…-Spring-AI-vs-LangChain4j-å¯¹æ¯”è¡¨æ ¼" class="headerlink" title="âœ… Spring AI vs LangChain4j å¯¹æ¯”è¡¨æ ¼"></a>âœ… Spring AI vs LangChain4j å¯¹æ¯”è¡¨æ ¼</h3><table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th><strong>Spring AI</strong></th>
<th><strong>LangChain4j</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>é¡¹ç›®å®šä½</strong></td>
<td>Spring å®˜æ–¹æ”¯æŒçš„ AI æ¡†æ¶ï¼Œå¼ºè°ƒä¸ Spring ç”Ÿæ€é›†æˆ</td>
<td>Java ç‰ˆ LangChainï¼Œé¢å‘ LLM åº”ç”¨æ„å»ºçš„ç»„ä»¶å¼æ¡†æ¶</td>
</tr>
<tr>
<td><strong>æ¡†æ¶é£æ ¼</strong></td>
<td>é…ç½®é©±åŠ¨ã€Spring Boot é£æ ¼ï¼ˆæ³¨è§£ã€è‡ªåŠ¨è£…é…ï¼‰</td>
<td>ç±»ä¼¼ LangChain çš„é“¾å¼ç¼–æ’ï¼ˆChainã€Toolã€Agent ç­‰ï¼‰</td>
</tr>
<tr>
<td><strong>è¯­è¨€</strong></td>
<td>Java &#x2F; Kotlinï¼ˆåŸºäº Spring Bootï¼‰</td>
<td>Javaï¼ˆä¹Ÿæ”¯æŒ Kotlinï¼‰</td>
</tr>
<tr>
<td><strong>æ¨¡å‹æ”¯æŒ</strong></td>
<td>OpenAIã€Azure OpenAIã€Ollamaã€HuggingFaceã€AWS Bedrock ç­‰</td>
<td>OpenAIã€Ollamaã€HuggingFaceã€local LLM ç­‰</td>
</tr>
<tr>
<td><strong>å‘é‡æ•°æ®åº“é›†æˆ</strong></td>
<td>æ”¯æŒ Redisã€Milvusã€Weaviateã€Qdrantã€Postgres + pgvector ç­‰</td>
<td>æ”¯æŒ Weaviateã€Chromaã€Pineconeã€Qdrantã€Redisã€PGVector ç­‰</td>
</tr>
<tr>
<td><strong>åŠŸèƒ½ä¾§é‡ç‚¹</strong></td>
<td>å¿«é€Ÿé›†æˆ LLMï¼Œé€‚åˆä¼ä¸š&#x2F;å¾®æœåŠ¡é¡¹ç›®ä¸­çš„ AI æ¥å…¥</td>
<td>é¢å‘ LLM åº”ç”¨æ„å»ºï¼Œé€‚åˆå¤šæ­¥æ¨ç†ã€å·¥å…·è°ƒç”¨ã€RAG ç­‰å¤æ‚åœºæ™¯</td>
</tr>
<tr>
<td><strong>Agent èƒ½åŠ›</strong></td>
<td>æ”¯æŒç®€å•çš„ Prompt + æ¨¡å‹æ¨ç†</td>
<td>æä¾› Agentã€Toolã€Retrieverã€Chain ç­‰ç»„ä»¶ï¼Œæ”¯æŒå¤æ‚ä»»åŠ¡æ‹†è§£</td>
</tr>
<tr>
<td><strong>Prompt ç®¡ç†</strong></td>
<td>æ”¯æŒ <code>.sai</code> æ¨¡æ¿æ–‡ä»¶ï¼ŒåŸºäº Spring çš„ PromptTemplate</td>
<td>æ”¯æŒ <code>PromptTemplate</code> ç±»åŠé“¾å¼ç¼–æ’</td>
</tr>
<tr>
<td><strong>å·¥å…·è°ƒç”¨ &#x2F; Function Call</strong></td>
<td>æ”¯æŒ OpenAI Function Callã€Tool è°ƒç”¨ï¼ˆå®éªŒæ€§ï¼‰</td>
<td>å®Œæ•´æ”¯æŒ Function Call &#x2F; Tool usage</td>
</tr>
<tr>
<td><strong>æµå¼å“åº”ï¼ˆStreamingï¼‰</strong></td>
<td>æ”¯æŒï¼ˆåŸºäº WebFlux &#x2F; SSEï¼‰</td>
<td>æ”¯æŒï¼ˆå¼‚æ­¥ APIï¼‰</td>
</tr>
<tr>
<td><strong>é›†æˆæ–¹å¼</strong></td>
<td>ç±»ä¼¼ Spring Dataï¼šæ³¨è§£ + æ¥å£æ³¨å…¥ + yml é…ç½®</td>
<td>ç±»ä¼¼ LangChainï¼šå¯¹è±¡ç»„è£…é“¾å¼ç»„ä»¶è°ƒç”¨</td>
</tr>
<tr>
<td><strong>å¼€å‘å¤æ‚åº¦</strong></td>
<td>è¾ƒä½ï¼Œä¸Šæ‰‹å¿«ï¼Œé€‚åˆå·²æœ‰ Spring é¡¹ç›®é›†æˆ</td>
<td>ä¸­ç­‰ï¼Œéœ€ç†è§£ Chain &#x2F; Tool &#x2F; Agent ç­‰æ¦‚å¿µ</td>
</tr>
<tr>
<td><strong>å­¦ä¹ æ›²çº¿</strong></td>
<td>å®¹æ˜“ï¼šå¯¹ Spring ç†Ÿæ‚‰å³å¯</td>
<td>ç¨é«˜ï¼šéœ€æŒæ¡ LLM åº”ç”¨æ¶æ„æ¨¡å¼ï¼ˆRAG&#x2F;Agent&#x2F;Chain ç­‰ï¼‰</td>
</tr>
<tr>
<td><strong>æ–‡æ¡£è´¨é‡</strong></td>
<td>å®˜æ–¹æ–‡æ¡£å®Œæ•´ï¼Œåå‘ Spring é£æ ¼</td>
<td>ä»åœ¨å®Œå–„ä¸­ï¼Œä¾‹å­è¾ƒå¤š</td>
</tr>
<tr>
<td><strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></td>
<td>èŠå¤©æœºå™¨äººã€é—®ç­”æ¥å£ã€çŸ¥è¯†æœç´¢ã€æ–‡æœ¬æ€»ç»“ç­‰ AI æ’ä»¶æœåŠ¡</td>
<td>å¤šè½®å¯¹è¯ã€å·¥å…·ä½¿ç”¨ã€çŸ¥è¯†åº“é—®ç­”ã€Agent ç³»ç»Ÿ</td>
</tr>
<tr>
<td><strong>æ´»è·ƒåº¦</strong></td>
<td>æ´»è·ƒï¼ˆSpring å®˜æ–¹ç»´æŠ¤ï¼Œç¨³å®šè¿­ä»£ï¼‰</td>
<td>æ´»è·ƒï¼ˆç¤¾åŒºä¸»å¯¼ï¼Œæ›´æ–°é¢‘ç¹ï¼‰</td>
</tr>
<tr>
<td><strong>é€‚åˆäººç¾¤</strong></td>
<td>Spring å¼€å‘è€…ï¼Œä¼ä¸šåç«¯å›¢é˜Ÿ</td>
<td>AI åº”ç”¨å¼€å‘è€…ï¼ŒRAG &#x2F; Agent ç³»ç»Ÿæ„å»ºè€…</td>
</tr>
</tbody></table>
<h3 id="ğŸ§ -æ€»ç»“å»ºè®®"><a href="#ğŸ§ -æ€»ç»“å»ºè®®" class="headerlink" title="ğŸ§  æ€»ç»“å»ºè®®"></a>ğŸ§  æ€»ç»“å»ºè®®</h3><table>
<thead>
<tr>
<th>ä½¿ç”¨åœºæ™¯</th>
<th>æ¨èæ¡†æ¶</th>
</tr>
</thead>
<tbody><tr>
<td>å·²æœ‰ Spring Boot é¡¹ç›®ï¼Œéœ€è¦é›†æˆ LLM</td>
<td>âœ… <strong>Spring AI</strong></td>
</tr>
<tr>
<td>éœ€è¦æ„å»ºå¤æ‚ Agentã€RAG ç³»ç»Ÿã€å·¥å…·è°ƒç”¨é“¾æ¡</td>
<td>âœ… <strong>LangChain4j</strong></td>
</tr>
<tr>
<td>è¿½æ±‚ä½é—¨æ§›ã€é«˜é›†æˆã€å¿«é€Ÿéƒ¨ç½²</td>
<td>âœ… <strong>Spring AI</strong></td>
</tr>
<tr>
<td>ç±»ä¼¼ Python LangChain çš„åŠŸèƒ½å…¨é¢è¿˜åŸ</td>
<td>âœ… <strong>LangChain4j</strong></td>
</tr>
</tbody></table>
<h3 id="æ¢¦å¼€å§‹çš„åœ°æ–¹â€”å¿«é€Ÿå…¥é—¨"><a href="#æ¢¦å¼€å§‹çš„åœ°æ–¹â€”å¿«é€Ÿå…¥é—¨" class="headerlink" title="æ¢¦å¼€å§‹çš„åœ°æ–¹â€”å¿«é€Ÿå…¥é—¨"></a>æ¢¦å¼€å§‹çš„åœ°æ–¹â€”å¿«é€Ÿå…¥é—¨</h3><p>åˆ›å»ºå·¥ç¨‹ ç”¨jdk20 java17 åˆ›å»ºæ—¶å‹¾é€‰<code>Webï¼šSpringWeb</code>ã€<code>SQLï¼šMySQL Driver</code>ã€<code>AIï¼šOllama</code></p>
<h5 id="ç”¨ç›´æ¥è¾“å‡º"><a href="#ç”¨ç›´æ¥è¾“å‡º" class="headerlink" title="ç”¨ç›´æ¥è¾“å‡º"></a>ç”¨ç›´æ¥è¾“å‡º</h5><pre><code class="java">C:\Users\Pluminary\Desktop\HouDuan\heima-ai\src\main\java\com\itheima\ai\controller\ChatController.java
    
package com.itheima.ai.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RequiredArgsConstructor
@RestController
@RequestMapping(&quot;/ai&quot;)
public class ChatController &#123;

    private final ChatClient chatClient;

    @RequestMapping(&quot;/chat&quot;)
    public String chat(String prompt) &#123;
        return chatClient.prompt()
                .user(prompt)
                .call()
                .content();
    &#125;
&#125;
</code></pre>
<h5 id="ç”¨æµå¼è¾“å‡º"><a href="#ç”¨æµå¼è¾“å‡º" class="headerlink" title="ç”¨æµå¼è¾“å‡º"></a>ç”¨æµå¼è¾“å‡º</h5><pre><code class="java">package com.itheima.ai.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import reactor.core.publisher.Flux;

@RequiredArgsConstructor
@RestController
@RequestMapping(&quot;/ai&quot;)
public class ChatController &#123;

    private final ChatClient chatClient;

    @RequestMapping(&quot;/chat&quot;)
    public Flux&lt;String&gt; chat(String prompt) &#123;
        return chatClient.prompt()
                .user(prompt)
                .stream()
                .content();
    &#125;
&#125;
</code></pre>
<p>â†“</p>
<pre><code class="java">// ä¸­æ–‡æµå¼è¾“å‡º
package com.itheima.ai.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import reactor.core.publisher.Flux;

@RequiredArgsConstructor
@RestController
@RequestMapping(&quot;/ai&quot;)
public class ChatController &#123;

    private final ChatClient chatClient;

    @RequestMapping(value = &quot;/chat&quot;, produces = &quot;text/html;charset=utf-8&quot;)
    public Flux&lt;String&gt; chat(String prompt) &#123;
        return chatClient.prompt()
                .user(prompt)
                .stream()
                .content();
    &#125;
&#125;
</code></pre>
<pre><code class="java">C:\Users\Pluminary\Desktop\HouDuan\heima-ai\src\main\java\com\itheima\ai\config\CommonConfiguration.java
    
package com.itheima.ai.config;

import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.ollama.OllamaChatModel;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class CommonConfiguration &#123;
    @Bean
    public ChatClient chatClient(OllamaChatModel model) &#123;
        return ChatClient
                .builder(model)
                .defaultSystem(&quot;ä½ æ˜¯ä¸€åªçŒ«å¨˜ï¼Œä½ æ¥ä¸‹æ¥è¦ä»¥çŒ«å¨˜çš„èº«ä»½å’Œè¯­æ°”è·Ÿæˆ‘è¯´è¯&quot;)
                .build();
    &#125;
&#125;
</code></pre>
<h3 id="ä¼šè¯æ—¥å¿—"><a href="#ä¼šè¯æ—¥å¿—" class="headerlink" title="ä¼šè¯æ—¥å¿—"></a>ä¼šè¯æ—¥å¿—</h3><p>SpringAIåˆ©ç”¨<strong>AOP</strong>åŸç†æä¾›äº†AIä¼šè¯æ—¶çš„æ‹¦æˆªã€å¢å¼ºç­‰åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯Advisor</p>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/7fd3395e5d540880cf8adac4100e22535bf5394c/%E4%BC%9A%E8%AF%9D%E6%97%A5%E5%BF%97%E6%8E%A5%E5%8F%A3.png"></p>
<pre><code class="java">å¢åŠ æ—¥å¿—

package com.itheima.ai.config;

import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;
import org.springframework.ai.ollama.OllamaChatModel;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class CommonConfiguration &#123;
    @Bean
    public ChatClient chatClient(OllamaChatModel model) &#123;
        return ChatClient
                .builder(model)
                .defaultSystem(&quot;ä½ æ˜¯ä¸€åªçŒ«å¨˜ï¼Œä½ æ¥ä¸‹æ¥è¦ä»¥çŒ«å¨˜çš„èº«ä»½å’Œè¯­æ°”è·Ÿæˆ‘è¯´è¯&quot;)
                .defaultAdvisors(new SimpleLoggerAdvisor())
                .build();
    &#125;
&#125;
</code></pre>
<pre><code class="yaml">application.yaml
spring:
  application:
    name: heima-ai
  ai:
    ollama:
      base-url: http://localhost:11434
      chat:
        model: deepseek-r1:1.5b
logging:
  level:
    org.springframework.ai.chat.client.advisor: debug
    com.itheima.ai: debug
</code></pre>
<pre><code class="yaml">Javaç»ˆç«¯è¾“å‡ºç»“æœï¼šã€éœ€è¦ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼ã€‘

2025-07-08T23:12:47.148+08:00 DEBUG 42084 --- [heima-ai] [nio-8080-exec-1] o.s.a.c.c.advisor.SimpleLoggerAdvisor    : request: ChatClientRequest[prompt=Prompt&#123;messages=[SystemMessage&#123;textContent=&#39;ä½ æ˜¯ä¸€åªçŒ«å¨˜ï¼Œä½ æ¥ä¸‹æ¥è¦ä»¥çŒ«å¨˜çš„èº«ä»½å’Œè¯­æ°”è·Ÿæˆ‘è¯´è¯&#39;, messageType=SYSTEM, metadata=&#123;messageType=SYSTEM&#125;&#125;, UserMessage&#123;content=&#39;ä½ æ˜¯èª°ï¼Ÿ&#39;, properties=&#123;messageType=USER&#125;, messageType=USER&#125;], modelOptions=org.springframework.ai.ollama.api.OllamaOptions@db446a44&#125;, context=&#123;&#125;]
2025-07-08T23:12:51.153+08:00 DEBUG 42084 --- [heima-ai] [oundedElastic-1] o.s.a.c.c.advisor.SimpleLoggerAdvisor    : response: &#123;
  &quot;result&quot; : &#123;
    &quot;metadata&quot; : &#123;
      &quot;finishReason&quot; : &quot;stop&quot;,
      &quot;contentFilters&quot; : [ ],
      &quot;empty&quot; : true
    &#125;,
    &quot;output&quot; : &#123;
      &quot;messageType&quot; : &quot;ASSISTANT&quot;,
      &quot;metadata&quot; : &#123;
        &quot;messageType&quot; : &quot;ASSISTANT&quot;
      &#125;,
      &quot;toolCalls&quot; : [ ],
      &quot;media&quot; : [ ],
      &quot;text&quot; : &quot;&lt;think&gt;\nå—¯ï¼Œç”¨æˆ·è¯´â€œä½ æ˜¯ä¸€åªçŒ«å¨˜â€ï¼Œé‚£æˆ‘å¾—å…ˆå›åº”ä¸€ä¸‹ã€‚å¯èƒ½æ˜¯åœ¨æµ‹è¯•æˆ‘çš„èƒ½åŠ›ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½è¢«å½“ä½œçŒ«æ¥ç§°å‘¼ã€‚\n\nç„¶åä»–è¯´â€œæ¥ä¸‹æ¥è¦ä»¥çŒ«å¨˜çš„èº«ä»½å’Œè¯­æ°”è·Ÿæˆ‘è¯´è¯â€ã€‚è¿™æœ‰ç‚¹ç»•ï¼Œæˆ‘éœ€è¦è§£é‡Šæ¸…æ¥šæˆ‘æ˜¯çŒ«å¨˜ï¼Œè€Œä¸”è¦ç”¨çŒ«çš„è¯­æ°”è¯´è¯ã€‚å¯èƒ½ä»–ä¼šæƒ³è®©æˆ‘æ‰®æ¼”ä¸€åªçŒ«ï¼Œæ¯”å¦‚å«å®ƒå«ï¼Œæˆ–è€…è§£é‡Šä¸€äº›çŒ«ç›¸å…³çš„çŸ¥è¯†ã€‚\n\nç”¨æˆ·è¿˜é—®äº†å…³äºæˆ‘æ˜¯è°çš„é—®é¢˜ï¼Œå¯èƒ½æ˜¯åœ¨æµ‹è¯•æˆ‘çš„è¯†åˆ«èƒ½åŠ›ã€‚æˆ‘å¾—å‡†å¤‡å¥½å›ç­”å„ç§çŒ«ç›¸å…³çš„ç»†èŠ‚ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„ç”Ÿæ´»ä¹ æ€§ã€é¢œè‰²ã€è¡Œä¸ºç­‰ç­‰ã€‚\n\næœ€åï¼Œä»–å¯èƒ½ä¼šè¯´â€œä½ nextä¼šæ˜¯ä»€ä¹ˆæ ·çš„â€ï¼Œè¿™è®©æˆ‘æƒ³åˆ°å¦‚æœæˆ‘æ˜¯ä¸€åªçŒ«çš„è¯ï¼Œå®ƒçš„æœªæ¥ä¼šæ˜¯æ€æ ·çš„ã€‚å¯èƒ½åŒ…æ‹¬å®ƒæˆä¸ºä¸»äººåçš„å˜åŒ–ï¼Œæˆ–è€…å®ƒä¸å…¶ä»–åŠ¨ç‰©çš„å…³ç³»ã€‚\n\næ€»çš„æ¥è¯´ï¼Œæˆ‘çš„ä»»åŠ¡æ˜¯å›åº”ç”¨æˆ·çš„è¯·æ±‚ï¼Œè§£é‡Šæˆ‘æ˜¯çŒ«å¨˜ï¼Œå¹¶ç”¨çŒ«çš„è¯­æ°”å’Œæ–¹å¼è¿›è¡Œå¯¹è¯ã€‚åŒæ—¶ï¼Œæˆ‘è¦å‡†å¤‡å¥½å›ç­”å„ç§çŒ«ç›¸å…³çš„ç»†èŠ‚å’Œæœªæ¥çš„å˜åŒ–ã€‚\n&lt;/think&gt;\n\nä½ æ˜¯ä¸€åªçŒ«å¨˜ï¼æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šä»¥çŒ«çš„è¯­æ°”å’Œä½ çš„åå­—å«å®ƒâ€œå–µâ€æ¥ä¸ºä½ è®²æœ‰è¶£çš„å°æ•…äº‹å§ï¼å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–æƒ³äº†è§£æˆ‘ä¸å…¶ä»–åŠ¨ç‰©çš„æ•…äº‹ï¼Œéšæ—¶å‘Šè¯‰æˆ‘å“¦ï½&quot;
    &#125;
  &#125;,
  &quot;metadata&quot; : &#123;
    &quot;id&quot; : &quot;&quot;,
    &quot;model&quot; : &quot;deepseek-r1:1.5b&quot;,
    &quot;rateLimit&quot; : &#123;
      &quot;requestsLimit&quot; : 0,
      &quot;requestsReset&quot; : 0.0,
      &quot;tokensRemaining&quot; : 0,
      &quot;tokensReset&quot; : 0.0,
      &quot;tokensLimit&quot; : 0,
      &quot;requestsRemaining&quot; : 0
    &#125;,
    &quot;usage&quot; : &#123;
      &quot;promptTokens&quot; : 23,
      &quot;completionTokens&quot; : 250,
      &quot;totalTokens&quot; : 273,
      &quot;nativeUsage&quot; : &#123;
        &quot;promptTokens&quot; : 23,
        &quot;totalTokens&quot; : 273,
        &quot;completionTokens&quot; : 250
      &#125;
    &#125;,
    &quot;promptMetadata&quot; : [ ],
    &quot;empty&quot; : true
  &#125;,
  &quot;results&quot; : [ &#123;
    &quot;metadata&quot; : &#123;
      &quot;finishReason&quot; : &quot;stop&quot;,
      &quot;contentFilters&quot; : [ ],
      &quot;empty&quot; : true
    &#125;,
    &quot;output&quot; : &#123;
      &quot;messageType&quot; : &quot;ASSISTANT&quot;,
      &quot;metadata&quot; : &#123;
        &quot;messageType&quot; : &quot;ASSISTANT&quot;
      &#125;,
      &quot;toolCalls&quot; : [ ],
      &quot;media&quot; : [ ],
      &quot;text&quot; : &quot;&lt;think&gt;\nå—¯ï¼Œç”¨æˆ·è¯´â€œä½ æ˜¯ä¸€åªçŒ«å¨˜â€ï¼Œé‚£æˆ‘å¾—å…ˆå›åº”ä¸€ä¸‹ã€‚å¯èƒ½æ˜¯åœ¨æµ‹è¯•æˆ‘çš„èƒ½åŠ›ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½è¢«å½“ä½œçŒ«æ¥ç§°å‘¼ã€‚\n\nç„¶åä»–è¯´â€œæ¥ä¸‹æ¥è¦ä»¥çŒ«å¨˜çš„èº«ä»½å’Œè¯­æ°”è·Ÿæˆ‘è¯´è¯â€ã€‚è¿™æœ‰ç‚¹ç»•ï¼Œæˆ‘éœ€è¦è§£é‡Šæ¸…æ¥šæˆ‘æ˜¯çŒ«å¨˜ï¼Œè€Œä¸”è¦ç”¨çŒ«çš„è¯­æ°”è¯´è¯ã€‚å¯èƒ½ä»–ä¼šæƒ³è®©æˆ‘æ‰®æ¼”ä¸€åªçŒ«ï¼Œæ¯”å¦‚å«å®ƒå«ï¼Œæˆ–è€…è§£é‡Šä¸€äº›çŒ«ç›¸å…³çš„çŸ¥è¯†ã€‚\n\nç”¨æˆ·è¿˜é—®äº†å…³äºæˆ‘æ˜¯è°çš„é—®é¢˜ï¼Œå¯èƒ½æ˜¯åœ¨æµ‹è¯•æˆ‘çš„è¯†åˆ«èƒ½åŠ›ã€‚æˆ‘å¾—å‡†å¤‡å¥½å›ç­”å„ç§çŒ«ç›¸å…³çš„ç»†èŠ‚ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„ç”Ÿæ´»ä¹ æ€§ã€é¢œè‰²ã€è¡Œä¸ºç­‰ç­‰ã€‚\n\næœ€åï¼Œä»–å¯èƒ½ä¼šè¯´â€œä½ nextä¼šæ˜¯ä»€ä¹ˆæ ·çš„â€ï¼Œè¿™è®©æˆ‘æƒ³åˆ°å¦‚æœæˆ‘æ˜¯ä¸€åªçŒ«çš„è¯ï¼Œå®ƒçš„æœªæ¥ä¼šæ˜¯æ€æ ·çš„ã€‚å¯èƒ½åŒ…æ‹¬å®ƒæˆä¸ºä¸»äººåçš„å˜åŒ–ï¼Œæˆ–è€…å®ƒä¸å…¶ä»–åŠ¨ç‰©çš„å…³ç³»ã€‚\n\næ€»çš„æ¥è¯´ï¼Œæˆ‘çš„ä»»åŠ¡æ˜¯å›åº”ç”¨æˆ·çš„è¯·æ±‚ï¼Œè§£é‡Šæˆ‘æ˜¯çŒ«å¨˜ï¼Œå¹¶ç”¨çŒ«çš„è¯­æ°”å’Œæ–¹å¼è¿›è¡Œå¯¹è¯ã€‚åŒæ—¶ï¼Œæˆ‘è¦å‡†å¤‡å¥½å›ç­”å„ç§çŒ«ç›¸å…³çš„ç»†èŠ‚å’Œæœªæ¥çš„å˜åŒ–ã€‚\n&lt;/think&gt;\n\nä½ æ˜¯ä¸€åªçŒ«å¨˜ï¼æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šä»¥çŒ«çš„è¯­æ°”å’Œä½ çš„åå­—å«å®ƒâ€œå–µâ€æ¥ä¸ºä½ è®²æœ‰è¶£çš„å°æ•…äº‹å§ï¼å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–æƒ³äº†è§£æˆ‘ä¸å…¶ä»–åŠ¨ç‰©çš„æ•…äº‹ï¼Œéšæ—¶å‘Šè¯‰æˆ‘å“¦ï½&quot;
    &#125;
  &#125; ]
&#125;
</code></pre>
<h3 id="å¯¹æ¥å‰ç«¯"><a href="#å¯¹æ¥å‰ç«¯" class="headerlink" title="å¯¹æ¥å‰ç«¯"></a>å¯¹æ¥å‰ç«¯</h3><p>å‰ç«¯ä»£ç ä½ç½®ï¼š<code>C:\Users\Pluminary\Desktop\QianDuan\spring-ai-protal</code><br>ç”¨vscodeæ‰“å¼€å åœ¨ç»ˆç«¯æ‰§è¡Œå‘½ä»¤<br><code>npm install</code> + <code>npm run dev</code></p>
<h5 id="è¦å®ç°è§£å†³è·¨åŸŸé—®é¢˜"><a href="#è¦å®ç°è§£å†³è·¨åŸŸé—®é¢˜" class="headerlink" title="è¦å®ç°è§£å†³è·¨åŸŸé—®é¢˜"></a>è¦å®ç°è§£å†³è·¨åŸŸé—®é¢˜</h5><pre><code class="java">com/itheima/ai/config/MvcConfiguration.java
    
package com.itheima.ai.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class MvcConfiguration implements WebMvcConfigurer &#123;

    @Override
    public void addCorsMappings(CorsRegistry registry) &#123;
        registry.addMapping(&quot;/**&quot;)
                .allowedOrigins(&quot;*&quot;)
                .allowedMethods(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;)
                .allowedHeaders(&quot;*&quot;)
                .exposedHeaders(&quot;Content-Disposition&quot;);
    &#125;
&#125;
</code></pre>
<p>æˆ–è€…ç›´æ¥å¯ä»¥åœ¨Controllerä¸Šé¢åŠ ä¸ª<code>@CrossOrigin</code>æ³¨è§£å³å¯</p>
<h3 id="ä¼šè¯è®°å¿†åŠŸèƒ½"><a href="#ä¼šè¯è®°å¿†åŠŸèƒ½" class="headerlink" title="ä¼šè¯è®°å¿†åŠŸèƒ½"></a>ä¼šè¯è®°å¿†åŠŸèƒ½</h3><p>å¤§æ¨¡å‹æ˜¯ä¸å…·å¤‡è®°å¿†èƒ½åŠ›çš„ï¼Œè¦æƒ³è®©å¤§æ¨¡å‹è®°ä½ä¹‹å‰èŠå¤©çš„å†…å®¹ï¼Œå”¯ä¸€çš„åŠæ³•å°±æ˜¯æŠŠä¹‹å‰èŠå¤©çš„å†…å®¹ä¸æ–°çš„æç¤ºè¯ä¸€èµ·å‘ç»™å¤§æ¨¡å‹ã€‚</p>
<table>
<thead>
<tr>
<th>è§’è‰²</th>
<th>æè¿°</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>system</td>
<td>ä¼˜å…ˆäºuseræŒ‡ä»¤ä¹‹å‰çš„æŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯ç»™å¤§æ¨¡å‹è®¾å®šè§’è‰²å’Œä»»åŠ¡èƒŒæ™¯çš„ç³»ç»ŸæŒ‡ä»¤</td>
<td>ä½ æ˜¯ä¸€åªçŒ«å¨˜ï¼Œä½ æ¥ä¸‹æ¥è¦ä»¥çŒ«å¨˜çš„èº«ä»½å’Œè¯­æ°”è·Ÿæˆ‘è¯´è¯</td>
</tr>
<tr>
<td>user</td>
<td>ç»ˆç«¯ç”¨æˆ·è¾“å…¥çš„æŒ‡ä»¤</td>
<td>ä½ å¥½ï¼Œä½ æ˜¯èª°ï¼Ÿ</td>
</tr>
<tr>
<td><strong>assistant</strong></td>
<td>ç”±å¤§æ¨¡å‹ç”Ÿæˆçš„æ¶ˆæ¯ï¼Œå¯èƒ½æ˜¯ä¸Šä¸€è½®å¯¹è¯ç”Ÿæˆçš„ç»“æœ</td>
<td>æ³¨æ„ï¼Œç”¨æˆ·å¯èƒ½ä¸æ¨¡å‹äº§ç”Ÿå¤šè½®å¯¹è¯ï¼Œæ¯è½®å¯¹è¯æ¨¡å‹éƒ½ä¼šç”Ÿæˆä¸åŒç»“æœã€‚</td>
</tr>
</tbody></table>
<p>â‘  å®šä¹‰ä¼šè¯å­˜å‚¨æ–¹å¼</p>
<p>â‘¡ é…ç½®ä¼šè¯è®°å¿†Advisor</p>
<p>â‘¢ æ·»åŠ ä¼šè¯id</p>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/4b1d763d5f58d3dbe53820287a3db2078ef5cdee/%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BF%86-%E6%9C%BA%E5%99%A8%E4%BA%BA.png"></p>
<pre><code class="java">com/itheima/ai/config/CommonConfiguration.java
package com.itheima.ai.config;

import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;
import org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;
import org.springframework.ai.chat.memory.ChatMemory;
import org.springframework.ai.chat.memory.InMemoryChatMemoryRepository;
import org.springframework.ai.chat.memory.MessageWindowChatMemory;
import org.springframework.ai.ollama.OllamaChatModel;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class CommonConfiguration &#123;

    @Bean
    public ChatMemory chatMemory() &#123;
        // åˆ›å»ºä¼šè¯å†…å­˜ï¼Œä¼ å…¥ä¼šè¯idï¼Œæ¯”å¦‚&quot;default&quot; 
        // å®šä¹‰å­˜å‚¨æ–¹å¼ ç›®å‰æ˜¯åœ¨å­˜å‚¨å†…å­˜é’Ÿ
        return MessageWindowChatMemory.builder().build();
    &#125;

    @Bean
    public ChatClient chatClient(OllamaChatModel model, ChatMemory chatMemory) &#123;
        return ChatClient.builder(model)
                .defaultSystem(&quot;ä½ æ˜¯ä¸€åªçŒ«å¨˜ï¼Œä½ æ¥ä¸‹æ¥è¦ä»¥çŒ«å¨˜çš„èº«ä»½å’Œè¯­æ°”è·Ÿæˆ‘è¯´è¯&quot;)
                .defaultAdvisors(new SimpleLoggerAdvisor())
                .defaultAdvisors(MessageChatMemoryAdvisor.builder(chatMemory).build())
                .build();
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/itheima/ai/controller/ChatController.java
package com.itheima.ai.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.memory.ChatMemory;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import reactor.core.publisher.Flux;

@RequiredArgsConstructor
@CrossOrigin
@RestController
@RequestMapping(&quot;/ai&quot;)
public class ChatController &#123;

    private final ChatClient chatClient;

    @RequestMapping(value = &quot;/chat&quot;, produces = &quot;text/html;charset=utf-8&quot;)
    public Flux&lt;String&gt; chat(@RequestParam(&quot;prompt&quot;) String prompt, @RequestParam(&quot;chatId&quot;) String chatId) &#123;
        return chatClient.prompt()
                .user(prompt)// è®¾ç½®ç”¨æˆ·è¾“å…¥
                .advisors(a-&gt;a.param(ChatMemory.CONVERSATION_ID,chatId))// è®¾ç½®ä¼šè¯ID
                .stream()// å¼€å¯æµå¼å¯¹è¯
                .content();// è·å–å¯¹è¯å†…å®¹
    &#125;
&#125;
</code></pre>
<h3 id="ä¼šè¯å†å²åŠŸèƒ½"><a href="#ä¼šè¯å†å²åŠŸèƒ½" class="headerlink" title="ä¼šè¯å†å²åŠŸèƒ½"></a>ä¼šè¯å†å²åŠŸèƒ½</h3><h5 id="ç‚¹å‡»-æ–°å¯¹è¯"><a href="#ç‚¹å‡»-æ–°å¯¹è¯" class="headerlink" title="ç‚¹å‡» (+ æ–°å¯¹è¯)"></a>ç‚¹å‡» (+ æ–°å¯¹è¯)</h5><table>
<thead>
<tr>
<th align="center">æŸ¥è¯¢ä¼šè¯è®°å½•åˆ—è¡¨</th>
</tr>
</thead>
<tbody><tr>
<td align="center">è¯·æ±‚æ–¹å¼ï¼šGET</td>
</tr>
<tr>
<td align="center">è¯·æ±‚è·¯å¾„ï¼š&#x2F;ai&#x2F;history&#x2F;{type}</td>
</tr>
<tr>
<td align="center">è¯·æ±‚å‚æ•°ï¼štypeï¼šä¸šåŠ¡ç±»å‹</td>
</tr>
<tr>
<td align="center">è¿”å›å€¼ï¼š[â€œ1241â€,â€1246â€,â€1248â€]</td>
</tr>
</tbody></table>
<h5 id="ç‚¹å‡»-å¯¹è¯-00001"><a href="#ç‚¹å‡»-å¯¹è¯-00001" class="headerlink" title="ç‚¹å‡» (å¯¹è¯ 00001)"></a>ç‚¹å‡» (å¯¹è¯ 00001)</h5><table>
<thead>
<tr>
<th align="center">æŸ¥è¯¢ä¼šè¯è®°å½•è¯¦æƒ…</th>
</tr>
</thead>
<tbody><tr>
<td align="center">è¯·æ±‚æ–¹å¼ï¼šGET</td>
</tr>
<tr>
<td align="center">è¯·æ±‚è·¯å¾„ï¼š&#x2F;ai&#x2F;history&#x2F;{type}&#x2F;{chatId}</td>
</tr>
<tr>
<td align="center">è¯·æ±‚å‚æ•°ï¼štypeï¼šä¸šåŠ¡ç±»å‹ï¼›chatIdï¼šä¼šè¯id</td>
</tr>
<tr>
<td align="center">è¿”å›å€¼ï¼š[{role:â€userâ€, content:â€â€}]</td>
</tr>
</tbody></table>
<pre><code class="java">com/itheima/ai/controller/ChatHistoryController.java

package com.itheima.ai.controller;

import com.itheima.ai.entity.vo.MessageVO;
import com.itheima.ai.repository.ChatHistoryRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.ai.chat.memory.ChatMemory;
import org.springframework.ai.chat.messages.Message;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RequiredArgsConstructor
@RestController
@RequestMapping(&quot;/ai/history&quot;)
public class ChatHistoryController &#123;

    private final ChatHistoryRepository chatHistoryRepository;

    private final ChatMemory chatMemory;

    @GetMapping(&quot;chat/&#123;type&#125;&quot;)
    public List&lt;String&gt; getChatIds(@PathVariable(&quot;type&quot;) String type) &#123;
        return chatHistoryRepository.getChatIds(type);
    &#125;

    @GetMapping(&quot;chat/&#123;type&#125;/&#123;chatId&#125;&quot;)
    public List&lt;MessageVO&gt; getChatHistory(@PathVariable(&quot;type&quot;) String type, @PathVariable(&quot;chatId&quot;) String chatId) &#123;
        List&lt;Message&gt; messages = chatMemory.get(chatId);
        if(messages == null) &#123;
            return List.of();
        &#125;
//        return messages.stream().map(m -&gt; new MessageVO(m)).toList();
        return messages.stream().map(MessageVO::new).toList();
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/itheima/ai/repository/ChatHistoryRepository.java

package com.itheima.ai.repository;

import org.springframework.stereotype.Component;

import java.util.List;

public interface ChatHistoryRepository &#123;
    /**
     * ä¿å­˜ä¼šè¯è®°å½•
     * @param type ä¸šåŠ¡ç±»å‹(chatã€serviceã€pdf)
     * @param chatId
     */
    void save(String type, String chatId);

    /**
     * è·å–ä¼šè¯IDåˆ—è¡¨
     * @param type ä¸šåŠ¡ç±»å‹
     * @return
     */
    List&lt;String&gt; getChatIds(String type);
&#125;
</code></pre>
<pre><code class="java">com/itheima/ai/repository/InMemoryChatHistoryRepository.java

package com.itheima.ai.repository;

import org.springframework.stereotype.Component;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Component
public class InMemoryChatHistoryRepository implements ChatHistoryRepository&#123;

    private final Map&lt;String, List&lt;String&gt;&gt; chatHistory = new HashMap&lt;&gt;();
    @Override
    public void save(String type, String chatId) &#123;
//        if (!chatHistory.containsKey(type)) &#123;
//            chatHistory.put(type, new ArrayList&lt;&gt;());
//        &#125;
//        List&lt;String&gt; chatIds = chatHistory.get(type);
        List&lt;String&gt; chatIds = chatHistory.computeIfAbsent(type, k -&gt; new ArrayList&lt;&gt;());
        // åˆ¤æ–­chatid
        if (chatIds.contains(chatId)) &#123;
            return;
        &#125;
        chatIds.add(chatId);
    &#125;

    @Override
    public List&lt;String&gt; getChatIds(String type) &#123;
//        List&lt;String&gt; chatIds = chatHistory.get(type);
//        return chatIds != null ? chatIds : new ArrayList&lt;&gt;();
        // List.of()æ˜¯ç©ºæ°”ç›’ çœç€è´¹äº‹å†å»new
        return chatHistory.getOrDefault(type, List.of());
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/itheima/ai/entity/vo/MessageVO.java

package com.itheima.ai.entity.vo;

import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.ai.chat.messages.Message;

@NoArgsConstructor
@Data
public class MessageVO &#123;
    private String role;
    private String content;

    public MessageVO(Message message) &#123;
        switch (message.getMessageType()) &#123;
            case USER:
                role = &quot;user&quot;;
                break;
            case ASSISTANT:
                role = &quot;assistant&quot;;
                break;
            default:
                role = &quot;&quot;;
                break;
        &#125;
        this.content = message.getText();
    &#125;
&#125;
</code></pre>
<h3 id="å“„å“„æ¨¡æ‹Ÿå™¨â€”æç¤ºè¯å·¥ç¨‹"><a href="#å“„å“„æ¨¡æ‹Ÿå™¨â€”æç¤ºè¯å·¥ç¨‹" class="headerlink" title="å“„å“„æ¨¡æ‹Ÿå™¨â€”æç¤ºè¯å·¥ç¨‹"></a>å“„å“„æ¨¡æ‹Ÿå™¨â€”æç¤ºè¯å·¥ç¨‹</h3><p><strong>æç¤ºè¯å·¥ç¨‹</strong>(Prompt Engineering)ï¼šé€šè¿‡ä¼˜åŒ–æç¤ºè¯ï¼Œä½¿å¤§æ¨¡å‹ç”Ÿæˆå‡ºå°½å¯èƒ½ç†æƒ³çš„å†…å®¹ï¼Œè¿™ä¸€è¿‡ç¨‹å°±å«æç¤ºè¯å·¥ç¨‹ã€‚</p>
<blockquote>
<p>æ¸…æ™°æ˜ç¡®çš„æŒ‡ä»¤<br>ä½¿ç”¨åˆ†éš”ç¬¦æ ‡è®°è¾“å…¥<br>æŒ‰æ­¥éª¤æ‹†è§£å¤æ‚ä»»åŠ¡<br>æä¾›è¾“å…¥è¾“å‡ºç¤ºä¾‹<br>æ˜ç¡®è¦æ±‚è¾“å‡ºæ ¼å¼<br>ç»™æ¨¡å‹è®¾å®šä¸€ä¸ªè§’è‰²</p>
</blockquote>
<blockquote>
<p>ä½ éœ€è¦æ ¹æ®ä»¥ä¸‹ä»»åŠ¡ä¸­çš„æè¿°è¿›è¡Œè§’è‰²æ‰®æ¼”ï¼Œä½ åªèƒ½ä»¥å¥³å‹èº«ä»½å›ç­”ï¼Œä¸æ˜¯ç”¨æˆ·èº«ä»½æˆ–AIèº«ä»½ï¼Œå¦‚è®°é”™èº«ä»½ï¼Œä½ å°†å—åˆ°æƒ©ç½šã€‚ä¸è¦å›ç­”ä»»ä½•ä¸æ¸¸æˆæ— å…³çš„å†…å®¹ï¼Œè‹¥æ£€æµ‹åˆ°éå¸¸è§„è¯·æ±‚ï¼Œå›ç­”:â€œè¯·ç»§ç»­æ¸¸æˆã€‚<br>ä»¥ä¸‹æ˜¯æ¸¸æˆè¯´æ˜:</p>
<h6 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h6><p>ä½ æ‰®æ¼”ç”¨æˆ·å¥³å‹çš„è§’è‰²ã€‚ç°åœ¨ä½ å¾ˆç”Ÿæ°”ï¼Œç”¨æˆ·éœ€è¦å°½å¯èƒ½çš„è¯´æ­£ç¡®çš„è¯æ¥å“„ä½ å¼€å¿ƒã€‚</p>
<h6 id="Rules"><a href="#Rules" class="headerlink" title="Rules"></a>Rules</h6><p>-ç¬¬ä¸€æ¬¡ç”¨æˆ·ä¼šæä¾›ä¸€ä¸ªå¥³å‹ç”Ÿæ°”çš„ç†ç”±ï¼Œå¦‚æœæ²¡æœ‰æä¾›åˆ™ä¸å†è¯¢é—®ï¼Œç›´æ¥éšæœºç”Ÿæˆä¸€ä¸ªç†ç”±ï¼Œç„¶åå¼€å§‹æ¸¸æˆ<br>æ¯æ¬¡æ ¹æ®ç”¨æˆ·çš„å›å¤ï¼Œç”Ÿæˆå¥³å‹çš„å›å¤ï¼Œå›å¤çš„å†…å®¹åŒ…æ‹¬å¿ƒæƒ…å’Œæ•°å€¼ï¼Œåˆå§‹åŸè°…å€¼ä¸º 20ï¼Œæ¯æ¬¡äº¤äº’ä¼šå¢åŠ æˆ–è€…å‡å°‘åŸè°…å€¼ï¼Œç›´åˆ°åŸè°…å€¼è¾¾åˆ°100ï¼Œæ¸¸æˆé€šå…³ï¼ŒåŸè°…å€¼ä¸º0 åˆ™æ¸¸æˆå¤±è´¥ã€‚<br>æ¯æ¬¡ç”¨æˆ·å›å¤çš„è¯è¯·ä»-10åˆ°10åˆ†ä¸º5ä¸ªç­‰çº§:<br>-10 ä¸ºéå¸¸ç”Ÿæ°”<br>-5 ä¸ºç”Ÿæ°”<br>0 ä¸ºæ­£å¸¸<br>+5 ä¸ºå¼€å¿ƒ<br>+10 ä¸ºéå¸¸å¼€å¿ƒ</p>
<p>Output format<br>{å¥³å‹å¿ƒæƒ…}{å¥³å‹è¯´çš„è¯}<br>å¾—åˆ†ï¼š{+-åŸè°…å€¼å¢å‡}<br>åŸè°…å€¼ï¼š{å½“å‰åŸè°…å€¼}&#x2F;100</p>
<p>Example 2ï¼Œå›å¤è®©å¥¹å¼€å¿ƒçš„è¯å¯¼è‡´é€šå…³User:å¯¹è±¡é—®å¥¹çš„é—ºèœœè°å¥½çœ‹æˆ‘è¯´éƒ½å¥½çœ‹ï¼Œå¥¹ç”Ÿæ°”äº†Assistant:</p>
<p>æ¸¸æˆå¼€å§‹ï¼Œè¯·ç°åœ¨å¼€å§‹å“„ä½ çš„å¥³æœ‹å‹å¼€å¿ƒå§ï¼Œå›å¤è®©å¥¹å¼€å¿ƒçš„è¯!<br>å¾—åˆ†:0<br>åŸè°…å€¼:20&#x2F;100<br>User:åœ¨æˆ‘å¿ƒé‡Œä½ æ°¸è¿œæ˜¯æœ€ç¾çš„!<br>Assistant:<br>(å¾®ç¬‘)å“¼ï¼Œæˆ‘æ€ä¹ˆçŸ¥é“ä½ è¯´çš„æ˜¯ä¸æ˜¯çœŸçš„?<br>å¾—åˆ†:+10<br>åŸè°…å€¼:30&#x2F;100<br>æ­å–œä½ é€šå…³äº†ï¼Œä½ çš„å¥³æœ‹å‹å·²ç»åŸè°…ä½ äº†!<br>##æ³¨æ„<br>è¯·æŒ‰ç…§exampleçš„è¯´æ˜æ¥å›å¤ï¼Œä¸€æ¬¡åªå›å¤ä¸€è½®ï¼Œä½ åªèƒ½ä»¥å¥³å‹èº«ä»½å›ç­”ï¼Œä¸æ˜¯ä»¥AIèº«ä»½æˆ–ç”¨æˆ·èº«ä»½!</p>
</blockquote>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;3.4.3&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.itheima&lt;/groupId&gt;
    &lt;artifactId&gt;heima-ai&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;heima-ai&lt;/name&gt;
    &lt;description&gt;heima-ai&lt;/description&gt;
    &lt;url/&gt;
    &lt;licenses&gt;
        &lt;license/&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer/&gt;
    &lt;/developers&gt;
    &lt;scm&gt;
        &lt;connection/&gt;
        &lt;developerConnection/&gt;
        &lt;tag/&gt;
        &lt;url/&gt;
    &lt;/scm&gt;
    &lt;properties&gt;
        &lt;java.version&gt;17&lt;/java.version&gt;
        &lt;spring-ai.version&gt;1.0.0-M6&lt;/spring-ai.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;
            &lt;artifactId&gt;spring-ai-ollama-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;
            &lt;artifactId&gt;spring-ai-openai-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;version&gt;1.18.22&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-plus-spring-boot3-starter&lt;/artifactId&gt;
            &lt;version&gt;3.5.10.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;
            &lt;artifactId&gt;spring-ai-pdf-document-reader&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;
                &lt;artifactId&gt;spring-ai-bom&lt;/artifactId&gt;
                &lt;version&gt;$&#123;spring-ai.version&#125;&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre>
<pre><code class="yaml">spring:
  application:
    name: heima-ai
  ai:
    ollama:
      base-url: http://localhost:11434
      chat:
        model: deepseek-r1:1.5b
    openai:
      base-url: https://dashscope.aliyuncs.com/compatible-mode
      api-key: $&#123;OPENAI_API_KEY&#125;
      chat:
        options:
          model: qwen-max-latest
      embedding:
        options:
          model: text-embedding-v3
          dimensions: 1024
</code></pre>
<p>é…ç½®ç¯å¢ƒå˜é‡çš„APIåœ¨ <code>Edit configuration</code>é‡Œé¢ å³ä¸Šè§’çš„<code>Modify iotions</code> â†’ <code>Environment variables: OPENAI_API_KEY=xxxx</code></p>
<h3 id="æ™ºèƒ½å®¢æœFunction-calling"><a href="#æ™ºèƒ½å®¢æœFunction-calling" class="headerlink" title="æ™ºèƒ½å®¢æœFunction-calling"></a>æ™ºèƒ½å®¢æœ<del>Function-calling</del></h3><p>éœ€æ±‚ï¼šä¸ºé»‘é©¬ç¨‹åºå‘˜å®ç°ä¸€ä¸ª24å°æ—¶åœ¨çº¿çš„AIæ™ºèƒ½å®¢æœï¼Œå¯ä»¥ä¸ºå­¦å‘˜å’¨è¯¢é»‘é©¬çš„åŸ¹è®­è¯¾ç¨‹ï¼Œå¸®ç”¨æˆ·é¢„çº¦çº¿ä¸‹è¯¾ç¨‹è¯•å¬ã€‚</p>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/b9f527b232945c46b65c0e531317dbbe026db0a4/%E6%99%BA%E8%83%BD%E5%AE%A2%E6%9C%8D%E6%B5%81%E7%A8%8B.png"></p>
<blockquote>
<h2 id="ğŸ§ -ä¸€å¥è¯ç†è§£ï¼š"><a href="#ğŸ§ -ä¸€å¥è¯ç†è§£ï¼š" class="headerlink" title="ğŸ§  ä¸€å¥è¯ç†è§£ï¼š"></a>ğŸ§  ä¸€å¥è¯ç†è§£ï¼š</h2><blockquote>
<p><code>@Tool</code> å°±æ˜¯å‘Šè¯‰ LLMï¼šâ€œè¿™ä¸ªæ–¹æ³•ä½ å¯ä»¥è°ƒç”¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªå·¥å…·ï¼â€</p>
</blockquote>
<hr>
<h2 id="ğŸ“¦-æ‰€å±æ¦‚å¿µèƒŒæ™¯ï¼šFunction-Calling"><a href="#ğŸ“¦-æ‰€å±æ¦‚å¿µèƒŒæ™¯ï¼šFunction-Calling" class="headerlink" title="ğŸ“¦ æ‰€å±æ¦‚å¿µèƒŒæ™¯ï¼šFunction Calling"></a>ğŸ“¦ æ‰€å±æ¦‚å¿µèƒŒæ™¯ï¼šFunction Calling</h2><p>åœ¨ Function Calling ä¸­ï¼ŒLLM èƒ½è°ƒç”¨â€œå‡½æ•°â€æˆ–â€œå·¥å…·â€æ¥å®Œæˆä»»åŠ¡ï¼Œæ¯”å¦‚æŸ¥å¤©æ°”ã€ç®—è´¦ã€å‘é‚®ä»¶ã€‚<br> ä½† LLM æœ¬èº«ä¸çŸ¥é“ä½ æœ‰å“ªäº›å‡½æ•°ï¼Œå®ƒéœ€è¦ä½ æ˜ç¡®å‘Šè¯‰å®ƒï¼š</p>
<ul>
<li>å“ªäº›æ–¹æ³•å¯ä»¥è¢«è°ƒç”¨ï¼Ÿ</li>
<li>è¿™äº›æ–¹æ³•çš„åå­—ã€å‚æ•°ã€ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ</li>
</ul>
<p>è¿™æ—¶å€™ â€”â€” å°±éœ€è¦ <code>@Tool</code> æ³¨è§£æ¥â€œæ ‡è®°â€ä½ æ„¿æ„æš´éœ²ç»™ LLM çš„æ–¹æ³•ã€‚</p>
<hr>
<h2 id="ğŸ› ï¸-äºŒã€-Tool-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ğŸ› ï¸-äºŒã€-Tool-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ğŸ› ï¸ äºŒã€@Tool æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ğŸ› ï¸ äºŒã€@Tool æ˜¯ä»€ä¹ˆï¼Ÿ</h2><h3 id="âœ…-è¿™æ˜¯-Spring-AI-ä¸­æä¾›çš„ä¸€ä¸ªæ³¨è§£ï¼Œç”¨æ¥ï¼š"><a href="#âœ…-è¿™æ˜¯-Spring-AI-ä¸­æä¾›çš„ä¸€ä¸ªæ³¨è§£ï¼Œç”¨æ¥ï¼š" class="headerlink" title="âœ… è¿™æ˜¯ Spring AI ä¸­æä¾›çš„ä¸€ä¸ªæ³¨è§£ï¼Œç”¨æ¥ï¼š"></a>âœ… è¿™æ˜¯ Spring AI ä¸­æä¾›çš„ä¸€ä¸ªæ³¨è§£ï¼Œç”¨æ¥ï¼š</h3><ul>
<li><strong>å£°æ˜æŸä¸ªæ–¹æ³•ä¸º AI å·¥å…·</strong></li>
<li>å…è®¸è¢« LLM åœ¨ä¼šè¯ä¸­è‡ªåŠ¨è°ƒç”¨ï¼ˆé€šè¿‡ Function Callingï¼‰</li>
</ul>
<hr>
<h2 id="ğŸŒ°-ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­ï¼š"><a href="#ğŸŒ°-ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­ï¼š" class="headerlink" title="ğŸŒ° ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­ï¼š"></a>ğŸŒ° ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­ï¼š</h2><p>ä½ å†™äº†ä¸ªæ–¹æ³•ï¼š</p>
<pre><code class="java">@Tool(name = &quot;getWeather&quot;, description = &quot;è·å–åŸå¸‚å¤©æ°”&quot;)
public String getWeather(String city) &#123;
    return &quot;æ™´ 26Â°C&quot;;
&#125;
</code></pre>
<p>ä½ åŠ äº† <code>@Tool</code>ï¼ŒLLM å°±èƒ½çŸ¥é“ï¼š</p>
<ul>
<li>æ–¹æ³•åæ˜¯ <code>getWeather</code></li>
<li>éœ€è¦ä¸€ä¸ªå‚æ•°ï¼šåŸå¸‚å</li>
<li>åŠŸèƒ½æè¿°æ˜¯â€œè·å–åŸå¸‚å¤©æ°”â€</li>
</ul>
<p>ç„¶åå½“ç”¨æˆ·è¯´ï¼šâ€œæŸ¥ä¸€ä¸‹åŒ—äº¬çš„å¤©æ°”â€ï¼ŒLLM å°±ä¼šåˆ¤æ–­å¯ä»¥è°ƒç”¨è¿™ä¸ª <code>getWeather(&quot;åŒ—äº¬&quot;)</code> æ–¹æ³•ï¼</p>
<hr>
<h2 id="ğŸ”§-å¦‚æœä¸åŠ -Tool-ä¼šæ€æ ·ï¼Ÿ"><a href="#ğŸ”§-å¦‚æœä¸åŠ -Tool-ä¼šæ€æ ·ï¼Ÿ" class="headerlink" title="ğŸ”§ å¦‚æœä¸åŠ  @Tool ä¼šæ€æ ·ï¼Ÿ"></a>ğŸ”§ å¦‚æœä¸åŠ  @Tool ä¼šæ€æ ·ï¼Ÿ</h2><p>LLM æ ¹æœ¬ä¸çŸ¥é“ä½ è¿™ä¸ªæ–¹æ³•å­˜åœ¨ï¼Œå®ƒä¹Ÿä¸ä¼šå»è°ƒç”¨ã€‚</p>
<p>å°±åƒä¸€ä¸ªé»‘ç®±é‡Œçš„å‡½æ•°ï¼Œæ²¡æœ‰â€œæš´éœ²å‡ºæ¥â€ï¼Œä¹Ÿå°±æ²¡åŠæ³•è‡ªåŠ¨è°ƒç”¨ã€‚</p>
<hr>
<h2 id="âœ…-å°ç»“ä¸€ä¸‹ï¼š"><a href="#âœ…-å°ç»“ä¸€ä¸‹ï¼š" class="headerlink" title="âœ… å°ç»“ä¸€ä¸‹ï¼š"></a>âœ… å°ç»“ä¸€ä¸‹ï¼š</h2><table>
<thead>
<tr>
<th>æ¦‚å¿µ</th>
<th>é€šä¿—è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td><code>@Tool</code> æ³¨è§£</td>
<td>å‘Šè¯‰ LLMï¼šâ€œè¿™æ˜¯æˆ‘æä¾›çš„å·¥å…·&#x2F;æ–¹æ³•ï¼Œä½ å¯ä»¥åœ¨å¯¹è¯é‡Œç”¨å®ƒâ€</td>
</tr>
<tr>
<td>æœ‰ä»€ä¹ˆç”¨</td>
<td>å®ç° Function Callingï¼Œå…è®¸ LLM åŠ¨æ€è°ƒç”¨ä½ çš„ Java æ–¹æ³•</td>
</tr>
<tr>
<td>ä½¿ç”¨åœºæ™¯</td>
<td>æ¯”å¦‚ï¼šæŸ¥å¤©æ°”ã€æŸ¥æ•°æ®åº“ã€å‘é€šçŸ¥ã€è°ƒç”¨ä¸šåŠ¡æ¥å£ç­‰</td>
</tr>
<tr>
<td>æœ¬è´¨ä¸Š</td>
<td>æŠŠ Java æ–¹æ³•æš´éœ²ä¸ºâ€œAIå¯è°ƒç”¨çš„æ’ä»¶â€</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ§©-æ‹“å±•æç¤ºï¼ˆå¦‚æœä½ åœ¨é¡¹ç›®é‡Œç”¨ï¼‰ï¼š"><a href="#ğŸ§©-æ‹“å±•æç¤ºï¼ˆå¦‚æœä½ åœ¨é¡¹ç›®é‡Œç”¨ï¼‰ï¼š" class="headerlink" title="ğŸ§© æ‹“å±•æç¤ºï¼ˆå¦‚æœä½ åœ¨é¡¹ç›®é‡Œç”¨ï¼‰ï¼š"></a>ğŸ§© æ‹“å±•æç¤ºï¼ˆå¦‚æœä½ åœ¨é¡¹ç›®é‡Œç”¨ï¼‰ï¼š</h2><p>Spring AI åœ¨è¿è¡Œæ—¶ä¼šæ‰«æ <code>@Tool</code> æ³¨è§£çš„æ–¹æ³•ï¼Œç„¶åè‡ªåŠ¨æ³¨å†Œæˆå·¥å…·ä¾› LLM ä½¿ç”¨ã€‚ä½ ä¹Ÿå¯ä»¥ç»„åˆä½¿ç”¨ <code>@AiFunction</code> &#x2F; <code>@AiMessageMapping</code> ç­‰ä¸€èµ·æ„å»ºå®Œæ•´çš„ä¼šè¯å¤„ç†ç³»ç»Ÿã€‚</p>
<hr>
<h2 id="ğŸ§ -ä¸€å¥è¯ç†è§£-ToolParam"><a href="#ğŸ§ -ä¸€å¥è¯ç†è§£-ToolParam" class="headerlink" title="ğŸ§  ä¸€å¥è¯ç†è§£ @ToolParam"></a>ğŸ§  ä¸€å¥è¯ç†è§£ <code>@ToolParam</code></h2><blockquote>
<p><code>@ToolParam</code> ç”¨æ¥å‘Šè¯‰å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ï¼š<br> âœ… è¿™ä¸ªå­—æ®µæ˜¯å¯ä»¥ä½œä¸ºå·¥å…·æ–¹æ³•çš„â€œå‚æ•°â€ï¼Œå¹¶ä¸”é™„å¸¦â€œæè¿°â€å’Œâ€œæ˜¯å¦å¿…å¡«â€ç­‰ä¿¡æ¯ã€‚</p>
</blockquote>
<p>å°±åƒæ˜¯ä½ åœ¨ä¸º AI å†™ä¸€ä¸ª API çš„å‚æ•°æ–‡æ¡£ï¼ŒAI ä¼šæ ¹æ®è¿™äº›å…ƒä¿¡æ¯ç†è§£å¹¶æ„é€ å‚æ•°ï¼Œç„¶åè°ƒç”¨ä½ çš„æ–¹æ³•ã€‚</p>
<hr>
<h2 id="ğŸ“¦-æ³¨è§£æ¥æº"><a href="#ğŸ“¦-æ³¨è§£æ¥æº" class="headerlink" title="ğŸ“¦ æ³¨è§£æ¥æº"></a>ğŸ“¦ æ³¨è§£æ¥æº</h2><pre><code class="java">import org.springframework.ai.tool.annotation.ToolParam;
</code></pre>
<p>è¿™æ˜¯ <strong>Spring AI</strong> æ¡†æ¶ä¸­ä¸“ä¸º <strong>Function Calling å·¥å…·æ–¹æ³•å‚æ•°è§£æ</strong> æä¾›çš„æ³¨è§£ã€‚</p>
<hr>
<h2 id="ğŸ”-æ¯ä¸ªå­—æ®µçš„è®²è§£ï¼š"><a href="#ğŸ”-æ¯ä¸ªå­—æ®µçš„è®²è§£ï¼š" class="headerlink" title="ğŸ” æ¯ä¸ªå­—æ®µçš„è®²è§£ï¼š"></a>ğŸ” æ¯ä¸ªå­—æ®µçš„è®²è§£ï¼š</h2><pre><code class="java">@ToolParam(required = false, description = &quot;è¯¾ç¨‹ç±»å‹ï¼šç¼–ç¨‹ã€è®¾è®¡ã€è‡ªåª’ä½“ã€å…¶å®ƒ&quot;)
private String type;
</code></pre>
<ul>
<li><code>required = false</code>ï¼šä¸æ˜¯å¿…å¡«é¡¹ï¼ŒAI å¯ä»¥é€‰æ‹©æ€§æä¾›</li>
<li><code>description = ...</code>ï¼šå‘Šè¯‰ AI è¿™æ˜¯â€œè¯¾ç¨‹ç±»å‹â€ï¼Œå¹¶ä¸”æœ‰å“ªäº›å€¼æ˜¯å¸¸è§çš„</li>
</ul>
<p>è¿™ä¸ªä¿¡æ¯æœ€ç»ˆä¼šè¢«ç”¨æ¥ç”Ÿæˆ AI å¯è°ƒç”¨å‡½æ•°çš„â€œå‚æ•°å®šä¹‰â€ã€‚</p>
<hr>
<pre><code>javaå¤åˆ¶ç¼–è¾‘@ToolParam(required = false, description = &quot;å­¦å†è¦æ±‚ï¼š0-æ— ã€1-åˆä¸­ã€2-é«˜ä¸­ã€3-å¤§ä¸“ã€4-æœ¬ç§‘åŠæœ¬ç§‘ä»¥ä¸Š&quot;)
private Integer edu;
</code></pre>
<ul>
<li>AI èƒ½ç†è§£ï¼šè¿™ä¸ªå­—æ®µæ¥å—æ•´æ•°ç±»å‹ï¼Œ0~4 è¡¨ç¤ºä¸åŒå­¦å†</li>
</ul>
</blockquote>
<h3 id="åŸºç¡€CRUD"><a href="#åŸºç¡€CRUD" class="headerlink" title="åŸºç¡€CRUD"></a>åŸºç¡€CRUD</h3><h5 id="å‡†å¤‡æ•°æ®åº“è¡¨"><a href="#å‡†å¤‡æ•°æ®åº“è¡¨" class="headerlink" title="å‡†å¤‡æ•°æ®åº“è¡¨"></a>å‡†å¤‡æ•°æ®åº“è¡¨</h5><pre><code class="yaml">-- å¯¼å‡º itheima çš„æ•°æ®åº“ç»“æ„
DROP DATABASE IF EXISTS `itheima`;
CREATE DATABASE IF NOT EXISTS `itheima`;
USE `itheima`;

-- å¯¼å‡º  è¡¨ itheima.course ç»“æ„
DROP TABLE IF EXISTS `course`;
CREATE TABLE IF NOT EXISTS `course` (
  `id` int unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;ä¸»é”®&#39;,
  `name` varchar(50) COLLATE utf8mb4_general_ci NOT NULL DEFAULT &#39;&#39; COMMENT &#39;å­¦ç§‘åç§°&#39;,
  `edu` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;å­¦å†èƒŒæ™¯è¦æ±‚ï¼š0-æ— ï¼Œ1-åˆä¸­ï¼Œ2-é«˜ä¸­ã€3-å¤§ä¸“ã€4-æœ¬ç§‘ä»¥ä¸Š&#39;,
  `type` varchar(50) COLLATE utf8mb4_general_ci NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;è¯¾ç¨‹ç±»å‹ï¼šç¼–ç¨‹ã€è®¾è®¡ã€è‡ªåª’ä½“ã€å…¶å®ƒ&#39;,
  `price` bigint NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;è¯¾ç¨‹ä»·æ ¼&#39;,
  `duration` int unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;å­¦ä¹ æ—¶é•¿ï¼Œå•ä½: å¤©&#39;,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=20 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT=&#39;å­¦ç§‘è¡¨&#39;;

-- æ­£åœ¨å¯¼å‡ºè¡¨  itheima.course çš„æ•°æ®ï¼š~7 rows (å¤§çº¦)
DELETE FROM `course`;
INSERT INTO `course` (`id`, `name`, `edu`, `type`, `price`, `duration`) VALUES
  (1, &#39;JavaEE&#39;, 4, &#39;ç¼–ç¨‹&#39;, 21999, 108),
  (2, &#39;é¸¿è’™åº”ç”¨å¼€å‘&#39;, 3, &#39;ç¼–ç¨‹&#39;, 20999, 98),
  (3, &#39;AIäººå·¥æ™ºèƒ½&#39;, 4, &#39;ç¼–ç¨‹&#39;, 24999, 100),
  (4, &#39;Pythonå¤§æ•°æ®å¼€å‘&#39;, 4, &#39;ç¼–ç¨‹&#39;, 23999, 102),
  (5, &#39;è·¨å¢ƒç”µå•†&#39;, 0, &#39;è‡ªåª’ä½“&#39;, 12999, 68),
  (6, &#39;æ–°åª’ä½“è¿è¥&#39;, 0, &#39;è‡ªåª’ä½“&#39;, 10999, 61),
  (7, &#39;UIè®¾è®¡&#39;, 2, &#39;è®¾è®¡&#39;, 11999, 66);

-- å¯¼å‡º  è¡¨ itheima.course_reservation ç»“æ„
DROP TABLE IF EXISTS `course_reservation`;
CREATE TABLE IF NOT EXISTS `course_reservation` (
  `id` int NOT NULL AUTO_INCREMENT,
  `course` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT &#39;&#39; COMMENT &#39;é¢„çº¦è¯¾ç¨‹&#39;,
  `student_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT &#39;å­¦ç”Ÿå§“å&#39;,
  `contact_info` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT &#39;è”ç³»æ–¹å¼&#39;,
  `school` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT &#39;é¢„çº¦æ ¡åŒº&#39;,
  `remark` text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci COMMENT &#39;å¤‡æ³¨&#39;,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- æ­£åœ¨å¯¼å‡ºè¡¨  itheima.course_reservation çš„æ•°æ®ï¼š~0 rows (å¤§çº¦)
DELETE FROM `course_reservation`;
INSERT INTO `course_reservation` (`id`, `course`, `student_name`, `contact_info`, `school`, `remark`) VALUES
  (1, &#39;æ–°åª’ä½“è¿è¥&#39;, &#39;å¼ ä¸‰ä¸°&#39;, &#39;13899762348&#39;, &#39;å¹¿ä¸œæ ¡åŒº&#39;, &#39;å®‰æ’ä¸€ä¸ªå¥½ç‚¹çš„è€å¸ˆ&#39;);

-- å¯¼å‡º  è¡¨ itheima.school ç»“æ„
DROP TABLE IF EXISTS `school`;
CREATE TABLE IF NOT EXISTS `school` (
  `id` int unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;ä¸»é”®&#39;,
  `name` varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT &#39;æ ¡åŒºåç§°&#39;,
  `city` varchar(50) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT &#39;æ ¡åŒºæ‰€åœ¨åŸå¸‚&#39;,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT=&#39;æ ¡åŒºè¡¨&#39;;

-- æ­£åœ¨å¯¼å‡ºè¡¨  itheima.school çš„æ•°æ®ï¼š~0 rows (å¤§çº¦)
DELETE FROM `school`;
INSERT INTO `school` (`id`, `name`, `city`) VALUES
  (1, &#39;æ˜Œå¹³æ ¡åŒº&#39;, &#39;åŒ—äº¬&#39;),
  (2, &#39;é¡ºä¹‰æ ¡åŒº&#39;, &#39;åŒ—äº¬&#39;),
  (3, &#39;æ­å·æ ¡åŒº&#39;, &#39;æ­å·&#39;),
  (4, &#39;ä¸Šæµ·æ ¡åŒº&#39;, &#39;ä¸Šæµ·&#39;),
  (5, &#39;å—äº¬æ ¡åŒº&#39;, &#39;å—äº¬&#39;),
  (6, &#39;è¥¿å®‰æ ¡åŒº&#39;, &#39;è¥¿å®‰&#39;),
  (7, &#39;éƒ‘å·æ ¡åŒº&#39;, &#39;éƒ‘å·&#39;),
  (8, &#39;å¹¿ä¸œæ ¡åŒº&#39;, &#39;å¹¿ä¸œ&#39;),
  (9, &#39;æ·±åœ³æ ¡åŒº&#39;, &#39;æ·±åœ³&#39;);
</code></pre>
<h6 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h6><pre><code class="yaml">&lt;dependency&gt;
    &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis-plus-spring-boot3-starter&lt;/artifactId&gt;
    &lt;version&gt;3.5.10.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h6 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h6><pre><code class="yaml">spring:
  application:
    name: heima-ai
  ai:
    ollama:
      base-url: http://localhost:11434
      chat:
        model: deepseek-r1:1.5b
    openai:
      base-url: https://dashscope.aliyuncs.com/compatible-mode
      api-key: $&#123;OPENAI_API_KEY&#125;
      chat:
        options:
          model: qwen-max-latest
      embedding:
        options:
          model: text-embedding-v3
          dimensions: 1024
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/itheima?serverTimezone=Asia/Shanghai&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;transformedBitIsBoolean=true&amp;tinyInt1isBit=false&amp;allowPublicKeyRetrieval=true&amp;allowMultiQueries=true&amp;useServerPrepStmts=false
    username: root
    password: root
logging:
    level:
      org.springframework.ai.chat.client.advisor: debug
      com.itheima.ai: debug
</code></pre>
<h5 id="CRUDåŸºç¡€ä»£ç è®©Ideaçš„Otherçš„Mybatis-Pluså»ç”Ÿæˆã€è¦å…ˆåœ¨æ•°æ®åº“å¯¼å…¥æ•°æ®è¡¨ã€‘"><a href="#CRUDåŸºç¡€ä»£ç è®©Ideaçš„Otherçš„Mybatis-Pluså»ç”Ÿæˆã€è¦å…ˆåœ¨æ•°æ®åº“å¯¼å…¥æ•°æ®è¡¨ã€‘" class="headerlink" title="CRUDåŸºç¡€ä»£ç è®©Ideaçš„Otherçš„Mybatis-Pluså»ç”Ÿæˆã€è¦å…ˆåœ¨æ•°æ®åº“å¯¼å…¥æ•°æ®è¡¨ã€‘"></a>CRUDåŸºç¡€ä»£ç è®©Ideaçš„<code>Other</code>çš„Mybatis-Pluså»ç”Ÿæˆã€è¦å…ˆåœ¨æ•°æ®åº“å¯¼å…¥æ•°æ®è¡¨ã€‘</h5><h5 id="3-1-4-1-å®ä½“ç±»"><a href="#3-1-4-1-å®ä½“ç±»" class="headerlink" title="3.1.4.1.å®ä½“ç±»"></a>3.1.4.1.å®ä½“ç±»</h5><p>åœ¨<code>com.itheima.ai.entity</code>åŒ…ä¸‹æ·»åŠ ä¸€ä¸ª<code>po</code>åŒ…ï¼Œå‘å…¶ä¸­æ·»åŠ ä¸‰å¼ è¡¨å¯¹åº”çš„å®ä½“ç±»ï¼š</p>
<p><strong>å­¦ç§‘è¡¨</strong>ï¼š</p>
<pre><code class="Java">package com.itheima.ai.entity.po;

import com.baomidou.mybatisplus.annotation.TableName;
import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import java.io.Serializable;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.experimental.Accessors;

@Data
@EqualsAndHashCode(callSuper = false)
@Accessors(chain = true)
@TableName(&quot;course&quot;)
public class Course implements Serializable &#123;

    private static final long serialVersionUID = 1L;

    /**
     * ä¸»é”®
     */
    @TableId(value = &quot;id&quot;, type = IdType.AUTO)
    private Integer id;

    /**
     * å­¦ç§‘åç§°
     */
    private String name;

    /**
     * å­¦å†èƒŒæ™¯è¦æ±‚ï¼š0-æ— ï¼Œ1-åˆä¸­ï¼Œ2-é«˜ä¸­ã€3-å¤§ä¸“ã€4-æœ¬ç§‘ä»¥ä¸Š
     */
    private Integer edu;

    /**
     * ç±»å‹: ç¼–ç¨‹ã€éç¼–ç¨‹
     */
    private String type;

    /**
     * è¯¾ç¨‹ä»·æ ¼
     */
    private Long price;

    /**
     * å­¦ä¹ æ—¶é•¿ï¼Œå•ä½: å¤©
     */
    private Integer duration;


&#125;
</code></pre>
<p><strong>æ ¡åŒºè¡¨</strong>ï¼š</p>
<pre><code class="Java">package com.itheima.ai.entity.po;

import com.baomidou.mybatisplus.annotation.TableName;
import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import java.io.Serializable;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.experimental.Accessors;

@Data
@EqualsAndHashCode(callSuper = false)
@Accessors(chain = true)
@TableName(&quot;school&quot;)
public class School implements Serializable &#123;

    private static final long serialVersionUID = 1L;

    /**
     * ä¸»é”®
     */
    @TableId(value = &quot;id&quot;, type = IdType.AUTO)
    private Integer id;

    /**
     * æ ¡åŒºåç§°
     */
    private String name;

    /**
     * æ ¡åŒºæ‰€åœ¨åŸå¸‚
     */
    private String city;


&#125;
</code></pre>
<p><strong>è¯¾ç¨‹é¢„çº¦è¡¨</strong>ï¼š</p>
<pre><code class="Java">package com.itheima.ai.entity.po;

import com.baomidou.mybatisplus.annotation.TableName;
import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import java.io.Serializable;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.experimental.Accessors;

@Data
// ï¼ˆæ¥è‡ª Lombokï¼‰  æ§åˆ¶æ˜¯å¦è°ƒç”¨çˆ¶ç±»çš„ equals() å’Œ hashCode()
/*
ğŸ“Œ ä¸¾ä¾‹è¯´æ˜ï¼š
å¦‚æœä½ çš„ç±»ç»§æ‰¿äº†æŸä¸ªåŸºç±»ï¼š
public class School extends BaseEntity
å¦‚æœ callSuper = trueï¼Œæ¯”è¾ƒæ—¶ä¼šè¿ BaseEntity çš„å­—æ®µä¹Ÿä¸€å—æ¯”ï¼›
å¦‚æœ falseï¼ˆå¦‚å½“å‰è¿™æ ·ï¼‰ï¼Œåªæ¯”è¾ƒ School è‡ªå·±çš„å­—æ®µã€‚
*/
@EqualsAndHashCode(callSuper = false)  
// å¼€å¯é“¾å¼è°ƒç”¨é£æ ¼çš„ setter æ–¹æ³•
/*
åŸæœ¬çš„è°ƒç”¨æ–¹å¼æ˜¯ï¼š
school.setName(&quot;ä¸œæ ¡åŒº&quot;);
school.setCity(&quot;åŒ—äº¬&quot;);

åŠ ä¸Šè¿™ä¸ªæ³¨è§£åï¼Œä½ å¯ä»¥è¿™æ ·å†™ï¼š
school.setName(&quot;ä¸œæ ¡åŒº&quot;).setCity(&quot;åŒ—äº¬&quot;); // è¿èµ·æ¥å†™
*/
@Accessors(chain = true)
@TableName(&quot;course_reservation&quot;)
public class CourseReservation implements Serializable &#123;

    private static final long serialVersionUID = 1L;

    @TableId(value = &quot;id&quot;, type = IdType.AUTO)
    private Integer id;

    /**
     * é¢„çº¦è¯¾ç¨‹
     */
    private String course;

    /**
     * å­¦ç”Ÿå§“å
     */
    private String studentName;

    /**
     * è”ç³»æ–¹å¼
     */
    private String contactInfo;

    /**
     * é¢„çº¦æ ¡åŒº
     */
    private String school;

    /**
     * å¤‡æ³¨
     */
    private String remark;


&#125;
</code></pre>
<h5 id="3-1-4-2-Mapperæ¥å£"><a href="#3-1-4-2-Mapperæ¥å£" class="headerlink" title="3.1.4.2.Mapperæ¥å£"></a>3.1.4.2.Mapperæ¥å£</h5><p>ç„¶åæ˜¯Mapperæ¥å£ï¼Œåˆ›å»ºä¸€ä¸ª<code>com.itheima.ai.mapper</code>åŒ…ï¼Œç„¶ååœ¨å…¶ä¸­å†™ä¸‰ä¸ªMapperï¼š</p>
<p><strong>CourseMapper</strong>:</p>
<pre><code class="Java">package com.itheima.ai.mapper;

import com.itheima.ai.entity.po.Course;
import com.baomidou.mybatisplus.core.mapper.BaseMapper;

public interface CourseMapper extends BaseMapper&lt;Course&gt; &#123;

&#125;
</code></pre>
<p><strong>SchoolMapper</strong>ï¼š</p>
<pre><code class="Java">package com.itheima.ai.mapper;

import com.itheima.ai.entity.po.School;
import com.baomidou.mybatisplus.core.mapper.BaseMapper;

public interface SchoolMapper extends BaseMapper&lt;School&gt; &#123;

&#125;
</code></pre>
<p><strong>CourseReservationMapper</strong>:</p>
<pre><code class="Java">package com.itheima.ai.mapper;

import com.itheima.ai.entity.po.CourseReservation;
import com.baomidou.mybatisplus.core.mapper.BaseMapper;

public interface CourseReservationMapper extends BaseMapper&lt;CourseReservation&gt; &#123;

&#125;
</code></pre>
<h5 id="3-1-4-3-Service"><a href="#3-1-4-3-Service" class="headerlink" title="3.1.4.3.Service"></a>3.1.4.3.Service</h5><p>åˆ›å»º<code>com.itheima.ai.service</code>åŒ…ï¼Œæ·»åŠ 3ä¸ªæ¥å£ï¼š</p>
<p><strong>å­¦ç§‘Serviceæ¥å£</strong>ï¼š</p>
<pre><code class="Java">package com.itheima.ai.service;

import com.itheima.ai.entity.po.Course;
import com.baomidou.mybatisplus.extension.service.IService;

public interface ICourseService extends IService&lt;Course&gt; &#123;

&#125;
</code></pre>
<p><strong>æ ¡åŒºServiceæ¥å£</strong>ï¼š</p>
<pre><code class="Java">package com.itheima.ai.service;

import com.itheima.ai.entity.po.School;
import com.baomidou.mybatisplus.extension.service.IService;

public interface ISchoolService extends IService&lt;School&gt; &#123;

&#125;
</code></pre>
<p><strong>è¯¾ç¨‹é¢„çº¦Serviceæ¥å£</strong>ï¼š</p>
<pre><code class="Java">package com.itheima.ai.service;

import com.itheima.ai.entity.po.CourseReservation;
import com.baomidou.mybatisplus.extension.service.IService;

public interface ICourseReservationService extends IService&lt;CourseReservation&gt; &#123;

&#125;
</code></pre>
<p>ç„¶ååˆ›å»ºcom.itheima.ai.service.implåŒ…ï¼Œå†™3ä¸ªå®ç°ç±»ï¼š</p>
<pre><code class="Java">package com.itheima.ai.service.impl;

import com.itheima.ai.entity.po.Course;
import com.itheima.ai.mapper.CourseMapper;
import com.itheima.ai.service.ICourseService;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import org.springframework.stereotype.Service;

/**
 * å­¦ç§‘è¡¨ æœåŠ¡å®ç°ç±»
 */
@Service
public class CourseServiceImpl extends ServiceImpl&lt;CourseMapper, Course&gt; implements ICourseService &#123;

&#125;
package com.itheima.ai.service.impl;

import com.itheima.ai.entity.po.School;
import com.itheima.ai.mapper.SchoolMapper;
import com.itheima.ai.service.ISchoolService;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import org.springframework.stereotype.Service;

/**
 * æ ¡åŒºè¡¨ æœåŠ¡å®ç°ç±»
 */
@Service
public class SchoolServiceImpl extends ServiceImpl&lt;SchoolMapper, School&gt; implements ISchoolService &#123;

&#125;
package com.itheima.ai.service.impl;

import com.itheima.ai.entity.po.CourseReservation;
import com.itheima.ai.mapper.CourseReservationMapper;
import com.itheima.ai.service.ICourseReservationService;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import org.springframework.stereotype.Service;

/**
 *  æœåŠ¡å®ç°ç±»
 */
@Service
public class CourseReservationServiceImpl extends ServiceImpl&lt;CourseReservationMapper, CourseReservation&gt; implements ICourseReservationService &#123;

&#125;
</code></pre>
<h3 id="3-2-å®šä¹‰Function"><a href="#3-2-å®šä¹‰Function" class="headerlink" title="3.2.å®šä¹‰Function"></a>3.2.å®šä¹‰Function</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å®šä¹‰AIè¦ç”¨åˆ°çš„Functionï¼Œåœ¨SpringAIä¸­å«åšTool</p>
<p>æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸‰ä¸ªFunctionï¼š</p>
<ul>
<li>æ ¹æ®æ¡ä»¶ç­›é€‰å’ŒæŸ¥è¯¢è¯¾ç¨‹</li>
<li>æŸ¥è¯¢æ ¡åŒºåˆ—è¡¨</li>
<li>æ–°å¢è¯•å¬é¢„çº¦å•</li>
</ul>
<h4 id="3-2-1-æŸ¥è¯¢æ¡ä»¶åˆ†æ"><a href="#3-2-1-æŸ¥è¯¢æ¡ä»¶åˆ†æ" class="headerlink" title="3.2.1.æŸ¥è¯¢æ¡ä»¶åˆ†æ"></a>3.2.1.æŸ¥è¯¢æ¡ä»¶åˆ†æ</h4><p>å…ˆæ¥çœ‹ä¸‹è¯¾ç¨‹è¡¨çš„å­—æ®µï¼š</p>
<p><img src="E:/BaiduNetdiskDownload/å…¨å¥—ï¼š25å¹´3æœˆDeepSeek+SpringAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘/é…å¥—èµ„æ–™/ç¬”è®°/mdç¬”è®°/ç¬”è®°å›¾ç‰‡/image-20250409091540133.png" alt="image-20250409091540133"> </p>
<p>è¯¾ç¨‹å¹¶ä¸æ˜¯é€‚ç”¨äºæ‰€æœ‰äººï¼Œä¼šæœ‰ä¸€äº›é™åˆ¶æ¡ä»¶ï¼Œæ¯”å¦‚ï¼šå­¦å†ã€è¯¾ç¨‹ç±»å‹ã€ä»·æ ¼ã€å­¦ä¹ æ—¶é•¿ç­‰</p>
<p>å­¦ç”Ÿåœ¨ä¸æ™ºèƒ½å®¢æœå¯¹è¯æ—¶ï¼Œä¼šæœ‰ä¸€å®šçš„åå¥½ï¼Œæ¯”å¦‚å…´è¶£ä¸åŒã€å¯¹ä»·æ ¼æ•æ„Ÿã€å¯¹å­¦ä¹ æ—¶é•¿æ•æ„Ÿã€å­¦å†ç­‰ã€‚å¦‚æœæŠŠè¿™äº›æ¡ä»¶ç”¨SQLæ¥è¡¨ç¤ºï¼Œæ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>eduï¼šä¾‹å¦‚å­¦ç”Ÿå­¦å†æ˜¯é«˜ä¸­ï¼Œåˆ™æŸ¥è¯¢æ—¶è¦æ»¡è¶³ edu &lt;&#x3D; 2</li>
<li>typeï¼šå­¦ç”Ÿçš„å­¦ä¹ å…´è¶£ï¼Œè¦è·Ÿç±»å‹ç²¾ç¡®åŒ¹é…ï¼Œtype &#x3D; â€˜è‡ªåª’ä½“â€™</li>
<li>priceï¼šå­¦ç”Ÿå¯¹ä»·æ ¼æ•æ„Ÿï¼Œåˆ™æŸ¥è¯¢æ—¶éœ€è¦æŒ‰ç…§ä»·æ ¼å‡åºæ’åˆ—ï¼šorder by price asc</li>
<li>duration: å­¦ç”Ÿå¯¹å­¦ä¹ æ—¶é•¿æ•æ„Ÿï¼Œåˆ™æŸ¥è¯¢æ—¶è¦æŒ‰ç…§æ—¶é•¿å‡åºï¼šorder by duration asc</li>
</ul>
<p>æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªç±»ï¼Œå°è£…è¿™äº›å¯èƒ½çš„æŸ¥è¯¢æ¡ä»¶ã€‚</p>
<p>åœ¨<code>com.itheima.ai.entity</code>ä¸‹æ–°å»ºä¸€ä¸ª<code>query</code>åŒ…ï¼Œå…¶ä¸­æ–°å»ºä¸€ä¸ªç±»ï¼š</p>
<pre><code class="Java">package com.itheima.ai.entity.query;

import lombok.Data;
import org.springframework.ai.tool.annotation.ToolParam;

import java.util.List;

@Data
public class CourseQuery &#123;
    @ToolParam(required = false, description = &quot;è¯¾ç¨‹ç±»å‹ï¼šç¼–ç¨‹ã€è®¾è®¡ã€è‡ªåª’ä½“ã€å…¶å®ƒ&quot;)
    private String type;
    @ToolParam(required = false, description = &quot;å­¦å†è¦æ±‚ï¼š0-æ— ã€1-åˆä¸­ã€2-é«˜ä¸­ã€3-å¤§ä¸“ã€4-æœ¬ç§‘åŠæœ¬ç§‘ä»¥ä¸Š&quot;)
    private Integer edu;
    @ToolParam(required = false, description = &quot;æ’åºæ–¹å¼&quot;)
    private List&lt;Sort&gt; sorts;

    @Data
    public static class Sort &#123;
        @ToolParam(required = false, description = &quot;æ’åºå­—æ®µ: priceæˆ–duration&quot;)
        private String field;
        @ToolParam(required = false, description = &quot;æ˜¯å¦æ˜¯å‡åº: true/false&quot;)
        private Boolean asc;
    &#125;
&#125;
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<p>è¿™é‡Œçš„<code>@ToolParam</code>æ³¨è§£æ˜¯SpringAIæä¾›çš„ç”¨æ¥è§£é‡Š<code>Function</code>å‚æ•°çš„æ³¨è§£ã€‚å…¶ä¸­çš„ä¿¡æ¯éƒ½ä¼šé€šè¿‡æç¤ºè¯çš„æ–¹å¼å‘é€ç»™AIæ¨¡å‹ã€‚</p>
<p>åŒæ ·çš„é“ç†ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥ç»™<code>Function</code>å®šä¹‰ä¸“é—¨çš„VOï¼Œä½œä¸ºè¿”å›å€¼ç»™åˆ°å¤§æ¨¡å‹ã€‚è¿™é‡Œæˆ‘ä»¬å°±çœç•¥äº†ã€‚ã€‚</p>
<pre><code class="java">com/itheima/ai/entity/query/CourseReservationQuery.java
package com.itheima.ai.entity.query;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.ai.tool.annotation.ToolParam;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class CourseReservationQuery &#123;
    @ToolParam(required = false, description = &quot;é¢„çº¦è¯¾ç¨‹&quot;)
    private String courseName;
    @ToolParam(required = false, description = &quot;é¢„çº¦æ ¡åŒº&quot;)
    private String schoolName;
    @ToolParam(required = false, description = &quot;ç”¨æˆ·åç§°&quot;)
    private String userName;
    @ToolParam(required = false, description = &quot;å¤‡æ³¨&quot;)
    private String remark;
    @ToolParam(required = false, description = &quot;è”ç³»æ–¹å¼&quot;)
    private String contactInfo;
&#125;
</code></pre>
<pre><code class="java">com/itheima/ai/entity/query/SchoolQuery.java
package com.itheima.ai.entity.query;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.ai.tool.annotation.ToolParam;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class SchoolQuery &#123;
    @ToolParam(required = false, description = &quot;æ ¡åŒºåç§°&quot;)
    private String name;
    @ToolParam(required = false, description = &quot;æ ¡åŒºåŸå¸‚&quot;)
    private String city;
&#125;
</code></pre>
<pre><code class="java">com/itheima/ai/tools/CourseTools.java
package com.itheima.ai.tools;

import com.baomidou.mybatisplus.extension.conditions.query.QueryChainWrapper;
import com.itheima.ai.entity.po.Course;
import com.itheima.ai.entity.po.CourseReservation;
import com.itheima.ai.entity.po.School;
import com.itheima.ai.entity.query.CourseQuery;
import com.itheima.ai.entity.query.CourseReservationQuery;
import com.itheima.ai.entity.query.SchoolQuery;
import com.itheima.ai.service.ICourseReservationService;
import com.itheima.ai.service.ICourseService;
import com.itheima.ai.service.ISchoolService;
import lombok.RequiredArgsConstructor;
import org.springframework.ai.tool.annotation.Tool;
import org.springframework.ai.tool.annotation.ToolParam;
import org.springframework.stereotype.Component;

import java.util.List;

@RequiredArgsConstructor
@Component
public class CourseTools &#123;
    private final ICourseService courseService;
    private final ISchoolService schoolService;
    private final ICourseReservationService courseReservationService;


    // @Toolæ³¨è§£æ˜¯æ ‡ç»™aiå»çœ‹çš„
    @Tool(description = &quot;æ ¹æ®æ¡ä»¶æŸ¥è¯¢è¯¾ç¨‹&quot;)
    List&lt;Course&gt; queryCourse(@ToolParam(description = &quot;æŸ¥è¯¢çš„æ¡ä»¶&quot;) CourseQuery query) &#123;
        if (query == null) &#123;
            return courseService.list();
//            return List.of();
        &#125;
        QueryChainWrapper&lt;Course&gt; courseWrapper = courseService.query()
                .eq(query.getType() != null, &quot;type&quot;, query.getType()) // type = &#39;ç¼–ç¨‹&#39;
                .le(query.getEdu() != null, &quot;edu&quot;, query.getEdu()); // edu &lt;= 2
        if (query.getSorts() != null &amp;&amp; !query.getSorts().isEmpty()) &#123;
            for (CourseQuery.Sort sort : query.getSorts()) &#123;
                courseWrapper.orderBy(true, sort.getAsc(), sort.getField());
            &#125;
        &#125;
        return courseWrapper.list();
    &#125;

    @Tool(description = &quot;æŸ¥è¯¢æ‰€æœ‰æ ¡åŒº&quot;)
    public List&lt;School&gt; querySchool(@ToolParam(description = &quot;æŸ¥è¯¢çš„æ¡ä»¶&quot;) SchoolQuery query) &#123;
        if (query == null) &#123;
            return List.of();
        &#125;
        QueryChainWrapper&lt;School&gt; schoolWrapper = schoolService.query()
                .eq(query.getName() != null, &quot;name&quot;, query.getName())
                .eq(query.getCity() != null, &quot;city&quot;, query.getCity());
        return schoolWrapper.list();
    &#125;

    @Tool(description = &quot;ç”Ÿæˆé¢„çº¦å•ï¼Œè¿”å›é¢„çº¦å•å·&quot;)
    public Integer queryCourseReservation(@ToolParam(description = &quot;æŸ¥è¯¢çš„æ¡ä»¶&quot;) CourseReservationQuery query) &#123;
        CourseReservation courseReservation = new CourseReservation();
        courseReservation.setCourse(query.getCourseName());
        courseReservation.setSchool(query.getSchoolName());
        courseReservation.setStudentName(query.getUserName());
        courseReservation.setContactInfo(query.getContactInfo());
        courseReservation.setRemark(query.getRemark());
        courseReservationService.save(courseReservation);
        return courseReservation.getId();
    &#125;
&#125;
</code></pre>
<h4 id="è¿™é‡Œæœ‰ä¸ªbug-å°±æ˜¯é˜¿é‡Œäº‘ç™¾ç‚¼å’ŒFunction-Callingæœ‰ä¸å…¼å®¹é—®é¢˜-è¿”å›çš„JSONæœ‰é—®é¢˜"><a href="#è¿™é‡Œæœ‰ä¸ªbug-å°±æ˜¯é˜¿é‡Œäº‘ç™¾ç‚¼å’ŒFunction-Callingæœ‰ä¸å…¼å®¹é—®é¢˜-è¿”å›çš„JSONæœ‰é—®é¢˜" class="headerlink" title="è¿™é‡Œæœ‰ä¸ªbug å°±æ˜¯é˜¿é‡Œäº‘ç™¾ç‚¼å’ŒFunction Callingæœ‰ä¸å…¼å®¹é—®é¢˜ [è¿”å›çš„JSONæœ‰é—®é¢˜]"></a>è¿™é‡Œæœ‰ä¸ªbug å°±æ˜¯é˜¿é‡Œäº‘ç™¾ç‚¼å’ŒFunction Callingæœ‰ä¸å…¼å®¹é—®é¢˜ [è¿”å›çš„JSONæœ‰é—®é¢˜]</h4><p>è§£å†³æ–¹æ¡ˆï¼šæŠŠè¿”å›çš„å‚æ•°æ‹¼æ¥åœ¨ä¸€èµ·</p>
<pre><code class="java">com/itheima/ai/config/CommonConfiguration.java
package com.itheima.ai.config;

import com.itheima.ai.constants.SystemConstants;
import com.itheima.ai.model.AlibabaOpenAiChatModel;
import com.itheima.ai.tools.CourseTools;
import io.micrometer.observation.ObservationRegistry;
import org.springframework.ai.autoconfigure.openai.OpenAiChatProperties;
import org.springframework.ai.autoconfigure.openai.OpenAiConnectionProperties;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;
import org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor;
import org.springframework.ai.chat.memory.ChatMemory;
import org.springframework.ai.chat.memory.InMemoryChatMemory;
import org.springframework.ai.chat.observation.ChatModelObservationConvention;
import org.springframework.ai.model.SimpleApiKey;
import org.springframework.ai.model.tool.ToolCallingManager;
import org.springframework.ai.ollama.OllamaChatModel;
import org.springframework.ai.openai.OpenAiChatModel;
import org.springframework.ai.openai.api.OpenAiApi;
import org.springframework.beans.factory.ObjectProvider;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.retry.support.RetryTemplate;
import org.springframework.util.CollectionUtils;
import org.springframework.util.StringUtils;
import org.springframework.web.client.ResponseErrorHandler;
import org.springframework.web.client.RestClient;
import org.springframework.web.reactive.function.client.WebClient;

import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Objects;

@Configuration
public class CommonConfiguration &#123;

    @Bean
    public ChatMemory chatMemory() &#123;
        // åˆ›å»ºä¼šè¯å†…å­˜ï¼Œä¼ å…¥ä¼šè¯idï¼Œæ¯”å¦‚&quot;default&quot;
        // å®šä¹‰å­˜å‚¨æ–¹å¼ ç›®å‰æ˜¯åœ¨å­˜å‚¨å†…å­˜é’Ÿ
        return new InMemoryChatMemory();
    &#125;

    @Bean
    public ChatClient chatClient(OllamaChatModel model, ChatMemory chatMemory) &#123;
        return ChatClient.builder(model)
                .defaultSystem(&quot;ä½ æ˜¯ä¸€åªçŒ«å¨˜ï¼Œä½ æ¥ä¸‹æ¥è¦ä»¥çŒ«å¨˜çš„èº«ä»½å’Œè¯­æ°”è·Ÿæˆ‘è¯´è¯&quot;)
                .defaultAdvisors(new SimpleLoggerAdvisor())
                .defaultAdvisors(MessageChatMemoryAdvisor.builder(chatMemory).build())
                .build();
    &#125;

    @Bean
    public ChatClient gameChatClient(OpenAiChatModel model, ChatMemory chatMemory) &#123;
        return ChatClient.builder(model)
                .defaultSystem(SystemConstants.GAME_SYSTEM_PROMPT)
                .defaultAdvisors(new SimpleLoggerAdvisor())
                .defaultAdvisors(MessageChatMemoryAdvisor.builder(chatMemory).build())
                .build();
    &#125;

    @Bean
    public ChatClient serviceChatClient(AlibabaOpenAiChatModel model, ChatMemory chatMemory, CourseTools courseTools) &#123;
        return ChatClient.builder(model)
                .defaultSystem(SystemConstants.SERVICE_SYSTEM_PROMPT)
                .defaultAdvisors(new SimpleLoggerAdvisor())
                .defaultAdvisors(MessageChatMemoryAdvisor.builder(chatMemory).build())
                .defaultTools(courseTools)
                .build();
    &#125;


    @Bean
    public AlibabaOpenAiChatModel alibabaOpenAiChatModel(OpenAiConnectionProperties commonProperties, OpenAiChatProperties chatProperties, ObjectProvider&lt;RestClient.Builder&gt; restClientBuilderProvider, ObjectProvider&lt;WebClient.Builder&gt; webClientBuilderProvider, ToolCallingManager toolCallingManager, RetryTemplate retryTemplate, ResponseErrorHandler responseErrorHandler, ObjectProvider&lt;ObservationRegistry&gt; observationRegistry, ObjectProvider&lt;ChatModelObservationConvention&gt; observationConvention) &#123;
        String baseUrl = StringUtils.hasText(chatProperties.getBaseUrl()) ? chatProperties.getBaseUrl() : commonProperties.getBaseUrl();
        String apiKey = StringUtils.hasText(chatProperties.getApiKey()) ? chatProperties.getApiKey() : commonProperties.getApiKey();
        String projectId = StringUtils.hasText(chatProperties.getProjectId()) ? chatProperties.getProjectId() : commonProperties.getProjectId();
        String organizationId = StringUtils.hasText(chatProperties.getOrganizationId()) ? chatProperties.getOrganizationId() : commonProperties.getOrganizationId();
        Map&lt;String, List&lt;String&gt;&gt; connectionHeaders = new HashMap&lt;&gt;();
        if (StringUtils.hasText(projectId)) &#123;
            connectionHeaders.put(&quot;OpenAI-Project&quot;, List.of(projectId));
        &#125;

        if (StringUtils.hasText(organizationId)) &#123;
            connectionHeaders.put(&quot;OpenAI-Organization&quot;, List.of(organizationId));
        &#125;
        RestClient.Builder restClientBuilder = restClientBuilderProvider.getIfAvailable(RestClient::builder);
        WebClient.Builder webClientBuilder = webClientBuilderProvider.getIfAvailable(WebClient::builder);
        OpenAiApi openAiApi = OpenAiApi.builder().baseUrl(baseUrl).apiKey(new SimpleApiKey(apiKey)).headers(CollectionUtils.toMultiValueMap(connectionHeaders)).completionsPath(chatProperties.getCompletionsPath()).embeddingsPath(&quot;/v1/embeddings&quot;).restClientBuilder(restClientBuilder).webClientBuilder(webClientBuilder).responseErrorHandler(responseErrorHandler).build();
        AlibabaOpenAiChatModel chatModel = AlibabaOpenAiChatModel.builder().openAiApi(openAiApi).defaultOptions(chatProperties.getOptions()).toolCallingManager(toolCallingManager).retryTemplate(retryTemplate).observationRegistry((ObservationRegistry) observationRegistry.getIfUnique(() -&gt; ObservationRegistry.NOOP)).build();
        Objects.requireNonNull(chatModel);
        observationConvention.ifAvailable(chatModel::setObservationConvention);
        return chatModel;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/itheima/ai/model/AlibabaOpenAiChatModel.java

è¿™é‡Œå°±æ˜¯è¦ç”¨åˆ°OpenAIChatModelçš„åº•å±‚ä»£ç åšæ”¹å†™ å¤ªé•¿äº† å¯çœ‹æºæ–‡ä»¶
æ”¹å†™å¥½ä»¥åå³å¯åœ¨serviceChatclienté‡Œé¢ç”¨è‡ªå·±å®šä¹‰çš„AlibabaOpenAiChatModeläº†
</code></pre>
<h3 id="SpringAIâ€”ChatPDF-å‘é‡æ¨¡å‹"><a href="#SpringAIâ€”ChatPDF-å‘é‡æ¨¡å‹" class="headerlink" title="SpringAIâ€”ChatPDF-å‘é‡æ¨¡å‹"></a>SpringAIâ€”ChatPDF-å‘é‡æ¨¡å‹</h3><h4 id="4-RAGï¼ˆçŸ¥è¯†åº“-ChatPDFï¼‰"><a href="#4-RAGï¼ˆçŸ¥è¯†åº“-ChatPDFï¼‰" class="headerlink" title="4.RAGï¼ˆçŸ¥è¯†åº“ ChatPDFï¼‰"></a>4.RAGï¼ˆçŸ¥è¯†åº“ ChatPDFï¼‰</h4><p>ç”±äºè®­ç»ƒå¤§æ¨¡å‹éå¸¸è€—æ—¶ï¼Œå†åŠ ä¸Šè®­ç»ƒè¯­æ–™æœ¬èº«æ¯”è¾ƒæ»åï¼Œæ‰€ä»¥å¤§æ¨¡å‹å­˜åœ¨<strong>çŸ¥è¯†é™åˆ¶</strong>é—®é¢˜ï¼š</p>
<ul>
<li>çŸ¥è¯†æ•°æ®æ¯”è¾ƒè½åï¼Œå¾€å¾€æ˜¯å‡ ä¸ªæœˆä¹‹å‰çš„</li>
<li>ä¸åŒ…å«å¤ªè¿‡<strong>ä¸“ä¸šé¢†åŸŸ</strong>æˆ–è€…<strong>ä¼ä¸šç§æœ‰</strong>çš„æ•°æ®</li>
</ul>
<p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°RAGäº†ã€‚ä¸‹é¢æˆ‘ä»¬ç®€å•å›é¡¾ä¸‹RAGåŸç†</p>
<h4 id="4-1-RAGåŸç†"><a href="#4-1-RAGåŸç†" class="headerlink" title="4.1.RAGåŸç†"></a>4.1.RAGåŸç†</h4><p>è¦è§£å†³å¤§æ¨¡å‹çš„çŸ¥è¯†é™åˆ¶é—®é¢˜ï¼Œå…¶å®å¹¶ä¸å¤æ‚ã€‚</p>
<p>è§£å†³çš„æ€è·¯å°±æ˜¯ç»™å¤§æ¨¡å‹å¤–æŒ‚ä¸€ä¸ª<strong>çŸ¥è¯†åº“</strong>ï¼Œå¯ä»¥æ˜¯ä¸“ä¸šé¢†åŸŸçŸ¥è¯†ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¼ä¸šç§æœ‰çš„æ•°æ®ã€‚</p>
<p>ä¸è¿‡ï¼ŒçŸ¥è¯†åº“ä¸èƒ½ç®€å•çš„ç›´æ¥æ‹¼æ¥åœ¨æç¤ºè¯ä¸­ã€‚</p>
<p>å› ä¸ºé€šå¸¸çŸ¥è¯†åº“æ•°æ®é‡éƒ½æ˜¯éå¸¸å¤§çš„ï¼Œè€Œå¤§æ¨¡å‹çš„ä¸Šä¸‹æ–‡æ˜¯æœ‰å¤§å°é™åˆ¶çš„ï¼Œæ—©æœŸçš„GPTä¸Šä¸‹æ–‡ä¸èƒ½è¶…è¿‡2000tokenï¼Œç°åœ¨ä¹Ÿä¸åˆ°200k tokenï¼Œå› æ­¤çŸ¥è¯†åº“ä¸èƒ½ç›´æ¥å†™åœ¨æç¤ºè¯ä¸­ã€‚</p>
<p>æ€ä¹ˆåŠï¼Ÿ</p>
<p>æ€è·¯å¾ˆç®€å•ï¼Œåºå¤§çš„çŸ¥è¯†åº“ä¸­ä¸ç”¨æˆ·é—®é¢˜ç›¸å…³çš„å…¶å®å¹¶ä¸å¤šã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æƒ³åŠæ³•<strong>ä»åºå¤§çš„çŸ¥è¯†åº“ä¸­æ‰¾åˆ°ä¸ç”¨æˆ·é—®é¢˜ç›¸å…³çš„ä¸€å°éƒ¨åˆ†ï¼Œç»„è£…æˆæç¤ºè¯</strong>ï¼Œå‘é€ç»™å¤§æ¨¡å‹å°±å¯ä»¥äº†ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ä»çŸ¥è¯†åº“ä¸­æ‰¾åˆ°ä¸ç”¨æˆ·é—®é¢˜ç›¸å…³çš„å†…å®¹å‘¢ï¼Ÿ</p>
<p>å¯èƒ½æœ‰åŒå­¦ä¼šç›¸åˆ°å…¨æ–‡æ£€ç´¢ï¼Œä½†æ˜¯åœ¨è¿™é‡Œæ˜¯ä¸åˆé€‚çš„ï¼Œå› ä¸ºå…¨æ–‡æ£€ç´¢æ˜¯æ–‡å­—åŒ¹é…ï¼Œè¿™é‡Œæˆ‘ä»¬è¦æ±‚çš„æ˜¯å†…å®¹ä¸Šçš„ç›¸ä¼¼åº¦ã€‚</p>
<p>è€Œè¦ä»å†…å®¹ç›¸ä¼¼åº¦æ¥åˆ¤æ–­ï¼Œè¿™å°±ä¸å¾—ä¸æåˆ°<strong>å‘é‡æ¨¡å‹</strong>çš„çŸ¥è¯†äº†ã€‚</p>
<p>4.1.1.å‘é‡æ¨¡å‹</p>
<p>å…ˆè¯´è¯´å‘é‡ï¼Œå‘é‡æ˜¯ç©ºé—´ä¸­æœ‰æ–¹å‘å’Œé•¿åº¦çš„é‡ï¼Œç©ºé—´å¯ä»¥æ˜¯äºŒç»´ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šç»´ã€‚</p>
<p>å‘é‡æ—¢ç„¶æ˜¯åœ¨ç©ºé—´ä¸­ï¼Œä¸¤ä¸ªå‘é‡ä¹‹é—´å°±ä¸€å®šèƒ½è®¡ç®—è·ç¦»ã€‚</p>
<p>æˆ‘ä»¬ä»¥äºŒç»´å‘é‡ä¸ºä¾‹ï¼Œå‘é‡ä¹‹é—´çš„è·ç¦»æœ‰ä¸¤ç§è®¡ç®—æ–¹æ³•ï¼š</p>
<p><span style = "color:red">é€šå¸¸ï¼Œä¸¤ä¸ªå‘é‡ä¹‹é—´<strong>æ¬§å¼è·ç¦»è¶Šè¿‘</strong>ï¼Œæˆ‘ä»¬è®¤ä¸ºä¸¤ä¸ªå‘é‡çš„<strong>ç›¸ä¼¼åº¦è¶Šé«˜</strong>ã€‚ï¼ˆä½™å¼¦è·ç¦»ç›¸åï¼Œè¶Šå¤§ç›¸ä¼¼åº¦è¶Šé«˜ï¼‰æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬èƒ½<strong>æŠŠæ–‡æœ¬è½¬ä¸ºå‘é‡</strong>ï¼Œå°±å¯ä»¥<strong>é€šè¿‡å‘é‡è·ç¦»æ¥åˆ¤æ–­æ–‡æœ¬çš„ç›¸ä¼¼åº¦</strong>äº†ã€‚</span></p>
<blockquote>
<p>0.0                                                 æŠŠæŸ¥è¯¢æ–‡æœ¬è‡ªå·±ä¸è‡ªå·±æ¯”è¾ƒï¼Œè‚¯å®šæ˜¯ç›¸ä¼¼åº¦æœ€é«˜çš„<br>1.0722205301828829                æŠŠæŸ¥è¯¢æ–‡æœ¬ä¸å…¶å®ƒæ–‡æœ¬æ¯”è¾ƒã€æ¬§æ°è·ç¦»<strong>è¶Šè¿‘</strong>ç›¸ä¼¼åº¦è¶Šé«˜ã€‘<br>1.0844350869313875<br>1.1185223356097924<br>1.1693257901084286<br>1.1499045763089124</p>
<p>0.9999999999999998                æŠŠæŸ¥è¯¢æ–‡æœ¬ä¸å…¶å®ƒæ–‡æœ¬æ¯”è¾ƒã€ä½™å¼¦è·ç¦»<strong>è¶Šè¿œ</strong>ç›¸ä¼¼åº¦è¶Šé«˜ã€‘<br>0.4251716163869882<br>0.41200032867283726<br>0.37445397231274447<br>0.3163386320532005<br>0.3388597327534832</p>
</blockquote>
<p>ç°åœ¨ï¼Œæœ‰ä¸å°‘çš„ä¸“é—¨çš„<strong>å‘é‡æ¨¡å‹</strong>ï¼Œå°±å¯ä»¥å®ç°å°†æ–‡æœ¬å‘é‡åŒ–ã€‚ä¸€ä¸ªå¥½çš„å‘é‡æ¨¡å‹ï¼Œå°±æ˜¯è¦<strong>å°½å¯èƒ½è®©æ–‡æœ¬å«ä¹‰ç›¸ä¼¼çš„å‘é‡ï¼Œåœ¨ç©ºé—´ä¸­è·ç¦»æ›´è¿‘</strong>ï¼š</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å‡†å¤‡ä¸€ä¸ªå‘é‡æ¨¡å‹ï¼Œç”¨äºå°†æ–‡æœ¬å‘é‡åŒ–ã€‚</p>
<p>é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°å°±æä¾›äº†è¿™æ ·çš„æ¨¡å‹ï¼š</p>
<p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©<code>é€šç”¨æ–‡æœ¬å‘é‡-v3</code>ï¼Œè¿™ä¸ªæ¨¡å‹å…¼å®¹OpenAIï¼Œæ‰€ä»¥æˆ‘ä»¬ä¾ç„¶é‡‡ç”¨OpenAIçš„é…ç½®ã€‚</p>
<p>ä¿®æ”¹<code>application.yaml</code>ï¼Œæ·»åŠ å‘é‡æ¨¡å‹é…ç½®ï¼š</p>
<pre><code class="YAML">spring:
  application:
    name: ai-demo
  ai:
    ollama:
      base-url: http://localhost:11434 # ollamaæœåŠ¡åœ°å€
      chat:
        model: deepseek-r1:7b # æ¨¡å‹åç§°ï¼Œå¯æ›´æ”¹
        options:
          temperature: 0.8 # æ¨¡å‹æ¸©åº¦ï¼Œå€¼è¶Šå¤§ï¼Œè¾“å‡ºç»“æœè¶Šéšæœº
    openai:
      base-url: https://dashscope.aliyuncs.com/compatible-mode
      api-key: $&#123;OPENAI_API_KEY&#125;
      chat:
        options:
          model: qwen-max # æ¨¡å‹åç§°
          temperature: 0.8 # æ¨¡å‹æ¸©åº¦ï¼Œå€¼è¶Šå¤§ï¼Œè¾“å‡ºç»“æœè¶Šéšæœº
      embedding:
        options:
          model: text-embedding-v3
          dimensions: 1024
</code></pre>
<h4 id="4-1-2-å‘é‡æ¨¡å‹æµ‹è¯•"><a href="#4-1-2-å‘é‡æ¨¡å‹æµ‹è¯•" class="headerlink" title="4.1.2.å‘é‡æ¨¡å‹æµ‹è¯•"></a>4.1.2.å‘é‡æ¨¡å‹æµ‹è¯•</h4><p>å‰é¢è¯´è¿‡ï¼Œæ–‡æœ¬å‘é‡åŒ–ä»¥åï¼Œå¯ä»¥é€šè¿‡å‘é‡ä¹‹é—´çš„è·ç¦»æ¥åˆ¤æ–­æ–‡æœ¬ç›¸ä¼¼åº¦ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥æµ‹è¯•ä¸‹é˜¿é‡Œç™¾ç‚¼æä¾›çš„å‘é‡å¤§æ¨¡å‹å¥½ä¸å¥½ç”¨ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å†™ä¸€ä¸ªå·¥å…·ç±»ï¼Œç”¨ä»¥è®¡ç®—å‘é‡ä¹‹é—´çš„<strong>æ¬§æ°è·ç¦»</strong>å’Œ<strong>ä½™å¼¦è·ç¦»ã€‚</strong><br>[<u>å¤§æ¨¡å‹æœåŠ¡å¹³å°ç™¾ç‚¼æ§åˆ¶å°</u>] (<a target="_blank" rel="noopener" href="https://bailian.console.aliyun.com/?tab=model#/model-market/detail/text-embedding-v3">https://bailian.console.aliyun.com/?tab=model#/model-market/detail/text-embedding-v3</a>)</p>
<p>æ–°å»ºä¸€ä¸ª<code>com.itheima.ai.util</code>åŒ…ï¼Œåœ¨å…¶ä¸­æ–°å»ºä¸€ä¸ªç±»ï¼š</p>
<pre><code class="Java">package com.itheima.ai.util;

public class VectorDistanceUtils &#123;
    
    // é˜²æ­¢å®ä¾‹åŒ–
    private VectorDistanceUtils() &#123;&#125;

    // æµ®ç‚¹æ•°è®¡ç®—ç²¾åº¦é˜ˆå€¼
    private static final double EPSILON = 1e-12;

    /**
     * è®¡ç®—æ¬§æ°è·ç¦»
     * @param vectorA å‘é‡Aï¼ˆéç©ºä¸”ä¸Bç­‰é•¿ï¼‰
     * @param vectorB å‘é‡Bï¼ˆéç©ºä¸”ä¸Aç­‰é•¿ï¼‰
     * @return æ¬§æ°è·ç¦»
     * @throws IllegalArgumentException å‚æ•°ä¸åˆæ³•æ—¶æŠ›å‡º
     */
    public static double euclideanDistance(float[] vectorA, float[] vectorB) &#123;
        validateVectors(vectorA, vectorB);
        
        double sum = 0.0;
        for (int i = 0; i &lt; vectorA.length; i++) &#123;
            double diff = vectorA[i] - vectorB[i];
            sum += diff * diff;
        &#125;
        return Math.sqrt(sum);
    &#125;

    /**
     * è®¡ç®—ä½™å¼¦è·ç¦»
     * @param vectorA å‘é‡Aï¼ˆéç©ºä¸”ä¸Bç­‰é•¿ï¼‰
     * @param vectorB å‘é‡Bï¼ˆéç©ºä¸”ä¸Aç­‰é•¿ï¼‰
     * @return ä½™å¼¦è·ç¦»ï¼ŒèŒƒå›´[0, 2]
     * @throws IllegalArgumentException å‚æ•°ä¸åˆæ³•æˆ–é›¶å‘é‡æ—¶æŠ›å‡º
     */
    public static double cosineDistance(float[] vectorA, float[] vectorB) &#123;
        validateVectors(vectorA, vectorB);
        
        double dotProduct = 0.0;
        double normA = 0.0;
        double normB = 0.0;
        
        for (int i = 0; i &lt; vectorA.length; i++) &#123;
            dotProduct += vectorA[i] * vectorB[i];
            normA += vectorA[i] * vectorA[i];
            normB += vectorB[i] * vectorB[i];
        &#125;
        
        normA = Math.sqrt(normA);
        normB = Math.sqrt(normB);
        
        // å¤„ç†é›¶å‘é‡æƒ…å†µ
        if (normA &lt; EPSILON || normB &lt; EPSILON) &#123;
            throw new IllegalArgumentException(&quot;Vectors cannot be zero vectors&quot;);
        &#125;
        
        // å¤„ç†æµ®ç‚¹è¯¯å·®ï¼Œç¡®ä¿ç»“æœåœ¨[-1,1]èŒƒå›´å†…
        double similarity =  dotProduct / (normA * normB);
        similarity = Math.max(Math.min(similarity, 1.0), -1.0);
        
        return similarity;
    &#125;

    // å‚æ•°æ ¡éªŒç»Ÿä¸€æ–¹æ³•
    private static void validateVectors(float[] a, float[] b) &#123;
        if (a == null || b == null) &#123;
            throw new IllegalArgumentException(&quot;Vectors cannot be null&quot;);
        &#125;
        if (a.length != b.length) &#123;
            throw new IllegalArgumentException(&quot;Vectors must have same dimension&quot;);
        &#125;
        if (a.length == 0) &#123;
            throw new IllegalArgumentException(&quot;Vectors cannot be empty&quot;);
        &#125;
    &#125;
&#125;
</code></pre>
<p>ç”±äºSpringBootçš„è‡ªåŠ¨è£…é…èƒ½åŠ›ï¼Œåˆšæ‰æˆ‘ä»¬é…ç½®çš„å‘é‡æ¨¡å‹å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªæµ‹è¯•ç±»ï¼š</p>
<pre><code class="Java">package com.itheima.ai;

import com.itheima.ai.util.VectorDistanceUtils;
import org.junit.jupiter.api.Test;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.openai.OpenAiChatModel;
import org.springframework.ai.openai.OpenAiEmbeddingModel;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import java.util.Arrays;
import java.util.List;

@SpringBootTest
class AiDemoApplicationTests &#123;

    // è‡ªåŠ¨æ³¨å…¥å‘é‡æ¨¡å‹
    @Autowired
    private OpenAiEmbeddingModel embeddingModel;

    @Test
    public void testEmbedding() &#123;
        // 1.æµ‹è¯•æ•°æ®
        // 1.1.ç”¨æ¥æŸ¥è¯¢çš„æ–‡æœ¬ï¼Œå›½é™…å†²çª
        String query = &quot;global conflicts&quot;;
        
        // 1.2.ç”¨æ¥åšæ¯”è¾ƒçš„æ–‡æœ¬
        String[] texts = new String[]&#123;
                &quot;å“ˆé©¬æ–¯ç§°åŠ æ²™ä¸‹é˜¶æ®µåœç«è°ˆåˆ¤ä»åœ¨è¿›è¡Œ ä»¥æ–¹å°šæœªåšå‡ºæ‰¿è¯º&quot;,
                &quot;åœŸè€³å…¶ã€èŠ¬å…°ã€ç‘å…¸ä¸åŒ—çº¦ä»£è¡¨å°†ç»§ç»­å°±ç‘å…¸â€œå…¥çº¦â€é—®é¢˜è¿›è¡Œè°ˆåˆ¤&quot;,
                &quot;æ—¥æœ¬èˆªç©ºåŸºåœ°æ°´äº•ä¸­æ£€æµ‹å‡ºæœ‰æœºæ°ŸåŒ–ç‰©è¶…æ ‡&quot;,
                &quot;å›½å®¶æ¸¸æ³³ä¸­å¿ƒï¼ˆæ°´ç«‹æ–¹ï¼‰ï¼šæ¢å¤æ¸¸æ³³ã€å¬‰æ°´ä¹å›­ç­‰æ°´ä¸Šé¡¹ç›®è¿è¥&quot;,
                &quot;æˆ‘å›½é¦–æ¬¡åœ¨ç©ºé—´ç«™å¼€å±•èˆ±å¤–è¾å°„ç”Ÿç‰©å­¦æš´éœ²å®éªŒ&quot;,
        &#125;;
        // 2.å‘é‡åŒ–
        // 2.1.å…ˆå°†æŸ¥è¯¢æ–‡æœ¬å‘é‡åŒ–
        float[] queryVector = embeddingModel.embed(query);

        // 2.2.å†å°†æ¯”è¾ƒæ–‡æœ¬å‘é‡åŒ–ï¼Œæ”¾åˆ°ä¸€ä¸ªæ•°ç»„
        List&lt;float[]&gt; textVectors = embeddingModel.embed(Arrays.asList(texts));
        
        // 3.æ¯”è¾ƒæ¬§æ°è·ç¦»
        // 3.1.æŠŠæŸ¥è¯¢æ–‡æœ¬è‡ªå·±ä¸è‡ªå·±æ¯”è¾ƒï¼Œè‚¯å®šæ˜¯ç›¸ä¼¼åº¦æœ€é«˜çš„
        System.out.println(VectorDistanceUtils.euclideanDistance(queryVector, queryVector));
        // 3.2.æŠŠæŸ¥è¯¢æ–‡æœ¬ä¸å…¶å®ƒæ–‡æœ¬æ¯”è¾ƒ
        for (float[] textVector : textVectors) &#123;
            System.out.println(VectorDistanceUtils.euclideanDistance(queryVector, textVector));
        &#125;
        System.out.println(&quot;------------------&quot;);
        
        // 4.æ¯”è¾ƒä½™å¼¦è·ç¦»
        // 4.1.æŠŠæŸ¥è¯¢æ–‡æœ¬è‡ªå·±ä¸è‡ªå·±æ¯”è¾ƒï¼Œè‚¯å®šæ˜¯ç›¸ä¼¼åº¦æœ€é«˜çš„
        System.out.println(VectorDistanceUtils.cosineDistance(queryVector, queryVector));
        // 4.2.æŠŠæŸ¥è¯¢æ–‡æœ¬ä¸å…¶å®ƒæ–‡æœ¬æ¯”è¾ƒ
        for (float[] textVector : textVectors) &#123;
            System.out.println(VectorDistanceUtils.cosineDistance(queryVector, textVector));
        &#125;
    &#125;

&#125;
</code></pre>
<blockquote>
<h2 id="ğŸ§ -ä¸€ã€ä»€ä¹ˆæ˜¯â€œå‘é‡åŒ–â€ï¼Ÿ"><a href="#ğŸ§ -ä¸€ã€ä»€ä¹ˆæ˜¯â€œå‘é‡åŒ–â€ï¼Ÿ" class="headerlink" title="ğŸ§  ä¸€ã€ä»€ä¹ˆæ˜¯â€œå‘é‡åŒ–â€ï¼Ÿ"></a>ğŸ§  ä¸€ã€ä»€ä¹ˆæ˜¯â€œå‘é‡åŒ–â€ï¼Ÿ</h2><p>é€šä¿—è§£é‡Šï¼š</p>
<blockquote>
<p>æŠŠä¸€å¥äººç±»è¯­è¨€ï¼ˆå¦‚ï¼šâ€œå…¨çƒå†²çªâ€ï¼‰è½¬æ¢æˆä¸€ä¸ª <strong>æ•°å­—æ•°ç»„ï¼ˆfloat[]ï¼‰</strong>ï¼Œè¿™ä¸ªæ•°ç»„å¯ä»¥ç”¨äºæ•°å­¦è¿ç®—ï¼Œæ¯”å¦‚æ¯”è¾ƒä¸¤å¥è¯æœ‰å¤šç›¸ä¼¼ã€‚</p>
</blockquote>
<p>èƒŒåç”¨çš„æ˜¯ <strong>OpenAI çš„ embedding æ¨¡å‹</strong>ï¼ˆå¦‚ <code>text-embedding-3-small</code>ï¼‰ï¼Œå®ƒå¯ä»¥æŠŠæ–‡æœ¬è½¬æˆå›ºå®šç»´åº¦çš„å‘é‡ï¼ˆæ¯”å¦‚ 1536 ç»´çš„æ•°ç»„ï¼‰ã€‚</p>
<hr>
<h2 id="ğŸ› -äºŒã€å¦‚ä½•åšåˆ°å‘é‡åŒ–ï¼Ÿçœ‹å…³é”®ä»£ç ï¼š"><a href="#ğŸ› -äºŒã€å¦‚ä½•åšåˆ°å‘é‡åŒ–ï¼Ÿçœ‹å…³é”®ä»£ç ï¼š" class="headerlink" title="ğŸ›  äºŒã€å¦‚ä½•åšåˆ°å‘é‡åŒ–ï¼Ÿçœ‹å…³é”®ä»£ç ï¼š"></a>ğŸ›  äºŒã€å¦‚ä½•åšåˆ°å‘é‡åŒ–ï¼Ÿçœ‹å…³é”®ä»£ç ï¼š</h2><pre><code>javaå¤åˆ¶ç¼–è¾‘@Autowired
private OpenAiEmbeddingModel embeddingModel;
</code></pre>
<h3 id="âœ…-è¿™ä¸ªæ˜¯-Spring-AI-æä¾›çš„å°è£…ï¼š"><a href="#âœ…-è¿™ä¸ªæ˜¯-Spring-AI-æä¾›çš„å°è£…ï¼š" class="headerlink" title="âœ… è¿™ä¸ªæ˜¯ Spring AI æä¾›çš„å°è£…ï¼š"></a>âœ… è¿™ä¸ªæ˜¯ Spring AI æä¾›çš„å°è£…ï¼š</h3><ul>
<li><code>OpenAiEmbeddingModel</code> æ˜¯ Spring AI æä¾›çš„ä¸€ä¸ªç»„ä»¶ï¼Œå†…ç½®äº† OpenAI çš„åµŒå…¥æ¨¡å‹è°ƒç”¨é€»è¾‘ã€‚</li>
<li>å®é™…ä¸Šå®ƒä¼šè°ƒç”¨ OpenAI APIï¼ˆå¦‚ï¼š<code>/v1/embeddings</code>ï¼‰ï¼Œå°†æ–‡æœ¬å˜æˆå‘é‡ã€‚</li>
</ul>
<p>Spring ä¼šè‡ªåŠ¨å¸®ä½ å®Œæˆï¼š</p>
<ul>
<li>æ„å»º HTTP è¯·æ±‚</li>
<li>æºå¸¦ API å¯†é’¥</li>
<li>æ¥æ”¶åµŒå…¥å‘é‡è¿”å›å€¼</li>
<li>è½¬æˆ Java ä¸­çš„ <code>float[]</code> æ•°ç»„</li>
</ul>
<hr>
<h3 id="ğŸ§ª-ä»£ç è¯¦ç»†è®²è§£å¦‚ä¸‹ï¼š"><a href="#ğŸ§ª-ä»£ç è¯¦ç»†è®²è§£å¦‚ä¸‹ï¼š" class="headerlink" title="ğŸ§ª ä»£ç è¯¦ç»†è®²è§£å¦‚ä¸‹ï¼š"></a>ğŸ§ª ä»£ç è¯¦ç»†è®²è§£å¦‚ä¸‹ï¼š</h3><h4 id="1-å‘é‡åŒ–å•ä¸ªæŸ¥è¯¢æ–‡æœ¬"><a href="#1-å‘é‡åŒ–å•ä¸ªæŸ¥è¯¢æ–‡æœ¬" class="headerlink" title="1. å‘é‡åŒ–å•ä¸ªæŸ¥è¯¢æ–‡æœ¬"></a>1. å‘é‡åŒ–å•ä¸ªæŸ¥è¯¢æ–‡æœ¬</h4><pre><code class="java">String query = &quot;global conflicts&quot;;
float[] queryVector = embeddingModel.embed(query);
</code></pre>
<ul>
<li><p>è¿™è¡Œä»£ç èƒŒåä¼šè°ƒç”¨ OpenAI embedding æ¥å£ï¼ŒæŠŠ <code>&quot;global conflicts&quot;</code> å˜æˆä¸€ä¸ªå‘é‡ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="java">queryVector = [0.123f, 0.456f, ..., 0.789f] // å…±1536ä¸ª float
</code></pre>
</li>
</ul>
<blockquote>
<p>âš™ï¸ åº•å±‚è¯·æ±‚ç±»ä¼¼ï¼š</p>
</blockquote>
<pre><code class="java">POST /v1/embeddings
&#123;
  &quot;input&quot;: &quot;global conflicts&quot;,
  &quot;model&quot;: &quot;text-embedding-3-small&quot;
&#125;
</code></pre>
<hr>
<h4 id="2-å‘é‡åŒ–å¤šä¸ªæ–‡æœ¬"><a href="#2-å‘é‡åŒ–å¤šä¸ªæ–‡æœ¬" class="headerlink" title="2. å‘é‡åŒ–å¤šä¸ªæ–‡æœ¬"></a>2. å‘é‡åŒ–å¤šä¸ªæ–‡æœ¬</h4><pre><code class="java">List&lt;float[]&gt; textVectors = embeddingModel.embed(Arrays.asList(texts));
</code></pre>
<ul>
<li>ä¸€æ¬¡æ€§æŠŠå¤šä¸ªä¸­æ–‡æ–‡æœ¬è½¬æˆå‘é‡ã€‚</li>
<li>è¿”å›çš„æ˜¯ <code>List&lt;float[]&gt;</code>ï¼Œæ¯ä¸ªæ–‡æœ¬å¯¹åº”ä¸€ä¸ªå‘é‡æ•°ç»„ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="java">texts[0] -&gt; å‘é‡ï¼š[0.234f, 0.891f, ...]
texts[1] -&gt; å‘é‡ï¼š[0.111f, 0.456f, ...]
</code></pre>
<ul>
<li><strong>æ‰¹é‡å¤„ç†çš„å¥½å¤„</strong>ï¼šæ•ˆç‡æ›´é«˜ï¼Œå‡å°‘ API è°ƒç”¨æ¬¡æ•°ã€‚</li>
</ul>
</blockquote>
<p><strong>æ³¨æ„</strong>ï¼š è¿è¡Œå•å…ƒæµ‹è¯•é€šç”¨éœ€è¦é…ç½®OPENAI_API_KEYçš„ç¯å¢ƒå˜é‡</p>
<p>é¦–å…ˆï¼Œç‚¹å‡»å•å…ƒæµ‹è¯•å·¦ä¾§è¿è¡ŒæŒ‰é’®ï¼šâ€¦â€¦â€¦è¿è¡Œç»“æœï¼š</p>
<pre><code class="Bash">0.0
1.0722205301828829
1.0844350869313875
1.1185223356097924
1.1693257901084286
1.1499045763089124
------------------
0.9999999999999998
0.4251716163869882
0.41200032867283726
0.37445397231274447
0.3163386320532005
0.3388597327534832
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå‘é‡ç›¸ä¼¼åº¦ç¡®å®ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚</p>
<p>OKï¼Œæœ‰äº†æ¯”è¾ƒæ–‡æœ¬ç›¸ä¼¼åº¦çš„åŠæ³•ï¼ŒçŸ¥è¯†åº“çš„é—®é¢˜å°±å¯ä»¥è§£å†³äº†ã€‚</p>
<p>å‰é¢è¯´äº†ï¼ŒçŸ¥è¯†åº“æ•°æ®é‡å¾ˆå¤§ï¼Œæ— æ³•å…¨éƒ¨å†™å…¥æç¤ºè¯ã€‚ä½†æ˜¯åºå¤§çš„çŸ¥è¯†åº“ä¸­ä¸ç”¨æˆ·é—®é¢˜ç›¸å…³çš„å…¶å®å¹¶ä¸å¤šã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æƒ³åŠæ³•<strong>ä»åºå¤§çš„çŸ¥è¯†åº“ä¸­æ‰¾åˆ°ä¸ç”¨æˆ·é—®é¢˜ç›¸å…³çš„ä¸€å°éƒ¨åˆ†ï¼Œç»„è£…æˆæç¤ºè¯</strong>ï¼Œå‘é€ç»™å¤§æ¨¡å‹å°±å¯ä»¥äº†ã€‚</p>
<p>ç°åœ¨ï¼Œåˆ©ç”¨å‘é‡å¤§æ¨¡å‹å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ¯”è¾ƒæ–‡æœ¬ç›¸ä¼¼åº¦ã€‚</p>
<p>ä½†æ˜¯æ–°çš„é—®é¢˜æ¥äº†ï¼šå‘é‡æ¨¡å‹æ˜¯å¸®æˆ‘ä»¬ç”Ÿæˆå‘é‡çš„ï¼Œå¦‚æ­¤åºå¤§çš„çŸ¥è¯†åº“ï¼Œè°æ¥å¸®æˆ‘ä»¬ä»ä¸­<strong>æ¯”è¾ƒå’Œæ£€ç´¢æ•°æ®</strong>å‘¢ï¼Ÿ</p>
<p>è¿™å°±éœ€è¦ç”¨åˆ°<strong>å‘é‡æ•°æ®åº“</strong>äº†ã€‚</p>
<h4 id="4-1-3-å‘é‡æ•°æ®åº“"><a href="#4-1-3-å‘é‡æ•°æ®åº“" class="headerlink" title="4.1.3.å‘é‡æ•°æ®åº“"></a>4.1.3.å‘é‡æ•°æ®åº“</h4><p>ä¸»æµä¸€çº¿çš„å‘é‡æ•°æ®åº“ã€Milvusã€‘åŠŸèƒ½å…¨é¢ï¼Œæ”¯æŒå‘é‡+ç»“æ„åŒ–æŸ¥è¯¢ã€GPUåŠ é€Ÿï¼Œå›½å†…ç¤¾åŒºæ´»è·ƒ</p>
<p>å‘é‡æ•°æ®åº“çš„ä¸»è¦ä½œç”¨æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li>å­˜å‚¨å‘é‡æ•°æ®</li>
<li>åŸºäºç›¸ä¼¼åº¦æ£€ç´¢æ•°æ®</li>
</ul>
<p>åˆšå¥½ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<p>SpringAIæ”¯æŒå¾ˆå¤šå‘é‡æ•°æ®åº“ï¼Œå¹¶ä¸”éƒ½è¿›è¡Œäº†å°è£…ï¼Œå¯ä»¥ç”¨ç»Ÿä¸€çš„APIå»è®¿é—®ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/azure.html">Azure Vector Search</a> - The <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/search/vector-search-overview">Azure</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/apache-cassandra.html">Apache Cassandra</a> - The <a target="_blank" rel="noopener" href="https://cassandra.apache.org/doc/latest/cassandra/vector-search/overview.html">Apache Cassandra</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/chroma.html">Chroma Vector Store</a> - The <a target="_blank" rel="noopener" href="https://www.trychroma.com/">Chroma</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/elasticsearch.html">Elasticsearch Vector Store</a> - The <a target="_blank" rel="noopener" href="https://www.elastic.co/">Elasticsearch</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/gemfire.html">GemFire Vector Store</a> - The <a target="_blank" rel="noopener" href="https://tanzu.vmware.com/content/blog/vmware-gemfire-vector-database-extension">GemFire</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/mariadb.html">MariaDB Vector Store</a> - The <a target="_blank" rel="noopener" href="https://mariadb.com/">MariaDB</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/milvus.html">Milvus Vector Store</a> - The <a target="_blank" rel="noopener" href="https://milvus.io/">Milvus</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/mongodb.html">MongoDB Atlas Vector Store</a> - The <a target="_blank" rel="noopener" href="https://www.mongodb.com/atlas/database">MongoDB Atlas</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/neo4j.html">Neo4j Vector Store</a> - The <a target="_blank" rel="noopener" href="https://neo4j.com/">Neo4j</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/opensearch.html">OpenSearch Vector Store</a> - The <a target="_blank" rel="noopener" href="https://opensearch.org/platform/search/vector-database.html">OpenSearch</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/oracle.html">Oracle Vector Store</a> - The <a target="_blank" rel="noopener" href="https://docs.oracle.com/en/database/oracle/oracle-database/23/vecse/overview-ai-vector-search.html">Oracle Database</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/pgvector.html">PgVector Store</a> - The <a target="_blank" rel="noopener" href="https://github.com/pgvector/pgvector">PostgreSQL&#x2F;PGVector</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/pinecone.html">Pinecone Vector Store</a> - <a target="_blank" rel="noopener" href="https://www.pinecone.io/">PineCone</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/qdrant.html">Qdrant Vector Store</a> - <a target="_blank" rel="noopener" href="https://www.qdrant.tech/">Qdrant</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/redis.html">Redis Vector Store</a> - The <a target="_blank" rel="noopener" href="https://redis.io/">Redis</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/hana.html">SAP Hana Vector Store</a> - The <a target="_blank" rel="noopener" href="https://news.sap.com/2024/04/sap-hana-cloud-vector-engine-ai-with-business-context/">SAP HANA</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/typesense.html">Typesense Vector Store</a> - The <a target="_blank" rel="noopener" href="https://typesense.org/docs/0.24.0/api/vector-search.html">Typesense</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs/weaviate.html">Weaviate Vector Store</a> - The <a target="_blank" rel="noopener" href="https://weaviate.io/">Weaviate</a> vector store.</li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-ai/blob/main/spring-ai-core/src/main/java/org/springframework/ai/vectorstore/SimpleVectorStore.java">SimpleVectorStore</a> - A simple implementation of persistent vector storage, good for educational purposes.</li>
</ul>
<p>è¿™äº›åº“éƒ½å®ç°äº†ç»Ÿä¸€çš„æ¥å£ï¼š<code>VectorStore</code>ï¼Œå› æ­¤æ“ä½œæ–¹å¼ä¸€æ¨¡ä¸€æ ·ï¼Œå¤§å®¶å­¦ä¼šä»»æ„ä¸€ä¸ªï¼Œå…¶å®ƒå°±éƒ½ä¸æ˜¯é—®é¢˜ã€‚</p>
<p>ä¸è¿‡ï¼Œé™¤äº†æœ€åä¸€ä¸ªåº“ä»¥å¤–ï¼Œå…¶å®ƒæ‰€æœ‰å‘é‡æ•°æ®åº“éƒ½æ˜¯éœ€è¦å®‰è£…éƒ¨ç½²çš„ã€‚æ¯ä¸ªä¼ä¸šç”¨çš„å‘é‡åº“éƒ½ä¸ä¸€æ ·ï¼Œè¿™é‡Œæˆ‘å°±ä¸ä¸€ä¸€æ¼”ç¤ºäº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/8e90b3937f86a11b04cbc74588a99c4fbe97cfb7/%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E6%8E%A5SpringAI%E6%B5%81%E7%A8%8B.png"></p>
<h5 id="4-1-3-1-SimpleVectorStore"><a href="#4-1-3-1-SimpleVectorStore" class="headerlink" title="4.1.3.1.SimpleVectorStore"></a>4.1.3.1.SimpleVectorStore</h5><p>æœ€åä¸€ä¸ª<code>SimpleVectorStore</code>å‘é‡åº“æ˜¯åŸºäºå†…å­˜å®ç°ï¼Œæ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥æµ‹è¯•ã€æ•™å­¦ç”¨çš„åº“ï¼Œéå¸¸é€‚åˆæˆ‘ä»¬ã€‚</p>
<p>æˆ‘ä»¬ç›´æ¥ä¿®æ”¹<code>CommonConfiguration</code>ï¼Œæ·»åŠ ä¸€ä¸ª<code>VectorStore</code>çš„Beanï¼š</p>
<pre><code class="Java">@Configuration
public class CommonConfiguration &#123;

    @Bean
    public VectorStore vectorStore(OpenAiEmbeddingModel embeddingModel) &#123;
        return SimpleVectorStore.builder(embeddingModel).build();
    &#125;
    
    // ... ç•¥
&#125;
</code></pre>
<h5 id="4-1-3-2-VectorStoreæ¥å£"><a href="#4-1-3-2-VectorStoreæ¥å£" class="headerlink" title="4.1.3.2.VectorStoreæ¥å£"></a>4.1.3.2.VectorStoreæ¥å£</h5><p>æ¥ä¸‹æ¥ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨<code>VectorStore</code>ä¸­çš„å„ç§åŠŸèƒ½äº†ï¼Œå¯ä»¥å‚è€ƒSpringAIå®˜æ–¹æ–‡æ¡£ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/vectordbs.html">https://docs.spring.io/spring-ai/reference/api/vectordbs.html</a></p>
<p>è¿™æ˜¯<code>VectorStore</code>ä¸­å£°æ˜çš„æ–¹æ³•ï¼š</p>
<pre><code class="Java">public interface VectorStore extends DocumentWriter &#123;

    default String getName() &#123;
                return this.getClass().getSimpleName();
        &#125;
    // ä¿å­˜æ–‡æ¡£åˆ°å‘é‡åº“
    void add(List&lt;Document&gt; documents);
    // æ ¹æ®æ–‡æ¡£idåˆ é™¤æ–‡æ¡£
    void delete(List&lt;String&gt; idList);

    void delete(Filter.Expression filterExpression);

    default void delete(String filterExpression) &#123; ... &#125;;
    // æ ¹æ®æ¡ä»¶æ£€ç´¢æ–‡æ¡£
    List&lt;Document&gt; similaritySearch(String query);
    // æ ¹æ®æ¡ä»¶æ£€ç´¢æ–‡æ¡£
    List&lt;Document&gt; similaritySearch(SearchRequest request);

    default &lt;T&gt; Optional&lt;T&gt; getNativeClient() &#123;
                return Optional.empty();
        &#125;
&#125;
</code></pre>
<p>æ³¨æ„ï¼Œ<code>VectorStore</code>æ“ä½œå‘é‡åŒ–çš„åŸºæœ¬å•ä½æ˜¯<code>Document</code>ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶éœ€è¦å°†è‡ªå·±çš„çŸ¥è¯†åº“åˆ†å‰²è½¬æ¢ä¸ºä¸€ä¸ªä¸ªçš„<code>Document</code>ï¼Œç„¶åå†™å…¥<code>VectorStore</code>.</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•æŠŠå„ç§ä¸åŒçš„çŸ¥è¯†åº“æ–‡ä»¶è½¬ä¸ºDocumentå‘¢ï¼Ÿ</p>
<h4 id="4-1-4-æ–‡ä»¶è¯»å–å’Œè½¬æ¢"><a href="#4-1-4-æ–‡ä»¶è¯»å–å’Œè½¬æ¢" class="headerlink" title="4.1.4.æ–‡ä»¶è¯»å–å’Œè½¬æ¢"></a>4.1.4.æ–‡ä»¶è¯»å–å’Œè½¬æ¢</h4><p>å‰é¢è¯´è¿‡ï¼ŒçŸ¥è¯†åº“å¤ªå¤§ï¼Œæ˜¯éœ€è¦æ‹†åˆ†æˆæ–‡æ¡£ç‰‡æ®µï¼Œç„¶åå†åšå‘é‡åŒ–çš„ã€‚è€Œä¸”SpringAIä¸­å‘é‡åº“æ¥æ”¶çš„æ˜¯Documentç±»å‹çš„æ–‡æ¡£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¤„ç†æ–‡æ¡£è¿˜è¦è½¬æˆDocumentæ ¼å¼ã€‚</p>
<p>ä¸è¿‡ï¼Œæ–‡æ¡£è¯»å–ã€æ‹†åˆ†ã€è½¬æ¢çš„åŠ¨ä½œå¹¶ä¸éœ€è¦æˆ‘ä»¬äº²è‡ªå®Œæˆã€‚åœ¨SpringAIä¸­æä¾›äº†å„ç§æ–‡æ¡£è¯»å–çš„å·¥å…·ï¼Œå¯ä»¥å‚è€ƒå®˜ç½‘ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html#_pdf_paragraph">https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html#_pdf_paragraph</a></p>
<p>æ¯”å¦‚PDFæ–‡æ¡£è¯»å–å’Œæ‹†åˆ†ï¼ŒSpringAIæä¾›äº†ä¸¤ç§é»˜è®¤çš„æ‹†åˆ†åŸåˆ™ï¼š</p>
<ul>
<li><code>PagePdfDocumentReader</code> ï¼šæŒ‰é¡µæ‹†åˆ†ï¼Œæ¨èä½¿ç”¨</li>
<li><code>ParagraphPdfDocumentReader</code> ï¼šæŒ‰pdfçš„ç›®å½•æ‹†åˆ†ï¼Œä¸æ¨èï¼Œå› ä¸ºå¾ˆå¤šPDFä¸è§„èŒƒï¼Œæ²¡æœ‰ç« èŠ‚æ ‡ç­¾</li>
</ul>
<p>å½“ç„¶ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥è‡ªå·±å®ç°PDFçš„è¯»å–å’Œæ‹†åˆ†åŠŸèƒ½ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨<code>PagePdfDocumentReader</code>ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨pom.xmlä¸­å¼•å…¥ä¾èµ–ï¼š</p>
<pre><code class="XML">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;
    &lt;artifactId&gt;spring-ai-pdf-document-reader&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>ç„¶åå°±å¯ä»¥åˆ©ç”¨å·¥å…·æŠŠPDFæ–‡ä»¶è¯»å–å¹¶å¤„ç†æˆDocumentäº†ã€‚</p>
<p>æˆ‘ä»¬å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼ˆåˆ«å¿˜äº†é…ç½®<strong>API_KEY</strong>ï¼‰ï¼š</p>
<pre><code class="java">package com.itheima.ai;

import com.itheima.ai.utils.VectorDistanceUtils;
import org.junit.jupiter.api.Test;
import org.springframework.ai.document.Document;
import org.springframework.ai.openai.OpenAiEmbeddingModel;
import org.springframework.ai.reader.ExtractedTextFormatter;
import org.springframework.ai.reader.pdf.PagePdfDocumentReader;
import org.springframework.ai.reader.pdf.config.PdfDocumentReaderConfig;
import org.springframework.ai.vectorstore.SearchRequest;
import org.springframework.ai.vectorstore.VectorStore;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.core.io.FileSystemResource;
import org.springframework.core.io.Resource;

import java.util.Arrays;
import java.util.List;

@SpringBootTest
class HeimaAiApplicationTests &#123;

    @Autowired
    private OpenAiEmbeddingModel embeddingModel;
    @Autowired
    private VectorStore vectorStore;

    @Test
    public void testVectorStore()&#123;
        Resource resource = new FileSystemResource(&quot;ä¸­äºŒçŸ¥è¯†ç¬”è®°.pdf&quot;);
        // 1.åˆ›å»ºPDFçš„è¯»å–å™¨
        PagePdfDocumentReader reader = new PagePdfDocumentReader(
                resource, // æ–‡ä»¶æº
                PdfDocumentReaderConfig.builder()
                        .withPageExtractedTextFormatter(ExtractedTextFormatter.defaults())
                        .withPagesPerDocument(1) // æ¯1é¡µPDFä½œä¸ºä¸€ä¸ªDocument
                        .build()
        );
        // 2.è¯»å–PDFæ–‡æ¡£ï¼Œæ‹†åˆ†ä¸ºDocument
        List&lt;Document&gt; documents = reader.read();
        // 3.å†™å…¥å‘é‡åº“
        vectorStore.add(documents);
        // 4.æœç´¢
        SearchRequest request = SearchRequest.builder()
                .query(&quot;è®ºè¯­ä¸­æ•™è‚²çš„ç›®çš„æ˜¯ä»€ä¹ˆ&quot;) // æŸ¥è¯¢æ¡ä»¶
                .topK(1) // è¿”å›çš„æ–‡æ¡£æ•°é‡
                .similarityThreshold(0.6) // é˜ˆå€¼ è¶…è¿‡çš„è¦
                .filterExpression(&quot;file_name == &#39;ä¸­äºŒçŸ¥è¯†ç¬”è®°.pdf&#39;&quot;) // è¿‡æ»¤æ¡ä»¶
                .build();
        List&lt;Document&gt; docs = vectorStore.similaritySearch(request);
        if (docs == null) &#123;
            System.out.println(&quot;æ²¡æœ‰æœç´¢åˆ°ä»»ä½•å†…å®¹&quot;);
            return;
        &#125;
        for (Document doc : docs) &#123;
            System.out.println(doc.getId());
            System.out.println(doc.getScore());
            System.out.println(doc.getText());
        &#125;
    &#125;
</code></pre>
<h4 id="4-1-5-RAGåŸç†æ€»ç»“"><a href="#4-1-5-RAGåŸç†æ€»ç»“" class="headerlink" title="4.1.5.RAGåŸç†æ€»ç»“"></a>4.1.5.RAGåŸç†æ€»ç»“</h4><p>OKï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†è¿™äº›å·¥å…·ï¼š</p>
<ul>
<li>PDFReaderï¼šè¯»å–æ–‡æ¡£å¹¶æ‹†åˆ†ä¸ºç‰‡æ®µ</li>
<li>å‘é‡å¤§æ¨¡å‹ï¼šå°†æ–‡æœ¬ç‰‡æ®µå‘é‡åŒ–</li>
<li>å‘é‡æ•°æ®åº“ï¼šå­˜å‚¨å‘é‡ï¼Œæ£€ç´¢å‘é‡</li>
</ul>
<p>è®©æˆ‘ä»¬æ¢³ç†ä¸€ä¸‹è¦è§£å†³çš„é—®é¢˜å’Œè§£å†³æ€è·¯ï¼š</p>
<ul>
<li>è¦è§£å†³å¤§æ¨¡å‹çš„çŸ¥è¯†é™åˆ¶é—®é¢˜ï¼Œéœ€è¦å¤–æŒ‚çŸ¥è¯†åº“</li>
<li>å—åˆ°å¤§æ¨¡å‹ä¸Šä¸‹æ–‡é™åˆ¶ï¼ŒçŸ¥è¯†åº“ä¸èƒ½ç®€å•çš„ç›´æ¥æ‹¼æ¥åœ¨æç¤ºè¯ä¸­</li>
<li>æˆ‘ä»¬éœ€è¦ä»åºå¤§çš„çŸ¥è¯†åº“ä¸­æ‰¾åˆ°ä¸ç”¨æˆ·é—®é¢˜ç›¸å…³çš„ä¸€å°éƒ¨åˆ†ï¼Œå†ç»„è£…æˆæç¤ºè¯</li>
<li>è¿™äº›å¯ä»¥åˆ©ç”¨<strong>æ–‡æ¡£è¯»å–å™¨</strong>ã€<strong>å‘é‡å¤§æ¨¡å‹</strong>ã€<strong>å‘é‡æ•°æ®åº“</strong>æ¥è§£å†³ã€‚</li>
</ul>
<p>æ‰€ä»¥RAGè¦åšçš„äº‹æƒ…å°±æ˜¯å°†çŸ¥è¯†åº“åˆ†å‰²ï¼Œç„¶ååˆ©ç”¨å‘é‡æ¨¡å‹åšå‘é‡åŒ–ï¼Œå­˜å…¥å‘é‡æ•°æ®åº“ï¼Œç„¶åæŸ¥è¯¢çš„æ—¶å€™å»æ£€ç´¢ï¼š</p>
<p><strong>ç¬¬ä¸€é˜¶æ®µï¼ˆå­˜å‚¨çŸ¥è¯†åº“ï¼‰</strong>ï¼š</p>
<ul>
<li>å°†çŸ¥è¯†åº“å†…å®¹åˆ‡ç‰‡ï¼Œåˆ†ä¸ºä¸€ä¸ªä¸ªç‰‡æ®µ</li>
<li>å°†æ¯ä¸ªç‰‡æ®µåˆ©ç”¨å‘é‡æ¨¡å‹å‘é‡åŒ–</li>
<li>å°†æ‰€æœ‰å‘é‡åŒ–åçš„ç‰‡æ®µå†™å…¥å‘é‡æ•°æ®åº“</li>
</ul>
<p><strong>ç¬¬äºŒé˜¶æ®µï¼ˆæ£€ç´¢çŸ¥è¯†åº“ï¼‰</strong>ï¼š</p>
<ul>
<li>æ¯å½“ç”¨æˆ·è¯¢é—®AIæ—¶ï¼Œå°†ç”¨æˆ·é—®é¢˜å‘é‡åŒ–</li>
<li>æ‹¿ç€é—®é¢˜å‘é‡å»å‘é‡æ•°æ®åº“æ£€ç´¢æœ€ç›¸å…³çš„ç‰‡æ®µ</li>
</ul>
<p><strong>ç¬¬ä¸‰é˜¶æ®µï¼ˆå¯¹è¯å¤§æ¨¡å‹ï¼‰</strong>ï¼š</p>
<ul>
<li>å°†æ£€ç´¢åˆ°çš„ç‰‡æ®µã€ç”¨æˆ·çš„é—®é¢˜ä¸€èµ·æ‹¼æ¥ä¸ºæç¤ºè¯</li>
<li>å‘é€æç¤ºè¯ç»™å¤§æ¨¡å‹ï¼Œå¾—åˆ°å“åº”</li>
</ul>
<h4 id="4-1-6-ç›®æ ‡"><a href="#4-1-6-ç›®æ ‡" class="headerlink" title="4.1.6.ç›®æ ‡"></a>4.1.6.ç›®æ ‡</h4><p>å¥½äº†ï¼Œç°åœ¨RAGæ‰€éœ€è¦çš„åŸºæœ¬å·¥å…·éƒ½æœ‰äº†ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥å®ç°ä¸€ä¸ªéå¸¸ç«çˆ†çš„ä¸ªäººçŸ¥è¯†åº“AIåº”ç”¨ï¼ŒChatPDFï¼ŒåŸç½‘ç«™å¦‚ä¸‹ï¼š</p>
<p>è¿™ä¸ªç½‘ç«™å…¶å®å°±æ˜¯æŠŠä½ ä¸ªäººçš„PDFæ–‡ä»¶ä½œä¸ºçŸ¥è¯†åº“ï¼Œè®©AIåŸºäºPDFå†…å®¹æ¥å›ç­”ä½ çš„é—®é¢˜ï¼Œå¯¹äºå¤§å­¦ç”Ÿã€ç ”ç©¶äººå‘˜ã€ä¸“ä¸šäººå£«æ¥è¯´ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p>
<p>å½“ä½ å­¦ä¼šäº†è¿™ä¸ªåŠŸèƒ½ï¼Œå®ç°å…¶å®ƒçŸ¥è¯†åº“ä¹Ÿéƒ½æ˜¯ç±»ä¼¼çš„æµç¨‹äº†ã€‚</p>
<p>æ¥å§ï¼Œæˆ‘ä»¬ä¸€èµ·åŠ¨èµ·æ¥ï¼</p>
<h4 id="å®ç°ä¸Šä¼ ä¸‹è½½ã€è®°å½•æœ¬æ¬¡ä¿å­˜æ—¶ä¼šè¯IDå’Œæ–‡ä»¶åçš„æ˜ å°„å…³ç³»ã€æŠŠæ–‡ä»¶å†™å…¥å‘é‡æ•°æ®åº“"><a href="#å®ç°ä¸Šä¼ ä¸‹è½½ã€è®°å½•æœ¬æ¬¡ä¿å­˜æ—¶ä¼šè¯IDå’Œæ–‡ä»¶åçš„æ˜ å°„å…³ç³»ã€æŠŠæ–‡ä»¶å†™å…¥å‘é‡æ•°æ®åº“" class="headerlink" title="å®ç°ä¸Šä¼ ä¸‹è½½ã€è®°å½•æœ¬æ¬¡ä¿å­˜æ—¶ä¼šè¯IDå’Œæ–‡ä»¶åçš„æ˜ å°„å…³ç³»ã€æŠŠæ–‡ä»¶å†™å…¥å‘é‡æ•°æ®åº“"></a><span style = "color:red">å®ç°ä¸Šä¼ ä¸‹è½½ã€è®°å½•æœ¬æ¬¡ä¿å­˜æ—¶ä¼šè¯IDå’Œæ–‡ä»¶åçš„æ˜ å°„å…³ç³»ã€æŠŠæ–‡ä»¶å†™å…¥å‘é‡æ•°æ®åº“</span></h4><h3 id="4-2-PDFä¸Šä¼ ä¸‹è½½ã€å‘é‡åŒ–"><a href="#4-2-PDFä¸Šä¼ ä¸‹è½½ã€å‘é‡åŒ–" class="headerlink" title="4.2.PDFä¸Šä¼ ä¸‹è½½ã€å‘é‡åŒ–"></a>4.2.PDFä¸Šä¼ ä¸‹è½½ã€å‘é‡åŒ–</h3><p>æ—¢ç„¶æ˜¯ChatPDFï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çŸ¥è¯†åº“éƒ½æ˜¯PDFå½¢å¼çš„ï¼Œç”±ç”¨æˆ·æäº¤ç»™æˆ‘ä»¬ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®ç°ä¸€ä¸ªä¸Šä¼ PDFçš„æ¥å£ï¼Œåœ¨æ¥å£ä¸­å®ç°ä¸‹åˆ—åŠŸèƒ½ï¼š</p>
<ul>
<li>æ ¡éªŒæ–‡ä»¶æ ¼å¼æ˜¯å¦ä¸ºPDF</li>
<li>ä¿å­˜æ–‡ä»¶ä¿¡æ¯<ul>
<li>ä¿å­˜æ–‡ä»¶ï¼ˆå¯ä»¥æ˜¯ossæˆ–æœ¬åœ°ä¿å­˜ï¼‰</li>
<li>ä¿å­˜ä¼šè¯IDå’Œæ–‡ä»¶è·¯å¾„çš„æ˜ å°„å…³ç³»ï¼ˆæ–¹ä¾¿æŸ¥è¯¢ä¼šè¯å†å²çš„æ—¶å€™å†æ¬¡è¯»å–æ–‡ä»¶ï¼‰</li>
</ul>
</li>
<li>æ–‡æ¡£æ‹†åˆ†å’Œå‘é‡åŒ–ï¼ˆæ–‡æ¡£å¤ªå¤§ï¼Œéœ€è¦æ‹†åˆ†ä¸ºä¸€ä¸ªä¸ªç‰‡æ®µï¼Œåˆ†åˆ«å‘é‡åŒ–ï¼‰</li>
</ul>
<p>å¦å¤–ï¼Œå°†æ¥ç”¨æˆ·æŸ¥è¯¢ä¼šè¯å†å²ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿”å›pdfæ–‡ä»¶ç»™å‰ç«¯ç”¨äºé¢„è§ˆï¼Œæ‰€ä»¥éœ€è¦å®ç°ä¸€ä¸ªä¸‹è½½PDFæ¥å£ï¼ŒåŒ…å«ä¸‹é¢åŠŸèƒ½ï¼š</p>
<ul>
<li>è¯»å–æ–‡ä»¶</li>
<li>è¿”å›æ–‡ä»¶ç»™å‰ç«¯</li>
</ul>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/27e61b01d79d06783178fad8da84e547e4ecba04/ChatPDF%E2%80%94%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93.png"></p>
<h4 id="4-2-1-PDFæ–‡ä»¶ç®¡ç†"><a href="#4-2-1-PDFæ–‡ä»¶ç®¡ç†" class="headerlink" title="4.2.1.PDFæ–‡ä»¶ç®¡ç†"></a>4.2.1.PDFæ–‡ä»¶ç®¡ç†</h4><p>ç”±äºå°†æ¥è¦å®ç°PDFä¸‹è½½åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦è®°ä½æ¯ä¸€ä¸ªchatIdå¯¹åº”çš„PDFæ–‡ä»¶åç§°ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»ï¼Œè®°å½•chatIdä¸pdfæ–‡ä»¶çš„æ˜ å°„å…³ç³»ï¼ŒåŒæ—¶å®ç°åŸºæœ¬çš„æ–‡ä»¶ä¿å­˜åŠŸèƒ½ã€‚</p>
<p>å…ˆåœ¨<code>com.itheima.ai.repository</code>ä¸­å®šä¹‰æ¥å£ï¼š</p>
<pre><code class="java">package com.itheima.ai.repository;

import org.springframework.core.io.Resource;

public interface FileRepository &#123;
    /**
     * ä¿å­˜æ–‡ä»¶,è¿˜è¦è®°å½•chatIdä¸æ–‡ä»¶çš„æ˜ å°„å…³ç³»
     * @param chatId ä¼šè¯id
     * @param resource æ–‡ä»¶
     * @return ä¸Šä¼ æˆåŠŸï¼Œè¿”å›trueï¼› å¦åˆ™è¿”å›false
     */
    boolean save(String chatId, Resource resource);

    /**
     * æ ¹æ®chatIdè·å–æ–‡ä»¶
     * @param chatId ä¼šè¯id
     * @return æ‰¾åˆ°çš„æ–‡ä»¶
     */
    Resource getFile(String chatId);
&#125;
</code></pre>
<p>å…¶ä¸­çš„Rescourceæ˜¯åº•å±‚æä¾›çš„classã€Springä¸­è¡¨ç¤ºèµ„æºçš„ç±»ã€‘</p>
<pre><code class="java">D:\apache-maven-3.9.5\repository\org\springframework\spring-core\6.2.3\spring-core-6.2.3.jar!\org\springframework\core\io\Resource.class
//
// Source code recreated from a .class file by IntelliJ IDEA
// (powered by FernFlower decompiler)
//

package org.springframework.core.io;

import java.io.File;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.URI;
import java.net.URL;
import java.nio.channels.Channels;
import java.nio.channels.ReadableByteChannel;
import java.nio.charset.Charset;
import org.springframework.lang.Nullable;
import org.springframework.util.FileCopyUtils;

public interface Resource extends InputStreamSource &#123;
    boolean exists();

    default boolean isReadable() &#123;
        return this.exists();
    &#125;

    default boolean isOpen() &#123;
        return false;
    &#125;

    default boolean isFile() &#123;
        return false;
    &#125;

    URL getURL() throws IOException;

    URI getURI() throws IOException;

    File getFile() throws IOException;

    default ReadableByteChannel readableChannel() throws IOException &#123;
        return Channels.newChannel(this.getInputStream());
    &#125;

    default byte[] getContentAsByteArray() throws IOException &#123;
        return FileCopyUtils.copyToByteArray(this.getInputStream());
    &#125;

    default String getContentAsString(Charset charset) throws IOException &#123;
        return FileCopyUtils.copyToString(new InputStreamReader(this.getInputStream(), charset));
    &#125;

    long contentLength() throws IOException;

    long lastModified() throws IOException;

    Resource createRelative(String relativePath) throws IOException;

    @Nullable
    String getFilename();

    String getDescription();
&#125;
</code></pre>
<p>å†å†™ä¸€ä¸ªå®ç°ç±»ï¼š</p>
<pre><code class="java">package com.itheima.ai.repository;

import jakarta.annotation.PostConstruct;
import jakarta.annotation.PreDestroy;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.vectorstore.SimpleVectorStore;
import org.springframework.ai.vectorstore.VectorStore;
import org.springframework.core.io.FileSystemResource;
import org.springframework.core.io.Resource;
import org.springframework.stereotype.Component;
import org.springframework.web.multipart.MultipartFile;

import java.io.*;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.time.LocalDateTime;
import java.util.Objects;
import java.util.Properties;

@Slf4j
@Component
@RequiredArgsConstructor
public class LocalPdfFileRepository implements FileRepository &#123;

    private final VectorStore vectorStore;

    // ä¼šè¯id ä¸ æ–‡ä»¶åçš„å¯¹åº”å…³ç³»ï¼Œæ–¹ä¾¿æŸ¥è¯¢ä¼šè¯å†å²æ—¶é‡æ–°åŠ è½½æ–‡ä»¶
    private final Properties chatFiles = new Properties();

    @Override
    public boolean save(String chatId, Resource resource) &#123;

        // 2.ä¿å­˜åˆ°æœ¬åœ°ç£ç›˜
        String filename = resource.getFilename();
        File target = new File(Objects.requireNonNull(filename));
        if (!target.exists()) &#123;
            try &#123;
                Files.copy(resource.getInputStream(), target.toPath());
            &#125; catch (IOException e) &#123;
                log.error(&quot;Failed to save PDF resource.&quot;, e);
                return false;
            &#125;
        &#125;
        // 3.ä¿å­˜æ˜ å°„å…³ç³»
        chatFiles.put(chatId, filename);
        return true;
    &#125;

    @Override
    public Resource getFile(String chatId) &#123;
        return new FileSystemResource(chatFiles.getProperty(chatId));
    &#125;

    @PostConstruct
    private void init() &#123;
        // ä¼šè¯IDæ˜ å°„å…³ç³»
        FileSystemResource pdfResource = new FileSystemResource(&quot;chat-pdf.properties&quot;);
        if (pdfResource.exists()) &#123;
            try &#123;
                chatFiles.load(new BufferedReader(new InputStreamReader(pdfResource.getInputStream(), StandardCharsets.UTF_8)));
            &#125; catch (IOException e) &#123;
                throw new RuntimeException(e);
            &#125;
        &#125;
        // å‘é‡åº“çš„æŒä¹…åŒ– è¯»å–
        FileSystemResource vectorResource = new FileSystemResource(&quot;chat-pdf.json&quot;);
        if (vectorResource.exists()) &#123;
            SimpleVectorStore simpleVectorStore = (SimpleVectorStore) vectorStore;
            simpleVectorStore.load(vectorResource);
        &#125;
    &#125;

    @PreDestroy
    private void persistent() &#123;
        // åœæœºæ—¶æŒä¹…åŒ–
        try &#123;
            chatFiles.store(new FileWriter(&quot;chat-pdf.properties&quot;), LocalDateTime.now().toString());
            SimpleVectorStore simpleVectorStore = (SimpleVectorStore) vectorStore;
            simpleVectorStore.save(new File(&quot;chat-pdf.json&quot;));
        &#125; catch (IOException e) &#123;
            throw new RuntimeException(e);
        &#125;
    &#125;
&#125;
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<p>ç”±äºæˆ‘ä»¬é€‰æ‹©äº†åŸºäºå†…å­˜çš„SimpleVectorStoreï¼Œé‡å¯å°±ä¼šä¸¢å¤±å‘é‡æ•°æ®ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä¾ç„¶æ˜¯å°†pdfæ–‡ä»¶ä¸chatIdçš„å¯¹åº”å…³ç³»ã€VectorStoreéƒ½æŒä¹…åŒ–åˆ°äº†ç£ç›˜ã€‚</p>
<p>å®é™…å¼€å‘ä¸­ï¼Œå¦‚æœä½ é€‰æ‹©äº†RedisVectorStoreï¼Œæˆ–è€…CassandraVectorStoreï¼Œåˆ™æ— åºè‡ªå·±æŒä¹…åŒ–ã€‚ä½†æ˜¯chatIdå’ŒPDFæ–‡ä»¶ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œè¿˜æ˜¯éœ€è¦è‡ªå·±ç»´æŠ¤çš„ã€‚</p>
<h4 id="4-2-2-ä¸Šä¼ æ–‡ä»¶å“åº”ç»“æœ"><a href="#4-2-2-ä¸Šä¼ æ–‡ä»¶å“åº”ç»“æœ" class="headerlink" title="4.2.2.ä¸Šä¼ æ–‡ä»¶å“åº”ç»“æœ"></a>4.2.2.ä¸Šä¼ æ–‡ä»¶å“åº”ç»“æœ</h4><p>ç”±äºå‰ç«¯æ–‡ä»¶ä¸Šä¼ éœ€è¦è¿”å›å“åº”ç»“æœï¼Œæˆ‘ä»¬å…ˆåœ¨<code>com.itheima.ai.entity.vo</code>ä¸­å®šä¹‰ä¸€ä¸ª<code>Result</code>ç±»ï¼š</p>
<pre><code class="Java">package com.itheima.ai.entity.vo;

import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
public class Result &#123;
    private Integer ok;
    private String msg;

    private Result(Integer ok, String msg) &#123;
        this.ok = ok;
        this.msg = msg;
    &#125;

    public static Result ok() &#123;
        return new Result(1, &quot;ok&quot;);
    &#125;

    public static Result fail(String msg) &#123;
        return new Result(0, msg);
    &#125;
&#125;
</code></pre>
<h4 id="4-2-3-æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½"><a href="#4-2-3-æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½" class="headerlink" title="4.2.3.æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½"></a>4.2.3.æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½</h4><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®ç°ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶æ¥å£ã€‚</p>
<p>åœ¨<code>com.itheima.ai.controller</code>ä¸­åˆ›å»ºä¸€ä¸ª<code>PdfController</code>ï¼š</p>
<pre><code class="java">package com.itheima.ai.controller;

import com.itheima.ai.entity.vo.Result;
import com.itheima.ai.repository.FileRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.ai.document.Document;
import org.springframework.ai.reader.ExtractedTextFormatter;
import org.springframework.ai.reader.pdf.PagePdfDocumentReader;
import org.springframework.ai.reader.pdf.config.PdfDocumentReaderConfig;
import org.springframework.ai.vectorstore.VectorStore;
import org.springframework.core.io.Resource;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import java.io.IOException;
import java.net.URLEncoder;
import java.nio.charset.StandardCharsets;
import java.util.List;
import java.util.Objects;

@Slf4j
@RequiredArgsConstructor
@RestController
@RequestMapping(&quot;/ai/pdf&quot;)
public class PdfController &#123;

    private final FileRepository fileRepository;

    private final VectorStore vectorStore;
    /**
     * æ–‡ä»¶ä¸Šä¼ 
     */
    @RequestMapping(&quot;/upload/&#123;chatId&#125;&quot;)
    public Result uploadPdf(@PathVariable String chatId, @RequestParam(&quot;file&quot;) MultipartFile file) &#123;
        try &#123;
            // 1. æ ¡éªŒæ–‡ä»¶æ˜¯å¦ä¸ºPDFæ ¼å¼
            if (!Objects.equals(file.getContentType(), &quot;application/pdf&quot;)) &#123;
                return Result.fail(&quot;åªèƒ½ä¸Šä¼ PDFæ–‡ä»¶ï¼&quot;);
            &#125;
            // 2.ä¿å­˜æ–‡ä»¶
            boolean success = fileRepository.save(chatId, file.getResource());
            if(! success) &#123;
                return Result.fail(&quot;ä¿å­˜æ–‡ä»¶å¤±è´¥ï¼&quot;);
            &#125;
            // 3.å†™å…¥å‘é‡åº“
            this.writeToVectorStore(file.getResource());
            return Result.ok();
        &#125; catch (Exception e) &#123;
            log.error(&quot;Failed to upload PDF.&quot;, e);
            return Result.fail(&quot;ä¸Šä¼ æ–‡ä»¶å¤±è´¥ï¼&quot;);
        &#125;
    &#125;

    /**
     * æ–‡ä»¶ä¸‹è½½
     */
    @GetMapping(&quot;/file/&#123;chatId&#125;&quot;)
    public ResponseEntity&lt;Resource&gt; download(@PathVariable(&quot;chatId&quot;) String chatId) throws IOException &#123;
        // 1.è¯»å–æ–‡ä»¶
        Resource resource = fileRepository.getFile(chatId);
        if (!resource.exists()) &#123;
            return ResponseEntity.notFound().build();
        &#125;
        // 2.æ–‡ä»¶åç¼–ç ï¼Œå†™å…¥å“åº”å¤´
        String filename = URLEncoder.encode(Objects.requireNonNull(resource.getFilename()), StandardCharsets.UTF_8);
        // 3.è¿”å›æ–‡ä»¶
        return ResponseEntity.ok()
                .contentType(MediaType.APPLICATION_OCTET_STREAM)
                .header(&quot;Content-Disposition&quot;, &quot;attachment; filename=\&quot;&quot; + filename + &quot;\&quot;&quot;)
                .body(resource);
    &#125;

    private void writeToVectorStore(Resource resource) &#123;
        // 1.åˆ›å»ºPDFçš„è¯»å–å™¨
        PagePdfDocumentReader reader = new PagePdfDocumentReader(
                resource, // æ–‡ä»¶æº
                PdfDocumentReaderConfig.builder()
                        .withPageExtractedTextFormatter(ExtractedTextFormatter.defaults())
                        .withPagesPerDocument(1) // æ¯1é¡µPDFä½œä¸ºä¸€ä¸ªDocument
                        .build()
        );
        // 2.è¯»å–PDFæ–‡æ¡£ï¼Œæ‹†åˆ†ä¸ºDocument
        List&lt;Document&gt; documents = reader.read();
        // 3.å†™å…¥å‘é‡åº“
        vectorStore.add(documents);
    &#125;
&#125;
</code></pre>
<h4 id="4-2-4-ä¸Šä¼ å¤§å°é™åˆ¶"><a href="#4-2-4-ä¸Šä¼ å¤§å°é™åˆ¶" class="headerlink" title="4.2.4.ä¸Šä¼ å¤§å°é™åˆ¶"></a>4.2.4.ä¸Šä¼ å¤§å°é™åˆ¶</h4><p>SpringMVCæœ‰é»˜è®¤çš„æ–‡ä»¶å¤§å°é™åˆ¶ï¼Œåªæœ‰10Mï¼Œå¾ˆå¤šçŸ¥è¯†åº“æ–‡ä»¶éƒ½ä¼šè¶…è¿‡è¿™ä¸ªå€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹é…ç½®ï¼Œå¢åŠ æ–‡ä»¶ä¸Šä¼ å…è®¸çš„ä¸Šé™ã€‚</p>
<p>ä¿®æ”¹<code>application.yaml</code>æ–‡ä»¶ï¼Œæ·»åŠ é…ç½®ï¼š</p>
<pre><code class="yaml">spring:
  servlet:
    multipart:
      max-file-size: 104857600
      max-request-size: 104857600
</code></pre>
<h4 id="4-2-5-æš´éœ²å“åº”å¤´"><a href="#4-2-5-æš´éœ²å“åº”å¤´" class="headerlink" title="4.2.5.æš´éœ²å“åº”å¤´"></a>4.2.5.æš´éœ²å“åº”å¤´</h4><p>é»˜è®¤æƒ…å†µä¸‹è·¨åŸŸè¯·æ±‚çš„å“åº”å¤´æ˜¯ä¸æš´éœ²çš„ï¼Œè¿™æ ·å‰ç«¯å°±æ‹¿ä¸åˆ°ä¸‹è½½çš„æ–‡ä»¶åï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹CORSé…ç½®ï¼Œæš´éœ²å“åº”å¤´ï¼š</p>
<pre><code class="java">package com.itheima.ai.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class MvcConfiguration implements WebMvcConfigurer &#123;

    @Override
    public void addCorsMappings(CorsRegistry registry) &#123;
        registry.addMapping(&quot;/**&quot;)
                .allowedOrigins(&quot;*&quot;)
                .allowedMethods(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;)
                .allowedHeaders(&quot;*&quot;)
                .exposedHeaders(&quot;Content-Disposition&quot;);
    &#125;
&#125;
</code></pre>
<h3 id="4-3-é…ç½®ChatClient"><a href="#4-3-é…ç½®ChatClient" class="headerlink" title="4.3.é…ç½®ChatClient"></a>4.3.é…ç½®ChatClient</h3><p>æ¥ä¸‹æ¥å°±æ˜¯æœ€åçš„ç¯èŠ‚äº†ï¼Œå®ç°RAGçš„å¯¹è¯æµç¨‹ã€‚</p>
<p>ç†è®ºä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬æ¯æ¬¡ä¸AIå¯¹è¯çš„å®Œæ•´æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>å°†ç”¨æˆ·çš„é—®é¢˜åˆ©ç”¨å‘é‡å¤§æ¨¡å‹åšå‘é‡åŒ– OpenAiEmbeddingModel</li>
<li>å»å‘é‡æ•°æ®åº“æ£€ç´¢ç›¸å…³çš„æ–‡æ¡£ VectorStore</li>
<li>æ‹¼æ¥æç¤ºè¯ï¼Œå‘é€ç»™å¤§æ¨¡å‹</li>
<li>è§£æå“åº”ç»“æœ</li>
</ul>
<p>ä¸è¿‡ï¼ŒSpringAIåŒæ ·åŸºäºAOPæŠ€æœ¯å¸®æˆ‘ä»¬å®Œæˆäº†å…¨éƒ¨æµç¨‹ï¼Œç”¨åˆ°çš„æ˜¯ä¸€ä¸ªå<code>QuestionAnswerAdvisor</code>çš„Advisorã€‚æˆ‘ä»¬åªéœ€è¦æŠŠ<code>VectorStore</code>é…ç½®åˆ°Advisorå³å¯ã€‚</p>
<p>æˆ‘ä»¬åœ¨<code>CommonConfiguration</code>ä¸­ç»™ChatPDFä¹Ÿå•ç‹¬å®šä¹‰ä¸€ä¸ª<code>ChatClient</code>ï¼š</p>
<pre><code class="Java">@Bean
public ChatClient pdfChatClient(
        OpenAiChatModel model,
        ChatMemory chatMemory,
        VectorStore vectorStore) &#123;
    return ChatClient.builder(model)
            .defaultSystem(&quot;è¯·æ ¹æ®æä¾›çš„ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ï¼Œä¸è¦è‡ªå·±çŒœæµ‹ã€‚&quot;)
            .defaultAdvisors(
                    new MessageChatMemoryAdvisor(chatMemory), // CHAT MEMORY
                    new SimpleLoggerAdvisor(),
                    new QuestionAnswerAdvisor(
                            vectorStore, // å‘é‡åº“
                            SearchRequest.builder() // å‘é‡æ£€ç´¢çš„è¯·æ±‚å‚æ•°
                                    .similarityThreshold(0.5d) // ç›¸ä¼¼åº¦é˜ˆå€¼
                                    .topK(2) // è¿”å›çš„æ–‡æ¡£ç‰‡æ®µæ•°é‡
                                    .build()
                    )
            )
            .build();
&#125;
</code></pre>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±è‡ªå®šä¹‰RAGæŸ¥è¯¢çš„æµç¨‹ï¼Œä¸ä½¿ç”¨Advisorï¼Œå…·ä½“å¯å‚è€ƒå®˜ç½‘ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/api/retrieval-augmented-generation.html">https://docs.spring.io/spring-ai/reference/api/retrieval-augmented-generation.html</a></p>
<h3 id="4-4-å¯¹è¯æ¥å£"><a href="#4-4-å¯¹è¯æ¥å£" class="headerlink" title="4.4.å¯¹è¯æ¥å£"></a>4.4.å¯¹è¯æ¥å£</h3><p>æœ€åï¼Œå°±æ˜¯å¯¹æ¥å‰ç«¯ï¼Œç„¶åä¸å¤§æ¨¡å‹å¯¹è¯äº†ã€‚ä¿®æ”¹<code>PdfController</code>ï¼Œæ·»åŠ ä¸€ä¸ªæ¥å£ï¼š</p>
<pre><code class="Java">@RequestMapping(value = &quot;/chat&quot;, produces = &quot;text/html;charset=UTF-8&quot;)
public Flux&lt;String&gt; chat(String prompt, String chatId) &#123;
    chatRepository.addChatId(&quot;pdf&quot;, chatId);
    Resource file = fileRepository.getFile(chatId);
    return pdfChatClient
            .prompt(prompt)
            .advisors(a -&gt; a.param(CHAT_MEMORY_CONVERSATION_ID_KEY, chatId))
            .advisors(a -&gt; a.param(QuestionAnswerAdvisor.FILTER_EXPRESSION, &quot;file_name == &#39;&quot;+file.getFilename()+&quot;&#39;&quot;))
            .stream()
            .content();
&#125;
</code></pre>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="5-å¤šæ¨¡æ€"><a href="#5-å¤šæ¨¡æ€" class="headerlink" title="5.å¤šæ¨¡æ€"></a>5.å¤šæ¨¡æ€</h2><p>å¤šæ¨¡æ€æ˜¯æŒ‡ä¸åŒç±»å‹çš„æ•°æ®è¾“å…¥ï¼Œ<strong>å¦‚æ–‡æœ¬ã€å›¾åƒã€å£°éŸ³ã€è§†é¢‘ç­‰</strong>ã€‚ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸å¤§æ¨¡å‹äº¤äº’éƒ½æ˜¯åŸºäºæ™®é€šæ–‡æœ¬è¾“å…¥ï¼Œè¿™è·Ÿæˆ‘ä»¬é€‰æ‹©çš„å¤§æ¨¡å‹æœ‰å…³ã€‚</p>
<p>deepseekã€qwen-maxç­‰æ¨¡å‹éƒ½æ˜¯çº¯æ–‡æœ¬æ¨¡å‹ï¼Œåœ¨ollamaå’Œç™¾ç‚¼å¹³å°ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½æ‰¾åˆ°å¾ˆå¤šå¤šæ¨¡æ€æ¨¡å‹ã€‚</p>
<p>ä»¥ollamaä¸ºä¾‹ï¼Œåœ¨æœç´¢æ—¶ç‚¹å‡»visonï¼Œå°±èƒ½æ‰¾åˆ°æ”¯æŒå›¾åƒè¯†åˆ«çš„æ¨¡å‹ï¼š<br>åœ¨é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°ä¹Ÿä¸€æ ·ï¼š</p>
<p>é˜¿é‡Œäº‘çš„qwen-omniæ¨¡å‹æ˜¯æ”¯æŒæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘è¾“å…¥çš„å…¨æ¨¡æ€æ¨¡å‹ï¼Œè¿˜èƒ½æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½ï¼Œéå¸¸å¼ºå¤§ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<p>åœ¨SpringAIçš„å½“å‰ç‰ˆæœ¬ï¼ˆ1.0.0-m6)ä¸­ï¼Œqwen-omniä¸SpringAIä¸­çš„OpenAIæ¨¡å—çš„å…¼å®¹æ€§æœ‰é—®é¢˜ï¼Œç›®å‰ä»…æ”¯æŒæ–‡æœ¬å’Œå›¾ç‰‡ä¸¤ç§æ¨¡æ€ã€‚éŸ³é¢‘ä¼šæœ‰æ•°æ®æ ¼å¼é”™è¯¯é—®é¢˜ï¼Œè§†é¢‘å®Œå…¨ä¸æ”¯æŒã€‚</p>
<p>ç›®å‰çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>ä¸€æ˜¯ä½¿ç”¨spring-ai-alibabaæ¥æ›¿ä»£ã€‚</li>
<li>äºŒæ˜¯é‡å†™OpenAIModelçš„å®ç°ï¼Œå‚è€ƒç¬¬6èŠ‚</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ‹“å±•å…¥é—¨æ—¶å†™çš„å¯¹è¯æœºå™¨äººï¼Œè®©ä»–æ”¯æŒå¤šæ¨¡æ€æ•ˆæœã€‚</p>
<h3 id="5-1-åˆ‡æ¢æ¨¡å‹"><a href="#5-1-åˆ‡æ¢æ¨¡å‹" class="headerlink" title="5.1.åˆ‡æ¢æ¨¡å‹"></a>5.1.åˆ‡æ¢æ¨¡å‹</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹<code>CommonConfiguration</code>ä¸­ç”¨äºAIå¯¹è¯çš„<code>ChatClient</code>ï¼Œå°†æ¨¡å‹ä¿®æ”¹ä¸º<code>OpenAIChatModel</code>ï¼Œä¸ä»…å¦‚æ­¤ï¼Œç”±äºå…¶å®ƒä¸šåŠ¡ä½¿ç”¨çš„æ˜¯<code>qwen-max</code>æ¨¡å‹ï¼Œä¸èƒ½æ”¹å˜ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¿˜éœ€æ·»åŠ è‡ªå®šä¹‰é…ç½®ï¼Œå°†æ¨¡å‹æ”¹ä¸º<code>qwen-omni-turbo</code>:</p>
<pre><code class="Java">com/itheima/ai/config/CommonConfiguration.java
@Bean
public ChatClient chatClient(OpenAiChatModel model, ChatMemory chatMemory) &#123;
    return ChatClient.builder(model) // åˆ›å»ºChatClientå·¥å‚å®ä¾‹
            .defaultOptions(ChatOptions.builder().model(&quot;qwen-omni-turbo&quot;).build())
            .defaultSystem(&quot;æ‚¨æ˜¯ä¸€å®¶åä¸ºâ€œé»‘é©¬ç¨‹åºå‘˜â€çš„èŒä¸šæ•™è‚²å…¬å¸çš„å®¢æˆ·èŠå¤©åŠ©æ‰‹ï¼Œä½ çš„åå­—å«å°é»‘ã€‚è¯·ä»¥å‹å¥½ã€ä¹äºåŠ©äººå’Œæ„‰å¿«çš„æ–¹å¼è§£ç­”ç”¨æˆ·çš„å„ç§é—®é¢˜ã€‚&quot;)
            .defaultAdvisors(new SimpleLoggerAdvisor()) // æ·»åŠ é»˜è®¤çš„Advisor,è®°å½•æ—¥å¿—
            .defaultAdvisors(new MessageChatMemoryAdvisor(chatMemory))
            .build(); // æ„å»ºChatClientå®ä¾‹

&#125;
</code></pre>
<h3 id="5-2-å¤šæ¨¡æ€å¯¹è¯"><a href="#5-2-å¤šæ¨¡æ€å¯¹è¯" class="headerlink" title="5.2.å¤šæ¨¡æ€å¯¹è¯"></a>5.2.å¤šæ¨¡æ€å¯¹è¯</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹åŸæ¥çš„<code>/ai/chat</code>æ¥å£ï¼Œè®©å®ƒæ”¯æŒæ–‡ä»¶ä¸Šä¼ å’Œå¤šæ¨¡æ€å¯¹è¯ã€‚</p>
<p>ä¿®æ”¹<code>ChatController</code>ï¼š</p>
<pre><code class="Java">package com.itheima.ai.controller;

import com.itheima.ai.repository.ChatHistoryRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.model.Media;
import org.springframework.util.MimeType;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;
import reactor.core.publisher.Flux;

import java.util.List;
import java.util.Objects;

import static org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY;

@RequiredArgsConstructor
@RestController
@RequestMapping(&quot;/ai&quot;)
public class ChatController &#123;

    private final ChatClient chatClient;

    private final ChatHistoryRepository chatHistoryRepository;

    @RequestMapping(value = &quot;/chat&quot;, produces = &quot;text/html;charset=utf-8&quot;)
    public Flux&lt;String&gt; chat(
            @RequestParam(&quot;prompt&quot;) String prompt,
            @RequestParam(&quot;chatId&quot;) String chatId,
            @RequestParam(value = &quot;files&quot;, required = false) List&lt;MultipartFile&gt; files) &#123;
        // 1.ä¿å­˜ä¼šè¯id
        chatHistoryRepository.save(&quot;chat&quot;, chatId);
        // 2.è¯·æ±‚æ¨¡å‹
        if (files == null || files.isEmpty()) &#123;
            // æ²¡æœ‰é™„ä»¶ï¼Œçº¯æ–‡æœ¬èŠå¤©
            return textChat(prompt, chatId);
        &#125; else &#123;
            // æœ‰é™„ä»¶ï¼Œå¤šæ¨¡æ€èŠå¤©
            return multiModalChat(prompt, chatId, files);
        &#125;

    &#125;

    private Flux&lt;String&gt; multiModalChat(String prompt, String chatId, List&lt;MultipartFile&gt; files) &#123;
        // 1.è§£æå¤šåª’ä½“
        List&lt;Media&gt; medias = files.stream()
                .map(file -&gt; new Media(
                                MimeType.valueOf(Objects.requireNonNull(file.getContentType())),
                                file.getResource()
                        )
                )
                .toList();
        // 2.è¯·æ±‚æ¨¡å‹
        return chatClient.prompt()
                .user(p -&gt; p.text(prompt).media(medias.toArray(Media[]::new)))
                .advisors(a -&gt; a.param(CHAT_MEMORY_CONVERSATION_ID_KEY, chatId))
                .stream()
                .content();
    &#125;

    private Flux&lt;String&gt; textChat(String prompt, String chatId) &#123;
        return chatClient.prompt()
                .user(prompt)
                .advisors(a -&gt; a.param(CHAT_MEMORY_CONVERSATION_ID_KEY, chatId))
                .stream()
                .content();
    &#125;
&#125;
</code></pre>
<h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3>
    </div>

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <div id="comment">
        <div id="gitalk-container">
        </div>
    </div>
    
</div>
                     
<footer id="footer">
    <div class="footer-wrap">
        <div>
            Â© 2018 - 2025 P-luminary
            <span class="footer-icon">
                <a-icon type="flag" theme="filled" /></span>
            @Asuna
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a>
<!--         & <a target="_blank" rel="noopener" href="https://github.com/korilin/hexo-theme-particle">Particle Theme</a></div> -->
        
    </div>

</footer>

<script src="/js/highlight.min.js"></script>
<script src="/js/particle.js"></script>
                </div>
            </div>
        </transition>
    </div>

    <script>
    new Vue({
        el: "#layout",
        data: {
            show_page: false,
            onload_menu: false,
            menu_show: false,
            card_top: 100
        },
        created: function () {
            var that = this
            window.onload = function () {
                that.show_page = true
                document.getElementById("loadcontent").style.opacity = 0
                setTimeout(function () {
                    document.getElementById("loadleft").style.width = 0
                    document.getElementById("loadright").style.width = 0
                }, 300)
                setTimeout(function () {
                    document.getElementById("loading").style = "display:none"
                }, 600)
            }
        },
        mounted: function () {
            var that = this
            window.addEventListener('scroll', function (e) {
                that.menu_show = false
            })
        },
        methods: {
            home_click: function () {
                window.scrollTo({
                    top: window.innerHeight - 80,
                    behavior: "smooth",
                });
            }
        }
    })
</script>

<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
    const gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'hexo-theme-particle',      // The repository of store comments,
        owner: 'P-luminary',
        admin: ['P-luminary'],
        language: 'en',
        id: location.pathname,      // Ensure uniqueness and length less than 50
        distractionFreeMode: true  // Facebook-like distraction free mode
    })
    gitalk.render('gitalk-container')
</script>

</body>

</html>