
<!DOCTYPE html>
<html lang="zh_CH ">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P-luminary || Jenkins</title>
    <meta name="author" content="Asuna">
    <meta name="description" content=" ">
    <meta name="keywords" content=" ">
    <link rel="icon" href="/https://raw.githubusercontent.com/P-luminary/images/master/data/asuna.jpg">
    <link rel="stylesheet" href="/css/antd.min.css">
    
    <link rel="stylesheet" href="/css/maiden-theme.css">
    
    <script src="/js/vue.js"></script>
    <script src="/js/antd.min.js"></script>
<meta name="generator" content="Hexo 6.1.0"></head>

<body>

    <div id="loading"
        style="height: 100vh; width: 100%; position: fixed;display: flex;z-index: 200; justify-content: space-between;">
        <div id="loadleft" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div id="loadright" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div
            style="position: fixed; height: 100vh; width: 100%;display: flex;justify-content: center;align-items: center;">
            <div id="loadcontent"
                style="width:400px;height:400px;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px#a3ddfb; text-align:center;opacity:1;transition:opacity 0.3s ease-out;">
                <div>
                    <h2>LOADING...</h2>
                    <p>åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜(æµè§ˆå™¨é»˜è®¤å¼€å¯)</p>
                    <div>
                        <img src="/dancingkitty.gif" alt="loading">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="layout">
        <transition name="into">
            <div v-show="show_page" style="display: none;">
                <div id="menu_show">
                     
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">P-luminary</span>
        </a>
        
        <a href="/">
            <span>
                <a-icon type="home" theme="filled" />
            </span>
            <span>home</span>
        </a>
        
        <a href="/tags/è¯­æ³•">
            <span>
                <a-icon type="tags" theme="filled" />
            </span>
            <span>tags</span>
        </a>
        
    </div>

    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div :class="'title'" @click="menu_show=!menu_show">
            <span style="margin-right: 10px;">
                <a-icon type="appstore" theme="filled" />
            </span>
            <span>P-luminary</span>
        </div>
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="home" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">home</div>
                </div>
            </a>
            
            <a href="/tags/è¯­æ³•">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="tags" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">tags</div>
                </div>
            </a>
            
        </div>
        <div class="curtain" v-show="menu_show"></div>
    </div>

</nav>
                </div>

                <div id="main">
                     
<link rel="stylesheet" href="/css/post-body.css">
<div class="article">
    <div>
        <h1>Jenkins </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <a-icon type="calendar" theme="filled" />
            </span>
            2025/6/15
        </span>

        

        

        <span class="tags">
            <span class="icon">
                <a-icon type="tags" theme="filled" />
            </span>
            
            <span class="tag">
                
                <a href="/tags/åç«¯" style=color:#1bccbc>
                    åç«¯
                </a>
            </span>
            
        </span>
        
    </div>

    <div class="content" v-pre>
        <h3 id="æŒç»­é›†æˆåŠJenKinsä»‹ç»"><a href="#æŒç»­é›†æˆåŠJenKinsä»‹ç»" class="headerlink" title="æŒç»­é›†æˆåŠJenKinsä»‹ç»"></a>æŒç»­é›†æˆåŠJenKinsä»‹ç»</h3><p><strong>é…å¥—åŸç‰ˆèµ„æ–™</strong>ï¼š<a href="file:///E:/Javaå®ä¾‹é¡¹ç›®1-20å¥—/èµ„æ–™-Jenkinsæ•™ç¨‹/Jenkinsèµ„æ–™/ç¬”è®°/JenkinsæŒç»­é›†æˆä»å…¥é—¨åˆ°ç²¾é€š.pdf">JenkinsæŒç»­é›†æˆä»å…¥é—¨åˆ°ç²¾é€š.pdf</a></p>
<p>è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸã€<strong>éœ€æ±‚åˆ†æã€è®¾è®¡ã€å®ç°ã€æµ‹è¯•ã€è¿›åŒ–</strong>ã€‘</p>
<h3 id="è½¯ä»¶å¼€å‘ç€‘å¸ƒæ¨¡å‹"><a href="#è½¯ä»¶å¼€å‘ç€‘å¸ƒæ¨¡å‹" class="headerlink" title="è½¯ä»¶å¼€å‘ç€‘å¸ƒæ¨¡å‹"></a>è½¯ä»¶å¼€å‘ç€‘å¸ƒæ¨¡å‹</h3><p>ç€‘å¸ƒæ¨¡å‹æ˜¯æœ€è‘—åå’Œæœ€å¸¸ä½¿ç”¨çš„è½¯ä»¶å¼€å‘æ¨¡å‹ã€‚ç€‘å¸ƒæ¨¡å‹å°±æ˜¯ä¸€ç³»åˆ—çš„è½¯ä»¶å¼€å‘è¿‡ç¨‹ã€‚å®ƒæ˜¯ç”±åˆ¶é€ ä¸šç¹ è¡å‡ºæ¥çš„ã€‚ä¸€ä¸ªé«˜åº¦åŒ–çš„ç»“æ„æµç¨‹åœ¨ä¸€ä¸ªæ–¹å‘ä¸ŠæµåŠ¨ï¼Œæœ‰ç‚¹åƒç”Ÿäº§çº¿ä¸€æ ·ã€‚åœ¨ç€‘å¸ƒæ¨¡å‹åˆ›å»ºä¹‹åˆï¼Œæ²¡æœ‰ å…¶å®ƒå¼€å‘çš„æ¨¡å‹ï¼Œæœ‰å¾ˆå¤šä¸œè¥¿å…¨é å¼€å‘äººå‘˜å»çŒœæµ‹ï¼Œå»å¼€å‘ã€‚è¿™æ ·çš„æ¨¡å‹ä»…é€‚ç”¨äºé‚£äº›ç®€å•çš„è½¯ä»¶å¼€ å‘ï¼Œ ä½†æ˜¯å·²ç»ä¸é€‚åˆç°åœ¨çš„å¼€å‘äº†ã€‚</p>
<table>
<thead>
<tr>
<th>ä¼˜åŠ¿</th>
<th>åŠ£åŠ¿</th>
</tr>
</thead>
<tbody><tr>
<td>ç®€å•æ˜“ç”¨å’Œç†è§£</td>
<td>å„ä¸ªé˜¶æ®µçš„åˆ’åˆ†å®Œå…¨å›ºå®šï¼Œé˜¶æ®µä¹‹é—´äº§ç”Ÿå¤§é‡çš„æ–‡æ¡£ï¼Œæå¤§åœ° å¢åŠ äº†å·¥ä½œé‡ã€‚</td>
</tr>
<tr>
<td>å½“å‰ä¸€é˜¶æ®µå®Œæˆåï¼Œæ‚¨åªéœ€è¦ å»å…³æ³¨åç»­é˜¶æ®µ</td>
<td>ç”±äºå¼€å‘æ¨¡å‹æ˜¯çº¿æ€§çš„ï¼Œç”¨æˆ·åªæœ‰ç­‰åˆ°æ•´ä¸ªè¿‡ç¨‹çš„æœ«æœŸæ‰èƒ½è§ åˆ°å¼€å‘æˆæœï¼Œä»è€Œå¢åŠ äº†å¼€å‘é£é™©</td>
</tr>
<tr>
<td>ä¸ºé¡¹ç›®æä¾›äº†æŒ‰é˜¶æ®µåˆ’åˆ†çš„æ£€ æŸ¥èŠ‚ç‚¹</td>
<td>ç€‘å¸ƒæ¨¡å‹çš„çªå‡ºç¼ºç‚¹æ˜¯ä¸é€‚åº”ç”¨æˆ·éœ€æ±‚çš„å˜åŒ–</td>
</tr>
</tbody></table>
<h3 id="è½¯ä»¶å¼€å‘æ•æ·å¼€å‘æ¨¡å‹"><a href="#è½¯ä»¶å¼€å‘æ•æ·å¼€å‘æ¨¡å‹" class="headerlink" title="è½¯ä»¶å¼€å‘æ•æ·å¼€å‘æ¨¡å‹"></a>è½¯ä»¶å¼€å‘æ•æ·å¼€å‘æ¨¡å‹</h3><p>æ•æ·å¼€å‘ï¼ˆAgile Developmentï¼‰ çš„æ ¸å¿ƒæ˜¯è¿­ä»£å¼€å‘ï¼ˆIterative Developmentï¼‰ ä¸ å¢é‡å¼€å‘ ï¼ˆIncremental Developmentï¼‰ ã€‚ </p>
<p>&#x3D;&#x3D;<strong>ä½•ä¸ºè¿­ä»£å¼€å‘</strong>ï¼Ÿ&#x3D;&#x3D; å¯¹äºå¤§å‹è½¯ä»¶é¡¹ç›®ï¼Œä¼ ç»Ÿçš„å¼€å‘æ–¹å¼æ˜¯é‡‡ç”¨ä¸€ä¸ªå¤§å‘¨æœŸï¼ˆæ¯”å¦‚ä¸€å¹´ï¼‰è¿›è¡Œå¼€å‘ï¼Œæ•´ä¸ªè¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡â€å¤§ å¼€å‘â€ï¼›è¿­ä»£å¼€å‘çš„æ–¹å¼åˆ™ä¸ä¸€æ ·ï¼Œå®ƒå°†å¼€å‘è¿‡ç¨‹æ‹†åˆ†æˆå¤šä¸ªå°å‘¨æœŸï¼Œå³ä¸€æ¬¡â€å¤§å¼€å‘â€å˜æˆå¤šæ¬¡â€å°å¼€ å‘â€ï¼Œæ¯æ¬¡å°å¼€å‘éƒ½æ˜¯åŒæ ·çš„æµç¨‹ï¼Œæ‰€ä»¥çœ‹ä¸Šå»å°±å¥½åƒé‡å¤åœ¨åšåŒæ ·çš„æ­¥éª¤ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼ŒSpaceX å…¬å¸æƒ³é€ ä¸€ä¸ªå¤§æ¨åŠ›ç«ç®­ï¼Œå°†äººç±»é€åˆ°ç«æ˜Ÿã€‚ä½†æ˜¯ï¼Œå®ƒä¸æ˜¯ä¸€å¼€å§‹å°±é€ å¤§ç«ç®­ï¼Œè€Œ æ˜¯å…ˆé€ ä¸€ä¸ªæœ€ç®€é™‹çš„å°ç«ç®­ Falcon 1ã€‚ç»“æœï¼Œç¬¬ä¸€æ¬¡å‘å°„å°±çˆ†ç‚¸äº†ï¼Œç›´åˆ°ç¬¬å››æ¬¡å‘å°„ï¼Œæ‰æˆåŠŸè¿›å…¥è½¨ é“ã€‚ç„¶åï¼Œå¼€å‘äº†ä¸­å‹ç«ç®­ Falcon 9ï¼Œä¹å¹´ä¸­å‘å°„äº†70æ¬¡ã€‚æœ€åï¼Œæ‰å¼€å‘ Falcon é‡å‹ç«ç®­ã€‚å¦‚æœ SpaceX ä¸é‡‡ç”¨è¿­ä»£å¼€å‘ï¼Œå®ƒå¯èƒ½ç›´åˆ°ç°åœ¨è¿˜æ— æ³•ä¸Šå¤©ã€‚ </p>
<p>&#x3D;&#x3D;<strong>ä½•ä¸ºå¢é‡å¼€å‘</strong>ï¼Ÿ&#x3D;&#x3D; è½¯ä»¶çš„æ¯ä¸ªç‰ˆæœ¬ï¼Œéƒ½ä¼šæ–°å¢ä¸€ä¸ªç”¨æˆ·å¯ä»¥æ„ŸçŸ¥çš„å®Œæ•´åŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŒ‰ç…§æ–°å¢åŠŸèƒ½æ¥åˆ’åˆ†è¿­ä»£ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ¿äº§å…¬å¸å¼€å‘ä¸€ä¸ª10æ ‹æ¥¼çš„å°åŒºã€‚å¦‚æœé‡‡ç”¨å¢é‡å¼€å‘çš„æ¨¡å¼ï¼Œè¯¥å…¬å¸ç¬¬ä¸€ä¸ªè¿­ä»£å°±æ˜¯äº¤ä»˜ä¸€ å·æ¥¼ï¼Œç¬¬äºŒä¸ªè¿­ä»£äº¤ä»˜äºŒå·æ¥¼â€¦â€¦æ¯ä¸ªè¿­ä»£éƒ½æ˜¯å®Œæˆä¸€æ ‹å®Œæ•´çš„æ¥¼ã€‚è€Œä¸æ˜¯ç¬¬ä¸€ä¸ªè¿­ä»£æŒ–å¥½10æ ‹æ¥¼çš„åœ° åŸºï¼Œç¬¬äºŒä¸ªè¿­ä»£å»ºå¥½æ¯æ ‹æ¥¼çš„éª¨æ¶ï¼Œç¬¬ä¸‰ä¸ªè¿­ä»£æ¶è®¾å±‹é¡¶â€¦..</p>
<p>æ•æ·å¼€å‘å¦‚ä½•è¿­ä»£ï¼Ÿ<br>è™½ç„¶æ•æ·å¼€å‘å°†è½¯ä»¶å¼€å‘åˆ†æˆå¤šä¸ªè¿­ä»£ï¼Œä½†æ˜¯ä¹Ÿè¦æ±‚ï¼Œæ¯æ¬¡è¿­ä»£éƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„è½¯ä»¶å¼€å‘å‘¨æœŸï¼Œå¿…é¡»æŒ‰ ç…§è½¯ä»¶å·¥ç¨‹çš„æ–¹æ³•è®ºï¼Œè¿›è¡Œæ­£è§„çš„æµç¨‹ç®¡ç†ã€‚</p>
<p>æ•æ·å¼€å‘æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ  </p>
<p>&#x3D;&#x3D;<strong>æ—©æœŸäº¤ä»˜</strong>&#x3D;&#x3D; æ•æ·å¼€å‘çš„ç¬¬ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯æ—©æœŸäº¤ä»˜ï¼Œä»è€Œå¤§å¤§é™ä½æˆæœ¬ã€‚ è¿˜æ˜¯ä»¥ä¸Šä¸€èŠ‚çš„æˆ¿äº§å…¬å¸ä¸ºä¾‹ï¼Œå¦‚æœæŒ‰ç…§ ä¼ ç»Ÿçš„â€ç€‘å¸ƒå¼€å‘æ¨¡å¼â€ï¼Œå…ˆæŒ–10æ ‹æ¥¼çš„åœ°åŸºã€å†ç›–éª¨æ¶ã€ç„¶åæ¶è®¾å±‹é¡¶ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½ç­‰åˆ°å‰ä¸€ä¸ªé˜¶æ®µå®Œ æˆåå¼€å§‹ï¼Œå¯èƒ½éœ€è¦ä¸¤å¹´æ‰èƒ½ä¸€æ¬¡æ€§äº¤ä»˜10æ ‹æ¥¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸è€ƒè™‘é¢„å”®ï¼Œè¯¥é¡¹ç›®å¿…é¡»ç­‰åˆ°ä¸¤å¹´å æ‰èƒ½å›æ¬¾ã€‚ æ•æ·å¼€å‘æ˜¯å…­ä¸ªæœˆåäº¤ä»˜ä¸€å·æ¥¼ï¼Œåé¢æ¯ä¸¤ä¸ªæœˆäº¤ä»˜ä¸€æ ‹æ¥¼ã€‚å› æ­¤ï¼ŒåŠå¹´å°±èƒ½å›æ¬¾10%ï¼Œå é¢æ¯ä¸ªæœˆéƒ½ä¼šæœ‰ç°é‡‘æµï¼Œèµ„é‡‘å‹åŠ›å°±å¤§å¤§å‡è½»äº†ã€‚ </p>
<p>&#x3D;&#x3D;<strong>é™ä½é£é™©</strong>&#x3D;&#x3D; æ•æ·å¼€å‘çš„ç¬¬äºŒä¸ªå¥½å¤„æ˜¯ï¼ŒåŠæ—¶äº†è§£å¸‚åœºéœ€æ±‚ï¼Œé™ä½äº§å“ä¸é€‚ç”¨çš„é£é™©ã€‚ è¯·æƒ³ä¸€æƒ³ï¼Œå“ªä¸€ç§æƒ…å†µæŸå¤±æ¯” è¾ƒå°ï¼š10æ ‹æ¥¼éƒ½é€ å¥½ä»¥åï¼Œæ‰å‘ç°å–ä¸å‡ºå»ï¼Œè¿˜æ˜¯é€ å¥½ç¬¬ä¸€æ ‹æ¥¼ï¼Œå°±å‘ç°å–ä¸å‡ºå»ï¼Œä»è€Œæ”¹è¿›æˆ–åœå»ºåé¢9æ ‹æ¥¼</p>
<h3 id="æŒç»­é›†æˆ"><a href="#æŒç»­é›†æˆ" class="headerlink" title="æŒç»­é›†æˆ"></a>æŒç»­é›†æˆ</h3><p>æŒç»­é›†æˆï¼ˆ Continuous integration ï¼Œ ç®€ç§° CI ï¼‰æŒ‡çš„æ˜¯ï¼Œé¢‘ç¹åœ°ï¼ˆä¸€å¤©å¤šæ¬¡ï¼‰å°†ä»£ç é›†æˆåˆ°ä¸»å¹²ã€‚ <strong>æŒç»­é›†æˆçš„ç›®çš„ï¼Œå°±æ˜¯è®©äº§å“å¯ä»¥å¿«é€Ÿè¿­ä»£ï¼ŒåŒæ—¶è¿˜èƒ½ä¿æŒé«˜è´¨é‡</strong>ã€‚å®ƒçš„æ ¸å¿ƒæªæ–½æ˜¯ï¼Œä»£ç é›†æˆåˆ°ä¸»å¹² ä¹‹å‰ï¼Œå¿…é¡»é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚åªè¦æœ‰ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å¤±è´¥ï¼Œå°±ä¸èƒ½é›†æˆã€‚ é€šè¿‡æŒç»­é›†æˆï¼Œ å›¢é˜Ÿå¯ä»¥å¿«é€Ÿçš„ä»ä¸€ä¸ªåŠŸèƒ½åˆ°å¦ä¸€ä¸ªåŠŸèƒ½ï¼Œç®€è€Œè¨€ä¹‹ï¼Œæ•æ·è½¯ä»¶å¼€å‘å¾ˆå¤§ä¸€éƒ¨åˆ†éƒ½è¦å½’ åŠŸäºæŒç»­é›†æˆ</p>
<h5 id="æŒç»­é›†æˆçš„æµç¨‹"><a href="#æŒç»­é›†æˆçš„æµç¨‹" class="headerlink" title="æŒç»­é›†æˆçš„æµç¨‹"></a>æŒç»­é›†æˆçš„æµç¨‹</h5><h6 id="æäº¤"><a href="#æäº¤" class="headerlink" title="æäº¤"></a><span style = "color:red"><strong>æäº¤</strong></span></h6><p>æµç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œæ˜¯å¼€å‘è€…å‘ä»£ç ä»“åº“æäº¤ä»£ç ã€‚æ‰€æœ‰åé¢çš„æ­¥éª¤éƒ½å§‹äºæœ¬åœ°ä»£ç çš„ä¸€æ¬¡æäº¤ ï¼ˆcommitï¼‰ã€‚ </p>
<h6 id="æµ‹è¯•ï¼ˆç¬¬ä¸€è½®ï¼‰"><a href="#æµ‹è¯•ï¼ˆç¬¬ä¸€è½®ï¼‰" class="headerlink" title="æµ‹è¯•ï¼ˆç¬¬ä¸€è½®ï¼‰ "></a><span style = "color:red"><strong>æµ‹è¯•ï¼ˆç¬¬ä¸€è½®ï¼‰</strong> </span></h6><p>ä»£ç ä»“åº“å¯¹commitæ“ä½œé…ç½®äº†é’©å­ï¼ˆhookï¼‰ï¼Œåªè¦æäº¤ä»£ç æˆ–è€…åˆå¹¶è¿›ä¸»å¹²ï¼Œå°±ä¼šè·‘è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ </p>
<h6 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º "></a><span style = "color:red"><strong>æ„å»º</strong> </span></h6><p>é€šè¿‡ç¬¬ä¸€è½®æµ‹è¯•ï¼Œä»£ç å°±å¯ä»¥åˆå¹¶è¿›ä¸»å¹²ï¼Œå°±ç®—å¯ä»¥äº¤ä»˜äº†ã€‚ äº¤ä»˜åï¼Œå°±å…ˆè¿›è¡Œæ„å»ºï¼ˆbuildï¼‰ï¼Œå†è¿›å…¥ç¬¬äºŒè½®æµ‹è¯•ã€‚æ‰€è°“æ„å»ºï¼ŒæŒ‡çš„æ˜¯å°†æºç è½¬æ¢ä¸ºå¯ä»¥è¿è¡Œçš„å® é™…ä»£ç ï¼Œæ¯”å¦‚å®‰è£…ä¾èµ–ï¼Œé…ç½®å„ç§èµ„æºï¼ˆæ ·å¼è¡¨ã€JSè„šæœ¬ã€å›¾ç‰‡ï¼‰ç­‰ç­‰ã€‚ </p>
<h6 id="æµ‹è¯•ï¼ˆç¬¬äºŒè½®ï¼‰"><a href="#æµ‹è¯•ï¼ˆç¬¬äºŒè½®ï¼‰" class="headerlink" title="æµ‹è¯•ï¼ˆç¬¬äºŒè½®ï¼‰ "></a><span style = "color:red"><strong>æµ‹è¯•ï¼ˆç¬¬äºŒè½®ï¼‰</strong> </span></h6><p>æ„å»ºå®Œæˆï¼Œå°±è¦è¿›è¡Œç¬¬äºŒè½®æµ‹è¯•ã€‚å¦‚æœç¬¬ä¸€è½®å·²ç»æ¶µç›–äº†æ‰€æœ‰æµ‹è¯•å†…å®¹ï¼Œç¬¬äºŒè½®å¯ä»¥çœç•¥ï¼Œå½“ç„¶ï¼Œè¿™æ—¶ æ„å»ºæ­¥éª¤ä¹Ÿè¦ç§»åˆ°ç¬¬ä¸€è½®æµ‹è¯•å‰é¢ã€‚ </p>
<h6 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½² "></a><span style = "color:red"><strong>éƒ¨ç½²</strong> </span></h6><p>è¿‡äº†ç¬¬äºŒè½®æµ‹è¯•ï¼Œå½“å‰ä»£ç å°±æ˜¯ä¸€ä¸ªå¯ä»¥ç›´æ¥éƒ¨ç½²çš„ç‰ˆæœ¬ï¼ˆartifactï¼‰ã€‚å°†è¿™ä¸ªç‰ˆæœ¬çš„æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…ï¼ˆ tar filename.tar * ï¼‰å­˜æ¡£ï¼Œå‘åˆ°ç”Ÿäº§æœåŠ¡å™¨ã€‚ </p>
<h6 id="å›æ»š"><a href="#å›æ»š" class="headerlink" title="å›æ»š "></a><span style = "color:red"><strong>å›æ»š</strong> </span></h6><p>ä¸€æ—¦å½“å‰ç‰ˆæœ¬å‘ç”Ÿé—®é¢˜ï¼Œå°±è¦å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æ„å»ºç»“æœã€‚æœ€ç®€å•çš„åšæ³•å°±æ˜¯ä¿®æ”¹ä¸€ä¸‹ç¬¦å·é“¾æ¥ï¼ŒæŒ‡ å‘ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ç›®å½•</p>
<h3 id="æŒç»­é›†æˆçš„ç»„æˆè¦ç´ "><a href="#æŒç»­é›†æˆçš„ç»„æˆè¦ç´ " class="headerlink" title="æŒç»­é›†æˆçš„ç»„æˆè¦ç´ "></a>æŒç»­é›†æˆçš„ç»„æˆè¦ç´ </h3><ul>
<li>ä¸€ä¸ªè‡ªåŠ¨æ„å»ºè¿‡ç¨‹ï¼Œ ä»æ£€å‡ºä»£ç ã€ ç¼–è¯‘æ„å»ºã€ è¿è¡Œæµ‹è¯•ã€ ç»“æœè®°å½•ã€ æµ‹è¯•ç»Ÿè®¡ç­‰éƒ½æ˜¯è‡ªåŠ¨å®Œæˆ çš„ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚ </li>
<li>ä¸€ä¸ªä»£ç å­˜å‚¨åº“ï¼Œå³éœ€è¦ç‰ˆæœ¬æ§åˆ¶è½¯ä»¶æ¥ä¿éšœä»£ç çš„å¯ç»´æŠ¤æ€§ï¼ŒåŒæ—¶ä½œä¸ºæ„å»ºè¿‡ç¨‹çš„ç´ æåº“ï¼Œä¸€èˆ¬ä½¿ç”¨SVNæˆ–Gitã€‚ </li>
<li>ä¸€ä¸ªæŒç»­é›†æˆæœåŠ¡å™¨ï¼ŒJenkins å°±æ˜¯ä¸€ä¸ªé…ç½®ç®€å•å’Œä½¿ç”¨æ–¹ä¾¿çš„æŒç»­é›†æˆæœåŠ¡å™¨</li>
</ul>
<h3 id="æŒç»­é›†æˆçš„å¥½å¤„"><a href="#æŒç»­é›†æˆçš„å¥½å¤„" class="headerlink" title="æŒç»­é›†æˆçš„å¥½å¤„"></a>æŒç»­é›†æˆçš„å¥½å¤„</h3><p>1ã€é™ä½é£é™©ï¼Œç”±äºæŒç»­é›†æˆä¸æ–­å»æ„å»ºï¼Œç¼–è¯‘å’Œæµ‹è¯•ï¼Œå¯ä»¥å¾ˆæ—©æœŸå‘ç°é—®é¢˜ï¼Œæ‰€ä»¥ä¿®å¤çš„ä»£ä»·å°±å°‘ï¼›<br>2ã€å¯¹ç³»ç»Ÿå¥åº·æŒç»­æ£€æŸ¥ï¼Œå‡å°‘å‘å¸ƒé£é™©å¸¦æ¥çš„é—®é¢˜ï¼›<br>3ã€å‡å°‘é‡å¤æ€§å·¥ä½œï¼›<br>4ã€<strong>æŒç»­éƒ¨ç½²</strong>ï¼Œæä¾›å¯éƒ¨ç½²å•å…ƒåŒ…ï¼›<br>5ã€æŒç»­äº¤ä»˜å¯ä¾›ä½¿ç”¨çš„ç‰ˆæœ¬ï¼›<br>6ã€å¢å¼ºå›¢é˜Ÿä¿¡å¿ƒ</p>
<h3 id="JenKinsä»‹ç»"><a href="#JenKinsä»‹ç»" class="headerlink" title="JenKinsä»‹ç»"></a><span style = "color:red">JenKinsä»‹ç»</span></h3><p>Jenkins  æ˜¯ä¸€æ¬¾æµè¡Œçš„å¼€æºæŒç»­é›†æˆï¼ˆContinuous Integrationï¼‰å·¥å…·ï¼Œå¹¿æ³›ç”¨äºé¡¹ç›®å¼€å‘ï¼Œå…·æœ‰è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ç­‰åŠŸèƒ½ã€‚å®˜ç½‘ï¼š  <a target="_blank" rel="noopener" href="http://jenkins-ci.org/">http://jenkins-ci.org/</a><br>CIï¼šæŒç»­é›†æˆï¼ˆContinuous Integrationï¼‰<br>CDï¼šæŒç»­éƒ¨ç½²ï¼ˆContinuous ????ï¼‰</p>
<h4 id="Jenkinsçš„ç‰¹å¾ï¼š"><a href="#Jenkinsçš„ç‰¹å¾ï¼š" class="headerlink" title="Jenkinsçš„ç‰¹å¾ï¼š"></a>Jenkinsçš„ç‰¹å¾ï¼š</h4><ul>
<li>å¼€æºçš„ Javaè¯­è¨€å¼€å‘æŒç»­é›†æˆå·¥å…·ï¼Œæ”¯æŒæŒç»­é›†æˆï¼ŒæŒç»­éƒ¨ç½²ã€‚ </li>
<li>æ˜“äºå®‰è£…éƒ¨ç½²é…ç½®ï¼šå¯é€šè¿‡ æ–¹ä¾¿webç•Œé¢é…ç½®ç®¡ç†ã€‚ </li>
<li>æ¶ˆæ¯é€šçŸ¥åŠæµ‹è¯•æŠ¥å‘Šï¼šé›†æˆ yumå®‰è£…,æˆ–ä¸‹è½½waråŒ…ä»¥åŠé€šè¿‡dockerå®¹å™¨ç­‰å¿«é€Ÿå®ç°å®‰è£…éƒ¨ç½²ï¼Œå¯ RSS&#x2F;E-mailé€šè¿‡RSSå‘å¸ƒæ„å»ºç»“æœæˆ–å½“æ„å»ºå®Œæˆæ—¶é€šè¿‡e-mailé€šçŸ¥ï¼Œç”ŸæˆJUnit&#x2F;TestNGæµ‹è¯•æŠ¥å‘Šã€‚ Jenkinsèƒ½å¤Ÿè®©å¤šå°è®¡ç®—æœºä¸€èµ·æ„å»º&#x2F;æµ‹è¯•ã€‚ </li>
<li>åˆ†å¸ƒå¼æ„å»ºï¼šæ”¯æŒ </li>
<li>æ–‡ä»¶è¯†åˆ«ï¼š Jenkinsèƒ½å¤Ÿè·Ÿè¸ªå“ªæ¬¡æ„å»ºç”Ÿæˆå“ªäº›jarï¼Œå“ªæ¬¡æ„å»ºä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„jarç­‰ã€‚ </li>
<li>ä¸°å¯Œçš„æ’ä»¶æ”¯æŒï¼šæ”¯æŒæ‰©å±•æ’ä»¶ï¼Œä½ å¯ä»¥å¼€å‘é€‚åˆè‡ªå·±å›¢é˜Ÿä½¿ç”¨çš„å·¥å…·ï¼Œå¦‚ dockerç­‰</li>
</ul>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/5a664e75de77e3633f64215df2e5990365c3606a/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E6%B5%81%E7%A8%8B%E8%AF%B4%E6%98%8E.png" alt="æŒç»­é›†æˆæµç¨‹è¯´æ˜"></p>
<h4 id="æœåŠ¡å™¨åˆ—è¡¨-ç»Ÿä¸€ä½¿ç”¨CentOS7"><a href="#æœåŠ¡å™¨åˆ—è¡¨-ç»Ÿä¸€ä½¿ç”¨CentOS7" class="headerlink" title="æœåŠ¡å™¨åˆ—è¡¨[ç»Ÿä¸€ä½¿ç”¨CentOS7]"></a>æœåŠ¡å™¨åˆ—è¡¨[ç»Ÿä¸€ä½¿ç”¨CentOS7]</h4><table>
<thead>
<tr>
<th>åç§°</th>
<th>IPåœ°å€</th>
<th>å®‰è£…çš„è½¯ä»¶</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ä»£ç æ‰˜ç®¡æœåŠ¡å™¨</strong></td>
<td>192.168.200.128</td>
<td>Gitlab-12.4.2</td>
</tr>
<tr>
<td><strong>æŒç»­é›†æˆæœåŠ¡å™¨</strong></td>
<td>192.168.200.129</td>
<td>Jenkins-2.190.3ï¼ŒJDK1.8ï¼ŒMaven3.6.2ï¼ŒGitï¼Œ SonarQube</td>
</tr>
<tr>
<td><strong>åº”ç”¨æµ‹è¯•æœåŠ¡å™¨</strong></td>
<td>192.168.66.102</td>
<td>JDK1.8ï¼ŒTomcat8.5</td>
</tr>
</tbody></table>
<h3 id="Gitlab-å›¢é˜Ÿä¸ªäººç‰ˆgithub-ä»£ç æ‰˜ç®¡æœåŠ¡å™¨å®‰è£…"><a href="#Gitlab-å›¢é˜Ÿä¸ªäººç‰ˆgithub-ä»£ç æ‰˜ç®¡æœåŠ¡å™¨å®‰è£…" class="headerlink" title="Gitlab[å›¢é˜Ÿä¸ªäººç‰ˆgithub]ä»£ç æ‰˜ç®¡æœåŠ¡å™¨å®‰è£…"></a>Gitlab[å›¢é˜Ÿä¸ªäººç‰ˆgithub]ä»£ç æ‰˜ç®¡æœåŠ¡å™¨å®‰è£…</h3><p>[lanyun_group &#x2F; web_demo Â· GitLab] (<a target="_blank" rel="noopener" href="http://192.168.200.128:82/lanyun_group/web_demo">http://192.168.200.128:82/lanyun_group/web_demo</a>)</p>
<p>å®˜ç½‘ï¼š  <a target="_blank" rel="noopener" href="https://about.gitlab.com/">https://about.gitlab.com/</a><br>GitLab æ˜¯ä¸€ä¸ªç”¨äºä»“åº“ç®¡ç†ç³»ç»Ÿçš„å¼€æºé¡¹ç›®ï¼Œä½¿ç”¨Gitä½œä¸ºä»£ç ç®¡ç†å·¥å…·ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæ­å»ºèµ·æ¥çš„ webæœåŠ¡ã€‚</p>
<p>GitLabå’ŒGitHubä¸€æ ·å±äºç¬¬ä¸‰æ–¹åŸºäºGitå¼€å‘çš„ä½œå“ï¼Œå…è´¹ä¸”å¼€æºï¼ˆåŸºäºMITåè®®ï¼‰ï¼Œä¸Githubç±»ä¼¼ï¼Œ å¯ä»¥æ³¨å†Œç”¨æˆ·ï¼Œä»»æ„æäº¤ä½ çš„ä»£ç ï¼Œæ·»åŠ SSHKeyç­‰ç­‰ã€‚ä¸åŒçš„æ˜¯ï¼ŒGitLabæ˜¯å¯ä»¥éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨ ä¸Šï¼Œæ•°æ®åº“ç­‰ä¸€åˆ‡ä¿¡æ¯éƒ½æŒæ¡åœ¨è‡ªå·±æ‰‹ä¸Šï¼Œé€‚åˆå›¢é˜Ÿå†…éƒ¨åä½œå¼€å‘ï¼Œä½ æ€»ä¸å¯èƒ½æŠŠå›¢é˜Ÿå†…éƒ¨çš„æ™ºæ…§æ€»æ”¾ åœ¨åˆ«äººçš„æœåŠ¡å™¨ä¸Šå§ï¼Ÿç®€å•æ¥è¯´å¯æŠŠGitLabçœ‹ä½œä¸ªäººç‰ˆçš„GitHub</p>
<ul>
<li><p>å®‰è£…ç›¸å…³ä¾èµ– </p>
<blockquote>
<p>yum -y install policycoreutils openssh-server openssh-clients postfix</p>
</blockquote>
</li>
<li><p>å¯åŠ¨sshæœåŠ¡&amp;è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨</p>
<blockquote>
<p>systemctl enable sshd &amp;&amp; sudo systemctl start sshd </p>
</blockquote>
</li>
<li><p>è®¾ç½®postfixå¼€æœºè‡ªå¯ï¼Œå¹¶å¯åŠ¨ï¼Œpostfixæ”¯æŒgitlabå‘ä¿¡åŠŸèƒ½</p>
<blockquote>
<p>systemctl enable postfix &amp;&amp; systemctl start postfix </p>
</blockquote>
</li>
<li><p>å¼€æ”¾sshä»¥åŠhttpæœåŠ¡ï¼Œç„¶åé‡æ–°åŠ è½½é˜²ç«å¢™åˆ—è¡¨ </p>
<blockquote>
<p>firewall-cmd â€“add-service&#x3D;ssh â€“permanent<br>firewall-cmd â€“add-service&#x3D;http â€“permanent<br>firewall-cmd â€“reload </p>
</blockquote>
<p>å¦‚æœå…³é—­é˜²ç«å¢™å°±ä¸éœ€è¦åšä»¥ä¸Šé…ç½® </p>
</li>
<li><p>ä¸‹è½½gitlabåŒ…ï¼Œå¹¶ä¸”å®‰è£… </p>
<blockquote>
<p><strong>åœ¨çº¿ä¸‹è½½å®‰è£…åŒ…</strong>ï¼š<br>wget  <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6/gitlab-ce-12.4.2-ce.0.el6.x">https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6/gitlab-ce-12.4.2-ce.0.el6.x</a> 86_64.rpm <strong>å®‰è£…</strong>ï¼š<br>rpm -i gitlab-ce-12.4.2-ce.0.el6.x86_64.rpm </p>
</blockquote>
</li>
<li><p>ä¿®æ”¹gitlabé…ç½® </p>
<blockquote>
<p>vi &#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb </p>
</blockquote>
<p>ä¿®æ”¹gitlabè®¿é—®åœ°å€å’Œç«¯å£ï¼Œé»˜è®¤ä¸º80ï¼Œæˆ‘ä»¬æ”¹ä¸º82<br>external_url â€˜ <a href="http://192.168.200.132:82&#39;">http://192.168.200.132:82&#39;</a><br>nginx[â€˜listen_portâ€™] &#x3D; 82 </p>
</li>
<li><p>é‡è½½é…ç½®åŠ<span style = "color:red"><strong>å¯åŠ¨gitlab</strong></span> </p>
<blockquote>
<p>gitlab-ctl reconfigure<br>gitlab-ctl restart  â˜…â˜…</p>
</blockquote>
</li>
<li><p>æŠŠç«¯å£æ·»åŠ åˆ°é˜²ç«å¢™</p>
</li>
</ul>
<blockquote>
<p>firewall-cmd â€“zone&#x3D;public â€“add-port&#x3D;82&#x2F;tcp â€“permanent<br>firewall-cmd â€“reload </p>
<p>å¯åŠ¨æˆåŠŸåï¼Œçœ‹åˆ°ä»¥ä¸‹ä¿®æ”¹ç®¡ç†å‘˜rootå¯†ç çš„é¡µé¢ï¼Œä¿®æ”¹å¯†ç åï¼Œç„¶åç™»å½•å³å¯</p>
</blockquote>
<p>è´¦å·ï¼šroot<br>å¯†ç ï¼španchunyao123</p>
<h6 id="Gitlabç”¨æˆ·åœ¨ç»„é‡Œé¢æœ‰5ç§ä¸åŒæƒé™ï¼š"><a href="#Gitlabç”¨æˆ·åœ¨ç»„é‡Œé¢æœ‰5ç§ä¸åŒæƒé™ï¼š" class="headerlink" title="Gitlabç”¨æˆ·åœ¨ç»„é‡Œé¢æœ‰5ç§ä¸åŒæƒé™ï¼š"></a>Gitlabç”¨æˆ·åœ¨ç»„é‡Œé¢æœ‰5ç§ä¸åŒæƒé™ï¼š</h6><p>Guestï¼šå¯ä»¥åˆ›å»ºissueã€å‘è¡¨è¯„è®ºï¼Œä¸èƒ½è¯»å†™ç‰ˆæœ¬åº“<br>Reporterï¼šå¯ä»¥å…‹éš†ä»£ç ï¼Œä¸èƒ½æäº¤ï¼ŒQAã€PM å¯ä»¥èµ‹äºˆè¿™ä¸ªæƒé™<br>Developerï¼šå¯ä»¥å…‹éš†ä»£ç ã€å¼€å‘ã€æäº¤ã€pushï¼Œæ™®é€šå¼€å‘å¯ä»¥èµ‹äºˆè¿™ä¸ªæƒé™<br>Maintainerï¼šå¯ä»¥åˆ›å»ºé¡¹ç›®ã€æ·»åŠ tagã€ä¿æŠ¤åˆ†æ”¯ã€æ·»åŠ é¡¹ç›®æˆå‘˜ã€ç¼–è¾‘é¡¹ç›®ï¼Œæ ¸å¿ƒå¼€å‘å¯ä»¥èµ‹äºˆè¿™ä¸ª æƒé™ Ownerï¼šå¯ä»¥è®¾ç½®é¡¹ç›®è®¿é—®æƒé™ - Visibility Levelã€åˆ é™¤é¡¹ç›®ã€è¿ç§»é¡¹ç›®ã€ç®¡ç†ç»„æˆå‘˜ï¼Œå¼€å‘ç»„ç»„ é•¿å¯ä»¥èµ‹äºˆè¿™ä¸ªæƒé™</p>
<p>å¦‚æœå¼ ä¸‰è¢«ç®¡ç†å‘˜æ·»åŠ äº†Owneræƒé™ï¼Œé‚£ä¹ˆå¼ ä¸‰å°±å¯ä»¥åœ¨ideaé‡Œé¢é€šè¿‡gitlabé‡Œé¢çš„ä»“åº“åœ°å€ ä¸Šä¼ é¡¹ç›®åˆ°è¿™ä¸ªweb_demoäº†ã€‚</p>
<h4 id="æŒç»­é›†æˆç¯å¢ƒâ€”Jenkinså®‰è£…ã€æˆ‘ç”¨äº†æœ€æ–°çš„Jenkins-2-440-1ã€‘"><a href="#æŒç»­é›†æˆç¯å¢ƒâ€”Jenkinså®‰è£…ã€æˆ‘ç”¨äº†æœ€æ–°çš„Jenkins-2-440-1ã€‘" class="headerlink" title="æŒç»­é›†æˆç¯å¢ƒâ€”Jenkinså®‰è£…ã€æˆ‘ç”¨äº†æœ€æ–°çš„Jenkins 2.440.1ã€‘"></a>æŒç»­é›†æˆç¯å¢ƒâ€”Jenkinså®‰è£…ã€æˆ‘ç”¨äº†æœ€æ–°çš„Jenkins 2.440.1ã€‘</h4><p>[Setup Wizard [Jenkins]] (<a target="_blank" rel="noopener" href="http://192.168.200.129:8888/">http://192.168.200.129:8888/</a>)</p>
<ul>
<li><p>å®‰è£…JDK Jenkinséœ€è¦ä¾èµ–JDKï¼Œæ‰€ä»¥å…ˆå®‰è£…JDK1.8 </p>
<blockquote>
<p>yum install java-1.8.0-openjdk* -y</p>
</blockquote>
</li>
</ul>
<p>â€‹       å®‰è£…ç›®å½•ä¸ºï¼š&#x2F;usr&#x2F;lib&#x2F;jvm </p>
<ul>
<li>è·å–jenkinså®‰è£…åŒ…</li>
</ul>
<p>ä¸‹è½½é¡µé¢ï¼š <a target="_blank" rel="noopener" href="https://jenkins.io/zh/download/">https://jenkins.io/zh/download/</a><br>å®‰è£…æ–‡ä»¶ï¼šjenkins-2.190.3-1.1.noarch.rpm </p>
<ul>
<li><p>æŠŠå®‰è£…åŒ…ä¸Šä¼ åˆ°192.168.66.101æœåŠ¡å™¨ï¼Œè¿›è¡Œå®‰è£… </p>
<blockquote>
<p>rpm -ivh jenkins-2.190.3-1.1.noarch.rpm </p>
</blockquote>
</li>
<li><p>è¿›å…¥æ–‡ä»¶ç›®å½•</p>
<blockquote>
<p>cd &#x2F;etc&#x2F;sysconfig</p>
</blockquote>
</li>
<li><p>ä¿®æ”¹Jenkinsé…ç½® </p>
<blockquote>
<p>vi jenkins</p>
</blockquote>
</li>
</ul>
<p>ä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š </p>
<blockquote>
<p>JENKINS_USER&#x3D;â€rootâ€<br>JENKINS_PORT&#x3D;â€8888â€ </p>
</blockquote>
<ul>
<li><p><span style = "color:red">å¯åŠ¨<strong>Jenkins</strong></span></p>
<blockquote>
<p>systemctl start jenkins â˜…â˜…</p>
<p>[root@localhost sysconfig]# systemctl start jenkins</p>
</blockquote>
</li>
<li><p>æ‰“å¼€æµè§ˆå™¨è®¿é—®<br>[192.168.200.129:8888] (<a target="_blank" rel="noopener" href="http://192.168.200.129:8888/">http://192.168.200.129:8888/</a>)<br>æ³¨æ„ï¼šæœ¬æœåŠ¡å™¨æŠŠé˜²ç«å¢™å…³é—­äº†ï¼Œå¦‚æœå¼€å¯é˜²ç«å¢™ï¼Œéœ€è¦åœ¨é˜²ç«å¢™æ·»åŠ ç«¯å£ </p>
</li>
<li><p>è·å–å¹¶è¾“å…¥adminè´¦æˆ·å¯†ç  </p>
<blockquote>
<p>[root@localhost sysconfig]# cat &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;secrets&#x2F;initialAdminPassword</p>
<p>[root@localhost sysconfig]# cat &#x2F;root&#x2F;.jenkins&#x2F;secrets&#x2F;initialAdminPassword<br>3d83c355f83d4942847d4390fc5dcc39</p>
</blockquote>
</li>
<li><p>è·³è¿‡æ’ä»¶å®‰è£… [ç‚¹å‡»ç¬¬äºŒä¸ªé€‰æ‹© ç„¶åä¸Šé¢å…¨æ— ]<br>å› ä¸ºJenkinsæ’ä»¶éœ€è¦è¿æ¥é»˜è®¤å®˜ç½‘ä¸‹è½½ï¼Œé€Ÿåº¦éå¸¸æ…¢ï¼Œè€Œä¸”ç»è¿‡ä¼šå¤±è´¥ï¼Œæ‰€ä»¥æˆ‘ä»¬æš‚æ—¶å…ˆè·³è¿‡æ’ä»¶å®‰è£…</p>
</li>
</ul>
<h6 id="ç»¼ä¸Šæ“ä½œ"><a href="#ç»¼ä¸Šæ“ä½œ" class="headerlink" title="ç»¼ä¸Šæ“ä½œ"></a>ç»¼ä¸Šæ“ä½œ</h6><blockquote>
<p>[root@localhost ~]# java -version<br>java version â€œ21.0.1â€ 2023-10-17 LTS<br>Java(TM) SE Runtime Environment (build 21.0.1+12-LTS-29)<br>Java HotSpot(TM) 64-Bit Server VM (build 21.0.1+12-LTS-29, mixed mode, sharing)<br>[root@localhost ~]# cd &#x2F;usr&#x2F;lib&#x2F;jvm<br>[root@localhost jvm]# ll<br>æ€»ç”¨é‡ 0<br>lrwxrwxrwx. 1 root root  26 6æœˆ  15 16:27 java -&gt; &#x2F;etc&#x2F;alternatives&#x2F;java_sdk<br>lrwxrwxrwx. 1 root root  32 6æœˆ  15 16:27 java-1.8.0 -&gt; &#x2F;etc&#x2F;alternatives&#x2F;java_sdk_1.8.0<br>lrwxrwxrwx. 1 root root  40 6æœˆ  15 16:27 java-1.8.0-openjdk -&gt; &#x2F;etc&#x2F;alternatives&#x2F;java_sdk_1.8.0_openjdk<br>drwxr-xr-x. 9 root root 109 6æœˆ  15 16:27 java-1.8.0-openjdk-1.8.0.262.b10-1.el7.x86_64<br>lrwxrwxrwx. 1 root root  34 6æœˆ  15 16:27 java-openjdk -&gt; &#x2F;etc&#x2F;alternatives&#x2F;java_sdk_openjdk<br>lrwxrwxrwx. 1 root root  21 6æœˆ  15 16:27 jre -&gt; &#x2F;etc&#x2F;alternatives&#x2F;jre<br>lrwxrwxrwx. 1 root root  27 6æœˆ  15 16:27 jre-1.8.0 -&gt; &#x2F;etc&#x2F;alternatives&#x2F;jre_1.8.0<br>lrwxrwxrwx. 1 root root  35 6æœˆ  15 16:27 jre-1.8.0-openjdk -&gt; &#x2F;etc&#x2F;alternatives&#x2F;jre_1.8.0_openjdk<br>lrwxrwxrwx. 1 root root  49 6æœˆ  15 16:27 jre-1.8.0-openjdk-1.8.0.262.b10-1.el7.x86_64 -&gt; java-1.8.0-openjdk-1.8.0.262.b10-1.el7.x86_64&#x2F;jre<br>lrwxrwxrwx. 1 root root  29 6æœˆ  15 16:27 jre-openjdk -&gt; &#x2F;etc&#x2F;alternatives&#x2F;jre_openjdk<br>[root@localhost jvm]# cd java-1.8.0-openjdk<br>[root@localhost java-1.8.0-openjdk]#</p>
</blockquote>
<blockquote>
<h2 id="ä¸‹ä¸€æ­¥ï¼šä½ åªéœ€è¦æ‰§è¡Œ-å‡çº§Jenkinsçš„å‡çº§æµç¨‹"><a href="#ä¸‹ä¸€æ­¥ï¼šä½ åªéœ€è¦æ‰§è¡Œ-å‡çº§Jenkinsçš„å‡çº§æµç¨‹" class="headerlink" title="ä¸‹ä¸€æ­¥ï¼šä½ åªéœ€è¦æ‰§è¡Œ å‡çº§Jenkinsçš„å‡çº§æµç¨‹"></a>ä¸‹ä¸€æ­¥ï¼šä½ åªéœ€è¦æ‰§è¡Œ å‡çº§Jenkinsçš„å‡çº§æµç¨‹</h2><h3 id="ä»¥ä¸‹æ˜¯ä½ çš„ä¸“å±å‡çº§æ“ä½œæŒ‡ä»¤åˆé›†ï¼ˆCentOS-7-ä¸“ç”¨ï¼‰ï¼š"><a href="#ä»¥ä¸‹æ˜¯ä½ çš„ä¸“å±å‡çº§æ“ä½œæŒ‡ä»¤åˆé›†ï¼ˆCentOS-7-ä¸“ç”¨ï¼‰ï¼š" class="headerlink" title="ä»¥ä¸‹æ˜¯ä½ çš„ä¸“å±å‡çº§æ“ä½œæŒ‡ä»¤åˆé›†ï¼ˆCentOS 7 ä¸“ç”¨ï¼‰ï¼š"></a>ä»¥ä¸‹æ˜¯ä½ çš„ä¸“å±å‡çº§æ“ä½œæŒ‡ä»¤åˆé›†ï¼ˆCentOS 7 ä¸“ç”¨ï¼‰ï¼š</h3><hr>
<h3 id="ğŸ”§-1-å¤‡ä»½-Jenkins-æ•°æ®ï¼ˆå¯é€‰ä½†å¼ºçƒˆæ¨èï¼‰"><a href="#ğŸ”§-1-å¤‡ä»½-Jenkins-æ•°æ®ï¼ˆå¯é€‰ä½†å¼ºçƒˆæ¨èï¼‰" class="headerlink" title="ğŸ”§ 1. å¤‡ä»½ Jenkins æ•°æ®ï¼ˆå¯é€‰ä½†å¼ºçƒˆæ¨èï¼‰"></a>ğŸ”§ 1. å¤‡ä»½ Jenkins æ•°æ®ï¼ˆå¯é€‰ä½†å¼ºçƒˆæ¨èï¼‰</h3><pre><code class="js">sudo systemctl stop jenkins
sudo cp -r /var/lib/jenkins /var/lib/jenkins_backup_$(date +%F)
sudo cp /etc/sysconfig/jenkins /etc/sysconfig/jenkins.bak
</code></pre>
<hr>
<h3 id="ğŸ”§-2-æ·»åŠ -Jenkins-å®˜æ–¹-LTS-Yum-æº"><a href="#ğŸ”§-2-æ·»åŠ -Jenkins-å®˜æ–¹-LTS-Yum-æº" class="headerlink" title="ğŸ”§ 2. æ·»åŠ  Jenkins å®˜æ–¹ LTS Yum æº"></a>ğŸ”§ 2. æ·»åŠ  Jenkins å®˜æ–¹ LTS Yum æº</h3><pre><code class="js">sudo curl --silent --location https://pkg.jenkins.io/redhat-stable/jenkins.repo | sudo tee /etc/yum.repos.d/jenkins.repo &gt; /dev/null
sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io-2023.key
</code></pre>
<hr>
<h3 id="ğŸ”§-3-å‡çº§-Jenkins"><a href="#ğŸ”§-3-å‡çº§-Jenkins" class="headerlink" title="ğŸ”§ 3. å‡çº§ Jenkins"></a>ğŸ”§ 3. å‡çº§ Jenkins</h3><pre><code class="js">sudo yum clean all
sudo yum makecache
sudo yum upgrade jenkins -y
</code></pre>
<p>å¦‚æœæç¤ºæ²¡æœ‰å¯å‡çº§çš„ç‰ˆæœ¬ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¼ºåˆ¶é‡æ–°å®‰è£…æœ€æ–°ç‰ˆ Jenkinsï¼š</p>
<pre><code class="js">sudo yum remove jenkins -y
sudo yum install jenkins -y
</code></pre>
<p>âš ï¸ <strong>ä¸ä¼šä¸¢å¤±æ•°æ®</strong>ï¼Œå› ä¸º Jenkins é…ç½®ã€ä»»åŠ¡ã€æ’ä»¶éƒ½åœ¨ <code>/var/lib/jenkins</code> ä¸­ï¼Œä½ å·²ç»å¤‡ä»½è¿‡ã€‚</p>
<hr>
<h3 id="ğŸ”§-4-å¯åŠ¨-Jenkins-å¹¶æŸ¥çœ‹çŠ¶æ€"><a href="#ğŸ”§-4-å¯åŠ¨-Jenkins-å¹¶æŸ¥çœ‹çŠ¶æ€" class="headerlink" title="ğŸ”§ 4. å¯åŠ¨ Jenkins å¹¶æŸ¥çœ‹çŠ¶æ€"></a>ğŸ”§ 4. å¯åŠ¨ Jenkins å¹¶æŸ¥çœ‹çŠ¶æ€</h3><pre><code class="js">sudo systemctl daemon-reexec
sudo systemctl start jenkins
sudo systemctl status jenkins
</code></pre>
<hr>
<h3 id="ğŸ”§-5-è®¿é—®-Jenkins-é¡µé¢"><a href="#ğŸ”§-5-è®¿é—®-Jenkins-é¡µé¢" class="headerlink" title="ğŸ”§ 5. è®¿é—® Jenkins é¡µé¢"></a>ğŸ”§ 5. è®¿é—® Jenkins é¡µé¢</h3><p>è®¿é—®åœ°å€ï¼š</p>
<pre><code class="js">http://&lt;ä½ çš„æœåŠ¡å™¨IP&gt;:8888
</code></pre>
<hr>
<h3 id="ğŸ”§-6-æŸ¥çœ‹-Jenkins-æ–°ç‰ˆæœ¬å·"><a href="#ğŸ”§-6-æŸ¥çœ‹-Jenkins-æ–°ç‰ˆæœ¬å·" class="headerlink" title="ğŸ”§ 6. æŸ¥çœ‹ Jenkins æ–°ç‰ˆæœ¬å·"></a>ğŸ”§ 6. æŸ¥çœ‹ Jenkins æ–°ç‰ˆæœ¬å·</h3><pre><code class="js">jenkins --version
</code></pre>
<p>æˆ–è€…ç™»å½•ç½‘é¡µå³ä¸‹è§’æŸ¥çœ‹ï¼Œåº”è¯¥æ˜¯ç±»ä¼¼ï¼š</p>
<pre><code class="js">Jenkins ver. 2.440.1
</code></pre>
</blockquote>
<blockquote>
<h2 id="æŸ¥çœ‹-Jenkins-æœåŠ¡çŠ¶æ€"><a href="#æŸ¥çœ‹-Jenkins-æœåŠ¡çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹ Jenkins æœåŠ¡çŠ¶æ€"></a>æŸ¥çœ‹ Jenkins æœåŠ¡çŠ¶æ€</h2><p>è¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤è·å–å…·ä½“é”™è¯¯ï¼š</p>
<pre><code class="js">sudo systemctl status jenkins -l
</code></pre>
</blockquote>
<blockquote>
<h3 id="æ­¥éª¤-3ï¼šé‡å¯-Jenkins-æœåŠ¡"><a href="#æ­¥éª¤-3ï¼šé‡å¯-Jenkins-æœåŠ¡" class="headerlink" title="æ­¥éª¤ 3ï¼šé‡å¯ Jenkins æœåŠ¡"></a>æ­¥éª¤ 3ï¼šé‡å¯ Jenkins æœåŠ¡</h3><pre><code class="js">sudo systemctl daemon-reexec
sudo systemctl restart jenkins
sudo systemctl status jenkins -l
</code></pre>
</blockquote>
<blockquote>
<h3 id="ğŸ”—-æ’ä»¶ä¸‹è½½åœ°å€ä¸å‘½ä»¤"><a href="#ğŸ”—-æ’ä»¶ä¸‹è½½åœ°å€ä¸å‘½ä»¤" class="headerlink" title="ğŸ”— æ’ä»¶ä¸‹è½½åœ°å€ä¸å‘½ä»¤"></a>ğŸ”— æ’ä»¶ä¸‹è½½åœ°å€ä¸å‘½ä»¤</h3><p>ä»¥ä¸‹å‘½ä»¤ä¼šä¸‹è½½æ‰€æœ‰ç¼ºå¤±ä¾èµ–ï¼š</p>
<pre><code>bashå¤åˆ¶ç¼–è¾‘# è¿›å…¥ Jenkins æ’ä»¶ç›®å½•
cd /var/lib/jenkins/plugins

# ä¸‹è½½ç¼ºå¤±çš„ä¾èµ–æ’ä»¶
wget https://updates.jenkins.io/download/plugins/commons-lang3-api/3.13.0-62.v7d18e55f51e2/commons-lang3-api.hpi
wget https://updates.jenkins.io/download/plugins/ionicons-api/56.v1b_1c8c49374e/ionicons-api.hpi
wget https://updates.jenkins.io/download/plugins/caffeine-api/3.1.8-133.v17b_1ff2e0599/caffeine-api.hpi
</code></pre>
</blockquote>
<h4 id="æŒç»­é›†æˆç¯å¢ƒâ€”Jenkinsæ’ä»¶ç®¡ç†ã€Manage-Jenkinsã€‘"><a href="#æŒç»­é›†æˆç¯å¢ƒâ€”Jenkinsæ’ä»¶ç®¡ç†ã€Manage-Jenkinsã€‘" class="headerlink" title="æŒç»­é›†æˆç¯å¢ƒâ€”Jenkinsæ’ä»¶ç®¡ç†ã€Manage Jenkinsã€‘"></a>æŒç»­é›†æˆç¯å¢ƒâ€”Jenkinsæ’ä»¶ç®¡ç†ã€Manage Jenkinsã€‘</h4><p>Jenkinsæœ¬èº«ä¸æä¾›å¾ˆå¤šåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨æ’ä»¶æ¥æ»¡è¶³æˆ‘ä»¬çš„ä½¿ç”¨ã€‚ä¾‹å¦‚ä»Gitlabæ‹‰å–ä»£ç ï¼Œä½¿ç”¨ Mavenæ„å»ºé¡¹ç›®ç­‰åŠŸèƒ½éœ€è¦ä¾é æ’ä»¶å®Œæˆã€‚æ¥ä¸‹æ¥æ¼”ç¤ºå¦‚ä½•ä¸‹è½½æ’ä»¶ã€‚ </p>
<h5 id="ä¿®æ”¹Jenkinsæ’ä»¶ä¸‹è½½åœ°å€"><a href="#ä¿®æ”¹Jenkinsæ’ä»¶ä¸‹è½½åœ°å€" class="headerlink" title="ä¿®æ”¹Jenkinsæ’ä»¶ä¸‹è½½åœ°å€"></a>ä¿®æ”¹Jenkinsæ’ä»¶ä¸‹è½½åœ°å€</h5><p>Jenkinså›½å¤–å®˜æ–¹æ’ä»¶åœ°å€ä¸‹è½½é€Ÿåº¦éå¸¸æ…¢ï¼Œæ‰€ä»¥å¯ä»¥ä¿®æ”¹ä¸ºå›½å†…æ’ä»¶åœ°å€ï¼š<br>Jenkins-&gt;Manage Jenkins-&gt;Manage Pluginsï¼Œç‚¹å‡»Available<br>æ–°ç‰ˆæœ¬ï¼š<u>Jenkins â†’ Manage Jenkins â†’ Plugins â†’ Avaliable plugins</u></p>
<h5 id="å»Jenkinsé»˜è®¤çš„å¼€å‘ç›®å½•"><a href="#å»Jenkinsé»˜è®¤çš„å¼€å‘ç›®å½•" class="headerlink" title="å»Jenkinsé»˜è®¤çš„å¼€å‘ç›®å½•"></a>å»Jenkinsé»˜è®¤çš„å¼€å‘ç›®å½•</h5><p>è¿™æ ·åšæ˜¯ä¸ºäº†æŠŠ Jenkinså®˜æ–¹çš„æ’ä»¶åˆ—è¡¨ä¸‹è½½åˆ°æœ¬åœ°ï¼Œæ¥ç€ä¿®æ”¹åœ°å€æ–‡ä»¶ï¼Œæ›¿æ¢ä¸ºå›½å†…æ’ä»¶åœ°å€</p>
<blockquote>
<p>[root@localhost sysconfig]# cd &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;<br>[root@localhost jenkins]# cd updates&#x2F;<br>[root@localhost updates]# ll<br>æ€»ç”¨é‡ 3064<br>-rw-râ€“râ€“. 1 root root 3125621 6æœˆ  15 16:38 default.json<br>-rw-râ€“râ€“. 1 root root    7976 6æœˆ  15 16:38 hudson.tasks.Maven.MavenInstaller</p>
</blockquote>
<blockquote>
<p>sed -i â€˜s&#x2F;http://updates.jenkins ci.org/download&#x2F;https://mirrors.tuna.tsinghua.edu.cn/jenkins&#x2F;gâ€™ default.json &amp;&amp; sed -i â€˜s&#x2F;http:// <a target="_blank" rel="noopener" href="http://www.google.com/https:////">www.google.com/https:\/\/</a> <a target="_blank" rel="noopener" href="http://www.baidu.com/g&#39;">www.baidu.com/g&#39;</a> default.json</p>
</blockquote>
<p>æœ€åï¼ŒManage Pluginsç‚¹å‡»Advancedï¼ŒæŠŠUpdate Siteæ”¹ä¸ºå›½å†…æ’ä»¶ä¸‹è½½åœ°å€ </p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json">https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</a></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://192.168.200.129:8888/restart">http://192.168.200.129:8888/restart</a> é‡å¯Jenkins</p>
<h4 id="ä¸‹è½½ä¸­æ–‡æ±‰åŒ–æ’ä»¶"><a href="#ä¸‹è½½ä¸­æ–‡æ±‰åŒ–æ’ä»¶" class="headerlink" title="ä¸‹è½½ä¸­æ–‡æ±‰åŒ–æ’ä»¶"></a>ä¸‹è½½ä¸­æ–‡æ±‰åŒ–æ’ä»¶</h4><p><a target="_blank" rel="noopener" href="http://192.168.66.101:8888/restart">http://192.168.66.101:8888/restart</a> ï¼Œé‡å¯Jenkinsã€‚ Jenkins-&gt;Manage Jenkins-&gt;Manage Pluginsï¼Œç‚¹å‡»Availableï¼Œæœç´¢â€Chineseâ€</p>
<h4 id="å¼€å¯æƒé™å…¨å±€å®‰å…¨é…ç½®"><a href="#å¼€å¯æƒé™å…¨å±€å®‰å…¨é…ç½®" class="headerlink" title="å¼€å¯æƒé™å…¨å±€å®‰å…¨é…ç½®"></a>å¼€å¯æƒé™å…¨å±€å®‰å…¨é…ç½®</h4><p>åœ¨Securityä¸­çš„æˆæƒç­–ç•¥åˆ‡æ¢ä¸º â€œRole-Based Strategyâ€ï¼Œä¿å­˜</p>
<p>ã€ä»æ’ä»¶å¸‚åœºä¸Šä¸‹è½½ä¸‹æ¥çš„ å¯ä»¥ç›´æ¥é€šè¿‡MobaXterm æ”¾åœ¨&#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;plugins&#x2F; ç„¶åé‡å¯Jenkinsã€‘</p>
<h4 id="åˆ›å»ºè§’è‰²"><a href="#åˆ›å»ºè§’è‰²" class="headerlink" title="åˆ›å»ºè§’è‰²"></a>åˆ›å»ºè§’è‰²</h4><p>åœ¨ç³»ç»Ÿç®¡ç†é¡µé¢è¿›å…¥ Manage and Assign Rolesï¼›ç‚¹å‡»â€Manage Rolesâ€</p>
<p>é‡Œé¢çš„<strong>Global roles</strong>ï¼ˆå…¨å±€è§’è‰²ï¼‰ï¼šç®¡ç†å‘˜ç­‰é«˜çº§ç”¨æˆ·å¯ä»¥åˆ›å»ºåŸºäºå…¨å±€çš„è§’è‰² Project rolesï¼ˆé¡¹ç›®è§’è‰²ï¼‰ï¼š é’ˆå¯¹æŸä¸ªæˆ–è€…æŸäº›é¡¹ç›®çš„è§’è‰² Slave rolesï¼ˆå¥´éš¶è§’è‰²ï¼‰ï¼šèŠ‚ç‚¹ç›¸å…³çš„æƒé™</p>
<p>æˆ‘ä»¬æ·»åŠ ä»¥ä¸‹ä¸‰ä¸ªè§’è‰²ï¼šã€<u>ä¸€ä¸ªåŸºç¡€è§’è‰² ä¸¤ä¸ªé¡¹ç›®è§’è‰²</u>ã€‘</p>
<ul>
<li><strong>baseRole</strong> ï¼šè¯¥è§’è‰²ä¸ºå…¨å±€è§’è‰²ã€‚è¿™ä¸ªè§’è‰²éœ€è¦ç»‘å®šOverallä¸‹é¢çš„Readæƒé™ï¼Œæ˜¯ä¸ºäº†ç»™æ‰€æœ‰ç”¨æˆ·ç»‘ å®šæœ€åŸºæœ¬çš„Jenkinsè®¿é—®æƒé™ã€‚æ³¨æ„ï¼šå¦‚æœä¸ç»™åç»­ç”¨æˆ·ç»‘å®šè¿™ä¸ªè§’è‰²ï¼Œä¼šæŠ¥é”™è¯¯ï¼šç”¨æˆ·å is missing the Overall&#x2F;Read permission </li>
<li><strong>role1</strong> ï¼šè¯¥è§’è‰²ä¸º<strong>é¡¹ç›®è§’è‰²</strong>(ä¸‹é¢çš„Item roles)ã€‚ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ç»‘å®šâ€ <strong>itcast.</strong>* â€œï¼Œæ„æ€æ˜¯åªèƒ½æ“ä½œitcastå¼€å¤´çš„é¡¹ç›®ã€‚</li>
<li><strong>role2</strong> ï¼šè¯¥è§’è‰²ä¹Ÿä¸º<strong>é¡¹ç›®è§’è‰²</strong>ã€‚ç»‘å®šâ€itheima.*â€ï¼Œæ„æ€æ˜¯åªèƒ½æ“ä½œitheimaå¼€å¤´çš„é¡¹ç›®ã€‚</li>
</ul>
<h4 id="åˆ›å»ºç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·</h4><p>åœ¨ç³»ç»Ÿç®¡ç†é¡µé¢è¿›å…¥ <strong>Manage Users</strong><br><strong>ç”¨æˆ·ä¸€</strong>ï¼šç”¨æˆ·åï¼šeric     å¯†ç ï¼š123456<br><strong>ç”¨æˆ·äºŒ</strong>ï¼šç”¨æˆ·åï¼šJacK    å¯†ç ï¼š123456</p>
<h4 id="ç»™ç”¨æˆ·åˆ†é…è§’è‰²"><a href="#ç»™ç”¨æˆ·åˆ†é…è§’è‰²" class="headerlink" title="ç»™ç”¨æˆ·åˆ†é…è§’è‰²"></a>ç»™ç”¨æˆ·åˆ†é…è§’è‰²</h4><p>ç³»ç»Ÿç®¡ç†é¡µé¢è¿›å…¥Manage and Assign Rolesï¼Œç‚¹å‡»Assign Roles<br>ç»‘å®šè§„åˆ™å¦‚ä¸‹ï¼š </p>
<ul>
<li>eric ç”¨æˆ·åˆ†åˆ«ç»‘å®šbaseRoleå’Œrole1è§’è‰² </li>
<li>jack ç”¨æˆ·åˆ†åˆ«ç»‘å®šbaseRoleå’Œrole2è§’è‰²</li>
</ul>
<h4 id="åˆ›å»ºé¡¹ç›®æµ‹è¯•æƒé™"><a href="#åˆ›å»ºé¡¹ç›®æµ‹è¯•æƒé™" class="headerlink" title="åˆ›å»ºé¡¹ç›®æµ‹è¯•æƒé™"></a>åˆ›å»ºé¡¹ç›®æµ‹è¯•æƒé™</h4><p>ä»¥itcastç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºä¸¤ä¸ªé¡¹ç›®ï¼Œåˆ†åˆ«ä¸ºitcast01å’Œitheima01</p>
<p>ç»“æœä¸ºï¼š </p>
<ul>
<li>eric ç”¨æˆ·ç™»å½•ï¼Œåªèƒ½çœ‹åˆ°itcast01é¡¹ç›® </li>
<li>jack ç”¨æˆ·ç™»å½•ï¼Œåªèƒ½çœ‹åˆ°itheima01é¡¹ç›®</li>
</ul>
<h2 id="æŒç»­é›†æˆç¯å¢ƒâ€”Jenkinså‡­è¯ç®¡ç†"><a href="#æŒç»­é›†æˆç¯å¢ƒâ€”Jenkinså‡­è¯ç®¡ç†" class="headerlink" title="æŒç»­é›†æˆç¯å¢ƒâ€”Jenkinså‡­è¯ç®¡ç†"></a>æŒç»­é›†æˆç¯å¢ƒâ€”Jenkinså‡­è¯ç®¡ç†</h2><p>å‡­æ®å¯ä»¥ç”¨æ¥å­˜å‚¨éœ€è¦å¯†æ–‡ä¿æŠ¤çš„æ•°æ®åº“å¯†ç ã€Gitlabå¯†ç ä¿¡æ¯ã€Dockerç§æœ‰ä»“åº“å¯†ç ç­‰ï¼Œ<u><strong>ä»¥ä¾¿ Jenkinså¯ä»¥å’Œè¿™äº›ç¬¬ä¸‰æ–¹çš„åº”ç”¨è¿›è¡Œäº¤äº’</strong></u>ã€‚ </p>
<h5 id="å®‰è£…Credentials-Bindingæ’ä»¶"><a href="#å®‰è£…Credentials-Bindingæ’ä»¶" class="headerlink" title="å®‰è£…Credentials Bindingæ’ä»¶"></a>å®‰è£…Credentials Bindingæ’ä»¶</h5><p>è¦åœ¨Jenkinsä½¿ç”¨å‡­è¯ç®¡ç†åŠŸèƒ½ï¼Œéœ€è¦å®‰è£…<strong>Credentials Binding</strong>æ’ä»¶<br>å®‰è£…æ’ä»¶åï¼Œå·¦è¾¹å¤šäº†â€<strong>å‡­è¯</strong>â€œèœå•ï¼Œåœ¨è¿™é‡Œç®¡ç†æ‰€æœ‰å‡­è¯ [æ–°ç‰ˆæ˜¯åœ¨<strong>Security</strong>æ æœ‰<strong>å‡­è¯ç®¡ç†</strong>]<br>è¿›å…¥å‡­æ®åç‚¹å‡»<strong>Stores scoped to Jenkins</strong>ä¸‹     <strong>åŸŸ</strong>çš„**<u>å…¨å±€</u>**</p>
<h6 id="å¯ä»¥æ·»åŠ çš„å‡­è¯æœ‰-5ç§ï¼š"><a href="#å¯ä»¥æ·»åŠ çš„å‡­è¯æœ‰-5ç§ï¼š" class="headerlink" title="å¯ä»¥æ·»åŠ çš„å‡­è¯æœ‰ 5ç§ï¼š"></a>å¯ä»¥æ·»åŠ çš„å‡­è¯æœ‰ 5ç§ï¼š</h6><ul>
<li>Username with password ï¼šç”¨æˆ·åå’Œå¯†ç  </li>
<li>SSH Username with private keyï¼š ä½¿ç”¨SSHç”¨æˆ·å’Œå¯†é’¥ </li>
<li>Secret fileï¼šéœ€è¦ä¿å¯†çš„æ–‡æœ¬æ–‡ä»¶ï¼Œä½¿ç”¨æ—¶Jenkinsä¼šå°†æ–‡ä»¶å¤åˆ¶åˆ°ä¸€ä¸ªä¸´æ—¶ç›®å½•ä¸­ï¼Œå†å°†æ–‡ä»¶è·¯å¾„ è®¾ç½®åˆ°ä¸€ä¸ªå˜é‡ä¸­ï¼Œç­‰æ„å»ºç»“æŸåï¼Œæ‰€å¤åˆ¶çš„Secret fileå°±ä¼šè¢«åˆ é™¤ã€‚ </li>
<li>Secret text ï¼šéœ€è¦ä¿å­˜çš„ä¸€ä¸ªåŠ å¯†çš„æ–‡æœ¬ä¸²ï¼Œå¦‚é’‰é’‰æœºå™¨äººæˆ–Githubçš„api tokenã€k8sä¹Ÿä¼šç”¨ã€‘</li>
<li>Certificate ï¼šé€šè¿‡ä¸Šä¼ è¯ä¹¦æ–‡ä»¶çš„æ–¹å¼</li>
</ul>
<p>å¸¸ç”¨çš„å‡­è¯ç±»å‹æœ‰ï¼š<strong>Username with passwordï¼ˆç”¨æˆ·å¯†ç ï¼‰</strong>å’Œ<strong>SSH Username with private keyï¼ˆSSH å¯†é’¥ï¼‰</strong><br>æ¥ä¸‹æ¥ä»¥ä½¿ç”¨Gitå·¥å…·åˆ°Gitlabæ‹‰å–é¡¹ç›®æºç ä¸ºä¾‹ï¼Œæ¼”ç¤ºJenkinsçš„å¦‚ä½•ç®¡ç†Gitlabçš„å‡­è¯<br>â˜… <u><strong>åœ¨Jenkinsé‡Œé¢å®‰è£…gitæ’ä»¶</strong></u><br>â˜… <u>è¦å…ˆåœ¨<strong>Jenkinsçš„æœåŠ¡</strong>é‡Œé¢å®‰è£…gitæ’ä»¶</u></p>
<p><strong>CentOS7ä¸Šå®‰è£…Gitå·¥å…·</strong>ï¼š</p>
<pre><code class="js">yum install git -y            å®‰è£…
git --version                 å®‰è£…åæŸ¥çœ‹ç‰ˆæœ¬
</code></pre>
<h4 id="ç”¨æˆ·å¯†ç ç±»å‹"><a href="#ç”¨æˆ·å¯†ç ç±»å‹" class="headerlink" title="ç”¨æˆ·å¯†ç ç±»å‹"></a>ç”¨æˆ·å¯†ç ç±»å‹</h4><p>**<u>å…¨å±€æ·»åŠ å‡­è¯</u>**ï¼šDashboard â†’ Manage Jenkins â†’ Credentials â†’ System â†’ Global credentials (unrestricted) â†’ New credentials</p>
<p>-<br>  Jenkins-&gt;å‡­è¯-&gt;ç³»ç»Ÿ-&gt;å…¨å±€å‡­è¯-&gt;æ·»åŠ å‡­è¯</p>
<h5 id="æµ‹è¯•å‡­è¯æ˜¯å¦å¯ç”¨"><a href="#æµ‹è¯•å‡­è¯æ˜¯å¦å¯ç”¨" class="headerlink" title="æµ‹è¯•å‡­è¯æ˜¯å¦å¯ç”¨"></a>æµ‹è¯•å‡­è¯æ˜¯å¦å¯ç”¨</h5><p>åˆ›å»ºä¸€ä¸ªFreeStyleé¡¹ç›®ï¼šæ–°å»ºItem-&gt;FreeStyle Project-&gt;ç¡®å®š<br>æ‰¾åˆ° â€œæºç ç®¡ç†â€-&gt;â€Gitâ€ï¼Œåœ¨Repository URLå¤åˆ¶Gitlabä¸­çš„é¡¹ç›®URL</p>
<p><strong>æ–°æä¸ªitemç„¶åç‚¹å‡»è¿›å» å·¦ä¾§çš„é…ç½®â†’Generalâ†’æºç ç®¡ç†â†’é€‰æ‹©Git â†’â†“</strong> </p>
<pre><code class="java">Repository URLï¼šhttp://192.168.200.128:82/lanyun_group/web_demo.git
Credentialsï¼šã€é€‰æ‹©åˆšåˆšç»™å¼ ä¸‰åˆ›å»ºçš„å‡­è¯ã€‘
</code></pre>
<p>ä¿å­˜é…ç½®åï¼Œç‚¹å‡»æ„å»º â€Build Nowâ€œ å¼€å§‹æ„å»ºé¡¹ç›®<br>å¯ä»¥åœ¨å·¦ä¸‹æ–¹çš„Buildsé‡Œæ‰¾åˆ°åˆšåˆšæ„å»ºçš„é¡¹ç›® å¯ä»¥æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º</p>
<pre><code class="java">Started by user root
Running as SYSTEM
Building in workspace /var/lib/jenkins/workspace/test02
The recommended git tool is: NONE
using credential ca22e56f-0ecc-4fdc-965d-01e329a0b68a
Cloning the remote Git repository
Cloning repository http://192.168.200.128:82/lanyun_group/web_demo.git
 &gt; git init /var/lib/jenkins/workspace/test02 # timeout=10
Fetching upstream changes from http://192.168.200.128:82/lanyun_group/web_demo.git
 &gt; git --version # timeout=10
 &gt; git --version # &#39;git version 1.8.3.1&#39;
using GIT_ASKPASS to set credentials gitlab-auth-password
 &gt; git fetch --tags --progress http://192.168.200.128:82/lanyun_group/web_demo.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 &gt; git config remote.origin.url http://192.168.200.128:82/lanyun_group/web_demo.git # timeout=10
 &gt; git config --add remote.origin.fetch +refs/heads/*:refs/remotes/origin/* # timeout=10
Avoid second fetch
 &gt; git rev-parse refs/remotes/origin/master^&#123;commit&#125; # timeout=10
Checking out Revision 2f41cd33af519a5c55df8d78ba59032d9069f0b8 (refs/remotes/origin/master)
 &gt; git config core.sparsecheckout # timeout=10
 &gt; git checkout -f 2f41cd33af519a5c55df8d78ba59032d9069f0b8 # timeout=10
Commit message: &quot;åˆå§‹åŒ–é¡¹ç›®æäº¤&quot;
First time build. Skipping changelog.
Finished: SUCCESS
</code></pre>
<p>æŸ¥çœ‹**&#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;workspace&#x2F;**ç›®å½•ï¼Œå‘ç°å·²ç»ä»GitlabæˆåŠŸæ‹‰å–äº†ä»£ç åˆ°Jenkinsä¸­</p>
<h4 id="SSHå¯†é’¥ç±»å‹"><a href="#SSHå¯†é’¥ç±»å‹" class="headerlink" title="SSHå¯†é’¥ç±»å‹"></a>SSHå¯†é’¥ç±»å‹</h4><h6 id="SSHå…å¯†ç™»å½•ç¤ºæ„å›¾ï¼š"><a href="#SSHå…å¯†ç™»å½•ç¤ºæ„å›¾ï¼š" class="headerlink" title="SSHå…å¯†ç™»å½•ç¤ºæ„å›¾ï¼š"></a>SSHå…å¯†ç™»å½•ç¤ºæ„å›¾ï¼š</h6><p>[<u>GitLabæœåŠ¡å™¨(å­˜æ”¾å…¬é’¥ï¼šid_rsa.pub)</u>] â†â†â†<strong>sshå…å¯†ç™»å½•</strong>â†â†â† [<u>JenkinsæœåŠ¡å™¨(å­˜æ”¾ç§é’¥ï¼šid_rsa)</u>]</p>
<ul>
<li><h5 id="ä½¿ç”¨rootç”¨æˆ·ç”Ÿæˆå…¬é’¥å’Œç§é’¥"><a href="#ä½¿ç”¨rootç”¨æˆ·ç”Ÿæˆå…¬é’¥å’Œç§é’¥" class="headerlink" title="ä½¿ç”¨rootç”¨æˆ·ç”Ÿæˆå…¬é’¥å’Œç§é’¥"></a>ä½¿ç”¨rootç”¨æˆ·ç”Ÿæˆå…¬é’¥å’Œç§é’¥</h5></li>
</ul>
<blockquote>
<p>ssh-keygen -t rsa</p>
</blockquote>
<pre><code class="java">åœ¨ 192.168.200.129_Jenkins æœåŠ¡å™¨é‡Œ

[root@localhost ~]# ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):
Created directory &#39;/root/.ssh&#39;.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:88fFvAS2e6i9c4+KXfmENWeu6NJNmOb1+CCsYLarYLc root@localhost.localdomain
The key&#39;s randomart image is:
+---[RSA 2048]----+
|                 |
|                 |
|            o    |
|           . =   |
|        S   .o=.+|
|         o o+=oBo|
|    o . + .+B+Boo|
|   . o + o.B+=+*.|
|      E.o.+oB=oo+|
+----[SHA256]-----+

[root@localhost ~]# cd /root/.ssh
[root@localhost .ssh]# ll
æ€»ç”¨é‡ 8
-rw-------. 1 root root 1679 6æœˆ  18 20:05 id_rsa       ã€ç§é’¥ã€‘
-rw-r--r--. 1 root root  408 6æœˆ  18 20:05 id_rsa.pub   ã€å…¬é’¥ã€‘
</code></pre>
<ul>
<li><h5 id="è¦åœ¨gitlabæœåŠ¡é‡Œå­˜æ”¾ä¸€ä¸ªå…¬é’¥"><a href="#è¦åœ¨gitlabæœåŠ¡é‡Œå­˜æ”¾ä¸€ä¸ªå…¬é’¥" class="headerlink" title="è¦åœ¨gitlabæœåŠ¡é‡Œå­˜æ”¾ä¸€ä¸ªå…¬é’¥"></a>è¦åœ¨gitlabæœåŠ¡é‡Œå­˜æ”¾ä¸€ä¸ªå…¬é’¥</h5></li>
</ul>
<p>ä»¥rootè´¦æˆ·ç™»å½•-&gt;ç‚¹å‡»å¤´åƒ-&gt;Settings-&gt;SSH Keysâ†’åœ¨JenkinsæœåŠ¡é‡Œé¢ç”¨<br> <code>[root@localhost .ssh]# cat id_rsa.pub</code><br>æ‰“å¼€å…¬é’¥çš„æ–‡ä»¶å¾—åˆ°ä¿¡æ¯ã€‚å¤åˆ¶åˆšæ‰id_rsa.pubæ–‡ä»¶çš„å†…å®¹åˆ°è¿™é‡Œï¼Œç‚¹å‡»â€Add Keyâ€</p>
<ul>
<li><h5 id="åœ¨Jenkinsä¸­æ·»åŠ å‡­è¯ï¼Œé…ç½®ç§é’¥"><a href="#åœ¨Jenkinsä¸­æ·»åŠ å‡­è¯ï¼Œé…ç½®ç§é’¥" class="headerlink" title="åœ¨Jenkinsä¸­æ·»åŠ å‡­è¯ï¼Œé…ç½®ç§é’¥"></a>åœ¨Jenkinsä¸­æ·»åŠ å‡­è¯ï¼Œé…ç½®ç§é’¥</h5></li>
</ul>
<p>åœ¨Jenkinsæ·»åŠ ä¸€ä¸ªå…¨å±€æ–°çš„å‡­è¯ï¼Œç±»å‹ä¸ºâ€<strong>SSH Username with private key</strong>â€œï¼Œåœ¨jenkinsæœåŠ¡å™¨é‡Œè¾“å…¥æŒ‡ä»¤æŸ¥çœ‹<strong>ç§é’¥</strong><br><code>[root@localhost .ssh]# cat id_rsa</code><br>æŠŠåˆšæ‰ç”Ÿæˆ<strong>ç§é’¥</strong>æ–‡ä»¶å†…å®¹å¤åˆ¶è¿‡æ¥å¡è¿›å»<br>æ­¤æ—¶å»gitlabé¡¹ç›®ä¸­æŠŠsshçš„å¤åˆ¶è¿‡æ¥<code>git@192.168.200.128:lanyun_group/web_demo.git</code><br>åŒæ ·å°è¯•æ„å»ºé¡¹ç›®ï¼Œå¦‚æœä»£ç å¯ä»¥æ­£å¸¸æ‹‰å–ï¼Œä»£è¡¨å‡­è¯é…ç½®æˆåŠŸï¼</p>
<p><span style = "color:red"><strong>å¦‚æœæŠ¥é”™</strong></span>ï¼š</p>
<pre><code class="java">Command &quot;git ls-remote -h git@192.168.200.128:lanyun_group/web_demo.git HEAD&quot; returned status code 128
stderr: No ECDSA host key is known for 192.168.200.128 and you have requested strict checking.
Host key verification failed.
fatal: Could not read from remote repository.
</code></pre>
<p><span style = "color:red"><strong>æŠ¥é”™åŸå› </strong></span>ï¼š</p>
<pre><code class="java">SSH ä¸»æœºæŒ‡çº¹æœªéªŒè¯ï¼ˆHost key verification failedï¼‰

Git ä½¿ç”¨çš„æ˜¯ SSH åè®®è®¿é—®è¿œç¨‹ä»“åº“ï¼ˆgit@192.168.200.128ï¼‰ï¼Œä½†æœ¬åœ°æœºå™¨ä¹‹å‰æ²¡æœ‰è¿æ¥è¿‡è¯¥ä¸»æœºï¼Œæˆ–è€… .ssh/known_hosts æ–‡ä»¶ä¸­æ²¡æœ‰è¯¥ IP çš„å…¬é’¥ä¿¡æ¯ã€‚

è€Œä¸”å¯ç”¨äº†â€œä¸¥æ ¼æ£€æŸ¥â€ï¼ˆStrict Host Key Checkingï¼‰ï¼Œæ‰€ä»¥ Git æ‹’ç»è¿æ¥è¯¥æœåŠ¡å™¨ã€‚



â˜…â˜… æ–¹æ³•ï¼šæ‰‹åŠ¨ä¿¡ä»»ä¸»æœºï¼ˆæ¨èï¼‰â˜…â˜…
ssh git@192.168.200.128
ç³»ç»Ÿä¼šæç¤ºä½ æ˜¯å¦ä¿¡ä»»è¯¥ä¸»æœºï¼Œæ¯”å¦‚ï¼š

The authenticity of host &#39;192.168.200.128 (192.168.200.128)&#39; can&#39;t be established.
ECDSA key fingerprint is SHA256:xxx...
Are you sure you want to continue connecting (yes/no/[fingerprint])?
âœ… è¾“å…¥ yes ä¹‹åï¼Œä¸»æœºå…¬é’¥ä¼šåŠ å…¥ ~/.ssh/known_hosts æ–‡ä»¶ï¼Œåç»­è¿æ¥å°†ä¸å†å¤±è´¥ã€‚
</code></pre>
<h6 id="åˆ°è¿™é‡Œå·²ç»å®Œæˆäº†è¿™ä»½å›¾çš„éƒ¨åˆ†å†…å®¹ï¼Œè¦å¼€å§‹èå…¥Maven"><a href="#åˆ°è¿™é‡Œå·²ç»å®Œæˆäº†è¿™ä»½å›¾çš„éƒ¨åˆ†å†…å®¹ï¼Œè¦å¼€å§‹èå…¥Maven" class="headerlink" title="åˆ°è¿™é‡Œå·²ç»å®Œæˆäº†è¿™ä»½å›¾çš„éƒ¨åˆ†å†…å®¹ï¼Œè¦å¼€å§‹èå…¥Maven"></a><strong><u>åˆ°è¿™é‡Œå·²ç»å®Œæˆäº†è¿™ä»½å›¾çš„éƒ¨åˆ†å†…å®¹ï¼Œè¦å¼€å§‹èå…¥Maven</u></strong></h6><p><img src="https://raw.githubusercontent.com/P-luminary/images/5a664e75de77e3633f64215df2e5990365c3606a/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E6%B5%81%E7%A8%8B%E8%AF%B4%E6%98%8E.png" alt="æŒç»­é›†æˆæµç¨‹è¯´æ˜"></p>
<h2 id="æŒç»­é›†æˆç¯å¢ƒâ€”Mavenå®‰è£…å’Œé…ç½®"><a href="#æŒç»­é›†æˆç¯å¢ƒâ€”Mavenå®‰è£…å’Œé…ç½®" class="headerlink" title="æŒç»­é›†æˆç¯å¢ƒâ€”Mavenå®‰è£…å’Œé…ç½®"></a>æŒç»­é›†æˆç¯å¢ƒâ€”Mavenå®‰è£…å’Œé…ç½®</h2><p>åœ¨Jenkinsé›†æˆæœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…Mavenæ¥ç¼–è¯‘å’Œæ‰“åŒ…é¡¹ç›®</p>
<p>æŠŠ<code>apache-maven-3.6.2-bin.tar.gz</code>ä¼ åˆ° &#x2F;root æ ¹ç›®å½•ä¸­ã€JenkinsæœåŠ¡å™¨ã€‘</p>
<pre><code class="java">tar -xzf apache-maven-3.6.2-bin.tar.gz       è§£å‹
mkdir -p /opt/maven                          åˆ›å»ºç›®å½•
mv apache-maven-3.6.2/* /opt/maven           ç§»åŠ¨æ–‡ä»¶
</code></pre>
<blockquote>
<p>[root@localhost ~]# mkdir -p &#x2F;opt&#x2F;maven<br>[root@localhost ~]# mv apache-maven-3.6.2&#x2F;* &#x2F;opt&#x2F;maven<br>[root@localhost ~]# cd &#x2F;opt&#x2F;maven&#x2F;<br>[root@localhost maven]# ll<br>æ€»ç”¨é‡ 28<br>drwxr-xr-x. 2 root root     97 6æœˆ  18 21:37 bin<br>drwxr-xr-x. 2 root root     42 6æœˆ  18 21:37 boot<br>drwxrwxr-x. 3 1000 mysql    63 8æœˆ  27 2019 conf<br>drwxrwxr-x. 4 1000 mysql  4096 6æœˆ  18 21:37 lib<br>-rw-rw-râ€“. 1 1000 mysql 12846 8æœˆ  27 2019 LICENSE<br>-rw-rw-râ€“. 1 1000 mysql   182 8æœˆ  27 2019 NOTICE<br>-rw-rw-râ€“. 1 1000 mysql  2533 8æœˆ  27 2019 README.txt<br>[root@localhost maven]#</p>
</blockquote>
<h4 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h4><blockquote>
<p>vi &#x2F;etc&#x2F;profile</p>
</blockquote>
<pre><code class="java">export JAVA_HOME=/usr/local/java/jdk-17.0.8+7
export MAVEN_HOME=/opt/maven
export PATH=$PATH:$JAVA_HOME/bin:$MAVEN_HOME/bin
</code></pre>
<blockquote>
<p>source &#x2F;etc&#x2F;profile                 é…ç½®ç”Ÿæ•ˆ<br>mvn -v                                      æŸ¥æ‰¾Mavenç‰ˆæœ¬</p>
</blockquote>
<h4 id="å…¨å±€å·¥å…·é…ç½®å…³è”JDKå’ŒMaven"><a href="#å…¨å±€å·¥å…·é…ç½®å…³è”JDKå’ŒMaven" class="headerlink" title="å…¨å±€å·¥å…·é…ç½®å…³è”JDKå’ŒMaven"></a>å…¨å±€å·¥å…·é…ç½®å…³è”JDKå’ŒMaven</h4><p>Jenkins-&gt;Manage Jenkins-&gt;Toolsâ†’ JDKå®‰è£… â†’ æ–°å¢JDK â†’ </p>
<blockquote>
<p>ã€JDKã€‘<br><strong>åˆ«å</strong>ï¼šjdk-17.0.8+7<br><strong>JAVA_HOME</strong>ï¼š&#x2F;usr&#x2F;local&#x2F;java&#x2F;jdk-17.0.8+7</p>
</blockquote>
<p>ä¸‹é¢çš„Mavenå®‰è£…â†’ æ–°å¢Maven â†’</p>
<blockquote>
<p>ã€Mavenã€‘<br><strong>Name</strong>ï¼šmaven3.6.2<br><strong>MAVEN_HOME</strong>ï¼š&#x2F;opt&#x2F;maven</p>
</blockquote>
<p>ç‚¹å‡»åº”ç”¨ â†’ ä¿å­˜</p>
<h4 id="æ·»åŠ Jenkinså…¨å±€å˜é‡"><a href="#æ·»åŠ Jenkinså…¨å±€å˜é‡" class="headerlink" title="æ·»åŠ Jenkinså…¨å±€å˜é‡"></a>æ·»åŠ Jenkinså…¨å±€å˜é‡</h4><p>Jenkins â†’ Manage Jenkins â†’ System â†’ ä¸‹é¢æ‰¾åˆ°<strong>å…¨å±€å±æ€§</strong> â†’ <strong>Environment variables</strong> </p>
<pre><code class="java">ä»¥ä¸‹æ˜¯ç”¨é”®å€¼å¯¹çš„å½¢å¼æ˜¾ç¤ºï¼š
JAVA_HOME   /usr/local/java/jdk-17.0.8+7
M2_HOME     /opt/maven
PATH+EXTRA  $M2_HOME/bin
</code></pre>
<h4 id="ä¿®æ”¹Mavençš„settings-xml"><a href="#ä¿®æ”¹Mavençš„settings-xml" class="headerlink" title="ä¿®æ”¹Mavençš„settings.xml"></a>ä¿®æ”¹Mavençš„settings.xml</h4><pre><code class="java">mkdir /root/repo                  åˆ›å»ºæœ¬åœ°ä»“åº“ç›®å½•
vi /opt/maven/conf/settings.xml
</code></pre>
<p>æœ¬åœ°ä»“åº“æ”¹ä¸ºï¼š&#x2F;root&#x2F;repo</p>
<pre><code class="java">  &lt;!-- localRepository
   | The path to the local repository maven will use to store artifacts.
   |
   | Default: $&#123;user.home&#125;/.m2/repository
  --&gt;
  &lt;localRepository&gt;/root/repo&lt;/localRepository&gt;
</code></pre>
<p>æ·»åŠ é˜¿é‡Œäº‘ç§æœåœ°å€ï¼š</p>
<pre><code class="java">    &lt;mirror&gt;
      &lt;id&gt;alimaven&lt;/id&gt;
      &lt;name&gt;aliyun maven&lt;/name&gt;
      &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;
      &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
    &lt;/mirror&gt;
</code></pre>
<h4 id="æµ‹è¯•Mavenæ˜¯å¦é…ç½®æˆåŠŸ"><a href="#æµ‹è¯•Mavenæ˜¯å¦é…ç½®æˆåŠŸ" class="headerlink" title="æµ‹è¯•Mavenæ˜¯å¦é…ç½®æˆåŠŸ"></a>æµ‹è¯•Mavenæ˜¯å¦é…ç½®æˆåŠŸ</h4><p>ä½¿ç”¨ä¹‹å‰çš„gitlabå¯†ç æµ‹è¯•é¡¹ç›®ï¼Œä¿®æ”¹é…ç½®;<br>åœ¨æŸä¸ªé¡¹ç›®ä¸­â†’Triggersä¸­â†’Build Stepsé€‰æ‹© <strong>Execute shell</strong>(æ‰§è¡Œshellè„šæœ¬å‘½ä»¤)<br>è¾“å…¥</p>
<blockquote>
<p>mvn clean package</p>
</blockquote>
<p>ç„¶åå†å»æ„å»ºï¼ï¼</p>
<blockquote>
<h3 id="ğŸ”§-æ­¥éª¤ä¸€ï¼šåˆ é™¤æŸåçš„æ’ä»¶æ–‡ä»¶"><a href="#ğŸ”§-æ­¥éª¤ä¸€ï¼šåˆ é™¤æŸåçš„æ’ä»¶æ–‡ä»¶" class="headerlink" title="ğŸ”§ æ­¥éª¤ä¸€ï¼šåˆ é™¤æŸåçš„æ’ä»¶æ–‡ä»¶"></a>ğŸ”§ æ­¥éª¤ä¸€ï¼šåˆ é™¤æŸåçš„æ’ä»¶æ–‡ä»¶</h3><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å½»åº•åˆ é™¤è¿™ä¸ªé”™è¯¯çš„æ’ä»¶ç¼“å­˜ï¼š</p>
<pre><code class="java">rm -rf /root/repo/org/apache/maven/plugins/maven-clean-plugin
</code></pre>
<hr>
<h3 id="ğŸ”§-æ­¥éª¤äºŒï¼šå°†-Maven-é•œåƒæºæ”¹ä¸ºç¨³å®šçš„ä¸­å¤®ä»“åº“"><a href="#ğŸ”§-æ­¥éª¤äºŒï¼šå°†-Maven-é•œåƒæºæ”¹ä¸ºç¨³å®šçš„ä¸­å¤®ä»“åº“" class="headerlink" title="ğŸ”§ æ­¥éª¤äºŒï¼šå°† Maven é•œåƒæºæ”¹ä¸ºç¨³å®šçš„ä¸­å¤®ä»“åº“"></a>ğŸ”§ æ­¥éª¤äºŒï¼šå°† Maven é•œåƒæºæ”¹ä¸ºç¨³å®šçš„ä¸­å¤®ä»“åº“</h3><p>ç¼–è¾‘ <code>/root/.m2/settings.xml</code> æˆ– <code>/etc/maven/settings.xml</code>ï¼ˆæŒ‰ä½ çš„ç³»ç»Ÿé…ç½®ï¼‰ä¸ºä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="xml">&lt;settings xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;
          xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
          xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0
                              http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;&gt;
  
  &lt;localRepository&gt;/root/repo&lt;/localRepository&gt;

  &lt;mirrors&gt;
    &lt;mirror&gt;
      &lt;id&gt;central&lt;/id&gt;
      &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
      &lt;name&gt;Maven Central&lt;/name&gt;
      &lt;url&gt;https://repo.maven.apache.org/maven2&lt;/url&gt;
    &lt;/mirror&gt;
  &lt;/mirrors&gt;

&lt;/settings&gt;
</code></pre>
</blockquote>
<h4 id="æŒç»­é›†æˆç¯å¢ƒâ€”Tomcatå®‰è£…å’Œé…ç½®"><a href="#æŒç»­é›†æˆç¯å¢ƒâ€”Tomcatå®‰è£…å’Œé…ç½®" class="headerlink" title="æŒç»­é›†æˆç¯å¢ƒâ€”Tomcatå®‰è£…å’Œé…ç½®"></a>æŒç»­é›†æˆç¯å¢ƒâ€”Tomcatå®‰è£…å’Œé…ç½®</h4><p>å®‰è£…Tomcat8.5  æŠŠTomcatå‹ç¼©åŒ…ä¸Šä¼ åˆ°192.168.200.131æœåŠ¡å™¨ </p>
<blockquote>
<p>yum install java-1.8.0-openjdk* -y                           å®‰è£…JDKï¼ˆå·²å®Œæˆï¼‰<br>tar -xzf apache-tomcat-8.5.47.tar.gz                       è§£å‹<br>mkdir -p &#x2F;opt&#x2F;tomcat                                                 åˆ›å»ºç›®å½•<br>mv &#x2F;root&#x2F;apache-tomcat-8.5.47&#x2F;* &#x2F;opt&#x2F;tomcat     ç§»åŠ¨æ–‡ä»¶<br><span style ="color:red"><strong>å¯åŠ¨tomcat</strong></span><br>&#x2F;opt&#x2F;tomcat&#x2F;bin&#x2F;startup.sh â˜…â˜…        </p>
<p><span style ="color:blue">[Apache Tomcat&#x2F;8.5.47]</span> (<a target="_blank" rel="noopener" href="http://192.168.200.131:8090/">http://192.168.200.131:8090/</a>) ã€å·²æ”¹ç«¯å£8090ã€‘</p>
<p><strong>å…³é—­å·²æœ‰ Tomcat</strong>ï¼ˆå»ºè®®å…ˆå…³é—­ï¼Œé¿å…å†²çªï¼‰ï¼š</p>
<pre><code>/opt/tomcat/bin/shutdown.sh
</code></pre>
<p><strong>å†å¯åŠ¨</strong>ï¼š</p>
<pre><code>/opt/tomcat/bin/startup.sh
</code></pre>
</blockquote>
<p>ä¸è¿‡ç°åœ¨è®¿é—®è¿™ä¸ªåœ°å€æ˜¯æ²¡æœ‰æƒé™çš„[403 Access Denied] (<a target="_blank" rel="noopener" href="http://192.168.200.131:8090/manager/">http://192.168.200.131:8090/manager/</a>) ç°åœ¨è¦å¢åŠ æƒé™</p>
<h4 id="é…ç½®-Tomcatç”¨æˆ·è§’è‰²æƒé™"><a href="#é…ç½®-Tomcatç”¨æˆ·è§’è‰²æƒé™" class="headerlink" title="é…ç½® Tomcatç”¨æˆ·è§’è‰²æƒé™"></a>é…ç½® Tomcatç”¨æˆ·è§’è‰²æƒé™</h4><p>é»˜è®¤æƒ…å†µä¸‹Tomcatæ˜¯æ²¡æœ‰é…ç½®ç”¨æˆ·è§’è‰²æƒé™çš„</p>
<blockquote>
<h1 id="403-Access-Denied"><a href="#403-Access-Denied" class="headerlink" title="403 Access Denied"></a>403 Access Denied</h1><p>You are not authorized to view this page.</p>
<p>By default the Manager is only accessible from a browser running on the same machine as Tomcat. If you wish to modify this restriction, youâ€™ll need to edit the Managerâ€™s <code>context.xml</code> file.</p>
<p>If you have already configured the Manager application to allow access and you have used your browsers back button, used a saved book-mark or similar then you may have triggered the cross-site request forgery (CSRF) protection that has been enabled for the HTML interface of the Manager application. You will need to reset this protection by returning to the <a target="_blank" rel="noopener" href="http://192.168.200.131:8090/manager/html">main Manager page</a>. Once you return to this page, you will be able to continue using the Manager applicationâ€™s HTML interface normally. If you continue to see this access denied message, check that you have the necessary permissions to access this application.</p>
<p>If you have not changed any configuration files, please examine the file <code>conf/tomcat-users.xml</code> in your installation. That file must contain the credentials to let you use this webapp.</p>
<p>For example, to add the <code>manager-gui</code> role to a user named <code>tomcat</code> with a password of <code>s3cret</code>, add the following to the config file listed above.</p>
<pre><code>&lt;role rolename=&quot;manager-gui&quot;/&gt;
&lt;user username=&quot;tomcat&quot; password=&quot;s3cret&quot; roles=&quot;manager-gui&quot;/&gt;
</code></pre>
<p>Note that for Tomcat 7 onwards, the roles required to use the manager application were changed from the single <code>manager</code> role to the following four roles. You will need to assign the role(s) required for the functionality you wish to access.</p>
<ul>
<li><code>manager-gui</code> - allows access to the HTML GUI and the status pages</li>
<li><code>manager-script</code> - allows access to the text interface and the status pages</li>
<li><code>manager-jmx</code> - allows access to the JMX proxy and the status pages</li>
<li><code>manager-status</code> - allows access to the status pages only</li>
</ul>
<p>The HTML interface is protected against CSRF but the text and JMX interfaces are not. To maintain the CSRF protection:</p>
<ul>
<li>Users with the <code>manager-gui</code> role should not be granted either the <code>manager-script</code> or <code>manager-jmx</code> roles.</li>
<li>If the text or jmx interfaces are accessed through a browser (e.g. for testing since these interfaces are intended for tools not humans) then the browser must be closed afterwards to terminate the session.</li>
</ul>
<p>For more information - please see the <a target="_blank" rel="noopener" href="http://192.168.200.131:8090/docs/manager-howto.html">Manager App How-To</a>.</p>
</blockquote>
<p>ä½†æ˜¯ï¼Œåç»­Jenkinséƒ¨ç½²é¡¹ç›®åˆ°TomcatæœåŠ¡å™¨ï¼Œéœ€è¦ç”¨åˆ°Tomcatçš„ç”¨æˆ·ï¼Œæ‰€ä»¥ä¿®æ”¹tomcatä»¥ä¸‹é…ç½®ï¼Œ æ·»åŠ ç”¨æˆ·åŠæƒé™</p>
<blockquote>
<p>vi &#x2F;opt&#x2F;tomcat&#x2F;conf&#x2F;tomcat-users.xml</p>
</blockquote>
<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="xml">&lt;tomcat-users&gt;
 &lt;role rolename=&quot;tomcat&quot;/&gt;
 &lt;role rolename=&quot;role1&quot;/&gt;
 &lt;role rolename=&quot;manager-script&quot;/&gt;
 &lt;role rolename=&quot;manager-gui&quot;/&gt;
 &lt;role rolename=&quot;manager-status&quot;/&gt; 
&lt;role rolename=&quot;admin-gui&quot;/&gt;
 &lt;role rolename=&quot;admin-script&quot;/&gt; 
&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-gui,manager
script,tomcat,admin-gui,admin-script&quot;/&gt;
 &lt;/tomcat-users&gt;
</code></pre>
<p>ç”¨æˆ·å’Œå¯†ç éƒ½æ˜¯ï¼š tomcat<br>æ³¨æ„ï¼šä¸ºäº†èƒ½å¤Ÿåˆšæ‰é…ç½®çš„ç”¨æˆ·ç™»å½•åˆ°Tomcatï¼Œè¿˜éœ€è¦ä¿®æ”¹ä»¥ä¸‹é…ç½®</p>
<blockquote>
<p>vi &#x2F;opt&#x2F;tomcat&#x2F;webapps&#x2F;manager&#x2F;META-INF&#x2F;context.xml</p>
</blockquote>
<pre><code class="yaml">&lt;!--
 &lt;Valve className=&quot;org.apache.catalina.valves.RemoteAddrValve&quot;
 allow=&quot;127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1&quot; /&gt;
--&gt;
</code></pre>
<p>æ³¨é‡Šæ‰è¿™è¡Œå°±è¡Œï¼ï¼</p>
<blockquote>
<p><strong>å…³é—­å·²æœ‰ Tomcat</strong>ï¼ˆå»ºè®®å…ˆå…³é—­ï¼Œé¿å…å†²çªï¼‰ï¼š</p>
<pre><code>/opt/tomcat/bin/shutdown.sh
</code></pre>
<p><strong>å†å¯åŠ¨</strong>ï¼š</p>
<pre><code>/opt/tomcat/bin/startup.sh
</code></pre>
</blockquote>
<p>[&#x2F;manager] (<a target="_blank" rel="noopener" href="http://192.168.200.131:8090/manager/html">http://192.168.200.131:8090/manager/html</a>)   <strong>æ­¤æ—¶å°±å¯ä»¥è®¿é—®äº†ï¼ï¼ï¼</strong></p>
<h2 id="3ã€Jenkinsæ„å»ºMavené¡¹ç›®"><a href="#3ã€Jenkinsæ„å»ºMavené¡¹ç›®" class="headerlink" title="3ã€Jenkinsæ„å»ºMavené¡¹ç›®"></a>3ã€Jenkinsæ„å»ºMavené¡¹ç›®</h2><h4 id="Jenkinsé¡¹ç›®æ„å»ºç±»å‹-1-Jenkinsæ„å»ºçš„é¡¹ç›®ç±»å‹ä»‹ç»"><a href="#Jenkinsé¡¹ç›®æ„å»ºç±»å‹-1-Jenkinsæ„å»ºçš„é¡¹ç›®ç±»å‹ä»‹ç»" class="headerlink" title="Jenkinsé¡¹ç›®æ„å»ºç±»å‹(1)-Jenkinsæ„å»ºçš„é¡¹ç›®ç±»å‹ä»‹ç»"></a>Jenkinsé¡¹ç›®æ„å»ºç±»å‹(1)-Jenkinsæ„å»ºçš„é¡¹ç›®ç±»å‹ä»‹ç»</h4><p>Jenkinsä¸­è‡ªåŠ¨æ„å»ºé¡¹ç›®çš„ç±»å‹æœ‰å¾ˆå¤šï¼Œå¸¸ç”¨çš„æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š </p>
<ul>
<li>è‡ªç”±é£æ ¼è½¯ä»¶é¡¹ç›®ï¼ˆ FreeStyle Projectï¼‰ </li>
<li>Maven é¡¹ç›®ï¼ˆMaven Projectï¼‰ </li>
<li><span style ="color:red"><strong>æµæ°´çº¿é¡¹ç›®ï¼ˆ Pipeline Projectï¼‰</strong></span></li>
</ul>
<p>æ¯ç§ç±»å‹çš„æ„å»ºå…¶å®éƒ½å¯ä»¥å®Œæˆä¸€æ ·çš„æ„å»ºè¿‡ç¨‹ä¸ç»“æœï¼Œåªæ˜¯åœ¨æ“ä½œæ–¹å¼ã€çµæ´»åº¦ç­‰æ–¹é¢æœ‰æ‰€åŒºåˆ«ï¼Œåœ¨ å®é™…å¼€å‘ä¸­å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œä¹ æƒ¯æ¥é€‰æ‹©ã€‚ï¼ˆPSï¼šä¸ªäººæ¨èä½¿ç”¨æµæ°´çº¿ç±»å‹ï¼Œå› ä¸ºçµæ´»åº¦éå¸¸é«˜ï¼‰</p>
<h4 id="Jenkinsé¡¹ç›®æ„å»ºç±»å‹-2-è‡ªç”±é£æ ¼é¡¹ç›®æ„å»º"><a href="#Jenkinsé¡¹ç›®æ„å»ºç±»å‹-2-è‡ªç”±é£æ ¼é¡¹ç›®æ„å»º" class="headerlink" title="Jenkinsé¡¹ç›®æ„å»ºç±»å‹(2)-è‡ªç”±é£æ ¼é¡¹ç›®æ„å»º"></a>Jenkinsé¡¹ç›®æ„å»ºç±»å‹(2)-è‡ªç”±é£æ ¼é¡¹ç›®æ„å»º</h4><p>ä¸‹é¢æ¼”ç¤ºåˆ›å»ºä¸€ä¸ªè‡ªç”±é£æ ¼é¡¹ç›®æ¥å®Œæˆé¡¹ç›®çš„é›†æˆè¿‡ç¨‹ï¼š</p>
<blockquote>
<p>æ‹‰å–ä»£ç â†’ç¼–è¯‘â†’æ‰“åŒ…â†’éƒ¨ç½²</p>
</blockquote>
<p>â€¦â€¦</p>
<h4 id="éƒ¨ç½²-1"><a href="#éƒ¨ç½²-1" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h4><p>æŠŠé¡¹ç›®éƒ¨ç½²åˆ°è¿œç¨‹çš„Tomcaté‡Œé¢ </p>
<h6 id="1ï¼‰å®‰è£…-Deploy-to-containeræ’ä»¶"><a href="#1ï¼‰å®‰è£…-Deploy-to-containeræ’ä»¶" class="headerlink" title="1ï¼‰å®‰è£… Deploy to containeræ’ä»¶"></a>1ï¼‰å®‰è£… Deploy to containeræ’ä»¶</h6><p>Jenkinsæœ¬èº«æ— æ³•å®ç°è¿œç¨‹éƒ¨ç½²åˆ°Tomcatçš„åŠŸèƒ½ï¼Œéœ€è¦åœ¨Jenkinsé‡Œé¢å®‰è£…<strong>Deploy to container</strong>æ’ä»¶å®ç°</p>
<p><a href="file:///C:/Users/Pluminary/Desktop/JenkinsæŒç»­é›†æˆä»å…¥é—¨åˆ°ç²¾é€š.pdf">JenkinsæŒç»­é›†æˆä»å…¥é—¨åˆ°ç²¾é€š.pdf</a> ã€39é¡µã€‘</p>
<p>â‘ ï¼š<strong>Build Steps</strong> â†’ Execute shell â†’â†“</p>
<pre><code class="java">echo &quot;å¼€å§‹è¿›è¡Œç¼–è¯‘æ„å»º&quot;
mvn clean package
echo &quot;ç¼–è¯‘æ„å»ºç»“æŸ&quot;
</code></pre>
<p>â‘¡ï¼šåœ¨Jenkinsçš„é¡¹ç›®é…ç½®é‡Œ ä¸‹é¢<br>æ„å»ºåæ“ä½œï¼šã€Deploy war&#x2F;ear to a containerã€‘â†’ é€‰æ‹© <strong><u>Tomcat 8.x Remote</u></strong><br><strong>WAR&#x2F;EAR files</strong>ï¼š<u>target&#x2F;*.war</u><br><strong>Containers</strong>ï¼š<br>æ–°å¢ä¸€ä¸ªå‡­è¯ ç”¨æˆ·åtomcat å¯†ç tomcat</p>
<p>éƒ¨ç½²æˆåŠŸåï¼Œè®¿é—®é¡¹ç›®ï¼š[<u>æ¼”ç¤ºé¡¹ç›®ä¸»é¡µ</u>] (<a target="_blank" rel="noopener" href="http://192.168.200.131:8090/web_demo-1.0-SNAPSHOT/">http://192.168.200.131:8090/web_demo-1.0-SNAPSHOT/</a>)</p>
<pre><code class="xml">å¦‚æœçœ‹åˆ°æ­¤é¡µé¢ï¼Œä»£è¡¨é¡¹ç›®éƒ¨ç½²æˆåŠŸå•¦ï¼--è¿™æ˜¯masteråˆ†æ”¯ æ·»åŠ ç”¨æˆ·
ä¿®æ”¹ç”¨æˆ·
åˆ é™¤ç”¨æˆ· æŸ¥è¯¢ç”¨æˆ·
</code></pre>
<p>æ¼”ç¤ºæ”¹åŠ¨ä»£ç åçš„æŒç»­é›†æˆ<br>1ï¼‰IDEAä¸­æºç ä¿®æ”¹å¹¶æäº¤åˆ°gitlab<br>2ï¼‰åœ¨Jenkinsä¸­é¡¹ç›®é‡æ–°æ„å»º<br>3ï¼‰è®¿é—®Tomcat</p>
<h5 id="æ¼”ç¤ºæ”¹åŠ¨ä»£ç åçš„æŒç»­é›†æˆ"><a href="#æ¼”ç¤ºæ”¹åŠ¨ä»£ç åçš„æŒç»­é›†æˆ" class="headerlink" title="æ¼”ç¤ºæ”¹åŠ¨ä»£ç åçš„æŒç»­é›†æˆ"></a>æ¼”ç¤ºæ”¹åŠ¨ä»£ç åçš„æŒç»­é›†æˆ</h5><p>1ï¼‰IDEAä¸­æºç ä¿®æ”¹å¹¶æäº¤åˆ°gitlab<br>2ï¼‰<strong>åœ¨Jenkinsä¸­é¡¹ç›®é‡æ–°æ„å»º</strong><br>3ï¼‰è®¿é—®Tomcat</p>
<h4 id="Jenkinsé¡¹ç›®æ„å»ºç±»å‹-3-Mavené¡¹ç›®æ„å»º"><a href="#Jenkinsé¡¹ç›®æ„å»ºç±»å‹-3-Mavené¡¹ç›®æ„å»º" class="headerlink" title="Jenkinsé¡¹ç›®æ„å»ºç±»å‹(3)-Mavené¡¹ç›®æ„å»º"></a>Jenkinsé¡¹ç›®æ„å»ºç±»å‹(3)-Mavené¡¹ç›®æ„å»º</h4><p>1ï¼‰å®‰è£… <strong>Maven Integration</strong> æ’ä»¶<br>2ï¼‰åˆ›å»º <strong>Maven</strong> é¡¹ç›®<br>3ï¼‰é…ç½®é¡¹ç›®<br>æ‹‰å–ä»£ç å’Œè¿œç¨‹éƒ¨ç½²çš„è¿‡ç¨‹å’Œè‡ªç”±é£æ ¼é¡¹ç›®ä¸€æ ·ï¼Œåªæ˜¯â€æ„å»ºâ€éƒ¨åˆ†ä¸åŒ</p>
<p>æ–°å»º<strong>Item</strong> â†’ <strong>æ„å»ºä¸€ä¸ªmavené¡¹ç›®</strong><br>å…¶ä¸­Buildçš„<strong>Root POM</strong>æ˜¯è¦æ‰¾åˆ°pom.xmlçš„è·¯å¾„æ‰è¡Œã€é»˜è®¤æ‰§è¡Œmavenå‘½ä»¤ã€‘<br>æ‰€ä»¥åªéœ€è¦åœ¨<strong>Goals and options</strong>é‡Œé¢æ•²ä¸Š<code>clean package</code></p>
<h4 id="Jenkinsé¡¹ç›®æ„å»ºç±»å‹-4-Pipelineæµæ°´çº¿é¡¹ç›®æ„å»º"><a href="#Jenkinsé¡¹ç›®æ„å»ºç±»å‹-4-Pipelineæµæ°´çº¿é¡¹ç›®æ„å»º" class="headerlink" title="Jenkinsé¡¹ç›®æ„å»ºç±»å‹(4)-Pipelineæµæ°´çº¿é¡¹ç›®æ„å»º(*)"></a>Jenkinsé¡¹ç›®æ„å»ºç±»å‹(4)-Pipelineæµæ°´çº¿é¡¹ç›®æ„å»º(*)</h4><h5 id="Pipelineç®€ä»‹"><a href="#Pipelineç®€ä»‹" class="headerlink" title="Pipelineç®€ä»‹"></a>Pipelineç®€ä»‹</h5><h6 id="1ï¼‰æ¦‚å¿µ"><a href="#1ï¼‰æ¦‚å¿µ" class="headerlink" title="1ï¼‰æ¦‚å¿µ"></a>1ï¼‰æ¦‚å¿µ</h6><p>Pipelineï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸€å¥—è¿è¡Œåœ¨ Jenkins ä¸Šçš„å·¥ä½œæµæ¡†æ¶ï¼Œå°†åŸæ¥ç‹¬ç«‹è¿è¡Œäºå•ä¸ªæˆ–è€…å¤šä¸ªèŠ‚ç‚¹ çš„ä»»åŠ¡è¿æ¥èµ·æ¥ï¼Œå®ç°å•ä¸ªä»»åŠ¡éš¾ä»¥å®Œæˆçš„å¤æ‚æµç¨‹ç¼–æ’å’Œå¯è§†åŒ–çš„å·¥ä½œã€‚</p>
<h6 id="2ï¼‰ä½¿ç”¨Pipelineæœ‰ä»¥ä¸‹å¥½å¤„ï¼ˆæ¥è‡ªç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£ï¼‰ï¼š"><a href="#2ï¼‰ä½¿ç”¨Pipelineæœ‰ä»¥ä¸‹å¥½å¤„ï¼ˆæ¥è‡ªç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£ï¼‰ï¼š" class="headerlink" title="2ï¼‰ä½¿ç”¨Pipelineæœ‰ä»¥ä¸‹å¥½å¤„ï¼ˆæ¥è‡ªç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£ï¼‰ï¼š"></a>2ï¼‰ä½¿ç”¨Pipelineæœ‰ä»¥ä¸‹å¥½å¤„ï¼ˆæ¥è‡ªç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£ï¼‰ï¼š</h6><p>ä»£ç ï¼šPipelineä»¥ä»£ç çš„å½¢å¼å®ç°ï¼Œé€šå¸¸è¢«æ£€å…¥æºä»£ç æ§åˆ¶ï¼Œä½¿å›¢é˜Ÿèƒ½å¤Ÿç¼–è¾‘ï¼Œå®¡æŸ¥å’Œè¿­ä»£å…¶ä¼ é€æµ ç¨‹ã€‚ æŒä¹…ï¼šæ— è®ºæ˜¯è®¡åˆ’å†…çš„è¿˜æ˜¯è®¡åˆ’å¤–çš„æœåŠ¡å™¨é‡å¯ï¼ŒPipelineéƒ½æ˜¯å¯æ¢å¤çš„ã€‚ å¯åœæ­¢ï¼šPipelineå¯æ¥ æ”¶äº¤äº’å¼è¾“å…¥ï¼Œä»¥ç¡®å®šæ˜¯å¦ç»§ç»­æ‰§è¡ŒPipelineã€‚ å¤šåŠŸèƒ½ï¼šPipelineæ”¯æŒç°å®ä¸–ç•Œä¸­å¤æ‚çš„æŒç»­äº¤ä»˜è¦ æ±‚ã€‚å®ƒæ”¯æŒfork&#x2F;joinã€å¾ªç¯æ‰§è¡Œï¼Œå¹¶è¡Œæ‰§è¡Œä»»åŠ¡çš„åŠŸèƒ½ã€‚ å¯æ‰©å±•ï¼šPipelineæ’ä»¶æ”¯æŒå…¶DSLçš„è‡ªå®šä¹‰æ‰© å±• ï¼Œä»¥åŠä¸å…¶ä»–æ’ä»¶é›†æˆçš„å¤šä¸ªé€‰é¡¹ã€‚</p>
<h6 id="3ï¼‰å¦‚ä½•åˆ›å»º-Jenkins-Pipelineå‘¢ï¼Ÿ"><a href="#3ï¼‰å¦‚ä½•åˆ›å»º-Jenkins-Pipelineå‘¢ï¼Ÿ" class="headerlink" title="3ï¼‰å¦‚ä½•åˆ›å»º Jenkins Pipelineå‘¢ï¼Ÿ"></a>3ï¼‰å¦‚ä½•åˆ›å»º Jenkins Pipelineå‘¢ï¼Ÿ</h6><ul>
<li>Pipeline è„šæœ¬æ˜¯ç”± Groovy è¯­è¨€å®ç°çš„ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡å¿…è¦å•ç‹¬å»å­¦ä¹  Groovy </li>
<li>Pipeline æ”¯æŒä¸¤ç§è¯­æ³•ï¼š<span style="color:red"><strong>Declarative</strong>(å£°æ˜å¼)</span> å’Œ <span style="color:red"><strong>Scripted Pipeline</strong>(è„šæœ¬å¼)</span>è¯­æ³• </li>
<li>Pipeline  ä¹Ÿæœ‰ä¸¤ç§åˆ›å»ºæ–¹æ³•ï¼šå¯ä»¥ç›´æ¥åœ¨ Jenkins çš„ Web UI ç•Œé¢ä¸­è¾“å…¥è„šæœ¬ï¼›ä¹Ÿå¯ä»¥é€šè¿‡åˆ›å»ºä¸€ ä¸ª Jenkinsfile è„šæœ¬æ–‡ä»¶æ”¾å…¥é¡¹ç›®æºç åº“ä¸­ï¼ˆ<u>ä¸€èˆ¬æˆ‘ä»¬éƒ½æ¨èåœ¨ Jenkins ä¸­ç›´æ¥ä»æºä»£ç æ§åˆ¶(SCM) ä¸­ç›´æ¥è½½å…¥ Jenkinsfile Pipeline è¿™ç§æ–¹æ³•</u>ï¼‰</li>
</ul>
<h5 id="å®‰è£…Pipelineæ’ä»¶å¦‚æœä¸€æ¬¡å®‰è£…å¤±è´¥ï¼Œé‡å¯ä¸€æ¬¡å†å®‰è£…-æ²¡è§†å›¾å°±å®‰è£…pipeline-Stage-View"><a href="#å®‰è£…Pipelineæ’ä»¶å¦‚æœä¸€æ¬¡å®‰è£…å¤±è´¥ï¼Œé‡å¯ä¸€æ¬¡å†å®‰è£…-æ²¡è§†å›¾å°±å®‰è£…pipeline-Stage-View" class="headerlink" title="å®‰è£…Pipelineæ’ä»¶å¦‚æœä¸€æ¬¡å®‰è£…å¤±è´¥ï¼Œé‡å¯ä¸€æ¬¡å†å®‰è£…[æ²¡è§†å›¾å°±å®‰è£…pipeline Stage View]"></a>å®‰è£…Pipelineæ’ä»¶<del>å¦‚æœä¸€æ¬¡å®‰è£…å¤±è´¥ï¼Œé‡å¯ä¸€æ¬¡å†å®‰è£…</del>[æ²¡è§†å›¾å°±å®‰è£…pipeline Stage View]</h5><p>Manage Jenkins-&gt;Manage Plugins-&gt;å¯é€‰æ’ä»¶</p>
<h3 id="Pipelineè¯­æ³•å¿«é€Ÿå…¥é—¨"><a href="#Pipelineè¯­æ³•å¿«é€Ÿå…¥é—¨" class="headerlink" title="Pipelineè¯­æ³•å¿«é€Ÿå…¥é—¨"></a>Pipelineè¯­æ³•å¿«é€Ÿå…¥é—¨</h3><h5 id="1ï¼‰Declarativeå£°æ˜å¼-Pipeline"><a href="#1ï¼‰Declarativeå£°æ˜å¼-Pipeline" class="headerlink" title="1ï¼‰Declarativeå£°æ˜å¼-Pipeline"></a>1ï¼‰Declarativeå£°æ˜å¼-Pipeline</h5><p><strong><u>åˆ›å»ºé¡¹ç›®</u></strong> [<strong>agentæ˜¯ä»£ç†ã€stageæ˜¯é˜¶æ®µã€stepsæ˜¯æ­¥éª¤</strong>]</p>
<ul>
<li><strong>Node</strong> ï¼šèŠ‚ç‚¹ï¼Œä¸€ä¸ª Node å°±æ˜¯ä¸€ä¸ª Jenkins èŠ‚ç‚¹ï¼ŒMaster æˆ–è€… Agentï¼Œæ˜¯æ‰§è¡Œ Step çš„å…·ä½“è¿è¡Œ ç¯å¢ƒï¼Œåç»­è®²åˆ°Jenkinsçš„Master-Slaveæ¶æ„çš„æ—¶å€™ç”¨åˆ°ã€‚ </li>
<li><strong>Stage</strong> ï¼šé˜¶æ®µï¼Œä¸€ä¸ª Pipeline å¯ä»¥åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ª Stageï¼Œæ¯ä¸ª Stage ä»£è¡¨ä¸€ç»„æ“ä½œï¼Œæ¯”å¦‚ï¼š Buildã€Testã€Deployï¼ŒStage æ˜¯ä¸€ä¸ªé€»è¾‘åˆ†ç»„çš„æ¦‚å¿µã€‚ </li>
<li><strong>Step</strong> ï¼šæ­¥éª¤ï¼ŒStep æ˜¯æœ€åŸºæœ¬çš„æ“ä½œå•å…ƒï¼Œå¯ä»¥æ˜¯æ‰“å°ä¸€å¥è¯ï¼Œä¹Ÿå¯ä»¥æ˜¯æ„å»ºä¸€ä¸ª Docker é•œåƒï¼Œ ç”±å„ç±» Jenkins æ’ä»¶æä¾›ï¼Œæ¯”å¦‚å‘½ä»¤ï¼šsh â€˜makeâ€™ï¼Œå°±ç›¸å½“äºæˆ‘ä»¬å¹³æ—¶ shell ç»ˆç«¯ä¸­æ‰§è¡Œ make å‘½ä»¤ ä¸€æ ·ã€‚</li>
</ul>
<pre><code class="java">pipeline &#123;
    agent any
    stages &#123;
        stage(&#39;pull code&#39;) &#123;
            steps &#123;
                echo &#39;pull code&#39;
            &#125;
        &#125;
        stage(&#39;build project&#39;) &#123;
            steps &#123;
                echo &#39;build project&#39;
            &#125;
        &#125;
        stage(&#39;publish project&#39;) &#123;
            steps &#123;
                echo &#39;publish project&#39;
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
<h5 id="2ï¼‰Scripted-Pipelineè„šæœ¬å¼-Pipeline"><a href="#2ï¼‰Scripted-Pipelineè„šæœ¬å¼-Pipeline" class="headerlink" title="2ï¼‰Scripted Pipelineè„šæœ¬å¼-Pipeline"></a>2ï¼‰Scripted Pipelineè„šæœ¬å¼-Pipeline</h5><p><strong><u>åˆ›å»ºé¡¹ç›®</u></strong><br>æµæ°´çº¿é‚£é‡Œé€‰æ‹© â€œ<strong>Scripted Pipeline</strong>â€œ</p>
<pre><code class="java">node &#123;
    def mvnHome
    stage(&#39;pull code&#39;)&#123;
        echo &#39;pull code&#39;
    &#125;
    stage(&#39;build project&#39;)&#123;
        echo &#39;build project&#39;
    &#125;
    stage(&#39;publish project&#39;)&#123;
        echo &#39;publish project&#39;
    &#125;
&#125;
</code></pre>
<p><span style = "color:blue"><u>æµæ°´çº¿è„šæœ¬</u></span>ï¼šç‚¹å‡»å¯ä»¥ä½¿ç”¨å®˜æ–¹çš„è„šæœ¬ç”Ÿæˆå™¨</p>
<ul>
<li><strong>ç‰‡æ®µç”Ÿæˆå™¨</strong>ï¼š<br>ç¤ºä¾‹æ­¥éª¤ï¼šcheckoutï¼šCheck out from version control [ä»ç‰ˆæœ¬æ§åˆ¶é‡Œæ‹‰å–ä»£ç ]<br>é€‰æ‹©gitæ‹‰å–ä»£ç  å¡«å†™URLå’Œå‡­è¯ â†’ ç”Ÿæˆæµæ°´çº¿è„šæœ¬</li>
</ul>
<h3 id="æ‹‰å–ä»£ç "><a href="#æ‹‰å–ä»£ç " class="headerlink" title="æ‹‰å–ä»£ç "></a><span style = "color:red">æ‹‰å–ä»£ç </span></h3><h6 id="Pipeline-script"><a href="#Pipeline-script" class="headerlink" title="Pipeline script"></a>Pipeline script</h6><pre><code class="java">pipeline&#123;
    agent any
    stages&#123;
        stage(&#39;æ‹‰å–ä»£ç &#39;)&#123;
            steps&#123;
                checkout scmGit(branches: [[name: &#39;*/master&#39;]], extensions: [], userRemoteConfigs: [[credentialsId: &#39;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&#39;, url: &#39;http://192.168.200.132:82/lanyun_group/web_demo.git&#39;]])
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
<h5 id="Console-Output"><a href="#Console-Output" class="headerlink" title="Console Output"></a>Console Output</h5><pre><code class="java">Started by user root
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/lib/jenkins/workspace/web_demo_pipeline
[Pipeline] &#123;
[Pipeline] stage
[Pipeline] &#123; (æ‹‰å–ä»£ç )
[Pipeline] checkout
The recommended git tool is: NONE
using credential ca22e56f-0ecc-4fdc-965d-01e329a0b68a
Cloning the remote Git repository
Cloning repository http://192.168.200.132:82/lanyun_group/web_demo.git
 &gt; git init /var/lib/jenkins/workspace/web_demo_pipeline # timeout=10
Fetching upstream changes from http://192.168.200.132:82/lanyun_group/web_demo.git
 &gt; git --version # timeout=10
 &gt; git --version # &#39;git version 1.8.3.1&#39;
using GIT_ASKPASS to set credentials gitlab-auth-password
 &gt; git fetch --tags --progress http://192.168.200.132:82/lanyun_group/web_demo.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 &gt; git config remote.origin.url http://192.168.200.132:82/lanyun_group/web_demo.git # timeout=10
 &gt; git config --add remote.origin.fetch +refs/heads/*:refs/remotes/origin/* # timeout=10
Avoid second fetch
 &gt; git rev-parse refs/remotes/origin/master^&#123;commit&#125; # timeout=10
Checking out Revision 7ae1ec4086586fb471b0e9dee0a0d00d0b6d6f54 (refs/remotes/origin/master)
 &gt; git config core.sparsecheckout # timeout=10
 &gt; git checkout -f 7ae1ec4086586fb471b0e9dee0a0d00d0b6d6f54 # timeout=10
Commit message: &quot;ä¿®æ”¹index.jspåŠ å…¥ç»†èŠ‚(!)&quot;
First time build. Skipping changelog.
[Pipeline] &#125;
[Pipeline] // stage
[Pipeline] &#125;
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS
</code></pre>
<p>å»Jenkinsçš„æœåŠ¡å™¨é‡Œå¯»æ‰¾<code>/var/lib/jenkins/workspace/web_demo_pipeline</code></p>
<h3 id="ç¼–è¯‘æ‰“åŒ…"><a href="#ç¼–è¯‘æ‰“åŒ…" class="headerlink" title="ç¼–è¯‘æ‰“åŒ…"></a><span style = "color:red">ç¼–è¯‘æ‰“åŒ…</span></h3><p><span style = "color:blue"><u>æµæ°´çº¿è„šæœ¬</u></span>ï¼šç‚¹å‡»å¯ä»¥ä½¿ç”¨å®˜æ–¹çš„è„šæœ¬ç”Ÿæˆå™¨</p>
<ul>
<li><strong>ç‰‡æ®µç”Ÿæˆå™¨</strong>ï¼š<br>ç¤ºä¾‹æ­¥éª¤ï¼š<code>shï¼šShell Script</code><br>Shell Scriptï¼šé‡Œé¢éœ€è¦æ‰“æ‰€éœ€è¦çš„å‘½ä»¤ <code>mvn clean package</code></li>
</ul>
<h6 id="Pipeline-script-1"><a href="#Pipeline-script-1" class="headerlink" title="Pipeline script"></a>Pipeline script</h6><pre><code class="java">pipeline&#123;
    agent any
    stages&#123;
        stage(&#39;build project&#39;)&#123;
            steps&#123;
                sh &#39;mvn clean package&#39;
            &#125;
        &#125;
    &#125;
&#125;

--------------------------------------------
ã€æ€»æµæ°´çº¿ä»£ç ã€‘
pipeline &#123;
    agent any
    stages &#123;
        stage(&#39;pull code&#39;) &#123;
            steps &#123;
                checkout scmGit(
                    branches: [[name: &#39;*/master&#39;]],
                    extensions: [],
                    userRemoteConfigs: [[
                        credentialsId: &#39;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&#39;,
                        url: &#39;http://192.168.200.132:82/lanyun_group/web_demo.git&#39;
                    ]]
                )
            &#125;
        &#125;
        stage(&#39;build project&#39;) &#123;
            steps &#123;
                sh &#39;mvn clean package&#39;
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
<h5 id="Console-Output-1"><a href="#Console-Output-1" class="headerlink" title="Console Output"></a>Console Output</h5><pre><code class="java">Started by user root
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/lib/jenkins/workspace/web_demo_pipeline
[Pipeline] &#123;
[Pipeline] stage
[Pipeline] &#123; (pull code)
[Pipeline] checkout
The recommended git tool is: NONE
using credential ca22e56f-0ecc-4fdc-965d-01e329a0b68a
 &gt; git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/web_demo_pipeline/.git # timeout=10
Fetching changes from the remote Git repository
 &gt; git config remote.origin.url http://192.168.200.132:82/lanyun_group/web_demo.git # timeout=10
Fetching upstream changes from http://192.168.200.132:82/lanyun_group/web_demo.git
 &gt; git --version # timeout=10
 &gt; git --version # &#39;git version 1.8.3.1&#39;
using GIT_ASKPASS to set credentials gitlab-auth-password
 &gt; git fetch --tags --progress http://192.168.200.132:82/lanyun_group/web_demo.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 &gt; git rev-parse refs/remotes/origin/master^&#123;commit&#125; # timeout=10
Checking out Revision 7ae1ec4086586fb471b0e9dee0a0d00d0b6d6f54 (refs/remotes/origin/master)
 &gt; git config core.sparsecheckout # timeout=10
 &gt; git checkout -f 7ae1ec4086586fb471b0e9dee0a0d00d0b6d6f54 # timeout=10
Commit message: &quot;ä¿®æ”¹index.jspåŠ å…¥ç»†èŠ‚(!)&quot;
 &gt; git rev-list --no-walk 7ae1ec4086586fb471b0e9dee0a0d00d0b6d6f54 # timeout=10
[Pipeline] &#125;
[Pipeline] // stage
[Pipeline] stage
[Pipeline] &#123; (build project)
[Pipeline] sh
+ mvn clean package
[INFO] Scanning for projects...
[INFO] 
[INFO] ------------------------&lt; com.itheima:web_demo &gt;------------------------
[INFO] Building web_demo 1.0-SNAPSHOT
[INFO] --------------------------------[ war ]---------------------------------
[INFO] 
[INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ web_demo ---
[INFO] 
[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ web_demo ---
[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!
[INFO] skip non existing resourceDirectory /var/lib/jenkins/workspace/web_demo_pipeline/src/main/resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.8.1:compile (default-compile) @ web_demo ---
[INFO] Changes detected - recompiling the module!
[INFO] Compiling 1 source file to /var/lib/jenkins/workspace/web_demo_pipeline/target/classes
[INFO] 
[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ web_demo ---
[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!
[INFO] skip non existing resourceDirectory /var/lib/jenkins/workspace/web_demo_pipeline/src/test/resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.8.1:testCompile (default-testCompile) @ web_demo ---
[INFO] No sources to compile
[INFO] 
[INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ web_demo ---
[INFO] No tests to run.
[INFO] 
[INFO] --- maven-war-plugin:3.3.2:war (default-war) @ web_demo ---
[INFO] Packaging webapp
[INFO] Assembling webapp [web_demo] in [/var/lib/jenkins/workspace/web_demo_pipeline/target/web_demo-1.0-SNAPSHOT]
[INFO] Processing war project
[INFO] Copying webapp resources [/var/lib/jenkins/workspace/web_demo_pipeline/src/main/webapp]
[INFO] Building war: /var/lib/jenkins/workspace/web_demo_pipeline/target/web_demo-1.0-SNAPSHOT.war
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  10.242 s
[INFO] Finished at: 2025-06-24T20:32:45+08:00
[INFO] ------------------------------------------------------------------------
[Pipeline] &#125;
[Pipeline] // stage
[Pipeline] &#125;
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS
</code></pre>
<h3 id="éƒ¨ç½²-2"><a href="#éƒ¨ç½²-2" class="headerlink" title="éƒ¨ç½²"></a><span style = "color:red">éƒ¨ç½²</span></h3><p><span style = "color:blue"><u>æµæ°´çº¿è„šæœ¬</u></span>ï¼šç‚¹å‡»å¯ä»¥ä½¿ç”¨å®˜æ–¹çš„è„šæœ¬ç”Ÿæˆå™¨</p>
<ul>
<li><strong>ç‰‡æ®µç”Ÿæˆå™¨</strong>ï¼š<br>ç¤ºä¾‹æ­¥éª¤ï¼š<code>deployï¼šDeploy war/ear to a container</code><br>WAR&#x2F;EAR filesï¼š<code>target/*.war</code><br>containersï¼š<strong>Tomcat 8.x Remote</strong> ã€å®¹å™¨å¯ä»¥å¢åŠ å¤šå°ã€‘<br>credentialsï¼šæ·»åŠ tomcatå‡­è¯<br>Tomcat URLï¼š<a target="_blank" rel="noopener" href="http://192.168.200.131:8090/">http://192.168.200.131:8090/</a></li>
</ul>
<h6 id="Pipeline-script-2"><a href="#Pipeline-script-2" class="headerlink" title="Pipeline script"></a>Pipeline script</h6><pre><code class="java">ã€æ€»æµæ°´çº¿ä»£ç ã€‘
pipeline &#123;
    agent any
    stages &#123;
        stage(&#39;pull code&#39;) &#123;
            steps &#123;
                checkout scmGit(
                    branches: [[name: &#39;*/master&#39;]],
                    extensions: [],
                    userRemoteConfigs: [[
                        credentialsId: &#39;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&#39;,
                        url: &#39;http://192.168.200.132:82/lanyun_group/web_demo.git&#39;
                    ]]
                )
            &#125;
        &#125;
        stage(&#39;build project&#39;) &#123;
            steps &#123;
                sh &#39;mvn clean package&#39;
            &#125;
        &#125;
        stage(&#39;publish&#39;) &#123;
            steps &#123;
                deploy adapters: [tomcat8(alternativeDeploymentContext: &#39;&#39;, credentialsId: &#39;e847a130-29c3-4d0b-bf35-db8d00de7950&#39;, path: &#39;&#39;, url: &#39;http://192.168.200.131:8090/&#39;)], contextPath: null, war: &#39;target/*.war&#39;
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
<h5 id="Console-Output-2"><a href="#Console-Output-2" class="headerlink" title="Console Output"></a>Console Output</h5><pre><code class="java">Started by user root
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/lib/jenkins/workspace/web_demo_pipeline
[Pipeline] &#123;
[Pipeline] stage
[Pipeline] &#123; (pull code)
[Pipeline] checkout
The recommended git tool is: NONE
using credential ca22e56f-0ecc-4fdc-965d-01e329a0b68a
 &gt; git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/web_demo_pipeline/.git # timeout=10
Fetching changes from the remote Git repository
 &gt; git config remote.origin.url http://192.168.200.132:82/lanyun_group/web_demo.git # timeout=10
Fetching upstream changes from http://192.168.200.132:82/lanyun_group/web_demo.git
 &gt; git --version # timeout=10
 &gt; git --version # &#39;git version 1.8.3.1&#39;
using GIT_ASKPASS to set credentials gitlab-auth-password
 &gt; git fetch --tags --progress http://192.168.200.132:82/lanyun_group/web_demo.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 &gt; git rev-parse refs/remotes/origin/master^&#123;commit&#125; # timeout=10
Checking out Revision 7ae1ec4086586fb471b0e9dee0a0d00d0b6d6f54 (refs/remotes/origin/master)
 &gt; git config core.sparsecheckout # timeout=10
 &gt; git checkout -f 7ae1ec4086586fb471b0e9dee0a0d00d0b6d6f54 # timeout=10
Commit message: &quot;ä¿®æ”¹index.jspåŠ å…¥ç»†èŠ‚(!)&quot;
 &gt; git rev-list --no-walk 7ae1ec4086586fb471b0e9dee0a0d00d0b6d6f54 # timeout=10
[Pipeline] &#125;
[Pipeline] // stage
[Pipeline] stage
[Pipeline] &#123; (build project)
[Pipeline] sh
+ mvn clean package
[INFO] Scanning for projects...
[INFO] 
[INFO] ------------------------&lt; com.itheima:web_demo &gt;------------------------
[INFO] Building web_demo 1.0-SNAPSHOT
[INFO] --------------------------------[ war ]---------------------------------
[INFO] 
[INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ web_demo ---
[INFO] Deleting /var/lib/jenkins/workspace/web_demo_pipeline/target
[INFO] 
[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ web_demo ---
[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!
[INFO] skip non existing resourceDirectory /var/lib/jenkins/workspace/web_demo_pipeline/src/main/resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.8.1:compile (default-compile) @ web_demo ---
[INFO] Changes detected - recompiling the module!
[INFO] Compiling 1 source file to /var/lib/jenkins/workspace/web_demo_pipeline/target/classes
[INFO] 
[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ web_demo ---
[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!
[INFO] skip non existing resourceDirectory /var/lib/jenkins/workspace/web_demo_pipeline/src/test/resources
[INFO] 
[INFO] --- maven-compiler-plugin:3.8.1:testCompile (default-testCompile) @ web_demo ---
[INFO] No sources to compile
[INFO] 
[INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ web_demo ---
[INFO] No tests to run.
[INFO] 
[INFO] --- maven-war-plugin:3.3.2:war (default-war) @ web_demo ---
[INFO] Packaging webapp
[INFO] Assembling webapp [web_demo] in [/var/lib/jenkins/workspace/web_demo_pipeline/target/web_demo-1.0-SNAPSHOT]
[INFO] Processing war project
[INFO] Copying webapp resources [/var/lib/jenkins/workspace/web_demo_pipeline/src/main/webapp]
[INFO] Building war: /var/lib/jenkins/workspace/web_demo_pipeline/target/web_demo-1.0-SNAPSHOT.war
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  7.472 s
[INFO] Finished at: 2025-06-24T20:39:46+08:00
[INFO] ------------------------------------------------------------------------
[Pipeline] &#125;
[Pipeline] // stage
[Pipeline] stage
[Pipeline] &#123; (publish)
[Pipeline] deploy
[DeployPublisher][INFO] Attempting to deploy 1 war file(s)
[DeployPublisher][INFO] Deploying /var/lib/jenkins/workspace/web_demo_pipeline/target/web_demo-1.0-SNAPSHOT.war to container Tomcat 8.x Remote with context null
  Redeploying [/var/lib/jenkins/workspace/web_demo_pipeline/target/web_demo-1.0-SNAPSHOT.war]
  Undeploying [/var/lib/jenkins/workspace/web_demo_pipeline/target/web_demo-1.0-SNAPSHOT.war]
  Deploying [/var/lib/jenkins/workspace/web_demo_pipeline/target/web_demo-1.0-SNAPSHOT.war]
[Pipeline] &#125;
[Pipeline] // stage
[Pipeline] &#125;
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS
</code></pre>
<h4 id="Pipeline-Script-from-SCM"><a href="#Pipeline-Script-from-SCM" class="headerlink" title="Pipeline Script from SCM "></a><span style = "color:red">Pipeline Script from SCM </span></h4><p>åˆšæ‰æˆ‘ä»¬éƒ½æ˜¯ç›´æ¥åœ¨Jenkinsçš„UIç•Œé¢ç¼–å†™Pipelineä»£ç ï¼Œè¿™æ ·ä¸æ–¹ä¾¿è„šæœ¬ç»´æŠ¤ï¼Œå»ºè®®æŠŠPipelineè„šæœ¬æ”¾ åœ¨é¡¹ç›®ä¸­ï¼ˆä¸€èµ·è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼‰<br>1ï¼‰åœ¨é¡¹ç›®<strong>æ ¹ç›®å½•</strong>å»ºç«‹<strong>Jenkinsfile</strong>æ–‡ä»¶ï¼ŒæŠŠå†…å®¹å¤åˆ¶åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚æŠŠJenkinsfileä¸Šä¼ åˆ°Gitlab</p>
<pre><code class="java">Jenkinsfileã€åœ¨æ ¹ç›®å½•ä¸‹ã€‘

pipeline &#123;
    agent any
    stages &#123;
        stage(&#39;pull code&#39;) &#123;
            steps &#123;
                checkout scmGit(
                    branches: [[name: &#39;*/master&#39;]],
                    extensions: [],
                    userRemoteConfigs: [[
                        credentialsId: &#39;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&#39;,
                        url: &#39;http://192.168.200.132:82/lanyun_group/web_demo.git&#39;
                    ]]
                )
            &#125;
        &#125;
        stage(&#39;build project&#39;) &#123;
            steps &#123;
                sh &#39;mvn clean package&#39;
            &#125;
        &#125;
        stage(&#39;publish&#39;) &#123;
            steps &#123;
                deploy adapters: [tomcat8(alternativeDeploymentContext: &#39;&#39;, credentialsId: &#39;e847a130-29c3-4d0b-bf35-db8d00de7950&#39;, path: &#39;&#39;, url: &#39;http://192.168.200.131:8090/&#39;)], contextPath: null, war: &#39;target/*.war&#39;
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
<p> 2ï¼‰åœ¨é¡¹ç›®ä¸­å¼•ç”¨è¯¥<strong>æ–‡ä»¶</strong><br>åœ¨æµæ°´çº¿ä¸Š<br>å®šä¹‰<code>Pipeline script from SCM</code> â†’ é€‰æ‹©git â†’ å¡«å†™gitlabçš„urlå’Œå‡­è¯ â†’ è„šæœ¬è·¯å¾„<code>Jenkinsfile</code>(è¿™æ˜¯æˆ‘ä»¬ä¸Šä¼ çš„jenkinsfileé‡Œé¢åŒ…å«ç€æµæ°´çº¿ä»£ç çš„æ–‡ä»¶)</p>
<h4 id="Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚-1-å¸¸ç”¨çš„æ„å»ºè§¦å‘å™¨"><a href="#Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚-1-å¸¸ç”¨çš„æ„å»ºè§¦å‘å™¨" class="headerlink" title="Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚(1)-å¸¸ç”¨çš„æ„å»ºè§¦å‘å™¨"></a>Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚(1)-å¸¸ç”¨çš„æ„å»ºè§¦å‘å™¨</h4><p>Jenkinså†…ç½®4ç§æ„å»ºè§¦å‘å™¨ï¼š </p>
<ul>
<li>è§¦å‘è¿œç¨‹æ„å»º </li>
<li>å…¶ä»–å·¥ç¨‹æ„å»ºåè§¦å‘ï¼ˆ Build after other projects are buildï¼‰ </li>
<li>å®šæ—¶æ„å»ºï¼ˆ Build periodicallyï¼‰ </li>
<li>è½®è¯¢ SCMï¼ˆPoll SCMï¼‰</li>
</ul>
<h5 id="è§¦å‘è¿œç¨‹æ„å»º"><a href="#è§¦å‘è¿œç¨‹æ„å»º" class="headerlink" title="è§¦å‘è¿œç¨‹æ„å»º"></a>è§¦å‘è¿œç¨‹æ„å»º</h5><p>æ‰“å¼€<code>web_demo_pipeline</code>çš„é…ç½® é‡Œé¢çš„<code>Triggers</code> é€‰æ‹©<code>è§¦å‘è¿œç¨‹æ„å»º</code> èº«ä»½éªŒè¯ä»¤ç‰Œ(è¿™ä¸ªtokenæœ€å¥½æ˜¯åŠ å¯†çš„) ä¸‹é¢æœ‰ä¸ªè§¦å‘åœ°å€ï¼š</p>
<blockquote>
<p>Use the following URL to trigger build remotely: <code>JENKINS_URL</code>&#x2F;job&#x2F;web_demo_pipeline&#x2F;build?token&#x3D;TOKEN_NAME æˆ–è€… &#x2F;buildWithParameters?token&#x3D;TOKEN_NAME<br>Optionally append <code>&amp;cause=Cause+Text</code> to provide text that will be included in the recorded build cause.</p>
</blockquote>
<p>ä¸Šé¢åœ°å€é‡Œé¢çš„ï¼š<code>job/web_demo_pipeline/build?token=TOKEN_NAME</code><br>â†’ <code>http://192.168.200.129:8888/job/web_demo_pipeline/build?token=6666</code><br>åœ¨æµè§ˆå™¨è¾“å…¥ä¸Šè¿°åœ°å€ å›è½¦æ‰“å¼€ ä½ ä¼šå‘ç°å·²ç»è¿œç¨‹è§¦å‘äº†Jenkinsçš„æ„å»ºè¡Œä¸ºï¼ï¼</p>
<h5 id="å…¶ä»–å·¥ç¨‹æ„å»ºåè§¦å‘"><a href="#å…¶ä»–å·¥ç¨‹æ„å»ºåè§¦å‘" class="headerlink" title="å…¶ä»–å·¥ç¨‹æ„å»ºåè§¦å‘"></a>å…¶ä»–å·¥ç¨‹æ„å»ºåè§¦å‘</h5><p>1ï¼‰åˆ›å»ºpre_jobæµæ°´çº¿å·¥ç¨‹<br>2ï¼‰é…ç½®éœ€è¦è§¦å‘çš„å·¥ç¨‹</p>
<p>æ‰“å¼€<code>web_demo_pipeline</code>çš„é…ç½® é‡Œé¢çš„<code>Triggers</code> é€‰æ‹©<code>Build after other projects are built</code><br>æ–°å»ºitem â†’ åˆ›å»ºä¸€ä¸ª<code>pre_job</code>çš„è‡ªç”±é£æ ¼çš„å·¥ç¨‹ â†’ æ„å»ºExecute shell æ‰§è¡Œä¸€ä¸ªç®€å•çš„è„šæœ¬<br>å›åˆ°<code>web_demo_pipeline</code>å·¥ç¨‹ åœ¨<code>Triggers</code>é‡Œé¢é€‰æ‹©å‰ç½®å·¥ç¨‹<code>pre_job</code><br>æ­¤æ—¶å»æ„å»º<code>pre_job</code>ä½ ä¼šå‘ç° åœ¨æ„å»ºå®Œå <code>web_demo_pipeline</code>ä¹Ÿä¼šè¿›è¡Œè‡ªåŠ¨æ„å»º</p>
<h5 id="å®šæ—¶æ„å»º"><a href="#å®šæ—¶æ„å»º" class="headerlink" title="å®šæ—¶æ„å»º"></a>å®šæ—¶æ„å»º</h5><p>å®šæ—¶å­—ç¬¦ä¸²ä»å·¦å¾€å³åˆ†åˆ«ä¸ºï¼š åˆ† æ—¶ æ—¥ æœˆ å‘¨<br>ä¸€äº›å®šæ—¶è¡¨è¾¾å¼çš„ä¾‹å­ï¼š(Hä¸º0 å°±ä¸ºæ•´ç‚¹)</p>
<pre><code class="java">æ¯30åˆ†é’Ÿæ„å»ºä¸€æ¬¡ï¼šHä»£è¡¨å½¢å‚ H/30 * * * * 10:02 10:32
æ¯2ä¸ªå°æ—¶æ„å»ºä¸€æ¬¡: H H/2 * * *
æ¯å¤©çš„8ç‚¹ï¼Œ12ç‚¹ï¼Œ22ç‚¹ï¼Œä¸€å¤©æ„å»º3æ¬¡ï¼š (å¤šä¸ªæ—¶é—´ç‚¹ä¸­é—´ç”¨é€—å·éš”å¼€) 0 8,12,22 * * *
æ¯å¤©ä¸­åˆ12ç‚¹å®šæ—¶æ„å»ºä¸€æ¬¡ H 12 * * *
æ¯å¤©ä¸‹åˆ18ç‚¹å®šæ—¶æ„å»ºä¸€æ¬¡ H 18 * * *
åœ¨æ¯ä¸ªå°æ—¶çš„å‰åŠä¸ªå°æ—¶å†…çš„æ¯10åˆ†é’Ÿ H(0-29)/10 * * * *
æ¯ä¸¤å°æ—¶ä¸€æ¬¡ï¼Œæ¯ä¸ªå·¥ä½œæ—¥ä¸Šåˆ9ç‚¹åˆ°ä¸‹åˆ5ç‚¹(ä¹Ÿè®¸æ˜¯ä¸Šåˆ10:38ï¼Œä¸‹åˆ12:38ï¼Œä¸‹åˆ2:38ï¼Œä¸‹åˆ
4:38) H H(9-16)/2 * * 1-5
</code></pre>
<p>æ‰“å¼€<code>web_demo_pipeline</code>çš„é…ç½® é‡Œé¢çš„<code>Triggers</code> é€‰æ‹© <code>Build periodically</code> ç„¶åå¯ä»¥å†™æ—¶é—´cronè¡¨è¾¾å¼å³å¯</p>
<h5 id="è½®è¯¢SCM-ç‰ˆæœ¬æ§åˆ¶-ä¼ä¸šçº§ä¸æ¨èä½¿ç”¨"><a href="#è½®è¯¢SCM-ç‰ˆæœ¬æ§åˆ¶-ä¼ä¸šçº§ä¸æ¨èä½¿ç”¨" class="headerlink" title="è½®è¯¢SCM  [ç‰ˆæœ¬æ§åˆ¶] [ä¼ä¸šçº§ä¸æ¨èä½¿ç”¨]"></a><span style ="color:blue">è½®è¯¢SCM  [ç‰ˆæœ¬æ§åˆ¶] [ä¼ä¸šçº§ä¸æ¨èä½¿ç”¨]</span></h5><p>è½®è¯¢SCMï¼Œæ˜¯æŒ‡å®šæ—¶æ‰«ææœ¬åœ°ä»£ç ä»“åº“çš„ä»£ç æ˜¯å¦æœ‰å˜æ›´ï¼Œå¦‚æœä»£ç æœ‰å˜æ›´å°±è§¦å‘é¡¹ç›®æ„å»ºã€‚<br>æ‰“å¼€<code>web_demo_pipeline</code>çš„é…ç½® é‡Œé¢çš„<code>Triggers</code> é€‰æ‹©<code>Poll SCM</code></p>
<blockquote>
<h4 id="jenkinsçš„è½®è¯¢SCMçš„æ„å»ºåˆ°åº•æ˜¯è¿œç¨‹ä»“åº“å˜åŠ¨è§¦å‘-è¿˜æ˜¯-æœ¬åœ°ä»“åº“å˜åŠ¨è§¦å‘ï¼Ÿ"><a href="#jenkinsçš„è½®è¯¢SCMçš„æ„å»ºåˆ°åº•æ˜¯è¿œç¨‹ä»“åº“å˜åŠ¨è§¦å‘-è¿˜æ˜¯-æœ¬åœ°ä»“åº“å˜åŠ¨è§¦å‘ï¼Ÿ" class="headerlink" title="jenkinsçš„è½®è¯¢SCMçš„æ„å»ºåˆ°åº•æ˜¯è¿œç¨‹ä»“åº“å˜åŠ¨è§¦å‘ è¿˜æ˜¯ æœ¬åœ°ä»“åº“å˜åŠ¨è§¦å‘ï¼Ÿ"></a>jenkinsçš„è½®è¯¢SCMçš„æ„å»ºåˆ°åº•æ˜¯è¿œç¨‹ä»“åº“å˜åŠ¨è§¦å‘ è¿˜æ˜¯ æœ¬åœ°ä»“åº“å˜åŠ¨è§¦å‘ï¼Ÿ</h4><p><strong>Jenkins çš„â€œè½®è¯¢ SCMâ€æ˜¯é€šè¿‡è½®è¯¢</strong>è¿œç¨‹ Git ä»“åº“ï¼ˆå¦‚ GitLabã€GitHubï¼‰<strong>åˆ¤æ–­æ˜¯å¦æœ‰å˜æ›´</strong>ï¼Œä»è€Œå†³å®šæ˜¯å¦è§¦å‘æ„å»ºã€‚</p>
</blockquote>
<p>æ³¨æ„ï¼šè¿™æ¬¡æ„å»ºè§¦å‘å™¨ï¼Œ Jenkinsä¼šå®šæ—¶æ‰«ææ•´ä¸ªé¡¹ç›®çš„ä»£ç ï¼Œå¢å¤§ç³»ç»Ÿçš„å¼€é”€ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</p>
<h4 id="Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚-2-Git-hookè‡ªåŠ¨è§¦å‘æ„å»º-gitlabå°±ç”¨gitlabæ’ä»¶ï¼Œgithubåˆ™æ˜¯githubæ’ä»¶"><a href="#Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚-2-Git-hookè‡ªåŠ¨è§¦å‘æ„å»º-gitlabå°±ç”¨gitlabæ’ä»¶ï¼Œgithubåˆ™æ˜¯githubæ’ä»¶" class="headerlink" title="Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚(2)-Git hookè‡ªåŠ¨è§¦å‘æ„å»º(*)gitlabå°±ç”¨gitlabæ’ä»¶ï¼Œgithubåˆ™æ˜¯githubæ’ä»¶"></a>Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚(2)-Git hookè‡ªåŠ¨è§¦å‘æ„å»º(*)<del>gitlabå°±ç”¨gitlabæ’ä»¶ï¼Œgithubåˆ™æ˜¯githubæ’ä»¶</del></h4><p>å…ˆåœ¨Jenkinså¸‚åœºå®‰è£…<code>gitlab</code>æ’ä»¶</p>
<p>åˆšæ‰æˆ‘ä»¬çœ‹åˆ°åœ¨Jenkinsçš„å†…ç½®æ„å»ºè§¦å‘å™¨ä¸­ï¼Œè½®è¯¢SCMå¯ä»¥å®ç°Gitlabä»£ç æ›´æ–°ï¼Œé¡¹ç›®è‡ªåŠ¨æ„å»ºï¼Œä½†æ˜¯ è¯¥æ–¹æ¡ˆçš„æ€§èƒ½ä¸ä½³ã€‚é‚£æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ¡ˆå‘¢ï¼Ÿ æœ‰çš„ã€‚å°±æ˜¯<strong>åˆ©ç”¨Gitlabçš„webhookå®ç°ä»£ç pushåˆ°ä»“ åº“ï¼Œç«‹å³è§¦å‘é¡¹ç›®è‡ªåŠ¨æ„å»º</strong>ã€‚</p>
<blockquote>
<p><strong>è½®è¯¢SCMåŸç†</strong>ï¼šJenkins                    â†’(å‘é€å®šæ—¶è¯·æ±‚)â†’                Gitlabä»£ç å˜æ›´<br><strong>webhookåŸç†</strong>ï¼šGitlabä»£ç å˜æ›´      â†’(å‘é€æ„å»ºè¯·æ±‚)â†’                Jenkins</p>
</blockquote>
<p>æ‰“å¼€<code>web_demo_pipeline</code>çš„é…ç½® é‡Œé¢çš„<code>Triggers</code> é€‰æ‹©<code>Build when a change is pushed to GitLab. GitLab webhook URL: http://192.168.200.129:8888/project/web_demo_pipeline</code></p>
<p>â˜… è¦ç”¨rootè´¦å·å»GitLabå¼€é€šä¸€ä¸ªwebhookè§„åˆ™ â†’ ç‚¹å‡»ä¸Šæ–¹çš„å°é½¿è½® â†’ å³ä¾§<code>Settings</code>  â†’ Network â†’ å±•å¼€Outbound requests â†’ å‹¾é€‰<code>Allow requests to the local network from web hooks and services</code>å’Œ<code>Allow requests to the local network from system hooks</code>ä¿å­˜ â†’ åœ¨<code>web_demo</code>é¡¹ç›®ä¸­ â†’ Settings â†’ Integrations â†’ å¯ä»¥ç²˜è´´URL(è¿™é‡Œå°±æ˜¯åœ¨Jenkinsé‡Œé¢çš„<code>http://192.168.200.129:8888/project/web_demo_pipeline</code>) [æŠŠä»£ç pushåˆ°é¡¹ç›®é‡Œæ¥å°±ä¼šè§¦å‘è¿™ä¸ªurlè‡ªåŠ¨æ„å»º] â†’ Add webhook â†’ ä¸‹æ–¹å¯ä»¥è¿›è¡Œæµ‹è¯•test â†’ <code>push event</code> â†’â†“</p>
<p>è‹¥å‡ºç° åˆ™è¯æ˜gitlabæ˜¯æˆåŠŸ åªæ˜¯Jenkinséœ€è¦è®¤è¯è¯·æ±‚ å»Jenkinså¼€æ”¾æ¥æ”¶è¯·æ±‚çš„åŠŸèƒ½</p>
<pre><code class="xml">Hook executed successfully but returned HTTP 403 &lt;html&gt; &lt;head&gt; &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=ISO-8859-1&quot;/&gt; &lt;title&gt;Error 403 anonymous is missing the Job/Build permission&lt;/title&gt; &lt;/head&gt; &lt;body&gt;&lt;h2&gt;HTTP ERROR 403 anonymous is missing the Job/Build permission&lt;/h2&gt; &lt;table&gt; &lt;tr&gt;&lt;th&gt;URI:&lt;/th&gt;&lt;td&gt;/project/web_demo_pipeline&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt;&lt;th&gt;STATUS:&lt;/th&gt;&lt;td&gt;403&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt;&lt;th&gt;MESSAGE:&lt;/th&gt;&lt;td&gt;anonymous is missing the Job/Build permission&lt;/td&gt;&lt;/tr&gt; &lt;tr&gt;&lt;th&gt;SERVLET:&lt;/th&gt;&lt;td&gt;Stapler&lt;/td&gt;&lt;/tr&gt; &lt;/table&gt; &lt;hr/&gt;&lt;a href=&quot;https://jetty.org/&quot;&gt;Powered by Jetty:// 12.0.19&lt;/a&gt;&lt;hr/&gt; &lt;/body&gt; &lt;/html&gt;
</code></pre>
<p>Jenkinså¼€æ”¾æ¥æ”¶è¯·æ±‚ â†’ æ‰“å¼€ä¸»é¡µå¹¶è·Ÿéšè·¯å¾„<code>Dashboard â†’ Manage Jenkins â†’ System</code> æ‰¾åˆ° GitLab Enable authentication for â€˜&#x2F;projectâ€™ end-pointã€è¿™ä¸ªè¦åé€‰ å°±æ˜¯ä¸èƒ½é€‰é’© ä¸”é‡Œé¢çš„ä¸œè¥¿åˆ é™¤ã€‘ â†’ å†å»è¿›è¡Œæµ‹è¯•test â†’ <code>push event</code> å³å¯æˆåŠŸ<code>Hook executed successfully: HTTP 200</code></p>
<h4 id="Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚-3-Jenkinsçš„å‚æ•°åŒ–æ„å»º"><a href="#Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚-3-Jenkinsçš„å‚æ•°åŒ–æ„å»º" class="headerlink" title="Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚(3)-Jenkinsçš„å‚æ•°åŒ–æ„å»º"></a>Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚(3)-Jenkinsçš„å‚æ•°åŒ–æ„å»º</h4><p>æœ‰æ—¶åœ¨é¡¹ç›®æ„å»ºçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦**<u>æ ¹æ®ç”¨æˆ·çš„è¾“å…¥åŠ¨æ€ä¼ å…¥ä¸€äº›å‚æ•°</u>**ï¼Œä»è€Œå½±å“æ•´ä¸ªæ„å»ºç»“æœï¼Œè¿™æ—¶ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‚æ•°åŒ–æ„å»ºã€‚<br>Jenkinsæ”¯æŒéå¸¸ä¸°å¯Œçš„å‚æ•°ç±»å‹</p>
<blockquote>
<p>å¤§æ¦‚æ„æ€å°±æ˜¯ æˆ‘åœ¨é¡¹ç›®çš„jenkinsfileæ–‡ä»¶é‡Œé¢<br>steps {<br>    checkout scmGit(<br>        <em>branches</em>: [[<em>name</em>: â€˜*&#x2F;masterâ€™]],<br>        <em>extensions</em>: [],<br>        <em>userRemoteConfigs</em>: [[<br>            <em>credentialsId</em>: â€˜ca22e56f-0ecc-4fdc-965d-01e329a0b68aâ€™,<br>            <em>url</em>: â€˜<a target="_blank" rel="noopener" href="http://192.168.200.132:82/lanyun_group/web_demo.git&#39;">http://192.168.200.132:82/lanyun_group/web_demo.git&#39;</a><br>        ]]<br>    )<br>è¿™ä¸ªbranchesé‡Œé¢çš„ *&#x2F;masteræˆ‘è¦æ±‚æ˜¯è®©ç”¨æˆ·åŠ¨æ€è¾“å…¥å€¼ è€Œä¸æ˜¯å†™æ­»</p>
</blockquote>
<p>é¦–å…ˆè¦åœ¨é¡¹ç›®é‡Œé¢å¢åŠ ä¸€äº›å‚æ•° <code>web_demo_pipeline</code> é¡¹ç›®ä¸­ å¯ä»¥å…ˆæŠŠè§¦å‘å™¨çš„å€¼å–æ¶ˆæ‰ â†’ è¿›å…¥ä¸Šé¢çš„Generalçš„é…ç½® é€‰æ‹©<code>This project is parameterized</code> â†’ å¯ä»¥æ·»åŠ å‚æ•° â†’ åŠ å…¥<code>String Parameter</code>å‚æ•° â†’<br>è¾“å…¥ <u>åç§°ï¼šbranchï¼Œé»˜è®¤å€¼ï¼šmasterï¼Œæè¿°ï¼šè¯·è¾“å…¥ä¸€ä¸ªåˆ†æ”¯çš„åç§°</u> â†’ æ­¤æ—¶åœ¨å·¦ä¾§å°±ä¼šå‡ºç°ä¸€ä¸ª <code>Build with Parameters</code> â†’â†“</p>
<blockquote>
<p>pipeline {<br>    agent any<br>    stages {<br>        stage(â€˜pull codeâ€™) {<br>            steps {<br>                checkout scmGit(<br>                    branches: [[<span style = "color:red"><em>name</em>: â€˜<em>&#x2F;${branch}}â€™</span>]],<br>                    <em>extensions</em>: [],<br>                    <em>userRemoteConfigs</em>: [[<br>                        <em>credentialsId</em>: â€˜ca22e56f-0ecc-4fdc-965d-01e329a0b68aâ€™,<br>                        <em>url</em>: â€˜<a target="_blank" rel="noopener" href="http://192.168.200.132:82/lanyun_group/web_demo.git&#39;">http://192.168.200.132:82/lanyun_group/web_demo.git&#39;</a><br>                    ]]<br>                )<br>            }<br>        }<br>        stage(â€˜build projectâ€™) {<br>            steps {<br>                sh â€˜mvn clean packageâ€™<br>            }<br>        }<br>        stage(â€˜publishâ€™) {<br>            steps {<br>                deploy <em>adapters</em>: [tomcat8(<em>alternativeDeploymentContext</em>: â€˜â€™, <em>credentialsId</em>: â€˜e847a130-29c3-4d0b-bf35-db8d00de7950â€™, <em>path</em>: â€˜â€™, <em>url</em>: â€˜<a target="_blank" rel="noopener" href="http://192.168.200.131:8090/&#39;)]">http://192.168.200.131:8090/&#39;)]</a>, <em>contextPath</em>: <em>null</em>, <em>war</em>: â€˜target&#x2F;</em>.warâ€™<br>            }<br>        }<br>    }<br>}<br>ã€è¿™æ—¶ä½ åœ¨Jenkinsæ„å»ºæ—¶è¾“å…¥çš„å‚æ•°å°±å¯ä»¥å¯¹åº”ç€Jenkinsfileæ–‡ä»¶çš„åŠ¨æ€å‚æ•°è¿›è¡Œæ„å»º (åŠ¨æ€å€¼çº¢è‰²å·²æ ‡æ³¨)ã€‘â†’ éœ€è¦æŠŠjenkinsfileçš„ä»£ç pushåˆ°ä»“åº“é‡Œå»</p>
</blockquote>
<h4 id="Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚-4-é…ç½®é‚®ç®±æœåŠ¡å™¨å‘é€æ„å»ºç»“æœ"><a href="#Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚-4-é…ç½®é‚®ç®±æœåŠ¡å™¨å‘é€æ„å»ºç»“æœ" class="headerlink" title="Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚(4)-é…ç½®é‚®ç®±æœåŠ¡å™¨å‘é€æ„å»ºç»“æœ"></a>Jenkinsé¡¹ç›®æ„å»ºç»†èŠ‚(4)-é…ç½®é‚®ç®±æœåŠ¡å™¨å‘é€æ„å»ºç»“æœ</h4><p>å®‰è£…<code>Email Extension Template</code>æ’ä»¶</p>
<h5 id="Jenkinsè®¾ç½®é‚®ç®±ç›¸å…³å‚æ•°"><a href="#Jenkinsè®¾ç½®é‚®ç®±ç›¸å…³å‚æ•°" class="headerlink" title="Jenkinsè®¾ç½®é‚®ç®±ç›¸å…³å‚æ•°"></a>Jenkinsè®¾ç½®é‚®ç®±ç›¸å…³å‚æ•°</h5><p>Dashboard â†’ Manage Jenkins â†’ System â†’ <code>Extended E-mail Notification</code> â†’ QQé‚®ç®±ã€å®˜ç½‘ è´¦å·å®‰å…¨è®¾ç½®ã€‘æ‰“å¼€SMTPæœåŠ¡ æ‰¾åˆ° <strong>POP3&#x2F;SMTPæœåŠ¡</strong>ï¼Œç‚¹å‡»ã€Œå¼€å¯ã€â†’ å‹¾é€‰â€œå¼€å¯æœåŠ¡â€æ—è¾¹çš„å¤é€‰æ¡† â†’ ç”Ÿæˆ<strong>SMTP&#x2F;IMAP æˆæƒç å·²ç”Ÿæˆ</strong> â†’ <code>jitgujalhqtecadc</code> â†’ å›åˆ°Jenkins â†’ SMTP serverå¡«å†™ï¼š<code>smtp.qq.com</code>ï¼›ç«¯å£æ˜¯<code>465</code> â†’ Default user e-mail suffixï¼š<code>@qq.com</code>  ä¸‹é¢çš„ç”¨æˆ·åæ˜¯å‘ä»¶äºº å¯†ç æ˜¯æˆæƒç  ä½¿ç”¨SSLåè®®çš„è¯SMTPç«¯å£å°±æ˜¯465 â†’ Jenkins Location ç³»ç»Ÿç®¡ç†å‘˜é‚®ä»¶åœ°å€æ˜¯å‘ä»¶äººåœ°å€ </p>
<h5 id="å‡†å¤‡é‚®ä»¶å†…å®¹"><a href="#å‡†å¤‡é‚®ä»¶å†…å®¹" class="headerlink" title="å‡†å¤‡é‚®ä»¶å†…å®¹"></a>å‡†å¤‡é‚®ä»¶å†…å®¹</h5><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ç¼–å†™email.htmlï¼Œå¹¶æŠŠæ–‡ä»¶æ¨é€åˆ°Gitlabï¼Œå†…å®¹å¦‚ä¸‹ï¼šã€æ ¹ç›®å½•ä¸‹ã€‘<br>BUILD_NUMBERã€BUILD_STATUSç­‰ æ¥è‡ªäºJenkinsçš„å…¨å±€å˜é‡ </p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;$&#123;ENV, var=&quot;JOB_NAME&quot;&#125;-ç¬¬$&#123;BUILD_NUMBER&#125;æ¬¡æ„å»ºæ—¥å¿—&lt;/title&gt;
&lt;/head&gt;

&lt;body leftmargin=&quot;8&quot; marginwidth=&quot;0&quot; topmargin=&quot;8&quot; marginheight=&quot;4&quot;
      offset=&quot;0&quot;&gt;
&lt;table width=&quot;95%&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;
       style=&quot;font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif&quot;&gt;
    &lt;tr&gt;
        &lt;td&gt;(æœ¬é‚®ä»¶æ˜¯ç¨‹åºè‡ªåŠ¨ä¸‹å‘çš„ï¼Œè¯·å‹¿å›å¤ï¼)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;h2&gt;
            &lt;font color=&quot;#0000FF&quot;&gt;æ„å»ºç»“æœ - $&#123;BUILD_STATUS&#125;&lt;/font&gt;
        &lt;/h2&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;br /&gt;
            &lt;b&gt;&lt;font color=&quot;#0B610B&quot;&gt;æ„å»ºä¿¡æ¯&lt;/font&gt;&lt;/b&gt;
            &lt;hr size=&quot;2&quot; width=&quot;100%&quot; align=&quot;center&quot; /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;
            &lt;ul&gt;
                &lt;li&gt;é¡¹ç›®åç§°&amp;nbsp;ï¼š&amp;nbsp;$&#123;PROJECT_NAME&#125;&lt;/li&gt;
                &lt;li&gt;æ„å»ºç¼–å·&amp;nbsp;ï¼š&amp;nbsp;ç¬¬$&#123;BUILD_NUMBER&#125;æ¬¡æ„å»º&lt;/li&gt;
                &lt;li&gt;è§¦å‘åŸå› ï¼š&amp;nbsp;$&#123;CAUSE&#125;&lt;/li&gt;
                &lt;li&gt;æ„å»ºæ—¥å¿—ï¼š&amp;nbsp;&lt;a href=&quot;$&#123;BUILD_URL&#125;console&quot;&gt;$&#123;BUILD_URL&#125;console&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;æ„å»º&amp;nbsp;&amp;nbsp;Url&amp;nbsp;ï¼š&amp;nbsp;&lt;a href=&quot;$&#123;BUILD_URL&#125;&quot;&gt;$&#123;BUILD_URL&#125;&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;å·¥ä½œç›®å½•&amp;nbsp;ï¼š&amp;nbsp;&lt;a href=&quot;$&#123;PROJECT_URL&#125;ws&quot;&gt;$&#123;PROJECT_URL&#125;ws&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;é¡¹ç›®&amp;nbsp;&amp;nbsp;Url&amp;nbsp;ï¼š&amp;nbsp;&lt;a href=&quot;$&#123;PROJECT_URL&#125;&quot;&gt;$&#123;PROJECT_URL&#125;&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;b&gt;&lt;font color=&quot;#0B610B&quot;&gt;Changes Since Last
            Successful Build:&lt;/font&gt;&lt;/b&gt;
            &lt;hr size=&quot;2&quot; width=&quot;100%&quot; align=&quot;center&quot; /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;
            &lt;ul&gt;
                &lt;li&gt;å†å²å˜æ›´è®°å½• : &lt;a href=&quot;$&#123;PROJECT_URL&#125;changes&quot;&gt;$&#123;PROJECT_URL&#125;changes&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt; $&#123;CHANGES_SINCE_LAST_SUCCESS,reverse=true, format=&quot;Changes for Build #%n:&lt;br /&gt;%c&lt;br /&gt;&quot;,showPaths=true,changesFormat=&quot;&lt;pre&gt;[%a]&lt;br /&gt;%m&lt;/pre&gt;&quot;,pathFormat=&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;%p&quot;&#125;
        &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;b&gt;Failed Test Results&lt;/b&gt;
            &lt;hr size=&quot;2&quot; width=&quot;100%&quot; align=&quot;center&quot; /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;pre
                style=&quot;font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif&quot;&gt;$FAILED_TESTS&lt;/pre&gt;
            &lt;br /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;b&gt;&lt;font color=&quot;#0B610B&quot;&gt;æ„å»ºæ—¥å¿— (æœ€å 100è¡Œ):&lt;/font&gt;&lt;/b&gt;
            &lt;hr size=&quot;2&quot; width=&quot;100%&quot; align=&quot;center&quot; /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;textarea cols=&quot;80&quot; rows=&quot;30&quot; readonly=&quot;readonly&quot;
                      style=&quot;font-family: Courier New&quot;&gt;$&#123;BUILD_LOG, maxLines=100&#125;&lt;/textarea&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>postçš„å†…å®¹å¯ä»¥ç”¨æµæ°´çº¿è¯­æ³•ç”Ÿæˆ â†’ å®Œæˆä¹‹åç‚¹å‡»ç‰‡æ®µç”Ÿæˆå™¨ ç”Ÿæˆä¸€ä¸ª <code>emailext: Extended Email</code> çš„ä»£ç ç‰‡æ®µ</p>
<pre><code class="java">pipeline &#123;
    agent any
    stages &#123;
        stage(&#39;pull code&#39;) &#123;
            steps &#123;
                checkout scmGit(
                    branches: [[name: &#39;*/$&#123;branch&#125;&#39;]],
                    extensions: [],
                    userRemoteConfigs: [[
                        credentialsId: &#39;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&#39;,
                        url: &#39;http://192.168.200.132:82/lanyun_group/web_demo.git&#39;
                    ]]
                )
            &#125;
        &#125;
        stage(&#39;build project&#39;) &#123;
            steps &#123;
                sh &#39;mvn clean package&#39;
            &#125;
        &#125;
        stage(&#39;publish&#39;) &#123;
            steps &#123;
                deploy adapters: [tomcat8(alternativeDeploymentContext: &#39;&#39;, credentialsId: &#39;e847a130-29c3-4d0b-bf35-db8d00de7950&#39;, path: &#39;&#39;, url: &#39;http://192.168.200.131:8090/&#39;)], contextPath: null, war: &#39;target/*.war&#39;
            &#125;
        &#125;
    &#125;
    post&#123;
        always&#123;
             emailext(
                 subject: &#39;æ„å»ºé€šçŸ¥ï¼š$&#123;PROJECT_NAME&#125; - Build # $&#123;BUILD_NUMBER&#125; - $&#123;BUILD_STATUS&#125;!&#39;,
                 body: &#39;$&#123;FILE,path=&quot;email.html&quot;&#125;&#39;,
                 to: &#39;2523419709@qq.com&#39;
             )
        &#125;
    &#125;
&#125;
</code></pre>
<p>PSï¼šé‚®ä»¶ç›¸å…³å…¨å±€å‚æ•°å‚è€ƒåˆ—è¡¨ï¼š<br>ç³»ç»Ÿè®¾ç½®-&gt;Extended E-mail Notification-&gt;Content Token Referenceï¼Œç‚¹å‡»æ—è¾¹çš„?å·</p>
<h4 id="Jenkins-SonarQubeä»£ç å®¡æŸ¥-1-å®‰è£…SonarQube"><a href="#Jenkins-SonarQubeä»£ç å®¡æŸ¥-1-å®‰è£…SonarQube" class="headerlink" title="Jenkins+SonarQubeä»£ç å®¡æŸ¥(1) - å®‰è£…SonarQube"></a>Jenkins+SonarQubeä»£ç å®¡æŸ¥(1) - å®‰è£…SonarQube</h4><h5 id="SonaQubeç®€ä»‹"><a href="#SonaQubeç®€ä»‹" class="headerlink" title="SonaQubeç®€ä»‹"></a>SonaQubeç®€ä»‹</h5><p>SonarQube æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†ä»£ç è´¨é‡çš„å¼€æ”¾å¹³å°ï¼Œå¯ä»¥å¿«é€Ÿçš„å®šä½ä»£ç ä¸­æ½œåœ¨çš„æˆ–è€…æ˜æ˜¾çš„é”™è¯¯ã€‚ç›®å‰ æ”¯æŒjava,C#,C&#x2F;C++,Python,PL&#x2F;SQL,Cobol,JavaScrip,Groovyç­‰äºŒåå‡ ç§ç¼–ç¨‹è¯­è¨€çš„ä»£ç è´¨é‡ç®¡ç†ä¸æ£€ æµ‹ã€‚</p>
<p>å®˜ç½‘ï¼š <a target="_blank" rel="noopener" href="https://www.sonarqube.org/">https://www.sonarqube.org/</a></p>
<h5 id="ç¯å¢ƒè¦æ±‚"><a href="#ç¯å¢ƒè¦æ±‚" class="headerlink" title="ç¯å¢ƒè¦æ±‚"></a>ç¯å¢ƒè¦æ±‚</h5><table>
<thead>
<tr>
<th align="center">è½¯ä»¶</th>
<th align="center">æœåŠ¡å™¨</th>
<th align="center">ç‰ˆæœ¬</th>
</tr>
</thead>
<tbody><tr>
<td align="center">JDK</td>
<td align="center">192.168.200.129</td>
<td align="center">1.8</td>
</tr>
<tr>
<td align="center">MySQL</td>
<td align="center">192.168.200.129</td>
<td align="center">5.7</td>
</tr>
<tr>
<td align="center">SonarQube</td>
<td align="center">192.168.200.129</td>
<td align="center">6.7.4</td>
</tr>
</tbody></table>
<h5 id="å®‰è£…SonarQube"><a href="#å®‰è£…SonarQube" class="headerlink" title="å®‰è£…SonarQube"></a>å®‰è£…SonarQube</h5><p>1ï¼‰å®‰è£…MySQLï¼ˆå·²å®Œæˆï¼‰<br>2ï¼‰å®‰è£…SonarQube</p>
<blockquote>
<p>ä½¿ç”¨5.7æ•°æ®åº“<br>å…ˆåˆ é™¤ä»¥å‰çš„</p>
<h3 id="å»ºè®®æ“ä½œï¼š"><a href="#å»ºè®®æ“ä½œï¼š" class="headerlink" title="å»ºè®®æ“ä½œï¼š"></a>å»ºè®®æ“ä½œï¼š</h3><ol>
<li><strong>å…ˆæŠŠå¤šä½™æˆ–å†²çªçš„æ–‡ä»¶ä¸´æ—¶å¤‡ä»½ç§»åŠ¨ä¸€ä¸‹ï¼Œé¿å…yumæ··ä¹±</strong></li>
</ol>
<pre><code>bashå¤åˆ¶ç¼–è¾‘sudo mv /etc/yum.repos.d/mysql-community.repo.rpmsave /root/
sudo mv /etc/yum.repos.d/mysql57.repo /root/
</code></pre>
<ol>
<li><strong>åªä¿ç•™ <code>mysql-community.repo</code> è¿™ä¸ª repo æ–‡ä»¶ï¼Œç¡®ä¿å®ƒå†…å®¹æ­£ç¡®ï¼ˆä½ å¯ä»¥ç”¨<code>cat</code>çœ‹ä¸‹å†…å®¹ï¼‰</strong></li>
</ol>
<pre><code>cat /etc/yum.repos.d/mysql-community.repo
</code></pre>
<ol>
<li><strong>æ¸…ç†ç¼“å­˜ï¼Œé‡æ–°ç”Ÿæˆ</strong></li>
</ol>
<pre><code>sudo yum clean all
sudo yum makecache
</code></pre>
<ol>
<li><strong>å°è¯•å®‰è£…mysql 5.7</strong></li>
</ol>
<pre><code>sudo yum install mysql-community-server
</code></pre>
<hr>
<h3 id="è§£å†³æ–¹æ¡ˆï¼šç”¨ç¬¦åˆç­–ç•¥çš„å¯†ç å…ˆæ”¹ï¼Œå†é™ä½ç­–ç•¥"><a href="#è§£å†³æ–¹æ¡ˆï¼šç”¨ç¬¦åˆç­–ç•¥çš„å¯†ç å…ˆæ”¹ï¼Œå†é™ä½ç­–ç•¥" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼šç”¨ç¬¦åˆç­–ç•¥çš„å¯†ç å…ˆæ”¹ï¼Œå†é™ä½ç­–ç•¥"></a>è§£å†³æ–¹æ¡ˆï¼šç”¨ç¬¦åˆç­–ç•¥çš„å¯†ç å…ˆæ”¹ï¼Œå†é™ä½ç­–ç•¥</h3><ol>
<li><strong>ç”¨ä¸€ä¸ªç¬¦åˆå¤æ‚åº¦çš„å¯†ç å…ˆæ”¹å¯†ç </strong>ï¼Œä¾‹å¦‚ï¼š</li>
</ol>
<pre><code>sql


å¤åˆ¶ç¼–è¾‘
ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;Root@12345&#39;;
</code></pre>
<ol>
<li><strong>ç™»å½•æˆåŠŸåé™ä½å¯†ç ç­–ç•¥ï¼š</strong></li>
</ol>
<pre><code>sqlå¤åˆ¶ç¼–è¾‘SET GLOBAL validate_password_policy=LOW;
SET GLOBAL validate_password_length=1;
</code></pre>
<ol>
<li><strong>å†ä¿®æ”¹ä¸ºä½ æƒ³è¦çš„ç®€å•å¯†ç ï¼ˆæ¯”å¦‚<code>root</code>ï¼‰ï¼š</strong></li>
</ol>
<pre><code>sql


å¤åˆ¶ç¼–è¾‘
ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;root&#39;;
</code></pre>
<ol>
<li><strong>åˆ·æ–°æƒé™</strong></li>
</ol>
<pre><code>FLUSH PRIVILEGES;
</code></pre>
</blockquote>
<p>åœ¨mysqlåˆ›å»ºsonaræ•°æ®åº“</p>
<blockquote>
<h3 id="å¯åŠ¨-MySQL-æœåŠ¡ï¼ˆå¦‚æœæ²¡å¯åŠ¨ï¼‰"><a href="#å¯åŠ¨-MySQL-æœåŠ¡ï¼ˆå¦‚æœæ²¡å¯åŠ¨ï¼‰" class="headerlink" title="å¯åŠ¨ MySQL æœåŠ¡ï¼ˆå¦‚æœæ²¡å¯åŠ¨ï¼‰"></a>å¯åŠ¨ MySQL æœåŠ¡ï¼ˆå¦‚æœæ²¡å¯åŠ¨ï¼‰</h3><pre><code>systemctl start mysqld
</code></pre>
<p>å¯åŠ¨åå†æ¬¡æ£€æŸ¥çŠ¶æ€ï¼š</p>
<pre><code>systemctl status mysqld
</code></pre>
<p><code>mysql -uroot -p</code><br>è´¦å·å¯†ç æ˜¯ï¼šroot</p>
</blockquote>
<pre><code class="mysql">mysql&gt; create database sonar;

mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sonar              |
| sys                |
+--------------------+
5 rows in set (0.07 sec)
</code></pre>
<h5 id="è§£å‹sonarï¼Œå¹¶è®¾ç½®æƒé™"><a href="#è§£å‹sonarï¼Œå¹¶è®¾ç½®æƒé™" class="headerlink" title="è§£å‹sonarï¼Œå¹¶è®¾ç½®æƒé™"></a>è§£å‹sonarï¼Œå¹¶è®¾ç½®æƒé™</h5><blockquote>
<p>yum install unzip<br>unzip sonarqube-6.7.4.zip                       è§£å‹<br>mkdir &#x2F;opt&#x2F;sonar                                       åˆ›å»ºç›®å½•<br>mv sonarqube-6.7.4&#x2F;* &#x2F;opt&#x2F;sonar          ç§»åŠ¨æ–‡ä»¶<br>useradd sonar                                           <strong>åˆ›å»ºsonarç”¨æˆ·</strong>ï¼Œå¿…é¡»sonarç”¨äºå¯åŠ¨ï¼Œå¦åˆ™æŠ¥é”™ </p>
<p>chown -R sonar. &#x2F;opt&#x2F;sonar                    æ›´æ”¹sonarç›®å½•åŠæ–‡ä»¶æƒé™</p>
<p>[root@localhost ~]# cd &#x2F;opt&#x2F;sonar<br>[root@localhost sonar]# ll<br>æ€»ç”¨é‡ 12<br>drwxr-xr-x. 8 sonar sonar  136 5æœˆ  30 2018 bin<br>drwxr-xr-x. 2 sonar sonar   50 5æœˆ  30 2018 conf<br>-rw-râ€“râ€“. 1 sonar sonar 7651 5æœˆ  30 2018 COPYING<br>drwxr-xr-x. 2 sonar sonar   24 5æœˆ  30 2018 data<br>drwxr-xr-x. 7 sonar sonar  150 5æœˆ  30 2018 elasticsearch<br>drwxr-xr-x. 4 sonar sonar   40 5æœˆ  30 2018 extensions<br>drwxr-xr-x. 9 sonar sonar  140 5æœˆ  30 2018 lib<br>drwxr-xr-x. 2 sonar sonar    6 5æœˆ  30 2018 logs<br>drwxr-xr-x. 2 sonar sonar   24 5æœˆ  30 2018 temp<br>drwxr-xr-x. 9 sonar sonar 4096 5æœˆ  30 2018 web</p>
</blockquote>
<h5 id="ä¿®æ”¹sonaré…ç½®æ–‡ä»¶æ•°æ®åº“è¿æ¥ä¿¡æ¯"><a href="#ä¿®æ”¹sonaré…ç½®æ–‡ä»¶æ•°æ®åº“è¿æ¥ä¿¡æ¯" class="headerlink" title="ä¿®æ”¹sonaré…ç½®æ–‡ä»¶æ•°æ®åº“è¿æ¥ä¿¡æ¯"></a>ä¿®æ”¹sonaré…ç½®æ–‡ä»¶<del>æ•°æ®åº“è¿æ¥ä¿¡æ¯</del></h5><blockquote>
<p>[root@localhost opt]# cd sonar<br>[root@localhost sonar]# cd conf<br>[root@localhost conf]# vi sonar.properties</p>
<p>||          ||                   ||                  ||         </p>
<pre><code class="java">......
sonar.jdbc.username=root
sonar.jdbc.password=root
......
sonar.jdbc.url=jdbc:mysql://127.0.0.1:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true&amp;useConfigs=maxPerformance&amp;useSSL=false ã€è¿™é‡Œæ‰“å¼€æ³¨é‡Šã€‘

æ³¨æ„ï¼šsonaré»˜è®¤ç›‘å¬9000ç«¯å£ï¼Œå¦‚æœ9000ç«¯å£è¢«å ç”¨ï¼Œéœ€è¦æ›´æ”¹ 
å¦‚æœè¦æ”¹ç«¯å£ åœ¨è¿™é‡Œï¼š
sonar.web.port=9999

</code></pre>
</blockquote>
<h6 id="å¯åŠ¨sonar-129"><a href="#å¯åŠ¨sonar-129" class="headerlink" title="å¯åŠ¨sonar 129"></a>å¯åŠ¨sonar 129</h6><blockquote>
<p>[root@localhost bin]# pwd<br>&#x2F;opt&#x2F;sonar&#x2F;bin<br>cd &#x2F;opt&#x2F;sonar&#x2F;bin</p>
</blockquote>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š<code>vi /opt/sonar/conf/sonar.properties</code><br><span style ="color:red"><strong>é‡å¯sonar</strong></span>ï¼š<code>sudo -u sonar /opt/sonar/bin/linux-x86-64/sonar.sh restart</code> â˜…â˜…  [JenkinsæœåŠ¡]</p>
<blockquote>
<h5 id="å®æ—¶è·Ÿè¸ªæœ€æ–°æ—¥å¿—è¾“å‡ºï¼ˆæ¨èç”¨äºè°ƒè¯•å¯åŠ¨æˆ–è¿è¡Œæ—¶çŠ¶æ€ï¼‰"><a href="#å®æ—¶è·Ÿè¸ªæœ€æ–°æ—¥å¿—è¾“å‡ºï¼ˆæ¨èç”¨äºè°ƒè¯•å¯åŠ¨æˆ–è¿è¡Œæ—¶çŠ¶æ€ï¼‰" class="headerlink" title="å®æ—¶è·Ÿè¸ªæœ€æ–°æ—¥å¿—è¾“å‡ºï¼ˆæ¨èç”¨äºè°ƒè¯•å¯åŠ¨æˆ–è¿è¡Œæ—¶çŠ¶æ€ï¼‰"></a>å®æ—¶è·Ÿè¸ªæœ€æ–°æ—¥å¿—è¾“å‡ºï¼ˆæ¨èç”¨äºè°ƒè¯•å¯åŠ¨æˆ–è¿è¡Œæ—¶çŠ¶æ€ï¼‰</h5><p>tail -f &#x2F;opt&#x2F;sonar&#x2F;logs&#x2F;sonar.log<br>tail -f &#x2F;opt&#x2F;sonar&#x2F;logs&#x2F;web.log<br>tail -f &#x2F;opt&#x2F;sonar&#x2F;logs&#x2F;es.log</p>
<h5 id="æŸ¥çœ‹æ—¥å¿—æœ«å°¾100æ¡å†…å®¹ï¼ˆå¿«é€ŸæŸ¥çœ‹æœ€è¿‘æ—¥å¿—ï¼‰"><a href="#æŸ¥çœ‹æ—¥å¿—æœ«å°¾100æ¡å†…å®¹ï¼ˆå¿«é€ŸæŸ¥çœ‹æœ€è¿‘æ—¥å¿—ï¼‰" class="headerlink" title="æŸ¥çœ‹æ—¥å¿—æœ«å°¾100æ¡å†…å®¹ï¼ˆå¿«é€ŸæŸ¥çœ‹æœ€è¿‘æ—¥å¿—ï¼‰"></a>æŸ¥çœ‹æ—¥å¿—æœ«å°¾100æ¡å†…å®¹ï¼ˆå¿«é€ŸæŸ¥çœ‹æœ€è¿‘æ—¥å¿—ï¼‰</h5><p>tail -n 100 &#x2F;opt&#x2F;sonar&#x2F;logs&#x2F;sonar.log<br>tail -n 100 &#x2F;opt&#x2F;sonar&#x2F;logs&#x2F;web.log<br>tail -n 100 &#x2F;opt&#x2F;sonar&#x2F;logs&#x2F;es.log</p>
<h5 id="æŸ¥çœ‹æ•´ä¸ªæ—¥å¿—æ–‡ä»¶å¤§å°å’Œæƒé™"><a href="#æŸ¥çœ‹æ•´ä¸ªæ—¥å¿—æ–‡ä»¶å¤§å°å’Œæƒé™" class="headerlink" title="æŸ¥çœ‹æ•´ä¸ªæ—¥å¿—æ–‡ä»¶å¤§å°å’Œæƒé™"></a>æŸ¥çœ‹æ•´ä¸ªæ—¥å¿—æ–‡ä»¶å¤§å°å’Œæƒé™</h5><p>ls -lh &#x2F;opt&#x2F;sonar&#x2F;logs&#x2F;*.log</p>
</blockquote>
<p>è®¿é—®<strong>SonarQube</strong></p>
<p>[192.168.200.129] (<a target="_blank" rel="noopener" href="http://192.168.200.129:9999/">http://192.168.200.129:9999/</a>)</p>
<p><code>è´¦å·å¯†ç ï¼šadmin admin</code><br>ç”Ÿæˆäº†ä¸€ä¸ªtokenï¼š<code>sonar: d30033c63973bd4183b6015995dbb513627c6f59</code></p>
<blockquote>
<p><span style = "color:red"><strong>å¯åŠ¨å‘½ä»¤æ€»ç»“ï¼š</strong></span><br>[192.168.200.132] GitLabï¼šgitlab-ctl restart<br><a target="_blank" rel="noopener" href="http://192.168.200.132:82/lanyun_group/web_demo">lanyun_group &#x2F; web_demo Â· GitLab</a><br>[192.168.200.131] Tomcatï¼š&#x2F;opt&#x2F;tomcat&#x2F;bin&#x2F;startup.sh<br><a target="_blank" rel="noopener" href="http://192.168.200.131:8090/web_demo-1.0-SNAPSHOT/">æ¼”ç¤ºé¡¹ç›®ä¸»é¡µ</a></p>
<p>[192.168.200.129] Jenkinsï¼šsystemctl start jenkins<br><a target="_blank" rel="noopener" href="http://192.168.200.129:8888/login?from=/job/web_demo_pipeline/">ç™»å½• - Jenkins</a><br>[192.168.200.129] SonarQubeï¼šsudo -u sonar &#x2F;opt&#x2F;sonar&#x2F;bin&#x2F;linux-x86-64&#x2F;sonar.sh restart<br><a target="_blank" rel="noopener" href="http://192.168.200.129:9999/about">192.168.200.129</a></p>
</blockquote>
<h3 id="Jenkins-SonarQubeä»£ç å®¡æŸ¥-2-å®ç°ä»£ç å®¡æŸ¥"><a href="#Jenkins-SonarQubeä»£ç å®¡æŸ¥-2-å®ç°ä»£ç å®¡æŸ¥" class="headerlink" title="Jenkins+SonarQubeä»£ç å®¡æŸ¥(2) - å®ç°ä»£ç å®¡æŸ¥"></a>Jenkins+SonarQubeä»£ç å®¡æŸ¥(2) - å®ç°ä»£ç å®¡æŸ¥</h3><p>å®¡æŸ¥æµç¨‹ï¼š</p>
<blockquote>
<p>Jenkins â†’(è°ƒç”¨)â†’ Sonar-Scanner â†’(æäº¤å®¡æŸ¥ç»“æœ)â†’ SonarQube â†’(ä¿å­˜å®¡æŸ¥ç»“æœ)â†’ MySQLæ•°æ®åº“</p>
</blockquote>
<h5 id="å®‰è£…SonarQube-Scanneræ’ä»¶"><a href="#å®‰è£…SonarQube-Scanneræ’ä»¶" class="headerlink" title="å®‰è£…SonarQube Scanneræ’ä»¶"></a>å®‰è£…SonarQube Scanneræ’ä»¶</h5><p>æ‰“å¼€Jenkinsçš„å…¨å±€é…ç½® â†’ <strong>SonarQube Servers</strong> â†’ Add SonarQube â†’ Nameï¼šsonarqubeï¼›Server URLï¼š<a target="_blank" rel="noopener" href="http://192.168.200.129:9999/">http://192.168.200.129:9999/</a> â†’ æ–°å»ºä¸€ä¸ªè¯ä¹¦[Manage Jenkins â†’ Credentials â†’ System â†’ å…¨å±€æ·»åŠ  â†’ ç±»å‹é€‰æ‹©<code>Secret text</code> ï¼›Secretæ˜¯ä¹‹å‰å¤åˆ¶åˆ°çš„tokenå­—ç¬¦ä¸² ï¼›æè¿°ï¼šsonarqube-auth] â†’ Server authentication tokené€‰æ‹©åˆšåˆšåˆ›å»ºçš„sonarqube-auth</p>
<h5 id="SonarQube-å…³é—­å®¡æŸ¥ç»“æœä¸Šä¼ åˆ°SCMåŠŸèƒ½"><a href="#SonarQube-å…³é—­å®¡æŸ¥ç»“æœä¸Šä¼ åˆ°SCMåŠŸèƒ½" class="headerlink" title="SonarQube å…³é—­å®¡æŸ¥ç»“æœä¸Šä¼ åˆ°SCMåŠŸèƒ½"></a>SonarQube å…³é—­å®¡æŸ¥ç»“æœä¸Šä¼ åˆ°SCMåŠŸèƒ½</h5><p>[General Settings - Administration] (<a target="_blank" rel="noopener" href="http://192.168.200.129:9999/admin/settings?category=scm">http://192.168.200.129:9999/admin/settings?category=scm</a>) ä¸Šæ–¹çš„Administration â†’ å·¦ä¾§çš„SCM â†’ ç¬¬ä¸€ä¸ªæ‰“å¼€SCN Sensor</p>
<p>å›åˆ°Jenkinsçš„<code>web_demo_freestyle</code>é¡¹ç›®ç‚¹å‡»æ„å»º ä¸‹æ–¹çš„Build Stepsä¸‹é¢çš„<code>å¢åŠ æ„å»ºæ­¥éª¤</code> é€‰æ‹©<code>Execute SonarQube Scanner</code> (è¿™é‡Œè¦åœ¨å»Toolsé‡Œå®‰è£…é…ç½® SonarQube Scanner å®‰è£… â†’ Name:sonar-scannerï¼›Install automaticallyï¼š<u>SonarQube Scanner 4.2.0.1873</u>) â†’ è¿™é‡Œçš„jdkæ˜¯æ ¹æ®Jenkinsçš„jdké…ç½®çš„ â†’ (Path to project propertiesè¿™ä¸ªå¯ä»¥åœ¨é¡¹ç›®ä¸‹æ ä¹Ÿå¯ä»¥ç”¨Analysis properties å±æ€§æ”¾åœ¨å‰ç«¯uiç•Œé¢é‡Œé¢) è¿™é‡Œé€‰æ‹©<code>Analysic properties</code>â†’â†“</p>
<pre><code class="yaml"># must be unique in a given SonarQube instance
sonar.projectKey=web_demo_freestyle
# this is the name and version displayed in the SonarQube UI. Was mandatory 
prior to SonarQube 6.1.
sonar.projectName=web_demo_freestyle
sonar.projectVersion=1.0
 # Path is relative to the sonar-project.properties file. Replace &quot;\&quot; by &quot;/&quot; on 
Windows.
 # This property is optional if sonar.modules is set.
 sonar.sources=.
 sonar.exclusions=**/test/**,**/target/**
 sonar.java.source=1.8
 sonar.java.target=1.8
 # Encoding of the source code. Default is default system encoding
 sonar.sourceEncoding=UTF-8
</code></pre>
<p>â†’ åº”ç”¨ä¿å­˜ + é‡æ–°æ„å»º </p>
<p>ç°åœ¨æœ‰ä¸ªé—®é¢˜å°±æ˜¯æˆ‘Jenkinsæ˜¯2.504.2 ç„¶åjdkæ˜¯17 æˆ‘ä¸æƒ³æ¢jdkçš„æƒ…å†µä¸‹å°±è¦å» </p>
<pre><code class="yaml">Build Stepsé‡Œé¢çš„æ‰§è¡Œè„šæœ¬

echo &quot;å¼€å§‹è¿›è¡Œç¼–è¯‘æ„å»º&quot;
mvn clean package
echo &quot;ç¼–è¯‘æ„å»ºç»“æŸ&quot;

# è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œç»™sonar-scannerçš„JVMä¼ å‚æ•°ï¼Œè§£å†³Java17æ¨¡å—è®¿é—®é—®é¢˜
export SONAR_SCANNER_OPTS=&quot;--add-opens=java.base/java.lang=ALL-UNNAMED \
--add-opens=java.base/java.lang.reflect=ALL-UNNAMED \
--add-opens=java.base/java.io=ALL-UNNAMED&quot;

# æ‰§è¡ŒSonaræ‰«æ
/var/lib/jenkins/tools/hudson.plugins.sonar.SonarRunnerInstallation/sonar-scanner/bin/sonar-scanner \
  -Dsonar.projectKey=web_demo_freestyle \
  -Dsonar.host.url=http://192.168.200.129:9999 \
  -Dsonar.sources=. \
  -Dsonar.exclusions=**/test/**,**/target/** \
  -Dsonar.java.source=1.8 \
  -Dsonar.java.target=1.8

echo &quot;SonarQubeæ‰«æç»“æŸ&quot;
</code></pre>
<blockquote>
<p>æ‰“å¼€idea jenkinsfileæ–‡ä»¶</p>
<pre><code class="yaml">pipeline &#123;
 agent any
 stages &#123;
     stage(&#39;pull code&#39;) &#123;
         steps &#123;
             checkout scmGit(
                 branches: [[name: &quot;*/$&#123;branch&#125;&quot;]],
                 extensions: [],
                 userRemoteConfigs: [[
                     credentialsId: &#39;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&#39;,
                     url: &#39;http://192.168.200.132:82/lanyun_group/web_demo.git&#39;
                 ]]
             )
         &#125;
     &#125;
     stage(&#39;build project&#39;) &#123;
         steps &#123;
             sh &#39;mvn clean package&#39;
         &#125;
     &#125;
     stage(&#39;sonarqube scan&#39;) &#123;
         environment &#123;
             // ä¼ é€’ç»™sonar-scanner JVMçš„å¯åŠ¨å‚æ•°ï¼Œè§£å†³æ¨¡å—è®¿é—®é™åˆ¶
             SONAR_SCANNER_OPTS = &#39;--add-opens=java.base/java.lang=ALL-UNNAMED &#39; +
                                  &#39;--add-opens=java.base/java.lang.reflect=ALL-UNNAMED &#39; +
                                  &#39;--add-opens=java.base/java.io=ALL-UNNAMED&#39;
         &#125;
         steps &#123;
             sh &#39;&#39;&#39;
             /var/lib/jenkins/tools/hudson.plugins.sonar.SonarRunnerInstallation/sonar-scanner/bin/sonar-scanner \
               -Dsonar.projectKey=web_demo_freestyle \
               -Dsonar.host.url=http://192.168.200.129:9999 \
               -Dsonar.sources=. \
               -Dsonar.exclusions=**/test/**,**/target/** \
               -Dsonar.java.source=1.8 \
               -Dsonar.java.target=1.8
             &#39;&#39;&#39;
         &#125;
     &#125;
     stage(&#39;publish&#39;) &#123;
         steps &#123;
             deploy adapters: [tomcat8(
                 alternativeDeploymentContext: &#39;&#39;, 
                 credentialsId: &#39;e847a130-29c3-4d0b-bf35-db8d00de7950&#39;, 
                 path: &#39;&#39;, 
                 url: &#39;http://192.168.200.131:8090/&#39;
             )], contextPath: null, war: &#39;target/*.war&#39;
         &#125;
     &#125;
 &#125;
 post &#123;
     always &#123;
         emailext(
             subject: &#39;æ„å»ºé€šçŸ¥ï¼š$&#123;PROJECT_NAME&#125; - Build # $&#123;BUILD_NUMBER&#125; - $&#123;BUILD_STATUS&#125;!&#39;,
             body: &#39;$&#123;FILE,path=&quot;email.html&quot;&#125;&#39;,
             to: &#39;2523419709@qq.com&#39;
         )
     &#125;
 &#125;
&#125;
</code></pre>
<h3 id="âœ…-æ–¹æ³•ä¸€ï¼šç¼–è¾‘-SonarScanner-çš„é…ç½®æ–‡ä»¶ï¼ˆæœ€å¯é ï¼‰"><a href="#âœ…-æ–¹æ³•ä¸€ï¼šç¼–è¾‘-SonarScanner-çš„é…ç½®æ–‡ä»¶ï¼ˆæœ€å¯é ï¼‰" class="headerlink" title="âœ… æ–¹æ³•ä¸€ï¼šç¼–è¾‘ SonarScanner çš„é…ç½®æ–‡ä»¶ï¼ˆæœ€å¯é ï¼‰"></a>âœ… æ–¹æ³•ä¸€ï¼šç¼–è¾‘ SonarScanner çš„é…ç½®æ–‡ä»¶ï¼ˆæœ€å¯é ï¼‰</h3><p>ç¼–è¾‘ Jenkins ä¸­è‡ªåŠ¨ä¸‹è½½çš„ <code>sonar-scanner</code> çš„ JVM å¯åŠ¨å‚æ•°é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="mysql">sudo vi /var/lib/jenkins/tools/hudson.plugins.sonar.SonarRunnerInstallation/sonar-scanner/conf/sonar-scanner.properties
</code></pre>
<p>åœ¨æ–‡ä»¶æœ€å <strong>æ·»åŠ </strong></p>
<pre><code class="mysql"># å¼€å¯JDK17å¯¹åå°„çš„å…¼å®¹
sonar.scanner.jvmArgs=--add-opens java.base/java.lang=ALL-UNNAMED
</code></pre>
<p>æ•´ä½“çš„æ–‡ä»¶æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="yaml">#Configure here general information about the environment, such as SonarQube server connection details for example
#No information about specific project should appear here

#----- Default SonarQube server
sonar.host.url=http://localhost:9999

#----- Default source code encoding
#sonar.sourceEncoding=UTF-8
# å¼€å¯JDK17å¯¹åå°„çš„å…¼å®¹
sonar.scanner.jvmArgs=--add-opens java.base/java.lang=ALL-UNNAMED
</code></pre>
<h4 id="â˜…å¦‚æœè¦ä½¿ç”¨sonarqube-ä¸€å®šè¦jdkæ˜¯1-8â˜…"><a href="#â˜…å¦‚æœè¦ä½¿ç”¨sonarqube-ä¸€å®šè¦jdkæ˜¯1-8â˜…" class="headerlink" title="â˜…å¦‚æœè¦ä½¿ç”¨sonarqube ä¸€å®šè¦jdkæ˜¯1.8â˜…"></a>â˜…å¦‚æœè¦ä½¿ç”¨sonarqube ä¸€å®šè¦jdkæ˜¯1.8â˜…</h4><p>é¦–å…ˆéœ€è¦å»å…¨å±€é‚£é‡Œè®¾ç½®jdkï¼ˆManage jenkins â†’ Systemï¼‰</p>
<p>é”®ï¼š<br><code>JAVA_HOME</code><br>å€¼ï¼š<br><code>/usr/local/java/jdk-17.0.8+7</code></p>
<p>é”®ï¼š<br><code>JAVA_HOME</code><br>å€¼ï¼š<br><code>/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.262.b10-1.el7.x86_64</code><br>åœ¨æ„å»ºé¡¹ç›®é…ç½®çš„æ—¶å€™<code>Build Steps</code> â†’ <code>Execute SonarQube Scanner</code> â†’ jdkä¸€å®šè¦é€‰æ‹©1.8çš„ï¼ï¼ï¼</p>
<hr>
<hr>
<h4 id="æµæ°´çº¿æ„å»ºç‰ˆæœ¬ç”¨çš„jdk17è§£å†³åŠæ³•"><a href="#æµæ°´çº¿æ„å»ºç‰ˆæœ¬ç”¨çš„jdk17è§£å†³åŠæ³•" class="headerlink" title="æµæ°´çº¿æ„å»ºç‰ˆæœ¬ç”¨çš„jdk17è§£å†³åŠæ³•"></a><span style = "color:red"><strong>æµæ°´çº¿æ„å»ºç‰ˆæœ¬ç”¨çš„jdk17è§£å†³åŠæ³•</strong></span></h4><p>è¦é»˜è®¤çš„1.8æ‰æ”¯æŒ æ‰€ä»¥ç›´æ¥ä»æ ¹æºä¸Šè§£å†³è¿™ä¸ªé—®é¢˜</p>
<p>ä½ å½“å‰çš„ç³»ç»Ÿé»˜è®¤ Java æ˜¯ <strong>JDK 1.8</strong>ï¼Œè·¯å¾„åœ¨ï¼š</p>
<pre><code>/usr/bin/java
</code></pre>
<p>ä½ æ‰§è¡Œçš„ï¼š</p>
<pre><code>java -version
</code></pre>
<p>è¾“å‡ºæ˜¯ï¼š</p>
<pre><code>openjdk version &quot;1.8.0_262&quot;
</code></pre>
<p>è¯´æ˜ç°åœ¨ Jenkins ä¸»æœºä¸Šé»˜è®¤ä½¿ç”¨çš„æ˜¯ Java 8ï¼Œè¿™æ˜¯ç¬¦åˆ <strong>SonarQube 6.7.4 çš„æ¨èç‰ˆæœ¬</strong>ï¼Œå¾ˆå¥½ï¼</p>
<hr>
<h2 id="âœ…-æ¥ä¸‹æ¥ä½ è¦åšçš„"><a href="#âœ…-æ¥ä¸‹æ¥ä½ è¦åšçš„" class="headerlink" title="âœ… æ¥ä¸‹æ¥ä½ è¦åšçš„"></a>âœ… æ¥ä¸‹æ¥ä½ è¦åšçš„</h2><p>ä¸ºäº†ç¡®ä¿ Jenkins ä¸­çš„ <code>SonarScanner</code> ä¹Ÿç”¨ Java 8 è¿è¡Œï¼Œä½ è¿˜éœ€è¦ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<hr>
<h3 id="âœ…-æ–¹æ³•ä¸€ï¼šä¿®æ”¹-sonar-scanner-å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰"><a href="#âœ…-æ–¹æ³•ä¸€ï¼šä¿®æ”¹-sonar-scanner-å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰" class="headerlink" title="âœ… æ–¹æ³•ä¸€ï¼šä¿®æ”¹ sonar-scanner å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰"></a>âœ… æ–¹æ³•ä¸€ï¼šä¿®æ”¹ <code>sonar-scanner</code> å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰</h3><pre><code class="java">vi /var/lib/jenkins/tools/hudson.plugins.sonar.SonarRunnerInstallation/sonar-scanner/bin/sonar-scanner
</code></pre>
<p>åœ¨é¡¶éƒ¨æ·»åŠ ä¸‹é¢ä¸¤è¡Œ ğŸ‘‡ï¼š</p>
<pre><code class="java">export JAVA_HOME=/usr
export PATH=$JAVA_HOME/bin:$PATH
</code></pre>
</blockquote>
<hr>
<h5 id="æ¨¡æ‹ŸSonaQubeä»£ç å®¡æŸ¥æœºåˆ¶"><a href="#æ¨¡æ‹ŸSonaQubeä»£ç å®¡æŸ¥æœºåˆ¶" class="headerlink" title="æ¨¡æ‹ŸSonaQubeä»£ç å®¡æŸ¥æœºåˆ¶"></a>æ¨¡æ‹ŸSonaQubeä»£ç å®¡æŸ¥æœºåˆ¶</h5><p><code>C:\Users\Pluminary\Desktop\web_demo\src\main\java\com\itheima\HelloServlet.java</code></p>
<pre><code class="java">package com.itheima;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 *
 */
public class HelloServlet extends HttpServlet &#123;


    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
        super.doPost(req,resp);
    &#125;

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
        //æ¨¡æ‹Ÿä»£ç é”™è¯¯
        int i = 100/0;

        //æ¨¡æ‹Ÿå†—ä½™ä»£ç 
        int a = 100;
        a = 200;


        resp.getWriter().write(&quot;hello Servlet!&quot;);
    &#125;
&#125;
</code></pre>
<h4 id="åœ¨é¡¹ç›®æ·»åŠ SonaQubeä»£ç å®¡æŸ¥ï¼ˆæµæ°´çº¿é¡¹ç›®ï¼‰ä¸åœ¨Jenkinsé‡Œé¢å†™é…ç½®ï¼Œåœ¨é¡¹ç›®çš„æ–‡ä»¶é‡Œé¢å†™ï¼"><a href="#åœ¨é¡¹ç›®æ·»åŠ SonaQubeä»£ç å®¡æŸ¥ï¼ˆæµæ°´çº¿é¡¹ç›®ï¼‰ä¸åœ¨Jenkinsé‡Œé¢å†™é…ç½®ï¼Œåœ¨é¡¹ç›®çš„æ–‡ä»¶é‡Œé¢å†™ï¼" class="headerlink" title="åœ¨é¡¹ç›®æ·»åŠ SonaQubeä»£ç å®¡æŸ¥ï¼ˆæµæ°´çº¿é¡¹ç›®ï¼‰ä¸åœ¨Jenkinsé‡Œé¢å†™é…ç½®ï¼Œåœ¨é¡¹ç›®çš„æ–‡ä»¶é‡Œé¢å†™ï¼"></a>åœ¨é¡¹ç›®æ·»åŠ SonaQubeä»£ç å®¡æŸ¥ï¼ˆæµæ°´çº¿é¡¹ç›®ï¼‰<del>ä¸åœ¨Jenkinsé‡Œé¢å†™é…ç½®ï¼Œåœ¨é¡¹ç›®çš„æ–‡ä»¶é‡Œé¢å†™ï¼</del></h4><pre><code class="java">sonar-project.properties
    
# must be unique in a given SonarQube instance
sonar.projectKey=web_demo_pipline
# this is the name and version displayed in the SonarQube UI. Was mandatory prior to SonarQube 6.1.
sonar.projectName=web_demo_pipline
sonar.projectVersion=1.0

# Path is relative to the sonar-project.properties file. Replace &quot;\&quot; by &quot;/&quot; on Windows.
# This property is optional if sonar.modules is set.
sonar.sources=.
sonar.exclusions=**/test/**,**/target/**

sonar.java.source=1.8
sonar.java.target=1.8

# Encoding of the source code. Default is default system encoding
sonar.sourceEncoding=UTF-8
</code></pre>
<pre><code class="java">pipeline &#123;
    agent any

    tools &#123;
        // ä½¿ç”¨ Jenkins é…ç½®å¥½çš„ JDK 1.8ï¼ˆåˆ«åéœ€å’Œä½ Jenkinsä¸­é…ç½®ä¸€è‡´ï¼‰
        jdk &#39;jdk-1.8.0&#39;
    &#125;

    environment &#123;
        // Sonar Scanner JVM å¯åŠ¨å‚æ•°ï¼Œå¼€å¯å¿…è¦çš„moduleè®¿é—®æƒé™
        SONAR_SCANNER_OPTS = &#39;--add-opens=java.base/java.lang=ALL-UNNAMED &#39; +
                             &#39;--add-opens=java.base/java.lang.reflect=ALL-UNNAMED &#39; +
                             &#39;--add-opens=java.base/java.io=ALL-UNNAMED&#39;
    &#125;

    stages &#123;
        stage(&#39;Pull Code&#39;) &#123;
            steps &#123;
                checkout scmGit(
                    branches: [[name: &quot;*/$&#123;branch&#125;&quot;]],
                    extensions: [],
                    userRemoteConfigs: [[
                        credentialsId: &#39;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&#39;,
                        url: &#39;http://192.168.200.132:82/lanyun_group/web_demo.git&#39;
                    ]]
                )
            &#125;
        &#125;

        stage(&#39;Build Project&#39;) &#123;
            steps &#123;
                sh &#39;mvn clean package&#39;
            &#125;
        &#125;

        stage(&#39;SonarQube Scan&#39;) &#123;
            steps &#123;
                // å¼ºåˆ¶åˆ‡æ¢åˆ° JDK8 ç¯å¢ƒï¼Œé¿å…é»˜è®¤JDK17å¯¼è‡´æƒé™å¼‚å¸¸
                withEnv([
                    &#39;JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.262.b10-1.el7.x86_64&#39;,
                    &#39;PATH=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.262.b10-1.el7.x86_64/bin:&#39; + env.PATH
                ]) &#123;
                    sh &#39;&#39;&#39;
                    /var/lib/jenkins/tools/hudson.plugins.sonar.SonarRunnerInstallation/sonar-scanner/bin/sonar-scanner \
                      -Dsonar.projectKey=web_demo_freestyle \
                      -Dsonar.host.url=http://192.168.200.129:9999 \
                      -Dsonar.sources=. \
                      -Dsonar.exclusions=**/test/**,**/target/** \
                      -Dsonar.java.source=1.8 \
                      -Dsonar.java.target=1.8
                    &#39;&#39;&#39;
                &#125;
            &#125;
        &#125;

        stage(&#39;Publish&#39;) &#123;
            steps &#123;
                deploy adapters: [tomcat8(
                    alternativeDeploymentContext: &#39;&#39;,
                    credentialsId: &#39;e847a130-29c3-4d0b-bf35-db8d00de7950&#39;,
                    path: &#39;&#39;,
                    url: &#39;http://192.168.200.131:8090/&#39;
                )], contextPath: null, war: &#39;target/*.war&#39;
            &#125;
        &#125;
    &#125;

    post &#123;
        always &#123;
            emailext(
                subject: &#39;æ„å»ºé€šçŸ¥ï¼š$&#123;PROJECT_NAME&#125; - Build # $&#123;BUILD_NUMBER&#125; - $&#123;BUILD_STATUS&#125;!&#39;,
                body: &#39;$&#123;FILE,path=&quot;email.html&quot;&#125;&#39;,
                to: &#39;2523419709@qq.com&#39;
            )
        &#125;
    &#125;
&#125;
</code></pre>
<hr>
<hr>
<h4 id="Jenkins-Docker-SpringCloudå¾®æœåŠ¡æŒç»­é›†æˆ-ä¸Š"><a href="#Jenkins-Docker-SpringCloudå¾®æœåŠ¡æŒç»­é›†æˆ-ä¸Š" class="headerlink" title="Jenkins+Docker+SpringCloudå¾®æœåŠ¡æŒç»­é›†æˆ(ä¸Š)"></a>Jenkins+Docker+SpringCloudå¾®æœåŠ¡æŒç»­é›†æˆ(ä¸Š)</h4><h5 id="Jenkins-Docker-SpringCloudæŒç»­é›†æˆæµç¨‹è¯´æ˜"><a href="#Jenkins-Docker-SpringCloudæŒç»­é›†æˆæµç¨‹è¯´æ˜" class="headerlink" title="Jenkins+Docker+SpringCloudæŒç»­é›†æˆæµç¨‹è¯´æ˜"></a>Jenkins+Docker+SpringCloudæŒç»­é›†æˆæµç¨‹è¯´æ˜</h5><p><img src="https://raw.githubusercontent.com/P-luminary/images/db193c56fc4ab5def5c327247037af53ce451fb5/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E8%AF%B4%E6%98%8E2.png"></p>
<p>å¤§è‡´æµç¨‹è¯´æ˜ï¼š<br>1ï¼‰å¼€å‘äººå‘˜æ¯å¤©æŠŠä»£ç æäº¤åˆ°Gitlabä»£ç ä»“åº“<br>2ï¼‰Jenkinsä»Gitlabä¸­æ‹‰å–é¡¹ç›®æºç ï¼Œç¼–è¯‘å¹¶æ‰“æˆjaråŒ…ï¼Œç„¶åæ„å»ºæˆDockeré•œåƒï¼Œå°†é•œåƒä¸Šä¼ åˆ° Harborç§æœ‰ä»“åº“ã€‚<br>3ï¼‰Jenkinså‘é€SSHè¿œç¨‹å‘½ä»¤ï¼Œè®©ç”Ÿäº§éƒ¨ç½²æœåŠ¡å™¨åˆ°Harborç§æœ‰ä»“åº“æ‹‰å–é•œåƒåˆ°æœ¬åœ°ï¼Œç„¶ååˆ›å»ºå®¹å™¨ã€‚<br>4ï¼‰æœ€åï¼Œç”¨æˆ·å¯ä»¥è®¿é—®åˆ°å®¹å™¨</p>
<h6 id="æœåŠ¡åˆ—è¡¨-çº¢è‰²çš„è½¯ä»¶ä¸ºéœ€è¦å®‰è£…çš„è½¯ä»¶ï¼Œé»‘è‰²ä»£è¡¨å·²ç»å®‰è£…"><a href="#æœåŠ¡åˆ—è¡¨-çº¢è‰²çš„è½¯ä»¶ä¸ºéœ€è¦å®‰è£…çš„è½¯ä»¶ï¼Œé»‘è‰²ä»£è¡¨å·²ç»å®‰è£…" class="headerlink" title="æœåŠ¡åˆ—è¡¨(çº¢è‰²çš„è½¯ä»¶ä¸ºéœ€è¦å®‰è£…çš„è½¯ä»¶ï¼Œé»‘è‰²ä»£è¡¨å·²ç»å®‰è£…)"></a>æœåŠ¡åˆ—è¡¨(çº¢è‰²çš„è½¯ä»¶ä¸ºéœ€è¦å®‰è£…çš„è½¯ä»¶ï¼Œé»‘è‰²ä»£è¡¨å·²ç»å®‰è£…)</h6><table>
<thead>
<tr>
<th>æœåŠ¡å™¨åç§°</th>
<th>IPåœ°å€</th>
<th>å®‰è£…çš„è½¯ä»¶</th>
</tr>
</thead>
<tbody><tr>
<td>ä»£ç æ‰˜ç®¡æœåŠ¡å™¨</td>
<td>192.168.200.132</td>
<td>Gitlab</td>
</tr>
<tr>
<td>æŒç»­é›†æˆæœåŠ¡å™¨</td>
<td>192.168.200.129</td>
<td>Jenkinsï¼ŒMavenï¼ŒDocker18.06.1-ce</td>
</tr>
<tr>
<td>Dockerä»“åº“æœåŠ¡å™¨</td>
<td></td>
<td>Docker18.06.1-ceï¼ŒHarbor1.9.2</td>
</tr>
<tr>
<td>ç”Ÿäº§éƒ¨ç½²æœåŠ¡å™¨</td>
<td></td>
<td>Docker18.06.1-ce</td>
</tr>
</tbody></table>
<h4 id="SpringCloudå¾®æœåŠ¡æºç æ¦‚è¿°"><a href="#SpringCloudå¾®æœåŠ¡æºç æ¦‚è¿°" class="headerlink" title="SpringCloudå¾®æœåŠ¡æºç æ¦‚è¿°"></a>SpringCloudå¾®æœåŠ¡æºç æ¦‚è¿°</h4><p>é¡¹ç›®æ¶æ„ï¼šå‰åç«¯åˆ†ç¦»<br>åç«¯æŠ€æœ¯æ ˆï¼šSpringBoot+SpringCloud+SpringDataJpaï¼ˆSpringå…¨å®¶æ¡¶ï¼‰<br>ä½ç½®ï¼š<code>C:\Users\Pluminary\Desktop\HouDuan\tensquare_parent</code></p>
<h6 id="å¾®æœåŠ¡é¡¹ç›®ç»“æ„ï¼š"><a href="#å¾®æœåŠ¡é¡¹ç›®ç»“æ„ï¼š" class="headerlink" title="å¾®æœåŠ¡é¡¹ç›®ç»“æ„ï¼š"></a>å¾®æœåŠ¡é¡¹ç›®ç»“æ„ï¼š</h6><ul>
<li>tensquare_parent ï¼šçˆ¶å·¥ç¨‹ï¼Œå­˜æ”¾åŸºç¡€é…ç½® </li>
<li>tensquare_common ï¼šé€šç”¨å·¥ç¨‹ï¼Œå­˜æ”¾å·¥å…·ç±» </li>
<li>tensquare_eureka_serverï¼šSpringCloudçš„Eurekaæ³¨å†Œä¸­å¿ƒ </li>
<li>tensquare_zuul ï¼šSpringCloudçš„ç½‘å…³æœåŠ¡ </li>
<li>tensquare_admin_service ï¼šåŸºç¡€æƒé™è®¤è¯ä¸­å¿ƒï¼Œè´Ÿè´£ç”¨æˆ·è®¤è¯ï¼ˆä½¿ç”¨JWTè®¤è¯ï¼‰</li>
<li>tensquare_gathering ï¼š ä¸€ä¸ªç®€å•çš„ä¸šåŠ¡æ¨¡å—ï¼Œæ´»åŠ¨å¾®æœåŠ¡ç›¸å…³é€»è¾‘</li>
</ul>
<h6 id="æ•°æ®åº“ç»“æ„ï¼š"><a href="#æ•°æ®åº“ç»“æ„ï¼š" class="headerlink" title="æ•°æ®åº“ç»“æ„ï¼š"></a>æ•°æ®åº“ç»“æ„ï¼š</h6><ul>
<li>tensquare_user ï¼šç”¨æˆ·è®¤è¯æ•°æ®åº“ï¼Œå­˜æ”¾ç”¨æˆ·è´¦æˆ·æ•°æ®ã€‚å¯¹åº”tensquare_admin_serviceå¾®æœåŠ¡ </li>
<li>tensquare_gathering ï¼šæ´»åŠ¨å¾®æœåŠ¡æ•°æ®åº“ã€‚å¯¹åº”tensquare_gatheringå¾®æœåŠ¡</li>
</ul>
<h6 id="å¾®æœåŠ¡é…ç½®åˆ†æï¼š"><a href="#å¾®æœåŠ¡é…ç½®åˆ†æï¼š" class="headerlink" title="å¾®æœåŠ¡é…ç½®åˆ†æï¼š"></a>å¾®æœåŠ¡é…ç½®åˆ†æï¼š</h6><ul>
<li><p>tensquare_eureka</p>
</li>
<li><p>tensquare_zuul</p>
</li>
<li><p>tensquare_admin_service</p>
</li>
<li><p>tensquare_gathering</p>
</li>
<li><p>æŸ¥çœ‹æ•ˆæœ</p>
</li>
</ul>
<pre><code class="yaml">application.yaml

spring:
  application:
    name: EUREKA-HA

---

spring:
  profiles: eureka-server1
server:
  port: 10086
eureka:
  instance:
    hostname: localhost
  client:
    service-url:
      defaultZone: http://localhost:10086/eureka/,http://localhost:10087/eureka/

---

spring:
  profiles: eureka-server2
server:
  port: 10087
eureka:
  instance:
    hostname: localhost
  client:
    service-url:
      defaultZone: http://localhost:10086/eureka/,http://localhost:10087/eureka/
</code></pre>
<p>ä¾æ¬¡å¼€å¯è¿™äº›æœåŠ¡ï¼š<code>tensquare_eureka_server â†’ tensquare_zuul â†’ tensquare_admin_service â†’ tensquare_gathering </code></p>
<blockquote>
<p>tensquare_eureka_server è¦åœ¨é…ç½®çš„åœ°æ–¹é…ç½®ä¸¤ä¸ªã€å¤åˆ¶å‡ºå¤šä¸€ä¸ªã€‘é…ç½®ä¿¡æ¯æ·»åŠ <code>Program arguments</code></p>
<p>EurekaServerApplication-Server1ï¼š-spring.profiles.active&#x3D;eureka-server1<br>EurekaServerApplication-Server2ï¼šâ€“spring.profiles.active&#x3D;eureka-server2</p>
</blockquote>
<h5 id="è°ƒç”¨postman"><a href="#è°ƒç”¨postman" class="headerlink" title="è°ƒç”¨postman"></a>è°ƒç”¨postman</h5><h6 id="æµ‹è¯•gatheringæ¥å£çš„æ—¶å€™ä¸€å®šè¦åœ¨è¯·æ±‚å¤´å¸¦token"><a href="#æµ‹è¯•gatheringæ¥å£çš„æ—¶å€™ä¸€å®šè¦åœ¨è¯·æ±‚å¤´å¸¦token" class="headerlink" title="æµ‹è¯•gatheringæ¥å£çš„æ—¶å€™ä¸€å®šè¦åœ¨è¯·æ±‚å¤´å¸¦token"></a>æµ‹è¯•gatheringæ¥å£çš„æ—¶å€™ä¸€å®šè¦åœ¨è¯·æ±‚å¤´å¸¦token</h6><h6 id="æµ‹è¯•è·å¾—tokenæ¥å£çš„æ—¶å€™ä¸€å®šæ˜¯postè¯·æ±‚-è¯·æ±‚ä½“æ˜¯jsonå½¢å¼"><a href="#æµ‹è¯•è·å¾—tokenæ¥å£çš„æ—¶å€™ä¸€å®šæ˜¯postè¯·æ±‚-è¯·æ±‚ä½“æ˜¯jsonå½¢å¼" class="headerlink" title="æµ‹è¯•è·å¾—tokenæ¥å£çš„æ—¶å€™ä¸€å®šæ˜¯postè¯·æ±‚ è¯·æ±‚ä½“æ˜¯jsonå½¢å¼"></a>æµ‹è¯•è·å¾—tokenæ¥å£çš„æ—¶å€™ä¸€å®šæ˜¯postè¯·æ±‚ è¯·æ±‚ä½“æ˜¯jsonå½¢å¼</h6><pre><code class="yaml">GETï¼šhttp://localhost:10020/gathering/gathering

Headersï¼šè¿™é‡Œçš„tokenæ˜¯å»postè¯·æ±‚è·å¾—
</code></pre>
<pre><code class="yaml">POSTï¼šhttp://localhost:10020/admin/admin/login

jsonï¼š&#123;
  &quot;loginname&quot;: &quot;admin&quot;,
  &quot;password&quot;: &quot;123456&quot;
&#125;
</code></pre>
<h4 id="æœ¬åœ°éƒ¨ç½²-1-SpringCloudå¾®æœåŠ¡éƒ¨ç½²"><a href="#æœ¬åœ°éƒ¨ç½²-1-SpringCloudå¾®æœåŠ¡éƒ¨ç½²" class="headerlink" title="æœ¬åœ°éƒ¨ç½²(1)-SpringCloudå¾®æœåŠ¡éƒ¨ç½²"></a>æœ¬åœ°éƒ¨ç½²(1)-SpringCloudå¾®æœåŠ¡éƒ¨ç½²</h4><h5 id="æœ¬åœ°è¿è¡Œå¾®æœåŠ¡"><a href="#æœ¬åœ°è¿è¡Œå¾®æœåŠ¡" class="headerlink" title="æœ¬åœ°è¿è¡Œå¾®æœåŠ¡"></a>æœ¬åœ°è¿è¡Œå¾®æœåŠ¡</h5><ul>
<li>é€ä¸€å¯åŠ¨å¾®æœåŠ¡</li>
<li>ä½¿ç”¨postmanæµ‹è¯•åŠŸèƒ½æ˜¯å¦å¯ç”¨</li>
</ul>
<h5 id="æœ¬åœ°éƒ¨ç½²å¾®æœåŠ¡"><a href="#æœ¬åœ°éƒ¨ç½²å¾®æœåŠ¡" class="headerlink" title="æœ¬åœ°éƒ¨ç½²å¾®æœåŠ¡"></a>æœ¬åœ°éƒ¨ç½²å¾®æœåŠ¡</h5><ul>
<li>SpringBootå¾®æœåŠ¡é¡¹ç›®æ‰“åŒ…</li>
</ul>
<blockquote>
<p>æ‰“å¼€ideaç»ˆç«¯<br>PS C:\Users\Pluminary\Desktop\HouDuan\tensquare_parent&gt;<br>æ‰˜é€‰æƒ³è¦æ‰“åŒ…çš„é¡¹ç›®åˆ°ç»ˆç«¯<br>PS C:\Users\Pluminary\Desktop\HouDuan\tensquare_parent\tensquare_eureka_server&gt; <strong>mvn clean package</strong><br>æ­¤æ—¶å°±æ‰“å¥½äº†jaråŒ…<br>C:\Users\Pluminary\Desktop\HouDuan\tensquare_parent\tensquare_eureka_server\targetçš„<code>tensquare_eureka_server-1.0-SNAPSHOT.jar</code></p>
</blockquote>
<p>å¿…é¡»å¯¼å…¥è¯¥æ’ä»¶</p>
<pre><code class="xml">åœ¨æ ¹pom.xmlä¸­
   &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

â˜… è¿™ä¸ªå°±å¯ä»¥å¯¹springcloudè¿›è¡Œæ‰“åŒ… å¾®æœåŠ¡çš„jarå¯ä»¥ç‹¬ç«‹éƒ¨ç½² æ‰”åˆ°ä»»ä½•ä¸€ä¸ªæœåŠ¡å°±å¯ä»¥å•ç‹¬è¿è¡Œ è€Œä¸éœ€è¦å€ŸåŠ©å•ç‹¬çš„tomcat â˜…
</code></pre>
<p>æ‰“åŒ…ååœ¨ targetä¸‹äº§ç”ŸjaråŒ…</p>
<ul>
<li><span style="color:red"><strong>æœ¬åœ°è¿è¡Œå¾®æœåŠ¡çš„jaråŒ…</strong></span></li>
</ul>
<p><code>java -jar xxx.jar</code></p>
<pre><code class="yaml">C:\Users\Pluminary\Desktop&gt;java -jar tensquare_eureka_server-1.0-SNAPSHOT.jar


2025-07-01 15:33:09.363  INFO 27172 --- [           main] o.s.core.annotation.AnnotationUtils      : Failed to introspect annotations on class org.springframework.cloud.netflix.eureka.config.EurekaDiscoveryClientConfigServiceBootstrapConfiguration: java.lang.IllegalStateException: Could not obtain annotation attribute value for public abstract java.lang.Class[] org.springframework.boot.autoconfigure.condition.ConditionalOnClass.value()
2025-07-01 15:33:09.373  INFO 27172 --- [           main] s.c.a.AnnotationConfigApplicationContext : Refreshing org.springframework.context.annotation.AnnotationConfigApplicationContext@8f4ea7c: startup date [Tue Jul 01 15:33:09 CST 2025]; root of context hierarchy
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.springframework.cglib.core.ReflectUtils$1 (jar:file:/C:/Users/Pluminary/Desktop/tensquare_eureka_server-1.0-SNAPSHOT.jar!/BOOT-INF/lib/spring-core-5.0.5.RELEASE.jar!/) to method java.lang.ClassLoader.defineClass(java.lang.String,byte[],int,int,java.security.ProtectionDomain)
WARNING: Please consider reporting this to the maintainers of org.springframework.cglib.core.ReflectUtils$1
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
2025-07-01 15:33:09.531  INFO 27172 --- [           main] f.a.AutowiredAnnotationBeanPostProcessor : JSR-330 &#39;javax.inject.Inject&#39; annotation found and supported for autowiring
2025-07-01 15:33:09.554  INFO 27172 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &#39;configurationPropertiesRebinderAutoConfiguration&#39; of type [org.springframework.cloud.autoconfigure.ConfigurationPropertiesRebinderAutoConfiguration$$EnhancerBySpringCGLIB$$83532275] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)

  .   ____          _            __ _ _
 /\\ / ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | &#39;_ | &#39;_| | &#39;_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  &#39;  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v2.0.1.RELEASE)
</code></pre>
<h4 id="æœ¬åœ°éƒ¨ç½²-2-å‰ç«¯é™æ€webç½‘ç«™"><a href="#æœ¬åœ°éƒ¨ç½²-2-å‰ç«¯é™æ€webç½‘ç«™" class="headerlink" title="æœ¬åœ°éƒ¨ç½²(2)-å‰ç«¯é™æ€webç½‘ç«™"></a>æœ¬åœ°éƒ¨ç½²(2)-å‰ç«¯é™æ€webç½‘ç«™</h4><p>å‰ç«¯æŠ€æœ¯æ ˆï¼šNodeJS+VueJS+ElementUI<br>ä½¿ç”¨Visual Studio Codeæ‰“å¼€æºç <br>ä½ç½®ï¼š<code>C:\Users\Pluminary\Desktop\QianDuan\tensquareAdmin</code></p>
<p>å› ä¸ºè€ç‰ˆæœ¬æ— æ³•ç»§ç»­ç”¨æœ€æ–°çš„nodejs<br>éœ€è¦ç”¨nvmè¿›è¡Œç»Ÿä¸€çš„nodejsç®¡ç† å¦‚æœæ— æ³•ç›´æ¥nvmä¸‹è½½çš„è¯<br>æˆ‘ä»¬å¯ä»¥å»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…zipåè§£å‹è¿›å» æ”¹åå°±è¡Œ</p>
<blockquote>
<h4 id="âœ…-1-ä¸‹è½½-Node-js-v10-24-1-64ä½-zip-ç‰ˆæœ¬"><a href="#âœ…-1-ä¸‹è½½-Node-js-v10-24-1-64ä½-zip-ç‰ˆæœ¬" class="headerlink" title="âœ… 1. ä¸‹è½½ Node.js v10.24.1 64ä½ zip ç‰ˆæœ¬"></a>âœ… 1. ä¸‹è½½ Node.js v10.24.1 64ä½ zip ç‰ˆæœ¬</h4><p>ä½ å¯ä»¥ä»å®˜æ–¹é“¾æ¥ä¸‹è½½ï¼š</p>
<p>ğŸ“¦ ä¸‹è½½åœ°å€ï¼ˆWindows 64ä½ï¼‰ï¼š</p>
<pre><code>bash


å¤åˆ¶ç¼–è¾‘
https://nodejs.org/dist/v10.24.1/node-v10.24.1-win-x64.zip
</code></pre>
<p>ä¸‹è½½åï¼Œè§£å‹å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ˆæ¯”å¦‚å« <code>node-v10.24.1-win-x64</code>ï¼‰</p>
<hr>
<h4 id="âœ…-2-æ”¾å…¥-NVM-çš„ç‰ˆæœ¬ç›®å½•"><a href="#âœ…-2-æ”¾å…¥-NVM-çš„ç‰ˆæœ¬ç›®å½•" class="headerlink" title="âœ… 2. æ”¾å…¥ NVM çš„ç‰ˆæœ¬ç›®å½•"></a>âœ… 2. æ”¾å…¥ NVM çš„ç‰ˆæœ¬ç›®å½•</h4><p>å°†ä½ è§£å‹å¾—åˆ°çš„ <code>node-v10.24.1-win-x64</code> æ–‡ä»¶å¤¹é‡å‘½åä¸ºï¼š</p>
<pre><code>10.24.1
</code></pre>
<p>ç„¶åæ”¾å…¥è¿™ä¸ªç›®å½•ä¸‹ï¼š</p>
<pre><code>C:\Program Files\nvm\versions\10.24.1\
</code></pre>
<p>C:\Users\Pluminary\Desktop\QianDuan\tensquareAdmin&gt;<strong>nvm list</strong></p>
<ul>
<li>20.12.0 (Currently using 64-bit executable)<br>10.24.1</li>
</ul>
<p>C:\Users\Pluminary\Desktop\QianDuan\tensquareAdmin&gt;<strong>nvm use 10.24.1</strong><br>Now using node v10.24.1 (64-bit)</p>
<hr>
<hr>
<h4 id="ğŸš€-æ­¥éª¤-1ï¼šé‡æ–°ä¸‹è½½å¯¹åº”-binding-node"><a href="#ğŸš€-æ­¥éª¤-1ï¼šé‡æ–°ä¸‹è½½å¯¹åº”-binding-node" class="headerlink" title="ğŸš€ æ­¥éª¤ 1ï¼šé‡æ–°ä¸‹è½½å¯¹åº” binding.node"></a>ğŸš€ æ­¥éª¤ 1ï¼šé‡æ–°ä¸‹è½½å¯¹åº” <code>binding.node</code></h4><p>åœ¨é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œï¼š</p>
<pre><code>bash


å¤åˆ¶ç¼–è¾‘
npm rebuild node-sass
</code></pre>
</blockquote>
<p> I  Your application is running here: <a target="_blank" rel="noopener" href="http://localhost:9528/">http://localhost:9528</a> å‰ç«¯å³å¯å¯åŠ¨ï¼<br><code>name: admin    password: 123456</code><br>[åæ¬¡æ–¹ç¤¾äº¤å¹³å°-ç®¡ç†å‘˜åå°] (<a target="_blank" rel="noopener" href="http://localhost:9528/#/gathering/index">http://localhost:9528/#/gathering/index</a>)</p>
<h3 id="ç¯å¢ƒå‡†å¤‡-1-Dockerå¿«é€Ÿå…¥é—¨"><a href="#ç¯å¢ƒå‡†å¤‡-1-Dockerå¿«é€Ÿå…¥é—¨" class="headerlink" title="ç¯å¢ƒå‡†å¤‡(1)-Dockerå¿«é€Ÿå…¥é—¨"></a>ç¯å¢ƒå‡†å¤‡(1)-Dockerå¿«é€Ÿå…¥é—¨</h3><p>Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼ŒåŸºäº Go è¯­è¨€ å¹¶éµä» Apache2.0 åè®®å¼€æºã€‚ Docker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµ è¡Œçš„ Linux æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚ å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ï¼ˆç±»ä¼¼ iPhone çš„ appï¼‰,æ›´é‡è¦çš„æ˜¯å®¹å™¨æ€§èƒ½å¼€é”€ æä½ã€‚ Dockerå®¹å™¨æŠ€æœ¯ vs ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯</p>
<table>
<thead>
<tr>
<th></th>
<th>è™šæ‹Ÿæœº</th>
<th>å®¹å™¨</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å ç”¨ç£ç›˜ç©ºé—´</strong></td>
<td>éå¸¸å¤§ï¼ŒGBçº§</td>
<td>å°ï¼ŒMBç”šè‡³KBçº§</td>
</tr>
<tr>
<td><strong>å¯åŠ¨é€Ÿåº¦</strong></td>
<td>æ…¢ã€‚åˆ†é’Ÿçº§</td>
<td>å¿«ï¼Œç§’çº§</td>
</tr>
<tr>
<td><strong>è¿è¡ŒçŠ¶æ€</strong></td>
<td>è¿è¡ŒäºHypervisorä¸Š</td>
<td>ç›´æ¥è¿è¡Œåœ¨å®¿ä¸»æœºå†…æ ¸ä¸Š</td>
</tr>
<tr>
<td><strong>å¹¶å‘æ€§</strong></td>
<td>ä¸€å°å®¿ä¸»æœºä¸Šåå‡ ä¸ªï¼Œæœ€å¤šå‡ åä¸ª</td>
<td>ä¸Šç™¾ä¸ªï¼Œç”šè‡³æ•°ç™¾ä¸Šåƒä¸ª</td>
</tr>
<tr>
<td><strong>æ€§èƒ½</strong></td>
<td>é€Šäºå®¿ä¸»æœº</td>
<td>æ¥è¿‘å®¿ä¸»æœºæœ¬åœ°è¿›ç¨‹</td>
</tr>
<tr>
<td><strong>èµ„æºåˆ©ç”¨ç‡</strong></td>
<td>ä½</td>
<td>é«˜</td>
</tr>
</tbody></table>
<p>ç®€å•ä¸€å¥è¯æ€»ç»“ï¼š<strong>DockeræŠ€æœ¯å°±æ˜¯è®©æˆ‘ä»¬æ›´åŠ é«˜æ•ˆè½»æ¾åœ°å°†ä»»ä½•åº”ç”¨åœ¨LinuxæœåŠ¡å™¨éƒ¨ç½²å’Œä½¿ç”¨</strong>ã€‚</p>
<h4 id="Dockerå®‰è£…"><a href="#Dockerå®‰è£…" class="headerlink" title="Dockerå®‰è£…"></a>Dockerå®‰è£…</h4><p>1ï¼‰å¸è½½æ—§ç‰ˆæœ¬</p>
<pre><code class="java">yum list installed | grep docker åˆ—å‡ºå½“å‰æ‰€æœ‰dockerçš„åŒ…
yum -y remove dockerçš„åŒ…åç§° å¸è½½dockeråŒ…
rm -rf /var/lib/docker åˆ é™¤dockerçš„æ‰€æœ‰é•œåƒå’Œå®¹å™¨
</code></pre>
<p>2ï¼‰å®‰è£…å¿…è¦çš„è½¯ä»¶åŒ…</p>
<pre><code class="yaml">sudo yum install -y yum-utils \ device-mapper-persistent-data \ lvm2
</code></pre>
<p> 3ï¼‰è®¾ç½®ä¸‹è½½çš„é•œåƒä»“åº“</p>
<pre><code class="yaml">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
</code></pre>
<p> 4ï¼‰åˆ—å‡ºéœ€è¦å®‰è£…çš„ç‰ˆæœ¬åˆ—è¡¨</p>
<pre><code class="yaml">yum list docker-ce --showduplicates | sort -r
</code></pre>
<blockquote>
<p>docker-ce.x86_64  3:18.09.1-3.el7<br>docker-ce.x86_64  3:18.09.0-3.el7<br>docker-ce.x86_64  18.06.1.ce-3.el7<br>docker-ce.x86_64  18.06.0.ce-3.el7<br>â€¦â€¦ </p>
</blockquote>
<p> 5 ï¼‰å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼ˆè¿™é‡Œä½¿ç”¨18.0.1ç‰ˆæœ¬ï¼‰</p>
<pre><code class="yaml">sudo yum install docker-ce-18.06.1.ce
</code></pre>
<p> 6ï¼‰æŸ¥çœ‹ç‰ˆæœ¬</p>
<pre><code class="yaml">docker -v
</code></pre>
<p> 7ï¼‰å¯åŠ¨Docker</p>
<pre><code class="yaml">sudo systemctl start docker   å¯åŠ¨
sudo systemctl enable docker  è®¾ç½®å¼€æœºå¯åŠ¨
</code></pre>
<p>8ï¼‰æ·»åŠ é˜¿é‡Œäº‘é•œåƒä¸‹è½½åœ°å€</p>
<pre><code class="yaml">sudvi /etc/docker/daemon.json
</code></pre>
<blockquote>
<p>{<br>  â€œregistry-mirrorsâ€: [â€œ<a href="https://zydiol88.mirror.aliyuncs.com&quot;]">https://zydiol88.mirror.aliyuncs.com&quot;]</a><br>}</p>
</blockquote>
<p>9 ï¼‰é‡å¯Docker</p>
<pre><code class="yaml">sudo systemctl restart docker
</code></pre>
<blockquote>
<p>ç¬¬å››æ­¥çœ‹è¿™é‡Œï¼šä½ ç°åœ¨çš„é—®é¢˜è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼š</p>
<blockquote>
<p>âŒ <strong>æ— æ³•è®¿é—® Docker å®˜æ–¹æºï¼ˆ<code>https://download.docker.com/...</code>ï¼‰ï¼ŒæŠ¥é”™ curl#35 - TCP connection reset by peerã€‚</strong></p>
</blockquote>
<hr>
<h3 id="âœ…-è§£å†³æ–¹æ³•ï¼šä½¿ç”¨å›½å†…é•œåƒï¼ˆå¦‚æ¸…åã€é˜¿é‡Œï¼‰"><a href="#âœ…-è§£å†³æ–¹æ³•ï¼šä½¿ç”¨å›½å†…é•œåƒï¼ˆå¦‚æ¸…åã€é˜¿é‡Œï¼‰" class="headerlink" title="âœ… è§£å†³æ–¹æ³•ï¼šä½¿ç”¨å›½å†…é•œåƒï¼ˆå¦‚æ¸…åã€é˜¿é‡Œï¼‰"></a>âœ… è§£å†³æ–¹æ³•ï¼šä½¿ç”¨å›½å†…é•œåƒï¼ˆå¦‚æ¸…åã€é˜¿é‡Œï¼‰</h3><p>ä½ éœ€è¦ <strong>æ‰‹åŠ¨åˆ‡æ¢ Docker yum æºä¸ºå›½å†…é•œåƒ</strong>ï¼Œå¦åˆ™æ— æ³•ç»§ç»­å®‰è£…ã€‚ä¸‹é¢æ˜¯æœ€ç›´æ¥å¯è¡Œçš„è§£å†³æ–¹æ³•ã€‚</p>
<hr>
<h2 id="ğŸš€-ä¸€é”®æ¢æˆæ¸…åæºï¼ˆCentOS-7-ç¤ºä¾‹ï¼‰"><a href="#ğŸš€-ä¸€é”®æ¢æˆæ¸…åæºï¼ˆCentOS-7-ç¤ºä¾‹ï¼‰" class="headerlink" title="ğŸš€ ä¸€é”®æ¢æˆæ¸…åæºï¼ˆCentOS 7 ç¤ºä¾‹ï¼‰"></a>ğŸš€ ä¸€é”®æ¢æˆæ¸…åæºï¼ˆCentOS 7 ç¤ºä¾‹ï¼‰</h2><p>è¯·å¤åˆ¶ä»¥ä¸‹å‘½ä»¤åˆ°ä½ çš„æœåŠ¡å™¨æ‰§è¡Œï¼š</p>
<pre><code>bashå¤åˆ¶ç¼–è¾‘sudo tee /etc/yum.repos.d/docker-ce.repo &lt;&lt;-&#39;EOF&#39;
[docker-ce-stable]
name=Docker CE Stable - Tsinghua Mirror
baseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/7/x86_64/stable
enabled=1
gpgcheck=1
gpgkey=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/gpg
EOF
</code></pre>
<hr>
<h3 id="ğŸ”-ç„¶åæ‰§è¡Œï¼š"><a href="#ğŸ”-ç„¶åæ‰§è¡Œï¼š" class="headerlink" title="ğŸ” ç„¶åæ‰§è¡Œï¼š"></a>ğŸ” ç„¶åæ‰§è¡Œï¼š</h3><pre><code>sudo yum clean all
sudo yum makecache fast
</code></pre>
<hr>
<h3 id="âœ…-å®‰è£…-Docker-æŒ‡å®šç‰ˆæœ¬ï¼ˆæ¯”å¦‚-18-06ï¼‰"><a href="#âœ…-å®‰è£…-Docker-æŒ‡å®šç‰ˆæœ¬ï¼ˆæ¯”å¦‚-18-06ï¼‰" class="headerlink" title="âœ… å®‰è£… Docker æŒ‡å®šç‰ˆæœ¬ï¼ˆæ¯”å¦‚ 18.06ï¼‰"></a>âœ… å®‰è£… Docker æŒ‡å®šç‰ˆæœ¬ï¼ˆæ¯”å¦‚ 18.06ï¼‰</h3><pre><code>sudo yum install docker-ce-18.06.1.ce docker-ce-cli-18.06.1.ce containerd.io
</code></pre>
<p>æˆ–è€…æŸ¥çœ‹æ‰€æœ‰å¯ç”¨ç‰ˆæœ¬ï¼š</p>
<pre><code>yum list docker-ce --showduplicates
</code></pre>
<hr>
<h3 id="ğŸŸ¢-å¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨ï¼š"><a href="#ğŸŸ¢-å¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨ï¼š" class="headerlink" title="ğŸŸ¢ å¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨ï¼š"></a>ğŸŸ¢ å¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨ï¼š</h3><pre><code>sudo systemctl start docker
sudo systemctl enable docker
</code></pre>
</blockquote>
<hr>
<hr>
<h3 id="DockeråŸºæœ¬å‘½ä»¤å¿«é€Ÿå…¥é—¨"><a href="#DockeråŸºæœ¬å‘½ä»¤å¿«é€Ÿå…¥é—¨" class="headerlink" title="DockeråŸºæœ¬å‘½ä»¤å¿«é€Ÿå…¥é—¨"></a>DockeråŸºæœ¬å‘½ä»¤å¿«é€Ÿå…¥é—¨</h3><h6 id="1ï¼‰é•œåƒå‘½ä»¤"><a href="#1ï¼‰é•œåƒå‘½ä»¤" class="headerlink" title="1ï¼‰é•œåƒå‘½ä»¤"></a>1ï¼‰é•œåƒå‘½ä»¤</h6><p>[dockeré…ç½®é•œåƒDocker pullæ—¶æŠ¥é”™ï¼š<a target="_blank" rel="noopener" href="https://registry-1.docker.io/v2/">https://registry-1.docker.io/v2/</a> - çŸ¥ä¹] (<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/24228872523">https://zhuanlan.zhihu.com/p/24228872523</a>)</p>
<blockquote>
<p>è¿™ä¸ªé”™è¯¯è¡¨æ˜Dockerå®¢æˆ·ç«¯å°è¯•è®¿é—®<a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=253867805&content_type=Article&match_order=1&q=Docker+Hub&zhida_source=entity">Docker Hub</a>æˆ–å…¶ä»–<a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=253867805&content_type=Article&match_order=1&q=Docker%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83&zhida_source=entity">Dockeræ³¨å†Œä¸­å¿ƒ</a>æ—¶å‡ºç°äº†é—®é¢˜ã€‚å…·ä½“æ¥è¯´ï¼Œæ˜¯åœ¨å°è¯•è·å–æ³¨å†Œä¸­å¿ƒAPIçš„å“åº”æ—¶é‡åˆ°äº†é”™è¯¯ã€‚å¯èƒ½çš„åŸå› åŒ…æ‹¬ç½‘ç»œé—®é¢˜ã€è®¤è¯é—®é¢˜ã€æ³¨å†Œä¸­å¿ƒURLä¸æ­£ç¡®æˆ–è€…æ³¨å†Œä¸­å¿ƒæœåŠ¡æœ¬èº«ä¸å¯ç”¨ã€‚</p>
<p>2ã€è§£å†³æ–¹æ³•</p>
<pre><code class="text">systemctl status docker
sudo mkdir -p /etc/docker
vim /etc/docker/daemon.json  
</code></pre>
<p>æ·»åŠ ï¼š</p>
<pre><code class="text">&#123;
  &quot;registry-mirrors&quot; : [&quot;https://docker.registry.cyou&quot;,
&quot;https://docker-cf.registry.cyou&quot;,
&quot;https://dockercf.jsdelivr.fyi&quot;,
&quot;https://docker.jsdelivr.fyi&quot;,
&quot;https://dockertest.jsdelivr.fyi&quot;,
&quot;https://mirror.aliyuncs.com&quot;,
&quot;https://dockerproxy.com&quot;,
&quot;https://mirror.baidubce.com&quot;,
&quot;https://docker.m.daocloud.io&quot;,
&quot;https://docker.nju.edu.cn&quot;,
&quot;https://docker.mirrors.sjtug.sjtu.edu.cn&quot;,
&quot;https://docker.mirrors.ustc.edu.cn&quot;,
&quot;https://mirror.iscas.ac.cn&quot;,
&quot;https://docker.rainbond.cc&quot;,
&quot;https://do.nark.eu.org&quot;,
&quot;https://dc.j8.work&quot;,
&quot;https://dockerproxy.com&quot;,
&quot;https://gst6rzl9.mirror.aliyuncs.com&quot;,
&quot;https://registry.docker-cn.com&quot;,
&quot;http://hub-mirror.c.163.com&quot;,
&quot;http://mirrors.ustc.edu.cn/&quot;,
&quot;https://mirrors.tuna.tsinghua.edu.cn/&quot;,
&quot;http://mirrors.sohu.com/&quot; 
],
 &quot;insecure-registries&quot; : [
    &quot;registry.docker-cn.com&quot;,
    &quot;docker.mirrors.ustc.edu.cn&quot;
    ],
&quot;debug&quot;: true,
&quot;experimental&quot;: false
&#125;
</code></pre>
<p>é‡è½½å’Œé‡å¯dockersæœåŠ¡</p>
<pre><code class="text">sudo systemctl daemon-reload
sudo systemctl restart docker
docker info
</code></pre>
<p>é‡æ–°æ‰§è¡Œ</p>
<pre><code class="text">docker run hello-world
</code></pre>
</blockquote>
<p>é•œåƒï¼šç›¸å½“äºåº”ç”¨çš„å®‰è£…åŒ…ï¼Œåœ¨Dockeréƒ¨ç½²çš„ä»»ä½•åº”ç”¨éƒ½éœ€è¦å…ˆæ„å»ºæˆä¸ºé•œåƒ</p>
<pre><code class="yaml">docker search é•œåƒåç§° æœç´¢é•œåƒ
docker pull é•œåƒåç§° æ‹‰å–é•œåƒ
docker images æŸ¥çœ‹æœ¬åœ°æ‰€æœ‰é•œåƒ
docker rmi -f é•œåƒåç§° åˆ é™¤é•œåƒ
</code></pre>
<p><code>docker pull openjdk:8-jdk-alpine</code></p>
<pre><code class="yaml">[root@localhost ~]# docker pull openjdk:8-jdk-alpine
8-jdk-alpine: Pulling from library/openjdk
e7c96db7181b: Pull complete
f910a506b6cb: Pull complete
c2274a1a0e27: Pull complete
Digest: sha256:94792824df2df33402f201713f932b58cb9de94a0cd524164a0f2283343547b3
Status: Downloaded newer image for openjdk:8-jdk-alpine
[root@localhost ~]#
</code></pre>
<h4 id="2ï¼‰å®¹å™¨å‘½ä»¤"><a href="#2ï¼‰å®¹å™¨å‘½ä»¤" class="headerlink" title="2ï¼‰å®¹å™¨å‘½ä»¤"></a>2ï¼‰å®¹å™¨å‘½ä»¤</h4><p>å®¹å™¨ï¼šå®¹å™¨æ˜¯ç”±é•œåƒåˆ›å»ºè€Œæ¥ã€‚å®¹å™¨æ˜¯Dockerè¿è¡Œåº”ç”¨çš„è½½ä½“ï¼Œæ¯ä¸ªåº”ç”¨éƒ½åˆ†åˆ«è¿è¡Œåœ¨Dockerçš„æ¯ä¸ª å®¹å™¨ä¸­ã€‚</p>
<pre><code class="yaml">docker run -i é•œåƒåç§°:æ ‡ç­¾ è¿è¡Œå®¹å™¨ï¼ˆé»˜è®¤æ˜¯å‰å°è¿è¡Œï¼‰
docker ps         æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨
docker ps -a      æŸ¥è¯¢æ‰€æœ‰å®¹å™¨
</code></pre>
<h6 id="å¸¸ç”¨çš„å‚æ•°ï¼š"><a href="#å¸¸ç”¨çš„å‚æ•°ï¼š" class="headerlink" title="å¸¸ç”¨çš„å‚æ•°ï¼š"></a>å¸¸ç”¨çš„å‚æ•°ï¼š</h6><pre><code class="yaml">-iï¼šè¿è¡Œå®¹å™¨
-dï¼šåå°å®ˆæ–¹å¼è¿è¡Œï¼ˆå®ˆæŠ¤å¼ï¼‰
--nameï¼šç»™å®¹å™¨æ·»åŠ åç§°
-pï¼šå…¬å¼€å®¹å™¨ç«¯å£ç»™å½“å‰å®¿ä¸»æœº
-vï¼šæŒ‚è½½ç›®å½•

docker exec -it å®¹å™¨ID/å®¹å™¨åç§° /bin/bash è¿›å…¥å®¹å™¨å†…éƒ¨
docker start/stop/restart å®¹å™¨åç§°/ID å¯åŠ¨/åœæ­¢/é‡å¯å®¹å™¨
docker rm -f å®¹å™¨åç§°/ID åˆ é™¤å®¹å™¨
</code></pre>
<blockquote>
<p>docker run -i nginx      è¿è¡Œå®¹å™¨<br>docker run -di nginx    åå°è¿è¡Œå®¹å™¨</p>
</blockquote>
<h5 id="è¿è¡Œçš„æ—¶å€™åˆ›å»ºç«¯å£-æŠŠç«¯å£æš´éœ²ç»™å®¿ä¸»æœº-è¿™æ ·å®¿ä¸»æœºå°±å¯ä»¥è¿›è¡Œipåœ°å€-ç«¯å£çš„è®¿é—®è™šæ‹Ÿæœºçš„å®¹å™¨äº†"><a href="#è¿è¡Œçš„æ—¶å€™åˆ›å»ºç«¯å£-æŠŠç«¯å£æš´éœ²ç»™å®¿ä¸»æœº-è¿™æ ·å®¿ä¸»æœºå°±å¯ä»¥è¿›è¡Œipåœ°å€-ç«¯å£çš„è®¿é—®è™šæ‹Ÿæœºçš„å®¹å™¨äº†" class="headerlink" title="è¿è¡Œçš„æ—¶å€™åˆ›å»ºç«¯å£ æŠŠç«¯å£æš´éœ²ç»™å®¿ä¸»æœº è¿™æ ·å®¿ä¸»æœºå°±å¯ä»¥è¿›è¡Œipåœ°å€+ç«¯å£çš„è®¿é—®è™šæ‹Ÿæœºçš„å®¹å™¨äº†"></a>è¿è¡Œçš„æ—¶å€™åˆ›å»ºç«¯å£ æŠŠç«¯å£æš´éœ²ç»™å®¿ä¸»æœº è¿™æ ·å®¿ä¸»æœºå°±å¯ä»¥è¿›è¡Œipåœ°å€+ç«¯å£çš„è®¿é—®è™šæ‹Ÿæœºçš„å®¹å™¨äº†</h5><p><code>-p</code>æ˜¯<span style = "color:red"><strong>å…¬å¼€ç«¯å£</strong></span>   å¤–éƒ¨ç”¨90ç«¯å£è®¿é—®80ç«¯å£<br><code>docker run -di -p 90:80 nginx</code></p>
<blockquote>
<p>[root@localhost ~]# docker run -di -p 90:80 nginx<br>04726503f6ee2d053b54b6361d128827d5fb26b867c8fbd5439a370a4ac137d9<br>[root@localhost ~]# docker ps<br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                NAMES<br>04726503f6ee        nginx               â€œ&#x2F;docker-entrypoint.â€¦â€   29 seconds ago      Up 27 seconds       0.0.0.0:90-&gt;80&#x2F;tcp   relaxed_goldberg</p>
</blockquote>
<p>æ­¤æ—¶ç”¨å®¿ä¸»æœºå»è®¿é—®ï¼š[Welcome to nginx!] (<a target="_blank" rel="noopener" href="http://192.168.200.129:90/">http://192.168.200.129:90/</a>)</p>
<blockquote>
<h1 id="Welcome-to-nginx"><a href="#Welcome-to-nginx" class="headerlink" title="Welcome to nginx!"></a>Welcome to nginx!</h1><p>If you see this page, the nginx web server is successfully installed and working. Further configuration is required.</p>
<p>For online documentation and support please refer to <a target="_blank" rel="noopener" href="http://nginx.org/">nginx.org</a>.<br>Commercial support is available at <a target="_blank" rel="noopener" href="http://nginx.com/">nginx.com</a>.</p>
<p><em>Thank you for using nginx.</em></p>
</blockquote>
<hr>
<h4 id="è¿›å…¥æŸä¸ªå®¹å™¨å†…éƒ¨æŸ¥çœ‹å…¶å†…å®¹ï¼š"><a href="#è¿›å…¥æŸä¸ªå®¹å™¨å†…éƒ¨æŸ¥çœ‹å…¶å†…å®¹ï¼š" class="headerlink" title="è¿›å…¥æŸä¸ªå®¹å™¨å†…éƒ¨æŸ¥çœ‹å…¶å†…å®¹ï¼š"></a>è¿›å…¥æŸä¸ªå®¹å™¨å†…éƒ¨æŸ¥çœ‹å…¶å†…å®¹ï¼š</h4><blockquote>
<p>[root@localhost ~]# <code>docker exec -it 04726503f6ee /bin/bash</code><br>root@04726503f6ee:&#x2F;# ls<br>bin  boot  dev  docker-entrypoint.d  docker-entrypoint.sh  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var<br>root@04726503f6ee:&#x2F;#</p>
</blockquote>
<h4 id="åˆ é™¤å®¹å™¨"><a href="#åˆ é™¤å®¹å™¨" class="headerlink" title="åˆ é™¤å®¹å™¨"></a>åˆ é™¤å®¹å™¨</h4><blockquote>
<p>[root@localhost ~]# docker ps -a<br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS                NAMES<br>04726503f6ee        nginx               â€œ&#x2F;docker-entrypoint.â€¦â€   4 minutes ago       Up 4 minutes                0.0.0.0:90-&gt;80&#x2F;tcp   relaxed_goldberg<br>9b9b1ec3e7a1        nginx               â€œ&#x2F;docker-entrypoint.â€¦â€   10 minutes ago      Up 8 minutes                80&#x2F;tcp               gracious_knuth<br>4fb9d9e6858a        hello-world         â€œ&#x2F;helloâ€                 29 minutes ago      Exited (0) 29 minutes ago                        elated_bhaskara<br>[root@localhost ~]# docker rm -f 4fb9d9e6858a<br>4fb9d9e6858a</p>
</blockquote>
<h3 id="è™šæ‹Ÿæœºå˜åŒ–ip-å¯¼è‡´æ— æ³•pingé€š-è§£å†³åŠæ³•"><a href="#è™šæ‹Ÿæœºå˜åŒ–ip-å¯¼è‡´æ— æ³•pingé€š-è§£å†³åŠæ³•" class="headerlink" title="è™šæ‹Ÿæœºå˜åŒ–ip å¯¼è‡´æ— æ³•pingé€š è§£å†³åŠæ³•"></a>è™šæ‹Ÿæœºå˜åŒ–ip å¯¼è‡´æ— æ³•pingé€š è§£å†³åŠæ³•</h3><p><code>cd /etc/sysconfig/network-scripts/</code></p>
<p><code>vi ifcfg-ens33</code></p>
<blockquote>
<h2 id="â—æ ¸å¿ƒé—®é¢˜æ€»ç»“ï¼š"><a href="#â—æ ¸å¿ƒé—®é¢˜æ€»ç»“ï¼š" class="headerlink" title="â—æ ¸å¿ƒé—®é¢˜æ€»ç»“ï¼š"></a>â—æ ¸å¿ƒé—®é¢˜æ€»ç»“ï¼š</h2><h3 id="ä½ çš„å®¿ä¸»æœºï¼ˆWindowsï¼‰çš„çœŸå®è”ç½‘ç½‘å¡æ˜¯ï¼š"><a href="#ä½ çš„å®¿ä¸»æœºï¼ˆWindowsï¼‰çš„çœŸå®è”ç½‘ç½‘å¡æ˜¯ï¼š" class="headerlink" title="ä½ çš„å®¿ä¸»æœºï¼ˆWindowsï¼‰çš„çœŸå®è”ç½‘ç½‘å¡æ˜¯ï¼š"></a>ä½ çš„å®¿ä¸»æœºï¼ˆWindowsï¼‰çš„çœŸå®è”ç½‘ç½‘å¡æ˜¯ï¼š</h3><ul>
<li><strong>æ— çº¿ç½‘å¡ WLAN</strong><ul>
<li>IPï¼š<code>192.168.31.103</code></li>
<li>ç½‘å…³ï¼š<code>192.168.31.1</code></li>
</ul>
</li>
</ul>
<h3 id="è€Œä½ çš„-VMware-è™šæ‹Ÿæœºè®¾ç½®çš„æ˜¯ï¼š"><a href="#è€Œä½ çš„-VMware-è™šæ‹Ÿæœºè®¾ç½®çš„æ˜¯ï¼š" class="headerlink" title="è€Œä½ çš„ VMware è™šæ‹Ÿæœºè®¾ç½®çš„æ˜¯ï¼š"></a>è€Œä½ çš„ VMware è™šæ‹Ÿæœºè®¾ç½®çš„æ˜¯ï¼š</h3><ul>
<li><strong>é™æ€ IPï¼š192.168.200.132</strong></li>
<li>ç½‘å…³ï¼š<code>192.168.200.1</code></li>
<li>ç½‘ç»œæ¨¡å¼ï¼šä½ è®¾ä¸º<strong>æ¡¥æ¥æ¨¡å¼</strong></li>
</ul>
<hr>
<h2 id="â—é—®é¢˜æœ¬è´¨ï¼š"><a href="#â—é—®é¢˜æœ¬è´¨ï¼š" class="headerlink" title="â—é—®é¢˜æœ¬è´¨ï¼š"></a>â—é—®é¢˜æœ¬è´¨ï¼š</h2><blockquote>
<p>ä½ çš„è™šæ‹Ÿæœºé™æ€ IP è®¾ç½®åœ¨ <strong>192.168.200.x ç½‘æ®µ</strong>ï¼Œä½† <strong>å®¿ä¸»æœºæ˜¯åœ¨ 192.168.31.x ç½‘æ®µ</strong>ï¼Œè¯´æ˜ä½ çš„<strong>æ¡¥æ¥å®é™…ä¸Šæ ¹æœ¬æ²¡æœ‰ç”Ÿæ•ˆ</strong>ï¼Œæˆ–è€…<strong>æ¡¥æ¥åˆ°äº†é”™è¯¯çš„ç‰©ç†ç½‘å¡</strong>ã€‚</p>
</blockquote>
<hr>
<h2 id="âœ…-æœ€å¿«ä¿®å¤æ–¹æ¡ˆï¼ˆæ¨èï¼Œ100-å¯è¡Œï¼‰ï¼š"><a href="#âœ…-æœ€å¿«ä¿®å¤æ–¹æ¡ˆï¼ˆæ¨èï¼Œ100-å¯è¡Œï¼‰ï¼š" class="headerlink" title="âœ… æœ€å¿«ä¿®å¤æ–¹æ¡ˆï¼ˆæ¨èï¼Œ100% å¯è¡Œï¼‰ï¼š"></a>âœ… æœ€å¿«ä¿®å¤æ–¹æ¡ˆï¼ˆæ¨èï¼Œ100% å¯è¡Œï¼‰ï¼š</h2><h3 id="ğŸ› ï¸-æ­¥éª¤ä¸€ï¼šä¿®æ”¹-VMware-æ¡¥æ¥è®¾ç½®"><a href="#ğŸ› ï¸-æ­¥éª¤ä¸€ï¼šä¿®æ”¹-VMware-æ¡¥æ¥è®¾ç½®" class="headerlink" title="ğŸ› ï¸ æ­¥éª¤ä¸€ï¼šä¿®æ”¹ VMware æ¡¥æ¥è®¾ç½®"></a>ğŸ› ï¸ æ­¥éª¤ä¸€ï¼šä¿®æ”¹ VMware æ¡¥æ¥è®¾ç½®</h3><ol>
<li>å…³é—­è™šæ‹Ÿæœº</li>
<li>æ‰“å¼€ VMware ä¸»ç•Œé¢ â†’ é€‰æ‹©ä½ çš„è™šæ‹Ÿæœº â†’ è®¾ç½®ï¼ˆSettingsï¼‰â†’ ç½‘ç»œé€‚é…å™¨</li>
<li>é€‰æ‹©ï¼š<ul>
<li>âœ”ï¸ ç½‘ç»œè¿æ¥ â†’ <strong>æ¡¥æ¥æ¨¡å¼ï¼ˆBridgedï¼‰</strong></li>
<li>ç‚¹å¼€æ—è¾¹çš„ â€œ<strong>æ¡¥æ¥è®¾ç½®ï¼ˆBridge Settingsï¼‰</strong>â€</li>
</ul>
</li>
<li>æ‰‹åŠ¨é€‰æ‹©ä½ çš„ <strong>Wi-Fi æ— çº¿ç½‘å¡ï¼ˆä¾‹å¦‚ Intel Wireless-AC æˆ– Realtek Wirelessï¼‰</strong><ul>
<li>ä¸è¦é€‰â€œè‡ªåŠ¨â€</li>
</ul>
</li>
<li><strong>å–æ¶ˆå‹¾é€‰</strong>â€œå¤åˆ¶ç‰©ç†ç½‘ç»œè¿æ¥çŠ¶æ€â€è¿™ä¸€é¡¹</li>
<li>ä¿å­˜è®¾ç½®</li>
</ol>
<hr>
<h3 id="ğŸ› ï¸-æ­¥éª¤äºŒï¼šä¿®æ”¹è™šæ‹Ÿæœºå†…-IP-è®¾ç½®"><a href="#ğŸ› ï¸-æ­¥éª¤äºŒï¼šä¿®æ”¹è™šæ‹Ÿæœºå†…-IP-è®¾ç½®" class="headerlink" title="ğŸ› ï¸ æ­¥éª¤äºŒï¼šä¿®æ”¹è™šæ‹Ÿæœºå†… IP è®¾ç½®"></a>ğŸ› ï¸ æ­¥éª¤äºŒï¼šä¿®æ”¹è™šæ‹Ÿæœºå†… IP è®¾ç½®</h3><p>ç”±äºä½ çœŸå®ç½‘ç»œæ˜¯ <code>192.168.31.x</code>ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºä¹Ÿåº”è¯¥è®¾ç½®ä¸ºè¿™ä¸ªç½‘æ®µï¼Œä¾‹å¦‚ï¼š</p>
<p>ç¼–è¾‘ <code>vi /etc/sysconfig/network-scripts/ifcfg-ens33</code>ï¼š</p>
<pre><code>BOOTPROTO=static
NAME=ens33
DEVICE=ens33
ONBOOT=yes

IPADDR=192.168.31.150       # â† éšä¾¿å–ä¸€ä¸ªæ²¡è¢«å ç”¨çš„
NETMASK=255.255.255.0
GATEWAY=192.168.31.1       # è¿™ä¸ªæ˜¯åœ¨å®¿ä¸»æœºç½‘ç»œä¸‹çš„ç¯å¢ƒç½‘å…³ ipconfig
DNS1=8.8.8.8
</code></pre>
<p>ç„¶åæ‰§è¡Œï¼š</p>
<pre><code>sudo systemctl restart network
</code></pre>
<p>æˆ–è€…ï¼š</p>
<pre><code>sudo ifdown ens33 &amp;&amp; sudo ifup ens33
</code></pre>
<hr>
<h3 id="âœ…-æ­¥éª¤ä¸‰ï¼šåœ¨-Windows-ä¸Š-ping-æ–°çš„è™šæ‹Ÿæœº-IP"><a href="#âœ…-æ­¥éª¤ä¸‰ï¼šåœ¨-Windows-ä¸Š-ping-æ–°çš„è™šæ‹Ÿæœº-IP" class="headerlink" title="âœ… æ­¥éª¤ä¸‰ï¼šåœ¨ Windows ä¸Š ping æ–°çš„è™šæ‹Ÿæœº IP"></a>âœ… æ­¥éª¤ä¸‰ï¼šåœ¨ Windows ä¸Š ping æ–°çš„è™šæ‹Ÿæœº IP</h3><pre><code>ping 192.168.31.150
</code></pre>
<hr>
<h2 id="ğŸ§ -å¦‚æœä½ æ‹…å¿ƒ-IP-å†²çªæ€ä¹ˆåŠï¼Ÿ"><a href="#ğŸ§ -å¦‚æœä½ æ‹…å¿ƒ-IP-å†²çªæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="ğŸ§  å¦‚æœä½ æ‹…å¿ƒ IP å†²çªæ€ä¹ˆåŠï¼Ÿ"></a>ğŸ§  å¦‚æœä½ æ‹…å¿ƒ IP å†²çªæ€ä¹ˆåŠï¼Ÿ</h2><p>åœ¨ Windows ä¸Šè¿è¡Œï¼š</p>
<pre><code>ping 192.168.31.150
</code></pre>
<p>å¦‚æœ ping ä¸é€šï¼Œå°±è¯´æ˜è¿™ä¸ª IP æ˜¯ç©ºé—²çš„ï¼Œå¯ä»¥ç”¨ã€‚</p>
<hr>
<h2 id="âœ…-æ›¿ä»£æ–¹æ¡ˆï¼ˆä¿ç•™-NAT-æ¨¡å¼ï¼‰"><a href="#âœ…-æ›¿ä»£æ–¹æ¡ˆï¼ˆä¿ç•™-NAT-æ¨¡å¼ï¼‰" class="headerlink" title="âœ… æ›¿ä»£æ–¹æ¡ˆï¼ˆä¿ç•™ NAT æ¨¡å¼ï¼‰"></a>âœ… æ›¿ä»£æ–¹æ¡ˆï¼ˆä¿ç•™ NAT æ¨¡å¼ï¼‰</h2><p>å¦‚æœä½ ä¸æƒ³æ”¹æ¡¥æ¥æ¨¡å¼ï¼Œå¯ä»¥ç»§ç»­ç”¨ <strong>VMware NAT æ¨¡å¼</strong>ï¼Œé‚£å°±è®©è™šæ‹Ÿæœºä¿ç•™åŸæ¥çš„ï¼š</p>
<ul>
<li>IPï¼š192.168.200.132</li>
<li>ç½‘å…³ï¼š192.168.200.1</li>
<li>ç„¶åé€šè¿‡ç«¯å£è½¬å‘ï¼ˆNAT ç«¯å£æ˜ å°„ï¼‰æ¥ä»ä¸»æœºè®¿é—®è™šæ‹Ÿæœºï¼ˆéœ€è¦æ‰‹åŠ¨é…ç½®ï¼‰</li>
</ul>
<p>ä½† <strong>æ¡¥æ¥ + é™æ€ IP æ›´ç®€å•ã€ç¨³å®šã€å…¼å®¹æ€§å¥½</strong>ã€‚</p>
<hr>
<h2 id="âœ…-æœ€ç»ˆç›®æ ‡"><a href="#âœ…-æœ€ç»ˆç›®æ ‡" class="headerlink" title="âœ… æœ€ç»ˆç›®æ ‡"></a>âœ… æœ€ç»ˆç›®æ ‡</h2><p>ä½ çš„å®¿ä¸»æœºå’Œè™šæ‹Ÿæœº <strong>åœ¨åŒä¸€ä¸ªç½‘æ®µï¼ˆå¦‚éƒ½åœ¨ <code>192.168.31.x</code>ï¼‰</strong>ï¼Œå¹¶ä¸”è™šæ‹Ÿæœºç½‘å¡çŠ¶æ€ä¸º <code>UP</code>ï¼Œé‚£ ping è‚¯å®šé€šï¼</p>
<hr>
<h3 id="ğŸ”š-ç»“è®º"><a href="#ğŸ”š-ç»“è®º" class="headerlink" title="ğŸ”š ç»“è®º"></a>ğŸ”š ç»“è®º</h3><table>
<thead>
<tr>
<th>é—®é¢˜</th>
<th>è§£å†³æ–¹æ³•</th>
</tr>
</thead>
<tbody><tr>
<td>è™šæ‹Ÿæœº IP è®¾ç½®é”™ç½‘æ®µäº†</td>
<td>æ”¹ä¸º <code>192.168.31.x</code>ï¼ˆå’Œä¸»æœºä¸€æ ·çš„ç½‘æ®µï¼‰</td>
</tr>
<tr>
<td>æ¡¥æ¥å¤±è´¥</td>
<td>æ‰‹åŠ¨æŒ‡å®šæ¡¥æ¥ç‰©ç†ç½‘å¡ä¸ºä½ çš„ <strong>æ— çº¿ç½‘å¡</strong>ï¼Œä¸èƒ½é€‰è‡ªåŠ¨</td>
</tr>
<tr>
<td>ä¸èƒ½ ping é€š</td>
<td>ç½‘å¡ DOWN â†’ å¯åŠ¨ï¼›IP ä¸é€š â†’ æ”¹ç½‘æ®µï¼›é˜²ç«å¢™ â†’ æš‚åœ</td>
</tr>
</tbody></table>
</blockquote>
<hr>
<blockquote>
<p>å¦‚æœ<code>ip a show ens33</code>æ²¡æœ‰ipåœ°å€æ€ä¹ˆåŠ è¿™æ ·ä¼šå¯¼è‡´mobaè¿ä¸ä¸Š<br>åº”è¯¥æ˜¯ç½‘å¡çŠ¶æ€ä¸º<code>down</code>è¯´æ˜ç½‘å¡æ²¡å¯ç”¨<br>ç›´æ¥ç”¨ipå‘½ä»¤æŠŠç½‘å¡æ‰“å¼€<code>sudo ip link set ens33 up</code><br>ç„¶åæ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰ ip a show ens33<br>é‡å¯ç½‘ç»œæœåŠ¡ï¼š<code>sudo systemctl restart network</code> å†æ¬¡æŸ¥çœ‹<br><span style = "color:red"><strong>å¦‚æœè¿˜æ˜¯æ²¡æœ‰ å°±æ‰‹åŠ¨è®¾ç½®IP</strong></span><br><code>sudo ip addr add 192.168.200.131/24 dev ens33 </code><br>å†æ¬¡é‡å¯ç½‘ç»œæœåŠ¡ï¼š<code>sudo systemctl restart network</code><br>ç„¶åå†æ¬¡æŸ¥çœ‹ <code>ip a show ens33</code></p>
</blockquote>
<h4 id="æˆ‘æƒ³äº†è§£ä¸€ä¸‹-è™šæ‹Ÿæœºçš„-netç›´è¿-æ¡¥æ¥-ä»…ä¸»æœºæ¨¡å¼-è‡ªå®šä¹‰è™šæ‹Ÿç½‘ç»œ-è¿™äº›æœ‰ä»€ä¹ˆåŒºåˆ«å•Š"><a href="#æˆ‘æƒ³äº†è§£ä¸€ä¸‹-è™šæ‹Ÿæœºçš„-netç›´è¿-æ¡¥æ¥-ä»…ä¸»æœºæ¨¡å¼-è‡ªå®šä¹‰è™šæ‹Ÿç½‘ç»œ-è¿™äº›æœ‰ä»€ä¹ˆåŒºåˆ«å•Š" class="headerlink" title="æˆ‘æƒ³äº†è§£ä¸€ä¸‹ è™šæ‹Ÿæœºçš„ netç›´è¿ æ¡¥æ¥ ä»…ä¸»æœºæ¨¡å¼ è‡ªå®šä¹‰è™šæ‹Ÿç½‘ç»œ  è¿™äº›æœ‰ä»€ä¹ˆåŒºåˆ«å•Š"></a>æˆ‘æƒ³äº†è§£ä¸€ä¸‹ è™šæ‹Ÿæœºçš„ netç›´è¿ æ¡¥æ¥ ä»…ä¸»æœºæ¨¡å¼ è‡ªå®šä¹‰è™šæ‹Ÿç½‘ç»œ  è¿™äº›æœ‰ä»€ä¹ˆåŒºåˆ«å•Š</h4><table>
<thead>
<tr>
<th>æ¨¡å¼åç§°</th>
<th>è™šæ‹Ÿæœºæ˜¯å¦èƒ½è®¿é—®å¤–ç½‘</th>
<th>èƒ½å¦ä¸ä¸»æœºé€šä¿¡</th>
<th>èƒ½å¦è¢«å±€åŸŸç½‘å…¶å®ƒè®¾å¤‡è®¿é—®</th>
<th>åœºæ™¯ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td><strong>NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰</strong></td>
<td>âœ… å¯ä»¥</td>
<td>âœ… å¯ä»¥</td>
<td>âŒ ä¸èƒ½</td>
<td>é»˜è®¤æ¨¡å¼ï¼Œé€‚åˆè®¿é—®äº’è”ç½‘ä½†ä¸è¢«è®¿é—®</td>
</tr>
<tr>
<td><strong>æ¡¥æ¥æ¨¡å¼ï¼ˆBridgedï¼‰</strong></td>
<td>âœ… å¯ä»¥</td>
<td>âœ… å¯ä»¥</td>
<td>âœ… å¯ä»¥</td>
<td>é€‚åˆå¼€å‘ã€è°ƒè¯•æœåŠ¡ç«¯ç¨‹åº</td>
</tr>
<tr>
<td><strong>ä»…ä¸»æœºæ¨¡å¼ï¼ˆHost-Onlyï¼‰</strong></td>
<td>âŒ ä¸å¯ä»¥</td>
<td>âœ… å¯ä»¥</td>
<td>âŒ ä¸èƒ½</td>
<td>é€‚åˆæµ‹è¯•è™šæ‹Ÿæœºä¸ä¸»æœºé€šä¿¡ï¼Œéš”ç¦»ç½‘ç»œ</td>
</tr>
<tr>
<td><strong>è‡ªå®šä¹‰è™šæ‹Ÿç½‘ç»œ</strong>ï¼ˆVMnetXï¼‰</td>
<td>çœ‹é…ç½®æƒ…å†µ</td>
<td>çœ‹é…ç½®æƒ…å†µ</td>
<td>çœ‹é…ç½®æƒ…å†µ</td>
<td>é«˜çº§ç”¨é€”ï¼Œå¦‚å¤šæœºç»„ç½‘ã€æ¨¡æ‹Ÿæ‹“æ‰‘</td>
</tr>
</tbody></table>
<h2 id="âœ…-åˆ¤æ–­ç½‘ç»œæ¨¡å¼"><a href="#âœ…-åˆ¤æ–­ç½‘ç»œæ¨¡å¼" class="headerlink" title="âœ… åˆ¤æ–­ç½‘ç»œæ¨¡å¼"></a>âœ… åˆ¤æ–­ç½‘ç»œæ¨¡å¼</h2><p>ä½ éœ€è¦æ£€æŸ¥è™šæ‹Ÿæœºä½¿ç”¨çš„<strong>ç½‘ç»œè¿æ¥æ–¹å¼</strong>ï¼Œæœ‰å‡ ç§å¸¸è§æ¨¡å¼ï¼š</p>
<table>
<thead>
<tr>
<th>ç½‘ç»œæ¨¡å¼</th>
<th>æ˜¯å¦èƒ½ä¸Šç½‘</th>
<th>æ˜¯å¦èƒ½è¢«ä¸»æœºè®¿é—®</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>NAT</td>
<td>âœ…</td>
<td>âŒ</td>
<td>é»˜è®¤å¯ä»¥ä¸Šç½‘ï¼Œä¸èƒ½è¢«ä¸»æœºè®¿é—®</td>
</tr>
<tr>
<td>æ¡¥æ¥æ¨¡å¼</td>
<td>âœ…</td>
<td>âœ…</td>
<td>ä¸ä¸»æœºåŒç½‘æ®µï¼Œèƒ½ä¸Šç½‘ã€èƒ½äº’é€š</td>
</tr>
<tr>
<td>Host-only</td>
<td>âŒ</td>
<td>âœ…</td>
<td>ä¸èƒ½ä¸Šç½‘ï¼Œåªèƒ½ä¸»æœºè®¿é—®</td>
</tr>
<tr>
<td>å†…éƒ¨ç½‘ç»œï¼ˆä»…é™è™šæ‹Ÿæœºï¼‰</td>
<td>âŒ</td>
<td>âŒ</td>
<td>ç”¨äºå¤šè™šæ‹Ÿæœºå†…éƒ¨é€šä¿¡</td>
</tr>
</tbody></table>
<blockquote>
<h2 id="1ï¸âƒ£-NAT-æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰"><a href="#1ï¸âƒ£-NAT-æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰" class="headerlink" title="1ï¸âƒ£ NAT æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰"></a>1ï¸âƒ£ <strong>NAT æ¨¡å¼</strong>ï¼ˆé»˜è®¤ï¼‰</h2><blockquote>
<p>è™šæ‹Ÿæœºé€šè¿‡ VMware NAT æœåŠ¡å…±äº«ä¸»æœºç½‘ç»œè®¿é—®å¤–ç½‘</p>
</blockquote>
<h3 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h3><ul>
<li>è™šæ‹Ÿæœº IP æ˜¯ <code>192.168.200.x</code> ä¹‹ç±»çš„ VMware è™šæ‹Ÿç½‘æ®µ</li>
<li>å®¿ä¸»æœºå……å½“â€œè·¯ç”±å™¨â€è§’è‰²</li>
<li>é€‚åˆéœ€è¦ä¸Šç½‘ï¼Œä½†ä¸æƒ³æš´éœ²è™šæ‹Ÿæœºåˆ°å¤–éƒ¨ç½‘ç»œ</li>
</ul>
<h3 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h3><ul>
<li>æ— éœ€ç‰¹æ®Šé…ç½®å³å¯è®¿é—®å¤–ç½‘</li>
<li>å®‰å…¨ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®è™šæ‹Ÿæœº</li>
</ul>
<h3 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h3><ul>
<li>å¤–éƒ¨æœºå™¨ï¼ˆåŒ…æ‹¬å®¿ä¸»æœºï¼‰<strong>æ— æ³•ç›´æ¥ ping é€šè™šæ‹Ÿæœº</strong></li>
<li>è™šæ‹Ÿæœº IP ä¸ç¨³å®š</li>
</ul>
<h2 id="2ï¸âƒ£-æ¡¥æ¥æ¨¡å¼ï¼ˆBridgedï¼‰"><a href="#2ï¸âƒ£-æ¡¥æ¥æ¨¡å¼ï¼ˆBridgedï¼‰" class="headerlink" title="2ï¸âƒ£ æ¡¥æ¥æ¨¡å¼ï¼ˆBridgedï¼‰"></a>2ï¸âƒ£ <strong>æ¡¥æ¥æ¨¡å¼ï¼ˆBridgedï¼‰</strong></h2><blockquote>
<p>è™šæ‹ŸæœºåƒçœŸå®ç”µè„‘ä¸€æ ·è¿æ¥åˆ°å±€åŸŸç½‘ï¼ˆé€šè¿‡å®¿ä¸»æœºçš„ç‰©ç†ç½‘å¡æ¡¥æ¥å‡ºå»ï¼‰</p>
</blockquote>
<h3 id="ç‰¹ç‚¹ï¼š-1"><a href="#ç‰¹ç‚¹ï¼š-1" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h3><ul>
<li>è™šæ‹Ÿæœº IP å’Œå®¿ä¸»æœºä¸€æ ·ï¼Œéƒ½ç”±è·¯ç”±å™¨åˆ†é…ï¼ˆæ¯”å¦‚ <code>192.168.31.x</code>ï¼‰</li>
<li>å¯ä»¥ç›´æ¥ä¸å®¿ä¸»æœºã€å±€åŸŸç½‘å…¶ä»–è®¾å¤‡é€šä¿¡</li>
</ul>
<h3 id="ä¼˜ç‚¹ï¼š-1"><a href="#ä¼˜ç‚¹ï¼š-1" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h3><ul>
<li>å’ŒçœŸå®ç”µè„‘ä¸€æ ·ï¼Œå¯ä»¥è¢« ping é€šã€è¿œç¨‹è®¿é—®ã€éƒ¨ç½²æœåŠ¡ç­‰</li>
<li>æœ€è´´è¿‘çœŸå®ç½‘ç»œç¯å¢ƒï¼Œé€‚åˆæœåŠ¡å™¨å¼€å‘</li>
</ul>
<h3 id="ç¼ºç‚¹ï¼š-1"><a href="#ç¼ºç‚¹ï¼š-1" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h3><ul>
<li>ä¾èµ–ç‰©ç†ç½‘ç»œï¼ˆå°¤å…¶ Wi-Fi æ¡¥æ¥æ—¶å¯èƒ½å¤±è´¥ï¼‰</li>
<li>å…¬å¸&#x2F;å­¦æ ¡ç½‘ç»œå¯èƒ½å±è”½æ¡¥æ¥</li>
</ul>
<h2 id="3ï¸âƒ£-ä»…ä¸»æœºæ¨¡å¼ï¼ˆHost-Onlyï¼‰"><a href="#3ï¸âƒ£-ä»…ä¸»æœºæ¨¡å¼ï¼ˆHost-Onlyï¼‰" class="headerlink" title="3ï¸âƒ£ ä»…ä¸»æœºæ¨¡å¼ï¼ˆHost-Onlyï¼‰"></a>3ï¸âƒ£ <strong>ä»…ä¸»æœºæ¨¡å¼ï¼ˆHost-Onlyï¼‰</strong></h2><blockquote>
<p>è™šæ‹Ÿæœºåªèƒ½å’Œå®¿ä¸»æœºé€šä¿¡ï¼Œå®Œå…¨ä¸å¤–ç½‘éš”ç¦»</p>
</blockquote>
<h3 id="ç‰¹ç‚¹ï¼š-2"><a href="#ç‰¹ç‚¹ï¼š-2" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h3><ul>
<li>è™šæ‹Ÿæœº IP é€šå¸¸æ˜¯ <code>192.168.56.x</code> æˆ– <code>192.168.152.x</code></li>
<li>ä¸èƒ½è®¿é—®äº’è”ç½‘</li>
</ul>
<h3 id="ä¼˜ç‚¹ï¼š-2"><a href="#ä¼˜ç‚¹ï¼š-2" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h3><ul>
<li>å®‰å…¨ï¼Œå®Œå…¨ç¦»çº¿éš”ç¦»</li>
<li>è™šæ‹Ÿæœºå’Œä¸»æœºä¹‹é—´èƒ½ç¨³å®šé€šä¿¡ï¼ˆåšæµ‹è¯•éå¸¸å¥½ï¼‰</li>
</ul>
<h3 id="ç¼ºç‚¹ï¼š-2"><a href="#ç¼ºç‚¹ï¼š-2" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h3><ul>
<li>æ— æ³•è®¿é—®å¤–ç½‘</li>
<li>æ— æ³•è¢«å¤–éƒ¨è®¾å¤‡è®¿é—®</li>
</ul>
<h2 id="4ï¸âƒ£-è‡ªå®šä¹‰è™šæ‹Ÿç½‘ç»œï¼ˆVMnet0-19ï¼‰"><a href="#4ï¸âƒ£-è‡ªå®šä¹‰è™šæ‹Ÿç½‘ç»œï¼ˆVMnet0-19ï¼‰" class="headerlink" title="4ï¸âƒ£ è‡ªå®šä¹‰è™šæ‹Ÿç½‘ç»œï¼ˆVMnet0~19ï¼‰"></a>4ï¸âƒ£ <strong>è‡ªå®šä¹‰è™šæ‹Ÿç½‘ç»œï¼ˆVMnet0~19ï¼‰</strong></h2><blockquote>
<p>é«˜çº§ç”¨æˆ·ä½¿ç”¨ï¼Œå¯è‡ªç”±é…ç½®ç½‘ç»œç»“æ„</p>
</blockquote>
<h3 id="å…¸å‹ç”¨é€”ï¼š"><a href="#å…¸å‹ç”¨é€”ï¼š" class="headerlink" title="å…¸å‹ç”¨é€”ï¼š"></a>å…¸å‹ç”¨é€”ï¼š</h3><ul>
<li>å¤šå°è™šæ‹Ÿæœºç»„æˆä¸“å±å±€åŸŸç½‘</li>
<li>é…ç½® DHCPã€NATã€Host-Only æ··åˆç½‘ç»œ</li>
<li>æ„å»ºæ¨¡æ‹Ÿæ•°æ®ä¸­å¿ƒã€ç§æœ‰äº‘ã€å ¡å’æœºç¯å¢ƒç­‰</li>
</ul>
<h2 id="ğŸ¯-æ€»ç»“å»ºè®®ï¼ˆé€‚åˆä¸åŒåœºæ™¯ï¼‰ï¼š"><a href="#ğŸ¯-æ€»ç»“å»ºè®®ï¼ˆé€‚åˆä¸åŒåœºæ™¯ï¼‰ï¼š" class="headerlink" title="ğŸ¯ æ€»ç»“å»ºè®®ï¼ˆé€‚åˆä¸åŒåœºæ™¯ï¼‰ï¼š"></a>ğŸ¯ æ€»ç»“å»ºè®®ï¼ˆé€‚åˆä¸åŒåœºæ™¯ï¼‰ï¼š</h2><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>å»ºè®®ä½¿ç”¨æ¨¡å¼</th>
</tr>
</thead>
<tbody><tr>
<td>æ—¥å¸¸ä½¿ç”¨ã€èƒ½ä¸Šç½‘å³å¯</td>
<td>NAT æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰</td>
</tr>
<tr>
<td>å¼€å‘æœåŠ¡ç«¯ã€éœ€è¦å›ºå®š IP + è¢«è®¿é—®</td>
<td>æ¡¥æ¥æ¨¡å¼ âœ…</td>
</tr>
<tr>
<td>åªåœ¨ä¸»æœºå’Œè™šæ‹Ÿæœºä¹‹é—´é€šä¿¡</td>
<td>Host-Only æ¨¡å¼</td>
</tr>
<tr>
<td>å¤šè™šæ‹Ÿæœºæ¨¡æ‹Ÿå¤æ‚ç½‘ç»œ</td>
<td>è‡ªå®šä¹‰ï¼ˆVMnetï¼‰</td>
</tr>
</tbody></table>
<h2 id="ğŸ“Œ-ä¸€å¥è¯æ€»ç»“ï¼š"><a href="#ğŸ“Œ-ä¸€å¥è¯æ€»ç»“ï¼š" class="headerlink" title="ğŸ“Œ ä¸€å¥è¯æ€»ç»“ï¼š"></a>ğŸ“Œ ä¸€å¥è¯æ€»ç»“ï¼š</h2><p><strong>NAT æ˜¯â€œå†…ç½‘è®¿é—®å¤–ç½‘â€ï¼Œæ¡¥æ¥æ˜¯â€œè™šæ‹Ÿæœºç­‰äºçœŸç”µè„‘â€ï¼ŒHost-Only æ˜¯â€œæˆ‘åªå’Œä¸»æœºè¯´è¯â€ï¼Œè‡ªå®šä¹‰æ˜¯â€œä½ è¯´äº†ç®—â€ã€‚</strong></p>
</blockquote>
<h2 id="ç¯å¢ƒå‡†å¤‡-2-â€”Dockerfileé•œåƒè„šæœ¬å¿«é€Ÿå…¥é—¨"><a href="#ç¯å¢ƒå‡†å¤‡-2-â€”Dockerfileé•œåƒè„šæœ¬å¿«é€Ÿå…¥é—¨" class="headerlink" title="ç¯å¢ƒå‡†å¤‡(2)â€”Dockerfileé•œåƒè„šæœ¬å¿«é€Ÿå…¥é—¨"></a>ç¯å¢ƒå‡†å¤‡(2)â€”Dockerfileé•œåƒè„šæœ¬å¿«é€Ÿå…¥é—¨</h2><p>Dockerfileå…¶å®å°±æ˜¯æˆ‘ä»¬ç”¨æ¥æ„å»ºDockeré•œåƒçš„æºç ï¼Œå½“ç„¶è¿™ä¸æ˜¯æ‰€è°“çš„ç¼–ç¨‹æºç ï¼Œè€Œæ˜¯ä¸€äº›å‘½ä»¤çš„ç»„ åˆï¼Œåªè¦ç†è§£å®ƒçš„é€»è¾‘å’Œè¯­æ³•æ ¼å¼ï¼Œå°±å¯ä»¥ç¼–å†™Dockerfileäº†ã€‚ ç®€å•ç‚¹è¯´ï¼ŒDockerfileçš„ä½œç”¨ï¼šå®ƒå¯ä»¥è®©ç”¨æˆ·ä¸ªæ€§åŒ–å®šåˆ¶Dockeré•œåƒã€‚å› ä¸ºå·¥ä½œç¯å¢ƒä¸­çš„éœ€æ±‚å„å¼å„ æ ·ï¼Œç½‘ç»œä¸Šçš„é•œåƒå¾ˆéš¾æ»¡è¶³å®é™…çš„éœ€æ±‚ã€‚</p>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>FROM image_name:tag</td>
<td></td>
</tr>
<tr>
<td>MAINTAINER user_name</td>
<td>å£°æ˜é•œåƒçš„ä½œè€…</td>
</tr>
<tr>
<td>ENV key value</td>
<td>è®¾ç½®ç¯å¢ƒå˜é‡(å¯ä»¥å†™å¤šæ¡)</td>
</tr>
<tr>
<td>RUN command</td>
<td>ç¼–è¯‘é•œåƒæ—¶è¿è¡Œçš„è„šæœ¬(å¯ä»¥å†™å¤šæ¡)</td>
</tr>
<tr>
<td>CMD</td>
<td>è®¾ç½®å®¹å™¨çš„å¯åŠ¨å‘½ä»¤</td>
</tr>
<tr>
<td>ENTRYPOINT</td>
<td>è®¾ç½®å®¹å™¨çš„å…¥å£ç¨‹åº</td>
</tr>
<tr>
<td>ADD source_dir&#x2F;file dest_dir&#x2F;file</td>
<td>å°†å®¿ä¸»æœºçš„æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨å†…ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ã€‚å°†ä¼šåœ¨å¤åˆ¶åè‡ªåŠ¨è§£å‹</td>
</tr>
<tr>
<td>COPY source_dir&#x2F;file dest_dir&#x2F;file</td>
<td>å’ŒADDç›¸ä¼¼ï¼Œä½†æ˜¯å¦‚æœåˆå‹ç¼©æ–‡ä»¶å¹¶ä¸èƒ½è§£å‹</td>
</tr>
<tr>
<td>WORKDIR path_dir</td>
<td>è®¾ç½®å·¥ä½œç›®å½•</td>
</tr>
<tr>
<td>ARG</td>
<td>è®¾ç½®ç¼–è¯‘é•œåƒæ—¶åŠ å…¥çš„å‚æ•°</td>
</tr>
<tr>
<td>VOLUMN</td>
<td>è®¾ç½®å®¹å™¨çš„æŒ‚è½½å·</td>
</tr>
</tbody></table>
<p>æ–°é•œåƒæ˜¯ä»åŸºç¡€é•œåƒä¸€å±‚ä¸€å±‚å åŠ ç”Ÿæˆçš„ã€‚æ¯å®‰è£…ä¸€ä¸ªè½¯ä»¶ï¼Œå°±åœ¨ç°æœ‰é•œåƒçš„åŸºç¡€ä¸Šå¢åŠ ä¸€ å±‚</p>
<h5 id="ä½¿ç”¨Dockerfileåˆ¶ä½œå¾®æœåŠ¡é•œåƒ"><a href="#ä½¿ç”¨Dockerfileåˆ¶ä½œå¾®æœåŠ¡é•œåƒ" class="headerlink" title="ä½¿ç”¨Dockerfileåˆ¶ä½œå¾®æœåŠ¡é•œåƒ"></a>ä½¿ç”¨Dockerfileåˆ¶ä½œå¾®æœåŠ¡é•œåƒ</h5><p>æˆ‘ä»¬åˆ©ç”¨Dockerfileåˆ¶ä½œä¸€ä¸ªEurekaæ³¨å†Œä¸­å¿ƒçš„é•œåƒ </p>
<p>1ï¼‰ä¸Šä¼ Eurekaçš„å¾®æœåŠ¡jaråŒ…åˆ°linux<del>è¿™é‡Œçš„jaråŒ…è¦å’ŒDockerfileæ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹</del><br>2ï¼‰ç¼–å†™Dockerfile <code>vi Dockerfile</code></p>
<h6 id="ä½œç”¨-ğŸ“¦-æ„å»ºä¸€ä¸ªç”¨äºè¿è¡Œ-Java-åº”ç”¨ï¼ˆSpring-Boot-æˆ–å…¶ä»–-jar-åº”ç”¨ï¼‰çš„-Docker-é•œåƒã€‚"><a href="#ä½œç”¨-ğŸ“¦-æ„å»ºä¸€ä¸ªç”¨äºè¿è¡Œ-Java-åº”ç”¨ï¼ˆSpring-Boot-æˆ–å…¶ä»–-jar-åº”ç”¨ï¼‰çš„-Docker-é•œåƒã€‚" class="headerlink" title="ä½œç”¨:ğŸ“¦ æ„å»ºä¸€ä¸ªç”¨äºè¿è¡Œ Java åº”ç”¨ï¼ˆSpring Boot æˆ–å…¶ä»– jar åº”ç”¨ï¼‰çš„ Docker é•œåƒã€‚"></a>ä½œç”¨:ğŸ“¦ <strong>æ„å»ºä¸€ä¸ªç”¨äºè¿è¡Œ Java åº”ç”¨ï¼ˆSpring Boot æˆ–å…¶ä»– jar åº”ç”¨ï¼‰çš„ Docker é•œåƒ</strong>ã€‚</h6><p>è¿™ä¸ª Dockerfile æ˜¯åœ¨ç”¨ Java 8 çš„è½»é‡é•œåƒé‡Œï¼Œè¿è¡Œä½ æ‰“åŒ…å¥½çš„ jar åº”ç”¨ï¼Œå¹¶å¯¹å¤–å¼€æ”¾ 10086 ç«¯å£ï¼Œéå¸¸é€‚åˆéƒ¨ç½² Spring Boot é¡¹ç›®ã€‚</p>
<pre><code class="yaml">FROM openjdk:8-jdk-alpine
ARG JAR_FILE
COPY $&#123;JAR_FILE&#125; app.jar
EXPOSE 10086
ENTRYPOINT [&quot;java&quot;,&quot;-Djava.net.preferIPv4Stack=true&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
</code></pre>
<p>3 ï¼‰æ„å»ºé•œåƒ </p>
<p><code>docker build --build-arg JAR_FILE=tensquare_eureka_server-1.0-SNAPSHOT.jar -t eureka:v1 .</code><br><u>-tæ˜¯å®šä¹‰åå­—</u>  <u>.æ˜¯åœ¨å½“å‰ç›®å½•</u><br>4ï¼‰æŸ¥çœ‹é•œåƒæ˜¯å¦åˆ›å»ºæˆåŠŸ </p>
<p><code>docker images </code></p>
<blockquote>
<p>[root@localhost ~]# docker images<br>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE<br>eureka              v1                  36af14603456        15 seconds ago      150MB<br>nginx               latest              9592f5595f2b        7 days ago          192MB<br>hello-world         latest              74cc54e27dc4        5 months ago        10.1kB<br>openjdk             8-jdk-alpine        a3562aa0b991        6 years ago         105MB</p>
</blockquote>
<p>5ï¼‰åˆ›å»ºå®¹å™¨ </p>
<p><code>docker run -i --name=eureka -p 10086:10086 eureka:v1 </code><br><u>åå°è¿è¡Œ</u>ï¼š<code>docker run -d --name=eureka -p 10086:10086 eureka:v1</code></p>
<p>åˆ é™¤å®¹å™¨ï¼š<code>docker rm -f eureka</code><br>æŸ¥çœ‹å®¹å™¨æ˜¯å¦å¯åŠ¨<code>docker ps</code><br>æŸ¥çœ‹æ—¥å¿—<code>docker logs -f eureka</code><br>åé¢å¯ä»¥ç›´æ¥å¯åŠ¨è¿™ä¸ªå®¹å™¨ <code>docker start eureka</code></p>
<p>6ï¼‰è®¿é—®å®¹å™¨ <a target="_blank" rel="noopener" href="http://192.168.200.129:10086/">http://192.168.200.129:10086</a></p>
<blockquote>
<h3 id="ä¿®æ”¹åé‡æ–°æ„å»ºé•œåƒï¼š"><a href="#ä¿®æ”¹åé‡æ–°æ„å»ºé•œåƒï¼š" class="headerlink" title="ä¿®æ”¹åé‡æ–°æ„å»ºé•œåƒï¼š"></a>ä¿®æ”¹åé‡æ–°æ„å»ºé•œåƒï¼š</h3><pre><code>docker stop eureka
docker rm eureka

# é‡æ–°æ„å»ºé•œåƒï¼ˆç¡®ä¿ Dockerfile å’Œé…ç½®æ–‡ä»¶éƒ½åœ¨å½“å‰ç›®å½•ï¼‰
docker build --build-arg JAR_FILE=tensquare_eureka_server-1.0-SNAPSHOT.jar -t eureka:v1 .

# å¯åŠ¨å®¹å™¨å¹¶æ˜ å°„ç«¯å£
docker run -d --name=eureka -p 10086:10086 eureka:v1
</code></pre>
<hr>
<p><strong>è¿›å…¥å®¹å™¨</strong>ï¼ˆä½ å·²ç»ä¼šäº†ï¼‰ï¼š</p>
<pre><code>docker exec -it eureka /bin/sh
</code></pre>
<ol>
<li>**å®¹å™¨å†…æŸ¥æ‰¾ <code>application.yaml</code>**ï¼š</li>
</ol>
<pre><code>find / -name application.yaml 2&gt;/dev/null
</code></pre>
<ul>
<li><code>2&gt;/dev/null</code> æ˜¯æŠŠæƒé™ä¸å¤Ÿæˆ–æ‰¾ä¸åˆ°æ–‡ä»¶æ—¶çš„æŠ¥é”™ä¿¡æ¯è¿‡æ»¤æ‰ï¼Œæ–¹ä¾¿çœ‹ç»“æœã€‚</li>
</ul>
<ol>
<li><strong>æ‰¾åˆ°è·¯å¾„åï¼Œç”¨ <code>cat</code> æŸ¥çœ‹å†…å®¹</strong>ï¼š</li>
</ol>
<p>å‡è®¾æŸ¥åˆ°æ–‡ä»¶åœ¨ <code>/config/application.yaml</code>ï¼Œé‚£ä¹ˆï¼š</p>
<pre><code>cat /config/application.yaml
</code></pre>
<hr>
<p>ä½ è¦åˆ é™¤ <code>&lt;none&gt;</code> çš„é•œåƒï¼Œä¹Ÿå°±æ˜¯â€œæ‚¬ç©ºé•œåƒï¼ˆdangling imageï¼‰â€ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<h3 id="ğŸ”-æŸ¥çœ‹æ‰€æœ‰æ‚¬ç©ºé•œåƒ"><a href="#ğŸ”-æŸ¥çœ‹æ‰€æœ‰æ‚¬ç©ºé•œåƒ" class="headerlink" title="ğŸ” æŸ¥çœ‹æ‰€æœ‰æ‚¬ç©ºé•œåƒ"></a>ğŸ” æŸ¥çœ‹æ‰€æœ‰æ‚¬ç©ºé•œåƒ</h3><pre><code>docker images -f &quot;dangling=true&quot;
</code></pre>
<h3 id="ğŸ—‘-åˆ é™¤æ‰€æœ‰æ‚¬ç©ºé•œåƒ"><a href="#ğŸ—‘-åˆ é™¤æ‰€æœ‰æ‚¬ç©ºé•œåƒ" class="headerlink" title="ğŸ—‘ åˆ é™¤æ‰€æœ‰æ‚¬ç©ºé•œåƒ"></a>ğŸ—‘ åˆ é™¤æ‰€æœ‰æ‚¬ç©ºé•œåƒ</h3><pre><code>docker rmi $(docker images -f &quot;dangling=true&quot; -q)
</code></pre>
<hr>
<p>root@localhost ~]# docker run -d â€“name&#x3D;eureka -p 10086:10086 eureka:v1 docker: Error response from daemon: Conflict. The container name â€œ&#x2F;eurekaâ€ is already in use by container â€œ9ea494448aeb1d99faecfe11e652f438938b87e1caaca890f9001199e1166dbcâ€. You have to remove (or rename) that container to be able to reuse that name. See â€˜docker run â€“helpâ€™. è¿™ä¸ªé”™è¯¯è¯´æ˜ï¼š<strong>è™½ç„¶ä½ å·²ç» <code>docker stop eureka</code> åœæ­¢äº†å®¹å™¨ï¼Œä½†å®ƒè¿˜æ²¡æœ‰è¢«åˆ é™¤</strong>ï¼Œæ‰€ä»¥å®¹å™¨å <code>/eureka</code> ä¾ç„¶å ç”¨ä¸­ï¼Œä¸èƒ½å†ç”¨è¿™ä¸ªåå­—å¯åŠ¨æ–°çš„å®¹å™¨ã€‚</p>
<h3 id="âœ…-è§£å†³æ–¹æ¡ˆï¼šåˆ é™¤æ—§å®¹å™¨"><a href="#âœ…-è§£å†³æ–¹æ¡ˆï¼šåˆ é™¤æ—§å®¹å™¨" class="headerlink" title="âœ… è§£å†³æ–¹æ¡ˆï¼šåˆ é™¤æ—§å®¹å™¨"></a>âœ… è§£å†³æ–¹æ¡ˆï¼šåˆ é™¤æ—§å®¹å™¨</h3><p>ä½ éœ€è¦å…ˆ <strong>åˆ é™¤å·²åœæ­¢çš„ <code>eureka</code> å®¹å™¨</strong>ï¼Œå†é‡æ–°å¯åŠ¨ï¼š</p>
<pre><code>docker rm eureka
</code></pre>
<p>ç„¶åå†é‡æ–°è¿è¡Œæ–°çš„å®¹å™¨ï¼š</p>
<pre><code>docker run -d --name=eureka -p 10086:10086 eureka:v1
</code></pre>
<hr>
<p>æ˜¯æ¡¥æ¥ èƒ½pingé€š é˜²ç«å¢™æ°¸ä¹…å…³é—­äº† æœ¬æœºæ‰“å¼€äº†clashç³»ç»Ÿä»£ç†+å…¨å±€</p>
<h6 id="ChatGPT-è¯´ï¼š"><a href="#ChatGPT-è¯´ï¼š" class="headerlink" title="ChatGPT è¯´ï¼š"></a>ChatGPT è¯´ï¼š</h6><p>éå¸¸å…³é”®çš„ç‚¹æ¥äº†ï¼</p>
<p>ä½ è¯´ï¼š</p>
<p>âœ… è™šæ‹Ÿæœºæ˜¯æ¡¥æ¥æ¨¡å¼<br> âœ… èƒ½ ping é€šè™šæ‹Ÿæœº <code>192.168.200.129</code><br> âœ… é˜²ç«å¢™æ˜¯æ°¸ä¹…å…³é—­çŠ¶æ€<br> âŒ <strong>æœ¬æœºæ‰“å¼€äº† Clash å¹¶å¯ç”¨äº†ç³»ç»Ÿä»£ç† + å…¨å±€æ¨¡å¼</strong></p>
<hr>
<h3 id="âœ…-ä½ çš„-Eureka-æœåŠ¡é…ç½®å’Œå®¹å™¨å¯åŠ¨éƒ½æ˜¯æ­£ç¡®çš„ï¼Œé—®é¢˜ç°åœ¨å°±å‡ºåœ¨ï¼šä½ æœ¬æœºå¼€å¯äº†-Clash-çš„å…¨å±€ä»£ç†ã€‚"><a href="#âœ…-ä½ çš„-Eureka-æœåŠ¡é…ç½®å’Œå®¹å™¨å¯åŠ¨éƒ½æ˜¯æ­£ç¡®çš„ï¼Œé—®é¢˜ç°åœ¨å°±å‡ºåœ¨ï¼šä½ æœ¬æœºå¼€å¯äº†-Clash-çš„å…¨å±€ä»£ç†ã€‚" class="headerlink" title="âœ… ä½ çš„ Eureka æœåŠ¡é…ç½®å’Œå®¹å™¨å¯åŠ¨éƒ½æ˜¯æ­£ç¡®çš„ï¼Œé—®é¢˜ç°åœ¨å°±å‡ºåœ¨ï¼šä½ æœ¬æœºå¼€å¯äº† Clash çš„å…¨å±€ä»£ç†ã€‚"></a>âœ… ä½ çš„ Eureka æœåŠ¡é…ç½®å’Œå®¹å™¨å¯åŠ¨éƒ½æ˜¯æ­£ç¡®çš„ï¼Œé—®é¢˜ç°åœ¨å°±å‡ºåœ¨ï¼š<strong>ä½ æœ¬æœºå¼€å¯äº† Clash çš„å…¨å±€ä»£ç†ã€‚</strong></h3><h3 id="â—è¿™ä¼šå¯¼è‡´æµè§ˆå™¨è¯·æ±‚èµ°ä»£ç†ï¼Œæ— æ³•è®¿é—®å†…ç½‘åœ°å€ï¼ˆä¾‹å¦‚-192-168-200-129-10086ï¼‰ã€‚"><a href="#â—è¿™ä¼šå¯¼è‡´æµè§ˆå™¨è¯·æ±‚èµ°ä»£ç†ï¼Œæ— æ³•è®¿é—®å†…ç½‘åœ°å€ï¼ˆä¾‹å¦‚-192-168-200-129-10086ï¼‰ã€‚" class="headerlink" title="â—è¿™ä¼šå¯¼è‡´æµè§ˆå™¨è¯·æ±‚èµ°ä»£ç†ï¼Œæ— æ³•è®¿é—®å†…ç½‘åœ°å€ï¼ˆä¾‹å¦‚ 192.168.200.129:10086ï¼‰ã€‚"></a>â—è¿™ä¼šå¯¼è‡´æµè§ˆå™¨è¯·æ±‚èµ°ä»£ç†ï¼Œ<strong>æ— æ³•è®¿é—®å†…ç½‘åœ°å€</strong>ï¼ˆä¾‹å¦‚ <code>192.168.200.129:10086</code>ï¼‰ã€‚</h3><hr>
<h5 id="åˆ é™¤é•œåƒï¼šdocker-rmi-eureka-v1"><a href="#åˆ é™¤é•œåƒï¼šdocker-rmi-eureka-v1" class="headerlink" title="åˆ é™¤é•œåƒï¼šdocker rmi eureka:v1"></a>åˆ é™¤é•œåƒï¼š<code>docker rmi eureka:v1</code></h5><p>åˆ é™¤æ‰€æœ‰æ‚¬æŒ‚é•œåƒï¼š&lt; none &gt;çš„ <code>docker images | grep &quot;&lt;none&gt;&quot; | awk &#39;&#123;print $3&#125;&#39; | xargs -r docker rmi -f</code></p>
<hr>
<hr>
<p><code>ss -tlnp | grep 10086</code>âœ… ä½ çœ‹åˆ°çš„æ˜¯ï¼š</p>
<pre><code>LISTEN     0      1024        :::10086                   :::*                   users:((&quot;docker-proxy&quot;,pid=31831,fd=4))
</code></pre>
<h3 id="ğŸ“Œ-è¯´æ˜ï¼š"><a href="#ğŸ“Œ-è¯´æ˜ï¼š" class="headerlink" title="ğŸ“Œ è¯´æ˜ï¼š"></a>ğŸ“Œ è¯´æ˜ï¼š</h3><p>è¿™æ˜¯ <strong>å®¿ä¸»æœºä¸Šçš„ docker-proxy</strong> åœ¨ç›‘å¬ <code>10086</code> ç«¯å£ï¼Œ<strong>å®ƒåªæ˜¯ç«¯å£æ˜ å°„çš„å¤–å£³è¿›ç¨‹</strong>ã€‚</p>
<p>ä½†æˆ‘ä»¬<strong>æ²¡æœ‰çœ‹åˆ°ä½ å®¹å™¨å†…éƒ¨çš„ Spring Boot åº”ç”¨æ˜¯å¦åœ¨ç›‘å¬ç«¯å£</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<blockquote>
<p>âœ… <strong>docker-proxy æ˜ å°„æ˜¯ OK çš„</strong><br> â—ï¸<strong>å®¹å™¨é‡Œçš„ Spring Boot å¯èƒ½ç»‘å®šäº† <code>127.0.0.1:10086</code>ï¼Œä¸æ˜¯ <code>0.0.0.0:10086</code>ï¼Œå¯¼è‡´ proxy è½¬å‘è¿‡å»å¤±è´¥</strong></p>
</blockquote>
<hr>
<h2 id="âœ…-è§£å†³æ–¹æ¡ˆ-â€”â€”-ä¿®æ”¹é…ç½®ï¼Œæ˜¾å¼ç»‘å®š-0-0-0-0"><a href="#âœ…-è§£å†³æ–¹æ¡ˆ-â€”â€”-ä¿®æ”¹é…ç½®ï¼Œæ˜¾å¼ç»‘å®š-0-0-0-0" class="headerlink" title="âœ… è§£å†³æ–¹æ¡ˆ â€”â€” ä¿®æ”¹é…ç½®ï¼Œæ˜¾å¼ç»‘å®š 0.0.0.0"></a>âœ… è§£å†³æ–¹æ¡ˆ â€”â€” ä¿®æ”¹é…ç½®ï¼Œæ˜¾å¼ç»‘å®š <code>0.0.0.0</code></h2><p>è¯· **ä¿®æ”¹ä½ çš„ <code>application.yml</code>**ï¼Œåœ¨ <code>server</code> é…ç½®ä¸­æ·»åŠ è¿™ä¸€è¡Œï¼š</p>
<pre><code>yamlå¤åˆ¶ç¼–è¾‘server:
  port: 10086
  address: 0.0.0.0  # &lt;-- æ˜¾å¼ç›‘å¬æ‰€æœ‰ç½‘å¡åœ°å€
</code></pre>
<hr>
<hr>
<p>[root@localhost ~]# netstat -tln<br>Active Internet connections (only servers)<br>Proto Recv-Q Send-Q Local Address           Foreign Address         State<br>tcp        0      0 127.0.0.1:9100          0.0.0.0:*               LISTEN<br>tcp        0      0 127.0.0.1:9229          0.0.0.0:*               LISTEN<br>tcp        0      0 127.0.0.1:8080          0.0.0.0:*               LISTEN<br>tcp        0      0 127.0.0.1:9168          0.0.0.0:*               LISTEN<br>tcp        0      0 127.0.0.1:8082          0.0.0.0:*               LISTEN<br>tcp        0      0 0.0.0.0:82              0.0.0.0:*               LISTEN<br>tcp        0      0 127.0.0.1:9236          0.0.0.0:*               LISTEN<br>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN<br>tcp        0      0 127.0.0.1:3000          0.0.0.0:*               LISTEN<br>tcp        0      0 0.0.0.0:8060            0.0.0.0:*               LISTEN<br>tcp        0      0 127.0.0.1:9121          0.0.0.0:*               LISTEN<br>tcp        0      0 127.0.0.1:9090          0.0.0.0:*               LISTEN<br>tcp        0      0 127.0.0.1:9187          0.0.0.0:*               LISTEN<br>tcp        0      0 127.0.0.1:9093          0.0.0.0:*               LISTEN<br>tcp6       0      0 :::3306                 :::*                    LISTEN<br>tcp6       0      0 ::1:9168                :::*                    LISTEN<br>tcp6       0      0 :::22                   :::*                    LISTEN<br>tcp6       0      0 :::10086                :::*                    LISTEN<br>tcp6       0      0 :::9094                 :::*                    LISTEN</p>
<p>ä½ è´´çš„ <code>netstat -tln</code> ç»“æœè¯´æ˜ï¼š</p>
<ul>
<li>ä½ çš„æœåŠ¡ç›‘å¬åœ¨ <strong><code>:::10086</code>ï¼ˆIPv6çš„æ‰€æœ‰åœ°å€ï¼‰</strong>ï¼Œæ²¡æœ‰ç›‘å¬ä»»ä½•IPv4åœ°å€ï¼ˆæ¯”å¦‚<code>0.0.0.0:10086</code>ï¼‰</li>
<li>è¿™æ„å‘³ç€ä½ çš„Spring Bootåº”ç”¨åªç›‘å¬äº†IPv6åœ°å€ï¼ŒIPv4è®¿é—®å°±æ— æ³•è¿æ¥ï¼ˆæ‰€ä»¥ä½ ç”¨ <code>http://192.168.200.129:10086</code> è®¿é—®ä¼šå¤±è´¥ï¼‰</li>
</ul>
<h3 id="å…·ä½“åšæ³•ï¼š"><a href="#å…·ä½“åšæ³•ï¼š" class="headerlink" title="å…·ä½“åšæ³•ï¼š"></a>å…·ä½“åšæ³•ï¼š</h3><ol>
<li>ä¿®æ”¹ä½ çš„ <code>Dockerfile</code> ä¸­ <code>ENTRYPOINT</code>ï¼š</li>
</ol>
<pre><code class="java">FROM openjdk:8-jdk-alpine
ARG JAR_FILE
COPY $&#123;JAR_FILE&#125; app.jar
EXPOSE 10086
ENTRYPOINT [&quot;java&quot;,&quot;-Djava.net.preferIPv4Stack=true&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]
</code></pre>
<h2 id="2-æ„å»ºæ–°é•œåƒï¼ˆå»ºè®®æ‰“æ–°æ ‡ç­¾ï¼‰"><a href="#2-æ„å»ºæ–°é•œåƒï¼ˆå»ºè®®æ‰“æ–°æ ‡ç­¾ï¼‰" class="headerlink" title="2. æ„å»ºæ–°é•œåƒï¼ˆå»ºè®®æ‰“æ–°æ ‡ç­¾ï¼‰"></a>2. æ„å»ºæ–°é•œåƒï¼ˆå»ºè®®æ‰“æ–°æ ‡ç­¾ï¼‰</h2><pre><code>docker build --build-arg JAR_FILE=tensquare_eureka_server-1.0-SNAPSHOT.jar -t eureka:v2 .
</code></pre>
<hr>
<h2 id="3-åœæ­¢å¹¶åˆ é™¤æ—§å®¹å™¨ï¼ˆå¦‚æœè¿˜åœ¨è¿è¡Œï¼‰"><a href="#3-åœæ­¢å¹¶åˆ é™¤æ—§å®¹å™¨ï¼ˆå¦‚æœè¿˜åœ¨è¿è¡Œï¼‰" class="headerlink" title="3. åœæ­¢å¹¶åˆ é™¤æ—§å®¹å™¨ï¼ˆå¦‚æœè¿˜åœ¨è¿è¡Œï¼‰"></a>3. åœæ­¢å¹¶åˆ é™¤æ—§å®¹å™¨ï¼ˆå¦‚æœè¿˜åœ¨è¿è¡Œï¼‰</h2><pre><code>docker stop eureka
docker rm eureka
</code></pre>
<hr>
<h2 id="4-è¿è¡Œæ–°é•œåƒå®¹å™¨"><a href="#4-è¿è¡Œæ–°é•œåƒå®¹å™¨" class="headerlink" title="4. è¿è¡Œæ–°é•œåƒå®¹å™¨"></a>4. è¿è¡Œæ–°é•œåƒå®¹å™¨</h2><pre><code>docker run -d -p 10086:10086 --name eureka eureka:v2
</code></pre>
<h2 id="6-æµ‹è¯•è®¿é—®"><a href="#6-æµ‹è¯•è®¿é—®" class="headerlink" title="6. æµ‹è¯•è®¿é—®"></a>6. æµ‹è¯•è®¿é—®</h2><p>æµè§ˆå™¨æ‰“å¼€ï¼š</p>
<pre><code>http://192.168.200.129:10086
</code></pre>
<hr>
<hr>
<hr>
<p>ç°åœ¨å¯ä»¥è®¿é—®æˆåŠŸäº†  ä¸ºä»€ä¹ˆåŠ ä¸Šè¿™å¥è¯å°±å¥½äº† ENTRYPOINT [â€œjavaâ€,â€-Djava.net.preferIPv4Stack&#x3D;trueâ€,â€-jarâ€,â€&#x2F;app.jarâ€] ä¸ºä»€ä¹ˆç›‘å¬çš„æ—¶å€™è¿˜æ˜¯ipv6 [root@localhost ~]# ss -tlnp | grep 10086 LISTEN     0      1024        :::10086                   :::*                   users:((â€œdocker-proxyâ€,pid&#x3D;35209,fd&#x3D;4)) ä½†æ˜¯æˆåŠŸåœ¨ä¸»æœºè®¿é—®åœ°å€äº†</p>
<h6 id="ä¸ºä»€ä¹ˆåŠ ä¸Š-Djava-net-preferIPv4Stack-true-å°±å¥½äº†ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆåŠ ä¸Š-Djava-net-preferIPv4Stack-true-å°±å¥½äº†ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆåŠ ä¸Š -Djava.net.preferIPv4Stack=true å°±å¥½äº†ï¼Ÿ"></a>ä¸ºä»€ä¹ˆåŠ ä¸Š <code>-Djava.net.preferIPv4Stack=true</code> å°±å¥½äº†ï¼Ÿ</h6><ul>
<li>è¿™ä¸ªå‚æ•°å‘Šè¯‰ JVM <strong>ä¼˜å…ˆä½¿ç”¨ IPv4 ç½‘ç»œæ ˆ</strong>ï¼Œé¿å…åªç›‘å¬ IPv6 å¯¼è‡´å¤–éƒ¨ IPv4 åœ°å€è®¿é—®ä¸åˆ°çš„é—®é¢˜ã€‚</li>
<li>Spring Boot çš„å†…åµŒ Tomcat åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinux å¯èƒ½ä¼˜å…ˆç›‘å¬ IPv6 åœ°å€ï¼ˆ<code>:::port</code>ï¼‰ã€‚</li>
<li>åŠ äº†è¿™ä¸ªå‚æ•°åï¼ŒTomcat ä¼šä¼˜å…ˆç»‘å®š IPv4 åœ°å€ï¼Œä»è€Œç¡®ä¿ Docker çš„ç«¯å£æ˜ å°„èƒ½æ­£å¸¸è¢«å¤–éƒ¨ IPv4 ç½‘ç»œè®¿é—®ã€‚</li>
</ul>
<hr>
<h3 id="ä¸ºä»€ä¹ˆç›‘å¬æ—¶è¿˜æ˜¯æ˜¾ç¤º-IPv6-10086-ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆç›‘å¬æ—¶è¿˜æ˜¯æ˜¾ç¤º-IPv6-10086-ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆç›‘å¬æ—¶è¿˜æ˜¯æ˜¾ç¤º IPv6 (:::10086)ï¼Ÿ"></a>ä¸ºä»€ä¹ˆç›‘å¬æ—¶è¿˜æ˜¯æ˜¾ç¤º IPv6 (<code>:::10086</code>)ï¼Ÿ</h3><ul>
<li>Linux ä¸Š IPv6 çš„ç›‘å¬å¥—æ¥å­— <code>:::</code> é»˜è®¤æ˜¯åŒ…å« IPv4 åœ°å€ <code>0.0.0.0</code> çš„ï¼ˆå«åš IPv4-mapped IPv6 åœ°å€ï¼‰ã€‚</li>
<li>ä¹Ÿå°±æ˜¯è¯´ï¼Œç›‘å¬ <code>:::10086</code> å®é™…ä¸ŠåŒæ—¶ç›‘å¬äº†æ‰€æœ‰ IPv6 å’Œ IPv4 åœ°å€ã€‚</li>
<li>è¿™æ˜¯ä¸€ç§æ“ä½œç³»ç»Ÿå±‚é¢çš„æœºåˆ¶ï¼Œä¸æ˜¯ Java å±‚é¢çš„é—®é¢˜ã€‚</li>
</ul>
<hr>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul>
<li><strong><code>-Djava.net.preferIPv4Stack=true</code></strong> è®© JVM ä¾§ä¼˜å…ˆç”¨ IPv4ï¼Œé¿å…äº†çº¯ IPv6 ç›‘å¬å¸¦æ¥çš„è®¿é—®é—®é¢˜ã€‚</li>
<li><strong><code>ss</code> çœ‹åˆ°çš„ <code>:::10086</code> å…¶å®ä¹ŸåŒ…æ‹¬äº† IPv4 åœ°å€</strong>ï¼Œæ‰€ä»¥ä½ æ‰èƒ½ç”¨ IPv4 åœ°å€æˆåŠŸè®¿é—®ã€‚</li>
<li>è®¿é—®æˆåŠŸè¯´æ˜ç½‘ç»œå’Œç«¯å£æ˜ å°„éƒ½æ­£å¸¸å·¥ä½œäº†ã€‚</li>
</ul>
<hr>
<hr>
<p>å¤ªå¥½äº†ï¼Œä½ ç°åœ¨å·²ç»éå¸¸æ¥è¿‘æˆåŠŸäº†ï¼Œæˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹ç°çŠ¶å’Œå¦‚ä½•è§£å†³ä½ â€œ<strong>æ—¢èƒ½è”ç½‘åˆèƒ½ç”¨ Mobaxterm è¿ä¸Šè™šæ‹Ÿæœº</strong>â€çš„é—®é¢˜ã€‚</p>
<hr>
<h2 id="âœ…-å½“å‰çŠ¶æ€åˆ†æ"><a href="#âœ…-å½“å‰çŠ¶æ€åˆ†æ" class="headerlink" title="âœ… å½“å‰çŠ¶æ€åˆ†æ"></a>âœ… å½“å‰çŠ¶æ€åˆ†æ</h2><p>ä½ ç›®å‰æœ‰ä¸¤å¼ ç½‘å¡ï¼š</p>
<table>
<thead>
<tr>
<th>ç½‘å¡å</th>
<th>IP åœ°å€</th>
<th>çŠ¶æ€</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>ens33</code></td>
<td><code>192.168.200.131</code></td>
<td>âœ… UPï¼Œæœ‰ IP</td>
<td>æ˜¯ä½ åŸæ¥çš„æ¡¥æ¥æˆ– Host-Only ç½‘å¡ï¼Œç”¨äºä¸»æœºè¿è™šæ‹Ÿæœº</td>
</tr>
<tr>
<td><code>ens36</code></td>
<td>æ—  IP</td>
<td>âŒ DOWN</td>
<td>æ˜¯ä½ æ–°åŠ çš„ NAT ç½‘å¡ï¼Œä½† <strong>æ²¡æœ‰å¯åŠ¨ &#x2F; æ²¡æœ‰è·å– IP</strong></td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ§©-ä¸ºä»€ä¹ˆè¿˜æ— æ³•è”ç½‘ï¼Ÿ"><a href="#ğŸ§©-ä¸ºä»€ä¹ˆè¿˜æ— æ³•è”ç½‘ï¼Ÿ" class="headerlink" title="ğŸ§© ä¸ºä»€ä¹ˆè¿˜æ— æ³•è”ç½‘ï¼Ÿ"></a>ğŸ§© ä¸ºä»€ä¹ˆè¿˜æ— æ³•è”ç½‘ï¼Ÿ</h2><p>ä½  curl ä¸‹è½½å¤±è´¥ï¼Œæ˜¯å› ä¸º NAT ç½‘å¡ <code>ens36</code> æ²¡å¯åŠ¨ï¼Œè™šæ‹Ÿæœºä¾ç„¶æ²¡è”ç½‘ã€‚</p>
<hr>
<h2 id="âœ…-è§£å†³æ–¹æ¡ˆï¼šå¯åŠ¨-NAT-ç½‘å¡å¹¶è®¾ç½®ä¸ºé»˜è®¤å‡ºç½‘å£"><a href="#âœ…-è§£å†³æ–¹æ¡ˆï¼šå¯åŠ¨-NAT-ç½‘å¡å¹¶è®¾ç½®ä¸ºé»˜è®¤å‡ºç½‘å£" class="headerlink" title="âœ… è§£å†³æ–¹æ¡ˆï¼šå¯åŠ¨ NAT ç½‘å¡å¹¶è®¾ç½®ä¸ºé»˜è®¤å‡ºç½‘å£"></a>âœ… è§£å†³æ–¹æ¡ˆï¼š<strong>å¯åŠ¨ NAT ç½‘å¡å¹¶è®¾ç½®ä¸ºé»˜è®¤å‡ºç½‘å£</strong></h2><h3 id="ç¬¬ä¸€æ­¥ï¼šæ¿€æ´»-ens36ï¼ˆNAT-ç½‘å¡ï¼‰"><a href="#ç¬¬ä¸€æ­¥ï¼šæ¿€æ´»-ens36ï¼ˆNAT-ç½‘å¡ï¼‰" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šæ¿€æ´» ens36ï¼ˆNAT ç½‘å¡ï¼‰"></a>ç¬¬ä¸€æ­¥ï¼šæ¿€æ´» ens36ï¼ˆNAT ç½‘å¡ï¼‰</h3><p>æ‰§è¡Œï¼š</p>
<pre><code>dhclient ens36
</code></pre>
<blockquote>
<p>â³ å¦‚æœä½ æ²¡è£… <code>dhclient</code>ï¼Œå¯ä»¥è¯•è¯•ï¼š</p>
</blockquote>
<pre><code>nmcli device connect ens36
</code></pre>
<p>ç„¶åå†æ¬¡æŸ¥çœ‹ IPï¼š</p>
<pre><code>ip addr
</code></pre>
<p>ä½ åº”è¯¥èƒ½çœ‹åˆ° <code>ens36</code> åˆ†é…åˆ°ç±»ä¼¼ <code>192.168.226.x</code> çš„åœ°å€ï¼ˆNAT ç½‘æ®µï¼‰</p>
</blockquote>
<h6 id="æ€»ç»“ä¸€ä¸‹è§†é¢‘é‡Œçš„æœåŠ¡å™¨ipæ‰€å¯¹åº”çš„æœåŠ¡"><a href="#æ€»ç»“ä¸€ä¸‹è§†é¢‘é‡Œçš„æœåŠ¡å™¨ipæ‰€å¯¹åº”çš„æœåŠ¡" class="headerlink" title="æ€»ç»“ä¸€ä¸‹è§†é¢‘é‡Œçš„æœåŠ¡å™¨ipæ‰€å¯¹åº”çš„æœåŠ¡"></a>æ€»ç»“ä¸€ä¸‹è§†é¢‘é‡Œçš„æœåŠ¡å™¨ipæ‰€å¯¹åº”çš„æœåŠ¡</h6><blockquote>
<p>192.168.66.100 GitLab<br>192.168.66.101 Jenkins<br>192.168.66.102 Harbor &amp;&amp; Tomcat<br>192.168.66.103 ç”Ÿäº§éƒ¨ç½²æœåŠ¡å™¨</p>
</blockquote>
<h3 id="ç¯å¢ƒå‡†å¤‡-3-Harboré•œåƒä»“åº“å®‰è£…åŠä½¿ç”¨"><a href="#ç¯å¢ƒå‡†å¤‡-3-Harboré•œåƒä»“åº“å®‰è£…åŠä½¿ç”¨" class="headerlink" title="ç¯å¢ƒå‡†å¤‡(3)-Harboré•œåƒä»“åº“å®‰è£…åŠä½¿ç”¨"></a>ç¯å¢ƒå‡†å¤‡(3)-Harboré•œåƒä»“åº“å®‰è£…åŠä½¿ç”¨</h3><h5 id="Harborç®€ä»‹"><a href="#Harborç®€ä»‹" class="headerlink" title="Harborç®€ä»‹"></a>Harborç®€ä»‹</h5><p>Harborï¼ˆæ¸¯å£ï¼Œæ¸¯æ¹¾ï¼‰æ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨å’Œåˆ†å‘Dockeré•œåƒçš„ä¼ä¸šçº§RegistryæœåŠ¡å™¨ã€‚ é™¤äº†Harborè¿™ä¸ªç§æœ‰é•œåƒä»“åº“ä¹‹å¤–ï¼Œè¿˜æœ‰Dockerå®˜æ–¹æä¾›çš„Registryã€‚ç›¸å¯¹Registryï¼ŒHarborå…·æœ‰å¾ˆå¤šä¼˜åŠ¿ï¼š</p>
<ol>
<li>æä¾›åˆ†å±‚ä¼ è¾“æœºåˆ¶ï¼Œä¼˜åŒ–ç½‘ç»œä¼ è¾“ Dockeré•œåƒæ˜¯æ˜¯åˆ†å±‚çš„ï¼Œè€Œå¦‚æœæ¯æ¬¡ä¼ è¾“éƒ½ä½¿ç”¨å…¨é‡æ–‡ä»¶(æ‰€ä»¥ ç”¨FTPçš„æ–¹å¼å¹¶ä¸é€‚åˆ)ï¼Œæ˜¾ç„¶ä¸ç»æµã€‚å¿…é¡»æä¾›è¯†åˆ«åˆ†å±‚ä¼ è¾“çš„æœºåˆ¶ï¼Œä»¥å±‚çš„UUIDä¸ºæ ‡è¯†ï¼Œç¡®å®š ä¼ è¾“çš„å¯¹è±¡ã€‚ </li>
<li>æä¾›WEBç•Œé¢ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ åªç”¨é•œåƒçš„åå­—æ¥è¿›è¡Œä¸Šä¼ ä¸‹è½½æ˜¾ç„¶å¾ˆä¸æ–¹ä¾¿ï¼Œéœ€è¦æœ‰ä¸€ä¸ªç”¨æˆ·ç•Œ é¢å¯ä»¥æ”¯æŒç™»é™†ã€æœç´¢åŠŸèƒ½ï¼ŒåŒ…æ‹¬åŒºåˆ†å…¬æœ‰ã€ç§æœ‰é•œåƒã€‚</li>
<li>æ”¯æŒæ°´å¹³æ‰©å±•é›†ç¾¤ å½“æœ‰ç”¨æˆ·å¯¹é•œåƒçš„ä¸Šä¼ ä¸‹è½½æ“ä½œé›†ä¸­åœ¨æŸæœåŠ¡å™¨ï¼Œéœ€è¦å¯¹ç›¸åº”çš„è®¿é—®å‹åŠ›ä½œåˆ†è§£ã€‚ </li>
<li>è‰¯å¥½çš„å®‰å…¨æœºåˆ¶ ä¼ä¸šä¸­çš„å¼€å‘å›¢é˜Ÿæœ‰å¾ˆå¤šä¸åŒçš„èŒä½ï¼Œå¯¹äºä¸åŒçš„èŒä½äººå‘˜ï¼Œåˆ†é…ä¸åŒçš„æƒé™ï¼Œå…·æœ‰æ›´å¥½çš„å®‰å…¨æ€§ã€‚</li>
</ol>
<h5 id="Harborå®‰è£…"><a href="#Harborå®‰è£…" class="headerlink" title="Harborå®‰è£…"></a>Harborå®‰è£…</h5><p>Harboréœ€è¦å®‰è£…åœ¨<code>192.168.200.131 Harbor &amp;&amp; Tomcat</code>ä¸Š</p>
<ul>
<li><p>å…ˆå®‰è£…Dockerå¹¶å¯åŠ¨Docker</p>
<blockquote>
<p>sudo systemctl start docker        å¯åŠ¨Docker<br>sudo systemctl enable docker    å¼€æœºè‡ªå¯åŠ¨<br>sudo systemctl status docker     æŸ¥çœ‹DockeræœåŠ¡çŠ¶æ€</p>
</blockquote>
</li>
<li><p>å®‰è£…docker-compose</p>
<pre><code class="java">sudo curl -L https://github.com/docker/compose/releases/download/1.21.2/docker compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose 
sudo chmod +x /usr/local/bin/docker-compose
</code></pre>
</li>
</ul>
<blockquote>
<p>ä½ å¯ä»¥ä½¿ç”¨ <strong>ç¦»çº¿å®‰è£… docker-compose</strong> çš„æ–¹å¼ï¼Œ<strong>åœ¨ä¸»æœºä¸Šä¸‹è½½å¥½äºŒè¿›åˆ¶æ–‡ä»¶</strong>ï¼Œå†æ‹·è´åˆ°è™šæ‹Ÿæœºä¸­ä½¿ç”¨ï¼Œéå¸¸ç®€å•ã€‚</p>
<hr>
<h2 id="âœ…-æ–¹æ³•ä¸€ï¼šä¸»æœºä¸‹è½½-â†’-æ‹·è´åˆ°è™šæ‹Ÿæœº"><a href="#âœ…-æ–¹æ³•ä¸€ï¼šä¸»æœºä¸‹è½½-â†’-æ‹·è´åˆ°è™šæ‹Ÿæœº" class="headerlink" title="âœ… æ–¹æ³•ä¸€ï¼šä¸»æœºä¸‹è½½ â†’ æ‹·è´åˆ°è™šæ‹Ÿæœº"></a>âœ… æ–¹æ³•ä¸€ï¼š<strong>ä¸»æœºä¸‹è½½ â†’ æ‹·è´åˆ°è™šæ‹Ÿæœº</strong></h2><h3 id="æ­¥éª¤-1ï¸âƒ£ï¼šåœ¨ä¸»æœºï¼ˆWindowsï¼‰ä¸Šç”¨æµè§ˆå™¨ä¸‹è½½è¿™ä¸ªæ–‡ä»¶"><a href="#æ­¥éª¤-1ï¸âƒ£ï¼šåœ¨ä¸»æœºï¼ˆWindowsï¼‰ä¸Šç”¨æµè§ˆå™¨ä¸‹è½½è¿™ä¸ªæ–‡ä»¶" class="headerlink" title="æ­¥éª¤ 1ï¸âƒ£ï¼šåœ¨ä¸»æœºï¼ˆWindowsï¼‰ä¸Šç”¨æµè§ˆå™¨ä¸‹è½½è¿™ä¸ªæ–‡ä»¶"></a>æ­¥éª¤ 1ï¸âƒ£ï¼šåœ¨ä¸»æœºï¼ˆWindowsï¼‰ä¸Šç”¨æµè§ˆå™¨ä¸‹è½½è¿™ä¸ªæ–‡ä»¶</h3><p>è®¿é—®åœ°å€å¦‚ä¸‹ï¼ˆä½ è¿™ä¸ªç‰ˆæœ¬æ˜¯ 1.21.2ï¼‰ï¼š</p>
<p>ğŸ‘‰ <a target="_blank" rel="noopener" href="https://github.com/docker/compose/releases/download/1.21.2/docker-compose-Linux-x86_64">https://github.com/docker/compose/releases/download/1.21.2/docker-compose-Linux-x86_64</a></p>
<p>ä¸‹è½½åï¼Œé‡å‘½åä¸ºï¼š<code>docker-compose</code></p>
<hr>
<h3 id="æ­¥éª¤-2ï¸âƒ£ï¼šç”¨-MobaXterm-æ‹·è´åˆ°è™šæ‹Ÿæœº"><a href="#æ­¥éª¤-2ï¸âƒ£ï¼šç”¨-MobaXterm-æ‹·è´åˆ°è™šæ‹Ÿæœº" class="headerlink" title="æ­¥éª¤ 2ï¸âƒ£ï¼šç”¨ MobaXterm æ‹·è´åˆ°è™šæ‹Ÿæœº"></a>æ­¥éª¤ 2ï¸âƒ£ï¼šç”¨ MobaXterm æ‹·è´åˆ°è™šæ‹Ÿæœº</h3><p>ä½ åœ¨ Mobaxterm ä¸­è¿æ¥å¥½è™šæ‹Ÿæœºåï¼š</p>
<ol>
<li>å·¦ä¾§æ–‡ä»¶ç®¡ç†å™¨ä¸­æ‰¾åˆ° <code>/usr/local/bin</code>ï¼ˆæˆ– <code>/root</code>ï¼‰</li>
<li>æŠŠä½ åˆšä¸‹è½½çš„ <code>docker-compose</code> æ‹–è¿›å»ä¸Šä¼ </li>
</ol>
<p>æˆ–è€…ç”¨ <code>scp</code> å‘½ä»¤ä¸Šä¼ ï¼š</p>
<pre><code>scp docker-compose root@192.168.200.131:/usr/local/bin/docker-compose
</code></pre>
<blockquote>
<p>æŠŠ <code>192.168.200.131</code> æ¢æˆä½ è™šæ‹Ÿæœº IPï¼Œè¾“å…¥å¯†ç å³å¯</p>
</blockquote>
<hr>
<h3 id="æ­¥éª¤-3ï¸âƒ£ï¼šåœ¨è™šæ‹Ÿæœºä¸­èµ‹äºˆæ‰§è¡Œæƒé™"><a href="#æ­¥éª¤-3ï¸âƒ£ï¼šåœ¨è™šæ‹Ÿæœºä¸­èµ‹äºˆæ‰§è¡Œæƒé™" class="headerlink" title="æ­¥éª¤ 3ï¸âƒ£ï¼šåœ¨è™šæ‹Ÿæœºä¸­èµ‹äºˆæ‰§è¡Œæƒé™"></a>æ­¥éª¤ 3ï¸âƒ£ï¼šåœ¨è™šæ‹Ÿæœºä¸­èµ‹äºˆæ‰§è¡Œæƒé™</h3><pre><code>chmod +x /usr/local/bin/docker-compose
</code></pre>
<hr>
<h3 id="æ­¥éª¤-4ï¸âƒ£ï¼šéªŒè¯å®‰è£…æˆåŠŸ"><a href="#æ­¥éª¤-4ï¸âƒ£ï¼šéªŒè¯å®‰è£…æˆåŠŸ" class="headerlink" title="æ­¥éª¤ 4ï¸âƒ£ï¼šéªŒè¯å®‰è£…æˆåŠŸ"></a>æ­¥éª¤ 4ï¸âƒ£ï¼šéªŒè¯å®‰è£…æˆåŠŸ</h3><pre><code>docker-compose -v
</code></pre>
<p>è¾“å‡ºç±»ä¼¼ï¼š</p>
<pre><code>docker-compose version 1.21.2, build ...
</code></pre>
<p>âœ… å®Œæˆï¼</p>
</blockquote>
<ul>
<li><p>ä¸‹è½½Harborçš„å‹ç¼©åŒ…<code>harbor-offline-installer-v1.9.2.tgz</code></p>
</li>
<li><p>ä¸Šä¼ å‹ç¼©åŒ…åˆ°linuxå¹¶è§£å‹</p>
<blockquote>
<p>tar -xzf harbor-offline-installer-v1.9.2.tgz<br>mkdir &#x2F;opt&#x2F;harbor<br>mv harbor&#x2F;* &#x2F;opt&#x2F;harbor<br>cd &#x2F;opt&#x2F;harbor</p>
</blockquote>
</li>
<li><p>ä¿®æ”¹Harborçš„é…ç½®</p>
<blockquote>
<p>vi harbor.yml</p>
</blockquote>
<p>ä¿®æ”¹hostnameå’Œport</p>
<blockquote>
<p>hostnameï¼š192.168.200.131<br>portï¼š85</p>
</blockquote>
</li>
<li><p>å®‰è£…Harbor</p>
<blockquote>
<p>.&#x2F;prepare<br>.&#x2F;install.sh </p>
</blockquote>
<h5 id="å¯åŠ¨Harbor-â˜…â˜…-tomcat-131æœåŠ¡å™¨"><a href="#å¯åŠ¨Harbor-â˜…â˜…-tomcat-131æœåŠ¡å™¨" class="headerlink" title="å¯åŠ¨Harbor â˜…â˜… [tomcat 131æœåŠ¡å™¨]"></a>å¯åŠ¨Harbor â˜…â˜… [tomcat 131æœåŠ¡å™¨]</h5><pre><code class="JAVA">cd /opt/harbor
./install.sh
</code></pre>
</li>
</ul>
<h5 id="è¿™é‡Œæœ‰ä¸ªç»å…¸çš„è¶…çº§ç‰›é€¼çš„å¤§bug"><a href="#è¿™é‡Œæœ‰ä¸ªç»å…¸çš„è¶…çº§ç‰›é€¼çš„å¤§bug" class="headerlink" title="è¿™é‡Œæœ‰ä¸ªç»å…¸çš„è¶…çº§ç‰›é€¼çš„å¤§bug"></a><span style = "color:red">è¿™é‡Œæœ‰ä¸ªç»å…¸çš„è¶…çº§ç‰›é€¼çš„å¤§bug</span></h5><h6 id="æŠ›å‡ºé—®é¢˜ï¼š"><a href="#æŠ›å‡ºé—®é¢˜ï¼š" class="headerlink" title="æŠ›å‡ºé—®é¢˜ï¼š"></a>æŠ›å‡ºé—®é¢˜ï¼š</h6><blockquote>
<p>è¿™æ˜¯æˆ‘vi &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ens33<br>DEFROUTE&#x3D;yes<br>NAME&#x3D;ens33<br>UUID&#x3D;a8ca17a4-0388-4b06-81b3-895e1a8180fe<br>DEVICE&#x3D;ens33<br>ONBOOT&#x3D;yes</p>
<p>IPADDR&#x3D;192.168.200.131<br>NETMASK&#x3D;255.255.255.0<br>GATEWAY&#x3D;192.168.31.1<br>DNS1&#x3D;8.8.8.8</p>
<p>è¿™æ˜¯æˆ‘è™šæ‹Ÿæœºçš„ip add</p>
<p>[root@localhost ~]# ip addr<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1&#x2F;8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1&#x2F;128 scope host<br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    link&#x2F;ether 00:0c:29:7b:04:23 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.200.131&#x2F;24 brd 192.168.200.255 scope global noprefixroute ens33<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::20c:29ff:fe7b:423&#x2F;64 scope link<br>       valid_lft forever preferred_lft forever<br>3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default<br>    link&#x2F;ether 02:42:94:7c:ad:4a brd ff:ff:ff:ff:ff:ff<br>    inet 172.17.0.1&#x2F;16 brd 172.17.255.255 scope global docker0<br>       valid_lft forever preferred_lft forever</p>
<p>è¯¥è™šæ‹Ÿæœºé€‰æ‹©äº†æ¡¥æ¥æ¨¡å¼ ä¸” å‹¾é€‰äº†å¤åˆ¶åˆ°ç‰©ç†ç½‘ç»œè¿æ¥çŠ¶æ€<br>å…¶è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨é‡Œé¢<br>VMnet0 æ¡¥æ¥æ¨¡å¼ è‡ªåŠ¨æ¡¥æ¥   ä¸»æœºè¿æ¥æ—  DHCPæ—   å­ç½‘åœ°å€æ— <br>VMnet1 ä»…ä¸»æœº    å¤–éƒ¨è¿æ¥æ—   ä¸»æœºè¿æ¥å·²è¿æ¥  DHCPå·²å¯ç”¨ å­ç½‘åœ°å€192.168.22.0<br>VMnet8 NATæ¨¡å¼ NATæ¨¡å¼  ä¸»æœºè¿æ¥å·²è¿æ¥ DHCPæ—  å­ç½‘åœ°å€192.168.200.0</p>
<p>è¿™æ˜¯æˆ‘ä¸»æœºipconfig<br>C:\Users\Pluminary&gt;ipconfig</p>
<p>Windows IP é…ç½®</p>
<p>ä»¥å¤ªç½‘é€‚é…å™¨ ä»¥å¤ªç½‘ 4:</p>
<p>   åª’ä½“çŠ¶æ€  . . . . . . . . . . . . : åª’ä½“å·²æ–­å¼€è¿æ¥<br>   è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . :</p>
<p>æ— çº¿å±€åŸŸç½‘é€‚é…å™¨ æœ¬åœ°è¿æ¥* 1:</p>
<p>   åª’ä½“çŠ¶æ€  . . . . . . . . . . . . : åª’ä½“å·²æ–­å¼€è¿æ¥<br>   è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . :</p>
<p>æ— çº¿å±€åŸŸç½‘é€‚é…å™¨ æœ¬åœ°è¿æ¥* 2:</p>
<p>   åª’ä½“çŠ¶æ€  . . . . . . . . . . . . : åª’ä½“å·²æ–­å¼€è¿æ¥<br>   è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . :</p>
<p>ä»¥å¤ªç½‘é€‚é…å™¨ VMware Network Adapter VMnet1:</p>
<p>   è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . :<br>   æœ¬åœ°é“¾æ¥ IPv6 åœ°å€. . . . . . . . : fe80::1ea6:88fa:c0e1:f1ca%22<br>   IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.22.1<br>   å­ç½‘æ©ç   . . . . . . . . . . . . : 255.255.255.0<br>   é»˜è®¤ç½‘å…³. . . . . . . . . . . . . :</p>
<p>ä»¥å¤ªç½‘é€‚é…å™¨ VMware Network Adapter VMnet8:</p>
<p>   è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . :<br>   æœ¬åœ°é“¾æ¥ IPv6 åœ°å€. . . . . . . . : fe80::9e33:f9ac:4f64:9d71%3<br>   IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.200.2<br>   å­ç½‘æ©ç   . . . . . . . . . . . . : 255.255.255.0<br>   é»˜è®¤ç½‘å…³. . . . . . . . . . . . . : 192.168.200.1</p>
<p>æ— çº¿å±€åŸŸç½‘é€‚é…å™¨ WLAN:</p>
<p>   è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . :<br>   æœ¬åœ°é“¾æ¥ IPv6 åœ°å€. . . . . . . . : fe80::7df7:efe4:1d3b:e2d2%12<br>   IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.31.103<br>   å­ç½‘æ©ç   . . . . . . . . . . . . : 255.255.255.0<br>   é»˜è®¤ç½‘å…³. . . . . . . . . . . . . : 192.168.31.1 </p>
<p>æˆ‘ç°åœ¨çš„é—®é¢˜æ˜¯ å¦‚æœæˆ‘æ”¹äº†GATEWAY&#x3D;192.168.31.1 ä¸ºåˆ«çš„ é‚£ä¹ˆæˆ‘MobaXtermå°±è¿ä¸ä¸Šè¯¥è™šæ‹Ÿæœº ç°åœ¨çš„é—®é¢˜æ˜¯ è™šæ‹Ÿæœºæ²¡æœ‰ç½‘ æˆ‘é•œåƒéƒ½ä¸‹è½½ä¸äº†[root@localhost harbor]# .&#x2F;prepare<br>prepare base dir is set to &#x2F;opt&#x2F;harbor<br>Unable to find image â€˜goharbor&#x2F;prepare:v1.9.2â€™ locally<br>^C<br>[root@localhost harbor]# ^C<br>[root@localhost harbor]#</p>
</blockquote>
<h6 id="GitHubè§£å†³æ–¹æ¡ˆï¼š"><a href="#GitHubè§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="GitHubè§£å†³æ–¹æ¡ˆï¼š"></a>GitHubè§£å†³æ–¹æ¡ˆï¼š</h6><blockquote>
<p>ä½ ç›®å‰çš„çŠ¶æ€æ˜¯ï¼š</p>
<hr>
<p>âœ… <strong>è™šæ‹Ÿæœº IP</strong> æ˜¯ <code>192.168.200.131</code>ï¼ˆ<strong>é™æ€ IPï¼Œæ¡¥æ¥æ¨¡å¼ä¸‹è®¾ç½®çš„</strong>ï¼‰<br> âœ… <strong>å®¿ä¸»æœº WLAN IP</strong> æ˜¯ <code>192.168.31.103</code><br> âŒ <strong>è™šæ‹Ÿæœºæ— æ³•è”ç½‘</strong>ï¼ˆä¸èƒ½æ‹‰å–é•œåƒï¼‰<br> âœ… <strong>MobaXterm å¯ä»¥è¿æ¥è™šæ‹Ÿæœºï¼ˆ192.168.200.131ï¼‰</strong><br> âš ï¸ <strong>è™šæ‹Ÿæœºç½‘å…³è®¾ç½®ä¸º <code>192.168.31.1</code>ï¼Œå…¶å®è¿™æ˜¯ WLAN çš„ç½‘å…³ï¼Œä¸å±äº <code>192.168.200.x</code> å­ç½‘</strong></p>
<hr>
<h2 id="ğŸ”¥-ä½ ç°åœ¨çš„é—®é¢˜æœ¬è´¨ï¼š"><a href="#ğŸ”¥-ä½ ç°åœ¨çš„é—®é¢˜æœ¬è´¨ï¼š" class="headerlink" title="ğŸ”¥ ä½ ç°åœ¨çš„é—®é¢˜æœ¬è´¨ï¼š"></a>ğŸ”¥ <span style = "color:red">ä½ ç°åœ¨çš„é—®é¢˜æœ¬è´¨ï¼š</span></h2><ul>
<li>è™½ç„¶ MobaXterm èƒ½è®¿é—®è™šæ‹Ÿæœº <code>192.168.200.131</code>ï¼Œä½†è™šæ‹Ÿæœºè®¾ç½®äº†ä¸€ä¸ª<strong>ä¸åœ¨æœ¬ç½‘æ®µçš„ç½‘å…³ï¼š<code>192.168.31.1</code></strong></li>
<li>æ‰€ä»¥è™šæ‹Ÿæœºæ ¹æœ¬æ— æ³•å‡ºç½‘ï¼ˆä¸èƒ½ ping å¤–ç½‘ï¼Œä¹Ÿä¸èƒ½æ‹‰ harbor é•œåƒï¼‰</li>
</ul>
<hr>
<h2 id="âœ…-æ­£ç¡®é…ç½®æ–¹å¼ï¼š"><a href="#âœ…-æ­£ç¡®é…ç½®æ–¹å¼ï¼š" class="headerlink" title="âœ… æ­£ç¡®é…ç½®æ–¹å¼ï¼š"></a>âœ… æ­£ç¡®é…ç½®æ–¹å¼ï¼š</h2><p>è®©è™šæ‹Ÿæœºåœ¨æ¡¥æ¥æ¨¡å¼ä¸‹èƒ½ <strong>è”ç½‘ + è¢«è®¿é—®</strong></p>
<hr>
<h3 id="âœ…-ç¬¬ä¸€æ­¥ï¼šè®¾ç½®æ­£ç¡®ç½‘å…³ï¼ˆåŒ¹é…è™šæ‹Ÿæœº-IP-ç½‘æ®µï¼‰"><a href="#âœ…-ç¬¬ä¸€æ­¥ï¼šè®¾ç½®æ­£ç¡®ç½‘å…³ï¼ˆåŒ¹é…è™šæ‹Ÿæœº-IP-ç½‘æ®µï¼‰" class="headerlink" title="âœ… ç¬¬ä¸€æ­¥ï¼šè®¾ç½®æ­£ç¡®ç½‘å…³ï¼ˆåŒ¹é…è™šæ‹Ÿæœº IP ç½‘æ®µï¼‰"></a>âœ… ç¬¬ä¸€æ­¥ï¼šè®¾ç½®æ­£ç¡®ç½‘å…³ï¼ˆåŒ¹é…è™šæ‹Ÿæœº IP ç½‘æ®µï¼‰</h3><p>ä½ è™šæ‹Ÿæœºé™æ€ IP æ˜¯ <code>192.168.200.131</code>ï¼Œæ‰€ä»¥ç½‘å…³å¿…é¡»ä¹Ÿåœ¨ <code>192.168.200.1~254</code> èŒƒå›´ã€‚</p>
<p>è§‚å¯Ÿå®¿ä¸»æœº VMnet8ï¼ˆNATï¼‰æ˜¯ <code>192.168.200.2</code>ï¼Œå®ƒçš„ç½‘å…³æ˜¯ï¼š</p>
<pre><code>é»˜è®¤ç½‘å…³: 192.168.200.1
</code></pre>
<p>æ‰€ä»¥ä½ åº”è®¾ç½®ï¼š</p>
<pre><code>IPADDR=192.168.200.131
NETMASK=255.255.255.0
GATEWAY=192.168.200.1
DNS1=8.8.8.8
</code></pre>
<p>âœ… è¿™ä¸ªé…ç½®èƒ½è®©è™šæ‹Ÿæœºå‡ºç½‘ï¼ˆä½¿ç”¨ VMware NAT å‡ºå£ï¼‰ï¼Œä¹Ÿèƒ½è®©å®¿ä¸»æœºé€šè¿‡ <code>192.168.200.131</code> è®¿é—®è™šæ‹Ÿæœºã€‚</p>
<hr>
<h3 id="âœ…-ç¬¬äºŒæ­¥ï¼šå¦‚æœä½ ç”¨çš„æ˜¯-NAT-æ¨¡å¼ï¼Œåˆ™ä½¿ç”¨ä¸Šé¢çš„-GATEWAY-æ˜¯å¯¹çš„"><a href="#âœ…-ç¬¬äºŒæ­¥ï¼šå¦‚æœä½ ç”¨çš„æ˜¯-NAT-æ¨¡å¼ï¼Œåˆ™ä½¿ç”¨ä¸Šé¢çš„-GATEWAY-æ˜¯å¯¹çš„" class="headerlink" title="âœ… ç¬¬äºŒæ­¥ï¼šå¦‚æœä½ ç”¨çš„æ˜¯ NAT æ¨¡å¼ï¼Œåˆ™ä½¿ç”¨ä¸Šé¢çš„ GATEWAY æ˜¯å¯¹çš„"></a>âœ… ç¬¬äºŒæ­¥ï¼šå¦‚æœä½ ç”¨çš„æ˜¯ <strong>NAT æ¨¡å¼</strong>ï¼Œåˆ™ä½¿ç”¨ä¸Šé¢çš„ GATEWAY æ˜¯å¯¹çš„</h3><p>ä½†ä½ è¯´ä½ ç”¨äº† <strong>æ¡¥æ¥æ¨¡å¼</strong>ï¼Œé‚£å°±è¦çœ‹æ¡¥æ¥çš„æ˜¯å“ªå—ç½‘å¡ã€‚</p>
<h4 id="æ¡¥æ¥æ¨¡å¼ä¸‹ï¼Œæ­£ç¡®åšæ³•æ˜¯ï¼š"><a href="#æ¡¥æ¥æ¨¡å¼ä¸‹ï¼Œæ­£ç¡®åšæ³•æ˜¯ï¼š" class="headerlink" title="æ¡¥æ¥æ¨¡å¼ä¸‹ï¼Œæ­£ç¡®åšæ³•æ˜¯ï¼š"></a>æ¡¥æ¥æ¨¡å¼ä¸‹ï¼Œæ­£ç¡®åšæ³•æ˜¯ï¼š</h4><ol>
<li>è™šæ‹Ÿæœº IP è¦è·Ÿå®¿ä¸»æœºæ‰€è¿ç½‘ç»œåŒä¸€ä¸ªç½‘æ®µ</li>
<li>ç½‘å…³è¦è®¾ç½®ä¸º <strong>å®¿ä¸»æœº WLAN çš„ç½‘å…³ï¼š<code>192.168.31.1</code></strong></li>
</ol>
<p>è¿™æ ·ä½ æ‰ä¼šåœ¨ MobaXterm èƒ½è®¿é—®ã€ä¹Ÿèƒ½è”ç½‘ã€‚</p>
<hr>
<h3 id="â—ä½†ä½ ç°åœ¨é—®é¢˜æ˜¯ï¼š"><a href="#â—ä½†ä½ ç°åœ¨é—®é¢˜æ˜¯ï¼š" class="headerlink" title="â—ä½†ä½ ç°åœ¨é—®é¢˜æ˜¯ï¼š"></a>â—ä½†ä½ ç°åœ¨é—®é¢˜æ˜¯ï¼š</h3><p>ä½ æ¡¥æ¥äº†ï¼Œä½† IP å´åœ¨ <code>192.168.200.x</code>ï¼Œè¿™è¯´æ˜è™šæ‹Ÿæœºå¹¶æ²¡æœ‰æˆåŠŸæ¡¥æ¥åˆ°å®¿ä¸»æœº WLAN ç½‘å¡ï¼Œè€Œæ˜¯è¿åˆ°äº† VMware çš„ NAT ç½‘ç»œï¼ˆå³ä½¿ä½ è®¾ç½®æ¡¥æ¥ï¼Œä¹Ÿå¯èƒ½æ²¡ç”Ÿæ•ˆï¼‰</p>
<hr>
<h2 id="âœ…-æœ€å»ºè®®æ–¹æ¡ˆ"><a href="#âœ…-æœ€å»ºè®®æ–¹æ¡ˆ" class="headerlink" title="âœ… æœ€å»ºè®®æ–¹æ¡ˆ"></a>âœ… æœ€å»ºè®®æ–¹æ¡ˆ</h2><h3 id="A-ç”¨-NAT-æ¨¡å¼-æ­£ç¡®ç½‘å…³ï¼ˆæ¨èç¨³å®šï¼Œé€‚åˆå¤§å¤šæ•°äººï¼‰"><a href="#A-ç”¨-NAT-æ¨¡å¼-æ­£ç¡®ç½‘å…³ï¼ˆæ¨èç¨³å®šï¼Œé€‚åˆå¤§å¤šæ•°äººï¼‰" class="headerlink" title="A. ç”¨ NAT æ¨¡å¼ + æ­£ç¡®ç½‘å…³ï¼ˆæ¨èç¨³å®šï¼Œé€‚åˆå¤§å¤šæ•°äººï¼‰"></a><strong>A. ç”¨ NAT æ¨¡å¼ + æ­£ç¡®ç½‘å…³ï¼ˆæ¨èç¨³å®šï¼Œé€‚åˆå¤§å¤šæ•°äººï¼‰</strong></h3><ol>
<li>æŠŠè™šæ‹Ÿæœºæ”¹ä¸º <strong>NAT æ¨¡å¼</strong></li>
<li><code>ifcfg-ens33</code> è®¾ç½®å¦‚ä¸‹ï¼š</li>
</ol>
<pre><code>DEVICE=ens33
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.200.131
NETMASK=255.255.255.0
GATEWAY=192.168.200.1   # NAT çš„é»˜è®¤ç½‘å…³
DNS1=8.8.8.8
</code></pre>
<ol>
<li>é‡å¯ç½‘ç»œï¼š</li>
</ol>
<pre><code>systemctl restart network
</code></pre>
<ol>
<li>æµ‹è¯•ç½‘ç»œï¼š</li>
</ol>
<pre><code>ping -c 3 8.8.8.8
curl www.baidu.com
</code></pre>
<ol>
<li>ç„¶åä½¿ç”¨ <code>MobaXterm</code> è®¿é—®ä½ è®¾ç½®çš„ <code>192.168.200.131</code>ï¼Œæˆ–è®¾ç½®ç«¯å£è½¬å‘ï¼ˆå¦‚ <code>127.0.0.1:2222</code> â†’ <code>192.168.200.131:22</code>ï¼‰</li>
</ol>
<hr>
<h3 id="B-æˆ–è€…ç»§ç»­æ¡¥æ¥ï¼Œä½†è®¾ç½®é™æ€-IP-ä¸º-192-168-31-x-ç½‘æ®µ"><a href="#B-æˆ–è€…ç»§ç»­æ¡¥æ¥ï¼Œä½†è®¾ç½®é™æ€-IP-ä¸º-192-168-31-x-ç½‘æ®µ" class="headerlink" title="B. æˆ–è€…ç»§ç»­æ¡¥æ¥ï¼Œä½†è®¾ç½®é™æ€ IP ä¸º 192.168.31.x ç½‘æ®µ"></a><strong>B. æˆ–è€…ç»§ç»­æ¡¥æ¥ï¼Œä½†è®¾ç½®é™æ€ IP ä¸º <code>192.168.31.x</code> ç½‘æ®µ</strong></h3><p>å¦‚æœä½ è¦æ¡¥æ¥åˆ°å®¿ä¸»æœº WLANï¼š</p>
<ol>
<li>ä¿®æ”¹ <code>/etc/sysconfig/network-scripts/ifcfg-ens33</code>ï¼š</li>
</ol>
<pre><code>DEVICE=ens33
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.31.130     # è‡ªå·±å®šä¸ªæ²¡å†²çªçš„ IP
NETMASK=255.255.255.0
GATEWAY=192.168.31.1       # ä½ çš„æ— çº¿ç½‘å…³
DNS1=8.8.8.8
</code></pre>
<ol>
<li>é‡å¯ç½‘ç»œï¼š</li>
</ol>
<pre><code>systemctl restart network
</code></pre>
<ol>
<li>æ£€æŸ¥ IP å’Œè¿é€šæ€§ï¼š</li>
</ol>
<pre><code>ip addr
ping 8.8.8.8
</code></pre>
<hr>
<h2 id="âœ…-ç»“è®º"><a href="#âœ…-ç»“è®º" class="headerlink" title="âœ… ç»“è®º"></a>âœ… ç»“è®º</h2><p>ä½ ç°åœ¨ MobaXterm èƒ½è¿æ¥ï¼Œæ˜¯å› ä¸ºç”¨äº†é™æ€ IP <code>192.168.200.131</code>ï¼Œä½†ç”±äºç½‘å…³ä¸åœ¨åŒä¸€ç½‘æ®µï¼Œå¯¼è‡´ä¸èƒ½è”ç½‘ã€‚</p>
<p>ä½ åªè¦æ ¹æ®ä½ å®é™…ä½¿ç”¨çš„ç½‘ç»œæ¨¡å¼ï¼ˆNAT æˆ–æ¡¥æ¥ï¼‰ï¼Œ<strong>æŠŠç½‘å…³æ”¹æˆåŒç½‘æ®µçš„åœ°å€</strong>ï¼Œé—®é¢˜å°±èƒ½è§£å†³ã€‚</p>
<hr>
<p>å¦‚æœä½ å‘Šè¯‰æˆ‘ä½ <strong>æœ€ç»ˆæƒ³ä½¿ç”¨ NAT è¿˜æ˜¯æ¡¥æ¥</strong>ï¼ˆæ˜¯å¦å¸Œæœ›è™šæ‹Ÿæœºèƒ½è¢«å…¶å®ƒè®¾å¤‡è®¿é—®ï¼‰ï¼Œæˆ‘å¯ä»¥ç›´æ¥å¸®ä½ ç”Ÿæˆå®Œæ•´é…ç½®æ–‡ä»¶ã€‚</p>
<h6 id="ç»§ç»­å»¶ç”³é—®é¢˜ï¼š"><a href="#ç»§ç»­å»¶ç”³é—®é¢˜ï¼š" class="headerlink" title="ç»§ç»­å»¶ç”³é—®é¢˜ï¼š"></a>ç»§ç»­å»¶ç”³é—®é¢˜ï¼š</h6><p>æˆ‘æŒ‰ç…§ä½ è¯´çš„æ”¹äº† æ”¹æˆäº†natæ¨¡å¼ ç„¶åä¹Ÿæ”¹äº†é…ç½®  ä½†æ˜¯è¿˜æ˜¯ä¸è¡Œ [rooteloca1host ~]# ping -c 3 8.8.8.8PING 8.8.8.8(8.8.8.8) 56(84) bytes of data.From 192.168.200.131 icmp_seq&#x3D;1 Destination Host UnreachableFrom 192.168.200.131 icmp_seq&#x3D;2 Destination Host UnreachableFrom 192.168.200.131 icmp_seq&#x3D;3 Destination Host Unreachable8.8.8.8 ping statistics3 packets transmitted,0 received, +3 errors, 100% packet loss,time 1999mspipe3 ç°åœ¨è¿MobaXterméƒ½è¿ä¸ä¸Šäº† Network error: Connection timed out â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Session stopped    - Press <return> to exit tab    - Press R to restart session    - Press S to save terminal output to file</p>
<p>âœ… ä½ ç°åœ¨çš„é—®é¢˜æ˜¯ï¼š</p>
<blockquote>
<p><strong>ä½ åˆ‡æ¢åˆ° NAT æ¨¡å¼äº†ï¼Œé…ç½®ä¹Ÿæ”¹äº†ï¼Œä½†ï¼š</strong></p>
<ul>
<li>âŒ ä»ç„¶æ— æ³•è”ç½‘ï¼ˆ<code>ping 8.8.8.8</code> ä¸é€šï¼‰</li>
<li>âŒ MobaXterm ä¹Ÿè¿ä¸ä¸Šè™šæ‹Ÿæœºï¼ˆè¿æ¥è¶…æ—¶ï¼‰</li>
<li>âœ… è™šæ‹Ÿæœº IP æ˜¯ <code>192.168.200.131</code>ï¼Œç½‘å…³ä½ åº”è¯¥å·²æ”¹ä¸º <code>192.168.200.1</code>ï¼ˆå¯¹å§ï¼Ÿï¼‰</li>
</ul>
</blockquote>
<hr>
<p>æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥å¿«é€Ÿæ’æŸ¥ï¼š</p>
<hr>
<h2 id="âœ…-ç¬¬ä¸€æ­¥ï¼šç¡®è®¤è™šæ‹Ÿæœºç½‘å¡é…ç½®æ˜¯å¦æ­£ç¡®"><a href="#âœ…-ç¬¬ä¸€æ­¥ï¼šç¡®è®¤è™šæ‹Ÿæœºç½‘å¡é…ç½®æ˜¯å¦æ­£ç¡®" class="headerlink" title="âœ… ç¬¬ä¸€æ­¥ï¼šç¡®è®¤è™šæ‹Ÿæœºç½‘å¡é…ç½®æ˜¯å¦æ­£ç¡®"></a>âœ… ç¬¬ä¸€æ­¥ï¼šç¡®è®¤è™šæ‹Ÿæœºç½‘å¡é…ç½®æ˜¯å¦æ­£ç¡®</h2><p>åœ¨è™šæ‹Ÿæœºé‡Œæ‰§è¡Œï¼š</p>
<pre><code>cat /etc/sysconfig/network-scripts/ifcfg-ens33
</code></pre>
<p>ç¡®è®¤é…ç½®å¦‚ä¸‹ï¼ˆ<strong>é™æ€ IP æ¨¡å¼ + NAT ç½‘æ®µçš„æ­£ç¡®ç½‘å…³</strong>ï¼‰ï¼š</p>
<pre><code>DEVICE=ens33
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.200.131
NETMASK=255.255.255.0
GATEWAY=192.168.200.1
DNS1=8.8.8.8
</code></pre>
<p>å¦‚æœä¸æ˜¯è¿™æ ·ï¼Œè¯·ç«‹åˆ»ä¿®æ”¹ã€‚</p>
<p>ç„¶åæ‰§è¡Œï¼š</p>
<pre><code>systemctl restart network
</code></pre>
<hr>
<h2 id="âœ…-ç¬¬äºŒæ­¥ï¼šç¡®è®¤-NAT-æ¨¡å¼æ˜¯å¦æ­£ç¡®å·¥ä½œ"><a href="#âœ…-ç¬¬äºŒæ­¥ï¼šç¡®è®¤-NAT-æ¨¡å¼æ˜¯å¦æ­£ç¡®å·¥ä½œ" class="headerlink" title="âœ… ç¬¬äºŒæ­¥ï¼šç¡®è®¤ NAT æ¨¡å¼æ˜¯å¦æ­£ç¡®å·¥ä½œ"></a>âœ… ç¬¬äºŒæ­¥ï¼šç¡®è®¤ NAT æ¨¡å¼æ˜¯å¦æ­£ç¡®å·¥ä½œ</h2><p>æ‰“å¼€ VMware è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ï¼Œç¡®è®¤ï¼š</p>
<ul>
<li>VMnet8 ç½‘ç»œçš„ <strong>å­ç½‘ IP</strong> æ˜¯ <code>192.168.200.0</code></li>
<li><strong>é»˜è®¤ç½‘å…³ï¼ˆGatewayï¼‰æ˜¯ <code>192.168.200.1</code></strong></li>
<li>å¯ç”¨äº† NAT åŠŸèƒ½ï¼ˆæœ‰ <code>NAT è®¾ç½®</code> æŒ‰é’®ï¼Œä¸æ˜¯ç©ºçš„ï¼‰</li>
<li>å‹¾é€‰äº† â€œä½¿ç”¨æœ¬åœ° DHCP æœåŠ¡å°† IP åœ°å€åˆ†é…ç»™è™šæ‹Ÿæœºâ€ï¼ˆå»ºè®®å¼€å¯ï¼‰</li>
</ul>
<h2 id="âœ…-ç¬¬ä¸‰æ­¥ï¼šç¡®è®¤è™šæ‹Ÿæœºè·¯ç”±æ˜¯å¦å­˜åœ¨"><a href="#âœ…-ç¬¬ä¸‰æ­¥ï¼šç¡®è®¤è™šæ‹Ÿæœºè·¯ç”±æ˜¯å¦å­˜åœ¨" class="headerlink" title="âœ… ç¬¬ä¸‰æ­¥ï¼šç¡®è®¤è™šæ‹Ÿæœºè·¯ç”±æ˜¯å¦å­˜åœ¨"></a>âœ… ç¬¬ä¸‰æ­¥ï¼šç¡®è®¤è™šæ‹Ÿæœºè·¯ç”±æ˜¯å¦å­˜åœ¨</h2><p>åœ¨è™šæ‹Ÿæœºä¸­æ‰§è¡Œï¼š</p>
<pre><code>ip route
</code></pre>
<p>ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š</p>
<pre><code>default via 192.168.200.1 dev ens33
192.168.200.0/24 dev ens33 proto kernel scope link src 192.168.200.131
</code></pre>
<p>å¦‚æœæ²¡æœ‰ <code>default via 192.168.200.1</code>ï¼Œè¯´æ˜ç½‘å…³æ²¡ç”Ÿæ•ˆï¼Œè·¯ç”±ä¸é€šã€‚</p>
<hr>
<h2 id="âœ…-ç¬¬å››æ­¥ï¼šç¡®è®¤å®¿ä¸»æœºå¯ç”¨äº†-NAT-ç½‘ç»œæœåŠ¡"><a href="#âœ…-ç¬¬å››æ­¥ï¼šç¡®è®¤å®¿ä¸»æœºå¯ç”¨äº†-NAT-ç½‘ç»œæœåŠ¡" class="headerlink" title="âœ… ç¬¬å››æ­¥ï¼šç¡®è®¤å®¿ä¸»æœºå¯ç”¨äº† NAT ç½‘ç»œæœåŠ¡"></a>âœ… ç¬¬å››æ­¥ï¼šç¡®è®¤å®¿ä¸»æœºå¯ç”¨äº† NAT ç½‘ç»œæœåŠ¡</h2><ol>
<li>æ‰“å¼€ VMware ç½‘ç»œç¼–è¾‘å™¨ï¼ˆä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼‰</li>
<li>ç‚¹å‡» <code>VMnet8</code>ï¼Œç‚¹å³ä¾§çš„ â€œNAT è®¾ç½®â€</li>
<li>çœ‹åˆ°ï¼š</li>
</ol>
<pre><code>ç½‘å…³ IP: 192.168.200.1
</code></pre>
<p>ä¸‹é¢æ˜¯ç«¯å£è½¬å‘ä¹‹ç±»è®¾ç½®ï¼Œä¸ç”¨åŠ¨ã€‚</p>
<ol>
<li>ç¡®ä¿ VMware NAT Service æ˜¯è¿è¡ŒçŠ¶æ€ï¼š<ul>
<li>åœ¨å®¿ä¸»æœºæŒ‰ Win+R â†’ è¾“å…¥ <code>services.msc</code></li>
<li>æ‰¾åˆ° <code>VMware NAT Service</code> å’Œ <code>VMware DHCP Service</code></li>
<li>çŠ¶æ€å¿…é¡»æ˜¯â€œæ­£åœ¨è¿è¡Œâ€</li>
</ul>
</li>
</ol>
<hr>
<h2 id="âœ…-ç¬¬äº”æ­¥ï¼šæµ‹è¯•è¿æ¥"><a href="#âœ…-ç¬¬äº”æ­¥ï¼šæµ‹è¯•è¿æ¥" class="headerlink" title="âœ… ç¬¬äº”æ­¥ï¼šæµ‹è¯•è¿æ¥"></a>âœ… ç¬¬äº”æ­¥ï¼šæµ‹è¯•è¿æ¥</h2><ol>
<li>åœ¨è™šæ‹Ÿæœºé‡Œæ‰§è¡Œï¼š</li>
</ol>
<pre><code>ping 192.168.200.1
</code></pre>
<p>èƒ½ ping é€šè¯´æ˜ NAT ç½‘å…³ OKã€‚</p>
<ol>
<li>åœ¨è™šæ‹Ÿæœºé‡Œæ‰§è¡Œï¼š</li>
</ol>
<pre><code>ping 8.8.8.8
</code></pre>
<p>ä»ç„¶ä¸é€šï¼Œè¯´æ˜å‡ºç½‘å¤±è´¥ï¼Œå¯èƒ½æ˜¯ï¼š</p>
<ul>
<li>è·¯ç”±è¡¨é”™ï¼ˆ<code>ip route</code> æŸ¥çœ‹ï¼‰</li>
<li>NAT æœåŠ¡æ²¡å¼€ï¼ˆç¬¬ 4 æ­¥ï¼‰</li>
<li>æ²¡èµ°æ­£ç¡®ç½‘å…³ï¼ˆç¬¬ 1 æ­¥ï¼‰</li>
</ul>
<hr>
<hr>
<p>æŒ‰ç…§ä½ è¯´çš„åšäº† [root@localhost harbor]# docker ps | grep nginx 1773679bace8        goharbor&#x2F;nginx-photon:v1.9.2                             â€œnginx -g â€˜daemon ofâ€¦â€   9 seconds ago       Up 7 seconds (health: starting)    0.0.0.0:85-&gt;8080&#x2F;tcp        nginx 7e41a5e0662b        goharbor&#x2F;harbor-portal:v1.9.2                            â€œnginx -g â€˜daemon ofâ€¦â€   14 seconds ago      Up 10 seconds (health: starting)   8080&#x2F;tcp                    harbor-portal [root@localhost harbor]#</p>
<h6 id="ChatGPT-è¯´ï¼š-1"><a href="#ChatGPT-è¯´ï¼š-1" class="headerlink" title="ChatGPT è¯´ï¼š"></a>ChatGPT è¯´ï¼š</h6><p>éå¸¸å¥½ï¼Œä½ ç°åœ¨çš„æ“ä½œéƒ½æ²¡é”™ï¼Œä½†ä»è¿™æ¡æ—¥å¿—æ¥çœ‹ï¼š</p>
<pre><code>
0.0.0.0:85-&gt;8080/tcp        nginx
</code></pre>
<p>è¯´æ˜ <strong><code>docker-compose.yml</code> é‡Œä»ç„¶æ˜¯ <code>85:8080</code> æ˜ å°„</strong>ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ï¼š</p>
<pre><code>
85:80
</code></pre>
<hr>
<h2 id="âœ…-è§£å†³æ–¹æ¡ˆï¼šæ‰‹åŠ¨æ”¹ä¸€ä¸‹-docker-compose-ymlï¼Œç„¶åé‡æ–°å¯åŠ¨-Harbor"><a href="#âœ…-è§£å†³æ–¹æ¡ˆï¼šæ‰‹åŠ¨æ”¹ä¸€ä¸‹-docker-compose-ymlï¼Œç„¶åé‡æ–°å¯åŠ¨-Harbor" class="headerlink" title="âœ… è§£å†³æ–¹æ¡ˆï¼šæ‰‹åŠ¨æ”¹ä¸€ä¸‹ docker-compose.ymlï¼Œç„¶åé‡æ–°å¯åŠ¨ Harbor"></a>âœ… è§£å†³æ–¹æ¡ˆï¼šæ‰‹åŠ¨æ”¹ä¸€ä¸‹ <code>docker-compose.yml</code>ï¼Œç„¶åé‡æ–°å¯åŠ¨ Harbor</h2><h3 id="âœï¸-æ­¥éª¤-1ï¼šæ‰‹åŠ¨ä¿®æ”¹ç«¯å£æ˜ å°„"><a href="#âœï¸-æ­¥éª¤-1ï¼šæ‰‹åŠ¨ä¿®æ”¹ç«¯å£æ˜ å°„" class="headerlink" title="âœï¸ æ­¥éª¤ 1ï¼šæ‰‹åŠ¨ä¿®æ”¹ç«¯å£æ˜ å°„"></a>âœï¸ æ­¥éª¤ 1ï¼šæ‰‹åŠ¨ä¿®æ”¹ç«¯å£æ˜ å°„</h3><p>æ‰“å¼€ <code>docker-compose.yml</code>ï¼Œæ‰¾åˆ° <code>proxy:</code> ä¸‹é¢è¿™æ®µï¼š</p>
<pre><code>ports:
  - 85:8080
</code></pre>
<p>æ”¹æˆï¼š</p>
<pre><code>ports:
  - 85:80
</code></pre>
<blockquote>
<p>ğŸ” å¦‚æœä½ åœ¨ Vim é‡Œç¼–è¾‘ï¼Œæ”¹å®ŒåæŒ‰ï¼š</p>
<pre><code>Esc â†’ :wq
</code></pre>
</blockquote>
<hr>
<h3 id="ğŸ”„-æ­¥éª¤-2ï¼šé‡å¯-Harbor-æœåŠ¡"><a href="#ğŸ”„-æ­¥éª¤-2ï¼šé‡å¯-Harbor-æœåŠ¡" class="headerlink" title="ğŸ”„ æ­¥éª¤ 2ï¼šé‡å¯ Harbor æœåŠ¡"></a>ğŸ”„ æ­¥éª¤ 2ï¼šé‡å¯ Harbor æœåŠ¡</h3><pre><code>docker-compose down
docker-compose up -d
</code></pre>
<hr>
<h3 id="ğŸ”-æ­¥éª¤-3ï¼šç¡®è®¤ç«¯å£æ˜ å°„æ˜¯å¦æ­£ç¡®"><a href="#ğŸ”-æ­¥éª¤-3ï¼šç¡®è®¤ç«¯å£æ˜ å°„æ˜¯å¦æ­£ç¡®" class="headerlink" title="ğŸ” æ­¥éª¤ 3ï¼šç¡®è®¤ç«¯å£æ˜ å°„æ˜¯å¦æ­£ç¡®"></a>ğŸ” æ­¥éª¤ 3ï¼šç¡®è®¤ç«¯å£æ˜ å°„æ˜¯å¦æ­£ç¡®</h3><pre><code>docker ps | grep nginx
</code></pre>
<p>åº”è¯¥çœ‹åˆ°ï¼š</p>
<pre><code>0.0.0.0:85-&gt;80/tcp        nginx
</code></pre>
<hr>
<h3 id="âœ…-æœ€åï¼šæµè§ˆå™¨è®¿é—®-Harbor"><a href="#âœ…-æœ€åï¼šæµè§ˆå™¨è®¿é—®-Harbor" class="headerlink" title="âœ… æœ€åï¼šæµè§ˆå™¨è®¿é—® Harbor"></a>âœ… æœ€åï¼šæµè§ˆå™¨è®¿é—® Harbor</h3><p>æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š</p>
<pre><code>http://192.168.200.131:85/
</code></pre>
<p>ä½ åº”è¯¥èƒ½çœ‹åˆ° Harbor ç™»å½•é¡µé¢ã€‚</p>
<hr>
<hr>
<h2 id="ğŸ”-ç›®å‰æƒ…å†µæ€»ç»“ï¼š"><a href="#ğŸ”-ç›®å‰æƒ…å†µæ€»ç»“ï¼š" class="headerlink" title="ğŸ” ç›®å‰æƒ…å†µæ€»ç»“ï¼š"></a>ğŸ” ç›®å‰æƒ…å†µæ€»ç»“ï¼š</h2><table>
<thead>
<tr>
<th>é¡¹</th>
<th>çŠ¶æ€</th>
</tr>
</thead>
<tbody><tr>
<td><code>nginx</code> å®¹å™¨å¥åº·</td>
<td>âœ… <code>healthy</code></td>
</tr>
<tr>
<td><code>curl localhost:85</code></td>
<td>âŒ å¤±è´¥ï¼ˆæç¤ºï¼šConnection reset by peerï¼‰</td>
</tr>
<tr>
<td><code>ss -tnlp</code> æ˜¾ç¤ºç›‘å¬</td>
<td>âœ… <code>docker-proxy</code> åœ¨ç›‘å¬ <code>:::85</code></td>
</tr>
<tr>
<td><code>ping 192.168.200.131</code></td>
<td>âœ… é€š</td>
</tr>
<tr>
<td>æµè§ˆå™¨è®¿é—® <code>http://192.168.200.131:85</code></td>
<td>âŒ è¶…æ—¶</td>
</tr>
</tbody></table>
<h3 id="âœ…-æ­£ç¡®çš„é…ç½®åº”ä¸ºï¼š"><a href="#âœ…-æ­£ç¡®çš„é…ç½®åº”ä¸ºï¼š" class="headerlink" title="âœ… æ­£ç¡®çš„é…ç½®åº”ä¸ºï¼š"></a>âœ… æ­£ç¡®çš„é…ç½®åº”ä¸ºï¼š</h3><p>åœ¨ <code>docker-compose.yml</code> é‡Œï¼ŒæŠŠ <code>proxy</code> æœåŠ¡çš„ <code>ports</code> æ”¹ä¸ºï¼š</p>
<pre><code>ports:
  - 85:80
</code></pre>
<p>ç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆï¼š</p>
<pre><code># åœæ­¢å¹¶æ¸…ç†å®¹å™¨
docker-compose down

# å†å¯åŠ¨
docker-compose up -d
</code></pre>
<p>å†æ‰§è¡Œï¼š</p>
<pre><code>curl -I http://localhost:85
</code></pre>
<p>ä½ åº”è¯¥èƒ½çœ‹åˆ°ï¼š</p>
<pre><code>HTTP/1.1 200 OK
</code></pre>
<p>ç„¶åç”¨æµè§ˆå™¨è®¿é—®ï¼š</p>
<pre><code>http://192.168.200.131:85
</code></pre>
<p>âœ… æˆåŠŸè¿›å…¥ Harbor é¡µé¢ï¼</p>
<hr>
<hr>
<p>æˆ‘å·²ç»ç”¨äº†NATæ¨¡å¼ + é™æ€ip [root@localhost harbor]# curl -I <a target="_blank" rel="noopener" href="http://localhost:85/">http://localhost:85</a> curl: (56) Recv failure: Connection reset by peer [root@localhost harbor]# å—¯â€¦ æ— æ³•è®¿é—®æ­¤é¡µé¢ 192.168.200.131 å“åº”æ—¶é—´å¤ªé•¿ è¯·å°è¯•ï¼š åœ¨ Web ä¸Šæœç´¢ 192 168 200 131 æ£€æŸ¥è¿æ¥ æ£€æŸ¥ä»£ç†å’Œé˜²ç«å¢™ ERR_CONNECTION_TIMED_OUT</p>
<h6 id="ChatGPT-è¯´ï¼š-2"><a href="#ChatGPT-è¯´ï¼š-2" class="headerlink" title="ChatGPT è¯´ï¼š"></a>ChatGPT è¯´ï¼š</h6><p>ä½ ç°åœ¨çš„æƒ…å†µæ˜¯ï¼š</p>
<ul>
<li>âœ… å·²ç»ä½¿ç”¨äº† <strong>NAT æ¨¡å¼</strong>ï¼›</li>
<li>âœ… <code>docker ps</code> æ˜¾ç¤º Harbor çš„ <code>nginx</code> å®¹å™¨ <strong>ç«¯å£æ˜ å°„æ˜¯æ­£ç¡®çš„</strong>ï¼š<code>0.0.0.0:85-&gt;80</code>ï¼›</li>
<li>âŒ ä½† <code>curl localhost:85</code> æŠ¥é”™ï¼š<code>Connection reset by peer</code>ï¼Œè¯´æ˜å®¹å™¨é‡Œçš„ nginx æ‹’ç»äº†è¿æ¥ï¼›</li>
<li>âŒ ä¸»æœºè®¿é—® <code>http://192.168.200.131:85</code> æŠ¥è¶…æ—¶ï¼Œ<strong>NAT æœ¬èº«ä¸æ”¯æŒç›´æ¥è®¿é—®è™šæ‹Ÿæœºçš„ IP</strong>ï¼›</li>
<li>âœ… ä½ å·²ç»™è™šæ‹Ÿæœºè®¾ç½®é™æ€ IP ä¸º <code>192.168.200.131</code>ï¼›</li>
<li>â— <strong>ä½ æ²¡æœ‰é…ç½®ç«¯å£è½¬å‘ï¼</strong></li>
</ul>
<hr>
<h2 id="ğŸ¯-ç»“è®ºï¼šä½ ç°åœ¨è¿™ç§åšæ³•æ˜¯é”™è¯¯çš„"><a href="#ğŸ¯-ç»“è®ºï¼šä½ ç°åœ¨è¿™ç§åšæ³•æ˜¯é”™è¯¯çš„" class="headerlink" title="ğŸ¯ ç»“è®ºï¼šä½ ç°åœ¨è¿™ç§åšæ³•æ˜¯é”™è¯¯çš„"></a>ğŸ¯ ç»“è®ºï¼šä½ ç°åœ¨è¿™ç§åšæ³•æ˜¯é”™è¯¯çš„</h2><blockquote>
<p><strong>NAT æ¨¡å¼ä¸‹ï¼Œä¸»æœºä¸èƒ½é€šè¿‡è™šæ‹Ÿæœºçš„ IPï¼ˆ192.168.200.131ï¼‰è®¿é—® Harbor çš„ç«¯å£ã€‚</strong><br> <strong>åº”è¯¥é€šè¿‡ç«¯å£è½¬å‘å®ç°ï¼</strong></p>
</blockquote>
<hr>
<h2 id="âœ…-æ­£ç¡®åšæ³•ï¼šé…ç½®ç«¯å£è½¬å‘ï¼ˆNAT-âœ-ä¸»æœºæ˜ å°„ï¼‰"><a href="#âœ…-æ­£ç¡®åšæ³•ï¼šé…ç½®ç«¯å£è½¬å‘ï¼ˆNAT-âœ-ä¸»æœºæ˜ å°„ï¼‰" class="headerlink" title="âœ… æ­£ç¡®åšæ³•ï¼šé…ç½®ç«¯å£è½¬å‘ï¼ˆNAT âœ ä¸»æœºæ˜ å°„ï¼‰"></a>âœ… æ­£ç¡®åšæ³•ï¼šé…ç½®ç«¯å£è½¬å‘ï¼ˆNAT âœ ä¸»æœºæ˜ å°„ï¼‰</h2><h3 id="ğŸ› -æ­¥éª¤å¦‚ä¸‹ï¼š"><a href="#ğŸ› -æ­¥éª¤å¦‚ä¸‹ï¼š" class="headerlink" title="ğŸ›  æ­¥éª¤å¦‚ä¸‹ï¼š"></a>ğŸ›  æ­¥éª¤å¦‚ä¸‹ï¼š</h3><h4 id="â‘ -æ‰“å¼€-VMware-è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨"><a href="#â‘ -æ‰“å¼€-VMware-è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨" class="headerlink" title="â‘  æ‰“å¼€ VMware è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨"></a>â‘  æ‰“å¼€ VMware è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨</h4><ul>
<li>æ‰“å¼€ VMware Workstationï¼ˆéè™šæ‹Ÿæœºå†…éƒ¨ï¼‰</li>
<li>èœå•æ  âœ <code>ç¼–è¾‘</code> âœ <code>è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨</code></li>
<li>æ‰¾åˆ° <code>VMnet8</code>ï¼ˆå³ NAT æ¨¡å¼ï¼‰</li>
</ul>
<h4 id="â‘¡-ç‚¹å‡»å³ä¸‹è§’çš„â€œNAT-è®¾ç½®â€"><a href="#â‘¡-ç‚¹å‡»å³ä¸‹è§’çš„â€œNAT-è®¾ç½®â€" class="headerlink" title="â‘¡ ç‚¹å‡»å³ä¸‹è§’çš„â€œNAT è®¾ç½®â€"></a>â‘¡ ç‚¹å‡»å³ä¸‹è§’çš„â€œ<strong>NAT è®¾ç½®</strong>â€</h4><ul>
<li>åœ¨å¼¹å‡ºçš„ NAT è®¾ç½®çª—å£ä¸­ âœ ç‚¹å‡»â€œ<strong>ç«¯å£è½¬å‘ï¼ˆPort Forwardingï¼‰</strong>â€</li>
</ul>
<h4 id="â‘¢-æ·»åŠ ä¸€æ¡ç«¯å£è½¬å‘è§„åˆ™ï¼š"><a href="#â‘¢-æ·»åŠ ä¸€æ¡ç«¯å£è½¬å‘è§„åˆ™ï¼š" class="headerlink" title="â‘¢ æ·»åŠ ä¸€æ¡ç«¯å£è½¬å‘è§„åˆ™ï¼š"></a>â‘¢ æ·»åŠ ä¸€æ¡ç«¯å£è½¬å‘è§„åˆ™ï¼š</h4><table>
<thead>
<tr>
<th>åç§°</th>
<th>åè®®</th>
<th>ä¸»æœºç«¯å£</th>
<th>è™šæ‹Ÿæœº IP</th>
<th>è™šæ‹Ÿæœºç«¯å£</th>
</tr>
</thead>
<tbody><tr>
<td>harbor</td>
<td>TCP</td>
<td>1085</td>
<td>192.168.200.131</td>
<td>85</td>
</tr>
</tbody></table>
<blockquote>
<p>ä¸»æœºç«¯å£ä½ å¯ä»¥å†™ 1085ï¼Œé¿å…å†²çªï¼›è™šæ‹Ÿæœºç«¯å£æ˜¯ Harbor çš„ç«¯å£ 85ã€‚</p>
</blockquote>
<h2 id="ğŸ“Œ-è¯´æ˜ï¼šä¸ºä»€ä¹ˆ-NAT-æ¨¡å¼ä¸èƒ½ç›´æ¥è®¿é—®è™šæ‹Ÿæœº-IPï¼Ÿ"><a href="#ğŸ“Œ-è¯´æ˜ï¼šä¸ºä»€ä¹ˆ-NAT-æ¨¡å¼ä¸èƒ½ç›´æ¥è®¿é—®è™šæ‹Ÿæœº-IPï¼Ÿ" class="headerlink" title="ğŸ“Œ è¯´æ˜ï¼šä¸ºä»€ä¹ˆ NAT æ¨¡å¼ä¸èƒ½ç›´æ¥è®¿é—®è™šæ‹Ÿæœº IPï¼Ÿ"></a>ğŸ“Œ è¯´æ˜ï¼šä¸ºä»€ä¹ˆ NAT æ¨¡å¼ä¸èƒ½ç›´æ¥è®¿é—®è™šæ‹Ÿæœº IPï¼Ÿ</h2><blockquote>
<p>NAT æ¨¡å¼æ˜¯è™šæ‹Ÿæœºé€šè¿‡ä¸»æœºâ€œå…±äº«ç½‘ç»œâ€å‡ºå»è®¿é—®å¤–éƒ¨ï¼Œä½†ä¸»æœº<strong>æ— æ³•é€šè¿‡è™šæ‹Ÿæœºçš„ NAT IPï¼ˆå¦‚ 192.168.200.131ï¼‰è®¿é—®å›æ¥</strong>ï¼Œå› ä¸ºè¿™ä¸ªç½‘æ®µå¯¹ä¸»æœºæ¥è¯´æ˜¯éš”ç¦»çš„ã€‚<br> é™¤éåšç«¯å£è½¬å‘ï¼Œå¦åˆ™æ— æ³•é€šä¿¡ã€‚</p>
</blockquote>
<hr>
<hr>
<h3 id="ğŸ§­-æ¥ä¸‹æ¥çš„æœ€åä¸€æ­¥ï¼š"><a href="#ğŸ§­-æ¥ä¸‹æ¥çš„æœ€åä¸€æ­¥ï¼š" class="headerlink" title="ğŸ§­ æ¥ä¸‹æ¥çš„æœ€åä¸€æ­¥ï¼š"></a>ğŸ§­ æ¥ä¸‹æ¥çš„æœ€åä¸€æ­¥ï¼š</h3><p>ä½ å½“å‰çš„ç½‘ç»œç»“æ„æ˜¯ï¼š</p>
<pre><code class="yaml">Windows æµè§ˆå™¨è®¿é—® localhost:10085
 â†“
VMware NAT ç«¯å£è½¬å‘ï¼š10085 â†’ 192.168.200.131:85
 â†“
Harbor Dockerï¼š85 â†’ nginxå®¹å™¨çš„ 82
 â†“
nginx æ­£å¸¸ç›‘å¬ 82
</code></pre>
<p><code>cd /opt/harbor/</code></p>
<h5 id="æäº†å¥½ä¹…-ä¼°è®¡æ˜¯ç½‘ç»œ-é…ç½®çš„é—®é¢˜"><a href="#æäº†å¥½ä¹…-ä¼°è®¡æ˜¯ç½‘ç»œ-é…ç½®çš„é—®é¢˜" class="headerlink" title="æäº†å¥½ä¹… ä¼°è®¡æ˜¯ç½‘ç»œ+é…ç½®çš„é—®é¢˜"></a><span style = "color:red">æäº†å¥½ä¹… ä¼°è®¡æ˜¯ç½‘ç»œ+é…ç½®çš„é—®é¢˜</span></h5><p>è¿™æ˜¯<code>docker-compose.yml</code>çš„é…ç½®ä¿¡æ¯</p>
<pre><code class="yaml">version: &#39;2.3&#39;
services:
  log:
    image: goharbor/harbor-log:v1.9.2
    container_name: harbor-log
    restart: always
    dns_search: .
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - DAC_OVERRIDE
      - SETGID
      - SETUID
    volumes:
      - /var/log/harbor/:/var/log/docker/:z
      - ./common/config/log/logrotate.conf:/etc/logrotate.d/logrotate.conf:z
      - ./common/config/log/rsyslog_docker.conf:/etc/rsyslog.d/rsyslog_docker.conf:z
    ports:
      - 127.0.0.1:1514:10514
    networks:
      - harbor
  registry:
    image: goharbor/registry-photon:v2.7.1-patch-2819-2553-v1.9.2
    container_name: registry
    restart: always
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
    volumes:
      - /data/registry:/storage:z
      - ./common/config/registry/:/etc/registry/:z
      - type: bind
        source: /data/secret/registry/root.crt
        target: /etc/registry/root.crt
    networks:
      - harbor
    dns_search: .
    depends_on:
      - log
    logging:
      driver: &quot;syslog&quot;
      options:  
        syslog-address: &quot;tcp://127.0.0.1:1514&quot;
        tag: &quot;registry&quot;
  registryctl:
    image: goharbor/harbor-registryctl:v1.9.2
    container_name: registryctl
    env_file:
      - ./common/config/registryctl/env
    restart: always
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
    volumes:
      - /data/registry:/storage:z
      - ./common/config/registry/:/etc/registry/:z
      - type: bind
        source: ./common/config/registryctl/config.yml
        target: /etc/registryctl/config.yml
    networks:
      - harbor
    dns_search: .
    depends_on:
      - log
    logging:
      driver: &quot;syslog&quot;
      options:  
        syslog-address: &quot;tcp://127.0.0.1:1514&quot;
        tag: &quot;registryctl&quot;
  postgresql:
    image: goharbor/harbor-db:v1.9.2
    container_name: harbor-db
    restart: always
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - DAC_OVERRIDE
      - SETGID
      - SETUID
    volumes:
      - /data/database:/var/lib/postgresql/data:z
    networks:
      harbor:
    dns_search: .
    env_file:
      - ./common/config/db/env
    depends_on:
      - log
    logging:
      driver: &quot;syslog&quot;
      options:  
        syslog-address: &quot;tcp://127.0.0.1:1514&quot;
        tag: &quot;postgresql&quot;
  core:
    image: goharbor/harbor-core:v1.9.2
    container_name: harbor-core
    env_file:
      - ./common/config/core/env
    restart: always
    cap_drop:
      - ALL
    cap_add:
      - SETGID
      - SETUID
    volumes:
      - /data/ca_download/:/etc/core/ca/:z
      - /data/psc/:/etc/core/token/:z
      - /data/:/data/:z
      - ./common/config/core/certificates/:/etc/core/certificates/:z
      - type: bind
        source: ./common/config/core/app.conf
        target: /etc/core/app.conf
      - type: bind
        source: /data/secret/core/private_key.pem
        target: /etc/core/private_key.pem
      - type: bind
        source: /data/secret/keys/secretkey
        target: /etc/core/key
    networks:
      harbor:
    dns_search: .
    depends_on:
      - log
      - registry
      - redis
      - postgresql
    logging:
      driver: &quot;syslog&quot;
      options:  
        syslog-address: &quot;tcp://127.0.0.1:1514&quot;
        tag: &quot;core&quot;
  portal:
    image: goharbor/harbor-portal:v1.9.2
    container_name: harbor-portal
    restart: always
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
      - NET_BIND_SERVICE
    networks:
      - harbor
    dns_search: .
    depends_on:
      - log
    logging:
      driver: &quot;syslog&quot;
      options:
        syslog-address: &quot;tcp://127.0.0.1:1514&quot;
        tag: &quot;portal&quot;

  jobservice:
    image: goharbor/harbor-jobservice:v1.9.2
    container_name: harbor-jobservice
    env_file:
      - ./common/config/jobservice/env
    restart: always
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
    volumes:
      - /data/job_logs:/var/log/jobs:z
      - type: bind
        source: ./common/config/jobservice/config.yml
        target: /etc/jobservice/config.yml
    networks:
      - harbor
    dns_search: .
    depends_on:
      - core
    logging:
      driver: &quot;syslog&quot;
      options:
        syslog-address: &quot;tcp://127.0.0.1:1514&quot;
        tag: &quot;jobservice&quot;
  redis:
    image: goharbor/redis-photon:v1.9.2
    container_name: redis
    restart: always
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
    volumes:
      - /data/redis:/var/lib/redis
    networks:
      harbor:
    dns_search: .
    depends_on:
      - log
    logging:
      driver: &quot;syslog&quot;
      options:
        syslog-address: &quot;tcp://127.0.0.1:1514&quot;
        tag: &quot;redis&quot;
  proxy:
    image: goharbor/nginx-photon:v1.9.2
    container_name: nginx
    restart: always
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
      - NET_BIND_SERVICE
    volumes:
      - ./common/config/nginx:/etc/nginx:z
    networks:
      - harbor
    dns_search: .
    ports:
      - 85:8080
    depends_on:
      - registry
      - core
      - portal
      - log
    logging:
      driver: &quot;syslog&quot;
      options:  
        syslog-address: &quot;tcp://127.0.0.1:1514&quot;
        tag: &quot;proxy&quot;
networks:
  harbor:
    external: false
</code></pre>
<h6 id="è¿™æ˜¯harboré‡Œçš„nginxçš„é…ç½®"><a href="#è¿™æ˜¯harboré‡Œçš„nginxçš„é…ç½®" class="headerlink" title="è¿™æ˜¯harboré‡Œçš„nginxçš„é…ç½®"></a>è¿™æ˜¯harboré‡Œçš„nginxçš„é…ç½®</h6><pre><code class="yaml">[root@localhost nginx]# cat nginx.conf

worker_processes auto;
pid /tmp/nginx.pid;

events &#123;
  worker_connections 1024;
  use epoll;
  multi_accept on;
&#125;

http &#123;
  client_body_temp_path /tmp/client_body_temp;
  proxy_temp_path /tmp/proxy_temp;
  fastcgi_temp_path /tmp/fastcgi_temp;
  uwsgi_temp_path /tmp/uwsgi_temp;
  scgi_temp_path /tmp/scgi_temp;
  tcp_nodelay on;

  # this is necessary for us to be able to disable request buffering in all cases
  proxy_http_version 1.1;

  upstream core &#123;
    server core:8080;
  &#125;

  upstream portal &#123;
    server portal:8080;
  &#125;

  log_format timed_combined &#39;$remote_addr - &#39;
    &#39;&quot;$request&quot; $status $body_bytes_sent &#39;
    &#39;&quot;$http_referer&quot; &quot;$http_user_agent&quot; &#39;
    &#39;$request_time $upstream_response_time $pipe&#39;;

  access_log /dev/stdout timed_combined;

  server &#123;
    listen 8080;
    server_tokens off;
    # disable any limits to avoid HTTP 413 for large image uploads
    client_max_body_size 0;

    # Add extra headers
    add_header X-Frame-Options DENY;
    add_header Content-Security-Policy &quot;frame-ancestors &#39;none&#39;&quot;;

    # costumized location config file can place to /etc/nginx/etc with prefix harbor.http. and suffix .conf
    include /etc/nginx/conf.d/harbor.http.*.conf;

    location / &#123;
      proxy_pass http://portal/;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

      # When setting up Harbor behind other proxy, such as an Nginx instance, remove the below line if the proxy already has similar settings.
      proxy_set_header X-Forwarded-Proto $scheme;

      proxy_buffering off;
      proxy_request_buffering off;
    &#125;

    location /c/ &#123;
      proxy_pass http://core/c/;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

      # When setting up Harbor behind other proxy, such as an Nginx instance, remove the below line if the proxy already has similar settings.
      proxy_set_header X-Forwarded-Proto $scheme;

      proxy_buffering off;
      proxy_request_buffering off;
    &#125;

    location /api/ &#123;
      proxy_pass http://core/api/;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

      # When setting up Harbor behind other proxy, such as an Nginx instance, remove the below line if the proxy already has similar settings.
      proxy_set_header X-Forwarded-Proto $scheme;

      proxy_buffering off;
      proxy_request_buffering off;
    &#125;

    location /chartrepo/ &#123;
      proxy_pass http://core/chartrepo/;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

      # When setting up Harbor behind other proxy, such as an Nginx instance, remove the below line if the proxy already has similar settings.
      proxy_set_header X-Forwarded-Proto $scheme;

      proxy_buffering off;
      proxy_request_buffering off;
    &#125;

    location /v1/ &#123;
      return 404;
    &#125;

    location /v2/ &#123;
      proxy_pass http://core/v2/;
      proxy_set_header Host $http_host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

      # When setting up Harbor behind other proxy, such as an Nginx instance, remove the below line if the proxy already has similar settings.
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_buffering off;
      proxy_request_buffering off;
    &#125;

    location /service/ &#123;
      proxy_pass http://core/service/;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

      # When setting up Harbor behind other proxy, such as an Nginx instance, remove the below line if the proxy already has similar settings.
      proxy_set_header X-Forwarded-Proto $scheme;

      proxy_buffering off;
      proxy_request_buffering off;
    &#125;

    location /service/notifications &#123;
      return 404;
    &#125;
  &#125;
&#125;
</code></pre>
<p><span style = "color:red"><strong>è¿™é‡Œé™„å¸¦é‡å¤§BUGæ’æŸ¥æ€è·¯</strong></span></p>
<p>å½“ç„¶å¯ä»¥ï¼æˆ‘å¸®ä½ æŠŠè¿™æ•´ä¸ªè¿‡ç¨‹çš„é”™è¯¯ã€æ¶‰åŠçš„å®¿ä¸»æœºã€è™šæ‹Ÿæœºã€nginxï¼ˆå®¿ä¸»æœºä¸å®¹å™¨é‡ŒHarborçš„nginxï¼‰ï¼Œä»¥åŠæ’æŸ¥æ€è·¯ï¼Œç»¼åˆè®²æ¸…æ¥šï¼Œæ–¹ä¾¿ä½ ç†è§£æ•´ä½“æµç¨‹ã€‚</p>
<hr>
<h1 id="1-ç›¸å…³ç¯å¢ƒå’Œç»„ä»¶è¯´æ˜"><a href="#1-ç›¸å…³ç¯å¢ƒå’Œç»„ä»¶è¯´æ˜" class="headerlink" title="1. ç›¸å…³ç¯å¢ƒå’Œç»„ä»¶è¯´æ˜"></a>1. ç›¸å…³ç¯å¢ƒå’Œç»„ä»¶è¯´æ˜</h1><ul>
<li><strong>å®¿ä¸»æœº</strong>ï¼šä½ çš„çœŸå®ç‰©ç†æœºæˆ–ä¸»æœºç³»ç»Ÿï¼ˆWindowsï¼‰ï¼Œè´Ÿè´£è¿è¡Œè™šæ‹Ÿæœºè½¯ä»¶ï¼ˆæ¯”å¦‚VMwareï¼‰ã€‚</li>
<li><strong>è™šæ‹Ÿæœº</strong>ï¼šè¿è¡Œ Harbor çš„ Linux è™šæ‹Ÿæœºï¼ˆ192.168.200.131ï¼‰ï¼Œæ˜¯ Harbor çš„éƒ¨ç½²ç¯å¢ƒã€‚</li>
<li><strong>Docker å®¹å™¨å†…çš„ nginx</strong>ï¼šHarbor é‡Œå†…ç½®çš„ nginx ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œç›‘å¬å®¹å™¨å†…éƒ¨çš„ç«¯å£ï¼ˆå¦‚ 82 æˆ– 8080ï¼‰ï¼Œå°†è¯·æ±‚è½¬å‘ç»™ Harbor åº”ç”¨ç»„ä»¶ã€‚</li>
<li><strong>å®¿ä¸»æœºä¸è™šæ‹Ÿæœºçš„ç½‘ç»œ</strong>ï¼š<ul>
<li>è™šæ‹Ÿæœºé…ç½®æ¡¥æ¥æˆ–NATç½‘ç»œï¼Œå®¿ä¸»æœºé€šè¿‡ IP å’Œç«¯å£è½¬å‘è®¿é—®è™šæ‹Ÿæœºã€‚</li>
<li>ç«¯å£è½¬å‘éœ€ç¡®ä¿å®¿ä¸»æœºé˜²ç«å¢™ã€è™šæ‹Ÿæœºé˜²ç«å¢™å’Œ Docker ç«¯å£æ˜ å°„æ­£ç¡®ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h1 id="2-ä½ é‡åˆ°çš„ä¸»è¦é”™è¯¯å’Œç—‡çŠ¶æ€»ç»“"><a href="#2-ä½ é‡åˆ°çš„ä¸»è¦é”™è¯¯å’Œç—‡çŠ¶æ€»ç»“" class="headerlink" title="2. ä½ é‡åˆ°çš„ä¸»è¦é”™è¯¯å’Œç—‡çŠ¶æ€»ç»“"></a>2. ä½ é‡åˆ°çš„ä¸»è¦é”™è¯¯å’Œç—‡çŠ¶æ€»ç»“</h1><table>
<thead>
<tr>
<th>é”™è¯¯&#x2F;ç—‡çŠ¶</th>
<th>å¯èƒ½åŸå› </th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>Test-NetConnection</code> æç¤º TCP è¿æ¥å¤±è´¥ï¼ˆæ¯”å¦‚ç«¯å£1085å¤±è´¥ï¼Œ10085æˆåŠŸä½†æµè§ˆå™¨è¿æ¥æ‹’ç»ï¼‰</td>
<td>ç«¯å£æœªå¼€æ”¾æˆ–æœåŠ¡æœªç›‘å¬ï¼Œé˜²ç«å¢™æˆ–ç½‘ç»œé…ç½®é—®é¢˜</td>
<td>ç«¯å£æ˜ å°„æˆ–å®¹å™¨æœåŠ¡æ²¡å¯åŠ¨å¥½</td>
</tr>
<tr>
<td>Docker å¯åŠ¨ nginx å®¹å™¨æ—¶æŠ¥é”™ï¼š<code>unknown log opt &#39;syslog-address&#39; for json-file log driver</code></td>
<td><code>logging</code> é…ç½®ä¸å…¼å®¹ï¼Œ<code>json-file</code> é©±åŠ¨ä¸æ”¯æŒ <code>syslog-address</code> å‚æ•°</td>
<td>éœ€è¦è°ƒæ•´æ—¥å¿—é©±åŠ¨é…ç½®</td>
</tr>
<tr>
<td><code>curl http://localhost:85</code> è¿”å› 302 æˆ– 200ï¼Œä½†æµè§ˆå™¨è®¿é—®è™šæ‹ŸæœºIPæ—¶è¶…æ—¶æˆ–é‡ç½®è¿æ¥</td>
<td>è™šæ‹Ÿæœºé˜²ç«å¢™ã€å®¿ä¸»æœºç«¯å£è½¬å‘é…ç½®é”™è¯¯ï¼Œæˆ–è€…nginxç›‘å¬ç«¯å£é…ç½®ä¸ä¸€è‡´</td>
<td>å®¿ä¸»æœºè®¿é—®è™šæ‹Ÿæœºç«¯å£ä¸é€š</td>
</tr>
<tr>
<td>è™šæ‹Ÿæœºä¸Š <code>ss -tnlp</code> çœ‹åˆ° nginx ç›‘å¬çš„æ˜¯ 82 ç«¯å£ï¼Œè€Œ Docker æ˜ å°„æ˜¯ 85:82</td>
<td>ç«¯å£æ˜ å°„æ­£ç¡®ï¼Œä½†å®¿ä¸»æœºè®¿é—®ç«¯å£å’Œå†…éƒ¨ç›‘å¬ç«¯å£ä¸ä¸€è‡´éœ€è¦ç¡®è®¤</td>
<td>è®¿é—®æ—¶ç«¯å£é”™ä½ä¼šå¯¼è‡´è®¿é—®å¤±è´¥</td>
</tr>
</tbody></table>
<hr>
<h1 id="3-æ’æŸ¥æ€è·¯å’Œæ­¥éª¤è¯¦è§£"><a href="#3-æ’æŸ¥æ€è·¯å’Œæ­¥éª¤è¯¦è§£" class="headerlink" title="3. æ’æŸ¥æ€è·¯å’Œæ­¥éª¤è¯¦è§£"></a>3. æ’æŸ¥æ€è·¯å’Œæ­¥éª¤è¯¦è§£</h1><h3 id="Step-1ï¼šç¡®è®¤å®¹å™¨æœåŠ¡å¯åŠ¨åŠç«¯å£ç›‘å¬æƒ…å†µ"><a href="#Step-1ï¼šç¡®è®¤å®¹å™¨æœåŠ¡å¯åŠ¨åŠç«¯å£ç›‘å¬æƒ…å†µ" class="headerlink" title="Step 1ï¼šç¡®è®¤å®¹å™¨æœåŠ¡å¯åŠ¨åŠç«¯å£ç›‘å¬æƒ…å†µ"></a>Step 1ï¼šç¡®è®¤å®¹å™¨æœåŠ¡å¯åŠ¨åŠç«¯å£ç›‘å¬æƒ…å†µ</h3><ul>
<li><code>docker-compose up -d</code> å¯åŠ¨ Harbor ç›¸å…³æœåŠ¡ï¼ŒåŒ…æ‹¬ nginx ä»£ç†å®¹å™¨ã€‚</li>
<li><code>docker ps</code> çœ‹ nginx å®¹å™¨æ˜¯å¦åœ¨è¿è¡Œã€‚</li>
<li><code>docker logs nginx</code> æŸ¥çœ‹ nginx å®¹å™¨æ—¥å¿—ï¼Œçœ‹æ˜¯å¦æŠ¥é”™ã€‚</li>
<li><code>ss -tnlp</code>ï¼ˆæˆ– <code>netstat -tnlp</code>ï¼‰ç¡®è®¤ nginx å®¹å™¨å†…éƒ¨ç›‘å¬ç«¯å£ï¼Œä¾‹å¦‚82æˆ–8080ã€‚</li>
</ul>
<hr>
<h3 id="Step-2ï¼šç¡®è®¤ç«¯å£æ˜ å°„å’Œå®¿ä¸»æœºç½‘ç»œ"><a href="#Step-2ï¼šç¡®è®¤ç«¯å£æ˜ å°„å’Œå®¿ä¸»æœºç½‘ç»œ" class="headerlink" title="Step 2ï¼šç¡®è®¤ç«¯å£æ˜ å°„å’Œå®¿ä¸»æœºç½‘ç»œ"></a>Step 2ï¼šç¡®è®¤ç«¯å£æ˜ å°„å’Œå®¿ä¸»æœºç½‘ç»œ</h3><ul>
<li>ç¡®è®¤ docker-compose ç«¯å£æ˜ å°„ï¼Œæ¯”å¦‚ <code>- 85:82</code> è¯´æ˜å®¿ä¸»æœº85ç«¯å£æ˜ å°„åˆ°å®¹å™¨82ç«¯å£ã€‚</li>
<li>ç¡®è®¤è™šæ‹Ÿæœºçš„ç½‘ç»œIPï¼ˆ192.168.200.131ï¼‰å¯è®¿é—®ï¼Œè™šæ‹Ÿæœºæ˜¯å¦å…è®¸è®¿é—®85ç«¯å£ã€‚</li>
<li>é€šè¿‡å®¿ä¸»æœºï¼ˆWindowsï¼‰<code>Test-NetConnection 192.168.200.131 85</code> æµ‹è¯•è¿é€šæ€§ã€‚</li>
<li>å¦‚æœç«¯å£è¿æ¥å¤±è´¥ï¼Œæ£€æŸ¥ï¼š<ul>
<li>è™šæ‹Ÿæœºé˜²ç«å¢™çŠ¶æ€ï¼ˆå¦‚ <code>firewall-cmd</code>ï¼‰ï¼Œç¡®è®¤85ç«¯å£å¼€æ”¾ã€‚</li>
<li>è™šæ‹Ÿæœºç½‘ç»œé…ç½®æ˜¯å¦æ­£ç¡®ã€‚</li>
<li>å®¿ä¸»æœºæ˜¯å¦æ­£ç¡®åšäº†ç«¯å£è½¬å‘ï¼ˆNATé…ç½®ç­‰ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h3 id="Step-3ï¼šç¡®è®¤å®¿ä¸»æœºä¸è™šæ‹Ÿæœºé—´ç«¯å£è½¬å‘ä¸é˜²ç«å¢™è®¾ç½®"><a href="#Step-3ï¼šç¡®è®¤å®¿ä¸»æœºä¸è™šæ‹Ÿæœºé—´ç«¯å£è½¬å‘ä¸é˜²ç«å¢™è®¾ç½®" class="headerlink" title="Step 3ï¼šç¡®è®¤å®¿ä¸»æœºä¸è™šæ‹Ÿæœºé—´ç«¯å£è½¬å‘ä¸é˜²ç«å¢™è®¾ç½®"></a>Step 3ï¼šç¡®è®¤å®¿ä¸»æœºä¸è™šæ‹Ÿæœºé—´ç«¯å£è½¬å‘ä¸é˜²ç«å¢™è®¾ç½®</h3><ul>
<li>ä½ ä¹‹å‰åšçš„ VMware NAT ç«¯å£è½¬å‘é…ç½®ï¼Œç¡®è®¤å®¿ä¸»æœºçš„10085ç«¯å£è½¬å‘åˆ°è™šæ‹Ÿæœºçš„85ç«¯å£ã€‚</li>
<li>è™šæ‹Ÿæœºé˜²ç«å¢™æ˜¯å¦ç¦ç”¨æˆ–å¼€æ”¾è¯¥ç«¯å£ï¼ˆä½ ç¡®è®¤äº† <code>firewalld</code> æœªè¿è¡Œï¼‰ã€‚</li>
<li>SELinux çŠ¶æ€ï¼ˆä½ ç¡®è®¤æ˜¯ <code>Permissive</code>ï¼Œä¸é˜»æ­¢ï¼‰ã€‚</li>
</ul>
<hr>
<h3 id="Step-4ï¼šç¡®è®¤å®¹å™¨å†…éƒ¨-nginx-ä¸-Harbor-åº”ç”¨è¿è¡ŒçŠ¶æ€"><a href="#Step-4ï¼šç¡®è®¤å®¹å™¨å†…éƒ¨-nginx-ä¸-Harbor-åº”ç”¨è¿è¡ŒçŠ¶æ€" class="headerlink" title="Step 4ï¼šç¡®è®¤å®¹å™¨å†…éƒ¨ nginx ä¸ Harbor åº”ç”¨è¿è¡ŒçŠ¶æ€"></a>Step 4ï¼šç¡®è®¤å®¹å™¨å†…éƒ¨ nginx ä¸ Harbor åº”ç”¨è¿è¡ŒçŠ¶æ€</h3><ul>
<li>å®¹å™¨å†… nginx é…ç½®ç›‘å¬82ç«¯å£ï¼Œä½†å¤–éƒ¨æ˜ å°„æˆ85ç«¯å£ï¼Œç¡®è®¤ä¸¤è€…ä¸€è‡´ã€‚</li>
<li>å®¹å™¨å†… curl localhost:82 è¿”å›200ï¼Œè¯´æ˜ nginx æœåŠ¡æ­£å¸¸ã€‚</li>
<li>nginx è¿”å›çš„ç½‘é¡µä¸­åŒ…å« Harbor å‰ç«¯é™æ€èµ„æºï¼Œä½†å‰ç«¯ä¸€ç›´è½¬åœˆï¼Œå¯èƒ½æ˜¯åç«¯ API æ²¡å“åº”ã€‚</li>
<li>å¯èƒ½æ˜¯ Harbor æ ¸å¿ƒæœåŠ¡(core)æœªæ­£å¸¸å·¥ä½œæˆ–è®¿é—®ä¸åˆ°æ•°æ®åº“&#x2F;redisï¼Œå¯¼è‡´é¡µé¢æ²¡åŠ è½½å®Œæˆã€‚</li>
</ul>
<hr>
<h3 id="Step-5ï¼šé‡å¯è™šæ‹Ÿæœºåé—®é¢˜æ¶ˆå¤±"><a href="#Step-5ï¼šé‡å¯è™šæ‹Ÿæœºåé—®é¢˜æ¶ˆå¤±" class="headerlink" title="Step 5ï¼šé‡å¯è™šæ‹Ÿæœºåé—®é¢˜æ¶ˆå¤±"></a>Step 5ï¼šé‡å¯è™šæ‹Ÿæœºåé—®é¢˜æ¶ˆå¤±</h3><ul>
<li>é‡å¯è™šæ‹Ÿæœºåï¼Œç½‘ç»œé‡æ–°åˆå§‹åŒ–ï¼ŒDockerç½‘ç»œä¹Ÿé‡å»ºï¼Œç«¯å£è½¬å‘ç”Ÿæ•ˆï¼Œnginxå’ŒHarboræœåŠ¡æ­£å¸¸ï¼Œæµè§ˆå™¨è®¿é—®æˆåŠŸã€‚</li>
<li>è¯´æ˜ä¹‹å‰ç½‘ç»œç¯å¢ƒï¼ˆç«¯å£è½¬å‘ã€Dockerç½‘ç»œæˆ–nginxç›‘å¬ï¼‰å­˜åœ¨ç¼“å­˜æˆ–æœªæ­£å¸¸å¯åŠ¨çš„é—®é¢˜ã€‚</li>
</ul>
<hr>
<h1 id="4-ä½ çœ‹åˆ°çš„â€œå®¿ä¸»æœºä¸è™šæ‹Ÿæœºâ€å’Œâ€œnginxå†…éƒ¨-x2F-å¤–éƒ¨â€çš„å…³ç³»"><a href="#4-ä½ çœ‹åˆ°çš„â€œå®¿ä¸»æœºä¸è™šæ‹Ÿæœºâ€å’Œâ€œnginxå†…éƒ¨-x2F-å¤–éƒ¨â€çš„å…³ç³»" class="headerlink" title="4. ä½ çœ‹åˆ°çš„â€œå®¿ä¸»æœºä¸è™šæ‹Ÿæœºâ€å’Œâ€œnginxå†…éƒ¨&#x2F;å¤–éƒ¨â€çš„å…³ç³»"></a>4. ä½ çœ‹åˆ°çš„â€œå®¿ä¸»æœºä¸è™šæ‹Ÿæœºâ€å’Œâ€œnginxå†…éƒ¨&#x2F;å¤–éƒ¨â€çš„å…³ç³»</h1><table>
<thead>
<tr>
<th>å±‚çº§</th>
<th>ä½œç”¨</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å®¿ä¸»æœº (Windows)</strong></td>
<td>ä½ ç›´æ¥æ“ä½œçš„æœºå™¨ï¼Œè¿è¡Œ VMwareï¼Œæä¾› NAT&#x2F;æ¡¥æ¥ç½‘ç»œï¼Œåšç«¯å£è½¬å‘</td>
<td>è®¿é—®è™šæ‹ŸæœºIPå’Œç«¯å£</td>
</tr>
<tr>
<td><strong>è™šæ‹Ÿæœº (Linux Harbor ç¯å¢ƒ)</strong></td>
<td>Harbor éƒ¨ç½²ç¯å¢ƒï¼Œè¿è¡Œ Docker å’Œ Harbor æœåŠ¡å®¹å™¨</td>
<td>è™šæ‹Ÿæœºé˜²ç«å¢™å’Œç½‘ç»œè®¾ç½®å¿…é¡»æ­£ç¡®</td>
</tr>
<tr>
<td><strong>Docker å®¹å™¨å†… nginx</strong></td>
<td>Harbor çš„åå‘ä»£ç†ï¼Œç›‘å¬å®¹å™¨å†…éƒ¨ç«¯å£ï¼ˆå¦‚82ï¼‰ï¼Œè½¬å‘ç»™ Harbor åº”ç”¨æœåŠ¡</td>
<td>Dockerç«¯å£æ˜ å°„ï¼šå®¿ä¸»æœº85ç«¯å£æ˜ å°„åˆ°å®¹å™¨82ç«¯å£</td>
</tr>
<tr>
<td><strong>Harbor åº”ç”¨ç»„ä»¶</strong></td>
<td>Coreã€Portalã€Registry ç­‰ï¼Œè´Ÿè´£ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®</td>
<td>éœ€è¦æ•°æ®åº“å’Œredisæ”¯æŒï¼ŒæœåŠ¡æ­£å¸¸æ‰èƒ½æ­£å¸¸è®¿é—®</td>
</tr>
</tbody></table>
<hr>
<h1 id="5-ç»¼åˆæ€»ç»“"><a href="#5-ç»¼åˆæ€»ç»“" class="headerlink" title="5. ç»¼åˆæ€»ç»“"></a>5. ç»¼åˆæ€»ç»“</h1><ul>
<li>ä½ å…ˆé‡åˆ°çš„ç«¯å£è¿æ¥å¤±è´¥ï¼Œæ˜¯è™šæ‹Ÿæœºå†…æœåŠ¡ç›‘å¬ã€ç«¯å£æ˜ å°„ã€è™šæ‹Ÿæœºé˜²ç«å¢™æˆ–å®¿ä¸»æœºç«¯å£è½¬å‘é…ç½®çš„é—®é¢˜ã€‚</li>
<li>Docker å®¹å™¨æ—¥å¿—ä¸­çš„ <code>unknown log opt &#39;syslog-address&#39;</code> æ˜¯æ—¥å¿—é©±åŠ¨é…ç½®é”™è¯¯ï¼Œéœ€è¦ç»Ÿä¸€ç”¨ <code>json-file</code> æˆ–å…¼å®¹çš„é©±åŠ¨ã€‚</li>
<li>å®¿ä¸»æœºè®¿é—®ç«¯å£å’Œå®¹å™¨ç›‘å¬ç«¯å£è¦å¯¹åº”ï¼Œnginxç›‘å¬82ç«¯å£ï¼Œå®¿ä¸»æœºæ˜ å°„85ç«¯å£ï¼Œè®¿é—®æ—¶è¦ç”¨å®¿ä¸»æœºçš„85ç«¯å£ã€‚</li>
<li>è®¿é—® Harbor é¦–é¡µçœ‹åˆ° nginx è¿”å› 200ï¼Œè¯´æ˜ nginx æ­£å¸¸ï¼Œå‰ç«¯é¡µé¢å¼€å§‹åŠ è½½ï¼Œä½†è‹¥é¡µé¢å¡ä½ï¼Œå¯èƒ½æ˜¯åç«¯æœåŠ¡æœªå®Œå…¨å¯åŠ¨æˆ–ç½‘ç»œè®¿é—®ä¸åˆ°å…¶ä»– Harbor æœåŠ¡ã€‚</li>
<li>é‡å¯è™šæ‹Ÿæœºä¼šåˆ·æ–°ç½‘ç»œç¯å¢ƒå’Œå®¹å™¨æœåŠ¡ï¼Œè§£å†³äº†ä¹‹å‰éšè—çš„ç½‘ç»œç«¯å£è½¬å‘ã€Dockerç½‘ç»œæˆ–è€…æœåŠ¡å¯åŠ¨é¡ºåºçš„é—®é¢˜ã€‚</li>
<li>æœ€åç¡®è®¤æœåŠ¡æ­£å¸¸ï¼Œå¯ä»¥è®¿é—®é¡µé¢ã€‚</li>
</ul>
<hr>
<p>å¦‚æœæ€»ç»“èµ·æ¥ï¼Œæ•´ä¸ªæ’æŸ¥æµç¨‹æ˜¯ï¼š</p>
<ol>
<li><strong>ç¡®è®¤æœåŠ¡å¯åŠ¨å’Œç«¯å£ç›‘å¬</strong>ï¼ˆ<code>docker-compose up</code>ã€<code>ss -tnlp</code>ã€<code>docker logs</code>ï¼‰ã€‚</li>
<li><strong>æ£€æŸ¥ç«¯å£æ˜ å°„å’Œè™šæ‹Ÿæœºç½‘ç»œé…ç½®</strong>ï¼ˆNATç«¯å£è½¬å‘ã€è™šæ‹ŸæœºIPã€é˜²ç«å¢™ï¼‰ã€‚</li>
<li><strong>å®¿ä¸»æœºè®¿é—®æµ‹è¯•</strong>ï¼ˆPowerShellçš„Test-NetConnectionï¼‰ã€‚</li>
<li><strong>ç¡®è®¤å®¹å™¨å†…æœåŠ¡çŠ¶æ€</strong>ï¼ˆå®¹å™¨å†…curlï¼‰ã€‚</li>
<li><strong>è°ƒæ•´é…ç½®å¹¶é‡å¯éªŒè¯</strong>ã€‚</li>
<li><strong>æœ€ç»ˆç¡®è®¤é¡µé¢è®¿é—®æ­£å¸¸</strong>ã€‚</li>
</ol>
<hr>
<h1 id="Harbor-è®¿é—®æ•…éšœæ’æŸ¥æ–‡æ¡£"><a href="#Harbor-è®¿é—®æ•…éšœæ’æŸ¥æ–‡æ¡£" class="headerlink" title="Harbor è®¿é—®æ•…éšœæ’æŸ¥æ–‡æ¡£"></a>Harbor è®¿é—®æ•…éšœæ’æŸ¥æ–‡æ¡£</h1><h2 id="ä¸€ã€èƒŒæ™¯è¯´æ˜"><a href="#ä¸€ã€èƒŒæ™¯è¯´æ˜" class="headerlink" title="ä¸€ã€èƒŒæ™¯è¯´æ˜"></a>ä¸€ã€èƒŒæ™¯è¯´æ˜</h2><p>ä½ åœ¨è™šæ‹Ÿæœºä¸Šç”¨ Docker Compose éƒ¨ç½² Harborï¼Œé‡åˆ°å®¿ä¸»æœºè®¿é—® Harbor Web UI ç«¯å£æ— æ³•è¿æ¥çš„é—®é¢˜ã€‚æœ¬æ–‡æ¡£æ€»ç»“äº†æ’æŸ¥å’Œè§£å†³è¿‡ç¨‹ï¼Œè¦†ç›–å®¹å™¨æœåŠ¡çŠ¶æ€ã€ç«¯å£æ˜ å°„ã€è™šæ‹Ÿæœºç½‘ç»œã€é˜²ç«å¢™é…ç½®ç­‰å…³é”®ç‚¹ã€‚</p>
<hr>
<h2 id="äºŒã€æ’æŸ¥å‡†å¤‡"><a href="#äºŒã€æ’æŸ¥å‡†å¤‡" class="headerlink" title="äºŒã€æ’æŸ¥å‡†å¤‡"></a>äºŒã€æ’æŸ¥å‡†å¤‡</h2><ul>
<li><strong>å®¿ä¸»æœºç¯å¢ƒ</strong>ï¼šWindowsï¼ˆé€šè¿‡ VMware è¿è¡Œè™šæ‹Ÿæœºï¼‰</li>
<li><strong>è™šæ‹Ÿæœºç¯å¢ƒ</strong>ï¼šLinuxï¼ŒHarbor æœåŠ¡éƒ¨ç½²ç¯å¢ƒï¼ŒIP å¦‚ <code>192.168.200.131</code></li>
<li><strong>Docker Harbor ç‰ˆæœ¬</strong>ï¼šv1.9.2</li>
<li><strong>è®¿é—®ç«¯å£æ˜ å°„</strong>ï¼šå®¿ä¸»æœºç«¯å£ 85 æ˜ å°„åˆ°å®¹å™¨å†… nginx ç›‘å¬ç«¯å£ 82</li>
</ul>
<hr>
<h2 id="ä¸‰ã€æ’æŸ¥æ­¥éª¤"><a href="#ä¸‰ã€æ’æŸ¥æ­¥éª¤" class="headerlink" title="ä¸‰ã€æ’æŸ¥æ­¥éª¤"></a>ä¸‰ã€æ’æŸ¥æ­¥éª¤</h2><h3 id="Step-1-å®¹å™¨æœåŠ¡å¯åŠ¨çŠ¶æ€æ£€æŸ¥"><a href="#Step-1-å®¹å™¨æœåŠ¡å¯åŠ¨çŠ¶æ€æ£€æŸ¥" class="headerlink" title="Step 1. å®¹å™¨æœåŠ¡å¯åŠ¨çŠ¶æ€æ£€æŸ¥"></a>Step 1. å®¹å™¨æœåŠ¡å¯åŠ¨çŠ¶æ€æ£€æŸ¥</h3><ul>
<li><p>ä½¿ç”¨å‘½ä»¤ï¼š</p>
<pre><code>bashå¤åˆ¶ç¼–è¾‘docker-compose up -d
docker ps
docker logs nginx --tail 50
</code></pre>
</li>
<li><p>ç¡®è®¤ nginx å®¹å™¨åŠå…¶ä»– Harbor æœåŠ¡å®¹å™¨æ˜¯å¦è¿è¡Œæ­£å¸¸ï¼Œæ²¡æœ‰æŠ¥é”™ã€‚</p>
</li>
<li><p>ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç«¯å£ç›‘å¬ï¼š</p>
<pre><code>bash


ss -tnlp | grep nginx
</code></pre>
</li>
</ul>
<p> ç¡®è®¤ nginx æ˜¯å¦ç›‘å¬æ­£ç¡®çš„ç«¯å£ï¼ˆä¸€èˆ¬æ˜¯ 82 æˆ– 8080ï¼‰ã€‚</p>
<hr>
<h3 id="Step-2-Docker-ç«¯å£æ˜ å°„ä¸è™šæ‹Ÿæœºç«¯å£ç›‘å¬ç¡®è®¤"><a href="#Step-2-Docker-ç«¯å£æ˜ å°„ä¸è™šæ‹Ÿæœºç«¯å£ç›‘å¬ç¡®è®¤" class="headerlink" title="Step 2. Docker ç«¯å£æ˜ å°„ä¸è™šæ‹Ÿæœºç«¯å£ç›‘å¬ç¡®è®¤"></a>Step 2. Docker ç«¯å£æ˜ å°„ä¸è™šæ‹Ÿæœºç«¯å£ç›‘å¬ç¡®è®¤</h3><ul>
<li><p>æ£€æŸ¥ <code>docker-compose.yml</code> ç«¯å£æ˜ å°„é…ç½®ï¼Œå¦‚ï¼š</p>
<p>&#96;&#96;&#96;</p>
</li>
</ul>
<p>ports:<br>    - 85:82</p>
<pre><code>
è¡¨ç¤ºå®¿ä¸»æœºï¼ˆè™šæ‹Ÿæœºï¼‰85ç«¯å£æ˜ å°„åˆ°å®¹å™¨82ç«¯å£ã€‚

- åœ¨è™šæ‹Ÿæœºä¸Šç¡®è®¤ç«¯å£ç›‘å¬ï¼š
</code></pre>
<pre><code>ss -tnlp | grep :85
```
</code></pre>
<p>  é€šå¸¸ docker-proxy ä¼šç›‘å¬å¯¹åº”ç«¯å£ã€‚</p>
<hr>
<h3 id="Step-3-è™šæ‹Ÿæœºç½‘ç»œé…ç½®å’Œé˜²ç«å¢™æ£€æŸ¥"><a href="#Step-3-è™šæ‹Ÿæœºç½‘ç»œé…ç½®å’Œé˜²ç«å¢™æ£€æŸ¥" class="headerlink" title="Step 3. è™šæ‹Ÿæœºç½‘ç»œé…ç½®å’Œé˜²ç«å¢™æ£€æŸ¥"></a>Step 3. è™šæ‹Ÿæœºç½‘ç»œé…ç½®å’Œé˜²ç«å¢™æ£€æŸ¥</h3><ul>
<li>æ£€æŸ¥è™šæ‹Ÿæœºçš„é˜²ç«å¢™çŠ¶æ€ï¼š</li>
</ul>
<pre><code>
firewall-cmd --state
</code></pre>
<pre><code>ç¡®ä¿é˜²ç«å¢™å…³é—­æˆ–å·²å¼€æ”¾å¯¹åº”ç«¯å£ã€‚
</code></pre>
<ul>
<li><p>æŸ¥çœ‹ SELinux çŠ¶æ€ï¼ˆæœ‰æ—¶ä¼šé˜»æ­¢ç½‘ç»œæœåŠ¡ï¼‰ï¼š</p>
<p>&#96;&#96;&#96;<br> getenforce</p>
</li>
</ul>
<pre><code>
å»ºè®®è®¾ç½®ä¸º `Permissive` æˆ– `Disabled`ã€‚

- æ£€æŸ¥è™šæ‹Ÿæœºçš„ IP é…ç½®ï¼Œç¡®è®¤ä½¿ç”¨çš„æ˜¯æ­£ç¡®çš„ IPã€‚
 
 - åœ¨å®¿ä¸»æœºï¼ˆWindowsï¼‰ä¸Šä½¿ç”¨ PowerShell æµ‹è¯•ç«¯å£è¿é€šï¼š
</code></pre>
<p>  powershell</p>
<p> å¤åˆ¶ç¼–è¾‘<br>  Test-NetConnection -ComputerName 192.168.200.131 -Port 85</p>
<pre><code>
------

### Step 4. å®¿ä¸»æœºä¸è™šæ‹Ÿæœºç«¯å£è½¬å‘è®¾ç½®ï¼ˆNATæ¨¡å¼ï¼‰
 
 - å¦‚æœä½¿ç”¨ VMware NATï¼Œéœ€è¦åœ¨ VMware NAT è®¾ç½®ä¸­é…ç½®ç«¯å£è½¬å‘ï¼š
 - ä¸»æœºç«¯å£ï¼ˆå®¿ä¸»æœºï¼‰è®¾ä¸º `10085`ï¼ˆæˆ–ä½ éœ€è¦çš„ç«¯å£ï¼‰
 - è½¬å‘åˆ°è™šæ‹Ÿæœº IPï¼ˆå¦‚ `192.168.200.131`ï¼‰çš„ 85 ç«¯å£
- é€šè¿‡å®¿ä¸»æœºè®¿é—® `localhost:10085`ï¼Œå®é™…è®¿é—®è™šæ‹Ÿæœºçš„ Harbor æœåŠ¡ã€‚

------

### Step 5. ä½¿ç”¨ curl å‘½ä»¤æµ‹è¯•æœåŠ¡

- åœ¨è™šæ‹Ÿæœºå†…éƒ¨æµ‹è¯•ï¼š
</code></pre>
<p> curl -I <a target="_blank" rel="noopener" href="http://localhost:82/">http://localhost:82</a></p>
<pre><code>
- åœ¨è™šæ‹Ÿæœºå¤–éƒ¨æµ‹è¯•ï¼ˆå®¿ä¸»æœºï¼‰ï¼š
</code></pre>
<p>  curl -I <a target="_blank" rel="noopener" href="http://192.168.200.131:85/">http://192.168.200.131:85</a></p>
<pre><code>```
</code></pre>
<ul>
<li>è§‚å¯Ÿè¿”å›ç»“æœï¼Œç¡®è®¤ HTTP çŠ¶æ€ç æ˜¯å¦æ­£å¸¸ï¼ˆ200&#x2F;302 ç­‰ï¼‰ã€‚</li>
</ul>
<hr>
<h3 id="Step-6-é‡åˆ°é—®é¢˜çš„å…¸å‹ç—‡çŠ¶åŠå¯¹åº”å¤„ç†"><a href="#Step-6-é‡åˆ°é—®é¢˜çš„å…¸å‹ç—‡çŠ¶åŠå¯¹åº”å¤„ç†" class="headerlink" title="Step 6. é‡åˆ°é—®é¢˜çš„å…¸å‹ç—‡çŠ¶åŠå¯¹åº”å¤„ç†"></a>Step 6. é‡åˆ°é—®é¢˜çš„å…¸å‹ç—‡çŠ¶åŠå¯¹åº”å¤„ç†</h3><table>
<thead>
<tr>
<th>ç—‡çŠ¶</th>
<th>å¯èƒ½åŸå› </th>
<th>è§£å†³åŠæ³•</th>
</tr>
</thead>
<tbody><tr>
<td>å®¿ä¸»æœºæ— æ³•è¿æ¥ç«¯å£ï¼Œè¿æ¥è¶…æ—¶</td>
<td>é˜²ç«å¢™é˜»æ­¢ã€ç«¯å£æœªå¼€æ”¾</td>
<td>å…³é—­é˜²ç«å¢™æˆ–æ”¾è¡Œç«¯å£</td>
</tr>
<tr>
<td>curl è¿”å›è¿æ¥é‡ç½®æˆ–æ‹’ç»</td>
<td>æœåŠ¡æœªå¯åŠ¨æˆ–ç›‘å¬ç«¯å£é”™è¯¯</td>
<td>æ£€æŸ¥ nginx é…ç½®å’Œå®¹å™¨å¯åŠ¨</td>
</tr>
<tr>
<td>curl è¿”å›200ä½†é¡µé¢åŠ è½½ä¸å‡º</td>
<td>åç«¯æœåŠ¡æœªå°±ç»ªæˆ–ç½‘ç»œä¸é€š</td>
<td>æ£€æŸ¥ Harbor core æœåŠ¡çŠ¶æ€</td>
</tr>
<tr>
<td>æ—¥å¿—ä¸­æŠ¥é”™æ—¥å¿—é©±åŠ¨ä¸æ”¯æŒ</td>
<td>docker-compose æ—¥å¿—é…ç½®é”™è¯¯</td>
<td>ç»Ÿä¸€ä½¿ç”¨ <code>json-file</code> é©±åŠ¨</td>
</tr>
<tr>
<td>ç«¯å£æ˜ å°„é…ç½®é”™è¯¯</td>
<td>ç«¯å£æ˜ å°„å†™é”™</td>
<td>çº æ­£ <code>docker-compose.yml</code> ä¸­ç«¯å£æ˜ å°„</td>
</tr>
</tbody></table>
<hr>
<h3 id="Step-7-é‡å¯ç”Ÿæ•ˆéªŒè¯"><a href="#Step-7-é‡å¯ç”Ÿæ•ˆéªŒè¯" class="headerlink" title="Step 7. é‡å¯ç”Ÿæ•ˆéªŒè¯"></a>Step 7. é‡å¯ç”Ÿæ•ˆéªŒè¯</h3><ul>
<li>é‡å¯è™šæ‹Ÿæœºï¼Œæœ‰æ—¶å¯ä»¥ä¿®å¤ç½‘ç»œç»‘å®šã€ç«¯å£å†²çªç­‰éšæ‚£é—®é¢˜ã€‚</li>
<li>é‡å¯åå†æ¬¡æµ‹è¯•ç«¯å£è¿é€šæ€§å’Œé¡µé¢è®¿é—®ã€‚</li>
</ul>
<hr>
<h2 id="å››ã€ç¤ºä¾‹æ ¸å¿ƒé…ç½®ï¼ˆç«¯å£æ˜ å°„éƒ¨åˆ†ï¼‰"><a href="#å››ã€ç¤ºä¾‹æ ¸å¿ƒé…ç½®ï¼ˆç«¯å£æ˜ å°„éƒ¨åˆ†ï¼‰" class="headerlink" title="å››ã€ç¤ºä¾‹æ ¸å¿ƒé…ç½®ï¼ˆç«¯å£æ˜ å°„éƒ¨åˆ†ï¼‰"></a>å››ã€ç¤ºä¾‹æ ¸å¿ƒé…ç½®ï¼ˆç«¯å£æ˜ å°„éƒ¨åˆ†ï¼‰</h2><pre><code>services:
proxy:
   image: goharbor/nginx-photon:v1.9.2
  container_name: nginx
   ports:
    - 85:82  # å®¿ä¸»æœºç«¯å£ 85 æ˜ å°„åˆ°å®¹å™¨å†… nginx ç›‘å¬çš„ 82 ç«¯å£
       volumes:
           - ./common/config/nginx:/etc/nginx:z
          depends_on:
                 - core
                      - portal
                       - registry
</code></pre>
<hr>
<h2 id="äº”ã€å¸¸ç”¨å‘½ä»¤æ±‡æ€»"><a href="#äº”ã€å¸¸ç”¨å‘½ä»¤æ±‡æ€»" class="headerlink" title="äº”ã€å¸¸ç”¨å‘½ä»¤æ±‡æ€»"></a>äº”ã€å¸¸ç”¨å‘½ä»¤æ±‡æ€»</h2><table>
<thead>
<tr>
<th>ä½œç”¨</th>
<th>å‘½ä»¤ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>æŸ¥çœ‹å®¹å™¨çŠ¶æ€</td>
<td><code>docker ps</code></td>
</tr>
<tr>
<td>æŸ¥çœ‹å®¹å™¨æ—¥å¿—</td>
<td><code>docker logs nginx --tail 50</code></td>
</tr>
<tr>
<td>æŸ¥çœ‹ç«¯å£ç›‘å¬</td>
<td>&#96;ss -tnlp</td>
</tr>
<tr>
<td>æµ‹è¯•ç«¯å£è¿é€šï¼ˆå®¿ä¸»æœºï¼‰</td>
<td><code>Test-NetConnection -ComputerName 192.168.200.131 -Port 85</code> (PowerShell)</td>
</tr>
<tr>
<td>è™šæ‹Ÿæœºé˜²ç«å¢™çŠ¶æ€</td>
<td><code>firewall-cmd --state</code></td>
</tr>
<tr>
<td>SELinux çŠ¶æ€</td>
<td><code>getenforce</code></td>
</tr>
<tr>
<td>è™šæ‹Ÿæœºå†…è®¿é—®æœ¬åœ°ç«¯å£</td>
<td><code>curl -I http://localhost:82</code></td>
</tr>
</tbody></table>
<hr>
<h1 id="è®¿é—®æ•…éšœæ’æŸ¥ç®€æ˜“æ­¥éª¤æ¸…å•"><a href="#è®¿é—®æ•…éšœæ’æŸ¥ç®€æ˜“æ­¥éª¤æ¸…å•" class="headerlink" title="è®¿é—®æ•…éšœæ’æŸ¥ç®€æ˜“æ­¥éª¤æ¸…å•"></a>è®¿é—®æ•…éšœæ’æŸ¥ç®€æ˜“æ­¥éª¤æ¸…å•</h1><ol>
<li><strong>ç¡®è®¤ Docker å®¹å™¨å’ŒæœåŠ¡çŠ¶æ€</strong><ul>
<li><code>docker-compose up -d</code></li>
<li><code>docker ps</code></li>
<li><code>docker logs nginx</code></li>
</ul>
</li>
<li><strong>ç¡®è®¤ç«¯å£ç›‘å¬å’Œæ˜ å°„</strong><ul>
<li>å®¹å™¨å†…éƒ¨ <code>ss -tnlp | grep nginx</code></li>
</ul>
</li>
</ol>
<ul>
<li>è™šæ‹Ÿæœº <code>ss -tnlp | grep :85</code></li>
<li><code>docker-compose.yml</code> ä¸­ç«¯å£æ˜ å°„æ˜¯å¦æ­£ç¡®</li>
</ul>
<ol start="3">
<li><strong>æ£€æŸ¥è™šæ‹Ÿæœºç½‘ç»œå’Œé˜²ç«å¢™</strong><ul>
<li><code>firewall-cmd --state</code></li>
</ul>
</li>
</ol>
<ul>
<li><code>getenforce</code></li>
<li>å…³é—­é˜²ç«å¢™æˆ–æ”¾è¡Œç«¯å£</li>
</ul>
<ol start="4">
<li><strong>å®¿ä¸»æœºç«¯å£è½¬å‘ï¼ˆNAT æ¨¡å¼ï¼‰é…ç½®æ­£ç¡®</strong><ul>
<li>ç¡®è®¤ VMware NAT ç«¯å£è½¬å‘è®¾ç½®æ— è¯¯</li>
</ul>
</li>
<li><strong>æµ‹è¯•ç«¯å£è¿é€šæ€§</strong><ul>
<li>å®¿ä¸»æœº PowerShell æµ‹è¯•ç«¯å£è¿é€š</li>
<li>è™šæ‹Ÿæœºå†… curl æµ‹è¯•ç«¯å£è®¿é—®</li>
</ul>
</li>
<li><strong>æµè§ˆå™¨è®¿é—®æµ‹è¯•</strong><ul>
<li>ç”¨æ­£ç¡®ç«¯å£è®¿é—® Harbor é¡µé¢</li>
<li>è§‚å¯Ÿæ˜¯å¦èƒ½æ­£å¸¸åŠ è½½</li>
</ul>
</li>
<li><strong>é‡å¯è™šæ‹Ÿæœºå’ŒæœåŠ¡</strong><ul>
<li>è§£å†³ç½‘ç»œç¼“å­˜ã€ç»‘å®šç­‰å¼‚å¸¸</li>
</ul>
</li>
</ol>
</blockquote>
<h5 id="åœ¨Harboråˆ›å»ºç”¨æˆ·å’Œé¡¹ç›®"><a href="#åœ¨Harboråˆ›å»ºç”¨æˆ·å’Œé¡¹ç›®" class="headerlink" title="åœ¨Harboråˆ›å»ºç”¨æˆ·å’Œé¡¹ç›®"></a>åœ¨Harboråˆ›å»ºç”¨æˆ·å’Œé¡¹ç›®</h5><ul>
<li>åˆ›å»ºé¡¹ç›®</li>
</ul>
<p>Harborçš„é¡¹ç›®åˆ†ä¸ºå…¬å¼€å’Œç§æœ‰çš„ï¼š<br>å…¬å¼€é¡¹ç›®ï¼šæ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®ï¼Œé€šå¸¸å­˜æ”¾å…¬å…±çš„é•œåƒï¼Œé»˜è®¤æœ‰ä¸€ä¸ªlibraryå…¬å¼€é¡¹ç›®ã€‚ ç§æœ‰é¡¹ç›®ï¼šåªæœ‰æˆæƒç”¨æˆ·æ‰å¯ä»¥è®¿é—®ï¼Œé€šå¸¸å­˜æ”¾é¡¹ç›®æœ¬èº«çš„é•œåƒã€‚<br>æˆ‘ä»¬å¯ä»¥ä¸ºå¾®æœåŠ¡é¡¹ç›®åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®</p>
<ul>
<li><p>åˆ›å»ºç”¨æˆ· åˆ›å»ºçš„ç”¨æˆ·ä¸ºï¼šeric   Eric123456</p>
</li>
<li><p>ç»™ç§æœ‰é¡¹ç›®åˆ†é…ç”¨æˆ·</p>
<p>è¿›å…¥tensquareé¡¹ç›®â†’æˆå‘˜â†’æ–°å»ºç”¨æˆ·â†’ericä¸ºç»´æŠ¤äººå‘˜</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>è§’è‰²</th>
<th>æƒé™è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>è®¿å®¢</td>
<td>å¯¹äºæŒ‡å®šé¡¹ç›®æ‹¥æœ‰åªè¯»æƒé™</td>
</tr>
<tr>
<td>å¼€å‘äººå‘˜</td>
<td>å¯¹äºæŒ‡å®šé¡¹ç›®æ‹¥æœ‰è¯»å†™æƒé™</td>
</tr>
<tr>
<td>ç»´æŠ¤äººå‘˜</td>
<td>å¯¹äºæŒ‡å®šé¡¹ç›®æ‹¥æœ‰è¯»å†™æƒé™ï¼Œåˆ›å»ºWebhooks</td>
</tr>
<tr>
<td>é¡¹ç›®ç®¡ç†å‘˜</td>
<td>é™¤äº†è¯»å†™æƒé™ï¼ŒåŒæ—¶æ‹¥æœ‰ç”¨æˆ·ç®¡ç†&#x2F;é•œåƒæ‰«æç­‰ç®¡ç†æƒé™</td>
</tr>
</tbody></table>
<ul>
<li>ä»¥æ–°ç”¨æˆ·ç™»å½•Harbor</li>
</ul>
<h5 id="æŠŠé•œåƒä¸Šä¼ åˆ°Harbor"><a href="#æŠŠé•œåƒä¸Šä¼ åˆ°Harbor" class="headerlink" title="æŠŠé•œåƒä¸Šä¼ åˆ°Harbor"></a>æŠŠé•œåƒä¸Šä¼ åˆ°Harbor</h5><ul>
<li><p>ç»™é•œåƒæ‰“ä¸Šæ ‡ç­¾</p>
<blockquote>
<p>docker tag eureka:v1 192.168.200.131:85&#x2F;tensquare&#x2F;eureka:v1</p>
</blockquote>
</li>
<li><p>æ¨é€é•œåƒ</p>
<blockquote>
<p>docker push 192.168.200.131:85&#x2F;tensquare&#x2F;eureka:v1</p>
<hr>
<p>The push refers to repository [192.168.66.102:85&#x2F;tensquare&#x2F;eureka] Get <a target="_blank" rel="noopener" href="https://192.168.200.131:85/v2/">https://192.168.200.131:85/v2/</a>: http: server gave HTTP response to HTTPS  client</p>
</blockquote>
<p>è¿™æ—¶ä¼šå‡ºç°ä»¥ä¸ŠæŠ¥é”™ï¼Œæ˜¯å› ä¸º Dockeræ²¡æœ‰æŠŠHarboråŠ å…¥ä¿¡ä»»åˆ—è¡¨ä¸­</p>
</li>
<li><p>æŠŠHarboråœ°å€åŠ å…¥åˆ°Dockerä¿¡ä»»åˆ—è¡¨<br><code>cd /etc/docker</code></p>
<p><code>vi daemon.json</code></p>
<blockquote>
<p>{<br>â€œregistry-mirrorsâ€: [â€œ<a href="https://zydiol88.mirror.aliyuncs.com&quot;]">https://zydiol88.mirror.aliyuncs.com&quot;]</a>,<br>â€œinsecure-registriesâ€: [â€œ192.168.200.131:85â€]<br>}</p>
</blockquote>
</li>
</ul>
<p>â€‹       éœ€è¦é‡å¯Docker<br>â€‹      <code>systemctl restart docker</code></p>
<ul>
<li><p>å†æ¬¡æ‰§è¡Œæ¨é€å‘½ä»¤ï¼Œä¼šæ˜¾ç¤ºæƒé™ä¸è¶³</p>
<p><code>docker push 192.168.200.131:85/tensquare/eureka:v1</code></p>
<blockquote>
<p>denied: requested access to the resource is denied</p>
</blockquote>
<p>éœ€è¦å…ˆç™»å½• Harborï¼Œå†æ¨é€é•œåƒ</p>
</li>
<li><p>ç™»å½•Harbor</p>
<p><code> docker login -u eric -p Eric123456 192.168.200.131:85</code> </p>
</li>
<li><p>å†æ¬¡push</p>
<p><code>docker push 192.168.200.131:85/tensquare/eureka:v1</code></p>
</li>
</ul>
<h5 id="ä»Harborä¸‹è½½é•œåƒ"><a href="#ä»Harborä¸‹è½½é•œåƒ" class="headerlink" title="ä»Harborä¸‹è½½é•œåƒ"></a>ä»Harborä¸‹è½½é•œåƒ</h5><p>éœ€æ±‚ï¼šåœ¨192.168.200.130æœåŠ¡å™¨å®Œæˆä»Harborä¸‹è½½é•œåƒ</p>
<ul>
<li><p>å®‰è£…å¹¶å¯åŠ¨Docker</p>
</li>
<li><p>ä¿®æ”¹Dockeré…ç½®</p>
<p><code>vi /etc/docker/daemon.json</code></p>
<pre><code class="yaml">&#123;
 &quot;registry-mirrors&quot;: [&quot;https://zydiol88.mirror.aliyuncs.com&quot;],
 &quot;insecure-registries&quot;: [&quot;192.168.66.102:85&quot;]
&#125;
</code></pre>
<p>é‡å¯dockerï¼š<code>systemctl restart docker</code></p>
</li>
<li><p>å…ˆç™»å½•ï¼Œå†ä»Harborä¸‹è½½é•œåƒ</p>
<p><code> docker login -u eric -p Eric123456 192.168.200.131:85</code><br><code>docker pull 192.168.200.131:85/tensquare/eureka:v1</code></p>
</li>
</ul>
<h4 id="å¾®æœåŠ¡æŒç»­é›†æˆ-1-é¡¹ç›®ä»£ç ä¸Šä¼ åˆ°Gitlab"><a href="#å¾®æœåŠ¡æŒç»­é›†æˆ-1-é¡¹ç›®ä»£ç ä¸Šä¼ åˆ°Gitlab" class="headerlink" title="å¾®æœåŠ¡æŒç»­é›†æˆ(1)-é¡¹ç›®ä»£ç ä¸Šä¼ åˆ°Gitlab"></a>å¾®æœåŠ¡æŒç»­é›†æˆ(1)-é¡¹ç›®ä»£ç ä¸Šä¼ åˆ°Gitlab</h4><p>åœ¨IDEAæ“ä½œå³å¯ï¼Œå‚è€ƒä¹‹å‰çš„æ­¥éª¤ã€‚åŒ…æ‹¬åå°å¾®æœåŠ¡(tensquare_back)å’Œå‰ç«¯webç½‘ç«™(tensquare_front)ä»£ç <br>[<u>lanyun_group Â· GitLab</u>] (<a target="_blank" rel="noopener" href="http://192.168.200.132:82/lanyun_group">http://192.168.200.132:82/lanyun_group</a>)</p>
<h4 id="å¾®æœåŠ¡æŒç»­é›†æˆ-2-ä»Gitlabæ‹‰å–é¡¹ç›®æºç åå°å¾®æœåŠ¡çš„æŒç»­é›†æˆ"><a href="#å¾®æœåŠ¡æŒç»­é›†æˆ-2-ä»Gitlabæ‹‰å–é¡¹ç›®æºç åå°å¾®æœåŠ¡çš„æŒç»­é›†æˆ" class="headerlink" title="å¾®æœåŠ¡æŒç»­é›†æˆ(2)-ä»Gitlabæ‹‰å–é¡¹ç›®æºç åå°å¾®æœåŠ¡çš„æŒç»­é›†æˆ"></a>å¾®æœåŠ¡æŒç»­é›†æˆ(2)-ä»Gitlabæ‹‰å–é¡¹ç›®æºç <del>åå°å¾®æœåŠ¡çš„æŒç»­é›†æˆ</del></h4><p>å…ˆå»Jenkinsé‡Œé¢åˆ›å»ºä¸€ä¸ª<code>tensquare_back</code>çš„æµæ°´çº¿ â†’ æµæ°´çº¿å®šä¹‰é€‰æ‹©<code>Pipeline script form SCM</code><del>è„šæœ¬æ–‡ä»¶æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹</del> â†’ SCMé€‰æ‹©<code>Git</code>æ‹‰å–è„šæœ¬æ–‡ä»¶ â†’ åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªJenkinsfile â†’ ç”¨æµæ°´çº¿è¯­æ³•å†™â€™æ‹‰å–ä»£ç â€™çš„è¯­æ³• â†’ â†“</p>
<pre><code class="yaml">stage(&#39;æ‹‰å–ä»£ç &#39;) &#123;
      checkout scmGit(branches: [[name: &#39;*/master&#39;]], extensions: [], userRemoteConfigs: [[credentialsId: &#39;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&#39;, url: &#39;http://192.168.200.132:82/lanyun_group/tensquare_back.git&#39;]])
   &#125;
</code></pre>
<p>â†’ ä¿®æ”¹è¯­æ³•ä»£ç é‡Œçš„ name: â€˜*&#x2F;masterâ€™ ä¸ºå¯å˜å‚æ•° â†’ å»æµæ°´çº¿çš„é…ç½®é‡Œ å‹¾é€‰<code>This project is parameterized</code> â†’ æ·»åŠ å‚æ•°é€‰æ‹©<code>String Parameter</code>  â†’ åç§°:branch   é»˜è®¤å€¼:master  æè¿°:è¯·è¾“å…¥ä¸€ä¸ªåˆ†æ”¯åç§° â†’  ä¿®æ”¹é‡Œé¢çš„å‚æ•°ä¸ºåŠ¨æ€çš„ â†’â†“</p>
<pre><code class="yaml">   stage(&#39;æ‹‰å–ä»£ç &#39;) &#123;
      checkout scmGit(branches: [[name: &quot;*/$&#123;branch&#125;&quot;]], extensions: [], userRemoteConfigs: [[credentialsId: &#39;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&#39;, url: &#39;http://192.168.200.132:82/lanyun_group/tensquare_back.git&#39;]])
   &#125;
</code></pre>
<p>â†’ å°†åé¢çš„<code>credentialsId</code>å’Œ<code>url</code>å¯ä»¥å®šä¹‰ä¸ºè„šæœ¬å‚æ•°å…¨å±€å¼•ç”¨ â†’ â†“</p>
<pre><code class="yaml">//gitå‡­è¯ID
def git_auth = &quot;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&quot;
//gitçš„urlåœ°å€
def git_url = &quot;http://192.168.200.132:82/lanyun_group/tensquare_back.git&quot;


node &#123;
   stage(&#39;æ‹‰å–ä»£ç &#39;) &#123;
      checkout scmGit(branches: [[name: &quot;*/$&#123;branch&#125;&quot;]], extensions: [], userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url: &quot;$&#123;git_url&#125;&quot;]])
   &#125;
&#125;
</code></pre>
<p>æ„å»ºå³å¯æˆåŠŸï¼ï¼ å¯ä»¥å»Mobaçš„<code>/var/lib/jenkins/workspace/</code>æŸ¥çœ‹æ˜¯å¦æœ‰<code>tensquare_back</code></p>
<h4 id="å¾®æœåŠ¡æŒç»­é›†æˆ-3-æäº¤åˆ°SonarQubeä»£ç å®¡æŸ¥"><a href="#å¾®æœåŠ¡æŒç»­é›†æˆ-3-æäº¤åˆ°SonarQubeä»£ç å®¡æŸ¥" class="headerlink" title="å¾®æœåŠ¡æŒç»­é›†æˆ(3)-æäº¤åˆ°SonarQubeä»£ç å®¡æŸ¥"></a>å¾®æœåŠ¡æŒç»­é›†æˆ(3)-æäº¤åˆ°SonarQubeä»£ç å®¡æŸ¥</h4><ul>
<li><h5 id="åˆ›å»ºé¡¹ç›®ï¼Œå¹¶è®¾ç½®å‚æ•°"><a href="#åˆ›å»ºé¡¹ç›®ï¼Œå¹¶è®¾ç½®å‚æ•°" class="headerlink" title="åˆ›å»ºé¡¹ç›®ï¼Œå¹¶è®¾ç½®å‚æ•°"></a>åˆ›å»ºé¡¹ç›®ï¼Œå¹¶è®¾ç½®å‚æ•°</h5></li>
</ul>
<p>åˆ›å»ºtensquare_backé¡¹ç›®ï¼Œæ·»åŠ ä¸¤ä¸ªå‚æ•° â†’ åœ¨æµæ°´çº¿ä¸Šè®¾ç½®é‡Œé€‰æ‹©<code>choice Parameter</code> â†’ åç§°:project_nameï¼›é€‰é¡¹:tensquare_eureka_serverã€tensquare_zuulã€tensquare_admin_serviceã€tensquare_gatheringï¼›æè¿°:è¯·é€‰æ‹©ä¸€ä¸ªæ„å»ºçš„é¡¹ç›®</p>
<ul>
<li><h5 id="æ¯ä¸ªé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ·»åŠ sonar-project-properties"><a href="#æ¯ä¸ªé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ·»åŠ sonar-project-properties" class="headerlink" title="æ¯ä¸ªé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ·»åŠ sonar-project.properties"></a>æ¯ä¸ªé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ·»åŠ <code>sonar-project.properties</code></h5></li>
</ul>
<pre><code class="yaml">eureka_server   gathering   admin_service   zuul
åªéœ€è¦æ”¹é‡Œé¢çš„projectNameå’ŒprojectKeyå³å¯

# must be unique in a given SonarQube instance
sonar.projectKey=tensquare_eureka_server
# this is the name and version displayed in the SonarQube UI. Was mandatory prior to SonarQube 6.1.
sonar.projectName=tensquare_eureka_server
sonar.projectVersion=1.0

# Path is relative to the sonar-project.properties file. Replace &quot;\&quot; by &quot;/&quot; on Windows.
# This property is optional if sonar.modules is set.
sonar.sources=.
sonar.exclusions=**/test/**,**/target/**
sonar.java.binaries=.

sonar.java.source=1.8
sonar.java.target=1.8
#sonar.java.libraries=**/target/classes/**

# Encoding of the source code. Default is default system encoding
sonar.sourceEncoding=UTF-8
</code></pre>
<ul>
<li><h5 id="ä¿®æ”¹jenkinsfileæ„å»ºè„šæœ¬"><a href="#ä¿®æ”¹jenkinsfileæ„å»ºè„šæœ¬" class="headerlink" title="ä¿®æ”¹jenkinsfileæ„å»ºè„šæœ¬"></a>ä¿®æ”¹jenkinsfileæ„å»ºè„šæœ¬</h5></li>
</ul>
<p>è¦åœ¨Jenkinsçš„å…¨å±€Toolsç®¡ç†é‡Œé¢ æœ‰SonarQube Scannerå®‰è£…<br>Jenkinså…¨å±€çš„systemé‡Œé¢æœ‰å®šä¹‰sonarqubeçš„url</p>
<pre><code class="yaml">//gitå‡­è¯ID
def git_auth = &quot;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&quot;
//gitçš„urlåœ°å€
def git_url = &quot;http://192.168.200.132:82/lanyun_group/tensquare_back.git&quot;


node &#123;
   stage(&#39;æ‹‰å–ä»£ç &#39;) &#123;
      checkout scmGit(branches: [[name: &quot;*/$&#123;branch&#125;&quot;]], extensions: [], userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url: &quot;$&#123;git_url&#125;&quot;]])
   &#125;
   stage(&#39;ä»£ç å®¡æŸ¥&#39;) &#123;
      //å®šä¹‰å½“å‰çš„Jenkinsçš„sonarqubeScannerå·¥å…· Jenkinsçš„å…¨å±€Toolsé‡Œ
      def scannerHome = tool &#39;sonar-scanner&#39;
      //å¼•ç”¨å½“å‰JenkinsSonarQubeç¯å¢ƒ Jenkinsçš„Systemé‡Œ
      withSonarQubeEnv(&#39;sonarqube&#39;)&#123;
      // éœ€è¦è¿›å…¥æŸä¸ªé¡¹ç›® åœ¨Jenkinsé€‰æ‹©ä»€ä¹ˆé¡¹ç›®å°±cdä»€ä¹ˆé¡¹ç›®
                sh &quot;&quot;&quot;
                    cd $&#123;project_name&#125;
                    $&#123;scannerHome&#125;/bin/sonar-scanner
                &quot;&quot;&quot;
      &#125;
    &#125;
&#125;
</code></pre>
<h3 id="å¾®æœåŠ¡æŒç»­é›†æˆ-4-ä½¿ç”¨Dockerfileç¼–è¯‘ã€ç”Ÿæˆé•œåƒ"><a href="#å¾®æœåŠ¡æŒç»­é›†æˆ-4-ä½¿ç”¨Dockerfileç¼–è¯‘ã€ç”Ÿæˆé•œåƒ" class="headerlink" title="å¾®æœåŠ¡æŒç»­é›†æˆ(4)-ä½¿ç”¨Dockerfileç¼–è¯‘ã€ç”Ÿæˆé•œåƒ"></a>å¾®æœåŠ¡æŒç»­é›†æˆ(4)-ä½¿ç”¨Dockerfileç¼–è¯‘ã€ç”Ÿæˆé•œåƒ</h3><h6 id="åˆ©ç”¨dockerfile-maven-pluginæ’ä»¶æ„å»ºDockeré•œåƒ"><a href="#åˆ©ç”¨dockerfile-maven-pluginæ’ä»¶æ„å»ºDockeré•œåƒ" class="headerlink" title="åˆ©ç”¨dockerfile-maven-pluginæ’ä»¶æ„å»ºDockeré•œåƒ"></a>åˆ©ç”¨dockerfile-maven-pluginæ’ä»¶æ„å»ºDockeré•œåƒ</h6><ul>
<li>åœ¨æ¯ä¸ªå¾®æœåŠ¡é¡¹ç›®çš„pom.xmlåŠ å…¥dockerfile-maven-pluginæ’ä»¶</li>
</ul>
<pre><code class="yaml">&lt;plugin&gt;
                &lt;groupId&gt;com.spotify&lt;/groupId&gt;
                &lt;artifactId&gt;dockerfile-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;1.3.6&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;repository&gt;$&#123;project.artifactId&#125;&lt;/repository&gt;
                    &lt;buildArgs&gt;
                        &lt;JAR_FILE&gt;target/$&#123;project.build.finalName&#125;.jar&lt;/JAR_FILE&gt;
                    &lt;/buildArgs&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
</code></pre>
<ul>
<li>ä¿®æ”¹Jenkinsfileè®©ä»–æ ¹æ®å‚æ•°æ‰“åŒ…å¾®æœåŠ¡å·¥ç¨‹</li>
</ul>
<pre><code class="yaml">//gitå‡­è¯ID
def git_auth = &quot;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&quot;
//gitçš„urlåœ°å€
def git_url = &quot;http://192.168.200.132:82/lanyun_group/tensquare_back.git&quot;


node &#123;
   stage(&#39;æ‹‰å–ä»£ç &#39;) &#123;
      checkout scmGit(branches: [[name: &quot;*/$&#123;branch&#125;&quot;]], extensions: [], userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url: &quot;$&#123;git_url&#125;&quot;]])
   &#125;
   stage(&#39;ä»£ç å®¡æŸ¥&#39;) &#123;
      //å®šä¹‰å½“å‰çš„Jenkinsçš„sonarqubeScannerå·¥å…· Jenkinsçš„å…¨å±€Toolsé‡Œ
      def scannerHome = tool &#39;sonar-scanner&#39;
      //å¼•ç”¨å½“å‰JenkinsSonarQubeç¯å¢ƒ Jenkinsçš„Systemé‡Œ
      withSonarQubeEnv(&#39;sonarqube&#39;)&#123;
      // éœ€è¦è¿›å…¥æŸä¸ªé¡¹ç›® åœ¨Jenkinsé€‰æ‹©ä»€ä¹ˆé¡¹ç›®å°±cdä»€ä¹ˆé¡¹ç›®
                sh &quot;&quot;&quot;
                    cd $&#123;project_name&#125;
                    $&#123;scannerHome&#125;/bin/sonar-scanner
                &quot;&quot;&quot;
      &#125;
    &#125;
    stage(&#39;ç¼–è¯‘ï¼Œå®‰è£…å…¬å…±å­å·¥ç¨‹&#39;)&#123;
        sh &quot;mvn -f tensquare_common clean install&quot;
    &#125;
    stage(&#39;ç¼–è¯‘ï¼Œæ‰“åŒ…å¾®æœåŠ¡å·¥ç¨‹&#39;)&#123;
        sh &quot;mvn -f $&#123;project_name&#125; clean package&quot;
    &#125;
&#125;
</code></pre>
<ul>
<li>çˆ¶å·¥ç¨‹çš„pom.xmlè¦æ”¹ä¸€ä¸ªè¿‡æ—¶çš„ä»£ç </li>
</ul>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.tensquare&lt;/groupId&gt;
    &lt;artifactId&gt;tensquare_parent&lt;/artifactId&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;modules&gt;
        &lt;module&gt;tensquare_common&lt;/module&gt;
        &lt;module&gt;tensquare_eureka_server&lt;/module&gt;
        &lt;module&gt;tensquare_zuul&lt;/module&gt;
        &lt;module&gt;tensquare_admin_service&lt;/module&gt;
        &lt;module&gt;tensquare_gathering&lt;/module&gt;
    &lt;/modules&gt;

    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.0.1.RELEASE&lt;/version&gt;
        &lt;relativePath /&gt;
    &lt;/parent&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
        &lt;!-- âœ… æ¨èä½¿ç”¨æ­£å¼ç‰ˆæœ¬ Finchley.SR4 --&gt;
        &lt;spring-cloud.version&gt;Finchley.SR4&lt;/spring-cloud.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;

    &lt;!-- å¯é€‰ï¼šä¿ç•™ spring-milestones --&gt;
    &lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;spring-milestones&lt;/id&gt;
            &lt;name&gt;Spring Milestones&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;

&lt;/project&gt;
</code></pre>
<ul>
<li>é€šè¿‡MoBaæŠŠ<code>E:\Javaå®ä¾‹é¡¹ç›®1-20å¥—\èµ„æ–™-Jenkinsæ•™ç¨‹\Jenkinsèµ„æ–™\èµ„æ–™\èµ„æ–™\03.èµ„æ–™\tensquare_parent</code>çš„<code>tensquare_parent</code>é¡¹ç›®ä¿å­˜åˆ°<code>/root/repo/com/tensquare/</code>é‡Œ</li>
<li>éšåé€šè¿‡æ­¥éª¤äºŒï¼Œæ„å»ºæ‰€æœ‰çš„å·¥ç¨‹ â†’ <strong>æ‰“åŒ…æ‰€æœ‰å¾®æœåŠ¡çš„å·¥ç¨‹</strong> â†’ åœ¨Jenkinsè™šæ‹Ÿæœºçš„<code>/var/lib/jenkins/workspace/tensquare_back/</code>è¿™é‡Œé¢çš„å„ä¸ªé¡¹ç›®çš„<code>target</code>é‡Œé¢æ‰“åŒ…äº†åˆšåˆšå¾®æœåŠ¡çš„æ‰€æœ‰æ„å»ºä¸œè¥¿</li>
</ul>
<h4 id="å¾®æœåŠ¡æŒç»­é›†æˆ-4-ä½¿ç”¨Dockerfileç¼–è¯‘ã€ç”Ÿæˆé•œåƒ-1"><a href="#å¾®æœåŠ¡æŒç»­é›†æˆ-4-ä½¿ç”¨Dockerfileç¼–è¯‘ã€ç”Ÿæˆé•œåƒ-1" class="headerlink" title="å¾®æœåŠ¡æŒç»­é›†æˆ(4)-ä½¿ç”¨Dockerfileç¼–è¯‘ã€ç”Ÿæˆé•œåƒ"></a>å¾®æœåŠ¡æŒç»­é›†æˆ(4)-ä½¿ç”¨Dockerfileç¼–è¯‘ã€ç”Ÿæˆé•œåƒ</h4><p>åˆ©ç”¨dockerfile-maven-pluginæ’ä»¶æ„å»ºDockeré•œåƒ</p>
<ul>
<li>åœ¨æ¯ä¸ªå¾®æœåŠ¡é¡¹ç›®çš„pom.xmlåŠ å…¥dockerfile-maven-pluginæ’ä»¶</li>
</ul>
<pre><code class="xml"> &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;com.spotify&lt;/groupId&gt;
                &lt;artifactId&gt;dockerfile-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;1.3.6&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;repository&gt;$&#123;project.artifactId&#125;&lt;/repository&gt;
                    &lt;buildArgs&gt;
                        &lt;JAR_FILE&gt;target/$&#123;project.build.finalName&#125;.jar&lt;/JAR_FILE&gt;
                    &lt;/buildArgs&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
</code></pre>
<ul>
<li>åœ¨dockerfileçˆ¶ç›®å½•æ–‡ä»¶ä¸­å¢åŠ ä¸€ä¸ª<code>...dockerfile:build</code>å»è§¦å‘æ¯ä¸ªå¾®æœåŠ¡é¡¹ç›®çš„dockerfileæ‰§è¡Œã€ç”¨æµæ°´çº¿è¿›è¡Œé•œåƒæ„å»ºã€‘</li>
</ul>
<pre><code class="xml">    stage(&#39;ç¼–è¯‘ï¼Œå®‰è£…å…¬å…±å­å·¥ç¨‹&#39;)&#123;
        sh &quot;mvn -f tensquare_common clean install&quot;
    &#125;
    stage(&#39;ç¼–è¯‘ï¼Œæ‰“åŒ…å¾®æœåŠ¡å·¥ç¨‹&#39;)&#123;
        sh &quot;mvn -f $&#123;project_name&#125; clean package dockerfile:build&quot;
    &#125;
</code></pre>
<p>å…¨éƒ¨æ„å»ºå®Œæˆåå°±å¤§åŠŸå‘Šæˆï¼ï¼ï¼</p>
<pre><code class="yaml">[root@localhost docker]# docker images
REPOSITORY                            TAG                 IMAGE ID            CREATED             SIZE
tensquare_gathering                   latest              a62362e8dc2f        8 minutes ago       155MB
tensquare_admin_service               latest              ee2a85292e98        9 minutes ago       156MB
tensquare_eureka_server               latest              2a78c4a12fc4        11 minutes ago      148MB
tensquare_zuul                        latest              33bf136ee3cb        12 minutes ago      146MB
eureka                                v2                  2c9a3610123d        24 hours ago        150MB
192.168.200.131:85/tensquare/eureka   v1                  e85b5d3d9090        25 hours ago        150MB
eureka                                v1                  e85b5d3d9090        25 hours ago        150MB
nginx                                 latest              9592f5595f2b        8 days ago          192MB
hello-world                           latest              74cc54e27dc4        5 months ago        10.1kB
openjdk                               8-jdk-alpine        a3562aa0b991        6 years ago         105MB
</code></pre>
<hr>
<h4 id="å¾®æœåŠ¡æŒç»­é›†æˆ-5-ä¸Šä¼ åˆ°Harboré•œåƒä»“åº“"><a href="#å¾®æœåŠ¡æŒç»­é›†æˆ-5-ä¸Šä¼ åˆ°Harboré•œåƒä»“åº“" class="headerlink" title="å¾®æœåŠ¡æŒç»­é›†æˆ(5)-ä¸Šä¼ åˆ°Harboré•œåƒä»“åº“"></a>å¾®æœåŠ¡æŒç»­é›†æˆ(5)-ä¸Šä¼ åˆ°Harboré•œåƒä»“åº“</h4><ul>
<li>ä¿®æ”¹<code>Jenkinsfile.groovy</code>æ„å»ºè„šæœ¬</li>
</ul>
<pre><code class="yaml">//gitå‡­è¯ID
def git_auth = &quot;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&quot;
//gitçš„urlåœ°å€
def git_url = &quot;http://192.168.200.132:82/lanyun_group/tensquare_back.git&quot;
//é•œåƒçš„ç‰ˆæœ¬å·
def tag = &quot;latest&quot;
//Harborçš„urlåœ°å€
def harbor_url = &quot;192.168.200.131:85&quot;
//é•œåƒåº“é¡¹ç›®åç§°
def harbor_project = &quot;tensquare&quot;


node &#123;
   stage(&#39;æ‹‰å–ä»£ç &#39;) &#123;
      checkout scmGit(branches: [[name: &quot;*/$&#123;branch&#125;&quot;]], extensions: [], userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url: &quot;$&#123;git_url&#125;&quot;]])
   &#125;
   stage(&#39;ä»£ç å®¡æŸ¥&#39;) &#123;
      //å®šä¹‰å½“å‰çš„Jenkinsçš„sonarqubeScannerå·¥å…· Jenkinsçš„å…¨å±€Toolsé‡Œ
      def scannerHome = tool &#39;sonar-scanner&#39;
      //å¼•ç”¨å½“å‰JenkinsSonarQubeç¯å¢ƒ Jenkinsçš„Systemé‡Œ
      withSonarQubeEnv(&#39;sonarqube&#39;)&#123;
      // éœ€è¦è¿›å…¥æŸä¸ªé¡¹ç›® åœ¨Jenkinsé€‰æ‹©ä»€ä¹ˆé¡¹ç›®å°±cdä»€ä¹ˆé¡¹ç›®
                sh &quot;&quot;&quot;
                    cd $&#123;project_name&#125;
                    $&#123;scannerHome&#125;/bin/sonar-scanner
                &quot;&quot;&quot;
      &#125;
    &#125;
    stage(&#39;ç¼–è¯‘ï¼Œå®‰è£…å…¬å…±å­å·¥ç¨‹&#39;)&#123;
        sh &quot;mvn -f tensquare_common clean install&quot;
    &#125;
    stage(&#39;ç¼–è¯‘ï¼Œæ‰“åŒ…å¾®æœåŠ¡å·¥ç¨‹&#39;)&#123;
        sh &quot;mvn -f $&#123;project_name&#125; clean package dockerfile:build&quot;
        // å®šä¹‰é•œåƒåç§°
        def imageName = &quot;$&#123;project_name&#125;:$&#123;tag&#125;&quot;

        // å¯¹é•œåƒæ‰“ä¸Šæ ‡ç­¾
        sh &quot;docker tag $&#123;imageName&#125; $&#123;harbor_url&#125;/$&#123;harbor_project&#125;/$&#123;imageName&#125;&quot;
    &#125;
&#125;
</code></pre>
<p>æ­¤æ—¶å†å»æ„å»ºä¸€ä¸ªé¡¹ç›®åœ¨Jenkinsè™šæ‹ŸæœºæœåŠ¡çš„é•œåƒé‡Œå°±ä¼šå‡ºç°æŒ‰ç…§è§„åˆ™æ‰“å¥½tagçš„é•œåƒ</p>
<blockquote>
<p>[root@localhost ~]# docker images<br>REPOSITORY                                             TAG                 IMAGE ID            CREATED              SIZE<br>192.168.200.131:85&#x2F;tensquare&#x2F;tensquare_eureka_server   latest              e19b4ba07d54        About a minute ago   148MB</p>
</blockquote>
<ul>
<li><h5 id="æŠŠé•œåƒæ¨é€åˆ°Harbor-è¦ç™»å½•-è¾“å…¥è´¦å·å¯†ç -ä¸è¦å†™åœ¨è„šæœ¬æ–‡ä»¶-æŠŠharborè´¦å·å¯†ç ç”¨jenkinså…¨å±€å‡­è¯"><a href="#æŠŠé•œåƒæ¨é€åˆ°Harbor-è¦ç™»å½•-è¾“å…¥è´¦å·å¯†ç -ä¸è¦å†™åœ¨è„šæœ¬æ–‡ä»¶-æŠŠharborè´¦å·å¯†ç ç”¨jenkinså…¨å±€å‡­è¯" class="headerlink" title="æŠŠé•œåƒæ¨é€åˆ°Harbor(è¦ç™»å½• è¾“å…¥è´¦å·å¯†ç  ä¸è¦å†™åœ¨è„šæœ¬æ–‡ä»¶ æŠŠharborè´¦å·å¯†ç ç”¨jenkinså…¨å±€å‡­è¯)"></a>æŠŠé•œåƒæ¨é€åˆ°Harbor(è¦ç™»å½• è¾“å…¥è´¦å·å¯†ç  ä¸è¦å†™åœ¨è„šæœ¬æ–‡ä»¶ æŠŠharborè´¦å·å¯†ç ç”¨jenkinså…¨å±€å‡­è¯)</h5></li>
</ul>
<p>å»Jenkinsç”³è¯·ä¸€ä¸ªå…¨å±€çš„å‡­è¯ï¼ŒIDï¼š<code>f83725d3-d5fc-4faf-8ac1-1a56487dfc7b</code><br>æ€ä¹ˆåœ¨jenkinsfileé‡Œé¢ä½¿ç”¨å‘¢ï¼Ÿè¦ç”¨æµæ°´çº¿è¯­æ³•çš„ç‰‡æ®µç”Ÿæˆå™¨ <code>withCredentialsï¼šBind credentials to variables</code>[<u>å€ŸåŠ©å‡­è¯è¿›è¡Œè„šæœ¬å¤„ç†</u>] (å¦‚æœæ²¡æœ‰æ˜¾ç¤ºç»‘å®š å°±åˆ·æ–°ä¸€ä¸‹ç•Œé¢)ï¼›é€‰æ‹©<code>ç»‘å®š</code>â†’<u><code>ç”¨æˆ·åå˜é‡ï¼šusername</code> <code>å¯†ç å˜é‡ï¼špassword</code></u> è¿™ä¸ªæ˜¯å¼•ç”¨çš„åˆšåˆšåˆ›ç«‹çš„<code>eric_harbor-auth</code>å‡­è¯</p>
<pre><code class="yaml">//gitå‡­è¯ID
def git_auth = &quot;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&quot;
//gitçš„urlåœ°å€
def git_url = &quot;http://192.168.200.132:82/lanyun_group/tensquare_back.git&quot;
//é•œåƒçš„ç‰ˆæœ¬å·
def tag = &quot;latest&quot;
//Harborçš„urlåœ°å€
def harbor_url = &quot;192.168.200.131:85&quot;
//é•œåƒåº“é¡¹ç›®åç§°
def harbor_project = &quot;tensquare&quot;
//harborçš„ç™»å½•å‡­è¯ID
def harbor_auth = &quot;f83725d3-d5fc-4faf-8ac1-1a56487dfc7b&quot;


node &#123;
   stage(&#39;æ‹‰å–ä»£ç &#39;) &#123;
      checkout scmGit(branches: [[name: &quot;*/$&#123;branch&#125;&quot;]], extensions: [], userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url: &quot;$&#123;git_url&#125;&quot;]])
   &#125;
   stage(&#39;ä»£ç å®¡æŸ¥&#39;) &#123;
      //å®šä¹‰å½“å‰çš„Jenkinsçš„sonarqubeScannerå·¥å…· Jenkinsçš„å…¨å±€Toolsé‡Œ
      def scannerHome = tool &#39;sonar-scanner&#39;
      //å¼•ç”¨å½“å‰JenkinsSonarQubeç¯å¢ƒ Jenkinsçš„Systemé‡Œ
      withSonarQubeEnv(&#39;sonarqube&#39;)&#123;
      // éœ€è¦è¿›å…¥æŸä¸ªé¡¹ç›® åœ¨Jenkinsé€‰æ‹©ä»€ä¹ˆé¡¹ç›®å°±cdä»€ä¹ˆé¡¹ç›®
                sh &quot;&quot;&quot;
                    cd $&#123;project_name&#125;
                    $&#123;scannerHome&#125;/bin/sonar-scanner
                &quot;&quot;&quot;
      &#125;
    &#125;
    stage(&#39;ç¼–è¯‘ï¼Œå®‰è£…å…¬å…±å­å·¥ç¨‹&#39;)&#123;
        sh &quot;mvn -f tensquare_common clean install&quot;
    &#125;
    stage(&#39;ç¼–è¯‘ï¼Œæ‰“åŒ…å¾®æœåŠ¡å·¥ç¨‹&#39;)&#123;
        sh &quot;mvn -f $&#123;project_name&#125; clean package dockerfile:build&quot;
        // å®šä¹‰é•œåƒåç§°
        def imageName = &quot;$&#123;project_name&#125;:$&#123;tag&#125;&quot;

        // å¯¹é•œåƒæ‰“ä¸Šæ ‡ç­¾
        sh &quot;docker tag $&#123;imageName&#125; $&#123;harbor_url&#125;/$&#123;harbor_project&#125;/$&#123;imageName&#125;&quot;

        // æŠŠé•œåƒæ¨é€åˆ°Harbor(è¦ç™»å½• è¾“å…¥è´¦å·å¯†ç  ä¸è¦å†™åœ¨è„šæœ¬æ–‡ä»¶ æŠŠharborè´¦å·å¯†ç ç”¨jenkinså…¨å±€å‡­è¯)
        withCredentials([usernamePassword(credentialsId: &quot;$&#123;harbor_auth&#125;&quot;, passwordVariable: &#39;password&#39;, usernameVariable: &#39;username&#39;)]) &#123;
            // ç™»å½•åˆ°Harbor
            sh &quot;docker login -u $&#123;username&#125; -p  $&#123;password&#125; $&#123;harbor_url&#125;&quot;

            //é•œåƒä¸Šä¼ 
            sh &quot;docker push $&#123;harbor_url&#125;/$&#123;harbor_project&#125;/$&#123;imageName&#125;&quot;

            sh &quot;echo &#39;ğŸ”¥ğŸ”¥é•œåƒä¸Šä¼ æˆåŠŸâœ…âœ…&#39;&quot;
        &#125;
    &#125;
&#125;
</code></pre>
<p>æ­¤æ—¶harborçš„tensquareä¸­é•œåƒä»“åº“å°±æœ‰äº†<code>tensquare/tensquare_eureka_server</code></p>
<h4 id="å¾®æœåŠ¡æŒç»­é›†æˆ-6-æ‹‰å–é•œåƒå’Œå‘å¸ƒåº”ç”¨"><a href="#å¾®æœåŠ¡æŒç»­é›†æˆ-6-æ‹‰å–é•œåƒå’Œå‘å¸ƒåº”ç”¨" class="headerlink" title="å¾®æœåŠ¡æŒç»­é›†æˆ(6)-æ‹‰å–é•œåƒå’Œå‘å¸ƒåº”ç”¨"></a>å¾®æœåŠ¡æŒç»­é›†æˆ(6)-æ‹‰å–é•œåƒå’Œå‘å¸ƒåº”ç”¨</h4><h6 id="å®‰è£…-Publish-Over-SSH-æ’ä»¶ç›®çš„æ˜¯æƒ³æŠŠ129Jenkinså’Œ130productè¿›è¡Œè¿é€š"><a href="#å®‰è£…-Publish-Over-SSH-æ’ä»¶ç›®çš„æ˜¯æƒ³æŠŠ129Jenkinså’Œ130productè¿›è¡Œè¿é€š" class="headerlink" title="å®‰è£…  Publish Over SSH æ’ä»¶ç›®çš„æ˜¯æƒ³æŠŠ129Jenkinså’Œ130productè¿›è¡Œè¿é€š"></a>å®‰è£…  <code>Publish Over SSH æ’ä»¶</code><del>ç›®çš„æ˜¯æƒ³æŠŠ129Jenkinså’Œ130productè¿›è¡Œè¿é€š</del></h6><p>å®‰è£…æ­¤æ’ä»¶å¯ä»¥å®ç°è¿œç¨‹å‘é€Shellå‘½ä»¤</p>
<p>éšåå»å…¨å±€systemå¯»æ‰¾<code>Publish over SSH</code></p>
<p>åœ¨productè™šæ‹Ÿæœºï¼š<code>id_rsaæ˜¯ç§é’¥</code>ï¼Œ<code>id_rsa.pubæ˜¯å…¬é’¥</code></p>
<pre><code class="yaml">[root@localhost ~]# cd /root/.ssh
[root@localhost .ssh]# ll
æ€»ç”¨é‡ 12
-rw-------. 1 root root 1679 6æœˆ  18 20:05 id_rsa
-rw-r--r--. 1 root root  408 6æœˆ  18 20:05 id_rsa.pub
-rw-r--r--. 1 root root  177 6æœˆ  18 21:00 known_hosts
[root@localhost .ssh]#
</code></pre>
<p>è¾“å…¥<code>[root@localhost .ssh]# ssh-keygen -y -f /root/.ssh/id_rsa</code>ä¼šæ˜¾ç¤ºç§é’¥<br>å¦‚æœç›´æ¥è¾“å‡º <code>ssh-rsa AAAA...</code> è¿™æ ·çš„å…¬é’¥å†…å®¹ â†’ è¯´æ˜<strong>æ²¡æœ‰åŠ å¯†</strong>ï¼ŒJenkins ä¸­å¯ä»¥æŠŠ <code>Passphrase</code> ç•™ç©º<br>ä¸‹é¢æ·»åŠ ä¸€å°è¿œç¨‹æœåŠ¡å™¨<code>SSH Servers</code></p>
<blockquote>
<p>Nameï¼šmaster_server<br>Hostnameï¼š192.168.200.130<br>Usernameï¼šroot<br>Remote Directoryï¼š&#x2F;</p>
</blockquote>
<h6 id="é…ç½®è¿œç¨‹éƒ¨ç½²æœåŠ¡å™¨"><a href="#é…ç½®è¿œç¨‹éƒ¨ç½²æœåŠ¡å™¨" class="headerlink" title="é…ç½®è¿œç¨‹éƒ¨ç½²æœåŠ¡å™¨"></a>é…ç½®è¿œç¨‹éƒ¨ç½²æœåŠ¡å™¨</h6><ul>
<li>æ‹·è´å…¬é’¥åˆ°è¿œç¨‹æœåŠ¡å™¨</li>
</ul>
<blockquote>
<p>æ˜¯çš„ï¼Œä½ é‡åˆ°çš„é”™è¯¯ï¼š</p>
<pre><code>Failed to connect session for config [master_server]. Message [Auth fail for methods &#39;publickey,gssapi-keyex,gssapi-with-mic,password&#39;]
</code></pre>
<p><strong>è¯´æ˜ Jenkins ä½¿ç”¨ä½ æä¾›çš„ç§é’¥è¿æ¥è¿œç¨‹æœåŠ¡å™¨å¤±è´¥</strong>ã€‚è¿™ä¸ªé—®é¢˜ä¸€èˆ¬ç”±ä»¥ä¸‹å‡ ç§åŸå› å¯¼è‡´ï¼š</p>
<hr>
<h2 id="âœ…ã€æ¨èæ–¹æ¡ˆã€‘é‡æ–°ç”Ÿæˆå…¼å®¹æ ¼å¼çš„ç§é’¥ï¼ˆPEMï¼‰"><a href="#âœ…ã€æ¨èæ–¹æ¡ˆã€‘é‡æ–°ç”Ÿæˆå…¼å®¹æ ¼å¼çš„ç§é’¥ï¼ˆPEMï¼‰" class="headerlink" title="âœ…ã€æ¨èæ–¹æ¡ˆã€‘é‡æ–°ç”Ÿæˆå…¼å®¹æ ¼å¼çš„ç§é’¥ï¼ˆPEMï¼‰"></a>âœ…ã€æ¨èæ–¹æ¡ˆã€‘é‡æ–°ç”Ÿæˆå…¼å®¹æ ¼å¼çš„ç§é’¥ï¼ˆPEMï¼‰</h2><p>ä½ çœ‹åˆ°çš„å»ºè®®ï¼š</p>
<blockquote>
<pre><code>ssh-keygen -m PEM -t rsa -b 4096
</code></pre>
</blockquote>
<p>æ˜¯å®Œå…¨æ­£ç¡®çš„ï¼Œå› ä¸ºï¼š</p>
<ul>
<li>Jenkins ä½¿ç”¨çš„ <strong>Java SSH å®ç°</strong>ï¼ˆJSch æˆ– Trileadï¼‰<strong>ä¸æ”¯æŒ OpenSSH çš„æ–°ç§é’¥æ ¼å¼ï¼ˆRFC4716ï¼‰</strong>ï¼›</li>
<li><code>-m PEM</code> è¡¨ç¤ºä½¿ç”¨æ—§ç‰ˆå…¼å®¹æ ¼å¼ï¼ˆJenkins èƒ½è¯†åˆ«ï¼‰ï¼›</li>
<li><code>-t rsa -b 4096</code> è¡¨ç¤ºç”Ÿæˆ RSA 4096 ä½å¯†é’¥ã€‚</li>
</ul>
<hr>
<h3 id="âœ…-é‡æ–°ç”Ÿæˆ-SSH-å¯†é’¥æ­¥éª¤å¦‚ä¸‹"><a href="#âœ…-é‡æ–°ç”Ÿæˆ-SSH-å¯†é’¥æ­¥éª¤å¦‚ä¸‹" class="headerlink" title="âœ… é‡æ–°ç”Ÿæˆ SSH å¯†é’¥æ­¥éª¤å¦‚ä¸‹"></a>âœ… é‡æ–°ç”Ÿæˆ SSH å¯†é’¥æ­¥éª¤å¦‚ä¸‹</h3><ol>
<li>åœ¨ Jenkins æ‰€åœ¨æœºå™¨ä¸Šæ‰§è¡Œï¼ˆæ¨èä½¿ç”¨ <code>jenkins</code> ç”¨æˆ·èº«ä»½ï¼Œä¸è¦ç”¨ rootï¼‰ï¼š</li>
</ol>
<pre><code>ssh-keygen -m PEM -t rsa -b 4096 -C &quot;jenkins@tensquare&quot; -f ~/.ssh/id_rsa_jenkins
</code></pre>
<p>è¿‡ç¨‹ä¸­ä¼šé—®ä½ æ˜¯å¦è®¾ç½®å¯†ç ï¼ˆpassphraseï¼‰ï¼Œä½ å¯ä»¥ <strong>ç›´æ¥å›è½¦ç•™ç©º</strong>ã€‚</p>
<p>ç”Ÿæˆåä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>
<pre><code>~/.ssh/id_rsa_jenkins       â† ç§é’¥ï¼ˆå¤åˆ¶ç»™ Jenkinsï¼‰
~/.ssh/id_rsa_jenkins.pub   â† å…¬é’¥ï¼ˆé…ç½®åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼‰
</code></pre>
<hr>
<ol>
<li><strong>æŠŠå…¬é’¥å†…å®¹æ·»åŠ åˆ°è¿œç¨‹ä¸»æœºçš„ authorized_keys ä¸­</strong></li>
</ol>
<pre><code>cat ~/.ssh/id_rsa_jenkins.pub | ssh root@192.168.200.130 &quot;mkdir -p ~/.ssh &amp;&amp; cat &gt;&gt; ~/.ssh/authorized_keys &amp;&amp; chmod 600 ~/.ssh/authorized_keys&quot;
</code></pre>
<p>æˆ–è€…ä½ æ‰‹åŠ¨å°† <code>id_rsa_jenkins.pub</code> å†…å®¹æ·»åŠ åˆ° <code>/root/.ssh/authorized_keys</code> ä¸­ã€‚</p>
<hr>
<ol>
<li><strong>Jenkins ä¸­é…ç½® SSH è¿æ¥</strong></li>
</ol>
<p>åœ¨ Jenkins â†’ <code>Manage Jenkins</code> â†’ <code>Configure System</code> â†’ <code>Publish over SSH</code>ï¼š</p>
<ul>
<li><strong>Path to Key</strong>ï¼šå¡«å…¥ <code>/root/.ssh/id_rsa_jenkins</code>ï¼ˆæˆ–ä½ æ”¾çš„å®é™…è·¯å¾„ï¼‰</li>
<li><strong>Key</strong>ï¼šå¯ç•™ç©ºï¼ˆæœ‰ Path å³å¯ï¼‰</li>
<li><strong>Passphrase</strong>ï¼šå¦‚æœä½ ä¸Šé¢ç”Ÿæˆæ—¶ç•™ç©ºï¼Œè¿™é‡Œä¹Ÿç•™ç©º</li>
<li><strong>Name</strong>ï¼šmaster_server</li>
<li><strong>Hostname</strong>ï¼š192.168.200.130</li>
<li><strong>Username</strong>ï¼šrootï¼ˆæˆ–å…¶ä»–ä½ æˆæƒäº†å…¬é’¥çš„ç”¨æˆ·ï¼‰</li>
<li><strong>Remote Directory</strong>ï¼šæ¯”å¦‚ <code>/home/jenkins-deploy</code> æˆ– <code>/root/</code>æˆ–<code>/</code></li>
</ul>
<p>âœ” ç‚¹å‡» <code>Test Configuration</code> æµ‹è¯•æˆåŠŸä¸ºæ­¢</p>
</blockquote>
<ul>
<li><p>æŸ¥çœ‹æµæ°´çº¿è¯­æ³•</p>
<p>å› ä¸ºæ–°ä¸‹è½½é‚£ä¸ªæ’ä»¶åéœ€è¦é‡å¯Jenkinsã€‚ç„¶å<br>æ­¥éª¤<code>sshPublisher:Send build artifacts overSSH</code> ç›´æ¥ç”Ÿæˆæµæ°´çº¿è„šæœ¬åèå…¥Jenkinsfileæ–‡ä»¶ä¸­</p>
<blockquote>
<p>SSH Server<br>Nameï¼šmaster_server</p>
</blockquote>
</li>
</ul>
<p>é‡Œé¢çš„<code>$port</code>éœ€è¦ææˆå¯å˜å‚æ•° å»Jenkinsé‡Œé¢æ·»åŠ ä¸€ä¸ªå‚æ•°</p>
<blockquote>
<p>åç§°ï¼šport<br>é»˜è®¤å€¼ï¼š10086<br>æè¿°ï¼šè¯·è¾“å…¥ä¸€ä¸ªå¯¹åº”æœåŠ¡çš„ç«¯å£</p>
</blockquote>
<p>åœ¨ç”Ÿäº§è™šæ‹Ÿæœºå…ˆ<code>[root@localhost ~]# mkdir /opt/jenkins_shell</code>ç„¶åæŠŠ<code>E:\Javaå®ä¾‹é¡¹ç›®1-20å¥—\èµ„æ–™-Jenkinsæ•™ç¨‹\Jenkinsèµ„æ–™\èµ„æ–™\èµ„æ–™\03.èµ„æ–™\éƒ¨ç½²è„šæœ¬</code>çš„<code>deploy.sh</code>ä¼ å…¥ ä¹‹åæ·»åŠ æ‰§è¡Œæƒé™<code>[root@localhost jenkins_shell]# chmod +x deploy.sh</code></p>
<h5 id="æˆåŠŸï¼ï¼ï¼"><a href="#æˆåŠŸï¼ï¼ï¼" class="headerlink" title="æˆåŠŸï¼ï¼ï¼"></a>æˆåŠŸï¼ï¼ï¼</h5><blockquote>
<p>[root@localhost jenkins_shell]# docker images<br>REPOSITORY                            TAG                 IMAGE ID            CREATED             SIZE<br>192.168.200.131:85&#x2F;tensquare&#x2F;eureka   v1                  e85b5d3d9090        44 hours ago        150MB<br>[root@localhost jenkins_shell]# docker ps<br>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</p>
<hr>
<p>[root@localhost jenkins_shell]# docker images</p>
<p>REPOSITORY                                             TAG                 IMAGE ID            CREATED             SIZE<br>192.168.200.131:85&#x2F;tensquare&#x2F;tensquare_eureka_server   latest              60d020191110        35 seconds ago      148MB<br>192.168.200.131:85&#x2F;tensquare&#x2F;eureka                    v1                  e85b5d3d9090        44 hours ago        150MB<br>[root@localhost jenkins_shell]# docker ps<br>CONTAINER ID        IMAGE                                                         COMMAND                CREATED             STATUS              PORTS                      NAMES<br>b934523c60da        192.168.200.131:85&#x2F;tensquare&#x2F;tensquare_eureka_server:latest   â€œjava -jar &#x2F;app.jarâ€   33 seconds ago      Up 30 seconds       0.0.0.0:10086-&gt;10086&#x2F;tcp   focused_boyd</p>
</blockquote>
<p>æˆåŠŸè®¿é—®ï¼š[Eureka] (<a target="_blank" rel="noopener" href="http://192.168.200.130:10086/">http://192.168.200.130:10086/</a>)</p>
<p>å¦‚æœè¦ä¸‹è½½å…¶ä»–é•œåƒ éœ€è¦æŠŠæ¯ä¸ªæœåŠ¡çš„<code>application.yml</code>æ›´æ”¹è¿æ¥åœ°å€</p>
<blockquote>
<p>æ›´æ”¹æ‰€æœ‰æœåŠ¡çš„application.ymlåœ°å€<br>sonarqubeçš„æ˜¯129é‡Œé¢æœ‰mysql<br>eurekaçš„æ˜¯130ç”¨çš„ç”Ÿäº§è™šæ‹ŸæœåŠ¡å™¨</p>
</blockquote>
<blockquote>
<p>é‚£æˆ‘å¾®æœåŠ¡é‡Œçš„application.yml server:   port: 9001 spring:   application:      name: tensquare-admin-service #æŒ‡å®šæœåŠ¡å  datasource:      driverClassName: com.mysql.jdbc.Driver    url: jdbc:mysql:&#x2F;&#x2F;192.168.200.129&#x2F;tensquare_user?characterEncoding&#x3D;UTF8    username: root    password: root  jpa:     database: mysql    show-sql: true è¿™æ ·å†™å¯ä»¥å—</p>
<p><code>é‚£ä¸ª192.168.200.129:3306/</code>å›ç­”ï¼š</p>
<ul>
<li><strong>å¦‚æœä½ çš„å¾®æœåŠ¡è¿è¡Œç¯å¢ƒå’Œ MySQL åœ¨åŒä¸€å±€åŸŸç½‘å†…ï¼Œä¸” 192.168.200.129 æ˜¯ MySQL æœåŠ¡æ‰€åœ¨è™šæ‹Ÿæœºçš„æœ‰æ•ˆIPï¼Œä¸”ç½‘ç»œæ˜¯é€šçš„ï¼Œç«¯å£ 3306 æ²¡è¢«é˜²ç«å¢™æ‹¦æˆªï¼ŒNATæˆ–è€…æ¡¥æ¥é…ç½®æ— è¯¯ï¼Œä½¿ç”¨è¿™ä¸ª IP å’Œç«¯å£æ˜¯å®Œå…¨æ²¡é—®é¢˜çš„ã€‚</strong></li>
<li>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ ä»å¾®æœåŠ¡æ‰€åœ¨çš„æœºå™¨èƒ½ ping é€š <code>192.168.200.129</code> å¹¶ä¸” <code>telnet 192.168.200.129 3306</code> å¯ä»¥è¿é€šï¼Œå°±å¯ä»¥è¿™ä¹ˆå†™ã€‚</li>
</ul>
<hr>
<h3 id="ä½ éœ€è¦ç¡®è®¤çš„ï¼š"><a href="#ä½ éœ€è¦ç¡®è®¤çš„ï¼š" class="headerlink" title="ä½ éœ€è¦ç¡®è®¤çš„ï¼š"></a>ä½ éœ€è¦ç¡®è®¤çš„ï¼š</h3><ol>
<li><strong>ä½ çš„å¾®æœåŠ¡è¿è¡Œåœ¨å“ªå°æœºå™¨ï¼Ÿ</strong><ul>
<li>å¦‚æœå¾®æœåŠ¡ä¹Ÿåœ¨è™šæ‹Ÿæœºé‡Œï¼ˆåŒä¸€å°è™šæ‹Ÿæœºæˆ–åŒä¸€å†…ç½‘ï¼‰ï¼Œç”¨è™šæ‹Ÿæœºçš„IPå†™å°±å¯¹ã€‚</li>
<li>å¦‚æœå¾®æœåŠ¡åœ¨å®¿ä¸»æœºï¼Œä¸”è™šæ‹Ÿæœºç”¨çš„æ˜¯ NAT æ¨¡å¼ï¼Œä½ å¿…é¡»ç¡®è®¤ç«¯å£æ˜ å°„å­˜åœ¨ï¼Œå¦åˆ™å®¿ä¸»æœºè¿è¿™ä¸ª IP 3306 ä¸é€šï¼ˆåŸå› æ˜¯ NAT éš”ç¦»ï¼‰ã€‚è¿™æ—¶ç”¨è™šæ‹Ÿæœºç§æœ‰ IP ç›´æ¥è¿æ¥æ˜¯ä¸è¡Œçš„ã€‚</li>
</ul>
</li>
<li><strong>ç½‘ç»œè¿é€šæ€§</strong><ul>
<li>å¾®æœåŠ¡æ‰€åœ¨æœºå™¨èƒ½ <code>ping</code> é€šè¯¥ IPã€‚</li>
<li>èƒ½ <code>telnet IP 3306</code> è¿é€šã€‚</li>
</ul>
</li>
</ol>
<hr>
<h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul>
<li><strong>åªè¦ç½‘ç»œé€šï¼Œç«¯å£æ”¾é€šï¼Œ<code>jdbc:mysql://192.168.200.129:3306/æ•°æ®åº“å</code> å†™æ³•å°±æ˜¯æ ‡å‡†ä¸”æ­£ç¡®çš„ã€‚</strong></li>
<li>å¦‚æœç½‘ç»œä¸é€šï¼Œå°±è¦è°ƒæ•´ç½‘ç»œé…ç½®ï¼ˆæ¯”å¦‚æ¡¥æ¥ã€ç«¯å£æ˜ å°„ï¼‰ï¼Œæˆ–è€…æ”¹ç”¨ <code>localhost</code>ã€<code>127.0.0.1</code> è®¿é—®æœ¬æœºMySQLã€‚</li>
</ul>
</blockquote>
<h6 id="åˆ†åˆ«æ„å»ºå…¶ä½™çš„å‡ ä¸ªå¾®æœåŠ¡é¡¹ç›®-è®°ä½portç«¯å£æ˜¯è¦è·Ÿapplication-ymlé‡Œé¢ä¸€è‡´çš„"><a href="#åˆ†åˆ«æ„å»ºå…¶ä½™çš„å‡ ä¸ªå¾®æœåŠ¡é¡¹ç›®-è®°ä½portç«¯å£æ˜¯è¦è·Ÿapplication-ymlé‡Œé¢ä¸€è‡´çš„" class="headerlink" title="åˆ†åˆ«æ„å»ºå…¶ä½™çš„å‡ ä¸ªå¾®æœåŠ¡é¡¹ç›® è®°ä½portç«¯å£æ˜¯è¦è·Ÿapplication.ymlé‡Œé¢ä¸€è‡´çš„"></a>åˆ†åˆ«æ„å»ºå…¶ä½™çš„å‡ ä¸ªå¾®æœåŠ¡é¡¹ç›® è®°ä½portç«¯å£æ˜¯è¦è·Ÿapplication.ymlé‡Œé¢ä¸€è‡´çš„</h6><blockquote>
<p>[root@localhost ~]# docker images<br>REPOSITORY                                             TAG                 IMAGE ID            CREATED             SIZE<br>192.168.200.131:85&#x2F;tensquare&#x2F;tensquare_gathering       latest              c700a6359fce        33 seconds ago      155MB<br>192.168.200.131:85&#x2F;tensquare&#x2F;tensquare_admin_service   latest              92453ab6e765        2 minutes ago       156MB<br>192.168.200.131:85&#x2F;tensquare&#x2F;tensquare_zuul            latest              122afd78d6ef        3 minutes ago       146MB<br>192.168.200.131:85&#x2F;tensquare&#x2F;tensquare_eureka_server   latest              60d020191110        4 hours ago         148MB<br>192.168.200.131:85&#x2F;tensquare&#x2F;eureka                    v1                  e85b5d3d9090        2 days ago          150MB</p>
<hr>
<p>[root@localhost ~]# docker ps<br>CONTAINER ID        IMAGE                                                         COMMAND                  CREATED              STATUS              PORTS                      NAMES<br>aa2178c7dd0d        192.168.200.131:85&#x2F;tensquare&#x2F;tensquare_gathering:latest       â€œjava -Djava.net.preâ€¦â€   About a minute ago   Up 59 seconds       0.0.0.0:9002-&gt;9002&#x2F;tcp     nostalgic_lichterman<br>14e040066165        192.168.200.131:85&#x2F;tensquare&#x2F;tensquare_admin_service:latest   â€œjava -Djava.net.preâ€¦â€   2 minutes ago        Up 2 minutes        0.0.0.0:9001-&gt;9001&#x2F;tcp     dreamy_montalcini<br>8143d8ccbeee        192.168.200.131:85&#x2F;tensquare&#x2F;tensquare_zuul:latest            â€œjava -Djava.net.preâ€¦â€   3 minutes ago        Up 3 minutes        0.0.0.0:10020-&gt;10020&#x2F;tcp   gracious_kalam<br>b934523c60da        192.168.200.131:85&#x2F;tensquare&#x2F;tensquare_eureka_server:latest   â€œjava -jar &#x2F;app.jarâ€     4 hours ago          Up 4 hours          0.0.0.0:10086-&gt;10086&#x2F;tcp   focused_boyd</p>
<p>ä½ è¿™ä¸ªæƒ…å†µæ˜¯é•œåƒæœ‰äº†ï¼Œä½†æ˜¯æ²¡æœ‰è¿è¡Œçš„å®¹å™¨ï¼Œæ‰€ä»¥è¦å¯åŠ¨é•œåƒï¼Œåˆ›å»ºå¹¶è¿è¡Œå®¹å™¨ã€‚</p>
<h3 id="å¯åŠ¨é•œåƒâ˜…â˜…çš„åŸºæœ¬å‘½ä»¤æ˜¯ï¼š-Jenkins-129æœåŠ¡å™¨"><a href="#å¯åŠ¨é•œåƒâ˜…â˜…çš„åŸºæœ¬å‘½ä»¤æ˜¯ï¼š-Jenkins-129æœåŠ¡å™¨" class="headerlink" title="å¯åŠ¨é•œåƒâ˜…â˜…çš„åŸºæœ¬å‘½ä»¤æ˜¯ï¼š[Jenkins 129æœåŠ¡å™¨]"></a>å¯åŠ¨é•œåƒâ˜…â˜…çš„åŸºæœ¬å‘½ä»¤æ˜¯ï¼š[Jenkins 129æœåŠ¡å™¨]</h3><pre><code>docker run -d -p &lt;å®¿ä¸»æœºç«¯å£&gt;:&lt;å®¹å™¨ç«¯å£&gt; --name &lt;å®¹å™¨åå­—&gt; &lt;é•œåƒå&gt;
</code></pre>
<p>ç›´æ¥å¯åŠ¨æ— éœ€é‡æ–°åˆ›å»ºå®¹å™¨ï¼š<br>å…ˆæŸ¥çœ‹æ‰€æœ‰å®¹å™¨(åŒ…æ‹¬å·²åœæ­¢çš„)ï¼š<code>docker ps -a</code></p>
<blockquote>
<p>docker start tensquare_admin_service<br>docker start tensquare_gathering<br>docker start tensquare_zuul<br>docker start tensquare_eureka_server</p>
</blockquote>
<p>è‹¥éœ€è¦åˆ é™¤å†é‡æ–°å¯åŠ¨</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<blockquote>
<p>å…ˆåˆ é™¤ä¹‹å‰çš„å®¹å™¨ï¼š<br>docker rm tensquare_admin_service<br>docker rm tensquare_gathering<br>docker rm tensquare_zuul<br>docker rm tensquare_eureka_server</p>
</blockquote>
<pre><code>docker run -d -p 9001:9101 --name tensquare_admin_service 192.168.200.131:85/tensquare/tensquare_admin_service:latest
docker run -d -p 9002:9002 --name tensquare_gathering 192.168.200.131:85/tensquare/tensquare_gathering:latest
docker run -d -p 10020:10020 --name tensquare_zuul 192.168.200.131:85/tensquare/tensquare_zuul:latest
docker run -d -p 10086:10086 --name tensquare_eureka_server 192.168.200.131:85/tensquare/tensquare_eureka_server:latest
</code></pre>
<blockquote>
<p>[root@localhost ~]# docker rm -f tensquare_admin_service<br>tensquare_admin_service<br>[root@localhost ~]# docker run -d -p 9101:9001 â€“name tensquare_admin_service 192.168.200.131:85&#x2F;tensquare&#x2F;tensquare_admin_service:latest<br>634a31582dc81acf34b101d468d84b1c3f92b75477b6ad469abe00dc09821d4b<br>[root@localhost ~]#</p>
</blockquote>
<blockquote>
<p>ç«¯å£æ˜ å°„è¦æ ¹æ®ä½ çš„ç¨‹åºç›‘å¬ç«¯å£è®¾å®šï¼Œå¦åˆ™å¤–éƒ¨è®¿é—®ä¸åˆ°å®¹å™¨æœåŠ¡ã€‚</p>
</blockquote>
<h3 id="æ­¤æ—¶ä¹Ÿè¦åœ¨ç”Ÿäº§130æœåŠ¡å™¨ä¸Šå»é‡æ–°å¯åŠ¨é‚£äº›å®¹å™¨"><a href="#æ­¤æ—¶ä¹Ÿè¦åœ¨ç”Ÿäº§130æœåŠ¡å™¨ä¸Šå»é‡æ–°å¯åŠ¨é‚£äº›å®¹å™¨" class="headerlink" title="æ­¤æ—¶ä¹Ÿè¦åœ¨ç”Ÿäº§130æœåŠ¡å™¨ä¸Šå»é‡æ–°å¯åŠ¨é‚£äº›å®¹å™¨"></a>æ­¤æ—¶ä¹Ÿè¦åœ¨ç”Ÿäº§130æœåŠ¡å™¨ä¸Šå»é‡æ–°å¯åŠ¨é‚£äº›å®¹å™¨</h3><blockquote>
<h3 id="âœ…-1-é‡å¯-130-ä¸Šçš„å®¹å™¨"><a href="#âœ…-1-é‡å¯-130-ä¸Šçš„å®¹å™¨" class="headerlink" title="âœ… 1. é‡å¯ 130 ä¸Šçš„å®¹å™¨"></a>âœ… <strong>1. é‡å¯ 130 ä¸Šçš„å®¹å™¨</strong></h3><p>å¯ä»¥ç”¨ <code>docker start å®¹å™¨IDæˆ–å®¹å™¨å</code> é‡å¯ï¼š</p>
<pre><code>bashå¤åˆ¶ç¼–è¾‘docker start e55957d0a79e  # gathering
docker start 3c8592621ab7  # admin_service
docker start 43a7ca513e37  # zuul
docker start 831aeb331519  # eureka
</code></pre>
<p>æˆ–è€…ç»Ÿä¸€å¯åŠ¨ï¼š</p>
<pre><code>bash


å¤åˆ¶ç¼–è¾‘
docker start $(docker ps -a -q)
</code></pre>
</blockquote>
<hr>
<hr>
<hr>
<h3 id="åˆ é™¤é•œåƒ"><a href="#åˆ é™¤é•œåƒ" class="headerlink" title="åˆ é™¤é•œåƒ"></a>åˆ é™¤é•œåƒ</h3><p>åœæ­¢å®¹å™¨ï¼š</p>
<pre><code>docker stop å®¹å™¨IDæˆ–å®¹å™¨å
</code></pre>
<p>åˆ é™¤å®¹å™¨ï¼š</p>
<pre><code>docker rm å®¹å™¨IDæˆ–å®¹å™¨å
</code></pre>
<h3 id="3-åˆ é™¤é•œåƒ"><a href="#3-åˆ é™¤é•œåƒ" class="headerlink" title="3. åˆ é™¤é•œåƒ"></a>3. åˆ é™¤é•œåƒ</h3><p>åˆ é™¤æœ‰æ ‡ç­¾çš„é•œåƒï¼š</p>
<pre><code>docker rmi 192.168.200.131:85/tensquare/tensquare_gathering
docker rmi tensquare_gathering
</code></pre>
<p>åˆ é™¤æ— æ ‡ç­¾çš„æ‚¬ç©ºé•œåƒï¼š</p>
<pre><code>docker rmi 08b0a9196df2
</code></pre>
<h3 id="4-å¦‚æœæœ‰å¤šä¸ªæ— æ ‡ç­¾é•œåƒï¼Œåˆ é™¤æ‰€æœ‰æ‚¬ç©ºé•œåƒ"><a href="#4-å¦‚æœæœ‰å¤šä¸ªæ— æ ‡ç­¾é•œåƒï¼Œåˆ é™¤æ‰€æœ‰æ‚¬ç©ºé•œåƒ" class="headerlink" title="4. å¦‚æœæœ‰å¤šä¸ªæ— æ ‡ç­¾é•œåƒï¼Œåˆ é™¤æ‰€æœ‰æ‚¬ç©ºé•œåƒ"></a>4. å¦‚æœæœ‰å¤šä¸ªæ— æ ‡ç­¾é•œåƒï¼Œåˆ é™¤æ‰€æœ‰æ‚¬ç©ºé•œåƒ</h3><pre><code>docker image prune
</code></pre>
</blockquote>
<p>[ç”Ÿäº§]ï¼š[Eureka] (<a target="_blank" rel="noopener" href="http://192.168.200.130:10086/">http://192.168.200.130:10086/</a>)</p>
<blockquote>
<h5 id="Instances-currently-registered-with-Eureka"><a href="#Instances-currently-registered-with-Eureka" class="headerlink" title="Instances currently registered with Eureka"></a>Instances currently registered with Eureka</h5><table>
<thead>
<tr>
<th align="left">Application</th>
<th align="left">AMIs</th>
<th align="left">Availability Zones</th>
<th align="left">Status</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>TENSQUARE-ADMIN-SERVICE</strong></td>
<td align="left"><strong>n&#x2F;a</strong> (1)</td>
<td align="left">(1)</td>
<td align="left"><strong>UP</strong> (1) - <a target="_blank" rel="noopener" href="http://172.17.0.4:9001/actuator/info">14e040066165:tensquare-admin-service:9001</a></td>
</tr>
<tr>
<td align="left"><strong>TENSQUARE-GATHERING</strong></td>
<td align="left"><strong>n&#x2F;a</strong> (1)</td>
<td align="left">(1)</td>
<td align="left"><strong>UP</strong> (1) - <a target="_blank" rel="noopener" href="http://172.17.0.5:9002/actuator/info">aa2178c7dd0d:tensquare-gathering:9002</a></td>
</tr>
<tr>
<td align="left"><strong>TENSQUARE-ZUUL</strong></td>
<td align="left"><strong>n&#x2F;a</strong> (1)</td>
<td align="left">(1)</td>
<td align="left"><strong>UP</strong> (1) - <a target="_blank" rel="noopener" href="http://172.17.0.3:10020/actuator/info">8143d8ccbeee:tensquare-zuul:10020</a></td>
</tr>
</tbody></table>
</blockquote>
<h6 id="Jenkinsfile"><a href="#Jenkinsfile" class="headerlink" title="Jenkinsfile"></a>Jenkinsfile</h6><pre><code class="java">//gitå‡­è¯ID
def git_auth = &quot;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&quot;
//gitçš„urlåœ°å€
def git_url = &quot;http://192.168.200.132:82/lanyun_group/tensquare_back.git&quot;
//é•œåƒçš„ç‰ˆæœ¬å·
def tag = &quot;latest&quot;
//Harborçš„urlåœ°å€
def harbor_url = &quot;192.168.200.131:85&quot;
//é•œåƒåº“é¡¹ç›®åç§°
def harbor_project = &quot;tensquare&quot;
//harborçš„ç™»å½•å‡­è¯ID
def harbor_auth = &quot;f83725d3-d5fc-4faf-8ac1-1a56487dfc7b&quot;


node &#123;
   stage(&#39;æ‹‰å–ä»£ç &#39;) &#123;
      checkout scmGit(branches: [[name: &quot;*/$&#123;branch&#125;&quot;]], extensions: [], userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url: &quot;$&#123;git_url&#125;&quot;]])
   &#125;
   stage(&#39;ä»£ç å®¡æŸ¥&#39;) &#123;
      //å®šä¹‰å½“å‰çš„Jenkinsçš„sonarqubeScannerå·¥å…· Jenkinsçš„å…¨å±€Toolsé‡Œ
      def scannerHome = tool &#39;sonar-scanner&#39;
      //å¼•ç”¨å½“å‰JenkinsSonarQubeç¯å¢ƒ Jenkinsçš„Systemé‡Œ
      withSonarQubeEnv(&#39;sonarqube&#39;)&#123;
      // éœ€è¦è¿›å…¥æŸä¸ªé¡¹ç›® åœ¨Jenkinsé€‰æ‹©ä»€ä¹ˆé¡¹ç›®å°±cdä»€ä¹ˆé¡¹ç›®
                sh &quot;&quot;&quot;
                    cd $&#123;project_name&#125;
                    $&#123;scannerHome&#125;/bin/sonar-scanner
                &quot;&quot;&quot;
      &#125;
    &#125;
    stage(&#39;ç¼–è¯‘ï¼Œå®‰è£…å…¬å…±å­å·¥ç¨‹&#39;)&#123;
        sh &quot;mvn -f tensquare_common clean install&quot;
    &#125;
    stage(&#39;ç¼–è¯‘ï¼Œæ‰“åŒ…å¾®æœåŠ¡å·¥ç¨‹&#39;)&#123;
        sh &quot;mvn -f $&#123;project_name&#125; clean package dockerfile:build&quot;
        // å®šä¹‰é•œåƒåç§°
        def imageName = &quot;$&#123;project_name&#125;:$&#123;tag&#125;&quot;

        // å¯¹é•œåƒæ‰“ä¸Šæ ‡ç­¾
        sh &quot;docker tag $&#123;imageName&#125; $&#123;harbor_url&#125;/$&#123;harbor_project&#125;/$&#123;imageName&#125;&quot;

        // æŠŠé•œåƒæ¨é€åˆ°Harbor(è¦ç™»å½• è¾“å…¥è´¦å·å¯†ç  ä¸è¦å†™åœ¨è„šæœ¬æ–‡ä»¶ æŠŠharborè´¦å·å¯†ç ç”¨jenkinså…¨å±€å‡­è¯)
        withCredentials([usernamePassword(credentialsId: &quot;$&#123;harbor_auth&#125;&quot;, passwordVariable: &#39;password&#39;, usernameVariable: &#39;username&#39;)]) &#123;
            // ç™»å½•åˆ°Harbor
            sh &quot;docker login -u $&#123;username&#125; -p  $&#123;password&#125; $&#123;harbor_url&#125;&quot;

            //é•œåƒä¸Šä¼ 
            sh &quot;docker push $&#123;harbor_url&#125;/$&#123;harbor_project&#125;/$&#123;imageName&#125;&quot;

            sh &quot;echo &#39;ğŸ”¥ğŸ”¥é•œåƒä¸Šä¼ æˆåŠŸâœ…âœ…&#39;&quot;
        &#125;
        // éƒ¨ç½²åº”ç”¨ å‘é€å‘½ä»¤è°ƒç”¨ç”Ÿäº§æœåŠ¡å™¨çš„shellè„šæœ¬æ–‡ä»¶ å®Œæˆæ‰€æœ‰çš„å¾®æœåŠ¡é¡¹ç›®éƒ¨ç½²è¡Œä¸º
        // deploy.sh æ˜¯è§¦å‘è¿œç¨‹è„šæœ¬æ–‡ä»¶(é•œåƒæ‹‰å–å’Œå®¹å™¨åˆ›å»ºçš„è¡Œä¸º)
        sshPublisher(publishers: [sshPublisherDesc(configName: &#39;master_server&#39;, transfers: [sshTransfer(cleanRemote: false, excludes: &#39;&#39;, execCommand: &quot;/opt/jenkins_shell/deploy.sh $harbor_url $harbor_project $project_name $tag $port&quot;, execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: &#39;[, ]+&#39;, remoteDirectory: &#39;&#39;, remoteDirectorySDF: false, removePrefix: &#39;&#39;, sourceFiles: &#39;&#39;)], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])
    &#125;
&#125;
</code></pre>
<h6 id="deploy-sh"><a href="#deploy-sh" class="headerlink" title="deploy.sh"></a>deploy.sh</h6><pre><code class="java">#! /bin/sh
#æ¥æ”¶å¤–éƒ¨å‚æ•°
harbor_url=$1
harbor_project_name=$2
project_name=$3
tag=$4
port=$5

imageName=$harbor_url/$harbor_project_name/$project_name:$tag

echo &quot;$imageName&quot;

#æŸ¥è¯¢å®¹å™¨æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™åˆ é™¤
containerId=`docker ps -a | grep -w $&#123;project_name&#125;:$&#123;tag&#125;  | awk &#39;&#123;print $1&#125;&#39;`
if [ &quot;$containerId&quot; !=  &quot;&quot; ] ; then
    #åœæ‰å®¹å™¨
    docker stop $containerId

    #åˆ é™¤å®¹å™¨
    docker rm $containerId
    
    echo &quot;æˆåŠŸåˆ é™¤å®¹å™¨&quot;
fi

#æŸ¥è¯¢é•œåƒæ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™åˆ é™¤
imageId=`docker images | grep -w $project_name  | awk &#39;&#123;print $3&#125;&#39;`

if [ &quot;$imageId&quot; !=  &quot;&quot; ] ; then
      
    #åˆ é™¤é•œåƒ
    docker rmi -f $imageId
    
    echo &quot;æˆåŠŸåˆ é™¤é•œåƒ&quot;
fi

# ç™»å½•Harbor
docker login -u eric -p Eric123456 $harbor_url

# ä¸‹è½½é•œåƒ
docker pull $imageName

# å¯åŠ¨å®¹å™¨
docker run -di -p $port:$port $imageName

echo &quot;å®¹å™¨å¯åŠ¨æˆåŠŸ&quot;
</code></pre>
<h5 id="è¿æ¥æ•°æ®åº“çš„æ—¶å€™æœ‰é—®é¢˜"><a href="#è¿æ¥æ•°æ®åº“çš„æ—¶å€™æœ‰é—®é¢˜" class="headerlink" title="è¿æ¥æ•°æ®åº“çš„æ—¶å€™æœ‰é—®é¢˜"></a>è¿æ¥æ•°æ®åº“çš„æ—¶å€™æœ‰é—®é¢˜</h5><blockquote>
<p>[root@localhost ~]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld â€“initialize â€“user&#x3D;mysql â€“datadir&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql 2025-07-04T10:46:28.109697Z 0 [Warning] [MY-011070] [Server] â€˜Disabling symbolic links using â€“skip-symbolic-links (or equivalent) is the default. Consider not using this option as itâ€™ is deprecated and will be removed in a future release. 2025-07-04T10:46:28.110588Z 0 [System] [MY-013169] [Server] &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld (mysqld 8.0.30) initializing of server in progress as process 31821 2025-07-04T10:46:28.115123Z 0 [ERROR] [MY-010457] [Server] â€“initialize specified but the data directory has files in it. Aborting. 2025-07-04T10:46:28.115149Z 0 [ERROR] [MY-013236] [Server] The designated data directory &#x2F;var&#x2F;lib&#x2F;mysql&#x2F; is unusable. You can remove all files that the server added to it. 2025-07-04T10:46:28.115231Z 0 [ERROR] [MY-010119] [Server] Aborting 2025-07-04T10:46:28.115717Z 0 [System] [MY-010910] [Server] &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld: Shutdown complete (mysqld 8.0.30)  MySQL Community Server - GPL. [root@localhost ~]#</p>
<h6 id="ChatGPT-è¯´ï¼š-3"><a href="#ChatGPT-è¯´ï¼š-3" class="headerlink" title="ChatGPT è¯´ï¼š"></a>ChatGPT è¯´ï¼š</h6><p>æŠ¥é”™å¾ˆæ˜ç¡®ï¼š</p>
<pre><code>--initialize specified but the data directory has files in it. Aborting.
</code></pre>
<p>æ„æ€æ˜¯ï¼šä½ æŒ‡å®šçš„ <code>/var/lib/mysql</code> ç›®å½• <strong>é‡Œé¢å·²ç»æœ‰æ–‡ä»¶äº†</strong>ï¼Œæ‰€ä»¥åˆå§‹åŒ–è¢«æ‹’ç»äº†ã€‚</p>
<hr>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="1-å¤‡ä»½æˆ–æ¸…ç©º-var-lib-mysql-ç›®å½•"><a href="#1-å¤‡ä»½æˆ–æ¸…ç©º-var-lib-mysql-ç›®å½•" class="headerlink" title="1. å¤‡ä»½æˆ–æ¸…ç©º /var/lib/mysql ç›®å½•"></a>1. å¤‡ä»½æˆ–æ¸…ç©º <code>/var/lib/mysql</code> ç›®å½•</h3><p>å¦‚æœä½ ç¡®è®¤ç›®å½•é‡Œé¢çš„æ•°æ®å¯ä»¥åˆ é™¤ï¼ˆæˆ–è€…ä½ å·²ç»å¤‡ä»½äº†é‡è¦æ•°æ®ï¼‰ï¼Œæ‰§è¡Œï¼š</p>
<pre><code>rm -rf /var/lib/mysql/*
</code></pre>
<p>ç¡®ä¿ç›®å½•ä¸‹æ–‡ä»¶éƒ½åˆ å¹²å‡€ã€‚</p>
<hr>
<h3 id="2-å†æ¬¡æ‰§è¡Œåˆå§‹åŒ–"><a href="#2-å†æ¬¡æ‰§è¡Œåˆå§‹åŒ–" class="headerlink" title="2. å†æ¬¡æ‰§è¡Œåˆå§‹åŒ–"></a>2. å†æ¬¡æ‰§è¡Œåˆå§‹åŒ–</h3><pre><code>/usr/local/mysql/bin/mysqld --initialize --user=mysql --datadir=/var/lib/mysql
</code></pre>
<p>è¿™æ¬¡åº”è¯¥ä¼šæˆåŠŸã€‚</p>
<hr>
<h3 id="3-å¯åŠ¨-MySQL-æœåŠ¡"><a href="#3-å¯åŠ¨-MySQL-æœåŠ¡" class="headerlink" title="3. å¯åŠ¨ MySQL æœåŠ¡"></a>3. å¯åŠ¨ MySQL æœåŠ¡</h3><pre><code>systemctl start mysql
</code></pre>
<hr>
<h3 id="4-æŸ¥çœ‹çŠ¶æ€å’Œæ—¥å¿—ï¼Œç¡®ä¿å¯åŠ¨æˆåŠŸ"><a href="#4-æŸ¥çœ‹çŠ¶æ€å’Œæ—¥å¿—ï¼Œç¡®ä¿å¯åŠ¨æˆåŠŸ" class="headerlink" title="4. æŸ¥çœ‹çŠ¶æ€å’Œæ—¥å¿—ï¼Œç¡®ä¿å¯åŠ¨æˆåŠŸ"></a>4. æŸ¥çœ‹çŠ¶æ€å’Œæ—¥å¿—ï¼Œç¡®ä¿å¯åŠ¨æˆåŠŸ</h3><pre><code>systemctl status mysql
tail -n 50 /var/log/mariadb/mariadb.log
</code></pre>
<hr>
<p>å¦‚æœä½ æ‹…å¿ƒè¯¯åˆ æ•°æ®ï¼Œå¯ä»¥å…ˆå¤‡ä»½ç›®å½•ï¼š</p>
<pre><code>mv /var/lib/mysql /var/lib/mysql_backup_$(date +%F_%T)
mkdir /var/lib/mysql
chown mysql:mysql /var/lib/mysql
</code></pre>
<p>ç„¶åå†åˆå§‹åŒ–ã€‚</p>
<p>è¿™æ ·å¯åŠ¨<code>mysql -uroot -p --socket=/var/lib/mysql/mysql.sock</code></p>
<hr>
<hr>
<hr>
<p><strong>å®¿ä¸»æœºï¼ˆWindowsï¼‰é€šè¿‡ NAT æ¨¡å¼è¿æ¥è™šæ‹Ÿæœºçš„æ­£ç¡®å§¿åŠ¿ä¸æ˜¯ç›´æ¥ç”¨è™šæ‹ŸæœºIPï¼Œè€Œæ˜¯ç”¨æ˜ å°„åˆ°å®¿ä¸»æœºçš„ç«¯å£ã€‚</strong></p>
<hr>
<h4 id="ä½ å½“å‰ç”¨çš„ï¼š"><a href="#ä½ å½“å‰ç”¨çš„ï¼š" class="headerlink" title="ä½ å½“å‰ç”¨çš„ï¼š"></a>ä½ å½“å‰ç”¨çš„ï¼š</h4><pre><code>mysql -uroot -proot -h192.168.200.129 -P3306
</code></pre>
<p>è¿™æ˜¯è™šæ‹Ÿæœºçš„ç§æœ‰IPï¼ŒNATæ¨¡å¼ä¸‹å¤–éƒ¨è®¿é—®æ˜¯è¢«éš”ç¦»çš„ï¼Œç›´æ¥è¿è¿™ä¸ªIPä¸é€šã€‚</p>
<hr>
<h3 id="æ­£ç¡®åšæ³•ï¼š"><a href="#æ­£ç¡®åšæ³•ï¼š" class="headerlink" title="æ­£ç¡®åšæ³•ï¼š"></a>æ­£ç¡®åšæ³•ï¼š</h3><ol>
<li>åœ¨ VMware çš„ NAT è®¾ç½®é‡Œæ·»åŠ ç«¯å£è½¬å‘è§„åˆ™ï¼ŒæŠŠå®¿ä¸»æœºçš„æŸä¸ªç«¯å£ï¼ˆæ¯”å¦‚3306ï¼‰è½¬å‘åˆ°è™šæ‹Ÿæœºçš„3306ç«¯å£ã€‚</li>
<li>å®¿ä¸»æœºè¿æ¥æ—¶ï¼Œç”¨ <code>127.0.0.1</code>ï¼ˆæˆ–è€… <code>localhost</code>ï¼‰åŠ ç«¯å£è®¿é—®ã€‚</li>
</ol>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>mysql -uroot -proot -h127.0.0.1 -P3306
</code></pre>
<hr>
<h3 id="å¦‚æœä½ æƒ³ç”¨è™šæ‹Ÿæœºçš„ç§æœ‰IPç›´æ¥è¿æ¥ï¼Œå»ºè®®æ”¹æˆæ¡¥æ¥ç½‘å¡ã€‚"><a href="#å¦‚æœä½ æƒ³ç”¨è™šæ‹Ÿæœºçš„ç§æœ‰IPç›´æ¥è¿æ¥ï¼Œå»ºè®®æ”¹æˆæ¡¥æ¥ç½‘å¡ã€‚" class="headerlink" title="å¦‚æœä½ æƒ³ç”¨è™šæ‹Ÿæœºçš„ç§æœ‰IPç›´æ¥è¿æ¥ï¼Œå»ºè®®æ”¹æˆæ¡¥æ¥ç½‘å¡ã€‚"></a>å¦‚æœä½ æƒ³ç”¨è™šæ‹Ÿæœºçš„ç§æœ‰IPç›´æ¥è¿æ¥ï¼Œå»ºè®®æ”¹æˆæ¡¥æ¥ç½‘å¡ã€‚</h3><hr>
<h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><ul>
<li>ä½ çš„ MySQL é…ç½®æ²¡é—®é¢˜äº†</li>
<li>NATæ¨¡å¼ä¸‹å®¿ä¸»æœºè®¿é—®è™šæ‹ŸæœºMySQLå¿…é¡»ç”¨ç«¯å£è½¬å‘+127.0.0.1</li>
<li>æˆ–åˆ‡æ¢æ¡¥æ¥ï¼Œç›´æ¥ç”¨è™šæ‹ŸæœºIPè®¿é—®</li>
</ul>
<hr>
<h2 id="âœ…-æŸ¥çœ‹å®¹å™¨æ—¥å¿—å‘½ä»¤ï¼š"><a href="#âœ…-æŸ¥çœ‹å®¹å™¨æ—¥å¿—å‘½ä»¤ï¼š" class="headerlink" title="âœ… æŸ¥çœ‹å®¹å™¨æ—¥å¿—å‘½ä»¤ï¼š"></a>âœ… æŸ¥çœ‹å®¹å™¨æ—¥å¿—å‘½ä»¤ï¼š</h2></blockquote>
<blockquote>
<pre><code>docker logs -f dreamy_montalcini
</code></pre>
<ul>
<li><code>-f</code> è¡¨ç¤º <strong>å®æ—¶è¿½è¸ªæ—¥å¿—</strong>ï¼Œç›¸å½“äº <code>tail -f</code> çš„æ•ˆæœ</li>
<li>å¦‚æœä½ åªæƒ³çœ‹æœ€è¿‘çš„æ—¥å¿—è¡Œæ•°ï¼Œæ¯”å¦‚ 100 è¡Œï¼š</li>
</ul>
<pre><code>docker logs --tail 100 dreamy_montalcini
</code></pre>
<hr>
<h3 id="âœ…-è¿˜å¯ä»¥ç”¨å®¹å™¨-IDï¼š"><a href="#âœ…-è¿˜å¯ä»¥ç”¨å®¹å™¨-IDï¼š" class="headerlink" title="âœ… è¿˜å¯ä»¥ç”¨å®¹å™¨ IDï¼š"></a>âœ… è¿˜å¯ä»¥ç”¨å®¹å™¨ IDï¼š</h3><pre><code>docker logs -f 14e040066165
</code></pre>
</blockquote>
<h4 id="å¦‚æœmysqlå¿˜è®°å¯†ç äº†æ€ä¹ˆåŠ"><a href="#å¦‚æœmysqlå¿˜è®°å¯†ç äº†æ€ä¹ˆåŠ" class="headerlink" title="å¦‚æœmysqlå¿˜è®°å¯†ç äº†æ€ä¹ˆåŠ"></a>å¦‚æœmysqlå¿˜è®°å¯†ç äº†æ€ä¹ˆåŠ</h4><blockquote>
<h3 id="âœ…-ç¬¬ä¸€æ­¥ï¼šæ‰¾å‡º-mysqld-safe-è·¯å¾„"><a href="#âœ…-ç¬¬ä¸€æ­¥ï¼šæ‰¾å‡º-mysqld-safe-è·¯å¾„" class="headerlink" title="âœ… ç¬¬ä¸€æ­¥ï¼šæ‰¾å‡º mysqld_safe è·¯å¾„"></a>âœ… ç¬¬ä¸€æ­¥ï¼šæ‰¾å‡º <code>mysqld_safe</code> è·¯å¾„</h3><p>æ‰€ä»¥ç³»ç»Ÿæ‰¾ä¸åˆ° <code>mysqld_safe</code> å‘½ä»¤ã€‚è¯·æ‰§è¡Œä¸‹é¢å‘½ä»¤æ‰¾å‡ºå®ƒåœ¨å“ªï¼š</p>
<pre><code>sudo find / -name mysqld_safe
</code></pre>
<p>å®ƒä¸€èˆ¬å¯èƒ½åœ¨ <code>/usr/bin/mysqld_safe</code> æˆ– <code>/usr/local/mysql/bin/mysqld_safe</code></p>
<p>æ‰¾åˆ°åï¼Œæ¯”å¦‚å®ƒåœ¨ <code>/usr/local/mysql/bin/mysqld_safe</code>ï¼Œé‚£ä½ è¿™æ ·å¯åŠ¨ MySQL è·³è¿‡æƒé™ï¼š</p>
<pre><code>sudo /usr/local/mysql/bin/mysqld_safe --skip-grant-tables --skip-networking &amp;
</code></pre>
<p>ç„¶å <strong>ç­‰å¾…å‡ ç§’é’Ÿï¼ˆ5-10sï¼‰</strong> å†æ‰§è¡Œï¼š</p>
<pre><code>mysql -uroot
</code></pre>
</blockquote>
<blockquote>
<p>[root@localhost ~]# sudo &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld_safe â€“pid-file&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid &amp;<br>[1] 56721<br>[root@localhost ~]# 2025-07-04T13:53:36.378946Z mysqld_safe Logging to â€˜&#x2F;var&#x2F;log&#x2F;mariadb&#x2F;mariadb.logâ€™.<br>2025-07-04T13:53:36.468224Z mysqld_safe Starting mysqld daemon with databases from &#x2F;var&#x2F;lib&#x2F;mysql</p>
<p>[root@localhost ~]# sudo &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld_safe â€“pid-file&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid &amp;<br>[2] 56935<br>[root@localhost ~]# 2025-07-04T13:53:48.624877Z mysqld_safe Logging to â€˜&#x2F;var&#x2F;log&#x2F;mariadb&#x2F;mariadb.logâ€™.<br>2025-07-04T13:53:48.718002Z mysqld_safe A mysqld process already exists</p>
<p>[2]+  é€€å‡º 1                sudo &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld_safe â€“pid-file&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid<br>[root@localhost ~]# ps aux | grep mysqld<br>root      56721  0.0  0.0 241292   632 pts&#x2F;1    S    21:53   0:00 sudo &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld_safe â€“pid-file&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid<br>root      56723  0.1  0.0 113412   452 pts&#x2F;1    S    21:53   0:00 &#x2F;bin&#x2F;sh &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld_safe â€“pid-file&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid<br>mysql     56861 22.2 18.1 1774388 339036 pts&#x2F;1  Sl   21:53   0:03 &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld â€“basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql â€“datadir&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql â€“plugin-dir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;lib&#x2F;plugin â€“user&#x3D;mysql â€“log-error&#x3D;&#x2F;var&#x2F;log&#x2F;mariadb&#x2F;mariadb.log â€“pid-file&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid â€“socket&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock<br>root      57071  0.0  0.0 112828   988 pts&#x2F;1    S+   21:53   0:00 grep â€“color&#x3D;auto mysqld<br>[root@localhost ~]#</p>
</blockquote>
<h4 id="æ•°æ®åº“ä¿®æ”¹ç­–ç•¥æƒé™ä»¥åŠè®©è¿œç¨‹å®¿ä¸»æœºè¿æ¥"><a href="#æ•°æ®åº“ä¿®æ”¹ç­–ç•¥æƒé™ä»¥åŠè®©è¿œç¨‹å®¿ä¸»æœºè¿æ¥" class="headerlink" title="æ•°æ®åº“ä¿®æ”¹ç­–ç•¥æƒé™ä»¥åŠè®©è¿œç¨‹å®¿ä¸»æœºè¿æ¥"></a>æ•°æ®åº“ä¿®æ”¹ç­–ç•¥æƒé™ä»¥åŠè®©è¿œç¨‹å®¿ä¸»æœºè¿æ¥</h4><blockquote>
<p>mysql -uroot -p</p>
<p>SET GLOBAL validate_password_policy &#x3D; LOW;<br>SET GLOBAL validate_password_length &#x3D; 4;</p>
<p>mysql&gt; GRANT ALL PRIVILEGES ON <em>.</em> TO â€˜rootâ€˜@â€™%â€™ IDENTIFIED BY â€˜rootâ€™ WITH GRANT OPTION;<br>Query OK, 0 rows affected, 1 warning (0.01 sec)</p>
<p>mysql&gt; FLUSH PRIVILEGES;<br>Query OK, 0 rows affected (0.01 sec)</p>
<p>mysql&gt; select user, host from mysql.user where user&#x3D;â€™rootâ€™;<br>+â€”â€”+â€”â€”â€”â€”+<br>| user | host       |<br>+â€”â€”+â€”â€”â€”â€”+<br>| root | %          |<br>| root | 172.17.0.5 |<br>| root | localhost  |<br>+â€”â€”+â€”â€”â€”â€”+<br>3 rows in set (0.00 sec)</p>
</blockquote>
<blockquote>
<p>ä½ ç»™çš„ Spring Boot é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰å¤§è‡´ç»“æ„æ˜¯å¯¹çš„ï¼Œä¸è¿‡ç»“åˆä½ ä¹‹å‰æŠ¥é”™ä¿¡æ¯ï¼ˆMySQL è¿æ¥æ—¶å‡ºç° <span style = "color:red"><code>CommunicationsException</code>ï¼ŒSSLæ¡æ‰‹å¤±è´¥ï¼‰å’Œä½ çš„é…ç½®ï¼Œæœ‰å‡ ç‚¹éœ€è¦ç¡®è®¤å’Œè°ƒæ•´ï¼š</span></p>
<hr>
<h3 id="1-MySQL-è¿æ¥-URL-æ¨èåŠ ä¸Šå‚æ•°ï¼Œå…³é—­-SSL"><a href="#1-MySQL-è¿æ¥-URL-æ¨èåŠ ä¸Šå‚æ•°ï¼Œå…³é—­-SSL" class="headerlink" title="1. MySQL è¿æ¥ URL æ¨èåŠ ä¸Šå‚æ•°ï¼Œå…³é—­ SSL"></a>1. MySQL è¿æ¥ URL æ¨èåŠ ä¸Šå‚æ•°ï¼Œå…³é—­ SSL</h3><p>é»˜è®¤æƒ…å†µä¸‹ MySQL Connector å¯èƒ½ä¼šå°è¯•ç”¨ SSL è¿æ¥ï¼Œè€Œä½ çš„æŠ¥é”™å°±æ˜¯ SSL æ¡æ‰‹å¤±è´¥ï¼š</p>
<pre><code>Caused by: javax.net.ssl.SSLException: Received fatal alert: internal_error
</code></pre>
<p>è§£å†³åŠæ³•æ˜¯åœ¨ URL ä¸­æ˜ç¡®å…³é—­ SSLï¼Œæ”¹æˆï¼š</p>
<pre><code>spring:
  datasource:
    url: jdbc:mysql://192.168.200.129:3306/tensquare_user?characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai
</code></pre>
<ul>
<li><code>useSSL=false</code> å…³é—­ SSL è¿æ¥</li>
<li><code>serverTimezone=Asia/Shanghai</code> è§£å†³æ—¶åŒºè­¦å‘Šï¼ˆå¯é€‰ï¼‰</li>
<li><code>characterEncoding=UTF-8</code> ä¿æŒç¼–ç ä¸€è‡´ï¼ˆæ³¨æ„å¤§å°å†™ï¼‰</li>
</ul>
</blockquote>
<h4 id="å¾®æœåŠ¡æŒç»­é›†æˆ-7-éƒ¨ç½²å‰ç«¯é™æ€webç½‘ç«™"><a href="#å¾®æœåŠ¡æŒç»­é›†æˆ-7-éƒ¨ç½²å‰ç«¯é™æ€webç½‘ç«™" class="headerlink" title="å¾®æœåŠ¡æŒç»­é›†æˆ(7)-éƒ¨ç½²å‰ç«¯é™æ€webç½‘ç«™"></a>å¾®æœåŠ¡æŒç»­é›†æˆ(7)-éƒ¨ç½²å‰ç«¯é™æ€webç½‘ç«™</h4><p>129æœºå™¨è¿›è¡Œnpmå‘½ä»¤æ‰“åŒ… â†’ è¿œç¨‹ä¼ è¾“æ–‡ä»¶ â†’(SSHè¿œç¨‹è°ƒç”¨)â†’ 130ç”Ÿäº§æœåŠ¡å™¨Nginx</p>
<blockquote>
<h4 id="ä¸ºä»€ä¹ˆç”¨-Nginx-è€Œä¸æ˜¯ç›´æ¥ç”¨-Dockerï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆç”¨-Nginx-è€Œä¸æ˜¯ç›´æ¥ç”¨-Dockerï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨ Nginx è€Œä¸æ˜¯ç›´æ¥ç”¨ Dockerï¼Ÿ"></a>ä¸ºä»€ä¹ˆç”¨ Nginx è€Œä¸æ˜¯ç›´æ¥ç”¨ Dockerï¼Ÿ</h4><h5 id="â‘ -Nginx-æ˜¯ä¸“ä¸šçš„é«˜æ€§èƒ½é™æ€æ–‡ä»¶æœåŠ¡å™¨"><a href="#â‘ -Nginx-æ˜¯ä¸“ä¸šçš„é«˜æ€§èƒ½é™æ€æ–‡ä»¶æœåŠ¡å™¨" class="headerlink" title="â‘  Nginx æ˜¯ä¸“ä¸šçš„é«˜æ€§èƒ½é™æ€æ–‡ä»¶æœåŠ¡å™¨"></a>â‘  <strong>Nginx æ˜¯ä¸“ä¸šçš„é«˜æ€§èƒ½é™æ€æ–‡ä»¶æœåŠ¡å™¨</strong></h5><ul>
<li>é€Ÿåº¦å¿«ã€èµ„æºå ç”¨ä½ï¼Œå“åº”è¿…é€Ÿ</li>
<li>æ”¯æŒç¼“å­˜ã€å‹ç¼©ã€è®¿é—®æ§åˆ¶ã€æ—¥å¿—ã€åå‘ä»£ç†ç­‰ä¸°å¯ŒåŠŸèƒ½</li>
<li>æ˜“äºé…ç½®è®¿é—®è·¯å¾„ã€rewriteè§„åˆ™ç­‰</li>
</ul>
<h5 id="â‘¡-Docker-æ˜¯â€œå®¹å™¨åŒ–â€æŠ€æœ¯ï¼Œé€‚åˆè¿è¡Œåº”ç”¨ç¨‹åº"><a href="#â‘¡-Docker-æ˜¯â€œå®¹å™¨åŒ–â€æŠ€æœ¯ï¼Œé€‚åˆè¿è¡Œåº”ç”¨ç¨‹åº" class="headerlink" title="â‘¡ Docker æ˜¯â€œå®¹å™¨åŒ–â€æŠ€æœ¯ï¼Œé€‚åˆè¿è¡Œåº”ç”¨ç¨‹åº"></a>â‘¡ <strong>Docker æ˜¯â€œå®¹å™¨åŒ–â€æŠ€æœ¯ï¼Œé€‚åˆè¿è¡Œåº”ç”¨ç¨‹åº</strong></h5><ul>
<li>Docker è®©ä½ æŠŠåº”ç”¨å’Œè¿è¡Œç¯å¢ƒæ‰“åŒ…ï¼Œé€‚åˆéƒ¨ç½²åŠ¨æ€åº”ç”¨ï¼ˆæ¯”å¦‚åç«¯æœåŠ¡ï¼‰</li>
<li>çº¯é™æ€æ–‡ä»¶æ²¡è¿è¡Œæ—¶ä¾èµ–ï¼Œæ²¡å¿…è¦é¢å¤–ç”¨å®¹å™¨åŒ…è£¹</li>
<li>å¦‚æœç›´æ¥ç”¨ Docker éƒ¨ç½²é™æ€ç½‘ç«™ï¼Œå¾€å¾€æ˜¯æŠŠ Nginx æˆ– Apache è£…åœ¨å®¹å™¨é‡Œï¼Œå†ç”±å®¹å™¨æä¾›é™æ€æœåŠ¡ â€” è¿™å°±å’Œå•çº¯ç”¨ Nginx å·®ä¸å¤šï¼Œåªæ˜¯å¤šäº†å®¹å™¨å±‚</li>
</ul>
</blockquote>
<h5 id="å®‰è£…NginxæœåŠ¡å™¨"><a href="#å®‰è£…NginxæœåŠ¡å™¨" class="headerlink" title="å®‰è£…NginxæœåŠ¡å™¨"></a>å®‰è£…NginxæœåŠ¡å™¨</h5><blockquote>
<p>yum install epel-release<br>yum -y install nginx å®‰è£…</p>
</blockquote>
<p>ä¿®æ”¹nginxçš„ç«¯å£ï¼Œé»˜è®¤80ï¼Œæ”¹ä¸º9090ï¼š</p>
<blockquote>
<p>vi &#x2F;etc&#x2F;nginx&#x2F;nginx.conf</p>
</blockquote>
<pre><code class="yaml"> server &#123;
        listen    9099 default_server;   
        listen    [::]:9099 default_server;     
        server_name  _;
        root       /usr/share/nginx/html;  
</code></pre>
<p>è¿˜éœ€è¦å…³é—­ selinuxï¼Œå°†SELINUX&#x3D;disabled</p>
<blockquote>
<p>setenforce 0                            å…ˆä¸´æ—¶å…³é—­<br><strong>vi &#x2F;etc&#x2F;selinux&#x2F;config</strong>             ç¼–è¾‘æ–‡ä»¶ï¼Œæ°¸ä¹…å…³é—­ SELINUX&#x3D;disabled</p>
</blockquote>
<p>å¯åŠ¨Nginx â˜…â˜…</p>
<blockquote>
<p>systemctl enable nginx è®¾ç½®å¼€æœºå¯åŠ¨<br>systemctl start nginx å¯åŠ¨<br>systemctl stop nginx åœæ­¢<br>systemctl restart nginx é‡å¯<br>systemctl status nginx.service æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</p>
</blockquote>
<p>[Welcome to CentOS] (<a target="_blank" rel="noopener" href="http://192.168.200.130:9099/">http://192.168.200.130:9099/</a>)</p>
<h4 id="åœ¨Jenkinsçš„æœåŠ¡å™¨é‡Œ-å®‰è£…NodeJSæ’ä»¶"><a href="#åœ¨Jenkinsçš„æœåŠ¡å™¨é‡Œ-å®‰è£…NodeJSæ’ä»¶" class="headerlink" title="åœ¨Jenkinsçš„æœåŠ¡å™¨é‡Œ å®‰è£…NodeJSæ’ä»¶"></a>åœ¨Jenkinsçš„æœåŠ¡å™¨é‡Œ å®‰è£…NodeJSæ’ä»¶</h4><p>å‰ç«¯åœ¨æœ¬æœºçš„ä½ç½®ï¼š<code>C:\Users\Pluminary\Desktop\QianDuan\tensquareAdmin</code></p>
<p>Jenkinsé…ç½®NginxæœåŠ¡å™¨<br><code>Dashboard â†’ Manage Jenkins â†’ Tools â†’ NodeJSæ–°å¢</code></p>
<blockquote>
<p>åˆ«åï¼šnodejs12<br>ç‰ˆæœ¬ï¼šNodeJS 12.3.1</p>
</blockquote>
<h6 id="åˆ›å»ºå‰ç«¯æµæ°´çº¿é¡¹ç›®-tensquare-front"><a href="#åˆ›å»ºå‰ç«¯æµæ°´çº¿é¡¹ç›®-tensquare-front" class="headerlink" title="åˆ›å»ºå‰ç«¯æµæ°´çº¿é¡¹ç›® tensquare_front"></a>åˆ›å»ºå‰ç«¯æµæ°´çº¿é¡¹ç›® <code>tensquare_front</code></h6><p>æ·»åŠ ä¸€ä¸ªå‚æ•°<code>This project is parameterized</code> â†’ åç§°branch é»˜è®¤å€¼master<br>åœ¨Jenkinsé‡Œæ‰¾ä¸€ä¸ªå‡­è¯<code>ç‚¹å‡»å³ä¾§zhangsan â†’ æ›´æ–° â†’ å°±ä¼šæ˜¾ç¤ºæœ‰ID </code> å¤åˆ¶åå˜æˆgit_auth</p>
<h6 id="æµæ°´çº¿Pipeline-script"><a href="#æµæ°´çº¿Pipeline-script" class="headerlink" title="æµæ°´çº¿Pipeline script"></a>æµæ°´çº¿<code>Pipeline script</code></h6><pre><code class="yaml">//gitlabå‡­è¯
def git_auth = &quot;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&quot;
node&#123;
    stage(&#39;æ‹‰å–ä»£ç &#39;)&#123;
        checkout scmGit(branches: [[name: &#39;*/$&#123;branch&#125;&#39;]], extensions: [], userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url: &#39;http://192.168.200.132:82/lanyun_group/tensquare_front.git&#39;]])
    &#125;
     stage(&#39;æ‰“åŒ…ï¼Œéƒ¨ç½²ç½‘ç«™&#39;) &#123;
        //ä½¿ç”¨NodeJSçš„npmè¿›è¡Œæ‰“åŒ…
        nodejs(&#39;nodejs12&#39;)&#123;
         sh &#39;&#39;&#39;
             npm install
             npm run build   
        &#39;&#39;&#39;         
        &#125;
     &#125;
     //=====ä»¥ä¸‹ä¸ºè¿œç¨‹è°ƒç”¨è¿›è¡Œé¡¹ç›®éƒ¨ç½²========
     sshPublisher(publishers: [sshPublisherDesc(configName: &#39;master_server&#39;, transfers: [sshTransfer(cleanRemote: false, excludes: &#39;&#39;, execCommand: &#39;&#39;, execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: &#39;[, ]+&#39;, remoteDirectory: &#39;/usr/share/nginx/html&#39;, remoteDirectorySDF: false, removePrefix: &#39;dist&#39;, sourceFiles: &#39;dist/**&#39;)], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])
&#125;
</code></pre>
<p>å»gitlabé‡Œé¢ä¿®æ”¹<code>tensquare_front</code>é‡Œé¢çš„configâ†’<code>prod.env.js</code></p>
<pre><code class="java">&#39;use strict&#39;
module.exports = &#123;
  NODE_ENV: &#39;&quot;production&quot;&#39;,
  // BASE_API: &#39;&quot;http://192.168.207.131:7300/mock/5c0b42c85b4c7508d4dc568c/1024&quot;&#39;
  BASE_API: &#39;&quot;http://192.168.200.130:10020&quot;&#39; // ç®¡ç†å‘˜ç½‘å…³[ç”Ÿäº§]
&#125;
</code></pre>
<p>å»æ„å»ºä¸€ä¸‹ï¼</p>
<p>ç„¶åå»ç”Ÿäº§æœåŠ¡å™¨å¯»æ‰¾</p>
<blockquote>
<p>[root@localhost html]# <code>cd /usr/share/nginx/html</code><br>[root@localhost html]# ll<br>æ€»ç”¨é‡ 80<br>-rw-râ€“râ€“. 1 root root  3650 11æœˆ 11 2022 404.html<br>-rw-râ€“râ€“. 1 root root  3693 11æœˆ 11 2022 50x.html<br>lrwxrwxrwx. 1 root root    20 7æœˆ   5 19:30 en-US -&gt; ..&#x2F;..&#x2F;doc&#x2F;HTML&#x2F;en-US<br>-rw-râ€“râ€“. 1 root root 67646 7æœˆ   5 20:12 favicon.ico<br>drwxr-xr-x. 2 root root    27 7æœˆ   5 19:30 icons<br>lrwxrwxrwx. 1 root root    18 7æœˆ   5 19:30 img -&gt; ..&#x2F;..&#x2F;doc&#x2F;HTML&#x2F;img<br>lrwxrwxrwx. 1 root root    25 7æœˆ   5 19:30 index.html -&gt; ..&#x2F;..&#x2F;doc&#x2F;HTML&#x2F;index.html<br>-rw-râ€“râ€“. 1 root root   368 11æœˆ 11 2022 nginx-logo.png<br>lrwxrwxrwx. 1 root root    14 7æœˆ   5 19:30 poweredby.png -&gt; nginx-logo.png<br>drwxr-xr-x. 6 root root    51 7æœˆ   5 20:12 static<br>[root@localhost html]#</p>
</blockquote>
<p>å›å¤´å†å»è®¿é—®ï¼š<a target="_blank" rel="noopener" href="http://192.168.200.130:9099/">http://192.168.200.130:9099/</a> å·²ç»æˆåŠŸ</p>
<blockquote>
<p>admin  123456</p>
</blockquote>
<p>ç™»å½•è¿›å»æŸ¥çœ‹æ˜¯å¦èƒ½è¿é€šä¹‹å‰åœ¨é•œåƒéƒ¨ç½²çš„å¾®æœåŠ¡åç«¯ï¼ï¼ï¼[ä¸€æ¬¡æˆåŠŸ å®Œç¾ï¼ï¼]</p>
<h4 id="Jenkins-Docker-SpringCloudå¾®æœåŠ¡æŒç»­é›†æˆ-ä¸‹-ä¹‹å‰æ˜¯å•æœºç‰ˆ"><a href="#Jenkins-Docker-SpringCloudå¾®æœåŠ¡æŒç»­é›†æˆ-ä¸‹-ä¹‹å‰æ˜¯å•æœºç‰ˆ" class="headerlink" title="Jenkins+Docker+SpringCloudå¾®æœåŠ¡æŒç»­é›†æˆ(ä¸‹)ä¹‹å‰æ˜¯å•æœºç‰ˆ"></a>Jenkins+Docker+SpringCloudå¾®æœåŠ¡æŒç»­é›†æˆ(ä¸‹)<del>ä¹‹å‰æ˜¯å•æœºç‰ˆ</del></h4><h6 id="ä¸Šé¢éƒ¨ç½²æ–¹æ¡ˆå­˜åœ¨çš„é—®é¢˜ï¼š"><a href="#ä¸Šé¢éƒ¨ç½²æ–¹æ¡ˆå­˜åœ¨çš„é—®é¢˜ï¼š" class="headerlink" title="ä¸Šé¢éƒ¨ç½²æ–¹æ¡ˆå­˜åœ¨çš„é—®é¢˜ï¼š"></a>ä¸Šé¢éƒ¨ç½²æ–¹æ¡ˆå­˜åœ¨çš„é—®é¢˜ï¼š</h6><p>1ï¼‰ä¸€æ¬¡åªèƒ½é€‰æ‹©ä¸€ä¸ªå¾®æœåŠ¡éƒ¨ç½²<br>2ï¼‰åªæœ‰ä¸€å°ç”Ÿäº§è€…éƒ¨ç½²æœåŠ¡å™¨<br>3ï¼‰æ¯ä¸ªå¾®æœåŠ¡åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå®¹é”™ç‡ä½</p>
<h5 id="åˆçº§ç‰ˆå·²å®Œæˆæ¥ä¸‹æ¥æ˜¯ä¸­çº§ç‰ˆæœ¬ï¼ï¼"><a href="#åˆçº§ç‰ˆå·²å®Œæˆæ¥ä¸‹æ¥æ˜¯ä¸­çº§ç‰ˆæœ¬ï¼ï¼" class="headerlink" title="åˆçº§ç‰ˆå·²å®Œæˆæ¥ä¸‹æ¥æ˜¯ä¸­çº§ç‰ˆæœ¬ï¼ï¼"></a>åˆçº§ç‰ˆå·²å®Œæˆæ¥ä¸‹æ¥æ˜¯ä¸­çº§ç‰ˆæœ¬ï¼ï¼</h5><p><img src="https://raw.githubusercontent.com/P-luminary/images/b15e17b4e1423812026358347a2f45e5a23e8bc3/%E6%96%B0%E9%B2%9C%E9%9B%86%E6%88%90%E5%9B%BE2.png"></p>
<p>åœ¨ideaé¡¹ç›®ä¸­å¢åŠ ä¸€å°æ–°çš„æœºå™¨ä½œä¸ºeurekaæ³¨å†Œçš„åœ°æ–¹</p>
<pre><code class="yml">tensquare_gathering/src/main/resources/application.yml
server: 
  port: 9002
spring: 
  application:  
    name: tensquare-gathering #æŒ‡å®šæœåŠ¡å
  datasource:  
    driverClassName: com.mysql.jdbc.Driver
    url: jdbc:mysql://192.168.200.129:3306/tensquare_gathering?characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai
    username: root
    password: root
  jpa: 
    database: mysql
    show-sql: true
#Eurekaå®¢æˆ·ç«¯é…ç½®
eureka:
  client:
    service-url:
      defaultZone: http://192.168.200.130:10086/eureka,http://192.168.200.133:10086/eureka
  instance:
    lease-renewal-interval-in-seconds: 5 # æ¯éš”5ç§’å‘é€ä¸€æ¬¡å¿ƒè·³
    lease-expiration-duration-in-seconds: 10 # 10ç§’ä¸å‘é€å°±è¿‡æœŸ
    prefer-ip-address: true
</code></pre>
<pre><code class="yaml">tensquare_admin_service/src/main/resources/application.yml
server: 
  port: 9001
spring: 
  application:  
    name: tensquare-admin-service #æŒ‡å®šæœåŠ¡å
  datasource:  
    driverClassName: com.mysql.jdbc.Driver
    url: jdbc:mysql://192.168.200.129:3306/tensquare_user?characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai
    username: root
    password: root
  jpa: 
    database: mysql
    show-sql: true

#Eurekaé…ç½®
eureka:
  client:
    service-url:
      defaultZone: http://192.168.200.130:10086/eureka,http://192.168.200.133:10086/eureka
  instance:
    lease-renewal-interval-in-seconds: 5 # æ¯éš”5ç§’å‘é€ä¸€æ¬¡å¿ƒè·³
    lease-expiration-duration-in-seconds: 10 # 10ç§’ä¸å‘é€å°±è¿‡æœŸ
    prefer-ip-address: true


 # jwtå‚æ•°
jwt:
  config:
    key: itcast
    ttl: 1800000
</code></pre>
<pre><code class="yaml">tensquare_zuul/src/main/resources/application.yml
server:
  port: 10020 # ç«¯å£
  
# åŸºæœ¬æœåŠ¡ä¿¡æ¯
spring:
  application:
    name: tensquare-zuul # æœåŠ¡ID
    
# Eurekaé…ç½®
eureka:
  client:
    service-url:  
      defaultZone: http://192.168.200.130:10086/eureka,http://192.168.200.133:10086/eureka
  instance:
    prefer-ip-address: true
  
# ä¿®æ”¹ribbonçš„è¶…æ—¶æ—¶é—´
ribbon:
  ConnectTimeout: 1500 # è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤500ms
  ReadTimeout: 3000  # è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤1000ms
  
  
# ä¿®æ”¹hystrixçš„ç†”æ–­è¶…æ—¶æ—¶é—´
hystrix:
  command:
    default:
      execution:
        isolation:
          thread:
            timeoutInMillisecond: 2000 # ç†”æ–­è¶…æ—¶æ—¶é•¿ï¼Œé»˜è®¤1000ms
            

# ç½‘å…³è·¯ç”±é…ç½®
zuul:
  routes:
    admin:
      path: /admin/**
      serviceId: tensquare-admin-service
    gathering:
          path: /gathering/**
          serviceId: tensquare-gathering

 # jwtå‚æ•°
jwt:
  config:
    key: itcast
    ttl: 1800000
</code></pre>
<pre><code class="yaml">C:\Users\Pluminary\Desktop\HouDuan\tensquare_parent\tensquare_eureka_server\src\main\resources\application.yml
# é›†ç¾¤ç‰ˆ
spring:
  application:
    name: EUREKA-HA

---
server:
  port: 10086
spring:
  # æŒ‡å®šprofile=eureka-server1
  profiles: eureka-server1
eureka:
  instance:
    # æŒ‡å®šå½“profile=eureka-server1æ—¶ï¼Œä¸»æœºåæ˜¯eureka-server1
    hostname: 192.168.66.130
  client:
    service-url:
      # å°†è‡ªå·±æ³¨å†Œåˆ°eureka-server1ã€eureka-server2è¿™ä¸ªEurekaä¸Šé¢å»
      defaultZone: http://192.168.66.130:10086/eureka/,http://192.168.66.133:10086/eureka/

---
server:
  port: 10086
spring:
  profiles: eureka-server2
eureka:
  instance:
    hostname: 192.168.66.132
  client:
    service-url:
      defaultZone: http://192.168.66.130:10086/eureka/,http://192.168.66.133:10086/eureka/
</code></pre>
<p>ç„¶åæ›´æ”¹æäº¤pushåˆ°gitlab</p>
<h4 id="è®¾è®¡Jenkinsé›†ç¾¤é¡¹ç›®çš„æ„å»ºå‚æ•°"><a href="#è®¾è®¡Jenkinsé›†ç¾¤é¡¹ç›®çš„æ„å»ºå‚æ•°" class="headerlink" title="è®¾è®¡Jenkinsé›†ç¾¤é¡¹ç›®çš„æ„å»ºå‚æ•°"></a>è®¾è®¡Jenkinsé›†ç¾¤é¡¹ç›®çš„æ„å»ºå‚æ•°</h4><ul>
<li><p>å®‰è£…Extended Choice Parameteræ’ä»¶<del>æ”¯æŒå¤šé€‰æ¡†</del></p>
</li>
<li><p>æ–°å»ºä¸€ä¸ª<code>tensquare_back_cluster</code>çš„item<br>æµæ°´çº¿é€‰æ‹©piplinâ€¦SCMï¼›gitçš„urlå¡«gitlabé‡Œçš„åç«¯åœ°å€</p>
</li>
<li><p>ç¬¬ä¸€æ­¥å®‰è£…å¥½æ’ä»¶å å°±å¯ä»¥åœ¨<code>This project...</code> ä¸­çœ‹åˆ°<code>Choice Parameter</code><br>å…ˆæ·»åŠ ä¸€ä¸ª<code>String Parameter</code>ï¼šåç§°branch é»˜è®¤å€¼master æè¿°è¯·è¾“å…¥åˆ†æ”¯åç§°</p>
</li>
<li><p>å†æ·»åŠ å‚æ•°é€‰æ‹©å¤šé€‰<code>Extended Choice Parameter</code>ï¼šåç§°project_name æè¿°:è¯·é€‰æ‹©éœ€è¦éƒ¨ç½²çš„å¾®æœåŠ¡ï¼›å‹¾é€‰<code>Basic Parameter Types</code> â†’ Check Boxes â†’ Number of Visble Itemsï¼š4 â†’ Delimiter<code>,</code>(ç”¨é€—å·å»éš”å¼€) â†’ ç‚¹å‡»ä¸‹é¢çš„<code>Choose Source for Value</code> â†’ Valueä¸º<code>tensquare_eureka_server@10086,tensquare_zuul@10020,tensquare_admin_service@9001,tensquare_gathering@9002</code> â†’ ç‚¹å‡»<code>Choose Source for Default Value</code>(é€‰æ‹©é»˜è®¤å€¼)ï¼š<code>tensquare_eureka_server@10086</code> â†’ ç‚¹å‡»<code>ChooseSourceforValueDescription</code>(æè¿°å¤‡æ³¨) Descriptionï¼š<code>æ³¨å†Œä¸­å¿ƒ,æœåŠ¡ç½‘å…³,è®¤è¯ä¸­å¿ƒ,æ´»åŠ¨å¾®æœåŠ¡</code> ğŸ‘‰ åº”ç”¨ä¿å­˜ â†’ æ„å»ºå°±å¯ä»¥çœ‹åˆ°</p>
<p>â˜…â˜… è¯·æ³¨æ„ é…ç½®å¤šé€‰çš„æ—¶å€™ Jenkinsé‚£é‡Œä¸€å®šä¸è¦å¤šåŠ ç©ºæ ¼ä»€ä¹ˆçš„ï¼</p>
</li>
<li><p>æ›´æ–°Jenkinsfileä»£ç </p>
<pre><code class="yaml">//gitå‡­è¯ID
def git_auth = &quot;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&quot;
//gitçš„urlåœ°å€
def git_url = &quot;http://192.168.200.132:82/lanyun_group/tensquare_back.git&quot;
//é•œåƒçš„ç‰ˆæœ¬å·
def tag = &quot;latest&quot;
//Harborçš„urlåœ°å€
def harbor_url = &quot;192.168.200.131:85&quot;
//é•œåƒåº“é¡¹ç›®åç§°
def harbor_project = &quot;tensquare&quot;
//harborçš„ç™»å½•å‡­è¯ID
def harbor_auth = &quot;f83725d3-d5fc-4faf-8ac1-1a56487dfc7b&quot;


node &#123;
    // è·å–å½“å‰é€‰æ‹©çš„é¡¹ç›®åç§° è¦ç”¨é€—å·å»åˆ‡å‰²
    def selectedProjectNames = &quot;$&#123;project_name&#125;&quot;.split(&quot;,&quot;)

   stage(&#39;æ‹‰å–ä»£ç &#39;) &#123;
      checkout scmGit(branches: [[name: &quot;*/$&#123;branch&#125;&quot;]], extensions: [], userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url: &quot;$&#123;git_url&#125;&quot;]])
   &#125;
   stage(&#39;ä»£ç å®¡æŸ¥&#39;) &#123;
      for(int i = 0; i &lt; selectedProjectNames.length; i++)&#123;
          // tensquare_eureka_server@10086
           def projectInfo = selectedProjectNames[i];
          // å½“å‰éå†çš„é¡¹ç›®åç§°
           def currentProjectName = &quot;$&#123;projectInfo&#125;&quot;.split(&quot;@&quot;)[0]
          // å½“å‰éå†çš„é¡¹ç›®ç«¯å£
           def currentProjectPort = &quot;$&#123;projectInfo&#125;&quot;.split(&quot;@&quot;)[1]

          //å®šä¹‰å½“å‰çš„Jenkinsçš„sonarqubeScannerå·¥å…· Jenkinsçš„å…¨å±€Toolsé‡Œ
          def scannerHome = tool &#39;sonar-scanner&#39;
          //å¼•ç”¨å½“å‰JenkinsSonarQubeç¯å¢ƒ Jenkinsçš„Systemé‡Œ
          withSonarQubeEnv(&#39;sonarqube&#39;)&#123;
              // éœ€è¦è¿›å…¥æŸä¸ªé¡¹ç›® åœ¨Jenkinsé€‰æ‹©ä»€ä¹ˆé¡¹ç›®å°±cdä»€ä¹ˆé¡¹ç›®
              sh &quot;&quot;&quot;
                    cd $&#123;currentProjectName&#125;
                    $&#123;scannerHome&#125;/bin/sonar-scanner
                &quot;&quot;&quot;
          &#125;
      &#125;
    &#125;
    stage(&#39;ç¼–è¯‘ï¼Œå®‰è£…å…¬å…±å­å·¥ç¨‹&#39;)&#123;
        sh &quot;mvn -f tensquare_common clean install&quot;
    &#125;
    stage(&#39;ç¼–è¯‘ï¼Œæ‰“åŒ…å¾®æœåŠ¡å·¥ç¨‹&#39;)&#123;
        sh &quot;mvn -f $&#123;project_name&#125; clean package dockerfile:build&quot;
        // å®šä¹‰é•œåƒåç§°
        def imageName = &quot;$&#123;project_name&#125;:$&#123;tag&#125;&quot;

        // å¯¹é•œåƒæ‰“ä¸Šæ ‡ç­¾
        sh &quot;docker tag $&#123;imageName&#125; $&#123;harbor_url&#125;/$&#123;harbor_project&#125;/$&#123;imageName&#125;&quot;

        // æŠŠé•œåƒæ¨é€åˆ°Harbor(è¦ç™»å½• è¾“å…¥è´¦å·å¯†ç  ä¸è¦å†™åœ¨è„šæœ¬æ–‡ä»¶ æŠŠharborè´¦å·å¯†ç ç”¨jenkinså…¨å±€å‡­è¯)
        withCredentials([usernamePassword(credentialsId: &quot;$&#123;harbor_auth&#125;&quot;, passwordVariable: &#39;password&#39;, usernameVariable: &#39;username&#39;)]) &#123;
            // ç™»å½•åˆ°Harbor
            sh &quot;docker login -u $&#123;username&#125; -p  $&#123;password&#125; $&#123;harbor_url&#125;&quot;

            //é•œåƒä¸Šä¼ 
            sh &quot;docker push $&#123;harbor_url&#125;/$&#123;harbor_project&#125;/$&#123;imageName&#125;&quot;

            sh &quot;echo &#39;ğŸ”¥ğŸ”¥é•œåƒä¸Šä¼ æˆåŠŸâœ…âœ…&#39;&quot;
        &#125;
        // éƒ¨ç½²åº”ç”¨ å‘é€å‘½ä»¤è°ƒç”¨ç”Ÿäº§æœåŠ¡å™¨çš„shellè„šæœ¬æ–‡ä»¶ å®Œæˆæ‰€æœ‰çš„å¾®æœåŠ¡é¡¹ç›®éƒ¨ç½²è¡Œä¸º
        // deploy.sh æ˜¯è§¦å‘è¿œç¨‹è„šæœ¬æ–‡ä»¶(é•œåƒæ‹‰å–å’Œå®¹å™¨åˆ›å»ºçš„è¡Œä¸º)
        sshPublisher(publishers: [sshPublisherDesc(configName: &#39;master_server&#39;, transfers: [sshTransfer(cleanRemote: false, excludes: &#39;&#39;, execCommand: &quot;/opt/jenkins_shell/deploy.sh $harbor_url $harbor_project $project_name $tag $port&quot;, execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: &#39;[, ]+&#39;, remoteDirectory: &#39;&#39;, remoteDirectorySDF: false, removePrefix: &#39;&#39;, sourceFiles: &#39;&#39;)], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])
    &#125;
&#125;
</code></pre>
</li>
</ul>
<h4 id="å¤šä¸ªé¡¹ç›®æ‰“åŒ…åŠæ„å»ºä¸Šä¼ é•œåƒ"><a href="#å¤šä¸ªé¡¹ç›®æ‰“åŒ…åŠæ„å»ºä¸Šä¼ é•œåƒ" class="headerlink" title="å¤šä¸ªé¡¹ç›®æ‰“åŒ…åŠæ„å»ºä¸Šä¼ é•œåƒ"></a>å¤šä¸ªé¡¹ç›®æ‰“åŒ…åŠæ„å»ºä¸Šä¼ é•œåƒ</h4><ul>
<li>æ›´æ–°Jenkinsfileæ–‡ä»¶</li>
</ul>
<pre><code class="yaml">//gitå‡­è¯ID
def git_auth = &quot;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&quot;
//gitçš„urlåœ°å€
def git_url = &quot;http://192.168.200.132:82/lanyun_group/tensquare_back.git&quot;
//é•œåƒçš„ç‰ˆæœ¬å·
def tag = &quot;latest&quot;
//Harborçš„urlåœ°å€
def harbor_url = &quot;192.168.200.131:85&quot;
//é•œåƒåº“é¡¹ç›®åç§°
def harbor_project = &quot;tensquare&quot;
//harborçš„ç™»å½•å‡­è¯ID
def harbor_auth = &quot;f83725d3-d5fc-4faf-8ac1-1a56487dfc7b&quot;


node &#123;
    // è·å–å½“å‰é€‰æ‹©çš„é¡¹ç›®åç§° è¦ç”¨é€—å·å»åˆ‡å‰²
    def selectedProjectNames = &quot;$&#123;project_name&#125;&quot;.split(&quot;,&quot;)

   stage(&#39;æ‹‰å–ä»£ç &#39;) &#123;
      checkout scmGit(branches: [[name: &quot;*/$&#123;branch&#125;&quot;]], extensions: [], userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url: &quot;$&#123;git_url&#125;&quot;]])
   &#125;
   stage(&#39;ä»£ç å®¡æŸ¥&#39;) &#123;
      for(int i=0;i&lt;selectedProjectNames.length;i++)&#123;
          // tensquare_eureka_server@10086
           def projectInfo = selectedProjectNames[i];
          // å½“å‰éå†çš„é¡¹ç›®åç§°
           def currentProjectName = &quot;$&#123;projectInfo&#125;&quot;.split(&quot;@&quot;)[0]
          // å½“å‰éå†çš„é¡¹ç›®ç«¯å£
           def currentProjectPort = &quot;$&#123;projectInfo&#125;&quot;.split(&quot;@&quot;)[1]

          //å®šä¹‰å½“å‰çš„Jenkinsçš„sonarqubeScannerå·¥å…· Jenkinsçš„å…¨å±€Toolsé‡Œ
          def scannerHome = tool &#39;sonar-scanner&#39;
          //å¼•ç”¨å½“å‰JenkinsSonarQubeç¯å¢ƒ Jenkinsçš„Systemé‡Œ
          withSonarQubeEnv(&#39;sonarqube&#39;)&#123;
              // éœ€è¦è¿›å…¥æŸä¸ªé¡¹ç›® åœ¨Jenkinsé€‰æ‹©ä»€ä¹ˆé¡¹ç›®å°±cdä»€ä¹ˆé¡¹ç›®
              sh &quot;&quot;&quot;
                    cd $&#123;currentProjectName&#125;
                    $&#123;scannerHome&#125;/bin/sonar-scanner
                &quot;&quot;&quot;
          &#125;
      &#125;
    &#125;
    stage(&#39;ç¼–è¯‘ï¼Œå®‰è£…å…¬å…±å­å·¥ç¨‹&#39;)&#123;
        sh &quot;mvn -f tensquare_common clean install&quot;
    &#125;
    stage(&#39;ç¼–è¯‘ï¼Œæ‰“åŒ…å¾®æœåŠ¡å·¥ç¨‹ï¼Œä¸Šä¼ é•œåƒ&#39;) &#123;
        for (int i = 0; i &lt; selectedProjectNames.length; i++) &#123;
            //tensquare_eureka_server@10086
            def projectInfo = selectedProjectNames[i];
            //å½“å‰éå†çš„é¡¹ç›®åç§°
            def currentProjectName = &quot;$&#123;projectInfo&#125;&quot;.split(&quot;@&quot;)[0]
            //å½“å‰éå†çš„é¡¹ç›®ç«¯å£
            def currentProjectPort = &quot;$&#123;projectInfo&#125;&quot;.split(&quot;@&quot;)[1]

            sh &quot;mvn -f $&#123;currentProjectName&#125; clean package dockerfile:build&quot;

            //å®šä¹‰é•œåƒåç§°
            def imageName = &quot;$&#123;currentProjectName&#125;:$&#123;tag&#125;&quot;

            // å¯¹é•œåƒæ‰“ä¸Šæ ‡ç­¾
            sh &quot;docker tag $&#123;imageName&#125; $&#123;harbor_url&#125;/$&#123;harbor_project&#125;/$&#123;imageName&#125;&quot;

            // æŠŠé•œåƒæ¨é€åˆ°Harbor(è¦ç™»å½• è¾“å…¥è´¦å·å¯†ç  ä¸è¦å†™åœ¨è„šæœ¬æ–‡ä»¶ æŠŠharborè´¦å·å¯†ç ç”¨jenkinså…¨å±€å‡­è¯)
            withCredentials([usernamePassword(credentialsId: &quot;$&#123;harbor_auth&#125;&quot;, passwordVariable: &#39;password&#39;, usernameVariable: &#39;username&#39;)]) &#123;
                // ç™»å½•åˆ°Harbor
                sh &quot;docker login -u $&#123;username&#125; -p  $&#123;password&#125; $&#123;harbor_url&#125;&quot;

                //é•œåƒä¸Šä¼ 
                sh &quot;docker push $&#123;harbor_url&#125;/$&#123;harbor_project&#125;/$&#123;imageName&#125;&quot;

                sh &quot;echo &#39;ğŸ”¥ğŸ”¥é•œåƒä¸Šä¼ æˆåŠŸâœ…âœ…&#39;&quot;
            &#125;
            // éƒ¨ç½²åº”ç”¨ å‘é€å‘½ä»¤è°ƒç”¨ç”Ÿäº§æœåŠ¡å™¨çš„shellè„šæœ¬æ–‡ä»¶ å®Œæˆæ‰€æœ‰çš„å¾®æœåŠ¡é¡¹ç›®éƒ¨ç½²è¡Œä¸º
            // deploy.sh æ˜¯è§¦å‘è¿œç¨‹è„šæœ¬æ–‡ä»¶(é•œåƒæ‹‰å–å’Œå®¹å™¨åˆ›å»ºçš„è¡Œä¸º)
            sshPublisher(publishers: [sshPublisherDesc(configName: &#39;master_server&#39;, transfers: [sshTransfer(cleanRemote: false, excludes: &#39;&#39;, execCommand: &quot;/opt/jenkins_shell/deploy.sh $harbor_url $harbor_project $project_name $tag $port&quot;, execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: &#39;[, ]+&#39;, remoteDirectory: &#39;&#39;, remoteDirectorySDF: false, removePrefix: &#39;&#39;, sourceFiles: &#39;&#39;)], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])
        &#125;
    &#125;
&#125;
</code></pre>
<h4 id="æŠŠEurekaæ³¨å†Œä¸­å¿ƒé›†ç¾¤éƒ¨ç½²åˆ°å¤šå°æœåŠ¡å™¨"><a href="#æŠŠEurekaæ³¨å†Œä¸­å¿ƒé›†ç¾¤éƒ¨ç½²åˆ°å¤šå°æœåŠ¡å™¨" class="headerlink" title="æŠŠEurekaæ³¨å†Œä¸­å¿ƒé›†ç¾¤éƒ¨ç½²åˆ°å¤šå°æœåŠ¡å™¨"></a>æŠŠEurekaæ³¨å†Œä¸­å¿ƒé›†ç¾¤éƒ¨ç½²åˆ°å¤šå°æœåŠ¡å™¨</h4><p><code>Dashboard â†’ Manage Jenkins â†’ ä¸‹é¢çš„SSH Server â†’ å¢åŠ ä¸€å°133çš„æœºå™¨</code><br>æµ‹è¯•ä¹‹å‰éœ€è¦æŠŠJenkinsæœåŠ¡çš„å…¬é’¥æ‹·è´åˆ°133ä¸Šé¢</p>
<blockquote>
<p>åœ¨Jenkinsçš„129æœºå™¨<br>[root@localhost ~]# ssh-copy-id 192.168.200.133    [Product_slave]</p>
</blockquote>
<blockquote>
<p>SSH Serverâ†’ã€åº”ç”¨+Saveã€‘<br>Nameï¼šslave_server<br>Hostnameï¼š192.168.200.133<br>Usernameï¼šroot<br>Remote Directoryï¼š&#x2F;</p>
</blockquote>
<p>ç»§ç»­åœ¨Jenkinsçš„<code>tensquare_back_cluster</code>ä¸­çš„<code>Configure</code>çš„<code>Extended Choice Parameter</code>çš„ä¸‹é¢<code>æ·»åŠ å‚æ•°</code> â†’ ç»§ç»­æ·»åŠ <code>Extended Choice Parameter</code> â†’ åœ¨é‡Œé¢ç»§ç»­æ·»åŠ <code>Nameï¼špublish_server;Descriptionï¼šè¯·é€‰æ‹©éœ€è¦éƒ¨ç½²çš„æœåŠ¡å™¨</code> â†’ å‹¾é€‰<code>Basic Parameter Types</code>, <code>Parameter Typeï¼šCheck Boxes</code> â†’ <code>Number of Visible Itemsï¼š2</code>, <code>Delimiterï¼š,</code> ä¸‹é¢çš„<code>Choose Source for Value</code> â†’ <code>Valueï¼šmaster_server,slave_server</code> â†’ ä¸‹é¢çš„<code>Default Valueï¼šmaster_server</code> â†’ ä¸‹é¢çš„<code>Descriptionï¼šä¸»èŠ‚ç‚¹,ä»èŠ‚ç‚¹</code> â†’ åº”ç”¨+Save</p>
<ul>
<li>æ›´æ–°äº†<code>Jenkinsfile</code>æ–‡ä»¶</li>
</ul>
<pre><code class="yaml">//gitå‡­è¯ID
def git_auth = &quot;ca22e56f-0ecc-4fdc-965d-01e329a0b68a&quot;
//gitçš„urlåœ°å€
def git_url = &quot;http://192.168.200.132:82/lanyun_group/tensquare_back.git&quot;
//é•œåƒçš„ç‰ˆæœ¬å·
def tag = &quot;latest&quot;
//Harborçš„urlåœ°å€
def harbor_url = &quot;192.168.200.131:85&quot;
//é•œåƒåº“é¡¹ç›®åç§°
def harbor_project = &quot;tensquare&quot;
//harborçš„ç™»å½•å‡­è¯ID
def harbor_auth = &quot;f83725d3-d5fc-4faf-8ac1-1a56487dfc7b&quot;


node &#123;
    // è·å–å½“å‰é€‰æ‹©çš„é¡¹ç›®åç§° è¦ç”¨é€—å·å»åˆ‡å‰²
    def selectedProjectNames = &quot;$&#123;project_name&#125;&quot;.split(&quot;,&quot;)
    // è·å–å½“å‰é€‰æ‹©çš„æœåŠ¡å™¨åç§°
    def selectedServers = &quot;$&#123;publish_server&#125;&quot;.split(&quot;,&quot;)

   stage(&#39;æ‹‰å–ä»£ç &#39;) &#123;
      checkout scmGit(branches: [[name: &quot;*/$&#123;branch&#125;&quot;]], extensions: [], userRemoteConfigs: [[credentialsId: &quot;$&#123;git_auth&#125;&quot;, url: &quot;$&#123;git_url&#125;&quot;]])
   &#125;
   stage(&#39;ä»£ç å®¡æŸ¥&#39;) &#123;
      for(int i=0;i&lt;selectedProjectNames.length;i++)&#123;
          // tensquare_eureka_server@10086
           def projectInfo = selectedProjectNames[i];
          // å½“å‰éå†çš„é¡¹ç›®åç§°
           def currentProjectName = &quot;$&#123;projectInfo&#125;&quot;.split(&quot;@&quot;)[0]
          // å½“å‰éå†çš„é¡¹ç›®ç«¯å£
           def currentProjectPort = &quot;$&#123;projectInfo&#125;&quot;.split(&quot;@&quot;)[1]

          //å®šä¹‰å½“å‰çš„Jenkinsçš„sonarqubeScannerå·¥å…· Jenkinsçš„å…¨å±€Toolsé‡Œ
          def scannerHome = tool &#39;sonar-scanner&#39;
          //å¼•ç”¨å½“å‰JenkinsSonarQubeç¯å¢ƒ Jenkinsçš„Systemé‡Œ
          withSonarQubeEnv(&#39;sonarqube&#39;)&#123;
              // éœ€è¦è¿›å…¥æŸä¸ªé¡¹ç›® åœ¨Jenkinsé€‰æ‹©ä»€ä¹ˆé¡¹ç›®å°±cdä»€ä¹ˆé¡¹ç›®
              sh &quot;&quot;&quot;
                    cd $&#123;currentProjectName&#125;
                    $&#123;scannerHome&#125;/bin/sonar-scanner
                &quot;&quot;&quot;
          &#125;
      &#125;
    &#125;
    stage(&#39;ç¼–è¯‘ï¼Œå®‰è£…å…¬å…±å­å·¥ç¨‹&#39;)&#123;
        sh &quot;mvn -f tensquare_common clean install&quot;
    &#125;
    stage(&#39;ç¼–è¯‘ï¼Œæ‰“åŒ…å¾®æœåŠ¡å·¥ç¨‹ï¼Œä¸Šä¼ é•œåƒ&#39;) &#123;
        for (int i = 0; i &lt; selectedProjectNames.length; i++) &#123;
            //tensquare_eureka_server@10086
            def projectInfo = selectedProjectNames[i];
            //å½“å‰éå†çš„é¡¹ç›®åç§°
            def currentProjectName = &quot;$&#123;projectInfo&#125;&quot;.split(&quot;@&quot;)[0]
            //å½“å‰éå†çš„é¡¹ç›®ç«¯å£
            def currentProjectPort = &quot;$&#123;projectInfo&#125;&quot;.split(&quot;@&quot;)[1]

            sh &quot;mvn -f $&#123;currentProjectName&#125; clean package dockerfile:build&quot;

            //å®šä¹‰é•œåƒåç§°
            def imageName = &quot;$&#123;currentProjectName&#125;:$&#123;tag&#125;&quot;

            // å¯¹é•œåƒæ‰“ä¸Šæ ‡ç­¾
            sh &quot;docker tag $&#123;imageName&#125; $&#123;harbor_url&#125;/$&#123;harbor_project&#125;/$&#123;imageName&#125;&quot;

            // æŠŠé•œåƒæ¨é€åˆ°Harbor(è¦ç™»å½• è¾“å…¥è´¦å·å¯†ç  ä¸è¦å†™åœ¨è„šæœ¬æ–‡ä»¶ æŠŠharborè´¦å·å¯†ç ç”¨jenkinså…¨å±€å‡­è¯)
            withCredentials([usernamePassword(credentialsId: &quot;$&#123;harbor_auth&#125;&quot;, passwordVariable: &#39;password&#39;, usernameVariable: &#39;username&#39;)]) &#123;
                // ç™»å½•åˆ°Harbor
                sh &quot;docker login -u $&#123;username&#125; -p  $&#123;password&#125; $&#123;harbor_url&#125;&quot;

                //é•œåƒä¸Šä¼ 
                sh &quot;docker push $&#123;harbor_url&#125;/$&#123;harbor_project&#125;/$&#123;imageName&#125;&quot;

                sh &quot;echo &#39;ğŸ”¥ğŸ”¥é•œåƒä¸Šä¼ æˆåŠŸâœ…âœ…&#39;&quot;
            &#125;
            //éå†æ‰€æœ‰æœåŠ¡å™¨ï¼Œåˆ†åˆ«éƒ¨ç½²
            for (int j = 0; j &lt; selectedServers.length; j++) &#123;
                //è·å–å½“å‰éå†çš„æœåŠ¡å™¨åç§°
                def currentServerName = selectedServers[j]

                //åŠ ä¸Šçš„å‚æ•°æ ¼å¼ï¼š--spring.profiles.active=eureka-server1/eureka-server2
                def activeProfile = &quot;--spring.profiles.active=&quot;

                //æ ¹æ®ä¸åŒçš„æœåŠ¡åç§°æ¥è¯»å–ä¸åŒçš„Eurekaé…ç½®ä¿¡æ¯
                if (currentServerName == &quot;master_server&quot;) &#123;
                    activeProfile = activeProfile + &quot;eureka-server1&quot;
                &#125; else if (currentServerName == &quot;slave_server&quot;) &#123;
                    activeProfile = activeProfile + &quot;eureka-server2&quot;
                &#125;

                // éƒ¨ç½²åº”ç”¨ å‘é€å‘½ä»¤è°ƒç”¨ç”Ÿäº§æœåŠ¡å™¨çš„shellè„šæœ¬æ–‡ä»¶ å®Œæˆæ‰€æœ‰çš„å¾®æœåŠ¡é¡¹ç›®éƒ¨ç½²è¡Œä¸º
                // deploy.sh æ˜¯è§¦å‘è¿œç¨‹è„šæœ¬æ–‡ä»¶(é•œåƒæ‹‰å–å’Œå®¹å™¨åˆ›å»ºçš„è¡Œä¸º)
                sshPublisher(publishers: [sshPublisherDesc(configName: &quot;$&#123;currentServerName&#125;&quot;, transfers: [sshTransfer(cleanRemote: false, excludes: &#39;&#39;, execCommand: &quot;/opt/jenkins_shell/deployCluster.sh $harbor_url $harbor_project $currentProjectName $tag $currentProjectPort $activeProfile&quot;, execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: &#39;[, ]+&#39;, remoteDirectory: &#39;&#39;, remoteDirectorySDF: false, removePrefix: &#39;&#39;, sourceFiles: &#39;&#39;)], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
<ul>
<li>å°†ä¹‹å‰çš„<code>deploy.sh</code>æ¢æˆäº†<code>deployCluster.sh</code></li>
</ul>
<pre><code class="yaml">#! /bin/sh
#æ¥æ”¶å¤–éƒ¨å‚æ•°
harbor_url=$1
harbor_project_name=$2
project_name=$3
tag=$4
port=$5
profile=$6

imageName=$harbor_url/$harbor_project_name/$project_name:$tag

echo &quot;$imageName&quot;

#æŸ¥è¯¢å®¹å™¨æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™åˆ é™¤
containerId=`docker ps -a | grep -w $&#123;project_name&#125;:$&#123;tag&#125;  | awk &#39;&#123;print $1&#125;&#39;`

if [ &quot;$containerId&quot; !=  &quot;&quot; ] ; then
    #åœæ‰å®¹å™¨
    docker stop $containerId

    #åˆ é™¤å®¹å™¨
    docker rm $containerId
    
    echo &quot;æˆåŠŸåˆ é™¤å®¹å™¨&quot;
fi

#æŸ¥è¯¢é•œåƒæ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™åˆ é™¤
imageId=`docker images | grep -w $project_name  | awk &#39;&#123;print $3&#125;&#39;`

if [ &quot;$imageId&quot; !=  &quot;&quot; ] ; then
      
    #åˆ é™¤é•œåƒ
    docker rmi -f $imageId
    
    echo &quot;æˆåŠŸåˆ é™¤é•œåƒ&quot;
fi

# ç™»å½•Harbor
docker login -u eric -p Eric123456 $harbor_url

# ä¸‹è½½é•œåƒ
docker pull $imageName

# å¯åŠ¨å®¹å™¨
docker run -di -p $port:$port $imageName $profile

echo &quot;å®¹å™¨å¯åŠ¨æˆåŠŸ&quot;
</code></pre>
<ul>
<li><p>master_server,slave_serverå°†130ç”Ÿäº§çš„æœºå™¨<code>masteræœºå™¨</code>é‡Œ æ”¾å…¥<code>deployCluster.sh</code> æ˜¯åœ¨è¿™ä¸ªç›®å½•<code>/opt/jenkins_shell/</code>é‡Œé¢<br>ç„¶ååŠ ä¸Šæƒé™</p>
<blockquote>
<p>[root@localhost ~]# <code>cd /opt/jenkins_shell/</code><br>[root@localhost jenkins_shell]# <code>chmod +x deployCluster.sh</code></p>
</blockquote>
</li>
<li><p>ç„¶ååœ¨133æœºå™¨ä¸Š<code>slaveæœºå™¨</code> æŒ‰ç…§ä¸Šä¸€æ­¥çš„æ“ä½œæ‹–è¿›å» ç„¶ååŠ å…¥æƒé™</p>
<blockquote>
<p>[root@localhost ~]# <code>cd /opt/jenkins_shell/</code><br>[root@localhost jenkins_shell]# <code>chmod +x deployCluster.sh</code></p>
</blockquote>
</li>
</ul>
<p>[Eureka] (<a target="_blank" rel="noopener" href="http://192.168.200.130:10086/">http://192.168.200.130:10086/</a>) + [Eureka] (<a target="_blank" rel="noopener" href="http://192.168.200.133:10086/">http://192.168.200.133:10086/</a>)</p>
<ul>
<li><p>ç„¶åå†å»æŠŠå‰©ä¸‹çš„éƒ½æ„å»ºäº†</p>
<blockquote>
<h4 id="project-name"><a href="#project-name" class="headerlink" title="project_name"></a>project_name</h4><p>è¯·é€‰æ‹©éœ€è¦éƒ¨ç½²çš„å¾®æœåŠ¡</p>
<table>
<thead>
<tr>
<th>æ³¨å†Œä¸­å¿ƒ</th>
</tr>
</thead>
<tbody><tr>
<td>æœåŠ¡ç½‘å…³</td>
</tr>
<tr>
<td>è®¤è¯ä¸­å¿ƒ</td>
</tr>
<tr>
<td>æ´»åŠ¨å¾®æœåŠ¡</td>
</tr>
</tbody></table>
<h4 id="publish-server"><a href="#publish-server" class="headerlink" title="publish_server"></a>publish_server</h4><p>è¯·é€‰æ‹©éœ€è¦éƒ¨ç½²çš„æœåŠ¡å™¨</p>
<table>
<thead>
<tr>
<th>ä¸»èŠ‚ç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td>ä»èŠ‚ç‚¹</td>
</tr>
</tbody></table>
</blockquote>
</li>
</ul>
<h4 id="Nginx-Zuulé›†ç¾¤å®ç°é«˜å¯ç”¨ç½‘å…³"><a href="#Nginx-Zuulé›†ç¾¤å®ç°é«˜å¯ç”¨ç½‘å…³" class="headerlink" title="Nginx + Zuulé›†ç¾¤å®ç°é«˜å¯ç”¨ç½‘å…³"></a>Nginx + Zuulé›†ç¾¤å®ç°é«˜å¯ç”¨ç½‘å…³</h4><p><img src="https://raw.githubusercontent.com/P-luminary/images/d0f70a9927ff44bf814b318e0c7211a8e0bdbce6/Nginx%20+%20Zuul%E9%9B%86%E7%BE%A4%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8%E7%BD%91%E5%85%B3.png"></p>
<h5 id="æ›´æ”¹133çš„nginxé…ç½®"><a href="#æ›´æ”¹133çš„nginxé…ç½®" class="headerlink" title="æ›´æ”¹133çš„nginxé…ç½®"></a>æ›´æ”¹133çš„nginxé…ç½®</h5><p><code>vi /etc/nginx/nginx.conf</code></p>
<pre><code class="yaml">user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

include /usr/share/nginx/modules/*.conf;

events &#123;
    worker_connections 1024;
&#125;

http &#123;
    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 4096;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    include /etc/nginx/conf.d/*.conf;

    ### æ–°å¢è´Ÿè½½å‡è¡¡é…ç½®
    upstream zuulServer &#123;
        server 192.168.200.130:10020 weight=1;
        server 192.168.200.133:10020 weight=1;
    &#125;

    server &#123;
        listen       85 default_server;
        listen       [::]:85 default_server;
        server_name  _;Â·
        root         /usr/share/nginx/html;

        include /etc/nginx/default.d/*.conf;

        location / &#123;
            proxy_pass http://zuulServer/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        &#125;

        error_page 404 /404.html;
        location = /404.html &#123;
        &#125;

        error_page 500 502 503 504 /50x.html;
        location = /50x.html &#123;
        &#125;
    &#125;
&#125;
</code></pre>
<p>é‡å¯Nginxï¼š<code>systemctl restart nginx</code><br>ä¿®æ”¹å‰ç«¯Nginxçš„è®¿é—®åœ°å€tensquare_front â†’ config â†’ <code>prod.env.js</code></p>
<pre><code class="yaml">&#39;use strict&#39;
module.exports = &#123;
  NODE_ENV: &#39;&quot;production&quot;&#39;,
  // BASE_API: &#39;&quot;http://192.168.207.131:7300/mock/5c0b42c85b4c7508d4dc568c/1024&quot;&#39;
  BASE_API: &#39;&quot;http://192.168.200.133:85&quot;&#39; // ç®¡ç†å‘˜ç½‘å…³
&#125;
</code></pre>
<h3 id="åŸºäºKubernetes-x2F-K8Sæ„å»ºJenkinsæŒç»­é›†æˆå¹³å°-ä¸Š"><a href="#åŸºäºKubernetes-x2F-K8Sæ„å»ºJenkinsæŒç»­é›†æˆå¹³å°-ä¸Š" class="headerlink" title="åŸºäºKubernetes&#x2F;K8Sæ„å»ºJenkinsæŒç»­é›†æˆå¹³å°(ä¸Š)"></a>åŸºäºKubernetes&#x2F;K8Sæ„å»ºJenkinsæŒç»­é›†æˆå¹³å°(ä¸Š)</h3><h5 id="Jenkinsçš„Master-Slaveåˆ†å¸ƒå¼æ„å»º"><a href="#Jenkinsçš„Master-Slaveåˆ†å¸ƒå¼æ„å»º" class="headerlink" title="Jenkinsçš„Master-Slaveåˆ†å¸ƒå¼æ„å»º"></a>Jenkinsçš„Master-Slaveåˆ†å¸ƒå¼æ„å»º</h5><h6 id="ä»€ä¹ˆæ˜¯Master-Slaveåˆ†å¸ƒå¼æ„å»º"><a href="#ä»€ä¹ˆæ˜¯Master-Slaveåˆ†å¸ƒå¼æ„å»º" class="headerlink" title="ä»€ä¹ˆæ˜¯Master-Slaveåˆ†å¸ƒå¼æ„å»º"></a>ä»€ä¹ˆæ˜¯Master-Slaveåˆ†å¸ƒå¼æ„å»º</h6><p>Jenkinsçš„Master-Slaveåˆ†å¸ƒå¼æ„å»ºï¼Œå°±æ˜¯é€šè¿‡å°†æ„å»ºè¿‡ç¨‹åˆ†é…åˆ°ä»å±SlaveèŠ‚ç‚¹ä¸Šï¼Œä»è€Œå‡è½»MasterèŠ‚ ç‚¹çš„å‹åŠ›ï¼Œè€Œä¸”å¯ä»¥åŒæ—¶æ„å»ºå¤šä¸ªï¼Œæœ‰ç‚¹ç±»ä¼¼è´Ÿè½½å‡è¡¡çš„æ¦‚å¿µã€‚</p>
<h6 id="å¦‚ä½•å®ç°Master-Slaveåˆ†å¸ƒå¼æ„å»º"><a href="#å¦‚ä½•å®ç°Master-Slaveåˆ†å¸ƒå¼æ„å»º" class="headerlink" title="å¦‚ä½•å®ç°Master-Slaveåˆ†å¸ƒå¼æ„å»º"></a>å¦‚ä½•å®ç°Master-Slaveåˆ†å¸ƒå¼æ„å»º</h6><ul>
<li><p>å¼€å¯ä»£ç†ç¨‹åºçš„TCPç«¯å£<code>Dashboard â†’ Manage Jenkins â†’ Security â†’ ä»£ç†ï¼šéšæœºé€‰å–</code></p>
</li>
<li><p>æ–°å»ºèŠ‚ç‚¹ <code>Dashboard â†’ Manage Jenkins â†’ Nodes â†’ New node â†’ èŠ‚ç‚¹åç§°: slave1  å‹¾é€‰Permanent Agent â†’ create </code> â†’ æˆ‘çš„Jenkinsä¸»èŠ‚ç‚¹åœ¨101æœºå™¨ï¼Œä»èŠ‚ç‚¹å°±æ”¾åœ¨102æœºå™¨å§ â†’ å»102æœºå™¨<code>cd /rootï¼› mkdir jenkins</code>  â†’ è¿œç¨‹å·¥ä½œç›®å½•ï¼š<code>/root/jenkins</code> â†’ ç”¨æ³•ï¼›å¯åŠ¨æ–¹å¼ï¼›å¯ç”¨æ€§éƒ½æ˜¯é»˜è®¤ç¬¬ä¸€ä¸ª â†’ ç‚¹è¿›å»åˆšåˆšåˆ›å»ºçš„slave â†’â†“</p>
<pre><code class="yaml">Run from agent command line: (Unix) 
# ä¸‹è½½agent.jar
curl -sO http://192.168.200.133:8888/jnlpJars/agent.jar

java -jar agent.jar -url http://192.168.200.129:8888/ -secret 85f68f679a60139d7867571d577299c3c7d10f913acfca589bb0b9018b86e14d -name slave1 -webSocket -workDir &quot;/root/jenkins&quot;
</code></pre>
<p>æƒ³è¦è¿™ä¸ª éœ€è¦ä¸‹è½½ä¸ªagent.jaråŒ…ä¼ åˆ°102çš„&#x2F;rootæœºå™¨ä¸­</p>
</li>
</ul>
<blockquote>
<h2 id="âœ…-æœ€ç®€å•è§£å†³æ–¹æ¡ˆï¼ˆæ¨èï¼‰"><a href="#âœ…-æœ€ç®€å•è§£å†³æ–¹æ¡ˆï¼ˆæ¨èï¼‰" class="headerlink" title="âœ… æœ€ç®€å•è§£å†³æ–¹æ¡ˆï¼ˆæ¨èï¼‰"></a>âœ… æœ€ç®€å•è§£å†³æ–¹æ¡ˆï¼ˆæ¨èï¼‰</h2><h3 id="âœ…-æ–¹æ¡ˆä¸€ï¼šä»-Jenkins-ä¸»æœºä¸Šä¸‹è½½ï¼Œå†ç”¨-SCP-å¤åˆ¶åˆ°-agent-æœºå™¨"><a href="#âœ…-æ–¹æ¡ˆä¸€ï¼šä»-Jenkins-ä¸»æœºä¸Šä¸‹è½½ï¼Œå†ç”¨-SCP-å¤åˆ¶åˆ°-agent-æœºå™¨" class="headerlink" title="âœ… æ–¹æ¡ˆä¸€ï¼šä» Jenkins ä¸»æœºä¸Šä¸‹è½½ï¼Œå†ç”¨ SCP å¤åˆ¶åˆ° agent æœºå™¨"></a>âœ… <strong>æ–¹æ¡ˆä¸€ï¼šä» Jenkins ä¸»æœºä¸Šä¸‹è½½ï¼Œå†ç”¨ SCP å¤åˆ¶åˆ° agent æœºå™¨</strong></h3><p>åœ¨ Jenkins ä¸»æœºï¼ˆ192.168.200.129ï¼‰ä¸Šæ‰§è¡Œï¼š</p>
<pre><code>curl -sO http://localhost:8888/jnlpJars/agent.jar
</code></pre>
<p>ç„¶åä»ä¸»æœº <strong>scp åˆ° 192.168.200.133</strong>ï¼š</p>
<pre><code>scp agent.jar root@192.168.200.133:/root/
</code></pre>
<p>ç™»å½•å¯†ç æˆ–é…ç½®äº†å…å¯†éƒ½è¡Œã€‚</p>
</blockquote>
<h3 id="Kuberneteså®ç°Master-Slaveåˆ†å¸ƒå¼æ„å»ºæ–¹æ¡ˆ"><a href="#Kuberneteså®ç°Master-Slaveåˆ†å¸ƒå¼æ„å»ºæ–¹æ¡ˆ" class="headerlink" title="Kuberneteså®ç°Master-Slaveåˆ†å¸ƒå¼æ„å»ºæ–¹æ¡ˆ"></a><span style = "color:red">Kuberneteså®ç°Master-Slaveåˆ†å¸ƒå¼æ„å»ºæ–¹æ¡ˆ</span></h3><h5 id="ä¼ ç»ŸJenkinsçš„Master-Slaveæ–¹æ¡ˆçš„ç¼ºé™·"><a href="#ä¼ ç»ŸJenkinsçš„Master-Slaveæ–¹æ¡ˆçš„ç¼ºé™·" class="headerlink" title="ä¼ ç»ŸJenkinsçš„Master-Slaveæ–¹æ¡ˆçš„ç¼ºé™·"></a>ä¼ ç»ŸJenkinsçš„Master-Slaveæ–¹æ¡ˆçš„ç¼ºé™·</h5><ul>
<li>Master æ¯ä¸ª èŠ‚ç‚¹å‘ç”Ÿå•ç‚¹æ•…éšœæ—¶ï¼Œæ•´ä¸ªæµç¨‹éƒ½ä¸å¯ç”¨äº† </li>
<li>SlaveèŠ‚ç‚¹çš„é…ç½®ç¯å¢ƒä¸ä¸€æ ·ï¼Œæ¥å®Œæˆä¸åŒè¯­è¨€çš„ç¼–è¯‘æ‰“åŒ…ç­‰æ“ä½œï¼Œä½†æ˜¯è¿™äº›å·®å¼‚åŒ–çš„é…ç½®è‡´ç®¡ç†èµ·æ¥éå¸¸ä¸æ–¹ä¾¿ï¼Œç»´æŠ¤èµ·æ¥ä¹Ÿæ˜¯æ¯”è¾ƒè´¹åŠ² </li>
<li>èµ„æºåˆ†é…ä¸å‡è¡¡ï¼Œæœ‰çš„ SlaveèŠ‚ç‚¹è¦è¿è¡Œçš„jobå‡ºç°æ’é˜Ÿç­‰å¾…ï¼Œè€Œæœ‰çš„SlaveèŠ‚ç‚¹å¤„äºç©ºé—²çŠ¶æ€ </li>
<li>èµ„æºæµªè´¹ï¼Œæ¯å° æ‰èµ„æº SlaveèŠ‚ç‚¹å¯èƒ½æ˜¯å®ä½“æœºæˆ–è€…VMï¼Œå½“SlaveèŠ‚ç‚¹å¤„äºç©ºé—²çŠ¶æ€æ—¶ï¼Œä¹Ÿä¸ä¼šå®Œå…¨é‡Šæ”¾</li>
</ul>
<p>ä»¥ä¸Šç§ç§é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥Kubernatesæ¥è§£å†³ï¼</p>
<p>K8Sæ˜¯å¯¹ä¸»ä»åˆ†å¸ƒå¼æ¶æ„çš„ä¼˜åŒ–ï¼ï¼ï¼</p>
<h5 id="Kubernatesç®€ä»‹"><a href="#Kubernatesç®€ä»‹" class="headerlink" title="Kubernatesç®€ä»‹"></a>Kubernatesç®€ä»‹</h5><p>Kubernetesï¼ˆç®€ç§°ï¼ŒK8Sï¼‰æ˜¯Googleå¼€æºçš„å®¹å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿï¼Œåœ¨DockeræŠ€æœ¯çš„åŸºç¡€ä¸Šï¼Œä¸ºå®¹å™¨åŒ–çš„ åº”ç”¨æä¾›éƒ¨ç½²è¿è¡Œã€èµ„æºè°ƒåº¦ã€æœåŠ¡å‘ç°å’ŒåŠ¨æ€ä¼¸ç¼©ç­‰ä¸€ç³»åˆ—å®Œæ•´åŠŸèƒ½ï¼Œæé«˜äº†å¤§è§„æ¨¡å®¹å™¨é›†ç¾¤ç®¡ç†çš„ ä¾¿æ·æ€§ã€‚ å…¶ä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä½¿ç”¨ Dockerå¯¹åº”ç”¨ç¨‹åºåŒ…è£…(package)ã€å®ä¾‹åŒ–(instantiate)ã€è¿è¡Œ(run)ã€‚ </li>
<li>ä»¥é›†ç¾¤çš„æ–¹å¼è¿è¡Œã€ç®¡ç†è·¨æœºå™¨çš„å®¹å™¨ã€‚ä»¥é›†ç¾¤çš„æ–¹å¼è¿è¡Œã€ç®¡ç†è·¨æœºå™¨çš„å®¹å™¨ã€‚</li>
<li>è§£å†³ Dockerè·¨æœºå™¨å®¹å™¨ä¹‹é—´çš„é€šè®¯é—®é¢˜ã€‚è§£å†³Dockerè·¨æœºå™¨å®¹å™¨ä¹‹é—´çš„é€šè®¯é—®é¢˜ã€‚ </li>
<li>Kubernetes çš„è‡ªæˆ‘ä¿®å¤æœºåˆ¶ä½¿å¾—å®¹å™¨é›†ç¾¤æ€»æ˜¯è¿è¡Œåœ¨ç”¨æˆ·æœŸæœ›çš„çŠ¶æ€ã€‚</li>
</ul>
<img src="https://raw.githubusercontent.com/P-luminary/images/e7ba868ee01a6860f90f158257d10a2f1d6d1a83/Kubernates+Docker+Jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E6%9E%B6%E6%9E%84%E5%9B%BE.png" style="zoom: 80%;" />

<h4 id="Kubernates-Docker-JenkinsæŒç»­é›†æˆæ–¹æ¡ˆå¥½å¤„"><a href="#Kubernates-Docker-JenkinsæŒç»­é›†æˆæ–¹æ¡ˆå¥½å¤„" class="headerlink" title="Kubernates+Docker+JenkinsæŒç»­é›†æˆæ–¹æ¡ˆå¥½å¤„"></a>Kubernates+Docker+JenkinsæŒç»­é›†æˆæ–¹æ¡ˆå¥½å¤„</h4><ul>
<li><span style = "color:red">æœåŠ¡é«˜å¯ç”¨</span>ï¼šå½“ Jenkins Master å‡ºç°æ•…éšœæ—¶ï¼ŒKubernetes ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„ Jenkins Master å®¹å™¨ï¼Œå¹¶ä¸”å°† Volume åˆ†é…ç»™æ–°åˆ›å»ºçš„å®¹å™¨ï¼Œä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä»è€Œè¾¾åˆ°é›†ç¾¤æœåŠ¡é«˜å¯ç”¨ã€‚ </li>
<li><span style = "color:red">åŠ¨æ€ä¼¸ç¼©ï¼Œåˆç†ä½¿ç”¨èµ„æº</span>ï¼šæ¯æ¬¡è¿è¡Œ Job æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª Jenkins Slaveï¼ŒJob å®Œæˆåï¼ŒSlave è‡ªåŠ¨æ³¨é”€å¹¶åˆ é™¤å®¹å™¨ï¼Œèµ„æºè‡ªåŠ¨é‡Šæ”¾ï¼Œè€Œä¸” Kubernetes ä¼šæ ¹æ®æ¯ä¸ªèµ„æºçš„ä½¿ç”¨æƒ…å†µï¼ŒåŠ¨æ€åˆ†é… Slave åˆ°ç©ºé—²çš„èŠ‚ç‚¹ä¸Šåˆ›å»ºï¼Œé™ä½å‡ºç°å› æŸèŠ‚ç‚¹èµ„æºåˆ©ç”¨ç‡é«˜ï¼Œè¿˜æ’é˜Ÿç­‰å¾…åœ¨è¯¥èŠ‚ç‚¹çš„æƒ…å†µã€‚ </li>
<li><span style = "color:red">æ‰©å±•æ€§å¥½</span> ï¼šå½“ Kubernetes é›†ç¾¤çš„èµ„æºä¸¥é‡ä¸è¶³è€Œå¯¼è‡´ Job æ’é˜Ÿç­‰å¾…æ—¶ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„æ·»åŠ ä¸€ä¸ª Kubernetes Node åˆ°é›†ç¾¤ä¸­ï¼Œä»è€Œå®ç°æ‰©å±•ã€‚</li>
</ul>
<h4 id="Kubeadmå®‰è£…Kubernetes"><a href="#Kubeadmå®‰è£…Kubernetes" class="headerlink" title="Kubeadmå®‰è£…Kubernetes"></a>Kubeadmå®‰è£…Kubernetes</h4><h5 id="Kubernetesçš„æ¶æ„"><a href="#Kubernetesçš„æ¶æ„" class="headerlink" title="Kubernetesçš„æ¶æ„"></a>Kubernetesçš„æ¶æ„</h5><p><img src="https://raw.githubusercontent.com/P-luminary/images/062acb4452ba025e956c0bea31d53ad08618cbc1/kubernetes.png"></p>
<ul>
<li><strong>API Serve</strong>r ï¼šç”¨äºæš´éœ²Kubernetes APIï¼Œä»»ä½•èµ„æºçš„è¯·æ±‚çš„è°ƒç”¨æ“ä½œéƒ½æ˜¯é€šè¿‡kube-apiserveræä¾›çš„æ¥ å£è¿›è¡Œçš„ã€‚ </li>
<li><strong>Etcd</strong>ï¼šæ˜¯Kubernetesæä¾›é»˜è®¤çš„å­˜å‚¨ç³»ç»Ÿï¼Œä¿å­˜æ‰€æœ‰é›†ç¾¤æ•°æ®ï¼Œä½¿ç”¨æ—¶éœ€è¦ä¸ºetcdæ•°æ®æä¾›å¤‡ä»½è®¡ åˆ’ã€‚ </li>
<li><strong>Controller-Manager</strong>ï¼šä½œä¸ºé›†ç¾¤å†…éƒ¨çš„ç®¡ç†æ§åˆ¶ä¸­å¿ƒï¼Œè´Ÿè´£é›†ç¾¤å†…çš„Nodeã€Podå‰¯æœ¬ã€æœåŠ¡ç«¯ç‚¹ ï¼ˆEndpointï¼‰ã€å‘½åç©ºé—´ï¼ˆNamespaceï¼‰ã€æœåŠ¡è´¦å·ï¼ˆServiceAccountï¼‰ã€èµ„æºå®šé¢ ï¼ˆResourceQuotaï¼‰çš„ç®¡ç†ï¼Œå½“æŸä¸ªNodeæ„å¤–å®•æœºæ—¶ï¼ŒController Managerä¼šåŠæ—¶å‘ç°å¹¶æ‰§è¡Œè‡ªåŠ¨åŒ– ä¿®å¤æµç¨‹ï¼Œç¡®ä¿é›†ç¾¤å§‹ç»ˆå¤„äºé¢„æœŸçš„å·¥ä½œçŠ¶æ€ã€‚ </li>
<li><strong>Scheduler</strong>ï¼šç›‘è§†æ–°åˆ›å»ºæ²¡æœ‰åˆ†é…åˆ°Nodeçš„Podï¼Œä¸ºPodé€‰æ‹©ä¸€ä¸ªNodeã€‚ </li>
<li><strong>Kubelet</strong>ï¼šè´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶è´Ÿè´£Volumeå’Œç½‘ç»œçš„ç®¡ç† </li>
<li><strong>Kube proxy</strong>ï¼šæ˜¯Kubernetesçš„æ ¸å¿ƒç»„ä»¶ï¼Œéƒ¨ç½²åœ¨æ¯ä¸ªNodeèŠ‚ç‚¹ä¸Šï¼Œå®ƒæ˜¯å®ç°Kubernetes Serviceçš„é€š ä¿¡ä¸è´Ÿè½½å‡è¡¡æœºåˆ¶çš„é‡è¦ç»„ä»¶ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th>ä¸»æœºåç§°</th>
<th>IPåœ°å€</th>
<th>å®‰è£…çš„è½¯ä»¶</th>
</tr>
</thead>
<tbody><tr>
<td>ä»£ç æ‰˜ç®¡æœåŠ¡å™¨</td>
<td>192.168.200.132</td>
<td>Gitlab-12.4.2</td>
</tr>
<tr>
<td>Dockerä»“åº“æœåŠ¡å™¨</td>
<td>192.168.200.131</td>
<td>Harbor1.9.2</td>
</tr>
<tr>
<td>k8s-master</td>
<td>192.168.200.129</td>
<td>kube-apiserverã€kube-controller-managerã€kube schedulerã€dockerã€etcdã€calicoï¼ŒNFS</td>
</tr>
<tr>
<td>k8s-node1</td>
<td>192.168.200.130</td>
<td>kubeletã€kubeproxyã€Docker18.06.1-ce</td>
</tr>
<tr>
<td>k8s-node2</td>
<td>192.168.200.133</td>
<td>kubeletã€kubeproxyã€Docker18.06.1-ce</td>
</tr>
</tbody></table>
<h4 id="ä¸‰å°æœºå™¨éƒ½éœ€è¦å®Œæˆ-ç»“æŸæˆ‘ä¼šæç¤º"><a href="#ä¸‰å°æœºå™¨éƒ½éœ€è¦å®Œæˆ-ç»“æŸæˆ‘ä¼šæç¤º" class="headerlink" title="ä¸‰å°æœºå™¨éƒ½éœ€è¦å®Œæˆ(ç»“æŸæˆ‘ä¼šæç¤º)"></a><span style ="color:green">ä¸‰å°æœºå™¨éƒ½éœ€è¦å®Œæˆ<del>(ç»“æŸæˆ‘ä¼šæç¤º)</del></span></h4><p>ä¿®æ”¹ä¸‰å°æœºå™¨çš„hostnameåŠhostsæ–‡ä»¶</p>
<blockquote>
<p>ã€è¾“å…¥hostnameå³å¯æŸ¥çœ‹æ˜¯å¦æ”¹æˆåŠŸã€‘<br>hostnamectl set-hostname k8s-master   ã€129ã€‘<br>hostnamectl set-hostname k8s-node1    ã€130ã€‘<br>hostnamectl set-hostname k8s-node2    ã€133ã€‘</p>
</blockquote>
<blockquote>
<p>ã€å°†idæ˜ å°„çš„hostnameè¿›è¡Œå…³è”ã€‘<br>[è¾“å…¥ <code>cat /etc/hosts</code> æŸ¥çœ‹æ˜¯å¦æˆåŠŸ]<br>cat &gt;&gt;&#x2F;etc&#x2F;hosts&lt;&lt;EOF<br>192.168.200.129 k8s-master<br>192.168.200.130 k8s-node1<br>192.168.200.133 k8s-node2<br>EOF</p>
</blockquote>
<p>æ•ˆæœå›¾</p>
<blockquote>
<p>[root@localhost ~]# cat &#x2F;etc&#x2F;hosts<br>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4<br>::1         localhost localhost.localdomain localhost6 localhost6.localdomain6<br>192.168.200.129 k8s-master<br>192.168.200.130 k8s-node1<br>192.168.200.133 k8s-node2</p>
</blockquote>
<p>å…³é—­é˜²ç«å¢™å’Œå…³é—­SELinux</p>
<blockquote>
<p>systemctl stop firewalld<br>systemctl disable firewalld </p>
<p><code>setenforce 0</code> ä¸´æ—¶å…³é—­<br><code>vi /etc/sysconfig/selinux </code>æ°¸ä¹…å…³é—­<br>æ”¹ä¸º<code>SELINUX=disabled</code></p>
</blockquote>
<p><strong>å…³é—­ SELinux</strong> å¯ä»¥é¿å…ä¸€äº›æœåŠ¡ï¼ˆå¦‚ Jenkinsã€SonarQubeã€Dockerï¼‰å› ä¸ºæƒé™é—®é¢˜æ— æ³•è®¿é—®ç½‘ç»œæˆ–æ–‡ä»¶ï¼Œä½†<strong>ä¸æ˜¯æ°¸ä¹…æ¨è</strong>çš„å®‰å…¨å®è·µã€‚</p>
<h6 id="è®¾ç½®ç³»ç»Ÿå‚æ•°"><a href="#è®¾ç½®ç³»ç»Ÿå‚æ•°" class="headerlink" title="è®¾ç½®ç³»ç»Ÿå‚æ•°"></a>è®¾ç½®ç³»ç»Ÿå‚æ•°</h6><p>è®¾ç½®å…è®¸è·¯ç”±è½¬å‘ï¼Œä¸å¯¹bridgeçš„æ•°æ®è¿›è¡Œå¤„ç†<br>åˆ›å»ºæ–‡ä»¶</p>
<blockquote>
<p>vi &#x2F;etc&#x2F;sysctl.d&#x2F;k8s.conf</p>
<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<p>net.bridge.bridge-nf-call-ip6tables &#x3D; 1<br>net.bridge.bridge-nf-call-iptables &#x3D; 1<br>net.ipv4.ip_forward &#x3D; 1<br>vm.swappiness &#x3D; 0</p>
</blockquote>
<p>æ‰§è¡Œæ–‡ä»¶</p>
<blockquote>
<p>sysctl -p &#x2F;etc&#x2F;sysctl.d&#x2F;k8s.conf</p>
</blockquote>
<h5 id="kube-proxyå¼€å¯ipvsçš„å‰ç½®æ¡ä»¶"><a href="#kube-proxyå¼€å¯ipvsçš„å‰ç½®æ¡ä»¶" class="headerlink" title="kube-proxyå¼€å¯ipvsçš„å‰ç½®æ¡ä»¶"></a>kube-proxyå¼€å¯ipvsçš„å‰ç½®æ¡ä»¶</h5><pre><code class="yaml">cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF
#!/bin/bash
modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack_ipv4
EOF

chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash   â˜†â˜†
/etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4
</code></pre>
<h5 id="æ‰€æœ‰èŠ‚ç‚¹å…³é—­swap"><a href="#æ‰€æœ‰èŠ‚ç‚¹å…³é—­swap" class="headerlink" title="æ‰€æœ‰èŠ‚ç‚¹å…³é—­swap"></a>æ‰€æœ‰èŠ‚ç‚¹å…³é—­swap</h5><blockquote>
<p>swapoff -a ä¸´æ—¶å…³é—­<br>vi &#x2F;etc&#x2F;fstab æ°¸ä¹…å…³é—­ </p>
<p>æ³¨é‡Šæ‰ä»¥ä¸‹å­—æ®µ<br>&#x2F;dev&#x2F;mapper&#x2F;cl-swap swap swap defaults 0 0</p>
</blockquote>
<h5 id="å®‰è£…kubeletã€kubeadmã€kubectl"><a href="#å®‰è£…kubeletã€kubeadmã€kubectl" class="headerlink" title="å®‰è£…kubeletã€kubeadmã€kubectl"></a>å®‰è£…kubeletã€kubeadmã€kubectl</h5><ul>
<li>kubeadmï¼šç”¨æ¥åˆå§‹åŒ–é›†ç¾¤çš„æŒ‡ä»¤ã€‚ </li>
<li>kubeletï¼šåœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨ pod å’Œ container ç­‰ã€‚ </li>
<li>kubectl:  æ¸…ç©ºyumç¼“å­˜ ç”¨æ¥ä¸é›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</li>
</ul>
<h5 id="æ¸…ç©ºyumç¼“å­˜"><a href="#æ¸…ç©ºyumç¼“å­˜" class="headerlink" title="æ¸…ç©ºyumç¼“å­˜"></a>æ¸…ç©ºyumç¼“å­˜</h5><blockquote>
<p>yum clean all</p>
</blockquote>
<h5 id="è®¾ç½®yumå®‰è£…æº"><a href="#è®¾ç½®yumå®‰è£…æº" class="headerlink" title="è®¾ç½®yumå®‰è£…æº"></a>è®¾ç½®yumå®‰è£…æº</h5><pre><code class="yaml">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg 
https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF
</code></pre>
<p>å®‰è£…ï¼š<code>yum install -y kubelet kubeadm kubectl</code></p>
<h5 id="kubelt-è®¾ç½®å¼€æœºå¯åŠ¨ï¼ˆæ³¨æ„ï¼šå…ˆä¸å¯åŠ¨ï¼Œç°åœ¨å¯åŠ¨çš„è¯ä¼šæŠ¥é”™ï¼‰"><a href="#kubelt-è®¾ç½®å¼€æœºå¯åŠ¨ï¼ˆæ³¨æ„ï¼šå…ˆä¸å¯åŠ¨ï¼Œç°åœ¨å¯åŠ¨çš„è¯ä¼šæŠ¥é”™ï¼‰" class="headerlink" title="kubelt è®¾ç½®å¼€æœºå¯åŠ¨ï¼ˆæ³¨æ„ï¼šå…ˆä¸å¯åŠ¨ï¼Œç°åœ¨å¯åŠ¨çš„è¯ä¼šæŠ¥é”™ï¼‰"></a>kubelt è®¾ç½®å¼€æœºå¯åŠ¨ï¼ˆæ³¨æ„ï¼šå…ˆä¸å¯åŠ¨ï¼Œç°åœ¨å¯åŠ¨çš„è¯ä¼šæŠ¥é”™ï¼‰</h5><p><code>systemctl start kubelet</code> å¯åŠ¨ â˜…â˜…</p>
<p><code>systemctl enable kubelet</code> å¼€æœºå¯åŠ¨</p>
<h5 id="æŸ¥çœ‹ç‰ˆæœ¬"><a href="#æŸ¥çœ‹ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹ç‰ˆæœ¬"></a>æŸ¥çœ‹ç‰ˆæœ¬</h5><p><code>kubelet --version</code>  â†’ Kubernetes v1.28.2</p>
<p><span style="color:green">ç»“æŸï¼</span></p>
<h4 id="MasterèŠ‚ç‚¹éœ€è¦å®Œæˆ-129ä¸»èŠ‚ç‚¹"><a href="#MasterèŠ‚ç‚¹éœ€è¦å®Œæˆ-129ä¸»èŠ‚ç‚¹" class="headerlink" title="MasterèŠ‚ç‚¹éœ€è¦å®Œæˆ [129ä¸»èŠ‚ç‚¹]"></a>MasterèŠ‚ç‚¹éœ€è¦å®Œæˆ [129ä¸»èŠ‚ç‚¹]</h4><ul>
<li>è¿è¡Œåˆå§‹åŒ–å‘½ä»¤</li>
</ul>
<pre><code class="yaml">kubeadm init --kubernetes-version=1.28.2 \
--apiserver-advertise-address=192.168.200.129 \
--image-repository registry.aliyuncs.com/google_containers \
--service-cidr=10.1.0.0/16 \
--pod-network-cidr=10.244.0.0/16
</code></pre>
<blockquote>
<h4 id="å¦‚ä½•é‡æ–°åˆå§‹åŒ–ï¼Ÿ"><a href="#å¦‚ä½•é‡æ–°åˆå§‹åŒ–ï¼Ÿ" class="headerlink" title="å¦‚ä½•é‡æ–°åˆå§‹åŒ–ï¼Ÿ"></a>å¦‚ä½•é‡æ–°åˆå§‹åŒ–ï¼Ÿ</h4><h2 id="è§£å†³æ­¥éª¤"><a href="#è§£å†³æ­¥éª¤" class="headerlink" title="è§£å†³æ­¥éª¤"></a>è§£å†³æ­¥éª¤</h2><h3 id="1-æ¸…ç†æ—§é›†ç¾¤æ®‹ç•™"><a href="#1-æ¸…ç†æ—§é›†ç¾¤æ®‹ç•™" class="headerlink" title="1. æ¸…ç†æ—§é›†ç¾¤æ®‹ç•™"></a>1. <strong>æ¸…ç†æ—§é›†ç¾¤æ®‹ç•™</strong></h3><p>å…ˆæ‰§è¡Œ <code>kubeadm reset</code> æ¸…ç†å½“å‰èŠ‚ç‚¹çš„ Kubernetes é…ç½®å’ŒçŠ¶æ€ï¼š</p>
<pre><code>kubeadm reset -f
kubeadm reset
</code></pre>
<p>è¿™ä¸ªå‘½ä»¤ä¼šæ¸…ç† kubelet é…ç½®æ–‡ä»¶ã€è¯ä¹¦ã€å®¹å™¨ç½‘ç»œå’Œæ‰€æœ‰ Kubernetes ç›¸å…³çŠ¶æ€ã€‚</p>
<hr>
<h3 id="2-æ¸…ç†ç½‘ç»œç›¸å…³æ®‹ç•™"><a href="#2-æ¸…ç†ç½‘ç»œç›¸å…³æ®‹ç•™" class="headerlink" title="2. æ¸…ç†ç½‘ç»œç›¸å…³æ®‹ç•™"></a>2. <strong>æ¸…ç†ç½‘ç»œç›¸å…³æ®‹ç•™</strong></h3><p>æ¸…ç† CNI ç½‘ç»œé…ç½®å’Œå®¹å™¨æ®‹ç•™ï¼š</p>
<pre><code>rm -rf /etc/cni/net.d
rm -rf /var/lib/cni/
rm -rf /var/lib/kubelet/*
</code></pre>
<hr>
<h3 id="3-ç¡®è®¤-containerd-æœåŠ¡å¯åŠ¨"><a href="#3-ç¡®è®¤-containerd-æœåŠ¡å¯åŠ¨" class="headerlink" title="3. ç¡®è®¤ containerd æœåŠ¡å¯åŠ¨"></a>3. <strong>ç¡®è®¤ containerd æœåŠ¡å¯åŠ¨</strong></h3><p>ç¡®ä¿ containerd è¿è¡Œï¼š</p>
<pre><code>systemctl restart containerd
systemctl status containerd
</code></pre>
<hr>
<h3 id="4-é‡æ–°åˆå§‹åŒ–-Kubernetes"><a href="#4-é‡æ–°åˆå§‹åŒ–-Kubernetes" class="headerlink" title="4. é‡æ–°åˆå§‹åŒ– Kubernetes"></a>4. <strong>é‡æ–°åˆå§‹åŒ– Kubernetes</strong></h3><p>æ‰§è¡Œä½ ä¹‹å‰çš„åˆå§‹åŒ–å‘½ä»¤ï¼š</p>
<pre><code>kubeadm init --kubernetes-version=1.28.2 \
  --apiserver-advertise-address=192.168.200.129 \
  --image-repository registry.aliyuncs.com/google_containers \
  --service-cidr=10.1.0.0/16 \
  --pod-network-cidr=10.244.0.0/16
</code></pre>
<hr>
<h3 id="5-é…ç½®-kubeconfig"><a href="#5-é…ç½®-kubeconfig" class="headerlink" title="5. é…ç½® kubeconfig"></a>5. <strong>é…ç½® kubeconfig</strong></h3><p>åˆå§‹åŒ–å®Œæˆåï¼ŒæŒ‰ç…§æç¤ºå°†é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°ç”¨æˆ·ç›®å½•ï¼š</p>
<pre><code>mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre>
<hr>
<h3 id="6-éƒ¨ç½²ç½‘ç»œæ’ä»¶"><a href="#6-éƒ¨ç½²ç½‘ç»œæ’ä»¶" class="headerlink" title="6. éƒ¨ç½²ç½‘ç»œæ’ä»¶"></a>6. <strong>éƒ¨ç½²ç½‘ç»œæ’ä»¶</strong></h3><p>æ ¹æ®ä½ ä½¿ç”¨çš„ç½‘ç»œæ’ä»¶ï¼ˆæ¯”å¦‚ Flannelã€Calicoï¼‰ï¼ŒæŒ‰ç…§å®˜æ–¹æ–‡æ¡£éƒ¨ç½²ã€‚ä»¥ Flannel ä¸ºä¾‹ï¼š</p>
<pre><code>kubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml
</code></pre>
<hr>
<h3 id="7-éªŒè¯"><a href="#7-éªŒè¯" class="headerlink" title="7. éªŒè¯"></a>7. <strong>éªŒè¯</strong></h3><p>æŸ¥çœ‹èŠ‚ç‚¹å’Œ Pod çŠ¶æ€ï¼š</p>
<pre><code>kubectl get nodes
kubectl get pods -n kube-system
</code></pre>
<pre><code class="yaml">kubeadm join 192.168.200.129:6443 --token q54yl3.xgho0e6o5080hnnf \
        --discovery-token-ca-cert-hash sha256:b8f6a58b65ad6bcfec65e5ed6ab5efac95f3a4ee82b2c388a87b20c3e813079b
</code></pre>
<hr>
<hr>
<hr>
<h2 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä½ ä¹‹å‰çš„é…ç½®æ–‡ä»¶å’ŒçŠ¶æ€æœªæ¸…ç†ï¼Œå¯¼è‡´ä¸èƒ½é‡æ–°åˆå§‹åŒ–ã€‚å…ˆç”¨ <code>kubeadm reset</code> æ¸…ç†ï¼Œå†é‡æ–°åˆå§‹åŒ–ã€‚è¿™æ ·ä¼šè‡ªåŠ¨ç”Ÿæˆ <code>kubelet</code> é…ç½®æ–‡ä»¶å’Œ <code>kubelet.conf</code>ï¼Œè§£å†³ä½ é‡åˆ°çš„å¯åŠ¨å¤±è´¥é—®é¢˜ã€‚</p>
</blockquote>
<blockquote>
<p>é—®é¢˜ï¼š     [ERROR CRI]: container runtime is not running: output: E0706 21:24:43.293740   26106 remote_runtime.go:616] â€œStatus from runtime service failedâ€ err&#x3D;â€rpc error: code &#x3D; Unavailable desc &#x3D; connection error: desc &#x3D; &quot;transport: Error while dialing dial unix &#x2F;var&#x2F;run&#x2F;containerd&#x2F;containerd.sock: connect: no such file or directory&quot;â€œ time&#x3D;â€2025-07-06T21:24:43+08:00â€ level&#x3D;fatal msg&#x3D;â€getting status of runtime: rpc error: code &#x3D; Unavailable desc &#x3D; connection error: desc &#x3D; &quot;transport: Error while dialing dial unix &#x2F;var&#x2F;run&#x2F;containerd&#x2F;containerd.sock: connect: no such file or directory&quot;â€œ , error: exit status 1 [preflight] If you know what you are doing, you can make a check non-fatal with <code>--ignore-preflight-errors=...</code> To see the stack trace of this error execute with â€“v&#x3D;5 or higher [root@k8s-master ~]#</p>
<h3 id="âœ…-ç«‹å³è§£å†³æ­¥éª¤ï¼ˆæ¨èç›´æ¥å¤åˆ¶ç²˜è´´æ‰§è¡Œï¼‰"><a href="#âœ…-ç«‹å³è§£å†³æ­¥éª¤ï¼ˆæ¨èç›´æ¥å¤åˆ¶ç²˜è´´æ‰§è¡Œï¼‰" class="headerlink" title="âœ… ç«‹å³è§£å†³æ­¥éª¤ï¼ˆæ¨èç›´æ¥å¤åˆ¶ç²˜è´´æ‰§è¡Œï¼‰"></a>âœ… ç«‹å³è§£å†³æ­¥éª¤ï¼ˆæ¨èç›´æ¥å¤åˆ¶ç²˜è´´æ‰§è¡Œï¼‰</h3><h4 id="1ï¸âƒ£-å®‰è£…-containerd"><a href="#1ï¸âƒ£-å®‰è£…-containerd" class="headerlink" title="1ï¸âƒ£ å®‰è£… containerd"></a>1ï¸âƒ£ å®‰è£… containerd</h4><pre><code>yum install -y containerd
</code></pre>
<p>ä½ è¿™é‡Œæ˜¾ç¤ºçš„æ˜¯ä¸€ä¸ª<strong>éæ ‡å‡†çš„ containerd é…ç½®æ¨¡æ¿</strong>ï¼ˆå¾ˆå¯èƒ½æ¥è‡ªæ—§ç‰ˆæœ¬æˆ– docker æä¾›çš„ containerdï¼‰ï¼Œ<strong>ç¼ºå¤±äº†å®Œæ•´é…ç½®ç»“æ„å’Œ <code>SystemdCgroup</code> å­—æ®µ</strong>ï¼Œæ‰€ä»¥è¿™ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„é…ç½®ã€‚</p>
<hr>
<h3 id="âœ…-æ­£ç¡®åšæ³•æ˜¯ï¼šç”¨æ ‡å‡†-containerd-å‘½ä»¤ç”Ÿæˆå®Œæ•´é…ç½®"><a href="#âœ…-æ­£ç¡®åšæ³•æ˜¯ï¼šç”¨æ ‡å‡†-containerd-å‘½ä»¤ç”Ÿæˆå®Œæ•´é…ç½®" class="headerlink" title="âœ… æ­£ç¡®åšæ³•æ˜¯ï¼šç”¨æ ‡å‡† containerd å‘½ä»¤ç”Ÿæˆå®Œæ•´é…ç½®"></a>âœ… æ­£ç¡®åšæ³•æ˜¯ï¼šç”¨æ ‡å‡† containerd å‘½ä»¤ç”Ÿæˆå®Œæ•´é…ç½®</h3><p>è¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ›¿æ¢æ‰æ—§é…ç½®ï¼š</p>
<hr>
<h3 id="ğŸ”-æ­¥éª¤-1ï¼šé‡æ–°ç”Ÿæˆ-containerd-çš„æ ‡å‡†é…ç½®æ–‡ä»¶"><a href="#ğŸ”-æ­¥éª¤-1ï¼šé‡æ–°ç”Ÿæˆ-containerd-çš„æ ‡å‡†é…ç½®æ–‡ä»¶" class="headerlink" title="ğŸ” æ­¥éª¤ 1ï¼šé‡æ–°ç”Ÿæˆ containerd çš„æ ‡å‡†é…ç½®æ–‡ä»¶"></a>ğŸ” æ­¥éª¤ 1ï¼šé‡æ–°ç”Ÿæˆ containerd çš„æ ‡å‡†é…ç½®æ–‡ä»¶</h3><pre><code>rm -f /etc/containerd/config.toml  # åˆ é™¤æ—§æ–‡ä»¶
containerd config default &gt; /etc/containerd/config.toml
</code></pre>
<hr>
<h3 id="ğŸ”§-æ­¥éª¤-2ï¼šç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹-SystemdCgroup-true"><a href="#ğŸ”§-æ­¥éª¤-2ï¼šç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹-SystemdCgroup-true" class="headerlink" title="ğŸ”§ æ­¥éª¤ 2ï¼šç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ SystemdCgroup = true"></a>ğŸ”§ æ­¥éª¤ 2ï¼šç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ <code>SystemdCgroup = true</code></h3><pre><code>vi /etc/containerd/config.toml
</code></pre>
<p>åœ¨æ–‡ä»¶ä¸­æœç´¢è¿™ä¸€è¡Œï¼ˆç”¨ <code>/SystemdCgroup</code>ï¼‰ï¼š</p>
<pre><code>SystemdCgroup = false
</code></pre>
<p>å°†å®ƒä¿®æ”¹ä¸ºï¼š</p>
<pre><code>SystemdCgroup = true
</code></pre>
<hr>
<h3 id="ğŸ”-æ­¥éª¤-3ï¼šé‡å¯-containerd"><a href="#ğŸ”-æ­¥éª¤-3ï¼šé‡å¯-containerd" class="headerlink" title="ğŸ” æ­¥éª¤ 3ï¼šé‡å¯ containerd"></a>ğŸ” æ­¥éª¤ 3ï¼šé‡å¯ containerd</h3><pre><code>systemctl daemon-reexec
systemctl restart containerd
systemctl enable containerd
</code></pre>
<hr>
<h3 id="âœ…-æ­¥éª¤-4ï¼šéªŒè¯æ˜¯å¦è¿è¡Œä¸­"><a href="#âœ…-æ­¥éª¤-4ï¼šéªŒè¯æ˜¯å¦è¿è¡Œä¸­" class="headerlink" title="âœ… æ­¥éª¤ 4ï¼šéªŒè¯æ˜¯å¦è¿è¡Œä¸­"></a>âœ… æ­¥éª¤ 4ï¼šéªŒè¯æ˜¯å¦è¿è¡Œä¸­</h3><pre><code>systemctl status containerd
</code></pre>
<p>ç¡®ä¿è¾“å‡ºä¸­çœ‹åˆ°ï¼š<code>Active: active (running)</code></p>
<hr>
<h5 id="ç„¶åä½ å°±å¯ä»¥ç»§ç»­-kubeadm-init-äº†ã€‚å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸€æ­¥æ­¥å¸¦ä½ ç¡®è®¤é…ç½®ç”Ÿæ•ˆã€‚ç°åœ¨è¯·å…ˆæ‰§è¡Œ"><a href="#ç„¶åä½ å°±å¯ä»¥ç»§ç»­-kubeadm-init-äº†ã€‚å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸€æ­¥æ­¥å¸¦ä½ ç¡®è®¤é…ç½®ç”Ÿæ•ˆã€‚ç°åœ¨è¯·å…ˆæ‰§è¡Œ" class="headerlink" title="ç„¶åä½ å°±å¯ä»¥ç»§ç»­ kubeadm init äº†ã€‚å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸€æ­¥æ­¥å¸¦ä½ ç¡®è®¤é…ç½®ç”Ÿæ•ˆã€‚ç°åœ¨è¯·å…ˆæ‰§è¡Œ"></a>ç„¶åä½ å°±å¯ä»¥ç»§ç»­ <code>kubeadm init</code> äº†ã€‚å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸€æ­¥æ­¥å¸¦ä½ ç¡®è®¤é…ç½®ç”Ÿæ•ˆã€‚ç°åœ¨è¯·å…ˆæ‰§è¡Œ</h5><h4 id="ä¸€ã€æ¸…ç†æ—§çš„é›†ç¾¤æ•°æ®"><a href="#ä¸€ã€æ¸…ç†æ—§çš„é›†ç¾¤æ•°æ®" class="headerlink" title="ä¸€ã€æ¸…ç†æ—§çš„é›†ç¾¤æ•°æ®"></a>ä¸€ã€æ¸…ç†æ—§çš„é›†ç¾¤æ•°æ®</h4><p>ä½ å¯ä»¥æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œæ¸…ç†ä¹‹å‰çš„ kubeadm åˆå§‹åŒ–ä¿¡æ¯ï¼š</p>
<pre><code>kubeadm reset
</code></pre>
<hr>
<hr>
<hr>
<hr>
<h3 id="ä½ è¿™è¾¹çš„æ ¸å¿ƒé—®é¢˜æ˜¯ï¼š"><a href="#ä½ è¿™è¾¹çš„æ ¸å¿ƒé—®é¢˜æ˜¯ï¼š" class="headerlink" title="ä½ è¿™è¾¹çš„æ ¸å¿ƒé—®é¢˜æ˜¯ï¼š"></a><span style = "color:red">ä½ è¿™è¾¹çš„æ ¸å¿ƒé—®é¢˜æ˜¯ï¼š</span></h3><blockquote>
<p>âŒ containerd æ²¡æœ‰å¯åŠ¨ï¼Œå¯¼è‡´ kubeadm æŠ¥é”™<br> <code>&quot;connect: no such file or directory&quot; â†’ /var/run/containerd/containerd.sock</code></p>
</blockquote>
<p>è¿™è¯´æ˜ <strong>containerd æ ¹æœ¬æ²¡è·‘èµ·æ¥</strong>ï¼ŒKubernetes æ— æ³•è¿æ¥å®ƒã€‚</p>
<hr>
<h3 id="âœ…-è§£å†³æ€è·¯ï¼šä¿®å¤-containerd-çš„é…ç½®-å¯åŠ¨-containerd"><a href="#âœ…-è§£å†³æ€è·¯ï¼šä¿®å¤-containerd-çš„é…ç½®-å¯åŠ¨-containerd" class="headerlink" title="âœ… è§£å†³æ€è·¯ï¼šä¿®å¤ containerd çš„é…ç½® + å¯åŠ¨ containerd"></a>âœ… è§£å†³æ€è·¯ï¼šä¿®å¤ containerd çš„é…ç½® + å¯åŠ¨ containerd</h3><p>æˆ‘ä»¬æ‰‹æŠŠæ‰‹æ¥æ“ä½œğŸ‘‡</p>
<hr>
<h2 id="ğŸ§¹-ç¬¬ä¸€æ­¥ï¼šæ¸…ç©º-containerd-çš„é…ç½®æ–‡ä»¶å¹¶é‡æ–°ç”Ÿæˆ"><a href="#ğŸ§¹-ç¬¬ä¸€æ­¥ï¼šæ¸…ç©º-containerd-çš„é…ç½®æ–‡ä»¶å¹¶é‡æ–°ç”Ÿæˆ" class="headerlink" title="ğŸ§¹ ç¬¬ä¸€æ­¥ï¼šæ¸…ç©º containerd çš„é…ç½®æ–‡ä»¶å¹¶é‡æ–°ç”Ÿæˆ"></a>ğŸ§¹ ç¬¬ä¸€æ­¥ï¼šæ¸…ç©º containerd çš„é…ç½®æ–‡ä»¶å¹¶é‡æ–°ç”Ÿæˆ</h2><pre><code>rm -f /etc/containerd/config.toml
containerd config default &gt; /etc/containerd/config.toml
</code></pre>
<p>âœ… è¿™ä¸€æ­¥ä¼šæ¢å¤å®˜æ–¹é»˜è®¤é…ç½®ã€‚</p>
<h3 id="âœï¸-ç¬¬äºŒæ­¥ï¼šä½¿ç”¨-viï¼ˆæ‰€æœ‰-Linux-é€šç”¨ï¼‰"><a href="#âœï¸-ç¬¬äºŒæ­¥ï¼šä½¿ç”¨-viï¼ˆæ‰€æœ‰-Linux-é€šç”¨ï¼‰" class="headerlink" title="âœï¸ ç¬¬äºŒæ­¥ï¼šä½¿ç”¨ viï¼ˆæ‰€æœ‰ Linux é€šç”¨ï¼‰"></a>âœï¸ ç¬¬äºŒæ­¥ï¼šä½¿ç”¨ <code>vi</code>ï¼ˆæ‰€æœ‰ Linux é€šç”¨ï¼‰</h3><pre><code>vi /etc/containerd/config.toml
</code></pre>
<p>æŸ¥æ‰¾è¿™ä¸€æ®µï¼š</p>
<pre><code>[plugins.&quot;io.containerd.grpc.v1.cri&quot;]
  sandbox_image = &quot;registry.k8s.io/pause:3.6&quot;
</code></pre>
<p>æŠŠå®ƒæ”¹æˆï¼š</p>
<pre><code>[plugins.&quot;io.containerd.grpc.v1.cri&quot;]
  sandbox_image = &quot;registry.aliyuncs.com/google_containers/pause:3.9&quot;
</code></pre>
<p>âœ… ä¿å­˜å¹¶é€€å‡ºğŸ”„ ç¬¬ä¸‰æ­¥ï¼šé‡å¯ containerd</p>
<pre><code>systemctl daemon-reexec
systemctl restart containerd
</code></pre>
<h2 id="âœ…-ç¬¬å››æ­¥ï¼šç¡®è®¤-containerd-å·²æˆåŠŸå¯åŠ¨"><a href="#âœ…-ç¬¬å››æ­¥ï¼šç¡®è®¤-containerd-å·²æˆåŠŸå¯åŠ¨" class="headerlink" title="âœ… ç¬¬å››æ­¥ï¼šç¡®è®¤ containerd å·²æˆåŠŸå¯åŠ¨"></a>âœ… ç¬¬å››æ­¥ï¼šç¡®è®¤ containerd å·²æˆåŠŸå¯åŠ¨</h2><pre><code>systemctl status containerd
</code></pre>
<p>çœ‹è¾“å‡ºé‡Œæœ‰ <code>Active: active (running)</code>ï¼Œè¯´æ˜å¯åŠ¨æˆåŠŸã€‚ğŸ§ª ç¬¬äº”æ­¥ï¼šéªŒè¯ socket æ–‡ä»¶æ˜¯å¦å­˜åœ¨</p>
<pre><code>ls -l /var/run/containerd/containerd.sock
</code></pre>
<p>åº”è¯¥èƒ½çœ‹åˆ°ç±»ä¼¼ï¼š</p>
<pre><code>srw-rw---- 1 root root 0 Jul 6 22:06 /var/run/containerd/containerd.sock
</code></pre>
<p>å¦‚æœæ²¡çœ‹åˆ°ï¼Œè¯´æ˜ containerd æ²¡çœŸæ­£è¿è¡ŒæˆåŠŸã€‚</p>
<h2 id="ğŸ§±-ç¬¬å…­æ­¥ï¼šé‡æ–°æ‰§è¡Œ-kubeadm-init"><a href="#ğŸ§±-ç¬¬å…­æ­¥ï¼šé‡æ–°æ‰§è¡Œ-kubeadm-init" class="headerlink" title="ğŸ§± ç¬¬å…­æ­¥ï¼šé‡æ–°æ‰§è¡Œ kubeadm init"></a>ğŸ§± ç¬¬å…­æ­¥ï¼šé‡æ–°æ‰§è¡Œ <code>kubeadm init</code></h2><pre><code>kubeadm init --kubernetes-version=1.28.2 \
  --apiserver-advertise-address=192.168.200.129 \
  --image-repository registry.aliyuncs.com/google_containers \
  --service-cidr=10.1.0.0/16 \
  --pod-network-cidr=10.244.0.0/16
</code></pre>
<p>è‹¥æ˜¯tokenå¿˜è®°äº† å¯ä»¥æ‰§è¡Œç›´æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„<br><code>kubeadm token create --print-join-command</code></p>
<pre><code class="yam">[root@k8s-master calico]# kubeadm token create --print-join-command
kubeadm join 192.168.200.129:6443 --token jn3083.g1lz52mo680wiic9 --discovery-token-ca-cert-hash sha256:d03d798679d90f348b1cf7a1c12d5d1bfcbe2bd18e4a1aec97055b60c0f042ca
</code></pre>
<p>æ­¤æ—¶å»ä»èŠ‚ç‚¹ç”Ÿæˆå¯èƒ½ä¼šæœ‰æŠ¥é”™ä½ è¿™ä¸ªé”™è¯¯è¯´æ˜å½“å‰èŠ‚ç‚¹ï¼ˆ<code>k8s-node1</code>ï¼‰<br><strong>ä¹‹å‰å·²ç»æ‰§è¡Œè¿‡ <code>kubeadm join</code> æˆ–è€…å…¶ä»– kubeadm ç›¸å…³æ“ä½œï¼Œç•™ä¸‹äº†é…ç½®æ–‡ä»¶æˆ–ç«¯å£è¢«å ç”¨</strong>ï¼Œä¸èƒ½ç›´æ¥å†æ¬¡æ‰§è¡Œ <code>kubeadm join</code>ã€‚</p>
<hr>
<h3 id="â—æŠ¥é”™è¯¦æƒ…åˆ†æï¼š"><a href="#â—æŠ¥é”™è¯¦æƒ…åˆ†æï¼š" class="headerlink" title="â—æŠ¥é”™è¯¦æƒ…åˆ†æï¼š"></a>â—æŠ¥é”™è¯¦æƒ…åˆ†æï¼š</h3><pre><code>[ERROR FileAvailable--etc-kubernetes-kubelet.conf]: /etc/kubernetes/kubelet.conf already exists
[ERROR Port-10250]: Port 10250 is in use
[ERROR FileAvailable--etc-kubernetes-pki-ca.crt]: /etc/kubernetes/pki/ca.crt already exists
</code></pre>
<p>è¿™äº›é”™è¯¯è¯´æ˜ï¼š</p>
<ul>
<li><code>/etc/kubernetes/kubelet.conf</code> æ–‡ä»¶å­˜åœ¨ â€”â€” è¯´æ˜ kubelet è¢«é…ç½®è¿‡ã€‚</li>
<li><code>10250</code> ç«¯å£å·²è¢«å ç”¨ â€”â€” kubelet æœåŠ¡æ­£åœ¨è¿è¡Œã€‚</li>
<li><code>/etc/kubernetes/pki/ca.crt</code> æ–‡ä»¶å­˜åœ¨ â€”â€” é›†ç¾¤è¯ä¹¦å­˜åœ¨ï¼Œå¯èƒ½æ˜¯ä¹‹å‰åŠ å…¥è¿‡å¤±è´¥æˆ–æ®‹ç•™æ–‡ä»¶ã€‚</li>
</ul>
<hr>
<h3 id="âœ…-è§£å†³æ–¹æ³•ï¼ˆæ¸…ç†æ®‹ç•™å†é‡æ–°-joinï¼‰ï¼š"><a href="#âœ…-è§£å†³æ–¹æ³•ï¼ˆæ¸…ç†æ®‹ç•™å†é‡æ–°-joinï¼‰ï¼š" class="headerlink" title="âœ… è§£å†³æ–¹æ³•ï¼ˆæ¸…ç†æ®‹ç•™å†é‡æ–° joinï¼‰ï¼š"></a>âœ… è§£å†³æ–¹æ³•ï¼ˆ<strong>æ¸…ç†æ®‹ç•™å†é‡æ–° join</strong>ï¼‰ï¼š</h3><p>ä½ å¯ä»¥å…ˆåœ¨ node èŠ‚ç‚¹æ‰§è¡Œ <strong>é‡ç½®æ“ä½œ</strong>ï¼š</p>
<pre><code>kubeadm reset -f
</code></pre>
<p>ç„¶åå†æ¸…ç†ä¸€ä¸‹é…ç½®å’Œ iptables è§„åˆ™ï¼ˆå¯é€‰ä½†æ¨èï¼‰ï¼š</p>
<pre><code>rm -rf /etc/kubernetes/pki
rm -rf /etc/kubernetes/kubelet.conf
rm -rf /var/lib/kubelet/*
iptables -F
systemctl restart kubelet
</code></pre>
<p>ç„¶åé‡æ–°æ‰§è¡Œä½ ä¹‹å‰çš„ <code>kubeadm join</code> å‘½ä»¤ï¼š</p>
<pre><code>kubeadm join 192.168.200.129:6443 --token eoxdev.8tkpz5csc7x1mqgc \
        --discovery-token-ca-cert-hash sha256:6acf9c7e6c11bb973bd57404f9ec28b93ab5b48f8a50f0213bc389bbfb4bf68f
</code></pre>
<hr>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><hr>
<p>ä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œk8s å°±èƒ½åˆå§‹åŒ–æˆåŠŸäº†ï¼</p>
<blockquote>
<p>Your Kubernetes control-plane has initialized successfully!</p>
<p>To start using your cluster, you need to run the following as a regular user:</p>
<p>  mkdir -p $HOME&#x2F;.kube<br>  sudo cp -i &#x2F;etc&#x2F;kubernetes&#x2F;admin.conf $HOME&#x2F;.kube&#x2F;config<br>  sudo chown $(id -u):$(id -g) $HOME&#x2F;.kube&#x2F;config</p>
<p>Alternatively, if you are the root user, you can run:</p>
<p>  export KUBECONFIG&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;admin.conf</p>
<p>You should now deploy a pod network to the cluster.<br>Run â€œkubectl apply -f [podnetwork].yamlâ€ with one of the options listed at:<br>  <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/cluster-administration/addons/">https://kubernetes.io/docs/concepts/cluster-administration/addons/</a></p>
<p>Then you can join any number of worker nodes by running the following on each as root:</p>
<p>kubeadm join 192.168.200.129:6443 â€“token zjoxjc.f58nh7lixocvjpgj <br>        â€“discovery-token-ca-cert-hash sha256:3cbdd81868c4470767b5c82af37fb63c2240c98e5f00eb0458df99350cabb7b3<br>[root@k8s-master ~]#</p>
<pre><code class="yaml">kubeadm join 192.168.200.129:6443 --token zjoxjc.f58nh7lixocvjpgj \
        --discovery-token-ca-cert-hash sha256:3cbdd81868c4470767b5c82af37fb63c2240c98e5f00eb0458df99350cabb7b3
</code></pre>
</blockquote>
</blockquote>
<ul>
<li>æŒ‰ç…§å®ƒçš„æç¤ºé€æ­¥ä¿®æ”¹k8sé…ç½®æ–‡ä»¶     é…ç½® <code>kubectl</code> å·¥å…·</li>
</ul>
<pre><code class="yaml">mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre>
<ul>
<li>å®‰è£…Calico</li>
</ul>
<pre><code class="java">mkdir k8s
cd k8s
wget https://docs.projectcalico.org/v3.10/getting-started/kubernetes/installation/hosted/kubernetes-datastore/calico-networking/1.7/calico.yaml
// ä¸Šé¢çš„åˆ«ç”¨äº† ç”¨è¿™ä¸ªæ–°çš„
wget https://jiangstudy.online:8081/sources/calico.yaml
sed -i &#39;s/192.168.0.0/10.244.0.0/g&#39; calico.yaml  ã€æ”¹åœ°å€ åˆ†ç»™prodçš„è™šæ‹Ÿåœ°å€ã€‘

kubectl apply -f calico.yaml
</code></pre>
<p>æˆ–è€…aiè¯´çš„</p>
<pre><code class="yaml"># 1. åˆ›å»ºå·¥ä½œç›®å½•
mkdir -p ~/k8s &amp;&amp; cd ~/k8s

# 2. ä¸‹è½½ Calico æ¸…å•æ–‡ä»¶ï¼ˆæ¨èä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œé v3.10ï¼‰
wget https://docs.projectcalico.org/manifests/calico.yaml -O calico.yaml

# 3. ä¿®æ”¹ POD CIDRï¼ˆæ ¹æ®æ‚¨çš„é›†ç¾¤è§„åˆ’ï¼‰
# æ³¨æ„ï¼šå¿…é¡»ä¸ kubeadm init æ—¶æŒ‡å®šçš„ --pod-network-cidr ä¸€è‡´
sed -i &#39;s|192.168.0.0/16|10.244.0.0/16|g&#39; calico.yaml

# 4. éƒ¨ç½² Calico
kubectl apply -f calico.yaml

# 5. éªŒè¯å®‰è£…
kubectl get pods -n kube-system -w
</code></pre>
<ul>
<li>ç­‰å¾…å‡ åˆ†é’Ÿï¼ŒæŸ¥çœ‹æ‰€æœ‰Podçš„çŠ¶æ€ï¼Œç¡®ä¿æ‰€æœ‰Podéƒ½æ˜¯RunningçŠ¶æ€</li>
</ul>
<p><code>kubectl get pod --all-namespaces -o wide</code></p>
<blockquote>
<p>ä½ è¿™ä¸ª <code>calico.yaml</code> æ˜¯ <strong>å¾ˆè€çš„ç‰ˆæœ¬ v3.10</strong>ï¼Œå…¶ä¸­ç”¨çš„æ˜¯ <code>apiextensions.k8s.io/v1beta1</code>ï¼Œ<strong>æ—©åœ¨ Kubernetes v1.22 ä¸­å°±è¢«ç§»é™¤äº†</strong>ï¼Œä½ ç°åœ¨ç”¨çš„æ˜¯ <strong>Kubernetes 1.28</strong>ï¼Œè‡ªç„¶å°±å‡ºé”™äº†ã€‚</p>
<hr>
<h3 id="âœ…-æ­£ç¡®åšæ³•ï¼šä½¿ç”¨-Calico-å®˜æ–¹æ”¯æŒ-Kubernetes-v1-28-çš„æœ€æ–°-YAML"><a href="#âœ…-æ­£ç¡®åšæ³•ï¼šä½¿ç”¨-Calico-å®˜æ–¹æ”¯æŒ-Kubernetes-v1-28-çš„æœ€æ–°-YAML" class="headerlink" title="âœ… æ­£ç¡®åšæ³•ï¼šä½¿ç”¨ Calico å®˜æ–¹æ”¯æŒ Kubernetes v1.28 çš„æœ€æ–° YAML"></a>âœ… æ­£ç¡®åšæ³•ï¼šä½¿ç”¨ Calico å®˜æ–¹æ”¯æŒ Kubernetes v1.28 çš„æœ€æ–° YAML</h3><hr>
<p><code>https://docs.projectcalico.org/manifests/calico.yaml</code>æµè§ˆå™¨è®¿é—®ç„¶åå»<code>/root/k8s</code>é‡Œé¢è¿›è¡Œå…¨éƒ¨æ›¿æ¢æˆæ–°ç‰ˆæœ¬</p>
<h3 id="ä¸€é”®ä¸‹è½½å®‰è£…æ¨èç‰ˆæœ¬ï¼š"><a href="#ä¸€é”®ä¸‹è½½å®‰è£…æ¨èç‰ˆæœ¬ï¼š" class="headerlink" title="ä¸€é”®ä¸‹è½½å®‰è£…æ¨èç‰ˆæœ¬ï¼š"></a>ä¸€é”®ä¸‹è½½å®‰è£…æ¨èç‰ˆæœ¬ï¼š</h3><pre><code>curl https://raw.githubusercontent.com/projectcalico/calico/v3.26.1/manifests/calico.yaml -O
</code></pre>
<blockquote>
<p>Calico v3.26 æ”¯æŒ Kubernetes v1.28ï¼Œæ”¾å¿ƒä½¿ç”¨</p>
</blockquote>
<p>ç„¶åå†ä¿®æ”¹ <code>Pod CIDR</code>ï¼š</p>
<pre><code>sed -i &#39;s/192.168.0.0/10.244.0.0/g&#39; calico.yaml
</code></pre>
<ol>
<li><strong>å»ºè®®ä¿®æ”¹é•œåƒæºä¸ºé˜¿é‡Œäº‘ï¼ˆå›½å†…å¯æ‹‰å–ï¼‰</strong>ï¼š<br> ä¾‹å¦‚å°†ä»¥ä¸‹å‡ è¡Œï¼ˆåœ¨ calico.yaml ä¸­ï¼‰ï¼š</li>
</ol>
<pre><code>image: calico/cni:v3.26.1
</code></pre>
<p>æ›¿æ¢ä¸ºï¼š</p>
<pre><code>image: registry.cn-hangzhou.aliyuncs.com/chenby/calico_cni:v3.26.1
</code></pre>
<p>æœ€åé‡æ–°éƒ¨ç½²ï¼š</p>
<pre><code>kubectl apply -f calico.yaml
</code></pre>
<hr>
<h3 id="âœ…-æ£€æŸ¥-Calico-çŠ¶æ€"><a href="#âœ…-æ£€æŸ¥-Calico-çŠ¶æ€" class="headerlink" title="âœ… æ£€æŸ¥ Calico çŠ¶æ€"></a>âœ… æ£€æŸ¥ Calico çŠ¶æ€</h3><p>éƒ¨ç½²å®Œå¤§çº¦ 10~30 ç§’åæ‰§è¡Œï¼š</p>
<pre><code>kubectl get pods -n kube-system
</code></pre>
<p>æ­£å¸¸ä¼šçœ‹åˆ° <code>calico-node</code> å’Œ <code>calico-kube-controllers</code> éƒ½å¤„äº <code>Running</code> çŠ¶æ€ã€‚</p>
<hr>
<hr>
<hr>
<h3 id="å‚»åµaiå’Œscdn-æŸ¥åŠå¤©éƒ½æ²¡ç”¨-è¿˜ä¸å¦‚Bç«™upçš„æ–¹æ³•-ä¸€éé€š"><a href="#å‚»åµaiå’Œscdn-æŸ¥åŠå¤©éƒ½æ²¡ç”¨-è¿˜ä¸å¦‚Bç«™upçš„æ–¹æ³•-ä¸€éé€š" class="headerlink" title="å‚»åµaiå’Œscdn æŸ¥åŠå¤©éƒ½æ²¡ç”¨ è¿˜ä¸å¦‚Bç«™upçš„æ–¹æ³•[ä¸€éé€š]"></a><span style="color:red"><strong>å‚»åµaiå’Œscdn æŸ¥åŠå¤©éƒ½æ²¡ç”¨ è¿˜ä¸å¦‚Bç«™upçš„æ–¹æ³•<del>[ä¸€éé€š]</del></strong></span></h3><p><a target="_blank" rel="noopener" href="https://jiangstudy.online/archives/kubernetes-calicozu-jian-de-an-zhuang">ã€kubernetesã€‘Calicoç»„ä»¶çš„å®‰è£…-äº‘é€”è¿ç»´</a></p>
<p>ä»¥ä¸‹æ­¥éª¤åªåœ¨master01æ‰§è¡Œï¼šç›¸å…³çš„yamlå·²ä¸Šä¼ æ–‡ä»¶èµ„æºæœåŠ¡å™¨ï¼Œéœ€è¦ä¸‹è½½ä¸‹æ¥ä½¿ç”¨ï¼š</p>
<pre><code class="yaml">mkdir /root/calico &amp;&amp; cd /root/calico/
wget https://jiangstudy.online:8081/sources/calico.yaml
</code></pre>
<p>ä¿®æ”¹PODç½‘æ®µ    è¯´æ˜ï¼špodç½‘æ®µå³ä¸ºä¸»æœºè§„åˆ’æ—¶çš„ç½‘æ®µã€‚</p>
<pre><code class="yaml">POD_SUBNET=`cat /etc/kubernetes/manifests/kube-controller-manager.yaml | grep cluster-cidr= | awk -F= &#39;&#123;print $NF&#125;&#39;`

sed -i &quot;s#POD_CIDR#$&#123;POD_SUBNET&#125;#g&quot; calico.yaml
</code></pre>
<p>éƒ¨ç½²calico<br><code>kubectl apply -f calico.yaml</code></p>
<p>æŸ¥çœ‹çŠ¶æ€<br><code> kubectl get node</code><br><code>kubectl get pods -n kube-system -w</code></p>
</blockquote>
<h3 id="SlaveèŠ‚ç‚¹éœ€è¦å®Œæˆ"><a href="#SlaveèŠ‚ç‚¹éœ€è¦å®Œæˆ" class="headerlink" title="SlaveèŠ‚ç‚¹éœ€è¦å®Œæˆ"></a>SlaveèŠ‚ç‚¹éœ€è¦å®Œæˆ</h3><ul>
<li><p>è®©æ‰€æœ‰èŠ‚ç‚¹è®©é›†ç¾¤ç¯å¢ƒ</p>
<p>ä½¿ç”¨ä¹‹å‰MasterèŠ‚ç‚¹äº§ç”Ÿçš„å‘½ä»¤åŠ å…¥é›†ç¾¤</p>
<pre><code class="yaml">kubeadm join 192.168.200.129:6443 --token eoxdev.8tkpz5csc7x1mqgc \
        --discovery-token-ca-cert-hash sha256:6acf9c7e6c11bb973bd57404f9ec28b93ab5b48f8a50f0213bc389bbfb4bf68f
</code></pre>
</li>
<li><p>å¯åŠ¨<code>kubelet</code></p>
<p><code>systemctl start kubelet</code> å¯åŠ¨<br><code>systemctl status kubelet</code> æŸ¥çœ‹çŠ¶æ€</p>
</li>
<li><p>å›åˆ°MasterèŠ‚ç‚¹æŸ¥çœ‹ï¼Œå¦‚æœStatuså…¨éƒ¨ä¸ºReadyï¼Œä»£è¡¨é›†ç¾¤ç¯å¢ƒæ­å»ºæˆåŠŸï¼ï¼ï¼</p>
<p><code>kubectl get nodes</code></p>
</li>
</ul>
<blockquote>
<p>ä½ çš„è¿™ä¸ªæŠ¥é”™ï¼š</p>
<pre><code>validate service connection: CRI v1 runtime API is not implemented for endpoint &quot;unix:///var/run/containerd/containerd.sock&quot;
</code></pre>
<p>è¯´æ˜ <strong>containerd çš„ CRI æ¥å£æ²¡å¯ç”¨</strong>ï¼Œè¿™æ˜¯å› ä¸ºä½ çš„ <code>/etc/containerd/config.toml</code> é…ç½®ä¸å®Œæ•´æˆ–è€…ç¼ºå°‘å¿…è¦å­—æ®µã€‚</p>
<hr>
<h2 id="âœ…-ç«‹å³ä¿®å¤æ­¥éª¤å¦‚ä¸‹ï¼š"><a href="#âœ…-ç«‹å³ä¿®å¤æ­¥éª¤å¦‚ä¸‹ï¼š" class="headerlink" title="âœ… ç«‹å³ä¿®å¤æ­¥éª¤å¦‚ä¸‹ï¼š"></a>âœ… ç«‹å³ä¿®å¤æ­¥éª¤å¦‚ä¸‹ï¼š</h2><h3 id="ğŸ”§-ç¬¬ä¸€æ­¥ï¼šé‡æ–°ç”Ÿæˆ-config-toml-é…ç½®æ–‡ä»¶"><a href="#ğŸ”§-ç¬¬ä¸€æ­¥ï¼šé‡æ–°ç”Ÿæˆ-config-toml-é…ç½®æ–‡ä»¶" class="headerlink" title="ğŸ”§ ç¬¬ä¸€æ­¥ï¼šé‡æ–°ç”Ÿæˆ config.toml é…ç½®æ–‡ä»¶"></a>ğŸ”§ ç¬¬ä¸€æ­¥ï¼š<strong>é‡æ–°ç”Ÿæˆ config.toml é…ç½®æ–‡ä»¶</strong></h3><pre><code>rm -f /etc/containerd/config.toml
containerd config default &gt; /etc/containerd/config.toml
</code></pre>
<hr>
<h3 id="ğŸ› ï¸-ç¬¬äºŒæ­¥ï¼šä¿®æ”¹é…ç½®å¯ç”¨-CRI-systemd-é©±åŠ¨"><a href="#ğŸ› ï¸-ç¬¬äºŒæ­¥ï¼šä¿®æ”¹é…ç½®å¯ç”¨-CRI-systemd-é©±åŠ¨" class="headerlink" title="ğŸ› ï¸ ç¬¬äºŒæ­¥ï¼šä¿®æ”¹é…ç½®å¯ç”¨ CRI + systemd é©±åŠ¨"></a>ğŸ› ï¸ ç¬¬äºŒæ­¥ï¼š<strong>ä¿®æ”¹é…ç½®å¯ç”¨ CRI + systemd é©±åŠ¨</strong></h3><pre><code>vim /etc/containerd/config.toml
</code></pre>
<p>æ‰¾åˆ°è¿™æ®µï¼š</p>
<pre><code>[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]
  SystemdCgroup = false
</code></pre>
<p>æŠŠ <code>false</code> æ”¹æˆ <code>true</code>ï¼š</p>
<pre><code>SystemdCgroup = true
</code></pre>
<p>æˆ–è€…ç›´æ¥ç”¨å‘½ä»¤ä¿®æ”¹ï¼š</p>
<pre><code>sed -i &#39;s/SystemdCgroup = false/SystemdCgroup = true/&#39; /etc/containerd/config.toml
</code></pre>
<hr>
<h3 id="ğŸš€-ç¬¬ä¸‰æ­¥ï¼šé‡å¯-containerd"><a href="#ğŸš€-ç¬¬ä¸‰æ­¥ï¼šé‡å¯-containerd" class="headerlink" title="ğŸš€ ç¬¬ä¸‰æ­¥ï¼šé‡å¯ containerd"></a>ğŸš€ ç¬¬ä¸‰æ­¥ï¼š<strong>é‡å¯ containerd</strong></h3><pre><code>systemctl daemon-reexec
systemctl restart containerd
systemctl status containerd
</code></pre>
<p>ç¡®è®¤è¿è¡Œæ­£å¸¸åï¼š</p>
<pre><code>ls /var/run/containerd/containerd.sock
</code></pre>
<p>å¦‚æœæœ‰è¾“å‡ºè¯´æ˜ socket æ­£å¸¸ï¼Œcontainerd å·¥ä½œ OKã€‚</p>
<hr>
<h3 id="ğŸ”-ç¬¬å››æ­¥ï¼šå†æ¬¡æ‰§è¡Œ-kubeadm-join"><a href="#ğŸ”-ç¬¬å››æ­¥ï¼šå†æ¬¡æ‰§è¡Œ-kubeadm-join" class="headerlink" title="ğŸ” ç¬¬å››æ­¥ï¼šå†æ¬¡æ‰§è¡Œ kubeadm join"></a>ğŸ” ç¬¬å››æ­¥ï¼šå†æ¬¡æ‰§è¡Œ kubeadm join</h3><pre><code>kubeadm join 192.168.200.129:6443 --token zjoxjc.f58nh7lixocvjpgj \
  --discovery-token-ca-cert-hash sha256:3cbdd81868c4470767b5c82af37fb63c2240c98e5f00eb0458df99350cabb7b3
</code></pre>
<h4 id="å¦‚æœé‡å¤å¯¼å…¥èŠ‚ç‚¹æŠ¥error"><a href="#å¦‚æœé‡å¤å¯¼å…¥èŠ‚ç‚¹æŠ¥error" class="headerlink" title="å¦‚æœé‡å¤å¯¼å…¥èŠ‚ç‚¹æŠ¥error"></a>å¦‚æœé‡å¤å¯¼å…¥èŠ‚ç‚¹æŠ¥error</h4><p>ä½ è¿™ä¸ªé—®é¢˜æ˜¯ç”±äº <strong><code>kubeadm join</code> é‡å¤æ‰§è¡Œå¯¼è‡´èŠ‚ç‚¹ä¸Šå·²æœ‰æ®‹ç•™çš„é…ç½®æ–‡ä»¶å’Œç«¯å£å ç”¨</strong>ï¼Œæ‰€ä»¥æŠ¥é”™ã€‚</p>
<hr>
<hr>
<h2 id="âœ…-æ­£ç¡®å¤„ç†æ–¹å¼ï¼šé‡ç½®-node-èŠ‚ç‚¹åé‡æ–°-join"><a href="#âœ…-æ­£ç¡®å¤„ç†æ–¹å¼ï¼šé‡ç½®-node-èŠ‚ç‚¹åé‡æ–°-join" class="headerlink" title="âœ… æ­£ç¡®å¤„ç†æ–¹å¼ï¼šé‡ç½® node èŠ‚ç‚¹åé‡æ–° join"></a>âœ… æ­£ç¡®å¤„ç†æ–¹å¼ï¼š<strong>é‡ç½® node èŠ‚ç‚¹åé‡æ–° join</strong></h2><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼š</p>
<h3 id="1-é‡ç½®-node-èŠ‚ç‚¹é…ç½®"><a href="#1-é‡ç½®-node-èŠ‚ç‚¹é…ç½®" class="headerlink" title="1. é‡ç½® node èŠ‚ç‚¹é…ç½®"></a>1. <strong>é‡ç½® node èŠ‚ç‚¹é…ç½®</strong></h3><pre><code>kubeadm reset -f
</code></pre>
<h3 id="2-æ¸…ç†-CNI-ç½‘ç»œé…ç½®"><a href="#2-æ¸…ç†-CNI-ç½‘ç»œé…ç½®" class="headerlink" title="2. æ¸…ç† CNI ç½‘ç»œé…ç½®"></a>2. <strong>æ¸…ç† CNI ç½‘ç»œé…ç½®</strong></h3><pre><code>rm -rf /etc/cni/net.d
</code></pre>
<h3 id="3-é‡å¯ç›¸å…³æœåŠ¡"><a href="#3-é‡å¯ç›¸å…³æœåŠ¡" class="headerlink" title="3. é‡å¯ç›¸å…³æœåŠ¡"></a>3. <strong>é‡å¯ç›¸å…³æœåŠ¡</strong></h3><pre><code>systemctl restart kubelet
systemctl restart containerd
</code></pre>
<h3 id="4-é‡æ–°-join"><a href="#4-é‡æ–°-join" class="headerlink" title="4. é‡æ–° join"></a>4. <strong>é‡æ–° join</strong></h3><p>ç„¶åå†æ‰§è¡Œä½ åŸæ¥çš„ join ç”Ÿæˆçš„å‘½ä»¤å³å¯ï¼š</p>
<pre><code>kubeadm join 192.168.200.129:6443 --token zjoxjc.f58nh7lixocvjpgj \
  --discovery-token-ca-cert-hash sha256:3cbdd81868c4470767b5c82af37fb63c2240c98e5f00eb0458df99350cabb7b3
</code></pre>
<hr>
<h2 id="-1"><a href="#-1" class="headerlink" title=""></a></h2></blockquote>
<blockquote>
<p>[root@k8s-master k8s]# docker pull docker.io&#x2F;calico&#x2F;node:v3.26.1<br>v3.26.1: Pulling from calico&#x2F;node<br>c998069b4a7c: Downloading [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;   ]   81.5MB&#x2F;86.58MB<br>6cf92fa5251d: Download complete</p>
<p>[root@k8s-master k8s]# docker save docker.io&#x2F;calico&#x2F;node:v3.26.1 -o calico-node-v3.26.1.tar<br>[root@k8s-master k8s]# ctr images import â€“all-platforms calico-node-v3.26.1.tar<br>unpacking docker.io&#x2F;calico&#x2F;node:v3.26.1 (sha256:568fb25384d6460176b5528381a2d6fef36d110cfaddda5ae286afbf8fe15d5b)â€¦done<br>[root@k8s-master k8s]# ctr images ls | grep calico&#x2F;node<br>docker.io&#x2F;calico&#x2F;node:v3.26.1 application&#x2F;vnd.docker.distribution.manifest.v2+json sha256:568fb25384d6460176b5528381a2d6fef36d110cfaddda5ae286afbf8fe15d5b 247.7 MiB linux&#x2F;arm64 -<br>[root@k8s-master k8s]# kubectl -n kube-system delete pod -l k8s-app&#x3D;calico-node</p>
<p>ï¼ˆä½ åˆšæ‰å°±æ˜¯ <code>calico_cni</code> æ‹‰å¤±è´¥ï¼‰</p>
<p>ä½ å¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤ä¸€å£æ°”æ›¿æ¢ï¼š</p>
<pre><code>sed -i &#39;s@docker.io/calico/cni@registry.cn-hangzhou.aliyuncs.com/chenby/calico_cni@g&#39; calico.yaml
sed -i &#39;s@docker.io/calico/pod2daemon-flexvol@registry.cn-hangzhou.aliyuncs.com/chenby/calico_pod2daemon-flexvol@g&#39; calico.yaml
sed -i &#39;s@docker.io/calico/node@registry.cn-hangzhou.aliyuncs.com/chenby/calico_node@g&#39; calico.yaml
sed -i &#39;s@docker.io/calico/kube-controllers@registry.cn-hangzhou.aliyuncs.com/chenby/calico_kube-controllers@g&#39; calico.yaml
</code></pre>
<hr>
<h3 id="ğŸ”§-æ­¥éª¤å››ï¼šé‡æ–°éƒ¨ç½²"><a href="#ğŸ”§-æ­¥éª¤å››ï¼šé‡æ–°éƒ¨ç½²" class="headerlink" title="ğŸ”§ æ­¥éª¤å››ï¼šé‡æ–°éƒ¨ç½²"></a>ğŸ”§ æ­¥éª¤å››ï¼šé‡æ–°éƒ¨ç½²</h3><pre><code>kubectl apply -f calico.yaml
</code></pre>
</blockquote>
<blockquote>
<p>sudo tee &#x2F;etc&#x2F;docker&#x2F;daemon.json &lt;&lt;-â€˜EOFâ€™<br>{<br>  â€œregistry-mirrorsâ€: [â€œ<a target="_blank" rel="noopener" href="https://docker.m.daocloud.io&quot;,&quot;https//p5lmkba8.mirror.aliyuncs.com&quot;,&quot;https://registry.docker-cn.com&quot;]">https://docker.m.daocloud.io&quot;,&quot;https://p5lmkba8.mirror.aliyuncs.com&quot;,&quot;https://registry.docker-cn.com&quot;]</a><br>}<br>EOF<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>
<hr>
<hr>
<hr>
<h3 id="å¤§å‘ï¼šå­èŠ‚ç‚¹çš„calicoä¸€ç›´å¤„äºåˆå§‹åŒ–æ— æ³•å¯åŠ¨è§£å†³æ–¹æ¡ˆ"><a href="#å¤§å‘ï¼šå­èŠ‚ç‚¹çš„calicoä¸€ç›´å¤„äºåˆå§‹åŒ–æ— æ³•å¯åŠ¨è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¤§å‘ï¼šå­èŠ‚ç‚¹çš„calicoä¸€ç›´å¤„äºåˆå§‹åŒ–æ— æ³•å¯åŠ¨è§£å†³æ–¹æ¡ˆ"></a><span style="color:red"><strong>å¤§å‘ï¼šå­èŠ‚ç‚¹çš„calicoä¸€ç›´å¤„äºåˆå§‹åŒ–æ— æ³•å¯åŠ¨è§£å†³æ–¹æ¡ˆ</strong></span></h3><p>è™½ç„¶éƒ½åœ¨ï¼Œä½†å…³é”®æ˜¯containerdé…ç½®æ˜¯å¦é»˜è®¤ç”¨çš„æ˜¯ <code>registry.k8s.io/pause:3.6</code> ï¼Œå¯¼è‡´kubeletæ‹‰è¿™ä¸ªé•œåƒæ—¶å‡ºé”™ã€‚</p>
<hr>
<p>è¯·ä½ æ£€æŸ¥å¹¶ä¿®æ”¹ <strong>containerdé…ç½®</strong>ï¼Œæ˜ç¡®æŒ‡å®š <code>sandbox_image</code> ç”¨é˜¿é‡Œäº‘é•œåƒï¼š</p>
<pre><code>cat /etc/containerd/config.toml | grep sandbox_image
</code></pre>
<p>å¦‚æœæ²¡è®¾ç½®ï¼Œæ‰§è¡Œï¼š</p>
<pre><code>containerd config default &gt; /etc/containerd/config.toml.backup
containerd config default &gt; /etc/containerd/config.toml
</code></pre>
<p>ç„¶åç¼–è¾‘ <code>/etc/containerd/config.toml</code>ï¼Œæ‰¾åˆ° <code>[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd]</code> éƒ¨åˆ†ï¼ŒåŠ å…¥æˆ–ä¿®æ”¹ä¸ºï¼š</p>
<pre><code>sandbox_image = &quot;registry.aliyuncs.com/google_containers/pause:3.6&quot;
</code></pre>
<p>ä¿å­˜åï¼Œé‡å¯containerdï¼š</p>
<pre><code>systemctl restart containerd
</code></pre>
<p>ç„¶åé‡å¯ kubeletï¼š</p>
<pre><code>systemctl restart kubelet
</code></pre>
<hr>
<p>ç¡®è®¤ <code>containerRuntimeEndpoint</code> åœ¨ kubelet é…ç½®æ–‡ä»¶æˆ–å¯åŠ¨å‚æ•°ä¸­æœ‰æ­£ç¡®æŒ‡å‘ï¼š</p>
<pre><code>containerRuntimeEndpoint: unix:///run/containerd/containerd.sock
</code></pre>
<hr>
<p>æœ€ååˆ é™¤calico-nodeå’Œkube-proxy podï¼Œè§¦å‘é‡æ–°è°ƒåº¦ï¼š</p>
<pre><code>kubectl -n kube-system delete pod -l k8s-app=calico-node
kubectl -n kube-system delete pod -l k8s-app=kube-proxy
</code></pre>
<p>ç„¶åè§‚å¯ŸèŠ‚ç‚¹çŠ¶æ€å’ŒPodçŠ¶æ€ã€‚</p>
<p><code>kubectl get nodes</code> æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€<br><code>kubectl get pods -n kube-system -o wide</code> æŸ¥çœ‹podçŠ¶æ€</p>
<hr>
<p>æ€»ç»“ï¼š<br> <strong>ç¡®ä¿ containerd é…ç½®é‡Œçš„ sandbox_image æŒ‡å‘é˜¿é‡Œäº‘é•œåƒï¼Œé¿å…kubeletæ‹‰ä¸åˆ°å®˜æ–¹registry.k8s.ioçš„é•œåƒå¯¼è‡´ç½‘ç»œæ’ä»¶åˆå§‹åŒ–å¤±è´¥ï¼Œä»è€Œä½¿èŠ‚ç‚¹ä¸€ç›´NotReadyã€‚</strong></p>
<hr>
<hr>
<hr>
<h2 id="æŠ¥é”™ï¼š"><a href="#æŠ¥é”™ï¼š" class="headerlink" title="æŠ¥é”™ï¼š"></a>æŠ¥é”™ï¼š</h2><blockquote>
<p>calico-node-xb2js                          0&#x2F;1     CrashLoopBackOff   9 (4m12s ago)   25m   192.168.200.130   k8s-node1 </p>
</blockquote>
<h3 id="â—ä½ çš„-k8s-node1-ä¸Š-ç«¯å£-9099-è¢«-Nginx-å ç”¨äº†ï¼Œè€Œè¿™ä¸ªç«¯å£æ­£æ˜¯-Calico-é»˜è®¤ç”¨äºå¥åº·æ£€æŸ¥çš„ç«¯å£ã€‚"><a href="#â—ä½ çš„-k8s-node1-ä¸Š-ç«¯å£-9099-è¢«-Nginx-å ç”¨äº†ï¼Œè€Œè¿™ä¸ªç«¯å£æ­£æ˜¯-Calico-é»˜è®¤ç”¨äºå¥åº·æ£€æŸ¥çš„ç«¯å£ã€‚" class="headerlink" title="â—ä½ çš„ k8s-node1 ä¸Š ç«¯å£ 9099 è¢« Nginx å ç”¨äº†ï¼Œè€Œè¿™ä¸ªç«¯å£æ­£æ˜¯ Calico é»˜è®¤ç”¨äºå¥åº·æ£€æŸ¥çš„ç«¯å£ã€‚"></a>â—ä½ çš„ <code>k8s-node1</code> ä¸Š <strong>ç«¯å£ <code>9099</code> è¢« Nginx å ç”¨äº†</strong>ï¼Œè€Œè¿™ä¸ªç«¯å£æ­£æ˜¯ <code>Calico</code> é»˜è®¤ç”¨äºå¥åº·æ£€æŸ¥çš„ç«¯å£ã€‚</h3><p>å¯¼è‡´ç»“æœå°±æ˜¯ï¼š</p>
<blockquote>
<p><code>calico-node</code> å¯åŠ¨å¤±è´¥å¹¶åå¤æŠ¥é”™ <code>listen tcp 127.0.0.1:9099: bind: address already in use</code>ï¼ŒPod çŠ¶æ€è¿›å…¥ <code>CrashLoopBackOff</code>ã€‚</p>
</blockquote>
<hr>
<h2 id="âœ…-è§£å†³æ–¹æ¡ˆ"><a href="#âœ…-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="âœ… è§£å†³æ–¹æ¡ˆ"></a>âœ… è§£å†³æ–¹æ¡ˆ</h2><p>ä½ å¯ä»¥é€‰ <strong>å…¶ä¸­ä¸€ä¸ªæ–¹æ³•</strong>ï¼š</p>
<hr>
<h3 id="âœ…-æ–¹æ¡ˆä¸€ï¼šæ”¹-Nginx-çš„ç«¯å£ï¼ˆæ¨èï¼‰"><a href="#âœ…-æ–¹æ¡ˆä¸€ï¼šæ”¹-Nginx-çš„ç«¯å£ï¼ˆæ¨èï¼‰" class="headerlink" title="âœ… æ–¹æ¡ˆä¸€ï¼šæ”¹ Nginx çš„ç«¯å£ï¼ˆæ¨èï¼‰"></a>âœ… <strong>æ–¹æ¡ˆä¸€ï¼šæ”¹ Nginx çš„ç«¯å£ï¼ˆæ¨èï¼‰</strong></h3><ol>
<li><p>æ‰¾åˆ°ä½ çš„ <code>nginx</code> é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸åœ¨ <code>vi /etc/nginx/nginx.conf</code> æˆ– <code>/etc/nginx/conf.d/xxx.conf</code>ï¼‰</p>
</li>
<li><p>ä¿®æ”¹ <code>listen 9877;</code> ä¸ºå…¶ä»–ç«¯å£ï¼Œæ¯”å¦‚ <code>listen 8081;</code></p>
</li>
<li><p>é‡å¯ nginxï¼š</p>
<pre><code>systemctl restart nginx
</code></pre>
</li>
<li><p>åˆ é™¤é‡å¯ <code>calico-node</code> Podï¼š</p>
<pre><code>kubectl delete pod -n kube-system -l k8s-app=calico-node --field-selector spec.nodeName=k8s-node1
</code></pre>
</li>
<li><p>ç­‰å¾… Pod å˜æˆ <code>Running</code> çŠ¶æ€ã€‚</p>
</li>
</ol>
</blockquote>
<h3 id="åŸºäºKubernetes-x2F-K8Sæ„å»ºJenkinsæŒç»­é›†æˆå¹³å°-ä¸‹"><a href="#åŸºäºKubernetes-x2F-K8Sæ„å»ºJenkinsæŒç»­é›†æˆå¹³å°-ä¸‹" class="headerlink" title="åŸºäºKubernetes&#x2F;K8Sæ„å»ºJenkinsæŒç»­é›†æˆå¹³å°(ä¸‹)"></a>åŸºäºKubernetes&#x2F;K8Sæ„å»ºJenkinsæŒç»­é›†æˆå¹³å°(ä¸‹)</h3><h4 id="å®‰è£…å’Œé…ç½®NFSæ–‡ä»¶å…±äº«æœåŠ¡å™¨"><a href="#å®‰è£…å’Œé…ç½®NFSæ–‡ä»¶å…±äº«æœåŠ¡å™¨" class="headerlink" title="å®‰è£…å’Œé…ç½®NFSæ–‡ä»¶å…±äº«æœåŠ¡å™¨"></a>å®‰è£…å’Œé…ç½®NFSæ–‡ä»¶å…±äº«æœåŠ¡å™¨</h4><h6 id="å®‰è£…å’Œé…ç½®-NFS"><a href="#å®‰è£…å’Œé…ç½®-NFS" class="headerlink" title="å®‰è£…å’Œé…ç½® NFS"></a>å®‰è£…å’Œé…ç½® NFS</h6><p>NFSï¼ˆNetwork File Systemï¼‰ï¼Œå®ƒæœ€å¤§çš„åŠŸèƒ½å°±æ˜¯å¯ä»¥é€šè¿‡ç½‘ç»œï¼Œè®©ä¸åŒçš„æœºå™¨ã€ä¸åŒçš„æ“ä½œç³»ç»Ÿå¯ä»¥å…±äº«å½¼æ­¤çš„æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨NFSå…±äº«Jenkinsè¿è¡Œçš„é…ç½®æ–‡ä»¶ã€Mavençš„ä»“åº“ä¾èµ–æ–‡ä»¶ç­‰</p>
<p>æˆ‘ä»¬æŠŠNFSæœåŠ¡å™¨å®‰è£…åœ¨192.168.200.129æœºå™¨ä¸Š</p>
<ul>
<li><p>å®‰è£…NFSæœåŠ¡ï¼ˆåœ¨æ‰€æœ‰K8Sçš„èŠ‚ç‚¹éƒ½éœ€è¦å®‰è£…ï¼‰</p>
<p><code>yum install -y nfs-utils</code> ã€ä»…æ­¤è¿™ä¸ªéƒ½è¦è¿è¡Œã€‘ </p>
</li>
<li><p>åˆ›å»ºå…±äº«ç›®å½•</p>
<pre><code class="yaml">mkdir -p /opt/nfs/jenkins
ç¼–å†™NFSçš„å…±äº«é…ç½®ï¼š
vi /etc/exports      
å†…å®¹å¦‚ä¸‹:  ä»£è¡¨å¯¹æ‰€æœ‰IPéƒ½å¼€æ”¾æ­¤ç›®å½•ï¼Œrwæ˜¯è¯»å†™
ã€no_root_suqash rootç”¨æˆ·ç”Ÿæˆçš„æ•°æ®ä¸åšèº«ä»½è½¬æ¢ï¼Œä¹Ÿå°±åŸæ¥æ˜¯rootï¼Œå½’rootç”¨æˆ·ç®¡ç†ã€‚æƒé™å¤ªå¤§å®é™…éœ€è¦è¯„ä¼°ã€‘
/opt/nfs/jenkins    *(rw,no_root_squash)           
</code></pre>
</li>
<li><p>å¯åŠ¨æœåŠ¡</p>
<pre><code class="yaml">systemctl enable nfs   å¼€æœºå¯åŠ¨
systemctl start nfs    å¯åŠ¨
</code></pre>
</li>
<li><p>æŸ¥çœ‹NFSå…±äº«ç›®å½•</p>
<pre><code class="yaml">showmount -e 192.168.200.129
åœ¨è¿™ä¹‹å‰ä¹Ÿè¦å®‰è£…nfsæœåŠ¡ï¼šyum install -y nfs-utils
</code></pre>
<blockquote>
<p>[root@k8s-node1 ~]# showmount -e 192.168.200.129<br>Export list for 192.168.200.129:<br>&#x2F;opt&#x2F;nfs&#x2F;jenkins *</p>
</blockquote>
</li>
</ul>
<h3 id="åœ¨Kuberneteså®‰è£…Jenkins-Master"><a href="#åœ¨Kuberneteså®‰è£…Jenkins-Master" class="headerlink" title="åœ¨Kuberneteså®‰è£…Jenkins-Master"></a>åœ¨Kuberneteså®‰è£…Jenkins-Master</h3><h5 id="åˆ›å»ºNFS-client-provisioner"><a href="#åˆ›å»ºNFS-client-provisioner" class="headerlink" title="åˆ›å»ºNFS client provisioner"></a>åˆ›å»ºNFS client provisioner</h5><p>nfs-client-provisioner æ˜¯ä¸€ä¸ªKubernetesçš„ç®€æ˜“NFSçš„å¤–éƒ¨provisionerï¼Œæœ¬èº«ä¸æä¾›NFSï¼Œéœ€è¦ç°æœ‰ çš„NFSæœåŠ¡å™¨æä¾›å­˜å‚¨ã€‚</p>
<ul>
<li><p>ä¸Šä¼ nfs-client-provisioneræ„å»ºæ–‡ä»¶</p>
<p>æŠŠ<code>E:\Javaå®ä¾‹é¡¹ç›®1-20å¥—\èµ„æ–™-Jenkinsæ•™ç¨‹\Jenkinsèµ„æ–™\èµ„æ–™\èµ„æ–™\03.èµ„æ–™\k8s-jenkins</code>çš„<code>jenkins-master</code>å’Œ<code>nfs-client</code>ä¸Šä¼ åˆ°129Jenkinsè™šæ‹Ÿæœºä¸Šé¢</p>
<blockquote>
<p>[root@k8s-master ~]# cd jenkins-master&#x2F;<br>[root@k8s-master jenkins-master]# ll<br>æ€»ç”¨é‡ 16<br>-rw-râ€“râ€“ 1 root root 1874 7æœˆ   7 15:59 rbac.yaml<br>-rw-râ€“râ€“ 1 root root   87 7æœˆ   7 15:59 ServiceaAcount.yaml<br>-rw-râ€“râ€“ 1 root root  284 7æœˆ   7 15:59 Service.yaml      ã€å¯¹å¤–æš´éœ²ä¿¡æ¯ã€‘<br>-rw-râ€“râ€“ 1 root root 2116 7æœˆ   7 15:59 StatefulSet.yaml ã€æœ‰çŠ¶æ€åº”ç”¨ã€‘</p>
<p>[root@k8s-master ~]# cd nfs-client&#x2F;<br>[root@k8s-master nfs-client]# ll<br>æ€»ç”¨é‡ 12<br>-rw-râ€“râ€“ 1 root root  225 7æœˆ   7 16:03 class.yaml<br>-rw-râ€“râ€“ 1 root root  985 7æœˆ   7 16:03 deployment.yaml<br>-rw-râ€“râ€“ 1 root root 1526 7æœˆ   7 16:03 rbac.yaml<br>[root@k8s-master nfs-client]# <code>vi deployment.yaml</code><br>ä¿®æ”¹é‡Œé¢çš„åœ°å€ä¸ºä¸»èŠ‚ç‚¹Jenkinsçš„</p>
</blockquote>
</li>
<li><p>æ„å»ºnfs-client-provisionerçš„podèµ„æº</p>
<pre><code class="yaml">cd nfs-client
kubectl create -f .
</code></pre>
</li>
<li><p>æŸ¥çœ‹podæ˜¯å¦åˆ›å»ºæˆåŠŸ<br><code>kubectl get pods</code></p>
<blockquote>
<p>[root@k8s-master nfs-client]# kubectl get pods<br>NAME                                      READY   STATUS              RESTARTS   AGE<br>nfs-client-provisioner-68cd5845b6-dqqm2   0&#x2F;1     ContainerCreating   0          15s</p>
</blockquote>
</li>
</ul>
<blockquote>
<p><span style="color:red"><strong>è¿™é‡Œä¹Ÿæœ‰ä¸ªæ‹‰é•œåƒçš„é—®é¢˜ deployment.yamlçš„lizhenliang&#x2F;nfs-client-provisioner:latest</strong></span></p>
<p>æ¥ä¸‹æ¥æ“ä½œæ­¥éª¤ï¼š</p>
<h3 id="1-ä¿®æ”¹ä½ çš„-deployment-yaml-ä¸­çš„é•œåƒå­—æ®µï¼Œæ”¹æˆåˆšæ‹‰å–çš„é•œåƒï¼š"><a href="#1-ä¿®æ”¹ä½ çš„-deployment-yaml-ä¸­çš„é•œåƒå­—æ®µï¼Œæ”¹æˆåˆšæ‹‰å–çš„é•œåƒï¼š" class="headerlink" title="1. ä¿®æ”¹ä½ çš„ deployment.yaml ä¸­çš„é•œåƒå­—æ®µï¼Œæ”¹æˆåˆšæ‹‰å–çš„é•œåƒï¼š"></a>1. ä¿®æ”¹ä½ çš„ <code>deployment.yaml</code> ä¸­çš„é•œåƒå­—æ®µï¼Œæ”¹æˆåˆšæ‹‰å–çš„é•œåƒï¼š</h3><pre><code>containers:
  - name: nfs-client-provisioner
    image: quay.io/external_storage/nfs-client-provisioner:v3.1.0-k8s1.11
    # å…¶ä»–é…ç½®ä¿æŒä¸å˜
</code></pre>
<p>ç¡®ä¿ <code>env</code> å’Œ <code>volumes</code> ä¸­ NFS æœåŠ¡å™¨åœ°å€åŠè·¯å¾„æ­£ç¡®ï¼Œå’Œä½ ä¹‹å‰ç¡®è®¤çš„ä¸€è‡´ã€‚</p>
<hr>
<h3 id="2-åº”ç”¨æ›´æ–°åçš„-Deployment-é…ç½®ï¼š"><a href="#2-åº”ç”¨æ›´æ–°åçš„-Deployment-é…ç½®ï¼š" class="headerlink" title="2. åº”ç”¨æ›´æ–°åçš„ Deployment é…ç½®ï¼š"></a>2. åº”ç”¨æ›´æ–°åçš„ Deployment é…ç½®ï¼š</h3><pre><code>kubectl apply -f deployment.yaml
</code></pre>
<hr>
<h3 id="3-æŸ¥çœ‹-Pod-çŠ¶æ€ï¼š"><a href="#3-æŸ¥çœ‹-Pod-çŠ¶æ€ï¼š" class="headerlink" title="3. æŸ¥çœ‹ Pod çŠ¶æ€ï¼š"></a>3. æŸ¥çœ‹ Pod çŠ¶æ€ï¼š</h3><pre><code>kubectl get pods -w
</code></pre>
<p>ç­‰å¾… Pod çŠ¶æ€å˜æˆ <code>Running</code> å’Œ <code>READY 1/1</code>ã€‚</p>
<blockquote>
<p>[root@k8s-master nfs-client]# kubectl get pods -w<br>NAME                                      READY   STATUS    RESTARTS   AGE<br>nfs-client-provisioner-7d79bcf5d4-tddhl   1&#x2F;1     Running   0          3m33s</p>
</blockquote>
<pre><code class="yaml">å¯ç”¨çš„deployment.yaml ä½ç½®åœ¨129æœºå™¨çš„/root/nfs-client

apiVersion: v1
kind: ServiceAccount
metadata:
  name: nfs-client-provisioner
---
kind: Deployment
apiVersion: apps/v1
metadata:
  name: nfs-client-provisioner
spec:
  replicas: 1
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: nfs-client-provisioner
  template:
    metadata:
      labels:
        app: nfs-client-provisioner
    spec:
      serviceAccountName: nfs-client-provisioner
      containers:
        - name: nfs-client-provisioner
          image: quay.io/external_storage/nfs-client-provisioner:v3.1.0-k8s1.11
          volumeMounts:
            - name: nfs-client-root
              mountPath: /persistentvolumes
          env:
            - name: PROVISIONER_NAME
              value: fuseim.pri/ifs
            - name: NFS_SERVER
              value: 192.168.200.129 
            - name: NFS_PATH
              value: /opt/nfs/jenkins/
      volumes:
        - name: nfs-client-root
          nfs:
            server: 192.168.200.129
            path: /opt/nfs/jenkins/
</code></pre>
</blockquote>
<ul>
<li><p>è¿”å›<code>jenkins-master</code>ç›®å½•</p>
<blockquote>
<p>[root@k8s-master ~]# cd jenkins-master&#x2F;<br>[root@k8s-master jenkins-master]#<br>[root@k8s-master jenkins-master]# <code>kubectl create namespace kube-ops</code><br>namespace&#x2F;kube-ops created<br>[root@k8s-master jenkins-master]# <code>kubectl create -f .</code><br>âœ… å¦‚æœä½ åªæ˜¯æƒ³é‡æ–°éƒ¨ç½²ï¼Œå¯ä»¥æ”¹ç”¨ <code>kubectl apply -f .</code> ï¼ˆ<strong>æ¨è</strong>ï¼Œç”¨äºæ›´æ–°å·²æœ‰èµ„æºï¼‰</p>
<p>âŒ å¦‚æœä½ è¦é‡æ–°åˆå§‹åŒ–ï¼Œå…ˆåˆ é™¤æ—§èµ„æºï¼š</p>
<pre><code>kubectl delete -f . &amp;&amp; kubectl create -f .
</code></pre>
</blockquote>
</li>
</ul>
<blockquote>
<p><span style="color:red">è¿™é‡ŒæŠ¥é”™å› ä¸ºæœ‰ä¸€äº›è¿‡æ—¶äº†çš„ éœ€è¦æ›´æ”¹ æ³¨æ„æ˜¯åœ¨<code>/root/jenkins-master</code>ä¸­çš„rbac.yaml</span><br>ä½ è¿™ä¸ªé—®é¢˜æ ¹æºå°±æ˜¯ apiVersion ä½¿ç”¨äº† <code>rbac.authorization.k8s.io/v1beta1</code>ï¼Œæ–°ç‰ˆ Kubernetes ä¸å†æ”¯æŒè¿™ä¸ªç‰ˆæœ¬äº†ï¼Œå¿…é¡»æ”¹æˆ <code>rbac.authorization.k8s.io/v1</code>ã€‚</p>
<p>å¦å¤–ï¼Œä½  <code>ClusterRole</code> ä¸åº”è¯¥å¸¦ <code>namespace</code> å­—æ®µï¼Œå› ä¸º ClusterRole æ˜¯é›†ç¾¤çº§åˆ«çš„èµ„æºï¼Œä¸å±äºæŸä¸ªå‘½åç©ºé—´ã€‚</p>
<hr>
<p>æˆ‘å¸®ä½ æ”¹æˆç¬¦åˆæœ€æ–°æ ‡å‡†çš„ç‰ˆæœ¬ï¼Œæ³¨æ„å‡ ç‚¹ï¼š</p>
<ul>
<li>æ‰€æœ‰ <code>rbac.authorization.k8s.io/v1beta1</code> æ”¹ä¸º <code>rbac.authorization.k8s.io/v1</code></li>
<li>åˆ é™¤ <code>ClusterRole</code> ä¸­çš„ <code>namespace</code></li>
<li>Role å’Œ RoleBinding ä¿ç•™ <code>namespace: kube-ops</code></li>
<li>RoleBinding å’Œ ClusterRoleBinding ä¸­çš„ <code>subjects</code> namespace ä¿æŒå’Œ ServiceAccount ä¸€è‡´</li>
</ul>
<pre><code class="yaml">kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: jenkins
  namespace: kube-ops
rules:
  - apiGroups: [&quot;extensions&quot;, &quot;apps&quot;]
    resources: [&quot;deployments&quot;]
    verbs: [&quot;create&quot;, &quot;delete&quot;, &quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;patch&quot;, &quot;update&quot;]
  - apiGroups: [&quot;&quot;]
    resources: [&quot;services&quot;]
    verbs: [&quot;create&quot;, &quot;delete&quot;, &quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;patch&quot;, &quot;update&quot;]
  - apiGroups: [&quot;&quot;]
    resources: [&quot;pods&quot;]
    verbs: [&quot;create&quot;,&quot;delete&quot;,&quot;get&quot;,&quot;list&quot;,&quot;patch&quot;,&quot;update&quot;,&quot;watch&quot;]
  - apiGroups: [&quot;&quot;]
    resources: [&quot;pods/exec&quot;]
    verbs: [&quot;create&quot;,&quot;delete&quot;,&quot;get&quot;,&quot;list&quot;,&quot;patch&quot;,&quot;update&quot;,&quot;watch&quot;]
  - apiGroups: [&quot;&quot;]
    resources: [&quot;pods/log&quot;]
    verbs: [&quot;get&quot;,&quot;list&quot;,&quot;watch&quot;]
  - apiGroups: [&quot;&quot;]
    resources: [&quot;secrets&quot;]
    verbs: [&quot;get&quot;]

---
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: jenkins
  namespace: kube-ops
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: jenkins
subjects:
  - kind: ServiceAccount
    name: jenkins
    namespace: kube-ops

---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: jenkinsClusterRole
rules:
  - apiGroups: [&quot;&quot;]
    resources: [&quot;pods&quot;]
    verbs: [&quot;create&quot;,&quot;delete&quot;,&quot;get&quot;,&quot;list&quot;,&quot;patch&quot;,&quot;update&quot;,&quot;watch&quot;]
  - apiGroups: [&quot;&quot;]
    resources: [&quot;pods/exec&quot;]
    verbs: [&quot;create&quot;,&quot;delete&quot;,&quot;get&quot;,&quot;list&quot;,&quot;patch&quot;,&quot;update&quot;,&quot;watch&quot;]
  - apiGroups: [&quot;&quot;]
    resources: [&quot;pods/log&quot;]
    verbs: [&quot;get&quot;,&quot;list&quot;,&quot;watch&quot;]
  - apiGroups: [&quot;&quot;]
    resources: [&quot;secrets&quot;]
    verbs: [&quot;get&quot;]

---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: jenkinsClusterRoleBinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: jenkinsClusterRole
subjects:
  - kind: ServiceAccount
    name: jenkins
    namespace: kube-ops
</code></pre>
<p>ä¿å­˜åï¼Œç”¨ï¼š</p>
<pre><code>kubectl apply -f rbac.yaml
</code></pre>
<p>åº”è¯¥å°±ä¸ä¼šå†æŠ¥æ‰¾ä¸åˆ°èµ„æºç±»å‹çš„é”™è¯¯äº†ã€‚</p>
<blockquote>
<p>æˆåŠŸï¼ï¼<br>service&#x2F;jenkins created<br>serviceaccount&#x2F;jenkins created<br>statefulset.apps&#x2F;jenkins created<br>role.rbac.authorization.k8s.io&#x2F;jenkins created<br>rolebinding.rbac.authorization.k8s.io&#x2F;jenkins created<br>clusterrole.rbac.authorization.k8s.io&#x2F;jenkinsClusterRole created<br>clusterrolebinding.rbac.authorization.k8s.io&#x2F;jenkinsClusterRoleBinding created</p>
</blockquote>
<hr>
<hr>
<p>è¾“å…¥<code>kubectl get pod --namespace kube-ops</code></p>
</blockquote>
<ul>
<li><blockquote>
<p>[root@k8s-master jenkins-master]# <code>kubectl get pod --namespace kube-ops</code><br>NAME        READY   STATUS    RESTARTS   AGE</p>
<p>[root@k8s-master jenkins-master]# <code>kubectl get service --namespace kube-ops</code><br>æ›´è¯¦ç»†çš„æŸ¥çœ‹ï¼š<code>kubectl get service --namespace kube-ops -o wide</code><br>NAME      TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)                          AGE<br>jenkins   NodePort   10.1.85.222   <none>        8080:30742&#x2F;TCP,50000:31261&#x2F;TCP   8m1s</p>
</blockquote>
</li>
</ul>
<blockquote>
<h3 id="å¦‚æœä¸èƒ½runningçœ‹è¿™é‡Œï¼"><a href="#å¦‚æœä¸èƒ½runningçœ‹è¿™é‡Œï¼" class="headerlink" title="å¦‚æœä¸èƒ½runningçœ‹è¿™é‡Œï¼"></a><span style = "color:red">å¦‚æœä¸èƒ½runningçœ‹è¿™é‡Œï¼</span></h3><p>ä½ åº”è¯¥æŠŠ Deployment é‡Œçš„é•œåƒæ”¹æˆ <code>quay.io/external_storage/nfs-client-provisioner:v3.1.0-k8s1.11</code>ï¼Œè¿™æ · Pod å°±èƒ½æ­£å¸¸æ‹‰é•œåƒå¯åŠ¨äº†ã€‚</p>
<hr>
<h3 id="æ­£ç¡®ç¤ºä¾‹ç‰‡æ®µæ”¹æˆï¼š"><a href="#æ­£ç¡®ç¤ºä¾‹ç‰‡æ®µæ”¹æˆï¼š" class="headerlink" title="æ­£ç¡®ç¤ºä¾‹ç‰‡æ®µæ”¹æˆï¼š"></a>æ­£ç¡®ç¤ºä¾‹ç‰‡æ®µæ”¹æˆï¼š</h3><pre><code>containers:
  - name: nfs-client-provisioner
    image: quay.io/external_storage/nfs-client-provisioner:v3.1.0-k8s1.11
    volumeMounts:
      - name: nfs-client-root
        mountPath: /persistentvolumes
    env:
      - name: PROVISIONER_NAME
        value: fuseim.pri/ifs
      - name: NFS_SERVER
        value: 192.168.200.129
      - name: NFS_PATH
        value: /opt/nfs/jenkins/
volumes:
  - name: nfs-client-root
    nfs:
      server: 192.168.200.129
      path: /opt/nfs/jenkins/
</code></pre>
<hr>
<p>æ”¹å®Œåæ‰§è¡Œï¼š</p>
<pre><code>ã€kubectl apply -f deployment.yaml
kubectl delete pod -n default -l app=nfs-client-provisioner
kubectl get pods -n default -w
</code></pre>
<p>ç¡®è®¤ Pod å¿«é€Ÿå¯åŠ¨ä¸”çŠ¶æ€ä¸º Runningã€‚</p>
<hr>
<p>è¿™æ · PVC æ‰èƒ½è¢«æ­£ç¡®ç»‘å®šï¼Œ<code>jenkins</code> çš„ PVC Pending çŠ¶æ€æ‰ä¼šè§£å†³ã€‚</p>
<hr>
<hr>
<hr>
<p>ä½ è¿™è¾¹å·²ç»éå¸¸æ¥è¿‘è§£å†³äº†ï¼Œç›®å‰çš„ <strong>å”¯ä¸€é—®é¢˜æ˜¯ Provisioner æŠ¥äº† <code>selfLink was empty, can&#39;t make reference</code> çš„é”™è¯¯</strong>ï¼Œè¿™åœ¨ Kubernetes v1.20+ ä¸­æ˜¯<strong>å¸¸è§å…¼å®¹æ€§é—®é¢˜</strong>ï¼Œå› ä¸º <code>selfLink</code> å­—æ®µå·²ç»è¢«å¼ƒç”¨å¹¶é»˜è®¤ç¦ç”¨äº†ã€‚</p>
<hr>
<h2 id="âœ…-å½“å‰ç°çŠ¶ç¡®è®¤ï¼š"><a href="#âœ…-å½“å‰ç°çŠ¶ç¡®è®¤ï¼š" class="headerlink" title="âœ… å½“å‰ç°çŠ¶ç¡®è®¤ï¼š"></a>âœ… å½“å‰ç°çŠ¶ç¡®è®¤ï¼š</h2><table>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>çŠ¶æ€</th>
</tr>
</thead>
<tbody><tr>
<td>NFS æœåŠ¡</td>
<td>æ­£å¸¸å¯æŒ‚è½½ âœ…</td>
</tr>
<tr>
<td>Jenkins PVC</td>
<td>ä¸€ç›´ Pending âŒ</td>
</tr>
<tr>
<td>Provisioner Pod çŠ¶æ€</td>
<td>Running âœ…</td>
</tr>
<tr>
<td>Provisioner æ—¥å¿—æŠ¥é”™</td>
<td><code>selfLink</code> âŒ</td>
</tr>
<tr>
<td>StorageClass&#x2F;Provisioner å</td>
<td>ä¸€è‡´ âœ…</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸš¨-é—®é¢˜æ ¹å› "><a href="#ğŸš¨-é—®é¢˜æ ¹å› " class="headerlink" title="ğŸš¨ é—®é¢˜æ ¹å› "></a>ğŸš¨ é—®é¢˜æ ¹å› </h2><p><code>nfs-client-provisioner</code> çš„<strong>è€ç‰ˆæœ¬</strong>ä¾èµ–äº† <code>selfLink</code> å­—æ®µï¼Œä½†ä½ ç”¨çš„æ˜¯ <strong>Kubernetes v1.28</strong>ï¼Œä» v1.20 èµ· <code>selfLink</code> é»˜è®¤ç¦ç”¨ï¼Œå¯¼è‡´ï¼š</p>
<pre><code>unexpected error getting claim reference: selfLink was empty, can&#39;t make reference
</code></pre>
<h3 id="âœ…-è§£å†³æ–¹æ¡ˆï¼šç”¨å›½å†…é•œåƒæºä»£æ›¿"><a href="#âœ…-è§£å†³æ–¹æ¡ˆï¼šç”¨å›½å†…é•œåƒæºä»£æ›¿" class="headerlink" title="âœ… è§£å†³æ–¹æ¡ˆï¼šç”¨å›½å†…é•œåƒæºä»£æ›¿"></a>âœ… è§£å†³æ–¹æ¡ˆï¼šç”¨å›½å†…é•œåƒæºä»£æ›¿</h3><p>æˆ‘æ¨èä½ ä½¿ç”¨ é˜¿é‡Œäº‘åŠ é€Ÿé•œåƒ æˆ– [DockerHub é•œåƒä»£ç†]ã€‚ä¸‹é¢æˆ‘ç»™ä½ ä¸€ä»½ä¿®æ”¹å¥½çš„ <code>deployment.yaml</code>ï¼Œä½¿ç”¨äº†å›½å†…å¯è®¿é—®çš„é•œåƒä»“åº“åœ°å€ã€‚</p>
<hr>
<h3 id="âœ…-ä¿®æ”¹åçš„-deployment-yamlï¼ˆé€‚é…å›½å†…é•œåƒæºï¼‰"><a href="#âœ…-ä¿®æ”¹åçš„-deployment-yamlï¼ˆé€‚é…å›½å†…é•œåƒæºï¼‰" class="headerlink" title="âœ… ä¿®æ”¹åçš„ deployment.yamlï¼ˆé€‚é…å›½å†…é•œåƒæºï¼‰"></a>âœ… ä¿®æ”¹åçš„ <code>deployment.yaml</code>ï¼ˆé€‚é…å›½å†…é•œåƒæºï¼‰</h3><pre><code>yamlå¤åˆ¶ç¼–è¾‘apiVersion: v1
kind: ServiceAccount
metadata:
  name: nfs-client-provisioner
---
kind: Deployment
apiVersion: apps/v1
metadata:
  name: nfs-client-provisioner
spec:
  replicas: 1
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: nfs-client-provisioner
  template:
    metadata:
      labels:
        app: nfs-client-provisioner
    spec:
      serviceAccountName: nfs-client-provisioner
      containers:
        - name: nfs-client-provisioner
          image: registry.cn-hangzhou.aliyuncs.com/zhangshijie/nfs-subdir-external-provisioner:v4.0.2
          volumeMounts:
            - name: nfs-client-root
              mountPath: /persistentvolumes
          env:
            - name: PROVISIONER_NAME
              value: fuseim.pri/ifs
            - name: NFS_SERVER
              value: 192.168.200.129
            - name: NFS_PATH
              value: /opt/nfs/jenkins/
      volumes:
        - name: nfs-client-root
          nfs:
            server: 192.168.200.129
            path: /opt/nfs/jenkins/
</code></pre>
<hr>
<h3 id="ğŸ“Œ-æ“ä½œæ­¥éª¤"><a href="#ğŸ“Œ-æ“ä½œæ­¥éª¤" class="headerlink" title="ğŸ“Œ æ“ä½œæ­¥éª¤"></a>ğŸ“Œ æ“ä½œæ­¥éª¤</h3><ol>
<li>æŠŠä¸Šé¢å†…å®¹ä¿å­˜ä¸º <code>deployment.yaml</code></li>
<li>åº”ç”¨å¹¶é‡å»ºï¼š</li>
</ol>
<pre><code>kubectl apply -f deployment.yaml
kubectl delete pod -n default -l app=nfs-client-provisioner
</code></pre>
<ol>
<li>ç„¶åæ£€æŸ¥ PVC çŠ¶æ€æ˜¯å¦å˜æˆ <code>Bound</code>ï¼š</li>
</ol>
<pre><code>kubectl get pvc -n kube-ops
</code></pre>
<h3 id="è¿™é‡Œæ˜¯ç¬¬äºŒç§æ–¹æ³•-å·²å°è¯•å¯è¡Œ-ï¼"><a href="#è¿™é‡Œæ˜¯ç¬¬äºŒç§æ–¹æ³•-å·²å°è¯•å¯è¡Œ-ï¼" class="headerlink" title="è¿™é‡Œæ˜¯ç¬¬äºŒç§æ–¹æ³•[å·²å°è¯•å¯è¡Œ]ï¼"></a><span style = "color:red">è¿™é‡Œæ˜¯ç¬¬äºŒç§æ–¹æ³•[å·²å°è¯•å¯è¡Œ]ï¼</span></h3><p><code>/root/jenkins-master/</code></p>
<p>ä½ è´´å‡ºæ¥çš„ <code>StatefulSet.yaml</code> æ–‡ä»¶å·²ç»åŒ…å«äº†é•œåƒé…ç½®çš„ä½ç½®ï¼</p>
<hr>
<h3 id="ğŸ¯-é—®é¢˜å°±åœ¨è¿™ä¸€æ®µï¼š"><a href="#ğŸ¯-é—®é¢˜å°±åœ¨è¿™ä¸€æ®µï¼š" class="headerlink" title="ğŸ¯ é—®é¢˜å°±åœ¨è¿™ä¸€æ®µï¼š"></a>ğŸ¯ é—®é¢˜å°±åœ¨è¿™ä¸€æ®µï¼š</h3><pre><code>yamlå¤åˆ¶ç¼–è¾‘containers:
  - name: jenkins
    image: jenkins/jenkins:lts-alpine  ğŸ‘ˆ å°±æ˜¯è¿™è¡Œï¼ï¼ï¼
</code></pre>
<p>è¿™ä¸ª <code>image:</code> æŒ‡å®šçš„é•œåƒç›®å‰æ‹‰ä¸ä¸‹æ¥ï¼ˆä½ åˆšæ‰è¯•å›¾ç”¨çš„æ˜¯é˜¿é‡Œäº‘é•œåƒï¼Œç»“æœä¸å­˜åœ¨ï¼‰ï¼Œæ‰€ä»¥ä½ ç°åœ¨åªéœ€è¦ <strong>æ”¹æˆå¯ç”¨çš„é•œåƒåœ°å€</strong>ã€‚</p>
<hr>
<h3 id="âœ…-æ¨èæ”¹æ³•å¦‚ä¸‹ï¼š"><a href="#âœ…-æ¨èæ”¹æ³•å¦‚ä¸‹ï¼š" class="headerlink" title="âœ… æ¨èæ”¹æ³•å¦‚ä¸‹ï¼š"></a>âœ… æ¨èæ”¹æ³•å¦‚ä¸‹ï¼š</h3><pre><code>yamlå¤åˆ¶ç¼–è¾‘containers:
  - name: jenkins
    image: jenkins/jenkins:lts-jdk17   # âœ… æ¨èï¼šå¯æ‹‰å–çš„å®˜æ–¹ Jenkins é•œåƒ
    imagePullPolicy: IfNotPresent
</code></pre>
<blockquote>
<p>ğŸ’¡è¿™æ˜¯ Jenkins å®˜æ–¹æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼ˆå¸¦ JDK 17ï¼‰çš„é•œåƒï¼Œåœ¨ Docker Hub å¯ç”¨ï¼Œå›½å†…è®¿é—®å¯èƒ½æ…¢ä¸€ç‚¹ï¼Œä½†æ¯”ä½ åŸæ¥çš„é˜¿é‡Œäº‘é•œåƒé è°±ã€‚</p>
</blockquote>
<hr>
<h3 id="ğŸ› -ä¿®æ”¹æ­¥éª¤ï¼š"><a href="#ğŸ› -ä¿®æ”¹æ­¥éª¤ï¼š" class="headerlink" title="ğŸ›  ä¿®æ”¹æ­¥éª¤ï¼š"></a>ğŸ›  ä¿®æ”¹æ­¥éª¤ï¼š</h3><ol>
<li><p>æ‰“å¼€ <code>StatefulSet.yaml</code>ï¼š</p>
<pre><code>vim StatefulSet.yaml
</code></pre>
</li>
<li><p>æ‰¾åˆ°ï¼š</p>
<pre><code>image: jenkins/jenkins:lts-alpine
</code></pre>
</li>
<li><p>æ”¹æˆï¼š</p>
<pre><code>image: jenkins/jenkins:lts-jdk17
</code></pre>
</li>
<li><p>ä¿å­˜é€€å‡ºï¼ˆæŒ‰ <code>Esc</code> ç„¶åè¾“å…¥ <code>:wq</code>ï¼‰</p>
</li>
</ol>
<hr>
<h3 id="ğŸ”-ç„¶åé‡æ–°éƒ¨ç½²ï¼š"><a href="#ğŸ”-ç„¶åé‡æ–°éƒ¨ç½²ï¼š" class="headerlink" title="ğŸ” ç„¶åé‡æ–°éƒ¨ç½²ï¼š"></a>ğŸ” ç„¶åé‡æ–°éƒ¨ç½²ï¼š</h3><pre><code>kubectl apply -f StatefulSet.yaml
kubectl delete pod jenkins-0 -n kube-ops
</code></pre>
<blockquote>
<p>ç¬¬äºŒæ¡å‘½ä»¤æ˜¯ä¸ºäº†ç«‹åˆ»è®© Pod ä½¿ç”¨æ–°é•œåƒé‡å»ºã€‚</p>
</blockquote>
<blockquote>
<p>[root@k8s-master jenkins-master]# kubectl apply -f StatefulSet.yaml statefulset.apps&#x2F;jenkins configured [root@k8s-master jenkins-master]# kubectl delete pod jenkins-0 -n kube-ops pod â€œjenkins-0â€ deleted [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS              RESTARTS   AGE jenkins-0   0&#x2F;1     ContainerCreating   0          4s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS              RESTARTS   AGE jenkins-0   0&#x2F;1     ContainerCreating   0          8s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS              RESTARTS   AGE jenkins-0   0&#x2F;1     ContainerCreating   0          9s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS              RESTARTS   AGE jenkins-0   0&#x2F;1     ContainerCreating   0          10s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS              RESTARTS   AGE jenkins-0   0&#x2F;1     ContainerCreating   0          11s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS              RESTARTS   AGE jenkins-0   0&#x2F;1     ContainerCreating   0          11s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS              RESTARTS   AGE jenkins-0   0&#x2F;1     ContainerCreating   0          19s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS         RESTARTS   AGE jenkins-0   0&#x2F;1     ErrImagePull   0          24s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS         RESTARTS   AGE jenkins-0   0&#x2F;1     ErrImagePull   0          27s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS         RESTARTS   AGE jenkins-0   0&#x2F;1     ErrImagePull   0          27s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS         RESTARTS   AGE jenkins-0   0&#x2F;1     ErrImagePull   0          31s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS         RESTARTS   AGE jenkins-0   0&#x2F;1     ErrImagePull   0          32s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS             RESTARTS   AGE jenkins-0   0&#x2F;1     ImagePullBackOff   0          47s [root@k8s-master jenkins-master]#</p>
</blockquote>
<p>å¾ˆå¥½ï¼Œä½ çš„ Jenkins Pod ç°åœ¨å˜æˆäº†ï¼š</p>
<pre><code>STATUS: ImagePullBackOff
</code></pre>
<hr>
<h2 id="âœ…-è¿™è¯´æ˜ä½ å·²ç»ä¿®æ”¹æˆåŠŸäº†ï¼Œä½†èŠ‚ç‚¹è¿˜æ˜¯æ‹‰ä¸åˆ°é•œåƒã€‚"><a href="#âœ…-è¿™è¯´æ˜ä½ å·²ç»ä¿®æ”¹æˆåŠŸäº†ï¼Œä½†èŠ‚ç‚¹è¿˜æ˜¯æ‹‰ä¸åˆ°é•œåƒã€‚" class="headerlink" title="âœ… è¿™è¯´æ˜ä½ å·²ç»ä¿®æ”¹æˆåŠŸäº†ï¼Œä½†èŠ‚ç‚¹è¿˜æ˜¯æ‹‰ä¸åˆ°é•œåƒã€‚"></a>âœ… <strong>è¿™è¯´æ˜ä½ å·²ç»ä¿®æ”¹æˆåŠŸäº†ï¼Œä½†èŠ‚ç‚¹è¿˜æ˜¯æ‹‰ä¸åˆ°é•œåƒã€‚</strong></h2><p>æˆ‘ä»¬ç¡®è®¤ä¸‹ä½ ç”¨äº†å“ªä¸ªé•œåƒï¼Œæ‰§è¡Œï¼š</p>
<pre><code>kubectl get pod jenkins-0 -n kube-ops -o=jsonpath=&#39;&#123;.spec.containers[0].image&#125;&#39;
</code></pre>
<p>ä½ åº”è¯¥çœ‹åˆ°è¾“å‡ºç±»ä¼¼äºï¼š</p>
<pre><code>jenkins/jenkins:lts-jdk17
</code></pre>
<p>ç„¶åæˆ‘ä»¬æ¥æ’æŸ¥ä¸‹ä¸€æ­¥ã€‚</p>
<hr>
<h2 id="ğŸ§­-ä¸‹ä¸€æ­¥ï¼šå»èŠ‚ç‚¹ä¸Šæµ‹è¯•èƒ½å¦æ‰‹åŠ¨æ‹‰å–é•œåƒ"><a href="#ğŸ§­-ä¸‹ä¸€æ­¥ï¼šå»èŠ‚ç‚¹ä¸Šæµ‹è¯•èƒ½å¦æ‰‹åŠ¨æ‹‰å–é•œåƒ" class="headerlink" title="ğŸ§­ ä¸‹ä¸€æ­¥ï¼šå»èŠ‚ç‚¹ä¸Šæµ‹è¯•èƒ½å¦æ‰‹åŠ¨æ‹‰å–é•œåƒ"></a>ğŸ§­ ä¸‹ä¸€æ­¥ï¼šå»èŠ‚ç‚¹ä¸Šæµ‹è¯•èƒ½å¦æ‰‹åŠ¨æ‹‰å–é•œåƒ</h2><p><strong>è¿›å…¥ <code>k8s-node1</code> èŠ‚ç‚¹ï¼ˆPod åˆ†é…åœ¨å“ªä¸ªèŠ‚ç‚¹ï¼Œçœ‹ <code>kubectl describe pod</code> å¯ä»¥çœ‹åˆ°ï¼‰</strong>ï¼š</p>
<pre><code>ssh root@k8s-node1
</code></pre>
<p>åœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œï¼š</p>
<pre><code>docker pull jenkins/jenkins:lts-jdk17
</code></pre>
<p>æˆ–è€…å¦‚æœä½ ç”¨çš„æ˜¯ <code>containerd</code> ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼š</p>
<pre><code>ctr images pull docker.io/jenkins/jenkins:lts-jdk17
</code></pre>
<blockquote>
<p>[root@k8s-master jenkins-master]# kubectl apply -f StatefulSet.yaml statefulset.apps&#x2F;jenkins configured [root@k8s-master jenkins-master]# kubectl delete pod jenkins-0 -n kube-ops pod â€œjenkins-0â€ deleted [root@k8s-master jenkins-master]# clear [root@k8s-master jenkins-master]# ll æ€»ç”¨é‡ 16 -rw-râ€“râ€“ 1 root root 1863 7æœˆ   7 16:39 rbac.yaml -rw-râ€“râ€“ 1 root root   87 7æœˆ   7 15:59 ServiceaAcount.yaml -rw-râ€“râ€“ 1 root root  284 7æœˆ   7 15:59 Service.yaml -rw-râ€“râ€“ 1 root root 2117 7æœˆ   7 18:37 StatefulSet.yaml [root@k8s-master jenkins-master]# kubectl apply -f StatefulSet.yaml statefulset.apps&#x2F;jenkins configured [root@k8s-master jenkins-master]# kubectl delete pod jenkins-0 -n kube-ops pod â€œjenkins-0â€ deleted [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS              RESTARTS   AGE jenkins-0   0&#x2F;1     ContainerCreating   0          4s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS              RESTARTS   AGE jenkins-0   0&#x2F;1     ContainerCreating   0          8s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS              RESTARTS   AGE jenkins-0   0&#x2F;1     ContainerCreating   0          9s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS              RESTARTS   AGE jenkins-0   0&#x2F;1     ContainerCreating   0          10s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS              RESTARTS   AGE jenkins-0   0&#x2F;1     ContainerCreating   0          11s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS              RESTARTS   AGE jenkins-0   0&#x2F;1     ContainerCreating   0          11s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS              RESTARTS   AGE jenkins-0   0&#x2F;1     ContainerCreating   0          19s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS         RESTARTS   AGE jenkins-0   0&#x2F;1     ErrImagePull   0          24s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS         RESTARTS   AGE jenkins-0   0&#x2F;1     ErrImagePull   0          27s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS         RESTARTS   AGE jenkins-0   0&#x2F;1     ErrImagePull   0          27s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS         RESTARTS   AGE jenkins-0   0&#x2F;1     ErrImagePull   0          31s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS         RESTARTS   AGE jenkins-0   0&#x2F;1     ErrImagePull   0          32s [root@k8s-master jenkins-master]# kubectl get pod -n kube-ops NAME        READY   STATUS             RESTARTS   AGE jenkins-0   0&#x2F;1     ImagePullBackOff   0          47s [root@k8s-master jenkins-master]# ^C [root@k8s-master jenkins-master]# kubectl get pod jenkins-0 -n kube-ops -o&#x3D;jsonpath&#x3D;â€™{.spec.containers[0].image}â€™ jenkins&#x2F;jenkins:lts-jdk17[root@k8s-master jenkins-master]# ssh root@k8s-node1 The authenticity of host â€˜k8s-node1 (192.168.200.130)â€™ canâ€™t be established. ECDSA key fingerprint is SHA256:LMkCxwuWrKBih+Iy+lnayVkAyKdVG7JpVVR3TctpMuk. ECDSA key fingerprint is MD5:c1:76:72:fb:65:64:f8:d5:71:5b:38:a8:9b:07:a6:e6. Are you sure you want to continue connecting (yes&#x2F;no)? docker pull jenkins&#x2F;jenkins:lts-jdk17 Please type â€˜yesâ€™ or â€˜noâ€™: yes Warning: Permanently added â€˜k8s-node1â€™ (ECDSA) to the list of known hosts. root@k8s-node1â€™s password: Permission denied, please try again. root@k8s-node1â€™s password: Last failed login: Mon Jul  7 18:39:33 CST 2025 from k8s-master on ssh:notty There was 1 failed login attempt since the last successful login. Last login: Mon Jul  7 17:36:26 2025 from 192.168.200.2 [root@k8s-node1 ~]# docker pull jenkins&#x2F;jenkins:lts-jdk17 lts-jdk17: Pulling from jenkins&#x2F;jenkins 0c01110621e0: Pull complete 2315362e4443: Pull complete 4185f63a4bf1: Pull complete 51c9d25ed578: Pull complete 10709260192c: Pull complete 474c0ab7c65d: Pull complete 62d5bb186774: Pull complete f1c4b8ee4b6f: Pull complete 065b78ceb30c: Pull complete b99138e4f420: Pull complete e05a8359c72d: Pull complete 981fa0afce25: Pull complete Digest: sha256:dd570585c3adadefcfbeba915e27bf7feca1815a0ea8a659d46b51f54fc7ea06 Status: Downloaded newer image for jenkins&#x2F;jenkins:lts-jdk17 [root@k8s-node1 ~]#</p>
</blockquote>
<p>å¤ªå¥½äº†ï¼ä½ å·²ç»åœ¨ <code>k8s-node1</code> èŠ‚ç‚¹ä¸Š <strong>æˆåŠŸæ‹‰ä¸‹æ¥äº† Jenkins çš„é•œåƒ</strong>ï¼š</p>
<pre><code>bash


å¤åˆ¶ç¼–è¾‘
âœ… jenkins/jenkins:lts-jdk17 æ‹‰å–æˆåŠŸï¼
</code></pre>
<hr>
<h3 id="â“ä½†ä¸ºä»€ä¹ˆ-Pod-è¿˜æ˜¯æ‹‰ä¸åˆ°ï¼Ÿ"><a href="#â“ä½†ä¸ºä»€ä¹ˆ-Pod-è¿˜æ˜¯æ‹‰ä¸åˆ°ï¼Ÿ" class="headerlink" title="â“ä½†ä¸ºä»€ä¹ˆ Pod è¿˜æ˜¯æ‹‰ä¸åˆ°ï¼Ÿ"></a>â“ä½†ä¸ºä»€ä¹ˆ Pod è¿˜æ˜¯æ‹‰ä¸åˆ°ï¼Ÿ</h3><p>Kubernetes é»˜è®¤ä¸ä¼šè‡ªåŠ¨ä½¿ç”¨ä½ ç”¨ <code>docker pull</code> æ‹‰ä¸‹æ¥çš„é•œåƒï¼Œé™¤éä½ çš„ K8s ç”¨çš„å®¹å™¨è¿è¡Œæ—¶ <strong>å°±æ˜¯ Docker</strong>ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬ç¡®è®¤ä¸€ä¸‹ä½ çš„å®¹å™¨è¿è¡Œæ—¶æ˜¯ä¸æ˜¯ Dockerï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<pre><code>bash


å¤åˆ¶ç¼–è¾‘
ps -ef | grep kubelet | grep -v grep
</code></pre>
<p>çœ‹ç»“æœé‡Œé¢æœ‰æ²¡æœ‰ï¼š</p>
<ul>
<li><code>--container-runtime=docker</code> âœ…ï¼ˆè¯´æ˜ç”¨çš„æ˜¯ Dockerï¼‰</li>
<li>æˆ–è€…æœ‰ <code>containerd</code> æˆ– <code>cri-o</code> âŒï¼ˆè¯´æ˜ç”¨çš„æ˜¯ containerdï¼Œä¸ä¼šç”¨ docker æ‹‰çš„é•œåƒï¼‰</li>
</ul>
<hr>
<h3 id="âœ…-å¦‚æœä½ çœ‹åˆ°ç”¨çš„æ˜¯-containerdï¼ˆå¤§æ¦‚ç‡æ˜¯ï¼‰"><a href="#âœ…-å¦‚æœä½ çœ‹åˆ°ç”¨çš„æ˜¯-containerdï¼ˆå¤§æ¦‚ç‡æ˜¯ï¼‰" class="headerlink" title="âœ… å¦‚æœä½ çœ‹åˆ°ç”¨çš„æ˜¯ containerdï¼ˆå¤§æ¦‚ç‡æ˜¯ï¼‰"></a>âœ… å¦‚æœä½ çœ‹åˆ°ç”¨çš„æ˜¯ <code>containerd</code>ï¼ˆå¤§æ¦‚ç‡æ˜¯ï¼‰</h3><p>é‚£ä½ å°±éœ€è¦æŠŠ Docker æ‹‰ä¸‹æ¥çš„é•œåƒå¯¼å…¥ç»™ <code>containerd</code> ç”¨ï¼</p>
<hr>
<h2 id="ğŸ”„-å¯¼å…¥é•œåƒåˆ°-containerd-çš„æ–¹æ³•å¦‚ä¸‹ï¼š"><a href="#ğŸ”„-å¯¼å…¥é•œåƒåˆ°-containerd-çš„æ–¹æ³•å¦‚ä¸‹ï¼š" class="headerlink" title="ğŸ”„ å¯¼å…¥é•œåƒåˆ° containerd çš„æ–¹æ³•å¦‚ä¸‹ï¼š"></a>ğŸ”„ å¯¼å…¥é•œåƒåˆ° <code>containerd</code> çš„æ–¹æ³•å¦‚ä¸‹ï¼š</h2><ol>
<li><strong>åœ¨ <code>k8s-node1</code> èŠ‚ç‚¹ä¸Šä¿å­˜é•œåƒä¸º tar åŒ…ï¼š</strong></li>
</ol>
<pre><code>docker save jenkins/jenkins:lts-jdk17 -o jenkins.tar
</code></pre>
<ol>
<li><strong>ç”¨ <code>ctr</code> å‘½ä»¤å¯¼å…¥ç»™ containerd ä½¿ç”¨ï¼š</strong></li>
</ol>
<pre><code>ctr -n k8s.io images import jenkins.tar
</code></pre>
<ol>
<li><strong>éªŒè¯ containerd å·²ç»è¯†åˆ«ï¼š</strong></li>
</ol>
<pre><code>ctr -n k8s.io images ls | grep jenkins
</code></pre>
<p>ä½ åº”è¯¥çœ‹åˆ° <code>docker.io/jenkins/jenkins:lts-jdk17</code> è¿™ä¸€è¡Œã€‚</p>
<hr>
<h2 id="ğŸ”-ç„¶åé‡å¯-Podï¼š"><a href="#ğŸ”-ç„¶åé‡å¯-Podï¼š" class="headerlink" title="ğŸ” ç„¶åé‡å¯ Podï¼š"></a>ğŸ” ç„¶åé‡å¯ Podï¼š</h2><pre><code>kubectl delete pod jenkins-0 -n kube-ops
</code></pre>
<p>è¿‡ä¸€ä¼šå†æ‰§è¡Œï¼š</p>
<pre><code>kubectl get pod -n kube-ops
</code></pre>
<p>ä½ ç°åœ¨åœ¨ <strong>master èŠ‚ç‚¹ï¼ˆ192.168.200.129ï¼‰</strong>ï¼Œä½† Jenkins Pod è¢«è°ƒåº¦åˆ° <strong>node1 èŠ‚ç‚¹ï¼ˆ192.168.200.130ï¼‰</strong>ï¼Œæ‰€ä»¥é•œåƒå¿…é¡»åœ¨ node1 ä¸Šå¯ç”¨ã€‚è€Œä½ åˆšæ‰æ˜¯æ‰‹åŠ¨åœ¨ node1 ä¸Š <code>docker pull</code> äº† Jenkins é•œåƒï¼Œè¿™ä¸€æ­¥åšå¾— âœ…<strong>æ²¡é—®é¢˜</strong>ã€‚</p>
<hr>
<h2 id="âœ…-é—®é¢˜æ ¸å¿ƒç¡®è®¤"><a href="#âœ…-é—®é¢˜æ ¸å¿ƒç¡®è®¤" class="headerlink" title="âœ… é—®é¢˜æ ¸å¿ƒç¡®è®¤"></a>âœ… é—®é¢˜æ ¸å¿ƒç¡®è®¤</h2><blockquote>
<p>ä½ å½“å‰ç”¨çš„æ˜¯ Kubernetesï¼Œä½†é»˜è®¤çš„å®¹å™¨è¿è¡Œæ—¶ <strong>ä¸æ˜¯ Dockerï¼Œè€Œæ˜¯ containerd</strong>ï¼Œæ‰€ä»¥ï¼š</p>
<p>â— <strong>ä½ ç”¨ <code>docker pull</code> æ‹‰ä¸‹çš„é•œåƒ containerd ç”¨ä¸åˆ°</strong></p>
</blockquote>
<hr>
<h2 id="âœ…-è§£å†³æ–¹æ¡ˆï¼šæŠŠ-docker-é•œåƒå¯¼å…¥åˆ°-containerd-é‡Œ"><a href="#âœ…-è§£å†³æ–¹æ¡ˆï¼šæŠŠ-docker-é•œåƒå¯¼å…¥åˆ°-containerd-é‡Œ" class="headerlink" title="âœ… è§£å†³æ–¹æ¡ˆï¼šæŠŠ docker é•œåƒå¯¼å…¥åˆ° containerd é‡Œ"></a>âœ… è§£å†³æ–¹æ¡ˆï¼šæŠŠ docker é•œåƒå¯¼å…¥åˆ° containerd é‡Œ</h2><h3 id="åœ¨-node1-ä¸Šï¼ˆ192-168-200-130ï¼‰æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š"><a href="#åœ¨-node1-ä¸Šï¼ˆ192-168-200-130ï¼‰æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š" class="headerlink" title="åœ¨ node1 ä¸Šï¼ˆ192.168.200.130ï¼‰æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š"></a>åœ¨ node1 ä¸Šï¼ˆ192.168.200.130ï¼‰æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</h3><ol>
<li><strong>æŠŠé•œåƒå¯¼å‡ºä¸º tar åŒ…</strong></li>
</ol>
<pre><code>docker save jenkins/jenkins:lts-jdk17 -o jenkins.tar
</code></pre>
<ol>
<li><strong>å¯¼å…¥åˆ° containerdï¼š</strong></li>
</ol>
<pre><code>ctr -n k8s.io images import jenkins.tar
</code></pre>
<ol>
<li><strong>æ£€æŸ¥ containerd æ˜¯å¦å¯¼å…¥æˆåŠŸï¼š</strong></li>
</ol>
<pre><code>ctr -n k8s.io images ls | grep jenkins
</code></pre>
<p>ä½ åº”è¯¥çœ‹åˆ°è¾“å‡ºç±»ä¼¼ï¼š</p>
<pre><code>docker.io/jenkins/jenkins:lts-jdk17 ...
</code></pre>
<hr>
<h2 id="ğŸ”„-ç„¶åï¼Œåœ¨-master-èŠ‚ç‚¹ï¼ˆ192-168-200-129ï¼‰ä¸Šæ‰§è¡Œï¼š"><a href="#ğŸ”„-ç„¶åï¼Œåœ¨-master-èŠ‚ç‚¹ï¼ˆ192-168-200-129ï¼‰ä¸Šæ‰§è¡Œï¼š" class="headerlink" title="ğŸ”„ ç„¶åï¼Œåœ¨ master èŠ‚ç‚¹ï¼ˆ192.168.200.129ï¼‰ä¸Šæ‰§è¡Œï¼š"></a>ğŸ”„ ç„¶åï¼Œåœ¨ master èŠ‚ç‚¹ï¼ˆ192.168.200.129ï¼‰ä¸Šæ‰§è¡Œï¼š</h2><pre><code>kubectl delete pod jenkins-0 -n kube-ops
</code></pre>
<p>ç­‰ 10~20 ç§’åçœ‹ Pod æ˜¯å¦å¯åŠ¨æˆåŠŸï¼š</p>
<pre><code>kubectl get pod -n kube-ops
</code></pre>
<p>çœ‹åˆ°çŠ¶æ€å˜ä¸ºï¼š</p>
<pre><code>jenkins-0   1/1     Running
</code></pre>
<p>å°±è¯´æ˜ä¸€åˆ‡ OK âœ…ï¼</p>
<p>ä½ ç°åœ¨é‡åˆ°çš„é—®é¢˜æ˜¯ï¼š</p>
<blockquote>
<p>âš ï¸ <strong>åœ¨ <code>node1ï¼ˆ130ï¼‰</code> èŠ‚ç‚¹ä¸Šè¿è¡Œ <code>kubectl</code> å‘½ä»¤æ—¶ï¼ŒK8s API server æ— æ³•æ­£å¸¸è®¿é—®ï¼Œæç¤º <code>the server could not find the requested resource</code>ã€‚</strong></p>
</blockquote>
<p>è¿™æ˜¯å› ä¸ºï¼š<br> ğŸ‘‰ <code>kubectl</code> å‘½ä»¤åªèƒ½åœ¨ <strong>å·²é…ç½®å¥½ K8s é›†ç¾¤è®¿é—®æƒé™çš„èŠ‚ç‚¹ä¸Šä½¿ç”¨</strong>ï¼Œé€šå¸¸æ˜¯ <strong>master èŠ‚ç‚¹ï¼ˆ192.168.200.129ï¼‰</strong>ã€‚</p>
<hr>
<h2 id="âœ…-æ­£ç¡®æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š"><a href="#âœ…-æ­£ç¡®æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š" class="headerlink" title="âœ… æ­£ç¡®æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š"></a>âœ… æ­£ç¡®æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š</h2><h3 id="ğŸ”-ä½ åˆšæ‰åœ¨-node1-ä¸Šå¯¼å…¥-containerd-é•œåƒå·²ç»æˆåŠŸäº†ï¼Œç°åœ¨ï¼š"><a href="#ğŸ”-ä½ åˆšæ‰åœ¨-node1-ä¸Šå¯¼å…¥-containerd-é•œåƒå·²ç»æˆåŠŸäº†ï¼Œç°åœ¨ï¼š" class="headerlink" title="ğŸ” ä½ åˆšæ‰åœ¨ node1 ä¸Šå¯¼å…¥ containerd é•œåƒå·²ç»æˆåŠŸäº†ï¼Œç°åœ¨ï¼š"></a>ğŸ” <strong>ä½ åˆšæ‰åœ¨ node1 ä¸Šå¯¼å…¥ containerd é•œåƒå·²ç»æˆåŠŸäº†</strong>ï¼Œç°åœ¨ï¼š</h3><ol>
<li><strong>è¿”å›åˆ° master èŠ‚ç‚¹ï¼ˆ192.168.200.129ï¼‰</strong></li>
<li><strong>æ‰§è¡Œåˆ é™¤ pod çš„å‘½ä»¤ï¼ˆç”± master æ§åˆ¶ï¼‰</strong>ï¼š</li>
</ol>
<pre><code>kubectl delete pod jenkins-0 -n kube-ops
</code></pre>
<ol>
<li><strong>æŸ¥çœ‹ pod çŠ¶æ€ï¼š</strong></li>
</ol>
<pre><code>kubectl get pod -n kube-ops
</code></pre>
<p>ä½ åº”è¯¥çœ‹åˆ° <code>jenkins-0</code> åœ¨ <code>node1</code> ä¸Šé‡æ–°å¯åŠ¨ï¼Œå¹¶å˜æˆ <code>Running</code> çŠ¶æ€ã€‚</p>
<p>ä½ ç°åœ¨æ­£ç™»å½•åœ¨ <strong>node1 èŠ‚ç‚¹ï¼ˆ192.168.200.130ï¼‰</strong>ï¼Œè€Œä½ çš„ <code>kubectl</code> åº”è¯¥åœ¨ <strong>master èŠ‚ç‚¹ï¼ˆ192.168.200.129ï¼‰</strong> ä¸Šæ‰§è¡Œã€‚</p>
<hr>
<h3 id="âœ…-å›åˆ°-master-èŠ‚ç‚¹çš„æ–¹æ³•ï¼š"><a href="#âœ…-å›åˆ°-master-èŠ‚ç‚¹çš„æ–¹æ³•ï¼š" class="headerlink" title="âœ… å›åˆ° master èŠ‚ç‚¹çš„æ–¹æ³•ï¼š"></a>âœ… å›åˆ° master èŠ‚ç‚¹çš„æ–¹æ³•ï¼š</h3><p>åªè¦ä½ æ˜¯é€šè¿‡ SSH ç™»å½•è¿›æ¥çš„ï¼Œ<strong>ç›´æ¥è¾“å…¥ <code>exit</code> æˆ–æŒ‰ <code>Ctrl+D</code></strong> å³å¯é€€å‡ºå½“å‰ SSH ä¼šè¯ï¼Œè¿”å› master èŠ‚ç‚¹ï¼š</p>
<pre><code>[root@k8s-node1 ~]# exit
</code></pre>
<p>æˆ–</p>
<pre><code>[root@k8s-node1 ~]# logout
</code></pre>
<p>ç„¶åä½ å°±ä¼šçœ‹åˆ°ï¼š</p>
<pre><code>[root@k8s-master ~]#
</code></pre>
<p>è¿™æ—¶å€™ä½ å°±åœ¨ master èŠ‚ç‚¹ä¸Šäº†ï¼</p>
<hr>
<h3 id="ğŸ§ -æé†’ï¼škubectl-åªèƒ½åœ¨-master-ä¸Šæ‰§è¡Œ"><a href="#ğŸ§ -æé†’ï¼škubectl-åªèƒ½åœ¨-master-ä¸Šæ‰§è¡Œ" class="headerlink" title="ğŸ§  æé†’ï¼škubectl åªèƒ½åœ¨ master ä¸Šæ‰§è¡Œ"></a>ğŸ§  æé†’ï¼škubectl åªèƒ½åœ¨ master ä¸Šæ‰§è¡Œ</h3><p>æ¯”å¦‚è¿™äº›å‘½ä»¤ï¼š</p>
<pre><code>kubectl delete pod jenkins-0 -n kube-ops
kubectl get pods -n kube-ops
kubectl logs jenkins-0 -n kube-ops
</code></pre>
<p>éƒ½éœ€è¦åœ¨ <strong>master èŠ‚ç‚¹ï¼ˆ192.168.200.129ï¼‰</strong> ä¸Šæ‰§è¡Œï¼Œå…¶ä»– node èŠ‚ç‚¹é»˜è®¤æ˜¯æ²¡æœ‰æƒé™æˆ– kubeconfig é…ç½®çš„ã€‚</p>
<hr>
<p>ç°åœ¨ä½ å¯ä»¥ï¼š</p>
<p>âœ… å…ˆé€€å‡º <code>node1</code>ï¼š</p>
<pre><code>exit
</code></pre>
<p>âœ… ç„¶ååœ¨ master ä¸Šæ‰§è¡Œï¼š</p>
<pre><code>kubectl delete pod jenkins-0 -n kube-ops
kubectl get pod -n kube-ops -w
</code></pre>
<h4 id="æˆåŠŸï¼ï¼ï¼ï¼"><a href="#æˆåŠŸï¼ï¼ï¼ï¼" class="headerlink" title="æˆåŠŸï¼ï¼ï¼ï¼"></a>æˆåŠŸï¼ï¼ï¼ï¼</h4><blockquote>
<p>[root@k8s-master jenkins-master]# kubectl get pod -n kube-ops<br>NAME        READY   STATUS    RESTARTS   AGE<br>jenkins-0   1&#x2F;1     Running   0          7m39s<br>[root@k8s-master jenkins-master]#</p>
</blockquote>
</blockquote>
<ul>
<li><p>æ‰¿æ¥ä¸Šæ–‡ï¼ï¼<br><code> kubectl get service --namespace kube-ops</code> å¾—åˆ°ç«¯å£å·</p>
<blockquote>
<p>[root@k8s-master jenkins-master]# kubectl get service â€“namespace kube-ops<br>NAME      TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)                          AGE<br>jenkins   NodePort   10.1.85.222   <none>        8080:30742&#x2F;TCP,50000:31261&#x2F;TCP   3h3m</p>
</blockquote>
<p>è®¿é—®å³å¯ï¼š<a target="_blank" rel="noopener" href="http://192.168.200.130:30742/">http://192.168.200.130:30742/</a><br>å¦‚ä½•æŸ¥å¯†ç ï¼Ÿ</p>
<blockquote>
<h5 id="è§£é”-Jenkins"><a href="#è§£é”-Jenkins" class="headerlink" title="è§£é” Jenkins"></a>è§£é” Jenkins</h5><p>ä¸ºäº†ç¡®ä¿ç®¡ç†å‘˜å®‰å…¨åœ°å®‰è£… Jenkinsï¼Œå¯†ç å·²å†™å…¥åˆ°æ—¥å¿—ä¸­ï¼ˆ<a target="_blank" rel="noopener" href="https://www.jenkins.io/redirect/find-jenkins-logs">ä¸çŸ¥é“åœ¨å“ªé‡Œï¼Ÿ</a>ï¼‰è¯¥æ–‡ä»¶åœ¨æœåŠ¡å™¨ä¸Šï¼š</p>
<pre><code>/var/jenkins_home/secrets/initialAdminPassword
</code></pre>
<p>è¯·ä»æœ¬åœ°å¤åˆ¶å¯†ç å¹¶ç²˜è´´åˆ°ä¸‹é¢ã€‚</p>
<p>ç®¡ç†å‘˜å¯†ç ï¼š</p>
</blockquote>
<p><code>cd /opt/nfs/jenkins</code><br><code>ll</code><br><code>cd kube-ops-jenkins-home-jenkins-0-pvc-18f7c50d-f5e6-443d-ab24-2ebd09b88a2e </code><br><code> cd secrets</code><br><code>cat initialAdminPassword</code></p>
<blockquote>
<p>[root@k8s-master jenkins-master]# cd &#x2F;opt&#x2F;nfs<br>[root@k8s-master nfs]# ll<br>æ€»ç”¨é‡ 0<br>drwxr-xr-x 3 root root 86 7æœˆ   7 17:13 jenkins<br>[root@k8s-master nfs]# cd jenkins&#x2F;<br>[root@k8s-master jenkins]# ll<br>æ€»ç”¨é‡ 4<br>drwxrwxrwx 11 root root 4096 7æœˆ   7 19:10 kube-ops-jenkins-home-jenkins-0-pvc-18f7c50d-f5e6-443d-ab24-2ebd09b88a2e</p>
<p>[root@k8s-master kube-ops-jenkins-home-jenkins-0-pvc-18f7c50d-f5e6-443d-ab24-2ebd09b88a2e]# ll<br>æ€»ç”¨é‡ 28<br>-rw-râ€“râ€“  1 sonar 1000 1663 7æœˆ   7 18:58 config.xml<br>-rw-râ€“râ€“  1 sonar 1000  216 7æœˆ   7 18:57 copy_reference_file.log<br>-rw-râ€“râ€“  1 sonar 1000  156 7æœˆ   7 18:58 hudson.model.UpdateCenter.xml<br>-rw-râ€“râ€“  1 sonar 1000  171 7æœˆ   7 18:55 jenkins.telemetry.Correlator.xml<br>drwxr-xr-x  2 sonar 1000    6 7æœˆ   7 18:55 jobs<br>-rw-râ€“râ€“  1 sonar 1000 1037 7æœˆ   7 18:58 nodeMonitors.xml<br>drwxr-xr-x  2 sonar 1000    6 7æœˆ   7 18:55 plugins<br>-rw-râ€“râ€“  1 sonar 1000  258 7æœˆ   7 18:57 queue.xml.bak<br>-rw-râ€“râ€“  1 sonar 1000   64 7æœˆ   7 18:55 secret.key<br>-rw-râ€“râ€“  1 sonar 1000    0 7æœˆ   7 18:55 secret.key.not-so-secret<br>drwxâ€”â€”  2 sonar 1000   91 7æœˆ   7 18:55 secrets<br>drwxr-xr-x  2 sonar 1000   67 7æœˆ   7 18:58 updates<br>drwxr-xr-x  2 sonar 1000   24 7æœˆ   7 18:55 userContent<br>drwxr-xr-x  3 sonar 1000   56 7æœˆ   7 18:55 users<br>drwxr-xr-x 10 sonar 1000  247 7æœˆ   7 18:55 war</p>
<p>[root@k8s-master kube-ops-jenkins-home-jenkins-0-pvc-18f7c50d-f5e6-443d-ab24-2ebd09b88a2e]# ^C<br>[root@k8s-master kube-ops-jenkins-home-jenkins-0-pvc-18f7c50d-f5e6-443d-ab24-2ebd09b88a2e]# cd secrets<br>[root@k8s-master secrets]# ll<br>æ€»ç”¨é‡ 12<br>-rw-râ€”â€“ 1 sonar 1000  33 7æœˆ   7 18:55 initialAdminPassword<br>-rw-râ€“râ€“ 1 sonar 1000  32 7æœˆ   7 18:55 jenkins.model.Jenkins.crumbSalt<br>-rw-râ€“râ€“ 1 sonar 1000 256 7æœˆ   7 18:55 master.key<br>[root@k8s-master secrets]# <code>cat initialAdminPassword</code><br>7a2c40f15a564286aac63f61b9f20b95   ã€å¤åˆ¶å®ƒå»ä¸Šé¢ç®¡ç†å‘˜å¯†ç è§£é”ï¼ï¼ã€‘</p>
</blockquote>
</li>
<li><p>åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·å‰é€‰è‡ªé€‰å®‰è£… â†’ æ—  â†’ è´¦å·ï¼šroot   å¯†ç ï¼španchunyao123<br>Jenkins URLï¼š<a target="_blank" rel="noopener" href="http://192.168.200.130:30742/">http://192.168.200.130:30742/</a><br>è¿™é‡Œé¢çš„æ’ä»¶å’Œé…ç½®å»¶ç»­ä¹‹å‰129æœºå™¨ä¸Šçš„</p>
<blockquote>
<p><code>cd /opt/nfs/jenkins/kube-ops-jenkins-home-jenkins-0-pvc-18f7c50d-f5e6-443d-ab24-2ebd09b88a2e/updates</code></p>
<p>è¾“å…¥[æ›¿æ¢å›½å†…åœ°å€]ï¼š<code>sed -i &#39;s/http:\/\/updates.jenkins ci.org\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g&#39; default.json &amp;&amp; sed -i &#39;s/http:\/\/ www.google.com/https:\/\/ www.baidu.com/g&#39; default.json</code></p>
<p>æœ€åï¼ŒManage Pluginsç‚¹å‡»Advancedï¼ŒæŠŠUpdate Siteæ”¹ä¸ºå›½å†…æ’ä»¶ä¸‹è½½åœ°å€ </p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json">https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</a><br>ä¸Šé¢è¿™ä¸ªä¸è¡Œå°±æŒ‰ç…§è€çš„æ¥å§<br><a target="_blank" rel="noopener" href="https://updates.jenkins.io/update-center.json">https://updates.jenkins.io/update-center.json</a></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://192.168.200.129:8888/restart">http://192.168.200.129:8888/restart</a> é‡å¯Jenkins</p>
</blockquote>
</li>
<li><p>å…ˆå®‰è£…åŸºæœ¬çš„æ’ä»¶</p>
<ul>
<li>Localization:Chinese </li>
<li>Git </li>
<li>Pipeline </li>
<li>Extended Choice Parameter</li>
</ul>
</li>
</ul>
<h3 id="-2"><a href="#-2" class="headerlink" title=""></a></h3><h3 id="Jenkinsä¸Kubernetesæ•´åˆ"><a href="#Jenkinsä¸Kubernetesæ•´åˆ" class="headerlink" title="Jenkinsä¸Kubernetesæ•´åˆ"></a>Jenkinsä¸Kubernetesæ•´åˆ</h3><h5 id="å®‰è£…Kubernetesæ’ä»¶"><a href="#å®‰è£…Kubernetesæ’ä»¶" class="headerlink" title="å®‰è£…Kubernetesæ’ä»¶"></a>å®‰è£…Kubernetesæ’ä»¶</h5><p>å®‰è£…å ä¾æ¬¡ç‚¹å‡»<code>Dashboard -&gt; ç³»ç»Ÿç®¡ç† -&gt; äº‘ -&gt; æ–°å»ºäº‘ -&gt; Kubernetes</code></p>
<blockquote>
<p>new cloud â†’ cloud nameï¼škubernetes     Typeï¼škubernetes â†’ create â†’<br>Kubernetes åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://kubernetes.default.svc.cluster.local/">https://kubernetes.default.svc.cluster.local</a><br>å‘½åç©ºé—´ï¼škube-ops<br>â†’ è¿æ¥æµ‹è¯• â†’ Connected to Kubernetes v1.28.2<br>â†’ Jenkins URLåœ°å€ï¼š <a target="_blank" rel="noopener" href="http://jenkins.kube-ops.svc.cluster.local:8080/">http://jenkins.kube-ops.svc.cluster.local:8080</a><br>â†’ åº”ç”¨ + ä¿å­˜</p>
</blockquote>
<ul>
<li>kubernetes åœ°å€é‡‡ç”¨äº†kubeçš„æœåŠ¡å™¨å‘ç°ï¼š <a target="_blank" rel="noopener" href="https://kubernetes.default.svc.cluster.local/">https://kubernetes.default.svc.cluster.local</a> </li>
<li>namespace å¡«kube-opsï¼Œç„¶åç‚¹å‡»Test Connectionï¼Œå¦‚æœå‡ºç° Connection test successful çš„æ ç¤ºä¿¡æ¯è¯æ˜ Jenkins å·²ç»å¯ä»¥å’Œ Kubernetes ç³»ç»Ÿæ­£å¸¸é€šä¿¡ </li>
<li>Jenkins URL  åœ°å€ï¼š <a target="_blank" rel="noopener" href="http://jenkins.kube-ops.svc.cluster.local:8080/">http://jenkins.kube-ops.svc.cluster.local:8080</a></li>
</ul>
<h4 id="æ„å»ºJenkins-Slaveè‡ªå®šä¹‰é•œåƒ"><a href="#æ„å»ºJenkins-Slaveè‡ªå®šä¹‰é•œåƒ" class="headerlink" title="æ„å»ºJenkins-Slaveè‡ªå®šä¹‰é•œåƒ"></a>æ„å»ºJenkins-Slaveè‡ªå®šä¹‰é•œåƒ</h4><ul>
<li>Jenkins-Masteråœ¨æ„å»ºJobçš„æ—¶å€™ï¼ŒKubernetesä¼šåˆ›å»ºJenkins-Slaveçš„Podæ¥å®ŒæˆJobçš„æ„å»ºã€‚æˆ‘ä»¬é€‰æ‹© è¿è¡ŒJenkins-Slaveçš„é•œåƒä¸ºå®˜æ–¹æ¨èé•œåƒï¼šjenkins&#x2F;jnlp-slave:latestï¼Œä½†æ˜¯è¿™ä¸ªé•œåƒé‡Œé¢å¹¶æ²¡æœ‰Maven ç¯å¢ƒï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªæ–°çš„é•œåƒï¼š<br>å…ˆæŠŠ<code>E:\Javaå®ä¾‹é¡¹ç›®1-20å¥—\èµ„æ–™-Jenkinsæ•™ç¨‹\Jenkinsèµ„æ–™\èµ„æ–™\èµ„æ–™\03.èµ„æ–™\k8s-jenkins</code>çš„<code>jenkins-slave</code>å¡è¿›129çš„<code>/root/</code>ä¸‹</li>
</ul>
<blockquote>
<p>[root@k8s-master jenkins-slave]# ll<br>æ€»ç”¨é‡ 8948<br>-rw-râ€“râ€“ 1 root root 9142315 7æœˆ   7 20:47 apache-maven-3.6.2-bin.tar.gz<br>-rw-râ€“râ€“ 1 root root     556 7æœˆ   7 20:47 Dockerfile<br>-rw-râ€“râ€“ 1 root root   10475 7æœˆ   7 20:47 settings.xml</p>
</blockquote>
<pre><code class="yaml"># Dockerfile

FROM jenkins/jnlp-slave:latest
MAINTAINER itcast

# åˆ‡æ¢åˆ° root è´¦æˆ·è¿›è¡Œæ“ä½œ
USER root

# å®‰è£… maven
COPY apache-maven-3.6.2-bin.tar.gz .

RUN tar -zxf apache-maven-3.6.2-bin.tar.gz &amp;&amp; \
    mv apache-maven-3.6.2 /usr/local &amp;&amp; \
    rm -f apache-maven-3.6.2-bin.tar.gz &amp;&amp; \
    ln -s /usr/local/apache-maven-3.6.2/bin/mvn /usr/bin/mvn &amp;&amp; \
    ln -s /usr/local/apache-maven-3.6.2 /usr/local/apache-maven &amp;&amp; \
    mkdir -p /usr/local/apache-maven/repo

COPY settings.xml /usr/local/apache-maven/conf/settings.xml

USER jenkins
</code></pre>
<ul>
<li><p>æ„å»ºå‡ºä¸€ä¸ªæ–°é•œåƒï¼šjenkins-slave-maven:latest<br><code>docker build -t jenkins-slave-maven:latest</code></p>
</li>
<li><p>ç„¶æŠŠé•œåƒä¸Šä¼ åˆ°Harborçš„å…¬å…±åº“libraryä¸­</p>
<p>å…ˆæ‰“æ ‡ç­¾ï¼<br><code> docker tag jenkins-slave-maven:latest 192.168.200.131:85/library/jenkins-slave-maven:latest</code><br>ç„¶åç™»å½•ï¼<br><code> docker login -u admin -p Harbor12345 192.168.200.131:85</code></p>
</li>
</ul>
<blockquote>
<p>WARNING! Using â€“password via the CLI is insecure. Use â€“password-stdin. Error response from daemon: Get <a target="_blank" rel="noopener" href="https://192.168.200.131:85/v2/">https://192.168.200.131:85/v2/</a>: http: server gave HTTP response to HTTPS client [root@k8s-master jenkins-slave]# docker login -u admin -p Harbor12345 192.168.200.131:85 WARNING! Using â€“password via the CLI is insecure. Use â€“password-stdin. Error response from daemon: Get <a target="_blank" rel="noopener" href="https://192.168.200.131:85/v2/">https://192.168.200.131:85/v2/</a>: http: server gave HTTP response to HTTPS client [root@k8s-master jenkins-slave]#</p>
<p>ä½ è¿™ä¸ªé”™è¯¯çš„æ ¹æœ¬åŸå› æ˜¯ï¼š<strong>Harbor ä½¿ç”¨çš„æ˜¯ HTTP åè®®ï¼Œè€Œ Docker é»˜è®¤ä½¿ç”¨ HTTPS</strong>ï¼Œæ‰€ä»¥æŠ¥é”™ï¼š</p>
<blockquote>
<pre><code>http: server gave HTTP response to HTTPS client
</code></pre>
</blockquote>
<hr>
<h2 id="âœ…-è§£å†³æ–¹æ¡ˆï¼ˆåˆ†ä¸¤æ­¥ï¼‰ï¼š"><a href="#âœ…-è§£å†³æ–¹æ¡ˆï¼ˆåˆ†ä¸¤æ­¥ï¼‰ï¼š" class="headerlink" title="âœ… è§£å†³æ–¹æ¡ˆï¼ˆåˆ†ä¸¤æ­¥ï¼‰ï¼š"></a>âœ… è§£å†³æ–¹æ¡ˆï¼ˆåˆ†ä¸¤æ­¥ï¼‰ï¼š</h2><hr>
<h3 id="ğŸ”§-ç¬¬ä¸€æ­¥ï¼šå…è®¸-Docker-ä½¿ç”¨-HTTP-è¿æ¥-Harborï¼ˆéå®‰å…¨æ¨¡å¼ï¼‰"><a href="#ğŸ”§-ç¬¬ä¸€æ­¥ï¼šå…è®¸-Docker-ä½¿ç”¨-HTTP-è¿æ¥-Harborï¼ˆéå®‰å…¨æ¨¡å¼ï¼‰" class="headerlink" title="ğŸ”§ ç¬¬ä¸€æ­¥ï¼šå…è®¸ Docker ä½¿ç”¨ HTTP è¿æ¥ Harborï¼ˆéå®‰å…¨æ¨¡å¼ï¼‰"></a>ğŸ”§ ç¬¬ä¸€æ­¥ï¼šå…è®¸ Docker ä½¿ç”¨ HTTP è¿æ¥ Harborï¼ˆéå®‰å…¨æ¨¡å¼ï¼‰</h3><h4 id="1ï¸âƒ£-ä¿®æ”¹-Docker-é…ç½®æ–‡ä»¶-etc-docker-daemon-json"><a href="#1ï¸âƒ£-ä¿®æ”¹-Docker-é…ç½®æ–‡ä»¶-etc-docker-daemon-json" class="headerlink" title="1ï¸âƒ£ ä¿®æ”¹ Docker é…ç½®æ–‡ä»¶ /etc/docker/daemon.json"></a>1ï¸âƒ£ ä¿®æ”¹ Docker é…ç½®æ–‡ä»¶ <code>/etc/docker/daemon.json</code></h4><pre><code>vi /etc/docker/daemon.json
</code></pre>
<p>æ·»åŠ ï¼ˆæˆ–ä¿®æ”¹ï¼‰ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code>&#123;
  &quot;insecure-registries&quot;: [&quot;192.168.200.131:85&quot;]
&#125;
</code></pre>
<p>å¦‚æœå·²æœ‰å…¶ä»–é…ç½®ï¼Œæ¯”å¦‚ <code>registry-mirrors</code>ï¼Œåˆå¹¶åœ¨ä¸€ä¸ª JSON å¯¹è±¡å†…ï¼š</p>
<pre><code>&#123;
  &quot;registry-mirrors&quot;: [
    &quot;https://docker.m.daocloud.io&quot;,
    &quot;https://wy1u1ijg.mirror.aliyuncs.com&quot;,
    &quot;https://p5lmkba8.mirror.aliyuncs.com&quot;,
    &quot;https://registry.docker-cn.com&quot;
  ],
  &quot;insecure-registries&quot;: [
    &quot;192.168.200.131:85&quot;
  ]
&#125;
</code></pre>
<hr>
<h4 id="2ï¸âƒ£-é‡å¯-Docker-æœåŠ¡"><a href="#2ï¸âƒ£-é‡å¯-Docker-æœåŠ¡" class="headerlink" title="2ï¸âƒ£ é‡å¯ Docker æœåŠ¡"></a>2ï¸âƒ£ é‡å¯ Docker æœåŠ¡</h4><pre><code>systemctl daemon-reexec
systemctl restart docker
</code></pre>
<hr>
<h3 id="ğŸ§ª-ç¬¬äºŒæ­¥ï¼šé‡æ–°ç™»å½•-Harbor"><a href="#ğŸ§ª-ç¬¬äºŒæ­¥ï¼šé‡æ–°ç™»å½•-Harbor" class="headerlink" title="ğŸ§ª ç¬¬äºŒæ­¥ï¼šé‡æ–°ç™»å½• Harbor"></a>ğŸ§ª ç¬¬äºŒæ­¥ï¼šé‡æ–°ç™»å½• Harbor</h3><pre><code>docker login 192.168.200.131:85 -u admin -p Harbor12345
</code></pre>
<p>è¿™æ—¶ä½ ä¸ä¼šå†çœ‹åˆ° HTTPS æŠ¥é”™äº†ã€‚</p>
</blockquote>
<ul>
<li><p>pushé•œåƒä¸Šharbor [Harbor] (<a target="_blank" rel="noopener" href="http://192.168.200.131:85/harbor/projects/1/repositories">http://192.168.200.131:85/harbor/projects/1/repositories</a>)<br><code> docker push 192.168.200.131:85/library/jenkins-slave-maven:latest</code></p>
<blockquote>
<p>[root@k8s-master jenkins-slave]# docker push 192.168.200.131:85&#x2F;library&#x2F;jenkins-slave-maven:latest<br>The push refers to repository [192.168.200.131:85&#x2F;library&#x2F;jenkins-slave-maven]<br>22c917fbd463: Pushed<br>9522f341fa42: Pushed<br>1656341ae8c3: Pushed<br>1a2dbe51b5d3: Pushed<br>ed059ff604cf: Pushed<br>4cb0baa801b1: Pushed<br>3f01ba93adcb: Pushed<br>3dee86c3d230: Pushed<br>5ccb7c9ecca8: Pushed<br>8a510d97a0f7: Pushed<br>3f948fda930d: Pushed<br>cf7a8ba4ff71: Pushed<br>4e006334a6fd: Pushed<br>latest: digest: sha256:38043da78f22253730d941f110156b5130ecdb416fc13b52157d402bbf32f0b4 size: 3046</p>
</blockquote>
</li>
</ul>
<h3 id="æµ‹è¯•Jenkins-Slaveæ˜¯å¦å¯ä»¥åˆ›å»º"><a href="#æµ‹è¯•Jenkins-Slaveæ˜¯å¦å¯ä»¥åˆ›å»º" class="headerlink" title="æµ‹è¯•Jenkins-Slaveæ˜¯å¦å¯ä»¥åˆ›å»º"></a>æµ‹è¯•Jenkins-Slaveæ˜¯å¦å¯ä»¥åˆ›å»º</h3><p>å»å­èŠ‚ç‚¹çš„Jenkinsåˆ›å»ºä¸€ä¸ªitemï¼š<code>test_jenkins_slave</code> æ˜¯æµæ°´çº¿é¡¹ç›®<br>ä¸€å®šè¦åœ¨æµæ°´çº¿ä¸Šå‘Šè¯‰Jenkinsæ˜¯æ”¾åœ¨ä»èŠ‚ç‚¹ä¸Šçš„ï¼</p>
<h5 id="Pipeline-scipt"><a href="#Pipeline-scipt" class="headerlink" title="Pipeline scipt"></a>Pipeline scipt</h5><pre><code class="yaml">// git çš„ URL å’Œ å‡­è¯ID
def git_address = &quot;http://192.168.200.132:82/lanyun_group/tensquare_back.git&quot;
def git_auth = &quot;630eed58-d62f-4c1b-bf96-1cf9c92a7f36&quot;

// æ­£ç¡®ä½¿ç”¨ podTemplate åŒ…è£¹ node
podTemplate(label: &#39;jenkins-slave&#39;, cloud: &#39;kubernetes&#39;, containers: [
    containerTemplate(
        name: &#39;jnlp&#39;,
        image: &quot;192.168.200.131:85/library/jenkins-slave-maven:latest&quot;,
        ttyEnabled: true,
        command: &#39;/bin/sh&#39;
    )
]) &#123;
    node(&quot;jenkins-slave&quot;) &#123;
        stage(&#39;æ‹‰å–ä»£ç &#39;) &#123;
            checkout scmGit(
                branches: [[name: &quot;master&quot;]],
                extensions: [],
                userRemoteConfigs: [[
                    credentialsId: &quot;$&#123;git_auth&#125;&quot;,
                    url: &quot;$&#123;git_address&#125;&quot;
                ]]
            )
        &#125;
    &#125;
&#125;
</code></pre>
<p>ç„¶åç‚¹å‡»æ„å»º å°±ä¼šåœ¨ä»èŠ‚ç‚¹è¿›è¡Œåˆ›å»º æ­¤æ—¶å»çœ‹<code>Dashboard â†’ ç³»ç»Ÿç®¡ç† â†’ èŠ‚ç‚¹å’Œäº‘ç®¡ç†</code>çš„æ—¶å€™å°±ä¼šå¤šä¸€ä¸ªåˆšåˆšè‡ªä¸»åˆ›å»ºçš„èŠ‚ç‚¹ <strong>å¿«é€Ÿåˆ›å»º å¹¶å¿«é€Ÿå›æ”¶</strong>ï¼ï¼</p>
<h4 id="Jenkins-Kubernetes-Dockerå®Œæˆå¾®æœåŠ¡æŒç»­é›†æˆ"><a href="#Jenkins-Kubernetes-Dockerå®Œæˆå¾®æœåŠ¡æŒç»­é›†æˆ" class="headerlink" title="Jenkins+Kubernetes+Dockerå®Œæˆå¾®æœåŠ¡æŒç»­é›†æˆ"></a>Jenkins+Kubernetes+Dockerå®Œæˆå¾®æœåŠ¡æŒç»­é›†æˆ</h4><h5 id="æ‹‰å–ä»£ç ï¼Œæ„å»ºé•œåƒ"><a href="#æ‹‰å–ä»£ç ï¼Œæ„å»ºé•œåƒ" class="headerlink" title="æ‹‰å–ä»£ç ï¼Œæ„å»ºé•œåƒ"></a>æ‹‰å–ä»£ç ï¼Œæ„å»ºé•œåƒ</h5><ul>
<li><p>åˆ›å»ºNFSå…±äº«ç›®å½•</p>
<p>è®©æ‰€æœ‰Jenkins-Slaveæ„å»ºæŒ‡å‘NFSçš„Mavençš„å…±äº«ä»“åº“ç›®å½•</p>
<pre><code class="yaml">vi /etc/exports
æ·»åŠ å†…å®¹ï¼š
/opt/nfs/jenkins   *(rw,no_root_squash) 
/opt/nfs/maven     *(rw,no_root_squash) 
systemctl restart nfs   é‡å¯NFS
</code></pre>
<blockquote>
<p>[root@k8s-node1 ~]# showmount -e 192.168.200.129<br>Export list for 192.168.200.129:<br>&#x2F;opt&#x2F;nfs&#x2F;maven   *              ã€mavenä»“åº“å®ç°å…±äº«ã€‘<br>&#x2F;opt&#x2F;nfs&#x2F;jenkins *<br>[root@k8s-node1 ~]#</p>
</blockquote>
</li>
<li><p>åˆ›å»ºé¡¹ç›®ï¼Œç¼–å†™æ„å»ºPipeline</p>
<pre><code class="yaml">// git çš„ URL å’Œ å‡­è¯ID
def git_address = &quot;http://192.168.200.132:82/lanyun_group/tensquare_back.git&quot;
def git_auth = &quot;630eed58-d62f-4c1b-bf96-1cf9c92a7f36&quot;
//æ„å»ºç‰ˆæœ¬çš„åç§°
def tag = &quot;latest&quot;
 //Harborç§æœåœ°å€
def harbor_url = &quot;192.168.200.131:85&quot;
 //Harborçš„é¡¹ç›®åç§°
def harbor_project_name = &quot;tensquare&quot;
 //Harborçš„å‡­è¯
def harbor_auth = &quot;f82340a4-5173-40e3-bc76-602db3a5acf5&quot;

podTemplate(
    label: &#39;jenkins-slave&#39;,
    cloud: &#39;kubernetes&#39;,
    containers: [
        containerTemplate(
            name: &#39;jnlp&#39;,
            image: &quot;192.168.200.131:85/library/jenkins-slave-maven:latest&quot;
        ),
        containerTemplate(
            name: &#39;docker&#39;,
            image: &quot;docker:stable&quot;,
            ttyEnabled: true,
            command: &#39;cat&#39;
        )
    ],
    volumes: [
        hostPathVolume(
            mountPath: &#39;/var/run/docker.sock&#39;,
            hostPath: &#39;/var/run/docker.sock&#39;
        ),
        nfsVolume(
            mountPath: &#39;/usr/local/apache-maven/repo&#39;,
            serverAddress: &#39;192.168.200.129&#39;,
            serverPath: &#39;/opt/nfs/maven&#39;
        )
    ]
) &#123;
    node(&quot;jenkins-slave&quot;) &#123;
        stage(&#39;æ‹‰å–ä»£ç &#39;) &#123;
            checkout scmGit(
                branches: [[name: &quot;master&quot;]],
                extensions: [],
                userRemoteConfigs: [[
                    credentialsId: &quot;$&#123;git_auth&#125;&quot;,
                    url: &quot;$&#123;git_address&#125;&quot;
                ]]
            )
        &#125;

        stage(&#39;ç¼–è¯‘ï¼Œå®‰è£…å…¬å…±å­å·¥ç¨‹&#39;) &#123;
            sh &quot;mvn -f tensquare_common clean install&quot;
        &#125;

        stage(&#39;æ„å»ºé•œåƒï¼Œéƒ¨ç½²é¡¹ç›®&#39;) &#123;
            // æŠŠé€‰æ‹©çš„é¡¹ç›®ä¿¡æ¯è½¬ä¸ºæ•°ç»„
            def selectedProjects = &quot;$&#123;project_name&#125;&quot;.split(&#39;,&#39;)

            for (int i = 0; i &lt; selectedProjects.size(); i++) &#123;
                // å–å‡ºæ¯ä¸ªé¡¹ç›®çš„åç§°å’Œç«¯å£
                def currentProject = selectedProjects[i]
                def currentProjectName = currentProject.split(&#39;@&#39;)[0]
                def currentProjectPort = currentProject.split(&#39;@&#39;)[1]
                def imageName = &quot;$&#123;currentProjectName&#125;:$&#123;tag&#125;&quot;

                // ç¼–è¯‘ï¼Œæ„å»ºæœ¬åœ°é•œåƒ
                sh &quot;mvn -f $&#123;currentProjectName&#125; clean package dockerfile:build&quot;

                container(&#39;docker&#39;) &#123;
                    // ç»™é•œåƒæ‰“æ ‡ç­¾
                    sh &quot;docker tag $&#123;imageName&#125; $&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;

                    // ç™»å½• Harborï¼Œå¹¶ä¸Šä¼ é•œåƒ
                    withCredentials([usernamePassword(
                        credentialsId: &quot;$&#123;harbor_auth&#125;&quot;,
                        passwordVariable: &#39;password&#39;,
                        usernameVariable: &#39;username&#39;
                    )]) &#123;
                        sh &quot;docker login -u $&#123;username&#125; -p $&#123;password&#125; $&#123;harbor_url&#125;&quot;
                        sh &quot;docker push $&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;
                    &#125;

                    // åˆ é™¤æœ¬åœ°é•œåƒ
                    sh &quot;docker rmi -f $&#123;imageName&#125;&quot;
                    sh &quot;docker rmi -f $&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;
                &#125;
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
</li>
<li><p>å‹¾é€‰<code>å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹</code> â†’ <code>Extended Choice Parameter</code>å’Œä¹‹å‰çš„ä¸€æ · å¯å›çœ‹<code>tensquare_eureka_server@10086,tensquare_zuul@10020,tensquare_admin_service@9001,tensquare_gathering@9002</code></p>
</li>
</ul>
<h5 id="å®‰è£…Kubernetes-Continuous-Deployæ’ä»¶-Kubernetes-CLIæ’ä»¶-Kubernetes-Credentials-Provider"><a href="#å®‰è£…Kubernetes-Continuous-Deployæ’ä»¶-Kubernetes-CLIæ’ä»¶-Kubernetes-Credentials-Provider" class="headerlink" title="å®‰è£…Kubernetes Continuous Deployæ’ä»¶ || Kubernetes CLIæ’ä»¶ || Kubernetes Credentials Provider"></a>å®‰è£…Kubernetes Continuous Deployæ’ä»¶ || Kubernetes CLIæ’ä»¶ || Kubernetes Credentials Provider</h5><ul>
<li><p>ä¿®æ”¹åçš„æµæ°´çº¿è„šæœ¬</p>
<pre><code class="yaml">// è¿™é‡Œæ˜¯åœ¨å…¨å±€å‡­è¯æ·»åŠ åç‚¹è¿›å»å¯ä»¥æŸ¥çœ‹ID
dsf k8s_auth = &quot;xxxxxxxxx&quot;
// å®šä¹‰k8s-harborçš„å‡­è¯
def secret_name = &quot;registry-auth-secret&quot;
...
...
def deploy_image_name = &quot;$&#123;harbor_url&#125;/$&#123;harbor_project_name&#125;/$&#123;imageName&#125;&quot;
 //éƒ¨ç½²åˆ°K8S
 sh &quot;&quot;&quot;
 sed -i &#39;s#\$IMAGE_NAME#$&#123;deploy_image_name&#125;#&#39; 
$&#123;currentProjectName&#125;/deploy.yml
 sed -i &#39;s#\$SECRET_NAME#$&#123;secret_name&#125;#&#39; 
$&#123;currentProjectName&#125;/deploy.yml
 &quot;&quot;&quot;
 kubernetesDeploy configs: &quot;$&#123;currentProjectName&#125;/deploy.yml&quot;, 
kubeconfigId: &quot;$&#123;k8s_auth&#125;&quot;
</code></pre>
</li>
<li><p>å»Jenkinsçš„å‡­è¯é‡ŒåŠ k8så‡­è¯</p>
<blockquote>
<h2 id="â—Credentials-from-Kubernetes-Secrets-will-not-be-available"><a href="#â—Credentials-from-Kubernetes-Secrets-will-not-be-available" class="headerlink" title="â—Credentials from Kubernetes Secrets will not be available"></a>â—<code>Credentials from Kubernetes Secrets will not be available</code></h2><h3 id="ğŸ§ -è¯´æ˜ï¼š"><a href="#ğŸ§ -è¯´æ˜ï¼š" class="headerlink" title="ğŸ§  è¯´æ˜ï¼š"></a>ğŸ§  è¯´æ˜ï¼š</h3><ul>
<li>è¿™ä¸ªè­¦å‘Šè¯´æ˜ Jenkins æ— æ³•é€šè¿‡ Kubernetes æ’ä»¶ä» <code>Secret</code> é‡ŒåŠ è½½å‡­è¯ã€‚</li>
<li>é€šå¸¸æ˜¯ä»¥ä¸‹åŸå› ä¹‹ä¸€ï¼š<ul>
<li><strong>Pod æ²¡æœ‰æŒ‚è½½æ­£ç¡®çš„ ServiceAccount &#x2F; RBAC ä¸å¤Ÿ</strong></li>
<li>ç¼ºå°‘ <code>Kubernetes Credentials Provider Plugin</code></li>
<li>æ²¡æœ‰å¼€å¯ K8s secret credential provider åŠŸèƒ½</li>
</ul>
</li>
</ul>
<h3 id="âœ…-è§£å†³æ–¹æ¡ˆï¼š"><a href="#âœ…-è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="âœ… è§£å†³æ–¹æ¡ˆï¼š"></a>âœ… è§£å†³æ–¹æ¡ˆï¼š</h3><ol>
<li><p>ç¡®ä¿ä½ å®‰è£…äº†æ’ä»¶ï¼š</p>
<ul>
<li><code>Kubernetes</code></li>
<li><code>Kubernetes Credentials Provider</code></li>
</ul>
</li>
<li><p>é…ç½® Jenkins Deployment çš„ ServiceAccount å…·å¤‡æƒé™ï¼Œç»‘å®šå¦‚ä¸‹ ClusterRoleï¼š</p>
</li>
<li><p>ä½ å¯ä»¥ç»™ Jenkins çš„ ServiceAccount ç»‘å®šä¸€ä¸ª <code>ClusterRole</code> æ¥è¯»å– secretsï¼š<br><code>/root/jenkins-master/</code>çš„<code>ServiceaAcount.yaml</code></p>
<pre><code>apiVersion: v1
kind: ServiceAccount
metadata:
  name: jenkins
  namespace: kube-ops
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: jenkins-read-secrets
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: view
subjects:
- kind: ServiceAccount
  name: jenkins
  namespace: kube-ops
</code></pre>
<blockquote>
<p>ğŸ‘†è¿™ä¼šç»™ <code>jenkins</code> è´¦æˆ·æˆäºˆè¯»å–æ‰€æœ‰ namespace çš„ <code>secret</code> æƒé™ã€‚</p>
</blockquote>
<p>å°†ä¸Šé¢å†…å®¹ä¿å­˜ä¸º <code>jenkins-rbac.yaml</code>ï¼Œç„¶åæ‰§è¡Œï¼š</p>
<pre><code class="yaml">kubectl apply -f jenkins-rbac.yaml
</code></pre>
</li>
</ol>
</blockquote>
</li>
<li><p>æ·»åŠ å‡­è¯ â†’ ç±»å‹<code>Kubernetes configuration(kubeconfig)</code>ï¼›èŒƒå›´å…¨å±€ï¼›æè¿°k8s-authï¼›Kubeconfigé€‰æ‹©<code>Enter directly</code>è¿™é‡Œé¢çš„å¯†é’¥è¦å» 129Jenkinsæœºå™¨ä¸Šæ‹¿<br><code>cd /root/.kube</code> â†’ <code>cat config</code> æ˜¾ç¤ºçš„å†…å®¹å…¨éƒ¨åŸå°ä¸åŠ¨çš„å¤åˆ¶åˆ°é‚£é‡Œé¢</p>
</li>
<li><p>åœ¨æ¯ä¸ªé¡¹ç›®ä¸‹å»ºç«‹deploy.xml</p>
<h6 id="Eurekaçš„deply-yml"><a href="#Eurekaçš„deply-yml" class="headerlink" title="Eurekaçš„deply.yml"></a>Eurekaçš„deply.yml</h6><pre><code class="yaml">---
apiVersion: v1
kind: Service
metadata:
  name: eureka
  labels:
    app: eureka
spec:
  type: NodePort
  ports:
    - port: 10086
      name: eureka
      targetPort: 10086
  selector:
    app: eureka
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: eureka
spec:
  serviceName: &quot;eureka&quot;
  replicas: 2
  selector:
    matchLabels:
      app: eureka
  template:
    metadata:
      labels:
        app: eureka
    spec:
      imagePullSecrets:
        - name: $SECRET_NAME
      containers:
        - name: eureka
          image: $IMAGE_NAME
          ports:
            - containerPort: 10086
          env:
            - name: MY_POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: EUREKA_SERVER
              value: &quot;http://eureka-0.eureka:10086/eureka/,http://eureka-1.eureka:10086/eureka/&quot;
            - name: EUREKA_INSTANCE_HOSTNAME
              value: $&#123;MY_POD_NAME&#125;.eureka
  podManagementPolicy: &quot;Parallel&quot;
</code></pre>
<p>å…¶ä»–é¡¹ç›®çš„deploy.ymlä¸»è¦æŠŠåå­—å’Œç«¯å£ä¿®æ”¹ï¼š</p>
<h6 id="zuulçš„deploy-yml"><a href="#zuulçš„deploy-yml" class="headerlink" title="zuulçš„deploy.yml"></a>zuulçš„deploy.yml</h6><pre><code class="yaml">---
apiVersion: v1
kind: Service
metadata:
  name: zuul
  labels:
    app: zuul
spec:
  type: NodePort
  ports:
    - port: 10020
      name: zuul
      targetPort: 10020
  selector:
    app: zuul
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: zuul
spec:
  serviceName: &quot;zuul&quot;
  replicas: 2
  selector:
    matchLabels:
      app: zuul
  template:
    metadata:
      labels:
        app: zuul
    spec:
      imagePullSecrets:
        - name: $SECRET_NAME
      containers:
        - name: zuul
          image: $IMAGE_NAME
          ports:
            - containerPort: 10020
  podManagementPolicy: &quot;Parallel&quot;
</code></pre>
</li>
<li><p>è¿˜è¦åœ¨æµæ°´çº¿å®šä¹‰k8s-harborçš„å‡­è¯<br>ç”ŸæˆDockerå‡­è¯  Dockerå‡­è¯ï¼Œç”¨äºKubernetesåˆ°Dockerç§æœæ‹‰å–é•œåƒ</p>
<blockquote>
<p>docker login -u itcast -p Itcast123 192.168.66.102:85     ç™»å½•Harbor </p>
<p>kubectl create secret docker-registry registry-auth-secret  â€“docker server&#x3D;192.168.200.131:85 â€“docker-username&#x3D;itcast â€“docker-password&#x3D;Itcast123 â€“ docker-email&#x3D;<a href="mailto:&#105;&#x74;&#x63;&#x61;&#115;&#116;&#64;&#105;&#116;&#x63;&#97;&#x73;&#x74;&#x2e;&#x63;&#110;">&#105;&#x74;&#x63;&#x61;&#115;&#116;&#64;&#105;&#116;&#x63;&#97;&#x73;&#x74;&#x2e;&#x63;&#110;</a>    ç”Ÿæˆ </p>
<p>kubectl get secret    æŸ¥çœ‹å¯†é’¥</p>
</blockquote>
</li>
<li><p>é¡¹ç›®æ„å»ºåï¼ŒæŸ¥çœ‹æœåŠ¡åˆ›å»ºæƒ…å†µ</p>
<blockquote>
<p>kubectl get pods -owide<br>kubectl get service</p>
</blockquote>
</li>
</ul>
<h4 id="å¯åŠ¨å‘½ä»¤æ€»ç»“"><a href="#å¯åŠ¨å‘½ä»¤æ€»ç»“" class="headerlink" title="å¯åŠ¨å‘½ä»¤æ€»ç»“"></a>å¯åŠ¨å‘½ä»¤æ€»ç»“</h4><pre><code class="java">[192.168.200.132]GitLabï¼šgitlab-ctl restart 
[192.168.200.131]Tomcatï¼š/opt/tomcat/bin/startup.sh

[192.168.200.129]Jenkinsï¼š/systemctl start jenkins
[192.168.200.129]SonarQubeï¼šsudo -u sonarqube /opt/sonar/bin/linux-x86-64/sonar.sh restart
</code></pre>
<h4 id="2025-7-8-0-02-å®Œç»“æ’’èŠ±â˜…-Â°-â˜†-ï¿£â–½ï¿£-x2F-Â°â˜…-ã€‚"><a href="#2025-7-8-0-02-å®Œç»“æ’’èŠ±â˜…-Â°-â˜†-ï¿£â–½ï¿£-x2F-Â°â˜…-ã€‚" class="headerlink" title="2025.7.8Â  0:02Â  Â å®Œç»“æ’’èŠ±â˜…,Â°:.â˜†(ï¿£â–½ï¿£)&#x2F;$:.Â°â˜… ã€‚"></a><span style = "color:red">2025.7.8Â  0:02Â  Â å®Œç»“æ’’èŠ±<em>â˜…,Â°</em>:.â˜†(ï¿£â–½ï¿£)&#x2F;$:<em>.Â°â˜…</em> ã€‚</span></h4>
    </div>

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <div id="comment">
        <div id="gitalk-container">
        </div>
    </div>
    
</div>
                     
<footer id="footer">
    <div class="footer-wrap">
        <div>
            Â© 2018 - 2025 P-luminary
            <span class="footer-icon">
                <a-icon type="flag" theme="filled" /></span>
            @Asuna
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a>
<!--         & <a target="_blank" rel="noopener" href="https://github.com/korilin/hexo-theme-particle">Particle Theme</a></div> -->
        
    </div>

</footer>

<script src="/js/highlight.min.js"></script>
<script src="/js/particle.js"></script>
                </div>
            </div>
        </transition>
    </div>

    <script>
    new Vue({
        el: "#layout",
        data: {
            show_page: false,
            onload_menu: false,
            menu_show: false,
            card_top: 100
        },
        created: function () {
            var that = this
            window.onload = function () {
                that.show_page = true
                document.getElementById("loadcontent").style.opacity = 0
                setTimeout(function () {
                    document.getElementById("loadleft").style.width = 0
                    document.getElementById("loadright").style.width = 0
                }, 300)
                setTimeout(function () {
                    document.getElementById("loading").style = "display:none"
                }, 600)
            }
        },
        mounted: function () {
            var that = this
            window.addEventListener('scroll', function (e) {
                that.menu_show = false
            })
        },
        methods: {
            home_click: function () {
                window.scrollTo({
                    top: window.innerHeight - 80,
                    behavior: "smooth",
                });
            }
        }
    })
</script>

<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
    const gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'hexo-theme-particle',      // The repository of store comments,
        owner: 'P-luminary',
        admin: ['P-luminary'],
        language: 'en',
        id: location.pathname,      // Ensure uniqueness and length less than 50
        distractionFreeMode: true  // Facebook-like distraction free mode
    })
    gitalk.render('gitalk-container')
</script>

</body>

</html>