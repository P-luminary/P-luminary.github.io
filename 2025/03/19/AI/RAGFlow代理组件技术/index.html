
<!DOCTYPE html>
<html lang="zh_CH ">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P-luminary || RAGFlowä»£ç†ç»„ä»¶æŠ€æœ¯</title>
    <meta name="author" content="Asuna">
    <meta name="description" content=" ">
    <meta name="keywords" content=" ">
    <link rel="icon" href="/https://raw.githubusercontent.com/P-luminary/images/master/data/asuna.jpg">
    <link rel="stylesheet" href="/css/antd.min.css">
    
    <link rel="stylesheet" href="/css/maiden-theme.css">
    
    <script src="/js/vue.js"></script>
    <script src="/js/antd.min.js"></script>
<meta name="generator" content="Hexo 6.1.0"></head>

<body>

    <div id="loading"
        style="height: 100vh; width: 100%; position: fixed;display: flex;z-index: 200; justify-content: space-between;">
        <div id="loadleft" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div id="loadright" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div
            style="position: fixed; height: 100vh; width: 100%;display: flex;justify-content: center;align-items: center;">
            <div id="loadcontent"
                style="width:400px;height:400px;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px#a3ddfb; text-align:center;opacity:1;transition:opacity 0.3s ease-out;">
                <div>
                    <h2>LOADING...</h2>
                    <p>åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜(æµè§ˆå™¨é»˜è®¤å¼€å¯)</p>
                    <div>
                        <img src="/dancingkitty.gif" alt="loading">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="layout">
        <transition name="into">
            <div v-show="show_page" style="display: none;">
                <div id="menu_show">
                     
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">P-luminary</span>
        </a>
        
        <a href="/">
            <span>
                <a-icon type="home" theme="filled" />
            </span>
            <span>home</span>
        </a>
        
        <a href="/tags/è¯­æ³•">
            <span>
                <a-icon type="tags" theme="filled" />
            </span>
            <span>tags</span>
        </a>
        
    </div>

    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div :class="'title'" @click="menu_show=!menu_show">
            <span style="margin-right: 10px;">
                <a-icon type="appstore" theme="filled" />
            </span>
            <span>P-luminary</span>
        </div>
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="home" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">home</div>
                </div>
            </a>
            
            <a href="/tags/è¯­æ³•">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="tags" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">tags</div>
                </div>
            </a>
            
        </div>
        <div class="curtain" v-show="menu_show"></div>
    </div>

</nav>
                </div>

                <div id="main">
                     
<link rel="stylesheet" href="/css/post-body.css">
<div class="article">
    <div>
        <h1>RAGFlowä»£ç†ç»„ä»¶æŠ€æœ¯ </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <a-icon type="calendar" theme="filled" />
            </span>
            2025/3/19
        </span>

        

        

        <span class="tags">
            <span class="icon">
                <a-icon type="tags" theme="filled" />
            </span>
            
            <span class="tag">
                
                <a href="/tags/AI" style=color:#879cff>
                    AI
                </a>
            </span>
            
        </span>
        
    </div>

    <div class="content" v-pre>
        <h4 id="å¦‚æœè¦è‡ªå·±åˆ›å»ºä¸€ä¸ªç»„ä»¶å¹¶ä¸”ä½¿ç”¨"><a href="#å¦‚æœè¦è‡ªå·±åˆ›å»ºä¸€ä¸ªç»„ä»¶å¹¶ä¸”ä½¿ç”¨" class="headerlink" title="å¦‚æœè¦è‡ªå·±åˆ›å»ºä¸€ä¸ªç»„ä»¶å¹¶ä¸”ä½¿ç”¨"></a><span style = "color:red">å¦‚æœè¦è‡ªå·±åˆ›å»ºä¸€ä¸ªç»„ä»¶å¹¶ä¸”ä½¿ç”¨</span></h4><h6 id="è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ä»¶ç±»-è‡ªå®šä¹‰æ–°çš„ç»„ä»¶å‚æ•°"><a href="#è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ä»¶ç±»-è‡ªå®šä¹‰æ–°çš„ç»„ä»¶å‚æ•°" class="headerlink" title="è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ä»¶ç±» + è‡ªå®šä¹‰æ–°çš„ç»„ä»¶å‚æ•°"></a>è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ä»¶ç±» + è‡ªå®šä¹‰æ–°çš„ç»„ä»¶å‚æ•°</h6><p>â‘  <code>agent/component/xxxx.py</code> åœ¨é‡Œé¢<strong>ç»§æ‰¿</strong> <code>ComponentParamBase</code> +  <code>ComponentBase</code> ç±» è¿™æ ·å°±å¯ä»¥é‡ç”¨å…¶ä¸­çš„å¤§éƒ¨åˆ†æ–¹æ³•å’Œé€»è¾‘<br>â‘¡ æ–°ç»„ä»¶ç±»éœ€è¦å®ç° <code>_run</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå®šä¹‰ç»„ä»¶çš„å…·ä½“ä¸šåŠ¡é€»è¾‘</p>
<pre><code class="python">BaiduFanyiParam â†’â†’ ComponentBase â†’ base.py
â˜…â˜…â˜… base.pyã€é‡Œé¢çš„outputæ˜¯è¾“å‡ºä¸ºå…ƒç»„(DataFrame) 
å†é€šè¿‡åºåˆ—åŒ–è½¬æ¢ä¸º(å­—å…¸)(def as_dict(self))JSONã€‘ â˜…â˜…â˜…

    æ‰©å±•æ€§ï¼šä¸åŒçš„å­ç±»å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚å®ç°è‡ªå·±çš„ _run æ–¹æ³•
           ä¸åŒçš„ä¸šåŠ¡é€»è¾‘å¯èƒ½éœ€è¦ä¸åŒçš„æ•°æ®å¤„ç†æ–¹å¼å’Œè®¡ç®—æ–¹æ³•
    çµæ´»é…ç½®ï¼škwargs å‚æ•°æä¾›äº†æ–¹æ³•è°ƒç”¨æ—¶çµæ´»ä¼ é€’å‚æ•°çš„èƒ½åŠ›ï¼Œå¯ä»¥æ ¹æ®éœ€è¦åœ¨ä¸åŒæƒ…å†µä¸‹è°ƒæ•´è¡Œä¸ºã€‚
    è°ƒè¯•å’Œç›‘æ§ï¼šé€šè¿‡ logging.debug å’Œ set_output è®°å½•è¾“å…¥å’Œè¾“å‡ºï¼Œå¯ä»¥åœ¨è°ƒè¯•å’Œç”Ÿäº§ç¯å¢ƒä¸­è·Ÿè¸ªç¨‹åºçš„è¡Œä¸ºï¼Œå¹¶åŠæ—¶å‘ç°é—®é¢˜ã€‚
    
    def run(self, history, **kwargs):
        logging.debug(&quot;&#123;&#125;, history: &#123;&#125;, kwargs: &#123;&#125;&quot;.format(self, json.dumps(history, ensure_ascii=False),
                                                              json.dumps(kwargs, ensure_ascii=False)))
        self._param.debug_inputs = []
        try:
            res = self._run(history, **kwargs)
            self.set_output(res)
        except Exception as e:
            self.set_output(pd.DataFrame([&#123;&quot;content&quot;: str(e)&#125;]))
            raise e

        return res

    def _run(self, history, **kwargs):
        raise NotImplementedError()
</code></pre>
<pre><code class="python">ã€è‡ªå®šä¹‰ç»„ä»¶ã€‘BaiduFanyi â†’â†’ ComponentBase â†’ abc.py ã€Pythonçš„æŠ½è±¡åŸºç±»(ç±»ä¼¼äºJavaçš„æ¥å£)ã€‘
ç¡®ä¿æŸäº›ç±»åœ¨ç»§æ‰¿æŠ½è±¡åŸºç±»æ—¶éµå¾ªç‰¹å®šçš„åè®® è¿™åœ¨è®¾è®¡å¤§å‹ç³»ç»Ÿæˆ–è€…æ¡†æ¶æ—¶éå¸¸æœ‰ç”¨
â˜… æ¥å£å®šä¹‰ï¼šå®šä¹‰äº†ç»„ä»¶å¿…é¡»å®ç°çš„æ–¹æ³• =&gt; `_run` =&gt; ç»„ä»¶æ‰§è¡Œå…¶ä»»åŠ¡çš„åœ°æ–¹
â˜… ç»„ä»¶å‘½åï¼šé€šè¿‡ component_name ç±»å±æ€§ï¼Œå®ƒæä¾›äº†ç»„ä»¶çš„åç§°ï¼Œè¿™æœ‰åŠ©äºåœ¨ç³»ç»Ÿä¸­è¯†åˆ«å’Œç®¡ç†ç»„ä»¶
â˜… è¿è¡Œé€»è¾‘ï¼š`_run` æ–¹æ³•æ˜¯ç»„ä»¶çš„æ ¸å¿ƒï¼Œå®ƒåŒ…å«äº†ç»„ä»¶çš„æ‰§è¡Œé€»è¾‘ï¼Œä¾‹å¦‚å¦‚ä½•ä½¿ç”¨å‚æ•°ã€å¦‚ä½•å¤„ç†è¾“å…¥ã€å¦‚ä½•è°ƒç”¨å¤–éƒ¨APIç­‰
â˜… è¾“å…¥/è¾“å‡ºå¤„ç†ï¼šoutput â†’ base.py ç”¨äºå¤„ç†ç»„ä»¶çš„è¾“å‡ºï¼Œç¡®ä¿æ‰€æœ‰ç»„ä»¶çš„è¾“å‡ºæ ¼å¼ä¸€è‡´
------------------------------------------------------------------------------
ã€è‡ªå®šä¹‰ç»„ä»¶å‚æ•°ã€‘BaiduFanyiParam â†’â†’ ComponentParamBase â†’ base.py ã€åˆå§‹åŒ–+æ ¡éªŒã€‘
å®šä¹‰äº†ç™¾åº¦ç¿»è¯‘ç»„ä»¶æ‰€éœ€çš„å‚æ•°ï¼Œä¾‹å¦‚ appidã€secret_keyã€trans_type ç­‰ï¼Œå®ƒè¿˜å®ç°äº†ä¸€ä¸ª check æ–¹æ³•ï¼Œç”¨äºéªŒè¯å‚æ•°çš„æœ‰æ•ˆæ€§ã€‚
â˜… å‚æ•°å°è£…ï¼šå®ƒå°è£…äº†ç»„ä»¶è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰å‚æ•°ï¼Œä½¿å¾—å‚æ•°ç®¡ç†æ›´åŠ é›†ä¸­æ–¹ä¾¿
â˜… å‚æ•°éªŒè¯ï¼šé€šè¿‡ check æ–¹æ³•ï¼Œå¯ä»¥ç¡®ä¿åœ¨ç»„ä»¶è¿è¡Œå‰æ‰€æœ‰å¿…è¦çš„å‚æ•°éƒ½è¢«æ­£ç¡®è®¾ç½®ï¼Œå¹¶ä¸”æ˜¯æœ‰æ•ˆçš„
â˜… å¯æ‰©å±•æ€§ï¼šå…¶ä»–ç»„ä»¶çš„å‚æ•°ç±»å¯ä»¥ç»§æ‰¿ ComponentParamBase å¹¶æ ¹æ®éœ€è¦æ·»åŠ æˆ–ä¿®æ”¹å‚æ•°
</code></pre>
<pre><code class="python">import random
# æŠ½è±¡åŸºç±»æ¨¡å— ç”¨äºå®šä¹‰ç»„ä»¶çš„åŸºç±»
from abc import ABC
# ç”¨äºå‘é€ HTTP è¯·æ±‚ï¼Œä¸ ç™¾åº¦ç¿»è¯‘ API äº¤äº’
import requests
# åŸºç¡€ç»„ä»¶ç±»ï¼Œäºæ„å»ºæ­¤ç»„ä»¶çš„çˆ¶ç±»ï¼Œå®šä¹‰ç»„ä»¶çš„åŸºæœ¬ç»“æ„å’Œå‚æ•°ã€‚
from agent.component.base import ComponentBase, ComponentParamBase
# ç”¨äºç”Ÿæˆç™¾åº¦ç¿»è¯‘ API è¯·æ±‚ç­¾åï¼ˆåŠ å¯†å“ˆå¸Œï¼‰
from hashlib import md5

# ç™¾åº¦ç¿»è¯‘ç»„ä»¶çš„å‚æ•°å®šä¹‰ç±» ç»§æ‰¿ComponentParamBase
class BaiduFanyiParam(ComponentParamBase):
    &quot;&quot;&quot;
    Define the BaiduFanyi component parameters.
    &quot;&quot;&quot;

    def __init__(self):
        super().__init__()
   # appid å’Œ secret_key æ˜¯ç™¾åº¦ç¿»è¯‘ API çš„ èº«ä»½éªŒè¯ ä¿¡æ¯ï¼ˆéœ€è¦åœ¨ç™¾åº¦ç¿»è¯‘å¼€æ”¾å¹³å°è·å–ï¼‰
        self.appid = &quot;xxx&quot;
        self.secret_key = &quot;xxx&quot;
   # translateï¼šæ™®é€šç¿»è¯‘   fieldtranslateï¼šä¸“ä¸šé¢†åŸŸç¿»è¯‘
        self.trans_type = &#39;translate&#39;
        self.parameters = []
   # source_lang ç¿»è¯‘çš„æºè¯­è¨€   target_lang ç¿»è¯‘çš„ç›®æ ‡è¯­è¨€
        self.source_lang = &#39;auto&#39;
        self.target_lang = &#39;auto&#39;
   # domain å¦‚æœä½¿ç”¨ä¸“ä¸šé¢†åŸŸç¿»è¯‘ï¼Œéœ€æŒ‡å®šé¢†åŸŸï¼ˆå¦‚ finance è¡¨ç¤º é‡‘è é¢†åŸŸï¼‰
        self.domain = &#39;finance&#39;
# æ£€æŸ¥å‚æ•°åˆæ³•æ€§
    def check(self):
    # check_empty()ï¼šç¡®ä¿ appid å’Œ secret_key ä¸èƒ½ä¸ºç©ºã€‚
        self.check_empty(self.appid, &quot;BaiduFanyi APPID&quot;)
        self.check_empty(self.secret_key, &quot;BaiduFanyi Secret Key&quot;)
# check_valid_value()ï¼šç¡®ä¿ trans_typeã€source_langã€target_langã€domain çš„å€¼åœ¨åˆæ³•é€‰é¡¹ä¹‹å†…
        self.check_valid_value(self.trans_type, &quot;Translate type&quot;, [&#39;translate&#39;, &#39;fieldtranslate&#39;])
# ä»¥ä¸‹æ˜¯åˆ—ä¸¾å„ç§è¯­è¨€
        self.check_valid_value(self.source_lang, &quot;Source language&quot;,
                               [&#39;auto&#39;, &#39;zh&#39;, &#39;en&#39;, &#39;yue&#39;, &#39;wyw&#39;, &#39;jp&#39;, &#39;kor&#39;, &#39;fra&#39;, &#39;spa&#39;, &#39;th&#39;, &#39;ara&#39;, &#39;ru&#39;, &#39;pt&#39;,
                                &#39;de&#39;, &#39;it&#39;, &#39;el&#39;, &#39;nl&#39;, &#39;pl&#39;, &#39;bul&#39;, &#39;est&#39;, &#39;dan&#39;, &#39;fin&#39;, &#39;cs&#39;, &#39;rom&#39;, &#39;slo&#39;, &#39;swe&#39;,
                                &#39;hu&#39;, &#39;cht&#39;, &#39;vie&#39;])
        self.check_valid_value(self.target_lang, &quot;Target language&quot;,
                               [&#39;auto&#39;, &#39;zh&#39;, &#39;en&#39;, &#39;yue&#39;, &#39;wyw&#39;, &#39;jp&#39;, &#39;kor&#39;, &#39;fra&#39;, &#39;spa&#39;, &#39;th&#39;, &#39;ara&#39;, &#39;ru&#39;, &#39;pt&#39;,
                                &#39;de&#39;, &#39;it&#39;, &#39;el&#39;, &#39;nl&#39;, &#39;pl&#39;, &#39;bul&#39;, &#39;est&#39;, &#39;dan&#39;, &#39;fin&#39;, &#39;cs&#39;, &#39;rom&#39;, &#39;slo&#39;, &#39;swe&#39;,
                                &#39;hu&#39;, &#39;cht&#39;, &#39;vie&#39;])
# ä»¥ä¸‹æ˜¯åˆ—ä¸¾ä¸åŒä¸“ä¸šé¢†åŸŸ
        self.check_valid_value(self.domain, &quot;Translate field&quot;,
                               [&#39;it&#39;, &#39;finance&#39;, &#39;machinery&#39;, &#39;senimed&#39;, &#39;novel&#39;, &#39;academic&#39;, &#39;aerospace&#39;, &#39;wiki&#39;,
                                &#39;news&#39;, &#39;law&#39;, &#39;contract&#39;])

# ç»§æ‰¿ComponentBaseå’ŒABC


# -------------------------------------------------------------------------------- #


class BaiduFanyi(ComponentBase, ABC):
 # å®šä¹‰ç»„ä»¶åç§°åœ¨ç³»ç»Ÿå†…å”¯ä¸€æ ‡è¯†è¯¥ç»„ä»¶
    component_name = &quot;BaiduFanyi&quot;
    # _run()æ˜¯ç»„ä»¶çš„ æ ¸å¿ƒæ‰§è¡Œå‡½æ•°ï¼Œç”¨äºå¤„ç†ç¿»è¯‘è¯·æ±‚ã€‚
# **kwargsï¼šå¯ä»¥è®©å‡½æ•°æ›´åŠ çµæ´»ï¼Œå› ä¸ºå®ƒå¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„å‘½åå‚æ•°
# åœ¨å‡½æ•°å†…éƒ¨ï¼Œkwargs æ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†æ‰€æœ‰ä¼ é€’ç»™å‡½æ•°çš„é¢å¤–å‘½åå‚æ•°ã€‚
    def _run(self, history, **kwargs):
&#39;&#39;&#39;
self.get_input() è·å–è¾“å…¥å†…å®¹ã€‚
å¦‚æœ content å­˜åœ¨ï¼Œåˆ™ç”¨ - è¿æ¥å¤šä¸ªå†…å®¹ï¼ˆæ‹¼æ¥æˆå•ä¸ªå­—ç¬¦ä¸²ï¼‰ã€‚
å¦‚æœ ans ä¸ºç©ºï¼Œç›´æ¥è¿”å› &quot;&quot;
&#39;&#39;&#39;
        ans = self.get_input()
        ans = &quot; - &quot;.join(ans[&quot;content&quot;]) if &quot;content&quot; in ans else &quot;&quot;
        if not ans:
            return BaiduFanyi.be_output(&quot;&quot;)

        try:
&#39;&#39;&#39;
source_lang å’Œ target_langï¼šæ¥æºå’Œç›®æ ‡è¯­è¨€ã€‚
appidï¼šç™¾åº¦ç¿»è¯‘ API çš„ åº”ç”¨ IDã€‚
saltï¼šéšæœºæ•°ï¼ˆç™¾åº¦ API éœ€è¦æ­¤å‚æ•°ï¼‰ã€‚
secret_keyï¼šç™¾åº¦ API çš„ å¯†é’¥
&#39;&#39;&#39;
            source_lang = self._param.source_lang
            target_lang = self._param.target_lang
            appid = self._param.appid
            salt = random.randint(32768, 65536)
            secret_key = self._param.secret_key
-------------------------- â˜† æ™®é€šç¿»è¯‘APIè¯·æ±‚ â˜† --------------------------
            if self._param.trans_type == &#39;translate&#39;:
            # md5ç­¾åï¼Œé˜²æ­¢è¯·æ±‚è¢«ç¯¡æ”¹
                sign = md5((appid + ans + salt + secret_key).encode(&#39;utf-8&#39;)).hexdigest()
     # å‘é€ HTTP POST è¯·æ±‚ è®¿é—® ç™¾åº¦ç¿»è¯‘ API
                url = &#39;http://api.fanyi.baidu.com/api/trans/vip/translate?&#39; + &#39;q=&#39; + ans + &#39;&amp;from=&#39; + source_lang + &#39;&amp;to=&#39; + target_lang + &#39;&amp;appid=&#39; + appid + &#39;&amp;salt=&#39; + salt + &#39;&amp;sign=&#39; + sign
                headers = &#123;&quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;&#125;
            # è§£æè¿”å›ç»“æœ
                response = requests.post(url=url, headers=headers).json()

                if response.get(&#39;error_code&#39;):
                    BaiduFanyi.be_output(&quot;**Error**:&quot; + response[&#39;error_msg&#39;])

                return BaiduFanyi.be_output(response[&#39;trans_result&#39;][0][&#39;dst&#39;])
-------------------------- â˜… ä¸“ä¸šç¿»è¯‘APIè¯·æ±‚ â˜… --------------------------
            elif self._param.trans_type == &#39;fieldtranslate&#39;:
                domain = self._param.domain
                sign = md5((appid + ans + salt + domain + secret_key).encode(&#39;utf-8&#39;)).hexdigest()
                url = &#39;http://api.fanyi.baidu.com/api/trans/vip/fieldtranslate?&#39; + &#39;q=&#39; + ans + &#39;&amp;from=&#39; + source_lang + &#39;&amp;to=&#39; + target_lang + &#39;&amp;appid=&#39; + appid + &#39;&amp;salt=&#39; + salt + &#39;&amp;domain=&#39; + domain + &#39;&amp;sign=&#39; + sign
                headers = &#123;&quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;&#125;
                response = requests.post(url=url, headers=headers).json()

                if response.get(&#39;error_code&#39;):
                    BaiduFanyi.be_output(&quot;**Error**:&quot; + response[&#39;error_msg&#39;])

                return BaiduFanyi.be_output(response[&#39;trans_result&#39;][0][&#39;dst&#39;])
        # æ•è· æ‰€æœ‰å¼‚å¸¸ï¼Œé˜²æ­¢ç¨‹åºå´©æºƒ
        except Exception as e:
            BaiduFanyi.be_output(&quot;**Error**:&quot; + str(e))
</code></pre>
<h6 id="é’ˆå¯¹äºè‡ªå®šä¹‰ç»„ä»¶å‚æ•°-ComponentParamBase-ä¸ºä»€ä¹ˆé‡Œé¢æ˜¯ç”¨çš„Jsonæ ¼å¼ï¼Ÿ"><a href="#é’ˆå¯¹äºè‡ªå®šä¹‰ç»„ä»¶å‚æ•°-ComponentParamBase-ä¸ºä»€ä¹ˆé‡Œé¢æ˜¯ç”¨çš„Jsonæ ¼å¼ï¼Ÿ" class="headerlink" title="é’ˆå¯¹äºè‡ªå®šä¹‰ç»„ä»¶å‚æ•°[ComponentParamBase] ä¸ºä»€ä¹ˆé‡Œé¢æ˜¯ç”¨çš„Jsonæ ¼å¼ï¼Ÿ"></a>é’ˆå¯¹äºè‡ªå®šä¹‰ç»„ä»¶å‚æ•°[ComponentParamBase] ä¸ºä»€ä¹ˆé‡Œé¢æ˜¯ç”¨çš„Jsonæ ¼å¼ï¼Ÿ</h6><ul>
<li><p><strong>æ–¹ä¾¿åºåˆ—åŒ–</strong>ï¼š<code>json.dumps()</code>å°†å¯¹è±¡è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²ï¼Œå¯ä»¥è½»æ¾åœ°ä¿å­˜æˆ–ä¼ è¾“å¯¹è±¡æ•°æ®ã€‚</p>
<pre><code class="python">base.py
    def __str__(self):
        &quot;&quot;&quot;
        &#123;
            &quot;component_name&quot;: &quot;Begin&quot;,
            &quot;params&quot;: &#123;&#125;
        &#125;
        &quot;&quot;&quot;
        # .format()å°†å˜é‡æ’å…¥åˆ°å­—ç¬¦ä¸²æ¨¡æ¿ä¸­çš„å ä½ç¬¦ä½ç½®  &#123;&#123;&#125;&#125;è½¬ä¹‰&#123;&#125;
        return &quot;&quot;&quot;&#123;&#123;
              "component_name": "&#123;&#125;",
              "params": &#123;&#125;,
              "output": &#123;&#125;,
              "inputs": &#123;&#125;
          &#125;&#125;&quot;&quot;&quot;.format(self.component_name,
                     self._param,
# json.dumps(...): å°†è·å–çš„ &quot;output&quot; å’Œ &quot;inputs&quot; å€¼åºåˆ—åŒ–ä¸º JSON æ ¼å¼çš„å­—ç¬¦ä¸²
# json.loads(str(self._param)): å°† self._param è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åå°†å…¶è§£æä¸º JSON å¯¹è±¡
# self._param è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åå°†å…¶è§£æä¸º JSON å¯¹è±¡
# ä» JSON å¯¹è±¡ä¸­è·å– &quot;output&quot; é”®å¯¹åº”çš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›ç©ºå­—å…¸ &#123;&#125;
                     json.dumps(json.loads(str(self._param)).get(&quot;output&quot;, &#123;&#125;), ensure_ascii=False),
                     json.dumps(json.loads(str(self._param)).get(&quot;inputs&quot;, []), ensure_ascii=False)
        )
</code></pre>
</li>
<li><p><strong>æ–¹ä¾¿è°ƒè¯•å’Œå±•ç¤º</strong>ï¼šåœ¨ <code>__str__</code> æ–¹æ³•ä¸­è¿”å› JSON å­—ç¬¦ä¸²ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æŸ¥çœ‹å¯¹è±¡çš„å†…å®¹ã€‚å°¤å…¶æ˜¯åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œç›´æ¥æ‰“å°å‡ºå¯¹è±¡çš„ JSON æ ¼å¼å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¿«é€ŸæŸ¥çœ‹å¯¹è±¡çš„çŠ¶æ€åŠå…¶å†…éƒ¨æ•°æ®ç»“æ„</p>
<pre><code class="python"># å°†å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²
    def __str__(self):
        return json.dumps(self.as_dict(), ensure_ascii=False)
# é€’å½’åœ°å°†å¯¹è±¡çš„å±æ€§è½¬æ¢æˆå­—å…¸ é€‚ç”¨äºå°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSON æˆ–è¿›è¡Œå…¶ä»–æ“ä½œ
    def as_dict(self):
        def _recursive_convert_obj_to_dict(obj):
            ret_dict = &#123;&#125;
            for attr_name in list(obj.__dict__):
                if attr_name in [_FEEDED_DEPRECATED_PARAMS, _DEPRECATED_PARAMS, _USER_FEEDED_PARAMS, _IS_RAW_CONF]:
                    continue
                # get attr
                attr = getattr(obj, attr_name)
                if isinstance(attr, pd.DataFrame):
                    ret_dict[attr_name] = attr.to_dict()
                    continue
                if attr and type(attr).__name__ not in dir(builtins):
                    ret_dict[attr_name] = _recursive_convert_obj_to_dict(attr)
                else:
                    ret_dict[attr_name] = attr
            return ret_dict
        return _recursive_convert_obj_to_dict(self)
</code></pre>
</li>
<li><p><strong>ä¸å¤§æ¨¡å‹äº¤äº’</strong>ï¼šå½“æ¶‰åŠåˆ°ä¸å¤§è¯­è¨€æ¨¡å‹ï¼ˆå¦‚ GPTï¼‰æˆ–å…¶ä»–æœºå™¨å­¦ä¹ æ¨¡å‹çš„äº¤äº’æ—¶ï¼ŒJSON æ ¼å¼çš„æ•°æ®é€šå¸¸æ˜¯æ ‡å‡†çš„è¾“å…¥å’Œè¾“å‡ºæ ¼å¼ã€‚å°†å¯¹è±¡è½¬ä¸º JSON å­—ç¬¦ä¸²ï¼Œèƒ½å¤Ÿæ›´å®¹æ˜“åœ°å°†æ•°æ®ä¼ é€’ç»™æ¨¡å‹è¿›è¡Œå¤„ç†æˆ–åˆ†æï¼Œæ¨¡å‹é€šå¸¸ä¼šæ¥å— JSON æ ¼å¼çš„æ•°æ®è¿›è¡Œè®­ç»ƒæˆ–æ¨ç†ã€‚</p>
</li>
</ul>
<h5 id="å¦‚ä½•å»è¿ç”¨ï¼Ÿ"><a href="#å¦‚ä½•å»è¿ç”¨ï¼Ÿ" class="headerlink" title="å¦‚ä½•å»è¿ç”¨ï¼Ÿ"></a>å¦‚ä½•å»è¿ç”¨ï¼Ÿ</h5><ul>
<li><strong>æ•°æ®äº¤æ¢</strong>ï¼šå¯ä»¥å°†è¿™ä¸ª JSON å­—ç¬¦ä¸²ç”¨ä½œ API è¯·æ±‚æˆ–å“åº”çš„æ•°æ®æ ¼å¼ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å°†è¿™ä¸ªå¯¹è±¡ä½œä¸º HTTP è¯·æ±‚çš„ body å‘é€ï¼Œæˆ–è€…ä»ç½‘ç»œä¸­è·å– JSON æ ¼å¼çš„æ•°æ®ï¼Œç„¶åè§£æå›å¯¹è±¡ã€‚</li>
<li><strong>æŒä¹…åŒ–å­˜å‚¨</strong>ï¼šå¦‚æœä½ éœ€è¦å°†å¯¹è±¡æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“æˆ–æ–‡ä»¶ç³»ç»Ÿï¼ŒJSON æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å­˜å‚¨æ ¼å¼ã€‚ä¾‹å¦‚ï¼Œå°†å¯¹è±¡æ•°æ®å­˜å‚¨åœ¨æ–‡ä»¶ä¸­æˆ–æ•°æ®åº“è¡¨çš„ JSON ç±»å‹å­—æ®µä¸­ï¼Œä¾¿äºæœªæ¥è¯»å–å’Œæ“ä½œã€‚</li>
<li><strong>é…ç½®å’Œå‚æ•°æ›´æ–°</strong>ï¼š<code>update</code> æ–¹æ³•ä¸­æ¥æ”¶åˆ°çš„ <code>conf</code> å‚æ•°å®é™…ä¸Šæ˜¯ä¸€ä¸ªå­—å…¸å¯¹è±¡ï¼Œå®ƒé€šè¿‡é€’å½’çš„æ–¹å¼æ›´æ–°å¯¹è±¡çš„å±æ€§ã€‚å¦‚æœä½ å°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSON æ ¼å¼åï¼Œå¯ä»¥å°† JSON ä½œä¸ºé…ç½®æ–‡ä»¶ä¼ é€’ç»™åº”ç”¨ï¼Œåº”ç”¨æ ¹æ®è¯¥é…ç½®åŠ¨æ€è°ƒæ•´å…¶è¡Œä¸ºã€‚è¿™ä½¿å¾—ç³»ç»Ÿæ›´åŠ çµæ´»å’Œå¯é…ç½®ã€‚</li>
<li><strong>éªŒè¯ä¸æ ¡éªŒ</strong>ï¼š<code>validate</code> æ–¹æ³•åˆ©ç”¨å­˜å‚¨åœ¨ JSON æ–‡ä»¶ä¸­çš„è§„åˆ™å¯¹å¯¹è±¡è¿›è¡Œå‚æ•°éªŒè¯ï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„æ–¹å¼æ¥ç¡®ä¿è¾“å…¥çš„æ•°æ®ç¬¦åˆç‰¹å®šçš„æ ¼å¼æˆ–é™åˆ¶ã€‚å¯ä»¥é€šè¿‡åŠ¨æ€åŠ è½½é…ç½®æ–‡ä»¶æ¥éªŒè¯å¯¹è±¡çš„æ•°æ®ï¼Œä¿è¯æ•°æ®çš„åˆæ³•æ€§ã€‚</li>
</ul>
<h5 id="æ•°æ®è¾“å‡º-å…ƒç»„-åŠè½¬æ¢-JSON"><a href="#æ•°æ®è¾“å‡º-å…ƒç»„-åŠè½¬æ¢-JSON" class="headerlink" title="æ•°æ®è¾“å‡º(å…ƒç»„)åŠè½¬æ¢(JSON)"></a>æ•°æ®è¾“å‡º(å…ƒç»„)åŠè½¬æ¢(JSON)</h5><pre><code class="python">----------------------------------- è¾“å‡ºä¸ºå…ƒç»„ -----------------------------------    
    def output(self, allow_partial=True) -&gt; Tuple[str, Union[pd.DataFrame, partial]]:
        o = getattr(self._param, self._param.output_var_name)
        if not isinstance(o, partial):
            if not isinstance(o, pd.DataFrame):
                if isinstance(o, list):
                    return self._param.output_var_name, pd.DataFrame(o)
                if o is None:
                    return self._param.output_var_name, pd.DataFrame()
                return self._param.output_var_name, pd.DataFrame([&#123;&quot;content&quot;: str(o)&#125;])
            return self._param.output_var_name, o

        if allow_partial or not isinstance(o, partial):
            if not isinstance(o, partial) and not isinstance(o, pd.DataFrame):
                return pd.DataFrame(o if isinstance(o, list) else [o])
            return self._param.output_var_name, o

        outs = None
        for oo in o():
            if not isinstance(oo, pd.DataFrame):
                # æœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ä¸ªå…ƒç»„
                outs = pd.DataFrame(oo if isinstance(oo, list) else [oo])
            else:
                outs = oo
        return self._param.output_var_name, outs

----------------------------------- åºåˆ—åŒ–ä¸ºJSON -----------------------------------
 # å°†å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²
    def __str__(self):
        return json.dumps(self.as_dict(), ensure_ascii=False)

    # é€’å½’åœ°å°†å¯¹è±¡çš„å±æ€§è½¬æ¢æˆå­—å…¸ é€‚ç”¨äºå°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSON æˆ–è¿›è¡Œå…¶ä»–æ“ä½œ
    def as_dict(self):
        def _recursive_convert_obj_to_dict(obj):
            ret_dict = &#123;&#125;
            for attr_name in list(obj.__dict__):
                if attr_name in [_FEEDED_DEPRECATED_PARAMS, _DEPRECATED_PARAMS,
                                 _USER_FEEDED_PARAMS, _IS_RAW_CONF]:
                    continue
                # get attr
                attr = getattr(obj, attr_name)
                if isinstance(attr, pd.DataFrame):
                    ret_dict[attr_name] = attr.to_dict()
                    continue
                if attr and type(attr).__name__ not in dir(builtins):
                    ret_dict[attr_name] = _recursive_convert_obj_to_dict(attr)
                else:
                    ret_dict[attr_name] = attr

            return ret_dict

        return _recursive_convert_obj_to_dict(self)
    
--------------------------------------------------------------------------------------
def get_stream_input(self)ï¼š
def get_input_elements(self):
    
def get_input(self)ï¼š
# ä¸Šæ¸¸ç»„ä»¶çš„è¾“å‡ºï¼šå®ƒä¼šæ£€æŸ¥å½“å‰ç»„ä»¶çš„ä¸Šæ¸¸ç»„ä»¶ï¼Œå¹¶å°è¯•ä»è¿™äº›ç»„ä»¶è·å–è¾“å‡ºæ•°æ®ä½œä¸ºå½“å‰çš„è¾“å…¥
# å¦‚æœ _param.query å­˜åœ¨ï¼Œå®ƒä¼šéå†æŸ¥è¯¢å‚æ•°ï¼Œå¹¶æ ¹æ®å‚æ•°çš„ç±»å‹ï¼ˆå¦‚ç»„ä»¶ IDï¼‰æ¥å†³å®šå¦‚ä½•è·å–ç›¸åº”çš„è¾“å…¥æ•°æ®
# inputåå†é€šè¿‡DataFrameè½¬æ¢ä¸ºå…ƒç»„ å†å»è½¬æ¢ä¸ºå­—å…¸
# æ¥å›æ¥è½¬æ¢æ˜¯ä¸ºäº†æ»¡è¶³ç‰¹å®šçš„æ¥å£è¦æ±‚æˆ–è€…ä¸ºäº†ç¡®ä¿æ•°æ®åœ¨ä¸åŒå±‚ä¹‹é—´ä¼ è¾“æ—¶çš„å…¼å®¹æ€§



&#39;&#39;&#39;
                           ä½¿ç”¨Pandasåº“æ¥å¤„ç†æ•°æ®
â˜… get_inputå‡½æ•°: è¿™ä¸ªå‡½æ•°é¦–å…ˆæ£€æŸ¥æ˜¯å¦æœ‰è°ƒè¯•è¾“å…¥ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¿”å›ä¸€ä¸ªåŒ…å«è°ƒè¯•è¾“å…¥å†…å®¹çš„DataFrameã€‚ç„¶åï¼Œå®ƒå¤„ç†æŸ¥è¯¢è¾“å…¥ï¼Œæ ¹æ®æŸ¥è¯¢ä¸­çš„ä¸åŒæ¡ä»¶ï¼ˆå¦‚component_idã€valueç­‰ï¼‰ï¼Œè°ƒç”¨å…¶ä»–å‡½æ•°è·å–ç›¸åº”çš„è¾“å…¥å†…å®¹ï¼Œå¹¶å°†è¿™äº›å†…å®¹æ·»åŠ åˆ°self._param.inputsåˆ—è¡¨ä¸­ã€‚æœ€åï¼Œå®ƒé€šè¿‡pd.concatå‡½æ•°å°†æ‰€æœ‰ä¸Šæ¸¸ç»„ä»¶[ç»“åˆhistory]çš„è¾“å‡ºåˆå¹¶æˆä¸€ä¸ªDataFrameï¼Œå¹¶è¿”å›ã€‚

â˜… get_input_elementså‡½æ•°: è¿™ä¸ªå‡½æ•°æ ¹æ®self._param.queryä¸­çš„æŸ¥è¯¢ï¼Œæ„å»ºä¸€ä¸ªè¾“å…¥å…ƒç´ åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ åŒ…å«åç§°ã€é”®å’Œå€¼ã€‚

â˜…get_stream_inputå‡½æ•°: è¿™ä¸ªå‡½æ•°å¤„ç†æµå¼è¾“å…¥ï¼Œæ ¹æ®ç»„ä»¶è·¯å¾„ï¼Œè°ƒç”¨å…¶ä»–å‡½æ•°è·å–ç›¸åº”çš„è¾“å…¥å†…å®¹ï¼Œå¹¶è¿”å›ã€‚

ä¸»è¦æ˜¯å¤„ç†è¾“å…¥å‚æ•°ï¼Œå¹¶æ ¹æ®ä¸åŒçš„æ¡ä»¶è·å–ç›¸åº”çš„è¾“å…¥å†…å®¹ã€‚å®ƒå¹¶æ²¡æœ‰ç›´æ¥æ¥å—ä¸åŒç§ç±»ç±»å‹çš„å…¥å‚ï¼Œè€Œæ˜¯æ ¹æ®ä¼ å…¥çš„æŸ¥è¯¢å‚æ•°æ¥è·å–è¾“å…¥å†…å®¹ã€‚
&#39;&#39;&#39;
</code></pre>
<hr>
<p>â‘  <span style = "color:red">agent&#x2F;component&#x2F;baidufanyi.py</span> ã€åç«¯ä»£ç ã€‘<br>â‘¡ <span style = "color:red">agent&#x2F;component&#x2F;_ _ init _ _.py</span>  ã€åˆå§‹åŒ–ã€‘<br>â‘¢ web&#x2F;src&#x2F;pages&#x2F;flow&#x2F;flow-drawer&#x2F;index.tsxã€è¡¨å•æŠ½å±‰ç»„ä»¶ UIå±•ç¤ºã€‘<br>â‘£ web&#x2F;src&#x2F;pages&#x2F;flow&#x2F;form&#x2F;baidu-fanyi-form&#x2F;index.tsx ã€æä¾›ç”¨æˆ·ç•Œé¢è®©ç”¨æˆ·èƒ½é…ç½®å¹¶æäº¤å‚æ•°ã€‘<br>â‘¤ web&#x2F;src&#x2F;pages&#x2F;flow&#x2F;constant.tsx ã€å®šä¹‰ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„å„ç§å›¾æ ‡ã€å¸¸é‡ã€æšä¸¾ã€æ¥å£ã€çŠ¶æ€å’Œå‡½æ•°ã€‘<br>â‘¥ web&#x2F;src&#x2F;locales&#x2F;zh.ts ã€æŠŠæ‰€æœ‰è¦æ˜¾ç¤ºçš„æåˆ°zh.tsä¸­(å‰ç«¯ç»„ä»¶æè¿°)ã€‘<br>â‘¦ web&#x2F;src&#x2F;pages&#x2F;agent&#x2F;constant.tsxã€å¼•å…¥ç»„ä»¶æ‰€éœ€çš„å„ç§å›¾æ ‡ã€ä»¥åŠæ“ä½œé¡¹çš„æ ·å¼ã€åˆå§‹å€¼ã€è¯­è¨€ç­‰ã€‘<br>â‘§ web&#x2F;src&#x2F;pages&#x2F;agent&#x2F;form-sheet&#x2F;use-form-config-map.tsx ã€è¡¨å•é…ç½®æ˜ å°„ã€é…ç½®ä¸åŒæ“ä½œå¯¹åº”è¡¨å•ç»„ä»¶ã€‘<br>â‘¨ web&#x2F;src&#x2F;pages&#x2F;agent&#x2F;form&#x2F;baidu-fanyi-form&#x2F;index.tsx ã€æ„å»ºé…ç½®è¡¨å• ã€‘<br>â‘© web&#x2F;src&#x2F;pages&#x2F;agent&#x2F;hooks.tsx ã€ç®¡ç†å›¾å½¢ç•Œé¢æµç¨‹å›¾ å„ç§é’©å­ â†’ å»ºæ•°æ®å¤„ç†æµç¨‹ã€‘</p>
<hr>
<hr>
<hr>
<hr>
<h1 id="åˆ›å»ºåŠ¨æ€ä»£ç†ç»„ä»¶-å®æˆ˜"><a href="#åˆ›å»ºåŠ¨æ€ä»£ç†ç»„ä»¶-å®æˆ˜" class="headerlink" title="åˆ›å»ºåŠ¨æ€ä»£ç†ç»„ä»¶ [å®æˆ˜]"></a><span style = "color:red">åˆ›å»ºåŠ¨æ€ä»£ç†ç»„ä»¶ [å®æˆ˜]</span></h1><h2 id="ğŸ“Œ-å®ç°æ­¥éª¤"><a href="#ğŸ“Œ-å®ç°æ­¥éª¤" class="headerlink" title="ğŸ“Œ å®ç°æ­¥éª¤"></a><strong>ğŸ“Œ å®ç°æ­¥éª¤</strong></h2><ol>
<li><strong>åç«¯ï¼ˆPython FastAPIï¼‰</strong><ul>
<li>åˆ›å»ºä¸€ä¸ª API æœåŠ¡å™¨ï¼Œæä¾›ç»„ä»¶æ³¨å†Œã€æŸ¥è¯¢ã€è¿è¡Œæ¥å£ã€‚</li>
<li>ç»„ä»¶ä¿¡æ¯å­˜å‚¨åœ¨å†…å­˜ï¼ˆå¯æ‰©å±•åˆ°æ•°æ®åº“ï¼‰ã€‚</li>
<li>ç»„ä»¶ä»£ç åŠ¨æ€æ‰§è¡Œï¼Œæ”¯æŒ <code>exec()</code> åŠ è½½ã€‚</li>
</ul>
</li>
<li><strong>å‰ç«¯ï¼ˆHTML + JavaScriptï¼‰</strong><ul>
<li>æä¾›ä¸€ä¸ªè¡¨å•ï¼Œå…è®¸ç”¨æˆ·è¾“å…¥<strong>ç»„ä»¶åç§°</strong>ã€<strong>å‚æ•°</strong>ã€<strong>Python ä»£ç </strong>ã€‚</li>
<li>æäº¤è¡¨å•åï¼Œé€šè¿‡ <code>fetch()</code> å‘é€ <code>POST</code> è¯·æ±‚ç»™åç«¯ã€‚</li>
<li>ç»„ä»¶åˆ›å»ºæˆåŠŸåï¼Œå‰ç«¯å¯ä»¥è°ƒç”¨ <code>run</code> æ¥å£æµ‹è¯•ç»„ä»¶ã€‚</li>
</ul>
</li>
<li><strong>Postman æµ‹è¯•</strong><ul>
<li>å…ˆåˆ›å»ºç»„ä»¶ <code>POST /api/components/create</code></li>
<li>å†è¿è¡Œç»„ä»¶ <code>POST /api/components/run</code></li>
</ul>
</li>
</ol>
<hr>
<h1 id="1ï¸âƒ£-åç«¯ä»£ç ï¼ˆFastAPIï¼‰"><a href="#1ï¸âƒ£-åç«¯ä»£ç ï¼ˆFastAPIï¼‰" class="headerlink" title="1ï¸âƒ£ åç«¯ä»£ç ï¼ˆFastAPIï¼‰"></a><strong>1ï¸âƒ£ åç«¯ä»£ç ï¼ˆFastAPIï¼‰</strong></h1><p>åˆ›å»º <code>server.py</code>ï¼Œè¿™ä¸ªæ–‡ä»¶ç”¨äºå¯åŠ¨ FastAPI æœåŠ¡å™¨ï¼Œå¹¶æä¾› API ç«¯ç‚¹ã€‚</p>
<blockquote>
<p><strong>å®‰è£…ä¾èµ–ï¼ˆå¦‚æœæœªå®‰è£… FastAPI å’Œ Uvicornï¼‰ï¼š</strong></p>
<pre><code class="python">pip install fastapi uvicorn pandas
</code></pre>
</blockquote>
<p>ğŸ“Œ <strong>ä»£ç ï¼ˆserver.pyï¼‰ï¼š</strong></p>
<pre><code class="python">from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
import pandas as pd

app = FastAPI()

# ç»„ä»¶å­˜å‚¨ï¼ˆæ¨¡æ‹Ÿæ•°æ®åº“ï¼‰
components = &#123;&#125;

class ComponentData(BaseModel):
    name: str
    params: dict
    code: str

@app.post(&quot;/api/components/create&quot;)
def create_component(component: ComponentData):
    &quot;&quot;&quot;
    åˆ›å»ºæ–°çš„åŠ¨æ€ç»„ä»¶ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä½¿ç”¨ exec() åŠ è½½ç»„ä»¶ä»£ç 
    &quot;&quot;&quot;
    if component.name in components:
        raise HTTPException(status_code=400, detail=&quot;ç»„ä»¶å·²å­˜åœ¨&quot;)
    
    # å®‰å…¨åœ°æ‰§è¡Œä»£ç ï¼Œå­˜å‚¨ç±»å®šä¹‰
    local_vars = &#123;&#125;
    exec(component.code, globals(), local_vars)
    
    if component.name not in local_vars:
        raise HTTPException(status_code=400, detail=&quot;ä»£ç ä¸­å¿…é¡»å®šä¹‰åŒåç±»&quot;)
    
    components[component.name] = &#123;
        &quot;params&quot;: component.params,
        &quot;class&quot;: local_vars[component.name]
    &#125;
    return &#123;&quot;message&quot;: f&quot;ç»„ä»¶ &#123;component.name&#125; åˆ›å»ºæˆåŠŸ&quot;&#125;

@app.get(&quot;/api/components&quot;)
def list_components():
    &quot;&quot;&quot;
    è·å–æ‰€æœ‰æ³¨å†Œçš„ç»„ä»¶
    &quot;&quot;&quot;
    return &#123;&quot;components&quot;: list(components.keys())&#125;

class RunRequest(BaseModel):
    component_name: str
    history: list
    params: dict

@app.post(&quot;/api/components/run&quot;)
def run_component(request: RunRequest):
    &quot;&quot;&quot;
    è¿è¡ŒæŒ‡å®šçš„ç»„ä»¶ï¼Œå¹¶è¿”å›å…¶è¾“å‡º
    &quot;&quot;&quot;
    if request.component_name not in components:
        raise HTTPException(status_code=404, detail=&quot;ç»„ä»¶ä¸å­˜åœ¨&quot;)

    component_class = components[request.component_name][&quot;class&quot;]
    component_instance = component_class()
    
    # è°ƒç”¨ _run æ–¹æ³•ï¼Œæ¨¡æ‹Ÿè¿è¡Œ
    try:
        result = component_instance._run(request.history, **request.params)
    except Exception as e:
        raise HTTPException(status_code=500, detail=f&quot;ç»„ä»¶æ‰§è¡Œé”™è¯¯: &#123;str(e)&#125;&quot;)
    
    return &#123;&quot;result&quot;: result.to_dict(orient=&quot;records&quot;)&#125;

# è¿è¡ŒæœåŠ¡å™¨ï¼ˆå¯é€‰ï¼šæ‰‹åŠ¨æ‰§è¡Œ uvicorn server:app --reloadï¼‰
if __name__ == &quot;__main__&quot;:
    import uvicorn
    uvicorn.run(app, host=&quot;0.0.0.0&quot;, port=8000)
</code></pre>
<hr>
<h1 id="2ï¸âƒ£-å‰ç«¯ä»£ç "><a href="#2ï¸âƒ£-å‰ç«¯ä»£ç " class="headerlink" title="2ï¸âƒ£ å‰ç«¯ä»£ç "></a><strong>2ï¸âƒ£ å‰ç«¯ä»£ç </strong></h1><h3 id="ğŸ“Œ-HTML-é¡µé¢"><a href="#ğŸ“Œ-HTML-é¡µé¢" class="headerlink" title="ğŸ“Œ HTML é¡µé¢"></a><strong>ğŸ“Œ HTML é¡µé¢</strong></h3><p>ğŸ“Œ <strong>ä»£ç ï¼ˆindex.htmlï¼‰ï¼š</strong></p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;zh&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;åŠ¨æ€ç»„ä»¶ç®¡ç†&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;åˆ›å»ºåŠ¨æ€ç»„ä»¶&lt;/h2&gt;
    &lt;form id=&quot;componentForm&quot;&gt;
        &lt;label&gt;ç»„ä»¶åç§°ï¼š&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;componentName&quot; required&gt;&lt;br&gt;&lt;br&gt;

        &lt;label&gt;å‚æ•° (JSON æ ¼å¼)ï¼š&lt;/label&gt;
        &lt;textarea id=&quot;componentParams&quot; required&gt;&#123;&quot;param1&quot;: &quot;value1&quot;&#125;&lt;/textarea&gt;&lt;br&gt;&lt;br&gt;

        &lt;label&gt;Python ä»£ç ï¼š&lt;/label&gt;
        &lt;textarea id=&quot;componentCode&quot; required&gt;
class TestComponent:
    def _run(self, history, **kwargs):
        return pd.DataFrame([&#123;&#39;content&#39;: &#39;Hello, this is a test!&#39;&#125;])
        &lt;/textarea&gt;&lt;br&gt;&lt;br&gt;

        &lt;button type=&quot;button&quot; onclick=&quot;submitNewComponent()&quot;&gt;æäº¤ç»„ä»¶&lt;/button&gt;
    &lt;/form&gt;

    &lt;h2&gt;è¿è¡Œç»„ä»¶&lt;/h2&gt;
    &lt;label&gt;ç»„ä»¶åç§°ï¼š&lt;/label&gt;
    &lt;input type=&quot;text&quot; id=&quot;runComponentName&quot; required&gt;&lt;br&gt;&lt;br&gt;
    &lt;button type=&quot;button&quot; onclick=&quot;runComponent()&quot;&gt;è¿è¡Œç»„ä»¶&lt;/button&gt;

    &lt;h3&gt;è¿è¡Œç»“æœï¼š&lt;/h3&gt;
    &lt;pre id=&quot;result&quot;&gt;&lt;/pre&gt;

    &lt;script src=&quot;test.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<hr>
<h3 id="ğŸ“Œ-JavaScript-ä»£ç "><a href="#ğŸ“Œ-JavaScript-ä»£ç " class="headerlink" title="ğŸ“Œ JavaScript ä»£ç "></a><strong>ğŸ“Œ JavaScript ä»£ç </strong></h3><p>ğŸ“Œ <strong>ä»£ç ï¼ˆtest.jsï¼‰ï¼š</strong></p>
<pre><code class="js">const apiBaseUrl = &quot;http://localhost:8000/api&quot;;  // æ›¿æ¢ä¸ºä½ çš„æœåŠ¡å™¨åœ°å€

function submitNewComponent() &#123;
    const name = document.getElementById(&quot;componentName&quot;).value;
    const params = document.getElementById(&quot;componentParams&quot;).value;
    const code = document.getElementById(&quot;componentCode&quot;).value;

    fetch(`$&#123;apiBaseUrl&#125;/components/create`, &#123;
        method: &quot;POST&quot;,
        headers: &#123; &quot;Content-Type&quot;: &quot;application/json&quot; &#125;,
        body: JSON.stringify(&#123;
            name: name,
            params: JSON.parse(params),
            code: code
        &#125;)
    &#125;)
    .then(response =&gt; response.json())
    .then(data =&gt; alert(data.message || JSON.stringify(data)))
    .catch(error =&gt; console.error(&quot;Error:&quot;, error));
&#125;

function runComponent() &#123;
    const componentName = document.getElementById(&quot;runComponentName&quot;).value;

    fetch(`$&#123;apiBaseUrl&#125;/components/run`, &#123;
        method: &quot;POST&quot;,
        headers: &#123; &quot;Content-Type&quot;: &quot;application/json&quot; &#125;,
        body: JSON.stringify(&#123;
            component_name: componentName,
            history: [],
            params: &#123;&#125;
        &#125;)
    &#125;)
    .then(response =&gt; response.json())
    .then(data =&gt; &#123;
        document.getElementById(&quot;result&quot;).innerText = JSON.stringify(data, null, 2);
    &#125;)
    .catch(error =&gt; console.error(&quot;Error:&quot;, error));
&#125;
</code></pre>
<hr>
<h1 id="3ï¸âƒ£-ä½¿ç”¨-Postman-æµ‹è¯•"><a href="#3ï¸âƒ£-ä½¿ç”¨-Postman-æµ‹è¯•" class="headerlink" title="3ï¸âƒ£ ä½¿ç”¨ Postman æµ‹è¯•"></a><strong>3ï¸âƒ£ ä½¿ç”¨ Postman æµ‹è¯•</strong></h1><p>å¯åŠ¨æœåŠ¡å™¨åï¼Œå¯ä»¥ä½¿ç”¨ Postman æµ‹è¯• APIã€‚</p>
<h3 id="ï¼ˆ1ï¼‰åˆ›å»ºåŠ¨æ€ç»„ä»¶"><a href="#ï¼ˆ1ï¼‰åˆ›å»ºåŠ¨æ€ç»„ä»¶" class="headerlink" title="ï¼ˆ1ï¼‰åˆ›å»ºåŠ¨æ€ç»„ä»¶"></a><strong>ï¼ˆ1ï¼‰åˆ›å»ºåŠ¨æ€ç»„ä»¶</strong></h3><ul>
<li><p><strong>æ–¹æ³•</strong>ï¼š<code>POST</code></p>
</li>
<li><p><strong>URL</strong>ï¼š<code>http://localhost:8000/api/components/create</code></p>
</li>
<li><p>Bodyï¼ˆJSONï¼‰</p>
<pre><code class="python">&#123;
  &quot;name&quot;: &quot;TestComponent&quot;,
  &quot;params&quot;: &#123;
    &quot;param1&quot;: &quot;value1&quot;
  &#125;,
  &quot;code&quot;: &quot;class TestComponent:\n    def _run(self, history, **kwargs):\n        return pd.DataFrame([&#123;&#39;content&#39;: &#39;Hello, world!&#39;&#125;])&quot;
&#125;
</code></pre>
</li>
<li><p>æœŸæœ›ç»“æœ</p>
<pre><code class="python">&#123;
  &quot;message&quot;: &quot;ç»„ä»¶ TestComponent åˆ›å»ºæˆåŠŸ&quot;
&#125;
</code></pre>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰è¿è¡Œç»„ä»¶"><a href="#ï¼ˆ2ï¼‰è¿è¡Œç»„ä»¶" class="headerlink" title="ï¼ˆ2ï¼‰è¿è¡Œç»„ä»¶"></a><strong>ï¼ˆ2ï¼‰è¿è¡Œç»„ä»¶</strong></h3><ul>
<li><p><strong>æ–¹æ³•</strong>ï¼š<code>POST</code></p>
</li>
<li><p><strong>URL</strong>ï¼š<code>http://localhost:8000/api/components/run</code></p>
</li>
<li><p>Bodyï¼ˆJSONï¼‰</p>
<p>ï¼š</p>
<pre><code class="python">&#123;
  &quot;component_name&quot;: &quot;TestComponent&quot;,
  &quot;history&quot;: [],
  &quot;params&quot;: &#123;&#125;
&#125;
</code></pre>
</li>
<li><p>æœŸæœ›ç»“æœ</p>
<p>ï¼š</p>
<pre><code class="python">&#123;
  &quot;result&quot;: [&#123;&quot;content&quot;: &quot;Hello, world!&quot;&#125;]
&#125;
</code></pre>
</li>
</ul>
<hr>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h2><ul>
<li><strong>åç«¯</strong>ï¼šFastAPI å®ç°äº†ç»„ä»¶åˆ›å»ºã€æŸ¥è¯¢ã€è¿è¡Œçš„ APIã€‚</li>
<li><strong>å‰ç«¯</strong>ï¼šHTML + JS æä¾›äº¤äº’ç•Œé¢ï¼Œç”¨æˆ·å¯è¾“å…¥å‚æ•°å’Œä»£ç ã€‚</li>
<li><strong>æµ‹è¯•</strong>ï¼šå¯ç”¨ Postman è°ƒè¯•ï¼Œç¡®ä¿ç»„ä»¶èƒ½è¢«åŠ¨æ€åˆ›å»ºå’Œè¿è¡Œã€‚</li>
</ul>
<p>ğŸš€ <strong>ç°åœ¨ï¼Œä½ å¯ä»¥åœ¨ Postman æˆ–å‰ç«¯ç•Œé¢ä¸­æµ‹è¯•ä½ çš„åŠ¨æ€ç»„ä»¶åŠŸèƒ½äº†ï¼</strong></p>
<hr>
<p><span style = "color:red"><strong>çº¯åç«¯æƒ…å†µå¦‚ä½•æ·»åŠ è‡ªå®šä¹‰ç»„ä»¶å‘¢</strong></span></p>
<p>è¿™é‡Œä»¥æˆ‘ç¢ç£¨çš„<strong>JSONPath</strong>è‡ªå®šä¹‰ç»„ä»¶ä¸ºä¾‹</p>
<p>é¦–å…ˆè¦æ¸…æ¥šRAGFlowçš„æ‰§è¡Œæµç¨‹ è¦äº†è§£ç”»å¸ƒçš„æµç¨‹ æ¨èå…ˆçœ‹ä¸€éRAGFlowæ‰§è¡Œæµç¨‹çš„æ–‡æ¡£ ç„¶åäº†è§£ä¸€ä¸‹canvas.pyå’Œcanvas_app.pyçš„æºç  æŒæ¡æ•´ä½“æµç¨‹ã€‚</p>
<p>è¿™é‡Œæœ€é‡è¦çš„ä¸€ä¸ªæ€æƒ³è¦æ˜ç™½ ç°åœ¨ä½ åªæœ‰åç«¯ ä½ æ²¡æœ‰å‰ç«¯ ä½ åœ¨RAGFlowå›¾å½¢åŒ–ç•Œé¢æ‹–æ‹½è¿›å»çš„å½¢å¼å·²ç»æ— æ³•é’ˆå¯¹äºçº¯åç«¯æ·»åŠ è‡ªå®šä¹‰ç»„ä»¶äº† é‚£æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹æ€è·¯ æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆï¼Ÿæˆ‘ä»¬æƒ³è¦å›¾å½¢åŒ–ç•Œé¢æ‹–æ‹½è¿‡åçš„æ•´ä½“æ•°æ® ä¹Ÿå°±æ˜¯æ•°æ®åº“é‡Œçš„dslï¼Œæˆ‘ä»¬è¦æ‹¿åˆ°å®ƒ ç„¶åç”¨æˆ‘ä»¬è‡ªå·±å¼€å‘çš„è‡ªå®šä¹‰ç»„ä»¶å»è§£æè¿™ä¸ªå¤§å¤§çš„JSONã€‚é‚£ä¹ˆè¿™é‡Œå°±æ¶‰åŠåˆ°æ²¡æœ‰å‰ç«¯ ä½ å¦‚ä½•å»åç«¯å»æ·»åŠ è‡ªå·±åšçš„è‡ªå®šä¹‰ç»„ä»¶ï¼å½“ç„¶å¸¸è§„æ–¹æ³• å»å›¾å½¢åŒ–ç•Œé¢æ‹–æ‹½å·²ç»æ— æ³•å®Œæˆè¿™ç§æ“ä½œ ä½ åªèƒ½æŠŠå¸Œæœ›å¯„æ‰˜åœ¨æ•°æ®åº“ </p>
<p>æˆ‘ä»¬æ¥æ‰“å¼€æ•°æ®åº“ æ­¤æ—¶ä½ éœ€è¦ä¸€ä¸ªç»„ä»¶çš„æ•°æ®è¡¨ component</p>
<p>â€“ rag_flow.component definition</p>
<p>CREATE TABLE <code>component</code> (</p>
<p>  <code>id</code> varchar(32) NOT NULL,</p>
<p>  <code>create_time</code> bigint DEFAULT NULL,</p>
<p>  <code>create_date</code> datetime DEFAULT NULL,</p>
<p>  <code>update_time</code> bigint DEFAULT NULL,</p>
<p>  <code>update_date</code> datetime DEFAULT NULL,</p>
<p>  <code>tenant_id</code> varchar(32) NOT NULL,</p>
<p>  <code>module</code> varchar(255) NOT NULL,</p>
<p>  <code>created_by</code> varchar(32) NOT NULL,</p>
<p>  <code>is_deleted</code> tinyint DEFAULT â€˜0â€™,</p>
<p>  PRIMARY KEY (<code>id</code>)</p>
<p>) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4 COLLATE&#x3D;utf8mb4_0900_ai_ci;</p>
<p>è¿™æ˜¯åˆ›å»ºè¡¨çš„ä¿¡æ¯ ç›®å‰æˆ‘ä»¬åªéœ€è¦å…³æ³¨moduleé‡Œé¢çš„ æˆ‘ä»¬è¦æŠŠæˆ‘ä»¬è‡ªå·±å¼€å‘çš„ç»„ä»¶æŒ‰ç…§é‚£äº›å½¢å¼æ·»åŠ è¿›å» æˆ‘çš„ç»„ä»¶å«:â€jsonpathâ€ é‚£ä¹ˆæˆ‘çš„moduleé‡Œé¢å°±åº”è¯¥æ˜¯agent.component.jsonpath å½“ç„¶ä½ è¦æŒ‰ç…§å®ƒçš„é£æ ¼æŠŠç»„ä»¶æ”¾åœ¨è¿™ä¸ªåŒ…é‡Œé¢ã€‚</p>
<p>å…¶æ¬¡è¿˜è¦æ³¨æ„åœ¨è¿™ä¸ªåŒ…é‡Œé¢çš„__init__.py </p>
<p>æŠŠä½ çš„ç»„ä»¶åŠ è¿›å» â€œjsonpathâ€:â€JSONPathâ€</p>
<p>æ­¤æ—¶å¹¶éä¸‡äº‹å¤§å‰ å› ä¸ºæˆ‘ä»¬ç›®å‰åªæœ‰çº¯åç«¯ æ²¡æœ‰å‰ç«¯é‚£äº› æ‰€ä»¥å›åˆ°å¼€å¤´æ‰€è¯´ ä½ è¦è‡ªå·±æŠŠä½ çš„ç»„ä»¶ä»¥jsonçš„æ ¼å¼æ‰‹åŠ¨åŠ å…¥åˆ°æ•°æ®åº“çš„dslä¸­ å› ä¸ºå¾ˆé•¿æ‰€ä»¥ä½ éœ€è¦<a target="_blank" rel="noopener" href="https://www.json.cn/">JSONåœ¨çº¿è§£ææ ¼å¼åŒ–éªŒè¯ - JSON.cn</a>å»è®©å®ƒå±•ç¤ºçš„æ›´ç›´è§‚</p>
<p>è¿™æ˜¯æˆ‘ç»„ä»¶éœ€è¦çš„json ä½ è¦æ‰‹åŠ¨çš„å»æ·»åŠ åˆ°dsl æ­¥éª¤å°±æ˜¯å…ˆå¤åˆ¶æ•°æ®åº“çš„dsl ç„¶åæ”¾åœ¨è§£æå™¨é‡Œé¢ <strong>æ‰‹åŠ¨çš„å»æ·»åŠ è‡ªå·±çš„ç»„ä»¶</strong></p>
<p>â€œJSONPath:PathProcessorâ€: {â€œobjâ€: {â€œcomponent_nameâ€: â€œJSONPathâ€,â€paramsâ€: {â€œoutput_var_nameâ€: â€œoutputâ€,â€jsonpath_exprâ€: â€œ$.components[*].obj.component_nameâ€,â€debug_modeâ€: true,â€queryâ€: [],â€inputsâ€: [],â€debug_inputsâ€: [],â€outputâ€: {â€œcontentâ€: {â€œ0â€: â€œâ€}}}},â€downstreamâ€: [â€œGenerate:TwelveClocksSpeakâ€],â€upstreamâ€: []}</p>
<p>è¿™åªæ˜¯æˆ‘çš„ç»„ä»¶json ä½ éœ€è¦åœ¨å®Œæ•´çš„dslæŠŠå®ƒæ’å…¥è¿›å» æŒ‰ç…§å®ƒä»¬å½¢æˆçš„æ ¼å¼ è¿™é‡Œè¯´æ˜ä¸€ä¸‹ dslå°±æ˜¯ä½ åœ¨å›¾å½¢åŒ–ç•Œé¢åˆ›å»ºagentçš„æ—¶å€™é‡Œé¢å„å„ç»„ä»¶çš„ç›¸å…³ä¿¡æ¯ å½“ç„¶ä½ è¿˜è¦æ³¨æ„è‡ªå·±å†™çš„ç»„ä»¶ç±»å‹ æ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„ ä½ æ‰èƒ½å»åšåˆ°å¯¹åº”ç›¸åº”çš„å¤„ç† æ¯”å¦‚è¯´æˆ‘è¿™ä¸ªæ˜¯è§£æjsonçš„ é‚£æˆ‘å°±ä¸èƒ½å»æ‹¿ä¸Šä¸‹æ–‡ç»„ä»¶çš„è¾“å…¥æˆ–è¾“å‡º æ­£å¸¸çš„æµç¨‹æ˜¯è¿çº¿åä½ è¦æ‹¿åˆ°ä¸Šæ¸¸çš„è¾“å‡ºç»“æœ ä½œä¸ºä½ ç»„ä»¶çš„è¾“å…¥ç»“æœã€‚æˆ‘è¿™ä¸ªåˆ™æ˜¯æ‹¿åˆ°å…¨å±€ç”»å¸ƒcanvas_dataæ•°æ®å†å»è¿›è¡Œè§£æ</p>
<p>æ‰€ä»¥è¦æ˜ç™½éœ€æ±‚æ‰èƒ½å»æ›´å¥½çš„èå…¥ä»£ç ä¸­ ç»è¿‡è¿™å‡ å¤©çš„å­¦ä¹ çœŸçš„æ„Ÿè§‰ åªæœ‰è‡ªå·±ä¸€ç‚¹ç‚¹çš„æ‘¸ç´¢è¿‡åæ‰èƒ½çœŸæ­£çš„å°è±¡æ·±åˆ» æ‰èƒ½æ…¢æ…¢å˜å¾—å¼ºå¤§ï¼</p>

    </div>

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <div id="comment">
        <div id="gitalk-container">
        </div>
    </div>
    
</div>
                     
<footer id="footer">
    <div class="footer-wrap">
        <div>
            Â© 2018 - 2026 P-luminary
            <span class="footer-icon">
                <a-icon type="flag" theme="filled" /></span>
            @Asuna
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a>
<!--         & <a target="_blank" rel="noopener" href="https://github.com/korilin/hexo-theme-particle">Particle Theme</a></div> -->
        
    </div>

</footer>

<script src="/js/highlight.min.js"></script>
<script src="/js/particle.js"></script>
                </div>
            </div>
        </transition>
    </div>

    <script>
    new Vue({
        el: "#layout",
        data: {
            show_page: false,
            onload_menu: false,
            menu_show: false,
            card_top: 100
        },
        created: function () {
            var that = this
            window.onload = function () {
                that.show_page = true
                document.getElementById("loadcontent").style.opacity = 0
                setTimeout(function () {
                    document.getElementById("loadleft").style.width = 0
                    document.getElementById("loadright").style.width = 0
                }, 300)
                setTimeout(function () {
                    document.getElementById("loading").style = "display:none"
                }, 600)
            }
        },
        mounted: function () {
            var that = this
            window.addEventListener('scroll', function (e) {
                that.menu_show = false
            })
        },
        methods: {
            home_click: function () {
                window.scrollTo({
                    top: window.innerHeight - 80,
                    behavior: "smooth",
                });
            }
        }
    })
</script>

<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
    const gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'hexo-theme-particle',      // The repository of store comments,
        owner: 'P-luminary',
        admin: ['P-luminary'],
        language: 'en',
        id: location.pathname,      // Ensure uniqueness and length less than 50
        distractionFreeMode: true  // Facebook-like distraction free mode
    })
    gitalk.render('gitalk-container')
</script>

</body>

</html>