
<!DOCTYPE html>
<html lang="zh_CH ">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P-luminary || SpringCloud基础+电商实战</title>
    <meta name="author" content="Asuna">
    <meta name="description" content=" ">
    <meta name="keywords" content=" ">
    <link rel="icon" href="/https://raw.githubusercontent.com/P-luminary/images/master/data/asuna.jpg">
    <link rel="stylesheet" href="/css/antd.min.css">
    
    <link rel="stylesheet" href="/css/maiden-theme.css">
    
    <script src="/js/vue.js"></script>
    <script src="/js/antd.min.js"></script>
<meta name="generator" content="Hexo 6.1.0"></head>

<body>

    <div id="loading"
        style="height: 100vh; width: 100%; position: fixed;display: flex;z-index: 200; justify-content: space-between;">
        <div id="loadleft" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div id="loadright" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div
            style="position: fixed; height: 100vh; width: 100%;display: flex;justify-content: center;align-items: center;">
            <div id="loadcontent"
                style="width:400px;height:400px;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px#a3ddfb; text-align:center;opacity:1;transition:opacity 0.3s ease-out;">
                <div>
                    <h2>LOADING...</h2>
                    <p>加载过慢请开启缓存(浏览器默认开启)</p>
                    <div>
                        <img src="/dancingkitty.gif" alt="loading">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="layout">
        <transition name="into">
            <div v-show="show_page" style="display: none;">
                <div id="menu_show">
                     
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">P-luminary</span>
        </a>
        
        <a href="/">
            <span>
                <a-icon type="home" theme="filled" />
            </span>
            <span>home</span>
        </a>
        
        <a href="/tags/语法">
            <span>
                <a-icon type="tags" theme="filled" />
            </span>
            <span>tags</span>
        </a>
        
    </div>

    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div :class="'title'" @click="menu_show=!menu_show">
            <span style="margin-right: 10px;">
                <a-icon type="appstore" theme="filled" />
            </span>
            <span>P-luminary</span>
        </div>
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="home" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">home</div>
                </div>
            </a>
            
            <a href="/tags/语法">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="tags" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">tags</div>
                </div>
            </a>
            
        </div>
        <div class="curtain" v-show="menu_show"></div>
    </div>

</nav>
                </div>

                <div id="main">
                     
<link rel="stylesheet" href="/css/post-body.css">
<div class="article">
    <div>
        <h1>SpringCloud基础+电商实战 </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <a-icon type="calendar" theme="filled" />
            </span>
            2024/4/11
        </span>

        

        

        <span class="tags">
            <span class="icon">
                <a-icon type="tags" theme="filled" />
            </span>
            
            <span class="tag">
                
                <a href="/tags/后端" style=color:#ff7d73>
                    后端
                </a>
            </span>
            
        </span>
        
    </div>

    <div class="content" v-pre>
        <h1 id="Spring-Cloud基础介绍"><a href="#Spring-Cloud基础介绍" class="headerlink" title="Spring Cloud基础介绍"></a>Spring Cloud基础介绍</h1><ul>
<li>微服务的基本概念、设计与拆分原则</li>
<li>微服务和Spring Cloud的关系</li>
<li>微服务常见的组件和功能</li>
<li>课程查询案例基本介绍、系统架构设计和接口设计</li>
<li>分模块构建Spring Cloud项目</li>
<li>完成课程列表、课程价格服务开发</li>
<li>课程服务整合，服务注册与发现</li>
<li>整合Feign实现服务间调用</li>
<li>网关的集成与开发，并接入服务</li>
<li>引入服务的熔断与降级，并进行实操演练</li>
</ul>
<h2 id="微服务基础"><a href="#微服务基础" class="headerlink" title="微服务基础"></a>微服务基础</h2><ul>
<li><strong>什么是</strong>微服务？</li>
<li>微服务的<strong>特点</strong></li>
<li>微服务<strong>优缺点</strong></li>
<li>微服务的<strong>两大门派</strong> [Spring Cloud 和 Dubbo]</li>
<li>微服务<strong>拆分</strong></li>
<li>微服务<strong>扩展</strong></li>
<li>微服务<strong>重要模块</strong></li>
</ul>
<h3 id="微服务热度"><a href="#微服务热度" class="headerlink" title="微服务热度"></a>微服务热度</h3><h5 id="单体应用的痛点"><a href="#单体应用的痛点" class="headerlink" title="单体应用的痛点"></a>单体应用的痛点</h5><p><img src="https://raw.githubusercontent.com/P-luminary/images/ebd1e99f500608925cfe2623d05c22b5a75cb4a3/data/%E5%8D%95%E4%BD%93%E4%B8%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%8C%BA%E5%88%AB.jpg"></p>
<h5 id="什么是服务化"><a href="#什么是服务化" class="headerlink" title="什么是服务化"></a>什么是服务化</h5><ul>
<li>把传统的单机应用中的本地方法调用，改造成通过<strong>RPC、HTTP</strong>产生的远程方法调用</li>
<li>把模块从单体应用中拆分出来，<strong>独立</strong>成一个服务部署</li>
</ul>
<h5 id="什么是微服务"><a href="#什么是微服务" class="headerlink" title="什么是微服务"></a>什么是微服务</h5><ul>
<li><p>一系列、一部分</p>
</li>
<li><p>是一种架构风格</p>
</li>
<li><p>开发单体应用作为一系列<strong>小型服务</strong>的套件，其中每个服务都运行再<strong>自己的进程</strong>中，并且通过<strong>轻量级</strong>的机制实现彼此间的通信，这通常是<strong>HTTP</strong>资源API</p>
</li>
<li><p>这些服务是围绕着业务功能构建的，并且可以通过完全<strong>自动化的部署</strong>机制进行独立部署</p>
</li>
<li><p>这些服务的集中式管理做到了最小化(例如<strong>docker</strong>相关技术)，每一种服务都可以通过<strong>不同的编程语言</strong>进行编写，并且可以使用<strong>不同的数据存储</strong>技术</p>
</li>
</ul>
<h3 id="微服务的特点"><a href="#微服务的特点" class="headerlink" title="微服务的特点"></a>微服务的特点</h3><ul>
<li><p>组件以<strong>服务</strong>形式来提供</p>
</li>
<li><p>产品不是项目</p>
</li>
<li><p>轻量级通信、独立进程</p>
</li>
<li><p><strong>分散</strong>治理、去中心化治理</p>
</li>
<li><p><strong>容错性</strong>设计</p>
</li>
<li><h6 id="会带来团队组织架构的调整"><a href="#会带来团队组织架构的调整" class="headerlink" title="会带来团队组织架构的调整"></a>会带来团队组织架构的调整</h6></li>
</ul>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/82f8b26e0790184252e432ce2e28a606fb938e89/data/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AF%B9%E5%9B%A2%E9%98%9F%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84%E7%9A%84%E8%B0%83%E6%95%B4.jpg"></p>
<h3 id="微服务优缺点"><a href="#微服务优缺点" class="headerlink" title="微服务优缺点"></a>微服务优缺点</h3><ul>
<li>服务简单、便于学习和上手，相对<strong>易于维护</strong></li>
<li>独立部署，<strong>灵活</strong>扩展</li>
<li><strong>技术栈</strong>丰富</li>
</ul>
<h5 id="微服务缺点"><a href="#微服务缺点" class="headerlink" title="微服务缺点"></a>微服务缺点</h5><ul>
<li><strong>运维</strong>成本过高 [磁盘满 CPU高]</li>
<li>接口可能<strong>不匹配</strong></li>
<li>代码可能<strong>重复</strong> [要非常明确的定义每个API]</li>
<li><strong>架构复杂度</strong>提高</li>
</ul>
<h3 id="微服务两大门派"><a href="#微服务两大门派" class="headerlink" title="微服务两大门派"></a>微服务两大门派</h3><ul>
<li><strong>Spring Cloud</strong>：众多子项目【最大供应者：Netflix内容付费知识】</li>
<li><strong>dubbo</strong>：高性能、轻量级的开源Java RPC框架，它提供了三大核心能力：面向接口的远程方法调用，智能容错和负载均衡，以及服务自动注册和发现</li>
<li>dubbo提供的能力只是SpringCloud的一部分<strong>子集</strong></li>
</ul>
<h6 id="Dubbo虽然有很多不提供的组件-但是可以和其他供应商合作完成提供任务"><a href="#Dubbo虽然有很多不提供的组件-但是可以和其他供应商合作完成提供任务" class="headerlink" title="[Dubbo虽然有很多不提供的组件 但是可以和其他供应商合作完成提供任务]"></a>[Dubbo虽然有很多不提供的组件 但是可以和其他供应商合作完成提供任务]</h6><table>
<thead>
<tr>
<th>核心组件</th>
<th>Dubbo</th>
<th>Spring Cloud</th>
</tr>
</thead>
<tbody><tr>
<td>服务注册中心</td>
<td>Zookeeper</td>
<td>Spring Cloud Netflix Eureka</td>
</tr>
<tr>
<td>服务调用方式</td>
<td>RPC</td>
<td>REST API</td>
</tr>
<tr>
<td>服务网关</td>
<td>无</td>
<td>Spring Cloud Netflix Zuul</td>
</tr>
<tr>
<td>断路器</td>
<td>不完善</td>
<td>Spring Cloud Netflix Hystrix</td>
</tr>
<tr>
<td>分布式配置</td>
<td>无</td>
<td>Spring Cloud Config</td>
</tr>
<tr>
<td>服务跟踪</td>
<td>无</td>
<td>Spring Cloud Sleuth</td>
</tr>
<tr>
<td>消息总线</td>
<td>无</td>
<td>Spring Cloud Bus</td>
</tr>
<tr>
<td>数据流</td>
<td>无</td>
<td>Spring Cloud Stream</td>
</tr>
<tr>
<td>批量任务</td>
<td>无</td>
<td>Spring Cloud Task</td>
</tr>
</tbody></table>
<h5 id="通信协议对比"><a href="#通信协议对比" class="headerlink" title="通信协议对比"></a>通信协议对比</h5><ul>
<li><strong>RPC</strong> vs <strong>REST</strong></li>
<li>服务提供方与调用方接口依赖方式太强</li>
<li>服务对平台敏感，难以简单复用</li>
</ul>
<h5 id="文档质量对比"><a href="#文档质量对比" class="headerlink" title="文档质量对比"></a>文档质量对比</h5><ul>
<li>Dubbo的文档可以说再国内开源框架中算是一流的，提供了中文与英文两种版本</li>
<li>Spring Cloud文档体量大，更多的是偏向整合，更深的使用方法还是需要查看整合组件的详细文档</li>
</ul>
<h5 id="两大门派选型建议"><a href="#两大门派选型建议" class="headerlink" title="两大门派选型建议"></a>两大门派选型建议</h5><ul>
<li>Dubbo &#x3D;&gt; 组装电脑 【中文文档多】</li>
<li>Spring Cloud &#x3D;&gt; 品牌机【稳定可靠】</li>
</ul>
<h3 id="微服务拆分"><a href="#微服务拆分" class="headerlink" title="微服务拆分"></a>微服务拆分</h3><h5 id="什么时候进行服务化拆分"><a href="#什么时候进行服务化拆分" class="headerlink" title="什么时候进行服务化拆分"></a>什么时候进行服务化拆分</h5><ul>
<li><strong>第一阶段</strong>的主要目标是快速开发和验证想法</li>
<li>进一步增加<strong>更多的新特性</strong>来吸引更多的目标用户</li>
<li>同时进行开发的人员<strong>超过10人</strong>，这个时候就该考虑到服务化拆分了</li>
</ul>
<h5 id="不适合拆分的情况"><a href="#不适合拆分的情况" class="headerlink" title="不适合拆分的情况"></a>不适合拆分的情况</h5><ul>
<li>小团队，技术基础较薄弱</li>
<li>流量不高，压力小，业务变化也不大</li>
<li>对延迟很敏感的低延迟高并发系统</li>
</ul>
<h5 id="服务化拆分的两种方式"><a href="#服务化拆分的两种方式" class="headerlink" title="服务化拆分的两种方式"></a>服务化拆分的两种方式</h5><ul>
<li>纵向拆分[上方区别图]</li>
<li>横向拆分</li>
<li>结合业务综合分析</li>
</ul>
<h3 id="服务扩展"><a href="#服务扩展" class="headerlink" title="服务扩展"></a>服务扩展</h3><h5 id="维度"><a href="#维度" class="headerlink" title="维度"></a>维度</h5><p><img src="https://raw.githubusercontent.com/P-luminary/images/2f5e67f1d4e1d9f7acb927786096a1527bfd282b/data/%E7%BB%B4%E5%BA%A6-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%89%A9%E5%B1%95.jpg"></p>
<h5 id="自动按需扩展"><a href="#自动按需扩展" class="headerlink" title="自动按需扩展"></a>自动按需扩展</h5><ul>
<li>根据CPU负载程度、特定时间(比如周末)、消息中间件的队列长度、业务具体规则、预测等来决定是否扩展</li>
<li>自动分配一个新的服务实例，提高<strong>可用性</strong></li>
<li>提高了<strong>可伸缩性</strong>(双11之后，自动减少服务器)</li>
<li>具有<strong>最佳使用率</strong>，节约成本</li>
</ul>
<h3 id="微服务重要模块"><a href="#微服务重要模块" class="headerlink" title="微服务重要模块"></a>微服务重要模块</h3><ul>
<li>服务描述</li>
<li>注册中心</li>
<li>服务框架</li>
<li>负载均衡</li>
<li>熔断和降级</li>
<li>网关</li>
</ul>
<h1 id="Spring-Cloud课程查询"><a href="#Spring-Cloud课程查询" class="headerlink" title="Spring Cloud课程查询"></a><span style = "color:red">Spring Cloud课程查询</span></h1><ul>
<li>Spring Cloud简介</li>
<li>项目<strong>整体设计</strong></li>
<li>课程列表模块开发</li>
<li><span style = "color:red">课程价格模块开发</span> [模块间互相调用]</li>
<li>服务注册与发现<strong>Eureka</strong></li>
<li>服务间调用<strong>Feign</strong></li>
<li>负载均衡<strong>Ribbon</strong></li>
<li>熔断器<strong>Hystrix</strong> [兜底界面 默认返回]</li>
<li>网关<strong>Zuul</strong></li>
<li>整体测试</li>
</ul>
<h3 id="Spring-Cloud简介"><a href="#Spring-Cloud简介" class="headerlink" title="Spring Cloud简介"></a>Spring Cloud简介</h3><ul>
<li>成熟的微服务框架，定位为开发人员提供工具，以快速构建分布式系统</li>
</ul>
<h5 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h5><table>
<thead>
<tr>
<th align="center">核心组件</th>
<th align="center">Spring Cloud</th>
</tr>
</thead>
<tbody><tr>
<td align="center">服务注册中心</td>
<td align="center">Spring Cloud Netflix Eureka</td>
</tr>
<tr>
<td align="center">服务调用方式</td>
<td align="center">REST API、Feign、Ribbon</td>
</tr>
<tr>
<td align="center">服务网关</td>
<td align="center">Spring Cloud Netflix Zuul</td>
</tr>
<tr>
<td align="center">熔断器</td>
<td align="center">Spring Cloud Netflix Hystrix</td>
</tr>
</tbody></table>
<h3 id="项目整体设计"><a href="#项目整体设计" class="headerlink" title="项目整体设计"></a>项目整体设计</h3><ul>
<li><p>项目介绍</p>
</li>
<li><h5 id="接口设计"><a href="#接口设计" class="headerlink" title="接口设计"></a>接口设计</h5><ul>
<li>课程列表</li>
<li>单个课程价格</li>
<li>整合课程列表和价格</li>
</ul>
</li>
<li><p><strong>表设计</strong></p>
</li>
</ul>
<h3 id="系统数据流向"><a href="#系统数据流向" class="headerlink" title="系统数据流向"></a>系统数据流向</h3><blockquote>
<p>【课程列表数据】→ 【课程列表服务】<br>                                                  ↓<br>【课程价格数据】→ 【课程价格服务】→ 【整体列表+价格】</p>
</blockquote>
<h3 id="新建多模块项目"><a href="#新建多模块项目" class="headerlink" title="新建多模块项目"></a>新建多模块项目</h3><pre><code class="java">创建一个 spring-cloud-course-pracice 并删除src文件夹
新建New → module → Maven → course-service → 删除src
    新建New → module → New Module → Maven → course-list → Parent：course-service 
    新建New → module → New Module → Maven → course-price → Parent：course-service 
D:\Java+4399\阶段5：Java分布与微服务实战\第32周 Spring Cloud基础\第2节 Spring Cloud开发课程查询功能\辅助材料\SpringCloud课程查询源码【优质it资源微信it-wangke18】.zip\SpringCloud课程查询源码\课程价格模块开发后\spring-cloud-course-practice
</code></pre>
<h5 id="course-service-course-list"><a href="#course-service-course-list" class="headerlink" title="course-service.course-list"></a>course-service.course-list</h5><pre><code class="xml">pom.xml
    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
  &lt;parent&gt;
    &lt;artifactId&gt;course-service&lt;/artifactId&gt;
    &lt;groupId&gt;com.imooc&lt;/groupId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
  &lt;/parent&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  &lt;artifactId&gt;course-list&lt;/artifactId&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;mysql&lt;/groupId&gt;
      &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
      &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
      &lt;version&gt;2.1.1&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;
</code></pre>
<pre><code class="java">com/imooc/course/controller/CourseListController.java
package com.imooc.course.controller;

import com.imooc.course.entity.Course;
import com.imooc.course.service.CourseListService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

/**
 * CourseListController课程列表Controller
 */

@RestController
public class CourseListController &#123;
    //提供课程列表服务
    @Autowired //引入课程服务
    CourseListService courseListService;


    @GetMapping(&quot;/courses&quot;)
    public List&lt;Course&gt; courseList() &#123;
        //return → service
        return courseListService.getCourseList();
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/course/service/CourseListService.java
package com.imooc.course.service;

import com.imooc.course.entity.Course;

import java.util.List;

/**
 * 课程列表服务
 */
public interface CourseListService &#123;
    List&lt;Course&gt; getCourseList();
&#125;
</code></pre>
<pre><code class="java">com/imooc/course/service/impl/CourseListServiceImpl.java
package com.imooc.course.service.impl;

import com.imooc.course.dao.CourseMapper;
import com.imooc.course.entity.Course;
import com.imooc.course.service.CourseListService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

/**
 * 课程服务实现类
 */
@Service
public class CourseListServiceImpl implements CourseListService &#123;
    @Autowired
    CourseMapper courseMapper;
    @Override
    public List&lt;Course&gt; getCourseList() &#123;
        return courseMapper.findValidCourses();
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/course/entity/Course.java
package com.imooc.course.entity;

import java.io.Serializable;

/**
 * Course的实体类
 */
public class Course implements Serializable &#123;
    Integer id;
    Integer courseId;
    String courseName;
    Integer valid;

    @Override
    public String toString() &#123;
        return &quot;Course&#123;&quot; +
                &quot;id=&quot; + id +
                &quot;, courseId=&quot; + courseId +
                &quot;, courseName=&#39;&quot; + courseName + &#39;\&#39;&#39; +
                &quot;, valid=&quot; + valid +
                &#39;&#125;&#39;;
    &#125;
    Getter+Setter  
&#125;
</code></pre>
<pre><code class="java">com/imooc/course/dao/CourseMapper.java
package com.imooc.course.dao;

import com.imooc.course.entity.Course;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Select;
import org.springframework.stereotype.Repository;

import java.util.List;

/**
 * 描述课程的Mapper类
 */
@Mapper
@Repository
public interface CourseMapper &#123;
    @Select(&quot;SELECT * FROM course WHERE valid = 1&quot;)
    List&lt;Course&gt; findValidCourses();
&#125;
</code></pre>
<pre><code class="java">application.properties

server.port=8081
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/course_practice?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true
spring.datasource.username=root
spring.datasource.password=root
logging.pattern.console=%clr(%d&#123;$&#123;LOG_DATEFORMAT_PATTERN:HH:mm:ss.SSS&#125;&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:%wEx&#125;
# entity的实体类与数据库名进行驼峰命名转换
mybatis.configuration.map-underscore-to-camel-case=true 
spring.application.name=course-list
</code></pre>
<pre><code class="java">com/imooc/course/CoursePriceApplication.java
package com.imooc.course;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class CoursePriceApplication &#123;

    public static void main(String[] args) &#123;
        SpringApplication.run(CoursePriceApplication.class, args);
    &#125;
&#125;
=====================================================================
</code></pre>
<pre><code class="mysql">数据库名：course_practice
   表名：course
   字段：id[自增]   course_id   course_name   valid
</code></pre>
<h5 id="课程列表模块开发-总结-注意点"><a href="#课程列表模块开发-总结-注意点" class="headerlink" title="课程列表模块开发-总结 [注意点]"></a>课程列表模块开发-总结 [注意点]</h5><ul>
<li>多模块开发</li>
<li>实体类实现Serializable接口、set方法</li>
<li>MyBatis的驼峰配置</li>
</ul>
<h5 id="course-list-course-price"><a href="#course-list-course-price" class="headerlink" title="course-list.course-price"></a>course-list.course-price</h5><pre><code class="xml">pom.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
  &lt;parent&gt;
    &lt;artifactId&gt;course-service&lt;/artifactId&gt;
    &lt;groupId&gt;com.imooc&lt;/groupId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
  &lt;/parent&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  &lt;artifactId&gt;course-price&lt;/artifactId&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;mysql&lt;/groupId&gt;
      &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
      &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
      &lt;version&gt;2.1.1&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;
</code></pre>
<pre><code class="java">com/imooc/course/controller/CoursePriceController.java
package com.imooc.course.controller;

import com.imooc.course.entity.CoursePrice;
import com.imooc.course.service.CoursePriceService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

/**
 * 课程价格控制器
 */

@RestController
public class CoursePriceController &#123;
    @Autowired
    CoursePriceService coursePriceService;
    @GetMapping(&quot;/price&quot;)
    public Integer getCoursePrice(Integer courseId)&#123;
        CoursePrice coursePrice = coursePriceService.getCoursePrice(courseId);
        return coursePrice.getPrice();
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/course/service/CoursePriceService.java
package com.imooc.course.service;

import com.imooc.course.entity.CoursePrice;

import java.util.List;

/**
 * 课程价格服务
 */
public interface CoursePriceService &#123;
    CoursePrice getCoursePrice(Integer courseId);
&#125;
</code></pre>
<pre><code class="java">com/imooc/course/service/impl/CoursepriceServiceImpl.java
package com.imooc.course.service.impl;

import com.imooc.course.dao.CoursePriceMapper;
import com.imooc.course.entity.CoursePrice;
import com.imooc.course.service.CoursePriceService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

/**
 * 课程价格的服务实现类
 */
@Service
public class CoursepriceServiceImpl implements CoursePriceService &#123;
    @Autowired
    CoursePriceMapper coursePriceMapper;
    @Override
    public CoursePrice getCoursePrice(Integer courseId) &#123;
        return coursePriceMapper.findCoursePrice(courseId);
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/course/entity/CoursePrice.java
package com.imooc.course.entity;

import java.io.Serializable;

/**
 * CoursePrice的实体类
 */
public class CoursePrice implements Serializable &#123;
    Integer id;
    Integer courseId;
    Integer price;

    @Override
    public String toString() &#123;
        return &quot;CoursePrice&#123;&quot; +
                &quot;id=&quot; + id +
                &quot;, courseId=&quot; + courseId +
                &quot;, price=&quot; + price +
                &#39;&#125;&#39;;
    &#125;
    Getter+Setter
&#125;
</code></pre>
<pre><code class="java">com/imooc/course/dao/CoursePriceMapper.java
package com.imooc.course.dao;

import com.imooc.course.entity.CoursePrice;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Select;
import org.springframework.stereotype.Repository;

/**
 * 课程价格Mapper类
 */
@Mapper
@Repository
public interface CoursePriceMapper &#123;
    @Select(&quot;SELECT * FROM course_price WHERE course_id = #&#123;courseId&#125;&quot;)
    CoursePrice findCoursePrice(Integer courseId);
&#125;
</code></pre>
<pre><code class="java">com/imooc/course/CoursePriceApplication.java
package com.imooc.course;


import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class CoursePriceApplication &#123;

    public static void main(String[] args) &#123;
        SpringApplication.run(CoursePriceApplication.class, args);
    &#125;
&#125;
==========================================================
http://127.0.0.1:8082/price?courseId=409
</code></pre>
<pre><code class="mysql">数据库名：course_practice
   表名：course_price
   字段：id[自增]   course_id    price
</code></pre>
<h3 id="Eureka的作用和架构"><a href="#Eureka的作用和架构" class="headerlink" title="Eureka的作用和架构"></a>Eureka的作用和架构</h3><h5 id="Eureka"><a href="#Eureka" class="headerlink" title="Eureka"></a>Eureka</h5><ul>
<li>用于定位服务，直接找到组件中的各个服务地址</li>
<li>114[各种服务的提供者]、物业[维护各个住户的信息(注册中心)]</li>
</ul>
<h5 id="为什么需要服务注册与发现-移除不影响-但会有很多麻烦"><a href="#为什么需要服务注册与发现-移除不影响-但会有很多麻烦" class="headerlink" title="为什么需要服务注册与发现 [移除不影响 但会有很多麻烦]"></a>为什么需要服务注册与发现 [移除不影响 但会有很多麻烦]</h5><ul>
<li>IP变化</li>
<li>难以维护</li>
<li>改进<ul>
<li><strong>节点变化</strong>[服务的提供者和消费者] [消费者需要调用提供者的API来获得服务] 若提供者修改了ip 此时应该上传到注册中心，消费者此时需要得到IP和API 无需直接找提供者 直接去<strong>注册中心</strong>调用</li>
</ul>
</li>
</ul>
<h5 id="Eureka架构"><a href="#Eureka架构" class="headerlink" title="Eureka架构"></a>Eureka架构</h5><ul>
<li>EureKa <strong>Server</strong> 和 EureKa <strong>Client</strong></li>
</ul>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/6a3bfcded810da5a827559f3b8f868a0de867787/data/Eureka%E6%9E%B6%E6%9E%84.png"></p>
<ul>
<li><strong>集群</strong> [只要能获得一个Eureka Server 就能获得整个信息]</li>
</ul>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/f756e06eed90edb75c6b3b6f234eee57763d8811/data/Eureka%E6%9E%B6%E6%9E%84-%E9%9B%86%E7%BE%A4.png"></p>
<h3 id="引入Eureka"><a href="#引入Eureka" class="headerlink" title="引入Eureka"></a>引入Eureka</h3><ul>
<li><h6 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h6></li>
<li><h6 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h6></li>
<li><h6 id="启动注解"><a href="#启动注解" class="headerlink" title="启动注解"></a>启动注解</h6></li>
</ul>
<pre><code class="xml">pom.xml(eureka-server)
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;spring-cloud-course-practice&lt;/artifactId&gt;
        &lt;groupId&gt;com.imooc&lt;/groupId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;eureka-server&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;

    &lt;!-- 模块名及描述信息 --&gt;
    &lt;name&gt;course-eureka-server&lt;/name&gt;
    &lt;description&gt;Spring Cloud Eureka&lt;/description&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre>
<pre><code class="xml">pom.xml(Spring-cloud-course-practice)
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;packaging&gt;pom&lt;/packaging&gt;
  &lt;modules&gt;
    &lt;module&gt;course-service&lt;/module&gt;
    &lt;module&gt;eureka-server&lt;/module&gt;
  &lt;/modules&gt;
  &lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;2.1.12.RELEASE&lt;/version&gt;
    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
  &lt;/parent&gt;
  &lt;groupId&gt;com.imooc&lt;/groupId&gt;
  &lt;artifactId&gt;spring-cloud-course-practice&lt;/artifactId&gt;
  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
  &lt;name&gt;spring-cloud-course-practice&lt;/name&gt;
  &lt;description&gt;course project for Spring Cloud&lt;/description&gt;

  &lt;properties&gt;
    &lt;java.version&gt;1.8&lt;/java.version&gt;
  &lt;/properties&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

  &lt;!--  表示Spring Cloud的版本--&gt;
  &lt;dependencyManagement&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
        &lt;version&gt;Greenwich.SR5&lt;/version&gt;
        &lt;type&gt;pom&lt;/type&gt;
        &lt;scope&gt;import&lt;/scope&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
  &lt;/dependencyManagement&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;

&lt;/project&gt;
</code></pre>
<pre><code class="mysql">application.properties(eureka-server)

spring.application.name=eureka-server
server.port=8000
eureka.instance.hostname=localhost
#fetch-registry???????????????????
eureka.client.fetch-registry=false
#register-with-eureka??????????Eureka Server????true?
eureka.client.register-with-eureka=false
eureka.client.service-url.defaultZone=http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/
</code></pre>
<pre><code class="mysql">application.properties(course-list)

server.port=8081
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/course_practice?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true
spring.datasource.username=root
spring.datasource.password=root
logging.pattern.console=%clr(%d&#123;$&#123;LOG_DATEFORMAT_PATTERN:HH:mm:ss.SSS&#125;&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:%wEx&#125;
# entity?????????????????
mybatis.configuration.map-underscore-to-camel-case=true 
spring.application.name=course-list
#??????? eureka-server??application.properties?defaultZone????????????????
eureka.client.service-url.defaultZone=http://localhost:8000/eureka/
</code></pre>
<pre><code class="mysql">application.properties(course-price)

server.port=8082
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/course_practice?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true
spring.datasource.username=root
spring.datasource.password=root
logging.pattern.console=%clr(%d&#123;$&#123;LOG_DATEFORMAT_PATTERN:HH:mm:ss.SSS&#125;&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:%wEx&#125;
mybatis.configuration.map-underscore-to-camel-case=true
spring.application.name=course-price
eureka.client.service-url.defaultZone=http://localhost:8000/eureka/
</code></pre>
<pre><code class="java">com/imooc/course/EurekaServerApplication.java
package com.imooc.course;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;

/**
 * Eureka的服务端
 */
@EnableEurekaServer
@SpringBootApplication
public class EurekaServerApplication &#123;
    public static void main(String[] args) &#123;
        SpringApplication.run(EurekaServerApplication.class, args);
    &#125;
&#125;
========================================================
http://127.0.0.1:8000/
</code></pre>
<h3 id="利用Feign实现服务间调用"><a href="#利用Feign实现服务间调用" class="headerlink" title="利用Feign实现服务间调用"></a>利用Feign实现服务间调用</h3><h5 id="Feign"><a href="#Feign" class="headerlink" title="Feign"></a>Feign</h5><ul>
<li>声明式、模板化的HTTP客户端，方便的调用远程的HTTP请求 [基于接口实现]</li>
</ul>
<h6 id="集成Feign"><a href="#集成Feign" class="headerlink" title="集成Feign"></a>集成Feign</h6><ul>
<li>引入依赖</li>
<li>配置文件</li>
<li>注解</li>
</ul>
<pre><code class="xml">pom.xml (course-price)
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
      &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
      &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;
    &lt;/dependency&gt;

application.properties
eureka.client.service-url.defaultZone=http://localhost:8000/eureka/
</code></pre>
<pre><code class="java">com/imooc/course/controller/CoursePriceController.java
package com.imooc.course.controller;

import com.imooc.course.client.CourseListClient;
import com.imooc.course.entity.Course;
import com.imooc.course.entity.CoursePrice;
import com.imooc.course.service.CoursePriceService;
import java.util.List;
import javax.xml.ws.Action;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

/**
 * 描述：     课程价格控制器
 */
@RestController
public class CoursePriceController &#123;

    @Autowired
    CoursePriceService coursePriceService;

    @Autowired
    CourseListClient courseListClient;

    @GetMapping(&quot;/price&quot;)
    public Integer getCoursePrice(Integer courseId) &#123;
        CoursePrice coursePrice = coursePriceService.getCoursePrice(courseId);
        return coursePrice.getPrice();
    &#125;

    @GetMapping(&quot;/coursesInPrice&quot;)
    public List&lt;Course&gt; getCourseListInPrice(Integer courseId) &#123;
        List&lt;Course&gt; courses = courseListClient.courseList();
        return courses;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/course/client/CourseListClient.java[接口]
package com.imooc.course.client;

import com.imooc.course.entity.Course;
import java.util.List;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.GetMapping;

/**
 * 描述：     课程列表的Feign客户端
 */
@FeignClient(&quot;course-list&quot;)
public interface CourseListClient &#123;

    @GetMapping(&quot;/courses&quot;)
    List&lt;Course&gt; courseList();
&#125;
</code></pre>
<pre><code class="java">com/imooc/course/CoursePriceApplication.java
package com.imooc.course;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.openfeign.EnableFeignClients;

@SpringBootApplication
@EnableFeignClients
public class CoursePriceApplication &#123;

    public static void main(String[] args) &#123;
        SpringApplication.run(CoursePriceApplication.class, args);
    &#125;
&#125;
=============================================================
http://127.0.0.1:8082/coursesInPrice

[
    &#123;
        &quot;id&quot;: 1,
        &quot;courseId&quot;: 362,
        &quot;courseName&quot;: &quot;SpringCloud自学&quot;,
        &quot;valid&quot;: 1
    &#125;,
    &#123;
        &quot;id&quot;: 2,
        &quot;courseId&quot;: 409,
        &quot;courseName&quot;: &quot;玩转Java并发工具&quot;,
        &quot;valid&quot;: 1
    &#125;
]
</code></pre>
<h3 id="负载均衡的两种类型"><a href="#负载均衡的两种类型" class="headerlink" title="负载均衡的两种类型"></a>负载均衡的两种类型</h3><ul>
<li><strong>客户端</strong>负载均衡(Ribbon)</li>
<li><strong>服务端</strong>负载均衡(Nginx)</li>
</ul>
<h5 id="负载均衡策略"><a href="#负载均衡策略" class="headerlink" title="负载均衡策略"></a>负载均衡策略</h5><ul>
<li>RandomRule 表示<strong>随机</strong>策略</li>
<li>RoundRobinRule 表示<strong>轮询</strong>策略</li>
<li>ResponseTimeWeightedRule<strong>加权</strong>，根据每一个Server的平均响应时间动态加权</li>
</ul>
<h5 id="配置不同的负载均衡方式"><a href="#配置不同的负载均衡方式" class="headerlink" title="配置不同的负载均衡方式"></a>配置不同的负载均衡方式</h5><ul>
<li>Ribbon.NFLoadBalancerRuleClassName</li>
</ul>
<pre><code class="java">application.properties(course-price)
course-list.ribbon.NFLoadBanlancerRuleClassName=com.netflix.loadbalancer.RoundRobinRule
</code></pre>
<h3 id="为什么要断路器"><a href="#为什么要断路器" class="headerlink" title="为什么要断路器"></a>为什么要断路器</h3><p><img src="https://raw.githubusercontent.com/P-luminary/images/e441bfbcf0e2cf07f9d53564669b2dbd90533142/data/%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%96%AD%E8%B7%AF%E5%99%A8.jpg"></p>
<h5 id="Hystrix"><a href="#Hystrix" class="headerlink" title="Hystrix"></a>Hystrix</h5><pre><code class="xml">pom.xml(course-price)   
&lt;dependency&gt;
      &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
      &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;
    &lt;/dependency&gt;
</code></pre>
<pre><code class="java">application.properties(course-price)
feign.hystrix.enabled=true
</code></pre>
<pre><code class="java">com/imooc/course/CoursePriceApplication.java
package com.imooc.course;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;
import org.springframework.cloud.openfeign.EnableFeignClients;

@SpringBootApplication
@EnableFeignClients
@EnableCircuitBreaker
public class CoursePriceApplication &#123;

    public static void main(String[] args) &#123;
        SpringApplication.run(CoursePriceApplication.class, args);
    &#125;
&#125;
================================================================
所有服务都打开时 http://127.0.0.1:8082/coursesInPrice
[
    &#123;
        &quot;id&quot;: 1,
        &quot;courseId&quot;: 362,
        &quot;courseName&quot;: &quot;SpringCloud白学&quot;,
        &quot;valid&quot;: 1
    &#125;,
    &#123;
        &quot;id&quot;: 2,
        &quot;courseId&quot;: 409,
        &quot;courseName&quot;: &quot;玩转Java并发工具&quot;,
        &quot;valid&quot;: 1
    &#125;
]
当把CouresListApplication服务关闭的时候
[
    &#123;
        &quot;id&quot;: 1,
        &quot;courseId&quot;: 1,
        &quot;courseName&quot;: &quot;默认课程&quot;,
        &quot;valid&quot;: 1
    &#125;
]
</code></pre>
<h3 id="整合两个服务"><a href="#整合两个服务" class="headerlink" title="整合两个服务"></a>整合两个服务</h3><pre><code class="java">com/imooc/course/controller/CoursePriceController.java
    @GetMapping(&quot;/coursesAndPrice&quot;)
    public List&lt;CourseAndPrice&gt; getCoursesAndPrice()&#123;
        List&lt;CourseAndPrice&gt; courseAndPrices = coursePriceService.getCourseAndPrice();
        return courseAndPrices;
    &#125;
=====================================================
http://127.0.0.1:8082/coursesAndPrice
[
    &#123;
        &quot;id&quot;: 1,
        &quot;courseId&quot;: 362,
        &quot;name&quot;: &quot;SpringCloud自学&quot;,
        &quot;price&quot;: 348
    &#125;,
    &#123;
        &quot;id&quot;: 2,
        &quot;courseId&quot;: 409,
        &quot;name&quot;: &quot;玩转Java并发工具&quot;,
        &quot;price&quot;: 399
    &#125;
]
</code></pre>
<pre><code class="java">com/imooc/course/service/CoursePriceService.java
public interface CoursePriceService &#123;

    CoursePrice getCoursePrice(Integer courseId);
    List&lt;CourseAndPrice&gt; getCourseAndPrice();
&#125;
</code></pre>
<pre><code class="java">com/imooc/course/service/impl/CoursePriceServiceImpl.java
package com.imooc.course.service.impl;

import com.imooc.course.client.CourseListClient;
import com.imooc.course.dao.CoursePriceMapper;
import com.imooc.course.entity.Course;
import com.imooc.course.entity.CourseAndPrice;
import com.imooc.course.entity.CoursePrice;
import com.imooc.course.service.CoursePriceService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;

/**
 * 描述：     课程价格的服务实现类
 */
@Service
public class CoursePriceServiceImpl implements CoursePriceService &#123;

    @Autowired
    CoursePriceMapper coursePriceMapper;
    @Autowired
    CourseListClient courseListClient;

    @Override
    public CoursePrice getCoursePrice(Integer courseId) &#123;
        return coursePriceMapper.findCoursePrice(courseId);
    &#125;

    @Override
    public List&lt;CourseAndPrice&gt; getCourseAndPrice() &#123;
        List&lt;CourseAndPrice&gt; courseAndPrices = new ArrayList&lt;&gt;();
        List&lt;Course&gt; courses = courseListClient.courseList();
        for (int i = 0; i &lt; courses.size(); i++) &#123;
            Course course = courses.get(i);
            //inn
            if (course != null) &#123;
                CoursePrice coursePrice = getCoursePrice(course.getCourseId());
                CourseAndPrice courseAndPrice = new CourseAndPrice();
                courseAndPrice.setPrice(coursePrice.getPrice());
                courseAndPrice.setName(course.getCourseName());
                courseAndPrice.setId(coursePrice.getId());
                courseAndPrice.setCourseId(course.getCourseId());
                courseAndPrices.add(courseAndPrice);
            &#125;
        &#125;
        return courseAndPrices;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/course/entity/CourseAndPrice.java
package com.imooc.course.entity;

/**
 * 课程与价格的融合类
 */
public class CourseAndPrice &#123;
    Integer id;
    Integer courseId;
    String name;
    Integer price;
&#125;
</code></pre>
<h3 id="网关Zuul"><a href="#网关Zuul" class="headerlink" title="网关Zuul"></a>网关Zuul</h3><ul>
<li>为什么<strong>需要</strong>网关</li>
<li>签名校验、登录校验<strong>冗余</strong>问题</li>
<li>Spring Cloud <strong>Zuul</strong> 与 Spring Cloud</li>
<li>API网关允许您将API请求(内部或外部)路由到正确的位置</li>
</ul>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/1f9e4c61e576605cf2c814d0d8f069c61bcef0da/data/%E7%BD%91%E5%85%B3Zuul.jpg"></p>
<h3 id="集成Zuul-统一修改访问url地址"><a href="#集成Zuul-统一修改访问url地址" class="headerlink" title="集成Zuul [统一修改访问url地址]"></a>集成Zuul [统一修改访问url地址]</h3><ul>
<li>把自己注册到Eureka这个注册中心</li>
<li>引入依赖</li>
<li>配置路由地址</li>
</ul>
<pre><code class="xml">pom.xml(course-zuul)
     &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-zuul&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
</code></pre>
<pre><code class="java">com/imooc/course/ZuulGatewayApplication.java
package com.imooc.course;

import org.springframework.boot.SpringApplication;

/**
 * 网关启动类
 */
@EnableZuulProxy
@SpringCloudApplication
public class ZuulGatewayApplication &#123;
    public static void main(String[] args) &#123;
        SpringApplication.run(ZuulGatewayApplication.class, args);
    &#125;
&#125;
===============================================================
http://127.0.0.1:9000/imooc/price/coursesInPrice
[
    &#123;
        &quot;id&quot;: 1,
        &quot;courseId&quot;: 362,
        &quot;courseName&quot;: &quot;SpringCloud自学&quot;,
        &quot;valid&quot;: 1
    &#125;,
    &#123;
        &quot;id&quot;: 2,
        &quot;courseId&quot;: 409,
        &quot;courseName&quot;: &quot;玩转Java并发工具&quot;,
        &quot;valid&quot;: 1
    &#125;
]
</code></pre>
<pre><code class="mysql">application.properties

spring.application.name=course-gateway
server.port=9000
logging.pattern.console=%clr(%d&#123;$&#123;LOG_DATEFORMAT_PATTERN:HH:mm:ss.SSS&#125;&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:%wEx&#125;
mybatis.configuration.map-underscore-to-camel-case=true
eureka.client.service-url.defaultZone=http://localhost:8000/eureka/

zuul.prefix=/imooc
zuul.routes.course-list.path=/list/**
zuul.routes.course-list.service-id=course-list
zuul.routes.course-price.path=/price/**
zuul.routes.course-price.service-id=course-price
</code></pre>
<h3 id="利用网关实现过滤器"><a href="#利用网关实现过滤器" class="headerlink" title="利用网关实现过滤器"></a>利用网关实现过滤器</h3><ul>
<li><strong>pre</strong> 过滤器在路由请求之前运行</li>
<li>route 过滤器可以处理请求的实际路由</li>
<li><strong>post</strong> 路由请求后运行过滤器</li>
<li>error 如果在处理请求的过程中发生错误，则过滤器将运行</li>
</ul>
<pre><code class="java">com/imooc/course/filter/PreRequestFilter.java
package com.imooc.course.filter;

import com.netflix.zuul.ZuulFilter;
import com.netflix.zuul.context.RequestContext;
import com.netflix.zuul.exception.ZuulException;
import org.springframework.cloud.netflix.zuul.filters.support.FilterConstants;
import org.springframework.stereotype.Component;

/**
 * 记录请求时间
 */
@Component
public class PreRequestFilter extends ZuulFilter &#123;

    @Override
    public String filterType() &#123;
        //过滤器的类型
        return FilterConstants.PRE_TYPE;
    &#125;

    @Override
    public int filterOrder() &#123;
        return 0;
    &#125;

    @Override
    public boolean shouldFilter() &#123;
        //是否启用过滤器
        return true;
    &#125;

    @Override
    public Object run() throws ZuulException &#123;
        //通过时间戳 获取上下文
        RequestContext currentContext = RequestContext.getCurrentContext();
        currentContext.set(&quot;startTime&quot;,System.currentTimeMillis());
        System.out.println(&quot;过滤器已经记录时间&quot;);
        return null;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/course/filter/PostRequestFilter.java
package com.imooc.course.filter;

import com.netflix.zuul.ZuulFilter;
import com.netflix.zuul.context.RequestContext;
import com.netflix.zuul.exception.ZuulException;
import org.springframework.cloud.netflix.zuul.filters.support.FilterConstants;
import org.springframework.stereotype.Component;

/**
 * 请求处理后的过滤器
 */
@Component //有了才能被spring捕捉到
public class PostRequestFilter extends ZuulFilter &#123;
    @Override
    public String filterType() &#123;
        return FilterConstants.POST_TYPE;
    &#125;

    @Override
    public int filterOrder() &#123; //在其之前-1 先运行
        return FilterConstants.SEND_RESPONSE_FILTER_ORDER - 1;
    &#125;

    @Override
    public boolean shouldFilter() &#123;
        return false;
    &#125;

    @Override
    public Object run() throws ZuulException &#123;
        RequestContext currentContext = RequestContext.getCurrentContext();
        Long startTime = (Long) currentContext.get(&quot;startTime&quot;);
        long duration = System.currentTimeMillis() - startTime;
        String requestURI = currentContext.getRequest().getRequestURI();
        System.out.println(&quot;uri:&quot; + requestURI + &quot;,处理时长：&quot; + duration);
        return null;
    &#125;
&#125;
</code></pre>
<hr>
<hr>
<h3 id="Spring-Cloud电商实践"><a href="#Spring-Cloud电商实践" class="headerlink" title="Spring Cloud电商实践"></a>Spring Cloud电商实践</h3><ul>
<li>服务拆分过程分析和经验分享</li>
<li>完成用户、商品、购物车和订单等服务开发</li>
<li>通用common模块的拆分和应用</li>
<li>Eureka server注册中心开发，用Feign完成服务之间的调用</li>
<li>共享Session的处理方案</li>
<li>统一网关的集成与开发</li>
</ul>
<h3 id="Spring-Cloud电商项目"><a href="#Spring-Cloud电商项目" class="headerlink" title="Spring Cloud电商项目"></a>Spring Cloud电商项目</h3><ul>
<li>项目介绍<ul>
<li>在Spring Boot的基础上升级为<strong>Spring Cloud</strong></li>
<li>从0到1 (Spring Boot)</li>
<li><strong>从1到多</strong>、微服务</li>
</ul>
</li>
<li>模块拆分</li>
<li>Eureka-server开发</li>
<li><strong>用户模块开发</strong></li>
<li><strong>公共模块开发</strong></li>
<li><strong>网关模块开发</strong></li>
<li><strong>商品分类和商品模块开发</strong></li>
<li><strong>购物车和订单模块开发</strong></li>
<li>总结</li>
</ul>
<h3 id="模块拆分"><a href="#模块拆分" class="headerlink" title="模块拆分"></a>模块拆分</h3><ul>
<li><p><strong>粒度</strong>：过粗、适中、过细</p>
</li>
<li><p>人员的角度</p>
</li>
<li><p>业务的角度：相关、独立</p>
</li>
<li><p>Eureka-server模块</p>
</li>
<li><p>网关模块</p>
</li>
<li><p>公共模块 (md5、统一API返回、常量、异常、异常枚举、二维码、工具类模块……)</p>
</li>
<li><p>用户模块 (相对来说比较独立，登录的时候无需获得商品信息)</p>
</li>
<li><p><strong>商品分类和商品模块</strong></p>
</li>
<li><p><strong>购物车和订单模块</strong></p>
</li>
</ul>
<h3 id="功能模块介绍"><a href="#功能模块介绍" class="headerlink" title="功能模块介绍"></a>功能模块介绍</h3><ul>
<li><h4 id="项目功能："><a href="#项目功能：" class="headerlink" title="项目功能："></a>项目功能：</h4><ul>
<li><h5 id="前台-用户、商品分类、商品信息、购物车、订单"><a href="#前台-用户、商品分类、商品信息、购物车、订单" class="headerlink" title="前台  {用户、商品分类、商品信息、购物车、订单}"></a><span style = "color:red">前台  {用户、商品分类、商品信息、购物车、订单}</span></h5><ul>
<li><strong>用户模块</strong>{注册、登录、更新签名、身份认证、登出}</li>
<li><strong>商品分类模块</strong>{多级目录、递归查询、缓存}</li>
<li><strong>商品模块</strong>{商品搜索、商品排序、商品列表、目录展示、商品详情}</li>
<li><strong>购物车模块</strong>{加入商品、列表显示、数量更改、删除商品、勾选反选、全选全不选}</li>
<li><strong>订单模块</strong>{下单、订单流程、订单详情、取消订单、支付二维码、扫码支付、个人订单、确认收货}</li>
</ul>
</li>
<li><h5 id="后台-用户、商品分类、商品信息、订单"><a href="#后台-用户、商品分类、商品信息、订单" class="headerlink" title="后台  {用户、商品分类、商品信息、订单}"></a><span style = "color:red">后台  {用户、商品分类、商品信息、订单}</span></h5><ul>
<li><strong>管理员模块</strong>{登录登出、身份认证、安全限制}</li>
<li><strong>商品分类模块</strong>{分类列表、增加分类、修改分类、删除分类}</li>
<li><strong>商品模块</strong>{商品列表、新增商品、图片上传、更新删除、批量上下架}</li>
<li><strong>订单模块</strong>{订单列表、地址信息、发货、订单完结}</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>&#96;&#96;</p>
<h3 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h3><h5 id="Eureka-server模块开发"><a href="#Eureka-server模块开发" class="headerlink" title="Eureka-server模块开发"></a>Eureka-server模块开发</h5><ul>
<li>引入依赖</li>
<li>配置文件</li>
<li>启动注解</li>
</ul>
<blockquote>
<p>由于是多模块开发，创建了maven项目后把cloud-mall-practice的src删除</p>
</blockquote>
<pre><code class="xml">pom.xml(cloud-mall-practice)
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.imooc&lt;/groupId&gt;
    &lt;artifactId&gt;cloud-mall-practice&lt;/artifactId&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;modules&gt;
        &lt;module&gt;cloud-mall-eureka-server&lt;/module&gt;
    &lt;/modules&gt;

    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.1.12.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.springfox&lt;/groupId&gt;
            &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;
            &lt;version&gt;2.9.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.springfox&lt;/groupId&gt;
            &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;
            &lt;version&gt;2.9.2&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;Greenwich.SR5&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;
                &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;1.3.7&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;verbose&gt;true&lt;/verbose&gt;
                    &lt;overwrite&gt;true&lt;/overwrite&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre>
<pre><code class="java">cloud-mall-eureka-server/com/imooc/cloud/mall/practice/eureka/EurekaServerApplication.java
package com.imooc.cloud.mall.practice.eureka;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;

/**
 * 1. Eureka Server的启动类，提供服务注册与发现
 * 2写其pom和resources的配置文件
 *
 */
@EnableEurekaServer //对外提供服务
@SpringBootApplication
public class EurekaServerApplication &#123;
    public static void main(String[] args) &#123;
        SpringApplication.run(EurekaServerApplication.class, args);
    &#125;
&#125;
</code></pre>
<pre><code class="xml">pom.xml(cloud-mall-eureka-server)
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.imooc&lt;/groupId&gt;
        &lt;artifactId&gt;cloud-mall-practice&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;

    &lt;artifactId&gt;cloud-mall-eureka-server&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;/properties&gt;

    &lt;name&gt;
        cloud-mall-eureka-server
    &lt;/name&gt;
    &lt;description&gt;Spring cloud Eureka Server&lt;/description&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre>
<pre><code class="mysql">application.properties

spring.application.name=eureka-server
server.port=8000
eureka.instance.hostname=localhost
#是否同步其他节点的信息
eureka.client.fetch-registry=false
#是否把自己作为服务注册在服务上
eureka.client.register-with-eureka=false
#eureka-server所在的地址
eureka.client.service-url.defaultZone=http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/
</code></pre>
<h3 id="用户模块知识点"><a href="#用户模块知识点" class="headerlink" title="用户模块知识点"></a>用户模块知识点</h3><blockquote>
<p>登录、注册[加盐md5]、重名校验[注册就不可注册]、密码加密存储、Session的使用、越权校验[不可编辑别人的签名]</p>
</blockquote>
<h5 id="用户模块"><a href="#用户模块" class="headerlink" title="用户模块"></a>用户模块</h5><ul>
<li>表设计</li>
<li>开发</li>
<li>测试</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_62117675/article/details/127938285">idea中如何将包名折叠或者或如何将折叠的包名展开_idea包名折叠-CSDN博客</a></p>
<h3 id="用户模块初始化"><a href="#用户模块初始化" class="headerlink" title="用户模块初始化"></a>用户模块初始化</h3><h5 id="公共模块"><a href="#公共模块" class="headerlink" title="公共模块"></a>公共模块</h5><ul>
<li>常量、异常、工具类</li>
<li>自身不是Spring Boot项目</li>
</ul>
<h6 id="进行模块各层级的重构-用户模块的测试"><a href="#进行模块各层级的重构-用户模块的测试" class="headerlink" title="进行模块各层级的重构 + 用户模块的测试"></a>进行模块各层级的重构 + 用户模块的测试</h6><pre><code class="mysql">一定要记得如果引用其他muder的时候 要在xml中假如其项目文件的依赖才可以跨项目引用
比如我这个项目是【一定要引用噢！！ 不然在非其项目的时候找不到import导包】
pom.xml(cloud-mall-zuul)
           &lt;dependency&gt;
            &lt;groupId&gt;com.imooc&lt;/groupId&gt;
            &lt;artifactId&gt;cloud-mall-user&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
            &lt;scope&gt;compile&lt;/scope&gt;
        &lt;/dependency&gt;
</code></pre>
<h3 id="网关模块开发"><a href="#网关模块开发" class="headerlink" title="网关模块开发"></a>网关模块开发</h3><pre><code class="xml">pom.xml(cloud-mall-zuul)
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.imooc&lt;/groupId&gt;
        &lt;artifactId&gt;cloud-mall-practice&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;

    &lt;artifactId&gt;cloud-mall-zuul&lt;/artifactId&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-zuul&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre>
<pre><code class="mysql">application.properties(cloud-mall-zuul)
server.port=8083

spring.datasource.name=imooc_mall_datasource
spring.datasource.url=jdbc:mysql://127.0.0.1:3306/imooc_mall?useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;useSSL=false&amp;serverTimezone=UTC
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.username=root
spring.datasource.password=root

mybatis.mapper-locations=classpath*:mappers/*.xml

logging.pattern.console=%clr(%d&#123;$&#123;LOG_DATEFORMAT_PATTERN:HH:mm:ss.SSS&#125;&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:%wEx&#125;

eureka.client.service-url.defaultZone=http://localhost:8000/eureka/

spring.application.name=cloud-mall-zuul

zuul.prefix=/
#凡是用户模块都要走/user地址
zuul.routes.cloud-mall-user.path=/user/**
#模块的名字
zuul.routes.cloud-mall-user.service-id=cloud-mall-user
</code></pre>
<pre><code class="java">com/imooc/cloud/mall/practice/zuul/filter/UserFilter.java
package com.imooc.cloud.mall.practice.zuul.filter;

import com.imooc.cloud.mall.practice.common.common.Constant;
import com.netflix.zuul.ZuulFilter;
import com.netflix.zuul.context.RequestContext;
import com.netflix.zuul.exception.ZuulException;
import com.imooc.cloud.mall.practice.user.model.pojo.User;
import org.springframework.cloud.netflix.zuul.filters.support.FilterConstants;
import org.springframework.stereotype.Component;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

/**
 * 用户鉴权过滤器
 */
@Component
public class UserFilter extends ZuulFilter &#123;
    @Override
    public String filterType() &#123;
        return FilterConstants.PRE_TYPE;
    &#125;

    @Override
    public int filterOrder() &#123;
        return 0;
    &#125;

    @Override
    public boolean shouldFilter() &#123;
        RequestContext ctx = RequestContext.getCurrentContext();
        HttpServletRequest request = ctx.getRequest();
        String requestURI = request.getRequestURI();
        //不经过过滤器
        if (requestURI.contains(&quot;images&quot;) || requestURI.contains(&quot;pay&quot;)) &#123;
            return false;
        &#125;
        if (requestURI.contains(&quot;cart&quot;) || requestURI.contains(&quot;order&quot;)) &#123;//前置条件必须要登录！
            return true;
        &#125;
        return false;
    &#125;

    @Override
    //用户过滤器
    public Object run() throws ZuulException &#123;//返回true的时候执行的
        RequestContext currentContext = RequestContext.getCurrentContext();//获取request
        //获取session 因为user对象保存在里面  session.getAttribute取出session对象
        HttpServletRequest request = currentContext.getRequest();
        HttpSession session = request.getSession();
        //拿出User对象
        User currentUser = (User) session.getAttribute(Constant.IMOOC_MALL_USER);
        if (currentUser == null) &#123;
            //无需通过网关再去发送
            currentContext.setSendZuulResponse(false);
            //返回给前端的对象
            currentContext.setResponseBody(&quot;&#123;\n&quot;
                    + &quot;    \&quot;status\&quot;: 10007,\n&quot;
                    + &quot;    \&quot;msg\&quot;: \&quot;NEED_LOGIN\&quot;,\n&quot;
                    + &quot;    \&quot;data\&quot;: null\n&quot;
                    + &quot;&#125;&quot;);
            currentContext.setResponseStatusCode(200);
        &#125;
        return null;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/cloud/mall/practice/zuul/filter/AdminFilter.java
package com.imooc.cloud.mall.practice.zuul.filter;

import com.imooc.cloud.mall.practice.common.common.Constant;
import com.imooc.cloud.mall.practice.user.model.pojo.User;
import com.imooc.cloud.mall.practice.zuul.feign.UserFeignClient;
import com.netflix.zuul.ZuulFilter;
import com.netflix.zuul.context.RequestContext;
import com.netflix.zuul.exception.ZuulException;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.cloud.netflix.zuul.filters.support.FilterConstants;
import org.springframework.stereotype.Component;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

/**
 * 管理员鉴权过滤器
 */
@Component
public class AdminFilter extends ZuulFilter &#123;
    @Autowired
    UserFeignClient userFeignClient;

    @Override
    public String filterType() &#123;
        return FilterConstants.PRE_TYPE;
    &#125;

    @Override
    public int filterOrder() &#123;
        return 0;
    &#125;

    @Override
    public boolean shouldFilter() &#123;
        RequestContext ctx = RequestContext.getCurrentContext();
        HttpServletRequest request = ctx.getRequest();
        String requestURI = request.getRequestURI();
        //不经过过滤器
        if (requestURI.contains(&quot;adminLogin&quot;))&#123;
            return false;
        &#125;
        if (requestURI.contains(&quot;admin&quot;))&#123;
            return true;
        &#125;
        if (requestURI.contains(&quot;cart&quot;) || requestURI.contains(&quot;order&quot;)) &#123;//前置条件必须要登录！
            return true;
        &#125;
        return false;
    &#125;

    @Override
    //用户过滤器
    public Object run() throws ZuulException &#123;//返回true的时候执行的
        RequestContext currentContext = RequestContext.getCurrentContext();//获取request
        //获取session 因为user对象保存在里面  session.getAttribute取出session对象
        HttpServletRequest request = currentContext.getRequest();
        HttpSession session = request.getSession();
        //拿出User对象
        User currentUser = (User) session.getAttribute(Constant.IMOOC_MALL_USER);
        if (currentUser == null) &#123;
            //无需通过网关再去发送
            currentContext.setSendZuulResponse(false);
            //返回给前端的对象
            currentContext.setResponseBody(&quot;&#123;\n&quot;
                    + &quot;    \&quot;status\&quot;: 10010,\n&quot;
                    + &quot;    \&quot;msg\&quot;: \&quot;NEED_LOGIN\&quot;,\n&quot;
                    + &quot;    \&quot;data\&quot;: null\n&quot;
                    + &quot;&#125;&quot;);
            currentContext.setResponseStatusCode(200);
            return null; //程序可以停止了
        &#125;
        //进一步判断是否是管理员
        Boolean adminRole = userFeignClient.checkAdminRole(currentUser);
        if (!adminRole)&#123;
            currentContext.setSendZuulResponse(false);
            //返回给前端的对象
            currentContext.setResponseBody(&quot;&#123;\n&quot;
                    + &quot;    \&quot;status\&quot;: 10011,\n&quot;
                    + &quot;    \&quot;msg\&quot;: \&quot;NEED_ADMIN\&quot;,\n&quot;
                    + &quot;    \&quot;data\&quot;: null\n&quot;
                    + &quot;&#125;&quot;);
            currentContext.setResponseStatusCode(200);
        &#125;
        return null;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/cloud/mall/practice/zuul/feign/UserFeignClient.java
package com.imooc.cloud.mall.practice.zuul.feign;

import com.imooc.cloud.mall.practice.user.model.pojo.User;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;

/**
 * UserFeignClient
 */
@FeignClient(value = &quot;cloud-mall-user&quot;)
public interface UserFeignClient &#123;
    @PostMapping(&quot;/checkAdminRole&quot;)
    public Boolean checkAdminRole(@RequestBody User user);
&#125;
</code></pre>
<pre><code class="java">com/imooc/cloud/mall/practice/zuul/ZuulGatewayApplication.java
网关模块加上SpringBoot启动类

package com.imooc.cloud.mall.practice.zuul;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.zuul.EnableZuulProxy;
import org.springframework.cloud.openfeign.EnableFeignClients;

/**
 * 网关启动类
 */
@EnableZuulProxy
@EnableFeignClients
@SpringBootApplication
public class ZuulGatewayApplication &#123;
    public static void main(String[] args) &#123;
        SpringApplication.run(ZuulGatewayApplication.class, args);
    &#125;
&#125;
=================================================================
127.0.0.1:8083/user/login?userName=mumu9&amp;password=lihao123
&#123;
    &quot;status&quot;: 10000,
    &quot;msg&quot;: &quot;SUCCESS&quot;,
    &quot;data&quot;: &#123;
        &quot;id&quot;: 21,
        &quot;username&quot;: &quot;mumu9&quot;,
        &quot;password&quot;: null,
        &quot;personalizedSignature&quot;: &quot;乘风破浪的姐姐&quot;,
        &quot;role&quot;: 2,
        &quot;createTime&quot;: &quot;2024-04-17T18:08:15.000+0000&quot;,
        &quot;updateTime&quot;: &quot;2024-04-17T18:10:49.000+0000&quot;
    &#125;
&#125;
</code></pre>
<blockquote>
<p>POSTMAN中cloud-mall-practice的注册新用户、用户登录、管理员登录、登出模块都通过网关共用地址的调用，但是更新个性签名不可以，提示需要登录，因为更新签名需要提前登录。但是问题的最主要的点就是没有拿到session所以并没有把用户信息传到个性签名中 这是就需要Session共享机制</p>
</blockquote>
<h3 id="Session共享机制"><a href="#Session共享机制" class="headerlink" title="Session共享机制"></a>Session共享机制</h3><h5 id="登录功能分析"><a href="#登录功能分析" class="headerlink" title="登录功能分析"></a>登录功能分析</h5><ul>
<li>登录状态需要保持</li>
<li>session的实现方案：登陆后，会保存用户信息到session</li>
<li>之后的访问，先从session中获取用户信息，然后再执行业务逻辑</li>
</ul>
<h6 id="目前遇到的障碍-记得去电脑端启动Redis"><a href="#目前遇到的障碍-记得去电脑端启动Redis" class="headerlink" title="目前遇到的障碍 [记得去电脑端启动Redis]"></a>目前遇到的障碍 [记得去电脑端启动Redis]</h6><ul>
<li>session被网关过滤</li>
<li><strong>共享session</strong> [现在是多模块项目 其他项目保存了session 另一个项目无法获得]</li>
<li><strong><span style ="color:red">EnableRedisHttpSession</span></strong>[需要通过中介Redis去调取]</li>
</ul>
<pre><code class="java">在cloud-mall-user/application.properties中
server.port=8081

spring.datasource.name=imooc_mall_datasource
spring.datasource.url=jdbc:mysql://127.0.0.1:3306/imooc_mall?useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;useSSL=false&amp;serverTimezone=UTC
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.username=root
spring.datasource.password=root

mybatis.mapper-locations=classpath*:mappers/*.xml

logging.pattern.console=%clr(%d&#123;$&#123;LOG_DATEFORMAT_PATTERN:HH:mm:ss.SSS&#125;&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:%wEx&#125;

eureka.client.service-url.defaultZone=http://localhost:8000/eureka/

spring.application.name=cloud-mall-user

spring.session.store-type=redis
spring.redis.host=localhost
spring.redis.port=6379
spring.redis.password=
</code></pre>
<pre><code class="java">在cloud-mall-zuul/application.properties中
server.port=8083

spring.datasource.name=imooc_mall_datasource
spring.datasource.url=jdbc:mysql://127.0.0.1:3306/imooc_mall?useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;useSSL=false&amp;serverTimezone=UTC
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.username=root
spring.datasource.password=root

mybatis.mapper-locations=classpath*:mappers/*.xml

logging.pattern.console=%clr(%d&#123;$&#123;LOG_DATEFORMAT_PATTERN:HH:mm:ss.SSS&#125;&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:%wEx&#125;

eureka.client.service-url.defaultZone=http://localhost:8000/eureka/

spring.application.name=cloud-mall-zuul

spring.session.store-type=redis
spring.redis.host=localhost
spring.redis.port=6379
spring.redis.password=

#没有敏感的需要过滤
zuul.sensitive-headers=
zuul.host.connect-timeout-millis=15000
zuul.prefix=/
#凡是用户模块都要走/user地址
zuul.routes.cloud-mall-user.path=/user/**
#模块的名字
zuul.routes.cloud-mall-user.service-id=cloud-mall-user
</code></pre>
<pre><code class="java">之后在UserApplication和ZuulGatewayApplication前面加上@EnableRedisHttpSession

com/imooc/cloud/mall/practice/user/UserApplication.java
package com.imooc.cloud.mall.practice.user;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.session.data.redis.config.annotation.web.http.EnableRedisHttpSession;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

/**
 * 启动类
 */
@SpringBootApplication
@EnableSwagger2
@MapperScan(basePackages = &quot;com.imooc.cloud.mall.practice.user.model.dao&quot;)
@EnableRedisHttpSession
public class UserApplication &#123;
    public static void main(String[] args) &#123;
        SpringApplication.run(UserApplication.class, args);
    &#125;
&#125;

-------------------------------------------------------------------------------------

com/imooc/cloud/mall/practice/zuul/ZuulGatewayApplication.java
package com.imooc.cloud.mall.practice.zuul;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.zuul.EnableZuulProxy;
import org.springframework.cloud.openfeign.EnableFeignClients;
import org.springframework.session.data.redis.config.annotation.web.http.EnableRedisHttpSession;

/**
 * 网关启动类
 */
@EnableZuulProxy
@EnableFeignClients
@SpringBootApplication
@EnableRedisHttpSession
public class ZuulGatewayApplication &#123;
    public static void main(String[] args) &#123;
        SpringApplication.run(ZuulGatewayApplication.class, args);
    &#125;
&#125;
</code></pre>
<h3 id="商品分类与商品模块初始化"><a href="#商品分类与商品模块初始化" class="headerlink" title="商品分类与商品模块初始化"></a>商品分类与商品模块初始化</h3><h5 id="什么是商品分类"><a href="#什么是商品分类" class="headerlink" title="什么是商品分类"></a>什么是商品分类</h5><ul>
<li>条理清楚，层次分明</li>
<li>方便用户进行筛选和辨别</li>
<li>可以通过分类的设置快速的进入对应的商品列表页面进行商品选择</li>
</ul>
<h5 id="分类层级"><a href="#分类层级" class="headerlink" title="分类层级"></a>分类层级</h5><ul>
<li>在商品分类上需要继续做归类操作</li>
<li>分类设置成三级</li>
<li>层级太深的弊端：<ul>
<li>一是对用户不太友好，不利于寻找</li>
<li>二是对于后台管理人员不友好，不方便管理</li>
</ul>
</li>
</ul>
<blockquote>
<p>[cloud-mall-category-product]创造出来，将controller,model(dao,pojo),service,impi 里转入 Category来搞 因为在网关项目里写了关于管理员校验的方法 所以在此次处CategoryController把session里的校验删除</p>
</blockquote>
<pre><code class="xml">要让商品和商品目录用到User类 一定要去pom文件里添加依赖 不然idea找不到
pom.xml(cloud-mall-category-product)
        &lt;dependency&gt;
            &lt;groupId&gt;com.imooc&lt;/groupId&gt;
            &lt;artifactId&gt;cloud-mall-user&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
            &lt;scope&gt;compile&lt;/scope&gt;
        &lt;/dependency&gt;
</code></pre>
<pre><code class="java">com/imooc/cloud/mall/practice/categoryproduct/config/CachingConfig.java
创建处理缓存的配置类 configpackage com.imooc.cloud.mall.practice.categoryproduct.config;

import org.springframework.cache.annotation.EnableCaching;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.cache.RedisCacheConfiguration;
import org.springframework.data.redis.cache.RedisCacheManager;
import org.springframework.data.redis.cache.RedisCacheWriter;
import org.springframework.data.redis.connection.RedisConnectionFactory;

import java.time.Duration;

*/**
* ** 57.缓存的配置类 想要运行成功保存序列化 要去弄个序列化接口
*   CategoryVO implements Serializable
* **/
*@Configuration
@EnableCaching
public class  CachingConfig &#123;
    @Bean
    public RedisCacheManager redisCacheManager(RedisConnectionFactory connectionFactory) &#123;

        RedisCacheWriter redisCacheWriter = RedisCacheWriter
                .lockingRedisCacheWriter(connectionFactory);
        RedisCacheConfiguration cacheConfiguration = RedisCacheConfiguration.defaultCacheConfig();
        cacheConfiguration = cacheConfiguration.entryTtl(Duration.ofSeconds(30));

        RedisCacheManager redisCacheManager = new RedisCacheManager(redisCacheWriter,
                cacheConfiguration);
        return redisCacheManager;
    &#125;
&#125;
</code></pre>
<pre><code class="mysql">在网关中增加path和service-id
zuul.routes.cloud-mall-user.path=/user/**
zuul.routes.cloud-mall-user.service-id=cloud-mall-user

zuul.routes.cloud-mall-category-product.path=/category-product/**
zuul.routes.cloud-mall-category-product.service-id=cloud-mall-category-product
</code></pre>
<pre><code class="java">查端口  =&gt; netstat -ano | findstr :8083 [pid为7812]
杀死端口PID =&gt; taskkill /PID 7812 /f
</code></pre>
<h3 id="商品模块"><a href="#商品模块" class="headerlink" title="商品模块"></a>商品模块</h3><h5 id="更新和新增商品"><a href="#更新和新增商品" class="headerlink" title="更新和新增商品"></a>更新和新增商品</h5><ul>
<li>合并写法不可取</li>
<li>业务逻辑清晰、独立</li>
</ul>
<h5 id="批量上下架"><a href="#批量上下架" class="headerlink" title="批量上下架"></a>批量上下架</h5><ul>
<li>MyBatis遍历List</li>
<li>where语句拼接</li>
</ul>
<h5 id="商品列表：搜索功能"><a href="#商品列表：搜索功能" class="headerlink" title="商品列表：搜索功能"></a>商品列表：搜索功能</h5><h6 id="入参判空-→-加-通配符-→-like关键字"><a href="#入参判空-→-加-通配符-→-like关键字" class="headerlink" title="入参判空 → 加%通配符 → like关键字"></a>入参判空 → 加%通配符 → like关键字</h6><h5 id="对于查询目录的in处理"><a href="#对于查询目录的in处理" class="headerlink" title="对于查询目录的in处理"></a>对于查询目录的in处理</h5><ul>
<li>目录处理：如果查某个目录下的商品，不仅是需要查出来该目录的，还需要查出来子目录的所有商品</li>
<li>这里要拿到某一个目录Id下的所有子目录id的List</li>
</ul>
<h3 id="前台：商品列表"><a href="#前台：商品列表" class="headerlink" title="前台：商品列表"></a>前台：商品列表</h3><ul>
<li>排序功能</li>
<li>Mybatis PageHelper</li>
<li>枚举：order by</li>
</ul>
<pre><code class="java">把所有product的java都移动过去 controller/service/impl/modal.dao/modal.pojo/query.ProductListQuery/request.AddProductReq、ProductListReq、UpdateProductReq/resourcs.mappers.ProductMapper.xml
</code></pre>
<pre><code class="java">将Constant里的@Value(&quot;$&#123;file.upload.dir&#125;&quot;)的文件上传目录重构到category-product项目中
然后在其项目中的resources的application.properties中写一下路径
</code></pre>
<pre><code class="java">文件地址映射：config/imoocMallWebMvcConfig
</code></pre>
<h3 id="图片端口的特殊处理"><a href="#图片端口的特殊处理" class="headerlink" title="图片端口的特殊处理"></a>图片端口的特殊处理</h3><pre><code class="java">application.properties(cloud-mall-category-product)
file.upload.dir=/Users/Pluminary/Desktop/idea_Space/imooc-mall-prepare-static/

不能再通过获取getHost来配置了 根据实际情况去配置 没有办法获取到网关对外暴露的真正端口号
 private URI getHost(URI uri)&#123;
        URI effectiveURI;
        try &#123;
            effectiveURI = new URI(uri.getScheme(), uri.getUserInfo(), uri.getHost(), uri.getPort(),null,null,null);
        &#125; catch (URISyntaxException e) &#123;
            effectiveURI = null; //如果新建失败 就返回回去
        &#125;
        return effectiveURI;
    &#125;

要改为com/imooc/cloud/mall/practice/categoryproduct/controller/ProductAdminController.java
/**
 * 58.后台商品管理Controller  pojo的product复制一份到request变成AddProductReq  59.需要ProductService.java
 */
@RestController
public class ProductAdminController &#123;

    @Autowired
    ProductService productService;

    @Value(&quot;$&#123;file.upload.ip&#125;&quot;)
    String ip;

    @Value(&quot;$&#123;file.upload.port&#125;&quot;)
    Integer port;

    @PostMapping(&quot;/admin/product/add&quot;)
    public ApiRestResponse addProduct(@Valid @RequestBody AddProductReq addProductReq) &#123;
        productService.add(addProductReq);
        return ApiRestResponse.success();
    &#125;

    @PostMapping(&quot;/admin/upload/file&quot;)
    public ApiRestResponse upload(HttpServletRequest httpServletRequest,
                                  @RequestParam(&quot;file&quot;) MultipartFile file) &#123;
        String fileName = file.getOriginalFilename();
        String suffixName = fileName.substring(fileName.lastIndexOf(&quot;.&quot;));
        //生成文件名称UUID
        UUID uuid = UUID.randomUUID();
        String newFileName = uuid.toString() + suffixName;
        //创建文件
        File fileDirectory = new File(ProductConstant.FILE_UPLOAD_DIR);
        File destFile = new File(ProductConstant.FILE_UPLOAD_DIR + newFileName);
        if (!fileDirectory.exists()) &#123;
            if (!fileDirectory.mkdir()) &#123;
                throw new ImoocMallException(ImoocMallExceptionEnum.MKDIR_FAILED);
            &#125;
        &#125;
        try &#123;
            file.transferTo(destFile);
        &#125; catch (IOException e) &#123;
            e.printStackTrace();
        &#125;
        try &#123;
            return ApiRestResponse
                    .success(getHost(new URI(httpServletRequest.getRequestURL() + &quot;&quot;)) + &quot;/category-product/images/&quot;
                            + newFileName);
        &#125; catch (URISyntaxException e) &#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.UPLOAD_FAILED);
        &#125;
    &#125;

    private URI getHost(URI uri) &#123;
        URI effectiveURI;
        try &#123;
            effectiveURI = new URI(uri.getScheme(), uri.getUserInfo(), ip, port,
                    null, null, null);
        &#125; catch (URISyntaxException e) &#123;
            effectiveURI = null;
        &#125;
        return effectiveURI;
    &#125;
</code></pre>
<h3 id="阶段性重难点和常见错误"><a href="#阶段性重难点和常见错误" class="headerlink" title="阶段性重难点和常见错误"></a>阶段性重难点和常见错误</h3><h5 id="阶段总结"><a href="#阶段总结" class="headerlink" title="阶段总结"></a>阶段总结</h5><ul>
<li>重难点：模块拆分设计、公共模块、<strong>Zuul(网关)过滤器</strong>、Session处理、Feign调用<br>Session在微服务的情况下就不容易处理到了可以共享Session，把其放<u>在Redis中实现</u>共享<br>Feign模块之间的接口调用[HTTP是手动调用]</li>
<li>常见错误：模块粒度不合适、无公共模块、各接口独立校验、session无法共享、HTTP手动调用</li>
</ul>
<h5 id="模块拆分-1"><a href="#模块拆分-1" class="headerlink" title="模块拆分"></a>模块拆分</h5><ul>
<li><strong>粒度</strong>：过粗、适中、过细</li>
<li>人员的角度</li>
<li>业务的角度：相关、独立</li>
</ul>
<h3 id="购物车与订单模块"><a href="#购物车与订单模块" class="headerlink" title="购物车与订单模块"></a>购物车与订单模块</h3><h5 id="购物车模块"><a href="#购物车模块" class="headerlink" title="购物车模块"></a>购物车模块</h5><ul>
<li><p>添加商品到购物车 → 商品是否在售、是否有库存 </p>
<ul>
<li><p>→[否] 提示用户</p>
</li>
<li><p>→[是] 该商品之前就在购物车里</p>
<ul>
<li>→[否] 添加新商品</li>
<li>→[是] 原有基础上添加数量</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code class="java">创建一个module 加入关于cart的controller/model.dao.pojo.vo/service.impl
其中ProductMapper productMapper会爆红是理所应当的 这样证明耦合不是很严重
利用远程调用Feign进行调用
思路：通过调查发现productMapper只用于挑选ID
Product product = productMapper.selectByPrimaryKey(productId);
所以可以去重构一下代码 回到商品模块的地方cloud-mall-category-product
其中controller中的ProductController
//com/imooc/cloud/mall/practice/categoryproduct/controller/ProductController.java
//这个是服务与服务之间的内部调用 不需要层层包装 只需要返回就好
    @GetMapping(&quot;product/detailForFeign&quot;)
    public Product detailForFeign(@RequestParam Integer id)&#123;
       Product product = productService.detail(id);
       return product;
    &#125;
//千万不要直接引用另一个项目的mapper 因为耦合有点严重 只要对面发生变化 就完蛋了
//com/imooc/cloud/mall/practice/cartorder/feign/ProductFeignClient.java
package com.imooc.cloud.mall.practice.cartorder.feign;

import com.imooc.cloud.mall.practice.categoryproduct.model.pojo.Product;
import org.springframework.web.bind.annotation.RequestParam;

public interface ProductFeignClient &#123;
    Product detailForFeign(@RequestParam Integer id);
&#125;
</code></pre>
<h3 id="用户模块提供获取当前用户接口"><a href="#用户模块提供获取当前用户接口" class="headerlink" title="用户模块提供获取当前用户接口"></a>用户模块提供获取当前用户接口</h3><pre><code class="java">com/imooc/cloud/mall/practice/user/controller/UserController.java
 @GetMapping(&quot;/getUser&quot;)
    @ResponseBody
    public User getUser(HttpSession session)&#123;
        User currentUser = (User) session.getAttribute(Constant.IMOOC_MALL_USER);
        return currentUser;
    &#125; /**
     * 获取当前登录的User对象 为了避免暴露用户信息，可以再filter中对getUser进行拦截
     * @param session
     * @return
     */
    @GetMapping(&quot;/getUser&quot;)
    @ResponseBody
    public User getUser(HttpSession session)&#123;
        User currentUser = (User) session.getAttribute(Constant.IMOOC_MALL_USER);
        return currentUser;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/cloud/mall/practice/cartorder/feign/UserFeignClient.java
package com.imooc.cloud.mall.practice.cartorder.feign;

import com.imooc.cloud.mall.practice.user.model.pojo.User;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.GetMapping;

/**
 * UserFeign客户端
 */
@FeignClient(value = &quot;cloud-mall-user&quot;)
public interface UserFeignClient &#123;
    /**
     * 获取当前登录的user对象
     */
    @GetMapping(&quot;/getUser&quot;)
    User getUser();
&#125;
修改CaetMapper.xml的路径名
</code></pre>
<pre><code class="java">com/imooc/cloud/mall/practice/cartorder/feign/ProductFeignClient.java
package com.imooc.cloud.mall.practice.cartorder.feign;

import com.imooc.cloud.mall.practice.cartorder.pojo.Product;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;
/**
 * 描述：     商品FeignClient
 */
@FeignClient(value = &quot;cloud-mall-category-product&quot;)
public interface ProductFeignClient &#123;
    //不经过网关 只是内部调用
    @GetMapping(&quot;product/detailForFeign&quot;)
    Product detailForFeign(@RequestParam Integer id);

    @PostMapping(&quot;product/updateStock&quot;)
    void updateStock(@RequestParam Integer productId, @RequestParam Integer stock);

&#125;
</code></pre>
<pre><code class="java">将新增模块加入到网关[前缀地址] zuul
zuul.routes.cloud-mall-user.path=/user/**
zuul.routes.cloud-mall-user.service-id=cloud-mall-user
zuul.routes.cloud-mall-category-product.path=/category-product/**
zuul.routes.cloud-mall-category-product.service-id=cloud-mall-category-product
zuul.routes.cloud-mall-cart-order.path=/cart-order/**
zuul.routes.cloud-mall-cart-order.service-id=cloud-mall-cart-order
</code></pre>
<h3 id="让Feign携带Session信息"><a href="#让Feign携带Session信息" class="headerlink" title="让Feign携带Session信息"></a>让Feign携带Session信息</h3><blockquote>
<p>错误新消息：500 Internal Server Error<br>在购物车中去调用User的getUser方法 是经过Feign<br>但是Feign的调用不经过网关 它是一个HTTP的调用<br>需要携带网关的Session信息</p>
</blockquote>
<ul>
<li><strong>FeignRequestInterceptor</strong> [对每一个发出的Feign进行拦截]<br>把网关的所有信息都复制到Feign的请求上 就不会遗漏相关信息</li>
</ul>
<pre><code class="java">com/imooc/cloud/mall/practice/cartorder/filter/FeignRequestInterceptor.java
package com.imooc.cloud.mall.practice.cartorder.filter;

import feign.RequestInterceptor;
import feign.RequestTemplate;
import java.util.Enumeration;
import javax.servlet.http.HttpServletRequest;
import org.springframework.cloud.openfeign.EnableFeignClients;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.context.request.RequestAttributes;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

/**
 * 描述：     Feign请求拦截器
 */
@EnableFeignClients
@Configuration
public class FeignRequestInterceptor implements RequestInterceptor &#123;

    @Override
    public void apply(RequestTemplate requestTemplate) &#123;
        //通过RequestContextHolder获取到请求 拿到requestAttributes
        RequestAttributes requestAttributes = RequestContextHolder.getRequestAttributes();
        if (requestAttributes == null) &#123;
            return;
        &#125;//类型转换 拿到Request
        HttpServletRequest request = ((ServletRequestAttributes) requestAttributes).getRequest();
        Enumeration&lt;String&gt; headerNames = request.getHeaderNames(); //拿到所有Header名字
        if (headerNames != null) &#123;
            while (headerNames.hasMoreElements()) &#123; //如果还有新的元素 先获取
                String name = headerNames.nextElement(); //获取相关的值
                Enumeration&lt;String&gt; values = request.getHeaders(name);
                while (values.hasMoreElements()) &#123;//获取到当前元素
                    String value = values.nextElement();
                    requestTemplate.header(name, value);
                &#125;
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
<h3 id="订单模块"><a href="#订单模块" class="headerlink" title="订单模块"></a>订单模块</h3><ul>
<li><h5 id="表设计和接口设计"><a href="#表设计和接口设计" class="headerlink" title="表设计和接口设计"></a>表设计和接口设计</h5></li>
</ul>
<pre><code class="java">&quot;订单编号的名字也要改 不能是以前的自增id 要变成order_no&quot;
order_no是每一种商品的id
否则黑客早上下一单 晚上下一单 相减 就可以估计客流量 
分成了很详细的字段名
product_id/name/img 都是之前购买过的订单产生的数据
</code></pre>
<h3 id="生成订单–用户下单"><a href="#生成订单–用户下单" class="headerlink" title="生成订单–用户下单"></a>生成订单–用户下单</h3><ul>
<li>入参</li>
<li>从购物车中查询已经勾选的商品</li>
<li>判断商品是否正在售卖中</li>
<li>判断库存，保证不超卖</li>
<li>调用商品服务扣库存 [及时更新库存]</li>
<li>删除购物车为中对应的商品</li>
<li>生成订单</li>
<li>订单号生成规则</li>
<li>循环保存每一个商品到order_item表</li>
</ul>
<h3 id="图片路径配置"><a href="#图片路径配置" class="headerlink" title="图片路径配置"></a>图片路径配置</h3><pre><code class="java">com/imooc/cloud/mall/practice/cartorder/config/ImoocMallWebMvcConfig.java
package com.imooc.cloud.mall.practice.cartorder.config;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/**
 * 描述：     地址映射配置
 */
@Configuration
public class ImoocMallWebMvcConfig implements WebMvcConfigurer &#123;

    @Value(&quot;$&#123;file.upload.dir&#125;&quot;)
    String FILE_UPLOAD_DIR;

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) &#123;
        registry.addResourceHandler(&quot;/images/**&quot;).addResourceLocations(&quot;file:&quot; + FILE_UPLOAD_DIR);
    &#125;

</code></pre>
<h3 id="购物车和订单模块-重难点"><a href="#购物车和订单模块-重难点" class="headerlink" title="购物车和订单模块-重难点"></a>购物车和订单模块-重难点</h3><ul>
<li>订单表[多个关联(订单编号+状态)]、订单状态设计</li>
<li>购物车流程</li>
<li>下单流程</li>
<li>Feign调用的处理</li>
</ul>
<h5 id="购物车和订单模块-常见错误"><a href="#购物车和订单模块-常见错误" class="headerlink" title="购物车和订单模块-常见错误"></a>购物车和订单模块-常见错误</h5><ul>
<li>Feign调用取不到User对象</li>
<li>URL错误拦截(图片url可以不拦截[订单+购物车])</li>
<li>路由配置错误(二维码&#x2F;图片不显示)</li>
</ul>

    </div>

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <div id="comment">
        <div id="gitalk-container">
        </div>
    </div>
    
</div>
                     
<footer id="footer">
    <div class="footer-wrap">
        <div>
            © 2018 - 2025 P-luminary
            <span class="footer-icon">
                <a-icon type="flag" theme="filled" /></span>
            @Asuna
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a>
<!--         & <a target="_blank" rel="noopener" href="https://github.com/korilin/hexo-theme-particle">Particle Theme</a></div> -->
        
    </div>

</footer>

<script src="/js/highlight.min.js"></script>
<script src="/js/particle.js"></script>
                </div>
            </div>
        </transition>
    </div>

    <script>
    new Vue({
        el: "#layout",
        data: {
            show_page: false,
            onload_menu: false,
            menu_show: false,
            card_top: 100
        },
        created: function () {
            var that = this
            window.onload = function () {
                that.show_page = true
                document.getElementById("loadcontent").style.opacity = 0
                setTimeout(function () {
                    document.getElementById("loadleft").style.width = 0
                    document.getElementById("loadright").style.width = 0
                }, 300)
                setTimeout(function () {
                    document.getElementById("loading").style = "display:none"
                }, 600)
            }
        },
        mounted: function () {
            var that = this
            window.addEventListener('scroll', function (e) {
                that.menu_show = false
            })
        },
        methods: {
            home_click: function () {
                window.scrollTo({
                    top: window.innerHeight - 80,
                    behavior: "smooth",
                });
            }
        }
    })
</script>

<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
    const gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'hexo-theme-particle',      // The repository of store comments,
        owner: 'P-luminary',
        admin: ['P-luminary'],
        language: 'en',
        id: location.pathname,      // Ensure uniqueness and length less than 50
        distractionFreeMode: true  // Facebook-like distraction free mode
    })
    gitalk.render('gitalk-container')
</script>

</body>

</html>