
<!DOCTYPE html>
<html lang="zh_CH ">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P-luminary || SSM开发社交网站[Freemarker+Spring+SpringMVC+Mybatis(Plus)构成SSM+Bootstrap+Art-Template+Kaptcha+SpringTask+wangEditor]</title>
    <meta name="author" content="Asuna">
    <meta name="description" content=" ">
    <meta name="keywords" content=" ">
    <link rel="icon" href="/https://raw.githubusercontent.com/P-luminary/images/master/data/asuna.jpg">
    <link rel="stylesheet" href="/css/antd.min.css">
    
    <link rel="stylesheet" href="/css/maiden-theme.css">
    
    <script src="/js/vue.js"></script>
    <script src="/js/antd.min.js"></script>
<meta name="generator" content="Hexo 6.1.0"></head>

<body>

    <div id="loading"
        style="height: 100vh; width: 100%; position: fixed;display: flex;z-index: 200; justify-content: space-between;">
        <div id="loadleft" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div id="loadright" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div
            style="position: fixed; height: 100vh; width: 100%;display: flex;justify-content: center;align-items: center;">
            <div id="loadcontent"
                style="width:400px;height:400px;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px#a3ddfb; text-align:center;opacity:1;transition:opacity 0.3s ease-out;">
                <div>
                    <h2>LOADING...</h2>
                    <p>加载过慢请开启缓存(浏览器默认开启)</p>
                    <div>
                        <img src="/dancingkitty.gif" alt="loading">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="layout">
        <transition name="into">
            <div v-show="show_page" style="display: none;">
                <div id="menu_show">
                     
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">P-luminary</span>
        </a>
        
        <a href="/">
            <span>
                <a-icon type="home" theme="filled" />
            </span>
            <span>home</span>
        </a>
        
        <a href="/tags/语法">
            <span>
                <a-icon type="tags" theme="filled" />
            </span>
            <span>tags</span>
        </a>
        
    </div>

    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div :class="'title'" @click="menu_show=!menu_show">
            <span style="margin-right: 10px;">
                <a-icon type="appstore" theme="filled" />
            </span>
            <span>P-luminary</span>
        </div>
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="home" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">home</div>
                </div>
            </a>
            
            <a href="/tags/语法">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="tags" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">tags</div>
                </div>
            </a>
            
        </div>
        <div class="curtain" v-show="menu_show"></div>
    </div>

</nav>
                </div>

                <div id="main">
                     
<link rel="stylesheet" href="/css/post-body.css">
<div class="article">
    <div>
        <h1>SSM开发社交网站[Freemarker+Spring+SpringMVC+Mybatis(Plus)构成SSM+Bootstrap+Art-Template+Kaptcha+SpringTask+wangEditor] </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <a-icon type="calendar" theme="filled" />
            </span>
            2024/1/18
        </span>

        

        

        <span class="tags">
            <span class="icon">
                <a-icon type="tags" theme="filled" />
            </span>
            
            <span class="tag">
                
                <a href="/tags/后端" style=color:#00bcd4>
                    后端
                </a>
            </span>
            
        </span>
        
    </div>

    <div class="content" v-pre>
        <h1 id="慕课书评网学习内容"><a href="#慕课书评网学习内容" class="headerlink" title="慕课书评网学习内容"></a><span style ="color:red">慕课书评网学习内容</span></h1><p><span style ="color:blue"><strong>SSM</strong> &#x3D;&gt; <span style ="color:red"><strong>S</strong></span>pring &#x2F; <span style ="color:red"><strong>S</strong></span>pring MVC &#x2F; <span style ="color:red"><strong>M</strong></span>yBatis</span></p>
<ul>
<li>讲解Spring&#x2F;Spring MVC&#x2F;MyBatis(SSM)整合配置过程</li>
<li>讲解<span style ="color:red"><strong>MyBatis-Plus</strong></span>敏捷开发插件的用法</li>
<li>开发Java Web应用”慕课书评网”</li>
</ul>
<h3 id="主要知识点"><a href="#主要知识点" class="headerlink" title="主要知识点"></a>主要知识点</h3><ul>
<li>SSM整合配置</li>
<li>MyBatis-Plus配置与应用</li>
<li>Kaptcha验证码组件使用</li>
<li>富文本编辑器wangEditor</li>
<li>Spring Task任务调度</li>
<li>基于阿里云实现短信验证</li>
<li>基于腾讯云的滑块验证码实现前置的人机登录检查</li>
</ul>
<h4 id="工程结构与开发规约-复习知识点"><a href="#工程结构与开发规约-复习知识点" class="headerlink" title="工程结构与开发规约 [复习知识点]"></a>工程结构与开发规约 [<span style = "color:red">复习知识点</span>]</h4><h5 id="工程结构"><a href="#工程结构" class="headerlink" title="工程结构"></a>工程结构</h5><pre><code class="java">mgallery - eclipse工程项目
 /src - java源代码目录
 /WebContent - Web资源目录
 /css - css文件目录
 /js - js文件目录
 /image - 图片资源目录
 /upload - 上传文件目录
 /WEB-INF   //jsp数据来自controller 不允许在web中直接访问 要从控制器跳转
   /jsp - jsp页面目录
   /lib - jar文件目录
   /classes - 编译后的class目录
   /web.xml web描述符文件
</code></pre>
<h5 id="包结构"><a href="#包结构" class="headerlink" title="包结构"></a>包结构</h5><pre><code class="java">com.imooc.mgallery //逆命名法
    /controller - 存放Servlet控制器类 //承上启下接收参数 调用逻辑 返回处理结果
    /service - 存放处理逻辑类model[伪数据库] //完成业务逻辑 service与dao进行传递调用
    /dao - Data Access Object 数据访问对象类 数据读写的java类 数据来自xml文件
    /entity - 存放实体类 JavaBean java中的简单对象
    /utils - 通用工具类 底层通用的工具类或方法
</code></pre>
<h3 id="什么是整合"><a href="#什么是整合" class="headerlink" title="什么是整合"></a>什么是整合</h3><ul>
<li>通过Spring IoC容器管理第三方框架对象, 让多框架形成整体</li>
<li><span style ="color:blue"><strong>SSM</strong> &#x3D;&gt; <span style ="color:red"><strong>S</strong></span>pring &#x2F; <span style ="color:red"><strong>S</strong></span>pring MVC &#x2F; <span style ="color:red"><strong>M</strong></span>yBatis</span>是业内最主流的框架搭配<ul>
<li>Spring MVC提供了控制器 基于Spring的Web交互的能力</li>
<li>Spring是对应用程序的对象进行创建和管理</li>
<li>MyBatis是完成了与底层数据库实现增删改查的操作</li>
</ul>
</li>
<li>SSM配置与使用是所有Java工程师必须掌握的技能</li>
</ul>
<h3 id="SSM整合三阶段"><a href="#SSM整合三阶段" class="headerlink" title="SSM整合三阶段"></a>SSM整合三阶段</h3><ul>
<li><span style ="color:red"><strong>Spring与Spring MVC环境配置</strong></span></li>
<li><span style ="color:red"><strong>Spring与MyBatis的整合配置</strong></span></li>
<li><span style ="color:red"><strong>整合其他组件: 声明式事务&#x2F;日志&#x2F;任务调度&#x2F;…</strong></span></li>
</ul>
<h3 id="Spring与Spring-MVC环境配置"><a href="#Spring与Spring-MVC环境配置" class="headerlink" title=" Spring与Spring MVC环境配置"></a><span style ="color:purple"> <strong>Spring与Spring MVC环境配置</strong></span></h3><ul>
<li>依赖Spring-WebMVC</li>
<li>配置DispatcherServlet</li>
<li>启用Spring MVC注解模式</li>
<li>配置请求与相应字符集</li>
<li>配置FreeMarker模板引擎</li>
<li>配置JSON序列化组件</li>
</ul>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/958385c851d8c4239be83aec9c90132408b1f53b/data/reader%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF.png"></p>
<p>编写pom.xml  引入导入的依赖jar包<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/fittec/article/details/118942425?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1-118942425-blog-120412354.235%5Ev40%5Epc_relevant_anti_vip&spm=1001.2101.3001.4242.2&utm_relevant_index=4">IntelliJ IDEA 2021 自动下载pom文件中的依赖_pom中的自定义插件下载-CSDN博客</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_67401055/article/details/123938800?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0-123938800-blog-108093107.235%5Ev40%5Epc_relevant_anti_vip&spm=1001.2101.3001.4242.1&utm_relevant_index=3">idea编译Java项目的部分java文件并且生成class文件_idea将java文件编译成class-CSDN博客</a></p>
<blockquote>
<p>★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★<br>设置resource和source<br>方法：点击文件右键-&gt;<strong>make direction as</strong></p>
<p>需要运行和引用的java文件设置为source文件，将配置文件(xml)等设置为resource文件<br>★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </p>
</blockquote>
<pre><code class="xml">pom.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;org.example&lt;/groupId&gt;
    &lt;artifactId&gt;imooc-reader&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;/properties&gt;
&lt;!--1.Maven依赖Spring-webmvc 第二步web.xml--&gt;
    &lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;aliyun&lt;/id&gt;
            &lt;name&gt;aliyun&lt;/name&gt;
            &lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
            &lt;version&gt;5.2.6.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--    Freemarker --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.freemarker&lt;/groupId&gt;
            &lt;artifactId&gt;freemarker&lt;/artifactId&gt;
            &lt;version&gt;2.3.30&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
            &lt;version&gt;5.2.6.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
&lt;!--   Jackson依赖包  --&gt;
        &lt;dependency&gt;
            &lt;artifactId&gt;jackson-core&lt;/artifactId&gt;
            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
            &lt;version&gt;2.11.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
            &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;
            &lt;version&gt;2.11.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
            &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
            &lt;version&gt;2.11.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre>
<pre><code class="xml">WEB-INF/web.xml    init-param变量 这个是放在servlet里面的，只有此servlet可以访问
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;
         version=&quot;3.1&quot;&gt;
&lt;!--    2.配置DispatcherServlet 第三步applicationContext.xml--&gt;
 &lt;!--    DispatcherServlet是Spring MVC是最核心的对象
         DispatcherServlet用于拦截http请求        --&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;!--自动加载applicationContext--&gt;
            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
            &lt;param-value&gt;classpath:applicationContext*.xml&lt;/param-value&gt;
        &lt;/init-param&gt;
&lt;!--        启动时初始化 servlet--&gt;
        &lt;load-on-startup&gt;0&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt; &lt;!--与上面保持一致--&gt;
        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;!-- 4.解决中文乱码问题  只会对Post请求生效 Get只需要修改tomcat的server.xml(8.0以上是自动的) 72行增加URIEncoding=&quot;UTF-8&quot; 第五步application--&gt;
    &lt;filter&gt;
        &lt;filter-name&gt;characterFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
        &lt;init-param&gt; &lt;!--初始化参数--&gt;
            &lt;param-name&gt;encoding&lt;/param-name&gt;
            &lt;param-value&gt;UTF-8&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/filter&gt;

    &lt;filter-mapping&gt;
        &lt;filter-name&gt;characterFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;
&lt;/web-app&gt;
</code></pre>
<pre><code class="xml">applicationContext.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:task=&quot;http://www.springframework.org/schema/task&quot;
       xsi:schemaLocation=&quot;
            http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/context
            http://www.springframework.org/schema/context/spring-context.xsd
            http://www.springframework.org/schema/task
            http://www.springframework.org/schema/task/spring-task.xsd
            http://www.springframework.org/schema/mvc
            http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;&gt;
&lt;!-- 3.Spring框架启用SpringMVC注解模式 第四步web.xml--&gt;
    &lt;context:component-scan base-package=&quot;com.imooc&quot;/&gt;
&lt;!-- 真正开启SpringMVC注解 --&gt;
&lt;!-- https://blog.csdn.net/u011066470/article/details/112438252 --&gt;
&lt;!-- &lt;mvc:annotation-driven&gt; Spring MVC用来提供Controller请求转发，json自动转换等功能。，默认会帮我们注册默认处理请求，参数和返回值的类 --&gt;
    &lt;mvc:annotation-driven&gt;
        &lt;mvc:message-converters&gt;
&lt;!-- 解决相应里的中文输出 --&gt;
            &lt;bean class=&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;&gt;
                &lt;property name=&quot;supportedMediaTypes&quot;&gt;
                    &lt;list&gt;
                        &lt;value&gt;text/html;charset=utf-8&lt;/value&gt;
                        &lt;!-- 6.JSON(Jackson)序列化输出配置   --&gt;
                        &lt;value&gt;application/json;charset=utf-8&lt;/value&gt;
                    &lt;/list&gt;
                &lt;/property&gt;
            &lt;/bean&gt;
        &lt;/mvc:message-converters&gt;
    &lt;/mvc:annotation-driven&gt;
&lt;!-- 诸如css/图片/js静态资源排除在外 使得SpringMVC对url处理效率加大   --&gt;
    &lt;mvc:default-servlet-handler/&gt;
&lt;!-- 5.配置Freemarker模板引擎 脚本存放地址 Bean定义可以具有零个或多个属性。属性元素对应于bean类公开的JavaBean setter方法。 Spring支持原语，对相同或相关工厂中的其他bean的引用，列表，映射和属性。 --&gt;
    &lt;bean id=&quot;freemarkerConfig&quot; class=&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer&quot;&gt;
        &lt;property name=&quot;templateLoaderPath&quot; value=&quot;/WEB-INF/ftl&quot;/&gt;
&lt;!--        对于本身的参数配置  --&gt;
        &lt;property name=&quot;freemarkerSettings&quot;&gt;
            &lt;props&gt;
&lt;!--        默认的编码类型 UTF-8 freemarker读取指定ftl文件时采用此字符集--&gt;
                &lt;prop key=&quot;defaultEncoding&quot;&gt;UTF-8&lt;/prop&gt;
            &lt;/props&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
&lt;!--    使用何种模板引擎 创建的后缀名 --&gt;
    &lt;bean id=&quot;ViewResolver&quot; class=&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver&quot;&gt;
        &lt;property name=&quot;contentType&quot; value=&quot;text/html;charset=utf-8&quot;/&gt;
        &lt;property name=&quot;suffix&quot; value=&quot;.ftl&quot;/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
<pre><code class="html">WEB-INF/ftl/test.ftl
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
测试页面！！
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<pre><code class="java">com/imooc/controller/TestController.java
package com.imooc.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;

import java.util.HashMap;
import java.util.Map;

@Controller
public class TestController &#123;
    @GetMapping(&quot;/test/t1&quot;)
    public ModelAndView test1()&#123;
        return new ModelAndView(&quot;/test&quot;);
    &#125;
    @GetMapping(&quot;test/t2&quot;)
    @ResponseBody
    public Map test2()&#123;
        Map result = new HashMap();
        result.put(&quot;test&quot;,&quot;测试文本&quot;);
        return result;
    &#125;
&#125;
</code></pre>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/a2272062968/article/details/120404192">IDEA Web项目out&#x2F;classes目录没有编译的class类文件 - IDEA环境下创建Maven WebApp_out中没有class文件夹-CSDN博客</a></p>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/31486d18fb2b0875fc03efc01fd1d1b5939a6c84/data/idea%E4%B8%ADout%E7%9A%84WEB-INF%E7%83%AD%E9%83%A8%E7%BD%B2%E7%A9%B6%E6%9E%81%E6%96%B9%E6%B3%95.jpg"></p>
<h3 id="Spring与MyBatis整合配置"><a href="#Spring与MyBatis整合配置" class="headerlink" title=" Spring与MyBatis整合配置"></a><span style ="color:purple"> <strong>Spring与MyBatis整合配置</strong></span></h3><p>MyBatisUtils封装初始化代码 如果自己new了对象就不会享受spring的福利待遇</p>
<ul>
<li>依赖mybatis-spring及驱动</li>
<li>配置数据源与连接池</li>
<li>配置SqlSessionFactory</li>
<li>配置Mapper扫描器</li>
<li>创建mybatis-config.xml</li>
</ul>
<pre><code class="xml">applicationContext.xml
&lt;!-- 5.配置Freemarker模板引擎 脚本存放地址 第六步见pom.xml mybatis依赖 --&gt;
    &lt;bean id=&quot;freemarkerConfig&quot; class=&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer&quot;&gt;
        &lt;property name=&quot;templateLoaderPath&quot; value=&quot;/WEB-INF/ftl&quot;/&gt;
&lt;!--        对于本身的参数配置  --&gt;
        &lt;property name=&quot;freemarkerSettings&quot;&gt;
            &lt;props&gt;
&lt;!--        默认的编码类型 UTF-8 freemarker读取指定ftl文件时采用此字符集--&gt;
                &lt;prop key=&quot;defaultEncoding&quot;&gt;UTF-8&lt;/prop&gt;
            &lt;/props&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
&lt;!--    使用何种模板引擎 创建的后缀名   --&gt;
    &lt;bean id=&quot;ViewResolver&quot; class=&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver&quot;&gt;
        &lt;property name=&quot;contentType&quot; value=&quot;text/html;charset=utf-8&quot;/&gt;
        &lt;property name=&quot;suffix&quot; value=&quot;.ftl&quot;/&gt;
    &lt;/bean&gt;
&lt;!--    7. MyBatis与Spring的整合配置   --&gt;
      &lt;!--②.配置数据源--&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;
        &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/imooc_reader?useSSL=false&amp;amp;useUnicode=true&amp;amp;characterEncoding=UTF-8&amp;amp;serverTimezone=Asia/Shanghai&amp;amp;allowPublicKeyRetrieval=true&quot;/&gt;
        &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;
        &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;
        &lt;property name=&quot;initialSize&quot; value=&quot;5&quot;/&gt;
        &lt;property name=&quot;maxActive&quot; value=&quot;20&quot;/&gt;
    &lt;/bean&gt;
&lt;!--8. SqlSessionFactoryBean用于根据配置信息创建SqlSessionFactory,不再需要我们自己编码创建--&gt;
    &lt;bean id=&quot;sessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
&lt;!--    存储sql语句的mapper.xml文件 存储在哪个目录中 去创建mapper接口--&gt;
        &lt;property name=&quot;mapperLocations&quot; value=&quot;classpath:mappers/*.xml&quot;/&gt;
&lt;!-- 10.  MyBatis配置文件地址 去创建一个xml  --&gt;
        &lt;property name=&quot;configLocation&quot; value=&quot;classpath:mybatis-config.xml&quot;/&gt;
    &lt;/bean&gt;
&lt;!--  9. 配置Mapper扫描器 下一步9TestMapper --&gt;
&lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;
&lt;!--  这样初始化mybatis时 会对所有mapper接口进行扫描 --&gt;
    &lt;property name=&quot;basePackage&quot; value=&quot;com.imooc.reader.mapper&quot;/&gt;
&lt;/bean&gt;
</code></pre>
<pre><code class="xml">pom.xml
&lt;!--  6. Mybatis整合步骤：①引入依赖 第七步看applicationContext.xml--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
            &lt;version&gt;5.2.6.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
            &lt;version&gt;3.5.4&lt;/version&gt;
        &lt;/dependency&gt;
&lt;!--        MyBatis与Spring整合组件 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;
            &lt;version&gt;2.0.3&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;version&gt;8.0.16&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;druid&lt;/artifactId&gt;
            &lt;version&gt;1.1.14&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>
<pre><code class="java">com/imooc/reader/mapper/TestMapper.java
package com.imooc.reader.mapper;
//接口作用Mybatis通过接口自动生成实现类
public interface TestMapper &#123;
// 系统中接口很多不是所有的都对应mapper 9.application.xml
    public void insert();
&#125;
</code></pre>
<pre><code class="xml">mybatis-config.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration
        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;configuration&gt;
    &lt;settings&gt;
&lt;!--        驼峰命名转换 --&gt;
        &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;
    &lt;/settings&gt;
&lt;/configuration&gt;
</code></pre>
<h3 id="整合其他组件"><a href="#整合其他组件" class="headerlink" title="整合其他组件"></a><span style ="color:purple"><strong>整合其他组件</strong></span></h3><ul>
<li>配置logback日志输出</li>
<li>声明式事务配置</li>
<li>整合JUnit单元测试</li>
</ul>
<pre><code class="xml">pom.xml
&lt;!--   11. 单元测试依赖 mappers加入test.xml mapper扫描接口后生成对应实现类 12test.xml--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
            &lt;version&gt;5.2.6.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;4.12&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
&lt;!--  15导入依赖 scope打包时不会放进去 tomcat自带 但是测试时不用tomcat所以要加--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
            &lt;version&gt;3.1.0&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
&lt;!--   16加入日志依赖 logback日志组件 17创建logback.xml--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
            &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
            &lt;version&gt;1.2.3&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
</code></pre>
<pre><code class="xml">mappers/test.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;com.imooc.reader.mapper.TestMapper&quot;&gt;
&lt;!--   12. 与接口对应的完整类路径  ↓用于对应数据新增 对应TestMapper.java接口  13TestService --&gt;
    &lt;insert id=&quot;insert&quot;&gt;
        insert into test(content) values(&#39;测试内容&#39;)
    &lt;/insert&gt;
&lt;/mapper&gt;
</code></pre>
<pre><code class="java">com/imooc/reader/service/TestService.java
package com.imooc.reader.service;

import com.imooc.reader.mapper.TestMapper;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import javax.annotation.Resource;

@Service
public class TestService &#123;
// 13.运行时注入生成的对象 自动生成Test 选中上面的类 Code generate 14TestServiceTest.java
    @Resource
    private TestMapper testMapper;
//      @Transactional 要么全部完成 要么什么也不做
    @Transactional
    public void batchImport()&#123;
        for (int i = 0; i &lt; 5; i++) &#123;
//            if (i==3) &#123;
//                throw new RuntimeException(&quot;预期外异常&quot;);
//            &#125;
            testMapper.insert();
        &#125;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/service/TestServiceTest.java
package com.imooc.reader.service;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import javax.annotation.Resource;

import static org.junit.Assert.*;

//14. 运行时自动初始IoC容器 + 说明配置文件在什么地方完成初始化 15依赖javaservlet pom.xml
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = &#123;&quot;classpath:applicationContext.xml&quot;&#125;)
public class TestServiceTest &#123;
    @Resource
    private TestService testService;

    @Test
    public void batchImport() &#123;
        testService.batchImport();
        System.out.println(&quot;批量导入成功&quot;);
    &#125;
&#125;
</code></pre>
<pre><code class="xml">logback.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;configuration&gt;
    &lt;appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;
        &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt;
&lt;!--           17.       小时分钟秒   日志级别  线程名   说明何类何方法  对应日志消息+换行--&gt;
&lt;!--            18转至声明式事务 applicationContext上面的文件头加些配置信息 再去下面写--&gt;
            &lt;pattern&gt;%d&#123;HH:mm:ss&#125; %-5level [%thread] %logger&#123;30&#125; - %msg%n&lt;/pattern&gt;
            &lt;charset&gt;UTF-8&lt;/charset&gt;
        &lt;/encoder&gt;
    &lt;/appender&gt;
&lt;!--    输出级别   --&gt;
    &lt;root level=&quot;debug&quot;&gt;
        &lt;appender-ref ref=&quot;console&quot;/&gt;
    &lt;/root&gt;
&lt;/configuration&gt;
</code></pre>
<pre><code class="xml">applicationContext.xml
&lt;!--    18.声明式事务配置 控制事务的打开 提交 回滚 ↓--&gt;
    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
    &lt;/bean&gt;
&lt;!--    与之对应的注解模式！ 再去TestService.java添加  @Transactional --&gt;
    &lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;/&gt;
</code></pre>
<pre><code class="java">@RunWith作用
@RunWith 就是一个运行器
@RunWith(JUnit4.class) 就是指用JUnit4来运行
@RunWith(SpringJUnit4ClassRunner.class),让测试运行于Spring测试环境
@RunWith(Suite.class) 的话就是一套测试集合，
@ContextConfiguration Spring整合JUnit4测试时，使用注解引入多个配置文件
单个文件
@ContextConfiguration(Locations=“classpath：applicationContext.xml”)
@ContextConfiguration(classes = SimpleConfiguration.class)

多个文件时，可用&#123;&#125;
@ContextConfiguration(locations = &#123; “classpath:spring1.xml”, “classpath:spring2.xml” &#125;)
</code></pre>
<h3 id="MyBatis-Plus"><a href="#MyBatis-Plus" class="headerlink" title="MyBatis-Plus"></a>MyBatis-Plus</h3><p><a target="_blank" rel="noopener" href="https://baomidou.com/">MyBatis-Plus (baomidou.com)</a></p>
<ul>
<li>MyBatis-Plus(简称MP)是一个MyBatis的增强工具</li>
<li>自动实现Mapper CRUD操作, 极致提高数据库开发效率</li>
<li>MP在MyBatis的基础上只做增强不做改变</li>
</ul>
<h3 id="MyBatis-Plus整合三部曲"><a href="#MyBatis-Plus整合三部曲" class="headerlink" title="MyBatis-Plus整合三部曲"></a>MyBatis-Plus整合三部曲</h3><ul>
<li>pom引入mybatis-plus依赖</li>
<li>Spring XML更改配置SqlSessionFactory实现类</li>
<li>mybatis-config.xml增加MP分页插件</li>
</ul>
<h3 id="MyBatis-Plus开发三部曲"><a href="#MyBatis-Plus开发三部曲" class="headerlink" title="MyBatis-Plus开发三部曲"></a>MyBatis-Plus开发三部曲</h3><ul>
<li><p>创建实体类, <code>@TableName/ @Tableld/ @TableField</code>实现映射</p>
</li>
<li><p>创建Mapper接口继承BaseMapper, 创建Mapper XML</p>
</li>
<li><p>开发时注入Mapper对象, 通过内置API实现CRUD操作</p>
</li>
</ul>
<h3 id="MyBatis-Plus核心注解"><a href="#MyBatis-Plus核心注解" class="headerlink" title="MyBatis-Plus核心注解"></a>MyBatis-Plus核心注解</h3><ul>
<li><code>@TableName</code> - 将实体类与表名映射</li>
<li><code>@Tableld</code> - 说明对应属性是表的主键</li>
<li><code>@TableField</code> - 设置属性与列名的对应关系</li>
</ul>
<h3 id="BaseMapper接口核心API"><a href="#BaseMapper接口核心API" class="headerlink" title="BaseMapper接口核心API"></a>BaseMapper接口核心API</h3><table>
<thead>
<tr>
<th>方法名</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td><strong>insert</strong>(entity)</td>
<td>数据新增,自动生成insert sql, 根据@Tableld决定注解生成方式</td>
</tr>
<tr>
<td><strong>updateById</strong>(entity)</td>
<td>根据主键更新对应对象, 自动生成update sql</td>
</tr>
<tr>
<td><strong>deleteById</strong>(id)</td>
<td>根据主键删除数据, 自动更新delete sql</td>
</tr>
<tr>
<td><strong>selectById</strong>(id)</td>
<td>按主键查询对应的实体对象</td>
</tr>
<tr>
<td>selectList(queryWrapper)</td>
<td>根据查询生成器(QueryWrapper)的条件自动生成sql查询返回List集合</td>
</tr>
<tr>
<td>selectPage(page,queryWrapper)</td>
<td>分页查询方法, 自动生成分页limit子句, 返回IPage分页对象</td>
</tr>
</tbody></table>
<pre><code class="xml">pom.xml
&lt;!--   19 整合Mybatis-plus依赖  修改application中65行   --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-plus&lt;/artifactId&gt;
            &lt;version&gt;3.3.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
</code></pre>
<pre><code class="xml">applicationContext.xml  【替换之前的sessionFactory】
&lt;!--  19. 原生Mybatis与Spring整合  自动实现接口的增删改查  20增加plus底层的分页查询插件 mybatis-config.xml--&gt;
&lt;!--    &lt;bean id=&quot;sessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;--&gt;
    &lt;bean id=&quot;sessionFactory&quot; class=&quot;com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
&lt;!--    存储sql语句的mapper.xml文件 存储在哪个目录中 去创建mapper接口--&gt;
        &lt;property name=&quot;mapperLocations&quot; value=&quot;classpath:mappers/*.xml&quot;/&gt;
&lt;!-- 10.  MyBatis配置文件地址 去创建一个xml  第十一步pom加单元测试依赖--&gt;
        &lt;property name=&quot;configLocation&quot; value=&quot;classpath:mybatis-config.xml&quot;/&gt;
    &lt;/bean&gt;
&lt;!--  9. 配置Mapper扫描器  --&gt;
&lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;
&lt;!--  这样初始化mybatis时 会对所有mapper接口进行扫描 --&gt;
    &lt;property name=&quot;basePackage&quot; value=&quot;com.imooc.reader.mapper&quot;/&gt;
&lt;/bean&gt;
&lt;!--    18.声明式事务配置 控制事务的打开 提交 回滚 ↓--&gt;
    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
    &lt;/bean&gt;
&lt;!--    与之对应的注解模式！ 再去TestService.java添加  @Transactional --&gt;
    &lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;/&gt;
</code></pre>
<pre><code class="xml">mybatis-config.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration
        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;configuration&gt;
    &lt;settings&gt;
&lt;!--        驼峰命名转换 --&gt;
        &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;
    &lt;/settings&gt;
    &lt;plugins&gt;
&lt;!--  20.配置Mybatis-Plus分页查询     21创entity/Test.java--&gt;
        &lt;plugin interceptor=&quot;com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor&quot;&gt;&lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/configuration&gt;
</code></pre>
<pre><code class="java">com/imooc/reader/entity/Test.java
// 21 Mybatis-plus运用   22mapper中TestMapper
@TableName(&quot;test&quot;) //说明实体对应哪一张表
public class Test &#123;
    @TableId(type = IdType.AUTO) //数据自增
    @TableField(&quot;id&quot;) //说明属性对应哪个字段
    private Integer id;
    //如果字段名与属性名相同或者符合驼峰命名转换规则 则TableField可以省略
    @TableField(&quot;content&quot;)
    private String content;
&#125; Getter + Setter
</code></pre>
<pre><code class="java">com/imooc/reader/mapper/TestMapper.java
package com.imooc.reader.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.imooc.reader.entity.Test;
//22.为了和BaseMapper里的insert()区别开 这个改名成insertSample
//接口作用Mybatis通过接口自动生成实现类 23.MyBatisPlusTest.java
public interface TestMapper extends BaseMapper&lt;Test&gt; &#123;
// 系统中接口很多不是所有的都对应mapper 9.application.xml
    public void insertSample();
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/MyBatisPlusTest.java
package com.imooc.reader;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.imooc.reader.entity.Test;
import org.junit.runner.RunWith;
import com.imooc.reader.mapper.TestMapper;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import javax.annotation.Resource;
import java.util.List;

//23.利用插件调用增删改查  24以Bootstrap开发前端index.ftl
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = &#123;&quot;classpath:applicationContext.xml&quot;&#125;)
public class MyBatisPlusTest &#123;
    @Resource
    private TestMapper testMapper;

    //增
    @org.junit.Test //直接进行调用 与注解重名 故此加包名
    public void testInsert() &#123;
        Test test = new Test();
        test.setContent(&quot;MyBatis Plus测试&quot;);
        //在接口中 com/imooc/reader/mapper/TestMapper.java
        testMapper.insert(test);
    &#125;

    //改
    @org.junit.Test
    public void testUpdate() &#123;
        Test test = testMapper.selectById(30);//按id号查询
        test.setContent(&quot;MyBatis Plus测试1&quot;);
        testMapper.updateById(test);
    &#125;

    //删
    @org.junit.Test
    public void testDelete() &#123;
        testMapper.deleteById(30);
    &#125;

    //查
    @org.junit.Test
    public void testSelect() &#123;
        //传入特殊包装对象
        QueryWrapper&lt;Test&gt; queryWrapper = new QueryWrapper&lt;Test&gt;();
//        queryWrapper.eq(&quot;id&quot;, 31); //eq是等值比较 若写多行语句则sql语言用and连接
        queryWrapper.gt(&quot;id&quot;, 5);//选择范围 查询大于5的数据
        List&lt;Test&gt; list = testMapper.selectList(queryWrapper);//返回获取7号数据的集合
        System.out.println(list.get(0));
    &#125;
&#125;
</code></pre>
<img src="https://raw.githubusercontent.com/P-luminary/images/06dcc63a2b2136dc8423f58abfc719549d2fe9ab/data/for%E7%9A%84%E4%BC%98%E5%8C%96%E6%B5%81.jpg" style="zoom: 80%;" />

<h3 id="基于SSM开发慕课书评网"><a href="#基于SSM开发慕课书评网" class="headerlink" title="基于SSM开发慕课书评网"></a>基于SSM开发慕课书评网</h3><p>导入训练素材的<code>imooc-reader.sql</code></p>
<h5 id="Bootstrap入门介绍-优秀的前端UI框架"><a href="#Bootstrap入门介绍-优秀的前端UI框架" class="headerlink" title="Bootstrap入门介绍 [优秀的前端UI框架]"></a>Bootstrap入门介绍 [优秀的前端UI框架]</h5><ul>
<li>Bootstrap是全球最受欢迎的前端组件库, 由推特(TWitter)开源</li>
<li>Bootstrap用于开发<strong>响应式布局</strong>、移动设备优先的WEB项目</li>
<li>Bootstrap提供完整的HTML、CSS和JS开发工具集</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.bootcss.com/">Bootstrap中文网 (bootcss.com)</a></p>
<h3 id="显示图书类别-全部-前端-后端-测试-产品"><a href="#显示图书类别-全部-前端-后端-测试-产品" class="headerlink" title="显示图书类别 [全部 | 前端 | 后端 | 测试 | 产品]"></a>显示图书类别 [<strong>全部</strong> | 前端 | 后端 | 测试 | 产品]</h3><pre><code class="html">index.ftl [只写入顺序关键信息 在这里插入素材中的index.html并更名]
&lt;#--在这块进行动态数据编写 24.创建entity/Category分类实体--&gt;
        &lt;div class=&quot;col-8 mt-2&quot;&gt;
            &lt;span data-category=&quot;-1&quot; style=&quot;cursor: pointer&quot; class=&quot;highlight  font-weight-bold category&quot;&gt;全部&lt;/span&gt;
            |
&lt;#--     31.对页面进行动态的数据导入       --&gt;
            &lt;#list categoryList as category&gt;
                &lt;a style=&quot;cursor: pointer&quot; data-category=&quot;$&#123;category.categoryId&#125;&quot; class=&quot;text-black-50 font-weight-bold category&quot;&gt;$&#123;category.categoryName&#125;&lt;/a&gt;
&lt;#--                取消最后一个的竖线--&gt;
                &lt;#if category_has_next&gt;|&lt;/#if&gt;
            &lt;/#list&gt;
        &lt;/div&gt;
</code></pre>
<pre><code class="java">com/imooc/reader/entity/Category.java
// 24.图书分类实体 25mapper创建一个CategoryMapper
public class Category &#123;
    @TableId(type = IdType.AUTO)
    private Long categoryId;
// 已自动配置好了驼峰命名法 可以忽略
// @TableField(&quot;category_name&quot;)
    private String categoryName;
&#125;Getter + Setter + 重写toString
</code></pre>
<pre><code class="java">com/imooc/reader/mapper/CategoryMapper.java
package com.imooc.reader.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.imooc.reader.entity.Category;
//25.BaseMapper自动提供了增删改查的功能 泛型指向Category
// 图书分类Mapper接口 26在mappers中创建一个category.xml
public interface CategoryMapper extends BaseMapper&lt;Category&gt; &#123;

&#125;
</code></pre>
<pre><code class="xml">mappers/category.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;com.imooc.reader.mapper.CategoryMapper&quot;&gt;
&lt;!-- 26.如何使用呢？ 27创建一个service/CategoryService接口--&gt;
&lt;/mapper&gt;
</code></pre>
<pre><code class="java">com/imooc/reader/service/CategoryService.java
package com.imooc.reader.service;
//27.有了service的接口 28就要有实现实现类存放包CategoryServiceImpl

import com.imooc.reader.entity.Category;
import java.util.List;

public interface CategoryService &#123;
    public List&lt;Category&gt; selectAll();
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/CategoryServiceImpl.java
package com.imooc.reader.service.impl;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.imooc.reader.entity.Category;
import com.imooc.reader.mapper.CategoryMapper;
import com.imooc.reader.service.CategoryService;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;

import javax.annotation.Resource;
import java.util.List;

//28.向接口编程的规则,注入写好的CategoryMapper接口 设置Transactional事务传播
//默认所有方法是不使用事务的 查询较多的方法不使用事务 写入方法较多下写入事务
//29生成测试类 code-generate-Test  com/imooc/reader/service/impl/CategoryServiceImplTest.java
@Service(&quot;categoryService&quot;)
@Transactional(propagation = Propagation.NOT_SUPPORTED, readOnly = true)
public class CategoryServiceImpl implements CategoryService &#123;
    @Resource
    private CategoryMapper categoryMapper;
    /**
     * 查询所有图书分类
     * @return 图书分类List
     */
    @Override
    public List&lt;Category&gt; selectAll() &#123;
        //查询列表 返回多个数据 插入条件构造器[查询所有]
        List&lt;Category&gt; list = categoryMapper.selectList(new QueryWrapper&lt;Category&gt;());
        return list;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/CategoryServiceImplTest.java[Test]
package com.imooc.reader.service.impl;

import com.imooc.reader.entity.Category;
import com.imooc.reader.mapper.CategoryMapper;
import com.imooc.reader.service.CategoryService;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import javax.annotation.Resource;

import java.util.List;

import static org.junit.Assert.*;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = &#123;&quot;classpath:applicationContext.xml&quot;&#125;)
public class CategoryServiceImplTest &#123;
    @Resource
    //29.保证属性和刚才的 @Service(&quot;categoryService&quot;)一致 重写Category的tostring方法重新运行selectAll
    //30进入controller开发环节 新建url与方法绑定的BookController.java
    private CategoryService categoryService;
    @Test
    public void selectAll() &#123;
        List&lt;Category&gt; list = categoryService.selectAll();
        System.out.println(list);
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/BookController.java
package com.imooc.reader.controller;

import com.imooc.reader.entity.Category;
import com.imooc.reader.service.CategoryService;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.servlet.ModelAndView;

import javax.annotation.Resource;
import java.util.List;

//30.显示之前写好的index.ftl
@Controller
public class BookController &#123;
    //传入模板数据 分类信息
    @Resource
    private CategoryService categoryService;
    //showIndex与url绑定  31继续向前推进因为index.ftl所有数据都是静态写死的
    //31要对每一个分类进行读取 List标签&lt;#list&gt;读取 转至index.ftl 64行
    /**
     * 显示首页
     * @return
     */
    @GetMapping(&quot;/&quot;)
    public ModelAndView showIndex()&#123;
        ModelAndView mav = new ModelAndView(&quot;index&quot;);
        List&lt;Category&gt; categoryList = categoryService.selectAll();//拿到列表
        //结果放入其中 属性名,值
        mav.addObject(&quot;categoryList&quot;,categoryList);
        return mav;
    &#125;
&#125;

----------------------------------------------------------
index.ftl
&lt;#-- 31.对页面进行动态的数据导入 32创建全新实体类Book --&gt;
            &lt;#list categoryList as category&gt;
                &lt;a style=&quot;cursor: pointer&quot; data-category=&quot;$&#123;category.categoryId&#125;&quot; class=&quot;text-black-50 font-weight-bold category&quot;&gt;$&#123;category.categoryName&#125;&lt;/a&gt;
&lt;#--   取消最后一个的竖线 --&gt;
                &lt;#if category_has_next&gt;|&lt;/#if&gt;
            &lt;/#list&gt;
        &lt;/div&gt;
</code></pre>
<h3 id="实现图书分页查询"><a href="#实现图书分页查询" class="headerlink" title="实现图书分页查询"></a>实现图书分页查询</h3><pre><code class="java">com/imooc/reader/entity/Book.java
// 32.创建完Book实体类  33去创建全新的BookMapper接口[mapper中]
@TableName(&quot;book&quot;)
public class Book &#123;
    @TableId(type = IdType.AUTO)
    private Long bookId;
    private String bookName;
    private String subTitle;
    private String author;
    private String cover;
    private String description;
    private Long categoryId;
    private Float evaluationScore;
    private Integer evaluationQuantity;
&#125;Getter + Setter
</code></pre>
<pre><code class="java">com/imooc/reader/mapper/BookMapper.java
package com.imooc.reader.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.imooc.reader.entity.Book;
//33.创建完Book接口  34与之对应的创建book.xml文件
public interface BookMapper extends BaseMapper&lt;Book&gt; &#123;
&#125;
</code></pre>
<pre><code class="java">mappers/book.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;com.imooc.reader.mapper.BookMapper&quot;&gt;
&lt;!--33.完成底层与数据交互代码 34完成分页处理 是在Service中完成的创建BookService完成分页对象查询--&gt;
&lt;/mapper&gt;
</code></pre>
<pre><code class="java">com/imooc/reader/service/BookService.java
package com.imooc.reader.service;

import com.baomidou.mybatisplus.core.metadata.IPage;
import com.imooc.reader.entity.Book;
//图书服务
public interface BookService &#123;
    //34.泛型&lt;Book&gt; 说明查询出来的每一行数据都是一个Book对象
    // 瞄准BookService快速生成实现类Alt+Enter =&gt; Implement interface
    //35编写com.imooc.reader.service.impl.BookServiceImpl
    public IPage&lt;Book&gt; paging(Integer page, Integer rows);
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/BookServiceImpl.java
package com.imooc.reader.service.impl;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.core.metadata.IPage;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import com.imooc.reader.entity.Book;
import com.imooc.reader.mapper.BookMapper;
import com.imooc.reader.service.BookService;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;

import javax.annotation.Resource;

//35. 实现分类代码编写  36生成测试用例 Code generate Test =&gt; BookServiceImplTest
@Service(&quot;bookService&quot;)
@Transactional(propagation = Propagation.NOT_SUPPORTED, readOnly = true)
public class BookServiceImpl implements BookService &#123;
    @Resource
    private BookMapper bookMapper;
    /**
     * 分页查询图书
     * @param page 页号
     * @param rows 每页记录数
     * @return 分页对象
     */
    public IPage&lt;Book&gt; paging(Integer page, Integer rows) &#123;
        Page&lt;Book&gt; p = new Page&lt;Book&gt;(page,rows);
        QueryWrapper&lt;Book&gt; queryWrapper = new QueryWrapper&lt;Book&gt;();
        IPage&lt;Book&gt; pageObject = bookMapper.selectPage(p, queryWrapper);//传入两个参数: page对象哪一页数据  每页记录数[条件构造器]
        return pageObject;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/BookServiceImplTest.java[Test]
package com.imooc.reader.service.impl;

import com.baomidou.mybatisplus.core.metadata.IPage;
import com.imooc.reader.entity.Book;
import com.imooc.reader.service.BookService;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import javax.annotation.Resource;

import java.util.List;

import static org.junit.Assert.*;
//36.测试分页的代码编写  37去BookController新加一个方法
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = &#123;&quot;classpath:applicationContext.xml&quot;&#125;)
public class BookServiceImplTest &#123;
    @Resource
    private BookService bookService;
    @Test
    public void paging() &#123;
        //查询每页十条
        IPage&lt;Book&gt; pageObject = bookService.paging(1,10);
        //获取当前页数据
        List&lt;Book&gt; records = pageObject.getRecords();
        for (Book b:records)&#123;
            System.out.println(b.getBookId() + &quot;:&quot; + b.getBookName());
        &#125;
        System.out.println(&quot;总页数：&quot; + pageObject.getPages());
        System.out.println(&quot;总记录数：&quot; + pageObject.getTotal());
    &#125;
&#125;
</code></pre>
<h3 id="Ajax动态加载图书信息"><a href="#Ajax动态加载图书信息" class="headerlink" title="Ajax动态加载图书信息"></a>Ajax动态加载图书信息</h3><pre><code class="java">com/imooc/reader/controller/BookController.java
//37.编写一个page方法 上面加个@Resource 绑定一个Ajax @GetMapping
    //http://localhost/books 非常长的JSON序列化结果  38index.ftl 83行
    /**  
     * 分页查询图书列表
     * @param p 页号
     * @return 分页对象
     */
package com.imooc.controller;

import com.imooc.reader.entity.Book;
import com.baomidou.mybatisplus.core.metadata.IPage;
import com.imooc.reader.service.BookService;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import javax.annotation.Resource;

@Controller
public class BookController &#123;
    @Resource
    private BookService bookService;
    
    @GetMapping(&quot;/books&quot;)
    @ResponseBody //具体数据来自客户端传入
    public IPage&lt;Book&gt; selectBook(Long categoryId, String order, Integer p) &#123;
        if (p == null) &#123;
            p = 1;
        &#125;
        IPage&lt;Book&gt; pageObject = bookService.paging(categoryId, order, p, 10);
        return pageObject;
    &#125;
&#125;
</code></pre>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/gybshen/article/details/79990533">img标签src引用网络图片，响应403的解决方法_img src引用其他网站图片-CSDN博客</a></p>
<pre><code class="java">index.ftl
  &lt;#--    38.编写Json序列化格式并追加到当前网页 上方以导入Art-Template模板引擎 39将&lt;div id=&quot;bookList&quot;&gt;下面的代码裁切放到上面 http://localhost/ --&gt;
    &lt;script&gt;
        $(function () &#123;
            $.ajax(&#123;
                url: &quot;/books&quot;,
                data : &#123;p:1&#125;,
                type : &quot;get&quot;,
                dataType : &quot;json&quot;,
                success: function(json)&#123;
                    console.info(json);
                    var list = json.records;//获取当前分页数据
                    for (var i = 0; i &lt; list.length; i++) &#123;
                        var book = json.records[i];
                        //动态将数据组合成html
                        var html = &quot;&lt;li&gt;&quot; + book.bookName + &quot;&lt;/li&gt;&quot;;
                        //jquery的id选择器选中div对象 追加
                        $(&quot;#bookList&quot;).append(html);
                    &#125;
                &#125;
            &#125;)
        &#125;)
    &lt;/script&gt;
</code></pre>
<h3 id="Art-Template-腾讯JS模板引擎"><a href="#Art-Template-腾讯JS模板引擎" class="headerlink" title="Art - Template 腾讯JS模板引擎"></a>Art - Template 腾讯JS模板引擎</h3><p><a target="_blank" rel="noopener" href="https://aui.github.io/art-template/zh-cn/index.html">art-template (aui.github.io)</a></p>
<p>整段HTML模板化 静态文本不变化 动态的数据用响应表达式进行提取</p>
<p>两组大括号进行数据提取</p>
<pre><code class="java">index.ftl
&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1.0, maximum-scale=1.0,user-scalable=no&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;./resources/bootstrap/bootstrap.css&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;./resources/raty/lib/jquery.raty.css&quot;&gt;
    &lt;script src=&quot;./resources/jquery.3.3.1.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;./resources/bootstrap/bootstrap.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;./resources/art-template.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;./resources/raty/lib/jquery.raty.js&quot;&gt;&lt;/script&gt;
-------------------------------------------------------------------------------------
&lt;#--39.type=&quot;text/html&quot;说明当前script块中包含的内容是一段一段的html浏览器不会作为javascript进行解析--&gt;
&lt;#-- ★ ★ ★ id是模板名字 两组大括号进行提取数据 ★ ★ ★ 使用模板引擎简化产生html过程--&gt;
&lt;#--    40去修改下方script代码导入的形式--&gt;
    &lt;script type=&quot;text/html&quot; id=&quot;tpl&quot;&gt;
        &lt;a href=&quot;/book/&#123;&#123;bookId&#125;&#125;&quot; style=&quot;color: inherit&quot;&gt;
            &lt;div class=&quot;row mt-2 book&quot;&gt;
                &lt;div class=&quot;col-4 mb-2 pr-2&quot;&gt;
                    &lt;img class=&quot;img-fluid&quot; src=&quot;&#123;&#123;cover&#125;&#125;&quot;&gt;
                &lt;/div&gt;
                &lt;div class=&quot;col-8  mb-2 pl-0&quot;&gt;
                    &lt;h5 class=&quot;text-truncate&quot;&gt;&#123;&#123;bookName&#125;&#125;&lt;/h5&gt;

                    &lt;div class=&quot;mb-2 bg-light small  p-2 w-100 text-truncate&quot;&gt;&#123;&#123;author&#125;&#125;&lt;/div&gt;


                    &lt;div class=&quot;mb-2 w-100&quot;&gt;&#123;&#123;subTitle&#125;&#125;&lt;/div&gt;

                    &lt;p&gt;
                        &lt;span class=&quot;stars&quot; data-score=&quot;&#123;&#123;evaluationScore&#125;&#125;&quot; title=&quot;gorgeous&quot;&gt;&lt;/span&gt;
&lt;#--                        &lt;img alt=&quot;1&quot; 加入了星型组件免去这些操作 --&gt;
&lt;#--                             src=&quot;./resources/raty/lib/images/star-on.png&quot;--&gt;
&lt;#--                             title=&quot;gorgeous&quot;&gt;&amp;nbsp;&lt;img alt=&quot;2&quot;--&gt;
&lt;#--                                                         src=&quot;./resources/raty/lib/images/star-on.png&quot;--&gt;
&lt;#--                                                         title=&quot;gorgeous&quot;&gt;&amp;nbsp;&lt;img--&gt;
&lt;#--                                alt=&quot;3&quot; src=&quot;./resources/raty/lib/images/star-on.png&quot; title=&quot;gorgeous&quot;&gt;&amp;nbsp;&lt;img--&gt;
&lt;#--                                alt=&quot;4&quot; src=&quot;./resources/raty/lib/images/star-on.png&quot; title=&quot;gorgeous&quot;&gt;&amp;nbsp;&lt;img--&gt;
&lt;#--                                alt=&quot;5&quot; src=&quot;./resources/raty/lib/images/star-on.png&quot; title=&quot;gorgeous&quot;&gt;&lt;input--&gt;
&lt;#--                                name=&quot;score&quot; type=&quot;hidden&quot; value=&quot;&#123;&#123;evaluationScore&#125;&#125;&quot; readonly=&quot;&quot;&gt;&lt;/span&gt;--&gt;
                        &lt;span class=&quot;mt-2 ml-2&quot;&gt;&#123;&#123;evaluationScore&#125;&#125;&lt;/span&gt;
                        &lt;span class=&quot;mt-2 ml-2&quot;&gt;&#123;&#123;evaluationQuantity&#125;&#125;人已评&lt;/span&gt;
                    &lt;/p&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/a&gt;
    &lt;/script&gt;

&lt;#--    38.编写Json序列化格式并追加到当前网页 上方以导入Art-Template[js]模板引擎 39将&lt;div id=&quot;bookList&quot;&gt;下面的代码裁切放到上面--&gt;
        &lt;script&gt;
&lt;#-- 41.引入星星图片 和 评价方法 上面的script运用简便写法 42下面 $(&quot;.stars&quot;)将星星的span标签选中 raty转换成可视的星星组件--&gt;
            $.fn.raty.defaults.path = &quot;./resources/raty/lib/images&quot;
            $(function () &#123;
                $.ajax(&#123;
                    url: &quot;/books&quot;,
                    data : &#123;p:1&#125;,
                    type : &quot;get&quot;,
                    dataType : &quot;json&quot;,
                    success: function(json)&#123;
                        console.info(json);
                        var list = json.records;//获取当前分页数据
                        for (var i = 0; i &lt; list.length; i++) &#123;
                            var book = json.records[i];
                            // 动态将数据组合成html
                            // var html = &quot;&lt;li&gt;&quot; + book.bookName + &quot;&lt;/li&gt;&quot;;
                            // 40.替换导入数据形式 (传入模板id,传入数据) 将数据结合tpl模板,生成html
                            // 41当评分降低的时候顺带着星星的亮度降低 raty星型评分组件 上面已准备好raty css js引入
                            // 41在上面几行引入星型评分的script方法
                            var html = template(&quot;tpl&quot;, book);
                            console.info(html);
                            //jquery的id选择器选中div对象 追加
                            $(&quot;#bookList&quot;).append(html);
                        &#125;
                        //42.显示星型评价组件 只读并不能修改
                        $(&quot;.stars&quot;).raty(&#123;readonly:true&#125;);
                    &#125;
                &#125;)
            &#125;)
    &lt;/script&gt;
</code></pre>
<h3 id="实现图书列表分页查询"><a href="#实现图书列表分页查询" class="headerlink" title="实现图书列表分页查询"></a>实现图书列表分页查询</h3><pre><code class="java">index.ftl
// 43.用于绑定加载更多按钮单击事件 44下面的设置页面的逻辑及处理
        $(function () &#123;
            $(&quot;#btnMore&quot;).click(function ()&#123;
                loadMore();
            &#125;)
        &#125;)
</code></pre>
<pre><code class="java">&lt;script&gt;
&lt;#-- 41.引入星星图片 和 评价方法 上面的script运用简便写法 42下面 $(&quot;.stars&quot;)将星星的span标签选中 raty转换成可视的星星组件(被注释)--&gt;
        $.fn.raty.defaults.path = &quot;./resources/raty/lib/images&quot;
        // 45.对两次Ajax的代码进行重构与梳理(定义一个loadMore()方法将下面的裁切进来底下写进递归)
        // isReset参数设置true,代表从第一页开始查询,否则按nextPage查询后续页
        // 对下面那个data: &#123;p: 1&#125;, 进行重构 ↓↓↓↓ isReset 下面代码已经被注释但未完全删除
        // loadMore()加载更多数据
        function loadMore(isReset)&#123;
            if (isReset == true)&#123;
                $(&quot;#nextPage&quot;).val(1);
            &#125;
            var nextPage = $(&quot;#nextPage&quot;).val();
            $.ajax(&#123;
                url: &quot;/books&quot;,
                //nextPage为2可以加载第二页
                data: &#123;p: nextPage&#125;,
                type: &quot;get&quot;,
                dataType: &quot;json&quot;,
                success: function (json) &#123;
                    console.info(json);
                    var list = json.records;//获取当前分页数据
                    for (var i = 0; i &lt; list.length; i++) &#123;
                        var book = json.records[i];
                        var html = template(&quot;tpl&quot;, book);
                        console.info(html);
                        //jquery的id选择器选中div对象 追加
                        $(&quot;#bookList&quot;).append(html);
                    &#125;
                    $(&quot;.stars&quot;).raty(&#123;readonly: true&#125;);
                    // 44.如果当前页小于总页数 下面利用val设置隐藏域的值
                    // 可能将按照字符串处理 结果是31而不是4 要强制转换
                    // 若有后续数据的话 最后几行的divNoMore需要隐藏起来
                    // 45对两次的Ajax代码进行重构与梳理 上面找到第一个script
                    if (json.current &lt; json.pages)&#123;
                        $(&quot;#nextPage&quot;).val(parseInt(json.current + 1));
                        $(&quot;#btnMore&quot;).show();
                        $(&quot;#divNoMore&quot;).hide();
                    &#125;else &#123;
                        $(&quot;#btnMore&quot;).hide();
                        $(&quot;#divNoMore&quot;).show();
                    &#125;
                &#125;
            &#125;)
        &#125;
     
        $(function () &#123;
            loadMore(true);
        &#125;)

        // 43.用于绑定加载更多按钮单击事件 44上面的设置页面的逻辑及处理
        $(function () &#123;
            $(&quot;#btnMore&quot;).click(function ()&#123;
                loadMore();
            &#125;)
        &#125;)
    &lt;/script&gt;
</code></pre>
<h3 id="实现图书多条件动态查询"><a href="#实现图书多条件动态查询" class="headerlink" title="实现图书多条件动态查询"></a>实现图书多条件动态查询</h3><pre><code class="java">index.ftl
// 43.用于绑定加载更多按钮单击事件 44上面的设置页面的逻辑及处理
        $(function()&#123;
            $(&quot;#btnMore&quot;).click(function()&#123;
                loadMore();
            &#125;)
            //46 增加点击的显示控件
            $(&quot;.category&quot;).click(function () &#123;
                $(&quot;.category&quot;).removeClass(&quot;highlight&quot;); //移除高亮
                $(&quot;.category&quot;).addClass(&quot;text-black-50&quot;);//增添灰色
                $(this).addClass(&quot;highlight&quot;);//增加高亮
                //49添加数量与热度 ↓点击的超链接 在下面也要添加order
                var categoryId = $(this).data(&quot;category&quot;); //214行定义了data-category
                $(&quot;#categoryId&quot;).val(categoryId);
                loadMore(true); //每次点完要重新查询
            &#125;)//在排序处显示控件 47点击 全部|前端|后端 产生数据联动BookService上

            $(&quot;.order&quot;).click(function()&#123;
                $(&quot;.order&quot;).removeClass(&quot;highlight&quot;); //移除高亮
                $(&quot;.order&quot;).addClass(&quot;text-black-50&quot;);//增添灰色
                $(this).addClass(&quot;highlight&quot;);//增加高亮
                //~49.提取设置到隐藏域中 发送请求到Ajax服务器上最上面 50var categoryId
                var order = $(this).data(&quot;order&quot;);
                $(&quot;#order&quot;).val(order); //点击不同隐藏域时为其赋值
                loadMore(true);
            &#125;)
        &#125;)
</code></pre>
<pre><code class="java">com/imooc/reader/service/BookService.java
package com.imooc.reader.service;

import com.baomidou.mybatisplus.core.metadata.IPage;
import com.imooc.reader.entity.Book;
//图书服务
public interface BookService &#123;
    //34.泛型&lt;Book&gt; 说明查询出来的每一行数据都是一个Book对象
    // 瞄准BookService快速生成实现类Alt+Enter =&gt; Implement interface
    //35编写com.imooc.reader.service.impl.BookServiceImpl

    /**
     * 分页查询图书
     * @param categoryId 分类编号
     * @param order 排序方式
     * @param page 页号
     * @param rows 每页记录数
     * @return 分页对象
     */
//    47增加两个变量且在BookServiceImpl中也对应增加上
    public IPage&lt;Book&gt; paging(Long categoryId, String order, Integer page, Integer rows);
&#125;
</code></pre>
<pre><code class="java">package com.imooc.reader.service.impl.BookServiceImpl;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.core.metadata.IPage;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import com.imooc.reader.entity.Book;
import com.imooc.reader.mapper.BookMapper;
import com.imooc.reader.service.BookService;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;

import javax.annotation.Resource;

//35. 实现分类代码编写  36生成测试用例 Code generate Test =&gt; BookServiceImplTest
@Service(&quot;bookService&quot;)
@Transactional(propagation = Propagation.NOT_SUPPORTED, readOnly = true)
public class BookServiceImpl implements BookService &#123;
    @Resource
    private BookMapper bookMapper;

    /**
     * 分页查询图书
     *
     * @param categoryId 分类编号
     * @param order      排序方式
     * @param page       页号
     * @param rows       每页记录数
     * @return 分页对象
     */
    public IPage&lt;Book&gt; paging(Long categoryId, String order, Integer page, Integer rows) &#123;
        Page&lt;Book&gt; p = new Page&lt;Book&gt;(page, rows);
        QueryWrapper&lt;Book&gt; queryWrapper = new QueryWrapper&lt;Book&gt;();
        //47.编写匹配条件 48去BookController更改调用参数
        if (categoryId != null &amp;&amp; categoryId != -1) &#123;//代表传入了有效分类编号
            queryWrapper.eq(&quot;category_id&quot;, categoryId);//查询的where子句
        &#125;
        if (order != null) &#123;
            if (order.equals(&quot;quantity&quot;)) &#123; //前台必须传入↓ 评价人数排序
                queryWrapper.orderByDesc(&quot;evaluation_quantity&quot;);//降序排序
            &#125; else if (order.equals(&quot;score&quot;)) &#123;
                queryWrapper.orderByDesc(&quot;evaluation_score&quot;);//评分降序
            &#125;
        &#125;
        IPage&lt;Book&gt; pageObject = bookMapper.selectPage(p, queryWrapper);//传入两个参数: page对象哪一页数据  每页记录数[条件构造器]
        return pageObject;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/BookController.java
package com.imooc.reader.controller;

import com.baomidou.mybatisplus.core.metadata.IPage;
import com.imooc.reader.entity.Book;
import com.imooc.reader.entity.Category;
import com.imooc.reader.service.BookService;
import com.imooc.reader.service.CategoryService;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;

import javax.annotation.Resource;
import java.util.List;

//30.显示之前写好的index.ftl
@Controller
public class BookController &#123;
    //传入模板数据 分类信息
    @Resource
    private CategoryService categoryService;
    @Resource
    private BookService bookService;
    //showIndex与url绑定  31继续向前推进因为index.ftl所有数据都是静态写死的
    //31要对每一个分类进行读取 List标签&lt;#list&gt;读取 转至index.ftl 64行

    /**
     * 显示首页
     *
     * @return
     */
    @GetMapping(&quot;/&quot;)
    public ModelAndView showIndex() &#123;
        ModelAndView mav = new ModelAndView(&quot;index&quot;);
        List&lt;Category&gt; categoryList = categoryService.selectAll();//拿到列表
        //结果放入其中 属性名,值
        mav.addObject(&quot;categoryList&quot;, categoryList);
        return mav;
    &#125;
//37.编写一个page方法 上面加个@Resource 绑定一个Ajax @GetMapping
    //http://localhost/books 非常长的JSON序列化结果  38index.ftl 40行

    /**
     * 分页查询图书列表
     *
     * @param p 页号
     * @return 分页对象
     */
    //48.更改调用参数 更改BookServiceImplTest.java调用参数 49回到index.ftl 增加function第二个
    @GetMapping(&quot;/books&quot;)
    @ResponseBody //具体数据来自客户端传入
    public IPage&lt;Book&gt; selectBook(Long categoryId, String order, Integer p) &#123;
        if (p == null) &#123;
            p = 1;
        &#125;
        IPage&lt;Book&gt; pageObject = bookService.paging(categoryId, order, p, 10);
        return pageObject;
    &#125;
&#125;
</code></pre>
<pre><code class="java">index.ftl
&lt;script&gt;
        &lt;#-- 41.引入星星图片 和 评价方法 上面的script运用简便写法 42下面 $(&quot;.stars&quot;)将星星的span标签选中 raty转换成可视的星星组件(被注释)--&gt;
        $.fn.raty.defaults.path = &quot;./resources/raty/lib/images&quot;
        // 45.对两次Ajax的代码进行重构与梳理(定义一个loadMore()方法将下面的裁切进来底下写进递归)
        // isReset参数设置true,代表从第一页开始查询,否则按nextPage查询后续页
        // 对下面那个data: &#123;p: 1&#125;, 进行重构 ↓↓↓↓ isReset 下面代码已经被注释但未完全删除
        // loadMore()加载更多数据 46下方整理点击时的高亮显示 [全部]
        function loadMore(isReset)&#123;
            if(isReset == true)&#123;
                $(&quot;#bookList&quot;).html(&quot;&quot;);
                $(&quot;#nextPage&quot;).val(1);
            &#125;
            // 50.让Ajax获取数据在下方data填写 下方$(&quot;.category和.order&quot;)都要重新调用递归
            // 细节清空再显示 上方$(&quot;#bookList&quot;).html(&quot;&quot;);
            var nextPage = $(&quot;#nextPage&quot;).val();
            var categoryId= $(&quot;#categoryId&quot;).val();
            var order = $(&quot;#order&quot;).val();
            //接下来就是发送数据时 组织成参数发送服务器
            $.ajax(&#123;
                url : &quot;/books&quot; ,
                //nextPage为2可以加载第二页  ↓字符串：变量
                data : &#123;p:nextPage,&quot;categoryId&quot;:categoryId , &quot;order&quot;:order&#125;,
                type : &quot;get&quot; ,
                dataType : &quot;json&quot; ,
                success : function(json)&#123;
                    console.info(json);
                    var list = json.records;
                    for(var i = 0 ; i &lt; list.length ; i++)&#123;
                        var book = json.records[i];
                        // var html = &quot;&lt;li&gt;&quot; + book.bookName + &quot;&lt;/li&gt;&quot;;
                        //将数据结合tpl模板,生成html
                        var html = template(&quot;tpl&quot; , book);
                        console.info(html);
                        //jquery的id选择器选中div对象 追加
                        $(&quot;#bookList&quot;).append(html);
                    &#125;
                    $(&quot;.stars&quot;).raty(&#123;readOnly:true&#125;);
                    // 44.如果当前页小于总页数 下面利用val设置隐藏域的值
                    // 可能将按照字符串处理 结果是31而不是4 要强制转换
                    // 若有后续数据的话 最后几行的divNoMore需要隐藏起来
                    // 45对两次的Ajax代码进行重构与梳理 上面找到第一个script
                    if(json.current &lt; json.pages)&#123;
                        $(&quot;#nextPage&quot;).val(parseInt(json.current) + 1);
                        $(&quot;#btnMore&quot;).show();
                        $(&quot;#divNoMore&quot;).hide();
                    &#125;else&#123;
                        $(&quot;#btnMore&quot;).hide();
                        $(&quot;#divNoMore&quot;).show();
                    &#125;
                &#125;
            &#125;)
        &#125;
</code></pre>
<h3 id="图书详情页-读取图书信息"><a href="#图书详情页-读取图书信息" class="headerlink" title="图书详情页-读取图书信息"></a>图书详情页-读取图书信息</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/gybshen/article/details/79990533">img标签src引用网络图片，响应403的解决方法_img src引用其他网站图片-CSDN博客</a></p>
<pre><code class="java">com/imooc/reader/service/BookService.java
public IPage&lt;Book&gt; paging(Long categoryId, String order, Integer page, Integer rows);
    /**
     * 根据图书编号查询图书对象
     * @param bookId 图书编号
     * @return 图书对象
     */
    //51.增加一个查询书籍的接口 再去BookServiceImpl中实现
    public Book selectById(Long bookId);
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/BookServiceImpl.java
 //51实现后再向上推进 BookController
    @Override
    public Book selectById(Long bookId) &#123;
        Book book = bookMapper.selectById(bookId);
        return book;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/BookController.java
//51.进行页面的绑定 获取读书编号 52把所有ftl相对路径改成绝对路径 ./前面的.删掉
    //加上了./就是  localhost/book/......   删掉就是 localhost/......
    //52更改detail.ftl将静态页面改成动态页面
    @GetMapping(&quot;/book/&#123;id&#125;&quot;) //↓ 路径变量 和 上面的保持一致
    public ModelAndView showDetail(@PathVariable(&quot;id&quot;) Long id)&#123;
        Book book = bookService.selectById(id);
        ModelAndView mav = new ModelAndView(&quot;/detail&quot;);
        mav.addObject(&quot;book&quot;, book);
        return mav;
    &#125;
</code></pre>
<pre><code class="java">detail.ftl
&lt;#-- 52.更改detail.ftl将静态页面改成动态页面 &lt;title&gt; 还有下面图书细节 --&gt;
&lt;#--  53.来源于数据底层的description描述字段   54显示动态评论列表 数据库有evaluation表 创建一个entity/Evaluation--&gt;

    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot;&gt; &lt;#--防止网页图片加载不出来--&gt;
    &lt;title&gt;$&#123;book.bookName&#125;&lt;/title&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1.0, maximum-scale=1.0,user-scalable=no&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;/resources/bootstrap/bootstrap.css&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;/resources/raty/lib/jquery.raty.css&quot;&gt;
    &lt;script src=&quot;/resources/jquery.3.3.1.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;/resources/bootstrap/bootstrap.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;/resources/art-template.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;/resources/raty/lib/jquery.raty.js&quot;&gt;&lt;/script&gt;

-------------------------------------------------------------------
&lt;div class=&quot;row p-2 description&quot;&gt;
        &lt;#-- 53.来源于数据底层的description描述字段     --&gt;
        $&#123;book.description&#125;
    &lt;/div&gt;
</code></pre>
<h3 id="图书详情页-显示评论列表"><a href="#图书详情页-显示评论列表" class="headerlink" title="图书详情页-显示评论列表"></a>图书详情页-显示评论列表</h3><pre><code class="java">com/imooc/reader/entity/Member.java
//59.创建Member实体后完成MemberMapper接口
@TableName(&quot;member&quot;)
public class Member &#123;
    @TableId(type = IdType.AUTO)
    private Long memberId;
    private String username;
    private String password;
    private Integer salt;
    private String nickname;
    private Date createTime;
&#125;Getter+Setter
</code></pre>
<pre><code class="java">com/imooc/reader/entity/Evaluation.java
package com.imooc.reader.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;

import java.util.Date;
//54.创造了评论相关的底层entity 55定义一个EvaluationMapper.java接口
//再定义一个 evaluation.xml  再service上创建一个新的接口EvaluationService.java
@TableName(&quot;evaluation&quot;)
public class Evaluation &#123;
//  id是主键
    @TableId(type= IdType.AUTO)
    private Long evaluationId;
    private Long bookId;
    private String content;
    private Integer score;
    private Long memberId;
    private Date createTime;
    private Integer enjoy;
    private String state;
    private String disableReason;
    private Date disableTime;
    @TableField(exist = false) //58.说明book属性没有对应字段,不会参与到sql自动生成
    private Book book; //Book的关联字段 加注解不存在 不会参与sql语句自动生成中 59创建会员entity对象Member实体
    @TableField(exist = false)
    private Member member; //59.获取集合后查询每个评论的信息 EvaluationServiceImpl中
&#125;Getter + Setter
</code></pre>
<pre><code class="java">com/imooc/reader/mapper/EvaluationMapper.java
package com.imooc.reader.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.imooc.reader.entity.Evaluation;
//55
public interface EvaluationMapper extends BaseMapper&lt;Evaluation&gt; &#123;
&#125;
</code></pre>
<pre><code class="java">mappers/evaluation.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;com.imooc.reader.mapper.EvaluationMapper&quot;&gt;
&lt;!--55--&gt;
&lt;/mapper&gt;
</code></pre>
<pre><code class="java">com/imooc/reader/service/EvaluationService.java
package com.imooc.reader.service;

import com.imooc.reader.entity.Evaluation;

import java.util.List;
//55.再创建一个它的实现类 Alt+回车 com/imooc/reader/service/impl/EvaluationServiceImpl.java
public interface EvaluationService&#123;
    /**
     * 按图书编号查询有效短评
     * @param bookId 图书编号
     * @return 评论列表
     */
    public List&lt;Evaluation&gt; selectByBookId(Long bookId);
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/EvaluationServiceImpl.java
package com.imooc.reader.service.impl;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.imooc.reader.entity.Book;
import com.imooc.reader.entity.Evaluation;
import com.imooc.reader.entity.Member;
import com.imooc.reader.mapper.BookMapper;
import com.imooc.reader.mapper.EvaluationMapper;
import com.imooc.reader.mapper.MemberMapper;
import com.imooc.reader.service.EvaluationService;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;

import javax.annotation.Resource;
import java.util.List;
//55.按图书编号查询有效短评   56BookController得到对应的图书编号以后 基于service查询对应短评信息
@Service(&quot;evluationService&quot;)
@Transactional(propagation = Propagation.NOT_SUPPORTED, readOnly = true)
public class EvaluationServiceImpl implements EvaluationService &#123;
    @Resource
    private EvaluationMapper evaluationMapper;
    //59
    @Resource
    private MemberMapper memberMapper;
    @Resource
    private BookMapper bookMapper;
    /**
     * 按图书编号查询有效短评
     * @param bookId 图书编号
     * @return
     */
    @Override
    public List&lt;Evaluation&gt; selectByBookId(Long bookId) &#123;
        Book book = bookMapper.selectById(bookId); //59根据参数查询book对象
        QueryWrapper&lt;Evaluation&gt; queryWrapper = new QueryWrapper&lt;Evaluation&gt;();
        queryWrapper.eq(&quot;book_id&quot;, bookId);
        queryWrapper.eq(&quot;state&quot;,&quot;enable&quot;);
        queryWrapper.orderByDesc(&quot;create_time&quot;);
        List&lt;Evaluation&gt; evaluationList = evaluationMapper.selectList(queryWrapper);
        //59.查询每个评论的信息
        for(Evaluation eva:evaluationList)&#123;
            Member member = memberMapper.selectById(eva.getMemberId());//59获得会员对象要使用接口咯
            eva.setMember(member);
            eva.setBook(book);//59循环的时候为每一个Evaluation设置一个book对象 60回到detail.ftl
        &#125;
        return evaluationList;
    &#125;
&#125;
</code></pre>
<pre><code class="java">detail.ftl
 &lt;div class=&quot;alert alert-primary w-100 mt-2&quot; role=&quot;alert&quot;&gt;短评
        &lt;button type=&quot;button&quot; id=&quot;btnEvaluation&quot; class=&quot;btn btn-success btn-sm text-white float-right&quot;
                style=&quot;margin-top: -3px;&quot;&gt;
            写短评
        &lt;/button&gt;
    &lt;/div&gt;
    &lt;div class=&quot;reply pl-2 pr-2&quot;&gt;
&lt;#--  57.对短评进行动态页面的整合与梳理 进行循环遍历  58注意下面的慕粉-126对应着数据库的会员表 再重来一遍 Evaluation--&gt;
        &lt;#list evaluationList as evaluation&gt;
            &lt;div&gt;
                &lt;div&gt;
                    &lt;span class=&quot;pt-1 small text-black-50 mr-2&quot;&gt;$&#123;evaluation.createTime?string(&#39;MM-dd&#39;)&#125;&lt;/span&gt;
&lt;#--   60.修改 慕粉-126 变为动态的--&gt;
                    &lt;span class=&quot;mr-2 small pt-1&quot;&gt;$&#123;evaluation.member.nickname&#125;&lt;/span&gt;
                    &lt;span class=&quot;stars mr-2&quot; data-score=&quot;$&#123;evaluation.score&#125;&quot;&gt;&lt;/span&gt;

                    &lt;button type=&quot;button&quot; data-evaluation-id=&quot;$&#123;evaluation.evaluationId&#125;&quot;
                            class=&quot;btn btn-success btn-sm text-white float-right&quot; style=&quot;margin-top: -3px;&quot;&gt;
                        &lt;img style=&quot;width: 24px;margin-top: -5px;&quot; class=&quot;mr-1&quot;
                             src=&quot;https://img3.doubanio.com/f/talion/7a0756b3b6e67b59ea88653bc0cfa14f61ff219d/pics/card/ic_like_gray.svg&quot;/&gt;
                        &lt;span&gt;$&#123;evaluation.enjoy&#125;&lt;/span&gt;
                    &lt;/button&gt;
                &lt;/div&gt;

                &lt;div class=&quot;row mt-2 small mb-3&quot;&gt;
                    $&#123;evaluation.content&#125;
                &lt;/div&gt;
                &lt;hr/&gt;
            &lt;/div&gt;
        &lt;/#list&gt;
    &lt;/div&gt;
</code></pre>
<h3 id="会员注册与登录"><a href="#会员注册与登录" class="headerlink" title="会员注册与登录"></a>会员注册与登录</h3><h5 id="Kaptcha验证码的配置与使用"><a href="#Kaptcha验证码的配置与使用" class="headerlink" title="Kaptcha验证码的配置与使用"></a>Kaptcha验证码的配置与使用</h5><ul>
<li>Kaptcha 是谷歌开源的可高度配置的使用验证码生成工具</li>
<li>通过 Kaptcha 可阻拦大多数机器人脚本操作</li>
<li>Kaptcha 典型应用于注册、登录、重要信息提交等用户交互</li>
</ul>
<h5 id="Kaptcha-使用步骤"><a href="#Kaptcha-使用步骤" class="headerlink" title="Kaptcha 使用步骤"></a>Kaptcha 使用步骤</h5><ul>
<li>Kaptcha 配置验证码生成参数</li>
<li>开发 KaptchaController 生成验证码图片</li>
<li>将前台输入验证码与session保存的验证码进行比对</li>
</ul>
<pre><code class="xml">pom.xml
&lt;!--   61.增加Kaptcha验证码组件依赖 applicationContext增加一个bean  --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.github.penggle&lt;/groupId&gt;
            &lt;artifactId&gt;kaptcha&lt;/artifactId&gt;
            &lt;version&gt;2.3.2&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>
<pre><code class="xml">applicationContext.xml
&lt;!--  61.配置Kaptcha 的bean  62创造KaptchaController.java--&gt;
    &lt;bean id=&quot;KaptchaProducer&quot; class=&quot;com.google.code.kaptcha.impl.DefaultKaptcha&quot;&gt;
        &lt;property name=&quot;config&quot;&gt;
            &lt;bean class=&quot;com.google.code.kaptcha.util.Config&quot;&gt;
                &lt;constructor-arg&gt;
                    &lt;props&gt;
                        &lt;!-- 验证码图片不生成边框 --&gt;
                        &lt;prop key=&quot;kaptcha.border&quot;&gt;no&lt;/prop&gt;
                        &lt;!-- 验证码图片宽度为120像素  --&gt;
                        &lt;prop key=&quot;kaptcha.image.width&quot;&gt;120&lt;/prop&gt;
                        &lt;!-- 验证码图片字体颜色为蓝色  --&gt;
                        &lt;prop key=&quot;kaptcha.textproducer.font.color&quot;&gt;blue&lt;/prop&gt;
                        &lt;!-- 每个字符最大占用40像素  --&gt;
                        &lt;prop key=&quot;kaptcha.textproducer.font.size&quot;&gt;40&lt;/prop&gt;
                        &lt;!-- 验证码包含4个字符  --&gt;
                        &lt;prop key=&quot;kaptcha.textproducer.char.length&quot;&gt;4&lt;/prop&gt;
                    &lt;/props&gt;
                &lt;/constructor-arg&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/KaptchaController.java
package com.imooc.reader.controller;

import com.google.code.kaptcha.Producer;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

import javax.annotation.Resource;
import javax.imageio.ImageIO;
import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.awt.image.BufferedImage;
import java.io.IOException;
//62.完成图片的随机生成与控制台的输出相同 63将原型里的 注册页 复制到项目工程register.ftl
@Controller
public class KaptchaController &#123;
    @Resource
    private Producer kaptchaProducer;
//    Ioc动态注入 因为验证码组件设计的时候没有考虑过SpringMVC的集成 要使用原生的请求与响应
    @GetMapping(&quot;/verify_code&quot;)
    public void createVerifyCode(HttpServletRequest request, HttpServletResponse response) throws IOException &#123;
        //响应立即过期
        response.setDateHeader(&quot;Expires&quot;,0);
        //不存储 不缓存任何图片数据
        response.setHeader(&quot;Cache-Control&quot;,&quot;no-store,no-cache,must-revalidate&quot;);
        response.setHeader(&quot;Cache-Control&quot;,&quot;post-check=0,pre-check=0&quot;);
        response.setHeader(&quot;Pragma&quot;,&quot;no-cache&quot;);
        response.setContentType(&quot;image/png&quot;);
        //生成验证码字符文本
        String verifyCode = kaptchaProducer.createText();
        request.getSession().setAttribute(&quot;kaptchaVerifyCode&quot;,verifyCode);
        System.out.println( request.getSession().getAttribute(&quot;kaptchaVerifyCode&quot;));
        BufferedImage image = kaptchaProducer.createImage(verifyCode);//创建验证码图片 二进制图片
        //二进制用getOutputStream() 字符用getWritter()
        ServletOutputStream out = response.getOutputStream();
        ImageIO.write(image,&quot;png&quot;,out);//输出图片流
        out.flush(); //立即输出
        out.close(); //关闭输出流

    &#125;
&#125;
</code></pre>
<h3 id="Kaptcha验证码的使用与对比-运用到前端"><a href="#Kaptcha验证码的使用与对比-运用到前端" class="headerlink" title="Kaptcha验证码的使用与对比 [运用到前端]"></a>Kaptcha验证码的使用与对比 [运用到前端]</h3><pre><code class="java">register.ftl
&lt;div class=&quot;col-4 p-0 pl-2 pt-0&quot;&gt;
   &lt;!-- 63.验证码图片 src要显示从服务器后台动态生成的验证码 KaptchaController生成的url粘贴在这里 64弄一个MemberController--&gt;
   &lt;img id=&quot;imgVerifyCode&quot; src=&quot;/verify_code&quot;
   style=&quot;width: 120px;height:50px;cursor: pointer&quot;&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/MemberController.java
package com.imooc.reader.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import java.util.HashMap;
import java.util.Map;

//64.嵌入验证码 65编写单机验证码刷新register.ftl中的function reloadVerifyCode()
@Controller
public class MemberController &#123;
    @GetMapping(&quot;/register.html&quot;)
    public ModelAndView showRegister() &#123;
        return new ModelAndView(&quot;/register&quot;);
    &#125;
    //67. 验证码匹配比对 request拿到对象  68编写会员服务MemberService.java
    @PostMapping(&quot;/registe&quot;)
    @ResponseBody
    public Map registe(String vc, String username, String password, String nickname, HttpServletRequest request)&#123;
        //接收kaptchaController.java中的request.getSession().setAttribute响应
        //正确验证码
        String verityCode  = (String)request.getSession().getAttribute(&quot;kaptchaVerifyCode&quot;);
        //验证码比对  后面的是大小写对比
        Map result = new HashMap();
        if (vc == null || verityCode == null || !vc.equalsIgnoreCase(verityCode))&#123;
            result.put(&quot;code&quot;,&quot;VC01&quot;);
            result.put(&quot;msg&quot;,&quot;验证码错误&quot;);
        &#125;else &#123;
            result.put(&quot;code&quot;,&quot;0&quot;);
            result.put(&quot;msg&quot;,&quot;success&quot;);
        &#125;
        return result;
    &#125;
&#125;
</code></pre>
<pre><code class="java">register.ftl
&lt;script&gt;
    //控制错误信息的显示与隐藏
    function showTips(isShow, css, text) &#123;
        if (isShow) &#123;
            $(&quot;#tips&quot;).removeClass(&quot;d-none&quot;)
            $(&quot;#tips&quot;).hide();
            $(&quot;#tips&quot;).addClass(css);
            $(&quot;#tips&quot;).text(text);
            $(&quot;#tips&quot;).fadeIn(200);
        &#125; else &#123;
            $(&quot;#tips&quot;).text(&quot;&quot;);
            $(&quot;#tips&quot;).fadeOut(200);
            $(&quot;#tips&quot;).removeClass();
            $(&quot;#tips&quot;).addClass(&quot;alert&quot;)
        &#125;
    &#125;
    //65.重新发送请求,刷新验证码 66验证码与后台绑定[比对校验]
    function reloadVerifyCode()&#123;
        //请在这里实现刷新验证码 ts timestamp是时间戳 增加时间戳取消缓存
        $(&quot;#imgVerifyCode&quot;).attr(&quot;src&quot;,&quot;/verify_code?ts=&quot; + new Date().getTime())
    &#125;
    
    //点击验证码图片刷新验证码
    $(&quot;#imgVerifyCode&quot;).click(function () &#123;
        reloadVerifyCode();
    &#125;);
    
    // 66.点击提交按钮,向/registe发起ajax请求
    //提交请求包含四个参数
    //vc:前台输入验证码  username:用户名 password:密码 nickname:昵称
    $(&quot;#btnSubmit&quot;).click(function () &#123;
        //表单校验
        var username = $.trim($(&quot;#username&quot;).val());
        var regex = /^.&#123;6,10&#125;$/;
        if (!regex.test(username)) &#123;
            showTips(true, &quot;alert-danger&quot;, &quot;用户名请输入正确格式（6-10位）&quot;);
            return;
        &#125; else &#123;
            showTips(false);
        &#125;

        var password = $.trim($(&quot;#password&quot;).val());

        if (!regex.test(password)) &#123;
            showTips(true, &quot;alert-danger&quot;, &quot;密码请输入正确格式（6-10位）&quot;);
            return;
        &#125; else &#123;
            showTips(false);
        &#125;

        $btnReg = $(this);

        $btnReg.text(&quot;正在处理...&quot;);
        $btnReg.attr(&quot;disabled&quot;, &quot;disabled&quot;);
        
        //66.发送ajax请求 67编写MemberController.java实现url
        $.ajax(&#123;
            url: &quot;/registe&quot;,
            type: &quot;post&quot;,
            dataType: &quot;json&quot;,
            data: $(&quot;#frmLogin&quot;).serialize(),
            success: function (data) &#123;
                //结果处理,根据服务器返回code判断服务器处理状态
                //服务器要求返回JSON格式:
                //&#123;&quot;code&quot;:&quot;0&quot;,&quot;msg&quot;:&quot;处理消息&quot;&#125;
                console.info(&quot;服务器响应:&quot; , data);
                if (data.code == &quot;0&quot;) &#123;
                    //显示注册成功对话框
                    $(&quot;#exampleModalCenter&quot;).modal(&#123;&#125;);
                    $(&quot;#exampleModalCenter&quot;).modal(&quot;show&quot;);
                &#125; else &#123;
                    //服务器校验异常,提示错误信息
                    showTips(true, &quot;alert-danger&quot;, data.msg);
                    reloadVerifyCode();
                    $btnReg.text(&quot;注    册&quot;);
                    $btnReg.removeAttr(&quot;disabled&quot;);
                &#125;
            &#125;
        &#125;);
        return false;
    &#125;);
&lt;/script&gt;
============================
67在上面MemberController.java
</code></pre>
<h3 id="实现会员注册功能"><a href="#实现会员注册功能" class="headerlink" title="实现会员注册功能"></a>实现会员注册功能</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/mask_boys/article/details/118273990">500 (Internal Server Error)_谷歌浏览器 internal server error-CSDN博客</a></p>
<pre><code class="java">com/imooc/reader/service/MemberService.java
package com.imooc.reader.service;

import com.imooc.reader.entity.Member;
//68.创建一个实现类MemberServiceImpl.java[Alt + Enter]
public interface MemberService &#123;
    /**
     * 会员注册,创建新会员
     * @param username
     * @param password
     * @param nickname
     * @return
     */
    public Member createMember(String username, String password, String nickname);
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/service/exception.java
package com.imooc.reader.service.exception;

/**
 * 68.业务逻辑异常 回到MemberServiceImpl编写用户名异常 69返回MemberServiceImpl
 */
public class BussinessException extends RuntimeException&#123;
    private String code;
    private String msg;

    //构造方法
    public BussinessException(String code, String msg) &#123;
        super(msg); //继承自运行时异常
        this.code = code;
        this.msg = msg;
    &#125;

    public String getCode() &#123;
        return code;
    &#125;

    public void setCode(String code) &#123;
        this.code = code;
    &#125;

    public String getMsg() &#123;
        return msg;
    &#125;

    public void setMsg(String msg) &#123;
        this.msg = msg;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/utils/MD5Utils.java
package com.imooc.reader.utils;

import org.apache.commons.codec.digest.DigestUtils;
//70.生成MD5方法 返回MemberServiceImpl编写随机数
public class MD5Utils &#123;
    public static String md5Digest(String source, Integer salt)&#123;
        char[] ca = source.toCharArray();//获取字符数组
        for (int i = 0; i &lt; ca.length; i++) &#123;
            ca[i] = (char) (ca[i] + salt);
        &#125;
        String target = new String(ca);
        String md5 = DigestUtils.md5Hex(target);
        return md5;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/MemberServiceImpl.java
package com.imooc.reader.service.impl;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.imooc.reader.entity.Member;
import com.imooc.reader.mapper.MemberMapper;
import com.imooc.reader.service.exception.BussinessException;
import com.imooc.reader.service.MemberService;
import com.imooc.reader.utils.MD5Utils;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import javax.annotation.Resource;
import java.util.Date;
import java.util.List;
import java.util.Random;

//68.完成与会员的交互[写操作居多] 完成运行异常service/BussinessException.java
@Service(&quot;memberService&quot;)
@Transactional
public class MemberServiceImpl implements MemberService &#123;
    @Resource
    private MemberMapper memberMapper;

    /**
     * 会员注册,创建新会员
     *
     * @param username 用户名
     * @param password 密码
     * @param nickname 昵称
     * @return 新会员对象
     */
    public Member createMember(String username, String password, String nickname) &#123;
        QueryWrapper&lt;Member&gt; queryWrapper = new QueryWrapper&lt;Member&gt;();
        queryWrapper.eq(&quot;username&quot;, username);
        List&lt;Member&gt; memberList = memberMapper.selectList(queryWrapper);
        //判断用户名是否已存在 68定义一个异常BussinessException.java
        //69.续写异常  70增加加密组件pom.xml
        if (memberList.size() &gt; 0) &#123;
            throw new BussinessException(&quot;M01&quot;, &quot;用户名已存在&quot;);
        &#125;
        Member member = new Member();
        member.setUsername(username);
        member.setNickname(nickname);
        //70. 随机数md5  71生成测试用例MemberServiceImplTest
        int salt = new Random().nextInt(1000)+1000; //盐值
        String md5 = MD5Utils.md5Digest(password, salt);
        member.setPassword(md5);
        member.setSalt(salt);
        member.setCreateTime(new Date()); //创建时间
        memberMapper.insert(member);
        return member;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/MemberServiceImplTest.java
package com.imooc.reader.service.impl;

import com.imooc.reader.service.MemberService;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import javax.annotation.Resource;

//71.生成测试用例 72MemberController后续的工作
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = &#123;&quot;classpath:applicationContext.xml&quot;&#125;)
public class MemberServiceImplTest &#123;
    @Resource
    private MemberService memberService;
    @Test
    public void createMember() &#123;
        memberService.createMember(&quot;s123457&quot;, &quot;123456&quot;, &quot;测试&quot;);
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/MemberController.java
package com.imooc.reader.controller;

import com.imooc.reader.service.exception.BussinessException;
import com.imooc.reader.service.MemberService;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import java.util.HashMap;
import java.util.Map;

//64.嵌入验证码 65编写单机验证码刷新register.ftl中的function reloadVerifyCode()
@Controller
public class MemberController &#123;
    //72后续工作 进行注入
    @Resource
    private MemberService memberService;

    @GetMapping(&quot;/register.html&quot;)
    public ModelAndView showRegister() &#123;
        return new ModelAndView(&quot;/register&quot;);
    &#125;

    //67. 验证码匹配比对 request拿到对象  68编写会员服务MemberService.java
    @PostMapping(&quot;/registe&quot;)
    @ResponseBody
    public Map registe(String vc, String username, String password, String nickname, HttpServletRequest request) &#123;
        //接收kaptchaController.java中的request.getSession().setAttribute响应
        //正确验证码
        String verityCode = (String) request.getSession().getAttribute(&quot;kaptchaVerifyCode&quot;);
        //验证码比对  后面的是大小写对比
        Map result = new HashMap();
        if (vc == null || verityCode == null || !vc.equalsIgnoreCase(verityCode)) &#123;
            result.put(&quot;code&quot;, &quot;VC01&quot;);
            result.put(&quot;msg&quot;, &quot;验证码错误&quot;);
        &#125; else &#123;
            //72.调用过程  73将登录页复制进去 74MemberServiceImpl
            try &#123;
                memberService.createMember(username, password, nickname);
                result.put(&quot;code&quot;, &quot;0&quot;);
                result.put(&quot;msg&quot;, &quot;success&quot;);
            &#125; catch (BussinessException ex) &#123;
                ex.printStackTrace();
                result.put(&quot;code&quot;, ex.getCode());
                result.put(&quot;msg&quot;, ex.getMsg());
            &#125;
        &#125;
        return result;
    &#125;
&#125;
http://localhost/register.html
</code></pre>
<h3 id="实现会员登录功能"><a href="#实现会员登录功能" class="headerlink" title="实现会员登录功能"></a>实现会员登录功能</h3><pre><code class="java"> com/imooc/reader/service/impl/MemberServiceImpl.java
 /**
     * 登陆检查
     * @param username 用户名
     * @param password 密码
     * @return 登录对象
     */
    //74.登录方法的接口实现 校验密码 75再续方法 MemberController.java
    public Member checkLogin(String username, String password) &#123;
        QueryWrapper&lt;Member&gt; queryWrapper = new QueryWrapper&lt;Member&gt;();
        queryWrapper.eq(&quot;username&quot;, username);
        Member member = memberMapper.selectOne(queryWrapper);
        if (member == null)&#123;
            throw new BussinessException(&quot;M02&quot;, &quot;用户不存在&quot;);
        &#125;//校验密码
        String md5 = MD5Utils.md5Digest(password, member.getSalt());
        if (!md5.equals(member.getPassword()))&#123;
            throw new BussinessException(&quot;M03&quot;, &quot;输入密码有误&quot;);
        &#125;
        return member;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/MemberController.java
// 75.HttpSession session 登录校验后会将这个会员信息存放到session中
    // 76登录校验成功以后会返回一个member对象 存放在session中
    @PostMapping(&quot;/check_login&quot;) //前台url
    @ResponseBody
    public Map checkLogin(String username, String password, String vc, HttpSession session)&#123;
        //正确验证码                     ↓为了得到session对象
        String verityCode = (String)session.getAttribute(&quot;kaptchaVerifyCode&quot;);
        //验证码比对  后面的是大小写对比
        Map result = new HashMap();
        if (vc == null || verityCode == null || !vc.equalsIgnoreCase(verityCode)) &#123;
            result.put(&quot;code&quot;, &quot;VC01&quot;);
            result.put(&quot;msg&quot;, &quot;验证码错误&quot;);
        &#125;else &#123;
            try &#123;//处理成功
                Member member = memberService.checkLogin(username, password);
                //76.member存放在session中  77去index.ftl下方登录块改造
                session.setAttribute(&quot;loginMember&quot;,member);
                result.put(&quot;code&quot;, &quot;0&quot;);
                result.put(&quot;msg&quot;, &quot;success&quot;);
            &#125; catch (BussinessException ex) &#123; //处理失败
                ex.printStackTrace();
                result.put(&quot;code&quot;, ex.getCode());
                result.put(&quot;msg&quot;, ex.getMsg());
            &#125;
        &#125;
        return result;
    &#125;
</code></pre>
<pre><code class="java">index.ftl 
&lt;#--   77.将获取到的member的session数据替换成登录右上角的动态数据--&gt;
  &lt;#--  两个问号代表前面的属性是存在的情况下输出其中的html --&gt;
&lt;#-- 78新增entity/MemberReadState.java会员阅读状态 --&gt;
        &lt;#if loginMember??&gt;
            &lt;h6 class=&quot;mt-1&quot;&gt;
                &lt;img style=&quot;width: 2rem;margin-top: -5px&quot; class=&quot;mr-1&quot; src=&quot;./images/user_icon.png&quot;&gt;$&#123;loginMember.nickname&#125;
            &lt;/h6&gt;
            &lt;#else&gt; &lt;#--上面是已登录 下面是未登录--&gt;
                &lt;a href=&quot;/login.html&quot; class=&quot;btn btn-light btn-sm&quot;&gt;
                    &lt;img style=&quot;width: 2rem;margin-top: -5px&quot; class=&quot;mr-1&quot; src=&quot;./images/user_icon.png&quot;&gt;登录
                &lt;/a&gt;
        &lt;/#if&gt;
</code></pre>
<h3 id="获取会员阅读状态"><a href="#获取会员阅读状态" class="headerlink" title="获取会员阅读状态"></a>获取会员阅读状态</h3><h5 id="实现会员交互功能"><a href="#实现会员交互功能" class="headerlink" title="实现会员交互功能"></a>实现会员交互功能</h5><ul>
<li>想看&#x2F;看过的阅读状态变更</li>
<li>为图书写短评</li>
<li>为喜欢的短评点赞</li>
</ul>
<pre><code class="java">com/imooc/reader/entity/MemberReadState.java
package com.imooc.reader.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;

import java.util.Date;

/**
 * 会员阅读状态实体
 */
//78.搞实体 再去创MemberReadStateMapper.java接口
public class MemberReadState &#123;
    @TableId(type = IdType.AUTO)
    private Long rsId;
    private Long bookId;
    private Long memberId;
    private Integer readState;
    private Date createTime;
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/mapper/MemberReadStateMapper.java
package com.imooc.reader.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.imooc.reader.entity.MemberReadState;

//78接口创完 再去搞个Member_Read_State.xml
public interface MemberReadStateMapper extends BaseMapper&lt;MemberReadState&gt; &#123;
&#125;
</code></pre>
<pre><code class="java">mappers/member_read_state.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;com.imooc.reader.mapper.MemberReadStateMapper&quot;&gt;
&lt;!--  78. 去MemberService 阅读状态--&gt;
&lt;/mapper&gt;
</code></pre>
<pre><code class="java">com/imooc/reader/service/MemberService.java 
//78.获取阅读状态 再去实现这个方法

    /**
     * 获取阅读状态
     *
     * @param memberId 会员编号
     * @param bookId   图书编号
     * @return 阅读状态对象
     */
    public MemberReadState selectMemberReadState(Long memberId, Long bookId);
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/MemberServiceImpl.java
 //78.新增方法实现那个方法 再去上方进行方法注入 79根据会员编号进行查询BookController

    /**
     * 获取阅读状态
     * @param memberId 会员编号
     * @param bookId 图书编号
     * @return 阅读状态对象
     */
    public MemberReadState selectMemberReadState(Long memberId, Long bookId)&#123;
        QueryWrapper&lt;MemberReadState&gt; queryWrapper = new QueryWrapper();
        queryWrapper.eq(&quot;book_id&quot;, bookId);
        queryWrapper.eq(&quot;member_id&quot;, memberId);
        MemberReadState memberReadState = memberReadStateMapper.selectOne(queryWrapper);
        return memberReadState;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/BookController.java
//51.进行页面的绑定 获取读书编号 52把所有ftl相对路径改成绝对路径 ./前面的.删掉
    //加上了./就是  localhost/book/......   删掉就是 localhost/......
    //52更改detail.ftl将静态页面改成动态页面
    @GetMapping(&quot;/book/&#123;id&#125;&quot;) //↓ 路径变量 和 上面的保持一致
    //79.新增一个参数 获取当前用户登录信息
    public ModelAndView showDetail(@PathVariable(&quot;id&quot;) Long id, HttpSession session) &#123;
        Book book = bookService.selectById(id);
        //56.写完并放入 mav.addObject 57得到了对象就要去detail.ftl渲染循环遍历[写短评下方的div]
        List&lt;Evaluation&gt; evaluationList = evaluationService.selectByBookId(id);
        //79.将之前设置的用户信息拿出来 两种情况 ①会员没登录就null ②会员登录了member对象存在了 注入memberService
        Member member = (Member)session.getAttribute(&quot;loginMember&quot;);
        ModelAndView mav = new ModelAndView(&quot;/detail&quot;);
        if (member != null) &#123; //获取会员阅读状态    会员编号 图书编号  80 detail.ftl想看[1]与看过[2] 页面上方找script块
            MemberReadState memberReadState = memberService.selectMemberReadState(member.getMemberId(), id);
            mav.addObject(&quot;memberReadState&quot;, memberReadState);

        &#125;
        mav.addObject(&quot;book&quot;, book);
        mav.addObject(&quot;evaluationList&quot;, evaluationList);
        return mav;
    &#125;
</code></pre>
<pre><code class="java">detail.ftl
 &lt;script&gt;
        $.fn.raty.defaults.path = &#39;/resources/raty/lib/images&#39;;
        $(function () &#123;
            $(&quot;.stars&quot;).raty(&#123;readOnly: true&#125;);
        &#125;)
       // 80 想看与看过 freemark脚本 如果它存在(想看/看过) 81产生对应的状态数据 MemberService
        $(function () &#123;
            &lt;#if memberReadState ??&gt;
            // 重选阅读状态回填
            $(&quot;*[data-read-state=&#39;$&#123;memberReadState.readState&#125;&#39;]&quot;).addClass(&quot;highlight&quot;);
            &lt;/#if&gt;
            &lt;#if !loginMember ??&gt;
                $(&quot;*[data-read-state]&quot;).click(function () &#123;
                    // 利用jquery选择div的对话框函数 显示需要登录
                    $(&quot;#exampleModalCenter&quot;).modal(&quot;show&quot;);
                &#125;)
            &lt;/#if&gt;
        &#125;)
    &lt;/script&gt;
</code></pre>
<h3 id="更新会员阅读状态"><a href="#更新会员阅读状态" class="headerlink" title="更新会员阅读状态"></a>更新会员阅读状态</h3><pre><code class="java">com/imooc/reader/service/MemberService.java
 /**
     * 更新阅读状态
     * @param memberId 会员编号
     * @param bookId 图书编号
     * @param readState 阅读状态
     * @return 阅读对象状态
     */         //81定义方法 MemberServiceImpl实现状态
    public MemberReadState updateMemberReadState(Long memberId, Long bookId, Integer readState);
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/MemberServiceImpl.java
/**
 * 更新阅读状态
 * @param memberId 会员编号
 * @param bookId 图书编号
 * @param readState 阅读状态
 * @return 阅读对象状态
 */
//81.编写阅读状态代码 编写完打开MemberController
public MemberReadState updateMemberReadState(Long memberId, Long bookId, Integer readState)&#123;
    QueryWrapper&lt;MemberReadState&gt; queryWrapper = new QueryWrapper&lt;MemberReadState&gt;();
    queryWrapper.eq(&quot;book_id&quot;, bookId);
    queryWrapper.eq(&quot;member_id&quot;, memberId);
    MemberReadState memberReadState = memberReadStateMapper.selectOne(queryWrapper);
    //空的代表没有点过按钮 数据是空的
        //无则新增,有则更新
        if(memberReadState == null)&#123;
            memberReadState = new MemberReadState();
            memberReadState.setMemberId(memberId);
            memberReadState.setBookId(bookId);
            memberReadState.setReadState(readState);
            memberReadState.setCreateTime(new Date());
            memberReadStateMapper.insert(memberReadState);
        &#125;else&#123;
            memberReadState.setReadState(readState);
            memberReadStateMapper.updateById(memberReadState);
        &#125;

        return memberReadState;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/MemberController.java
//81. 完成更新状态的事务  82去完成detail.ftl后面的loginMember存在的代码
    @PostMapping(&quot;/update_read_state&quot;)
    @ResponseBody
    public Map updateReadState(Long memberId, Long bookId, Integer readState)&#123;
        Map result = new HashMap();
        try &#123;
            memberService.updateMemberReadState(memberId, bookId, readState);
            result.put(&quot;code&quot;, &quot;0&quot;);
            result.put(&quot;msg&quot;, &quot;success&quot;);
        &#125; catch (BussinessException ex) &#123;
            ex.printStackTrace();
            result.put(&quot;code&quot;, ex.getCode());
            result.put(&quot;msg&quot;, ex.getMsg());
        &#125;
        return result;
    &#125;
</code></pre>
<pre><code class="java">detail.ftl
//82 完成登录状态
            &lt;#if loginMember ??&gt;
            /**
             * 更新会员阅读状态
             */
            $(&quot;*[data-read-state]&quot;).click(function () &#123;
                //会员阅读状态
                var readState = $(this).data(&quot;read-state&quot;);
                //发送请求
                $.post(&quot;/update_read_state&quot;, &#123;
                    memberId: $&#123;loginMember.memberId&#125;,
                    bookId: $&#123;book.bookId&#125;,
                    readState: readState
                &#125;, function (json) &#123;
                    if (json.code == &quot;0&quot;) &#123; //服务器处理成功
                        $(&quot;*[data-read-state]&quot;).removeClass(&quot;highlight&quot;);//高亮的清除
                        $(&quot;*[data-read-state=&#39;&quot; + readState + &quot;&#39;]&quot;).addClass(&quot;highlight&quot;);//状态值放入其中
                    &#125;
                &#125;, &quot;json&quot;)
            &#125;);
            &lt;/#if&gt;
</code></pre>
<h3 id="实现写短评功能"><a href="#实现写短评功能" class="headerlink" title="实现写短评功能"></a>实现写短评功能</h3><pre><code class="java">detail.ftl
 //83.短评功能  下面短评联动现象
            $(&quot;#btnEvaluation&quot;).click(function () &#123;
                // 选中id＝score的标签 转换为星型组件
                $(&quot;#score&quot;).raty(&#123;&#125;);
                $(&quot;#dlgEvaluation&quot;).modal(&quot;show&quot;);//显示短评对话框
            &#125;)
---------------------------------------------------------------
&lt;!-- Modal --&gt;
&lt;div class=&quot;modal-content&quot;&gt;
            &lt;div class=&quot;modal-body&quot;&gt;
&lt;#-- 83. 短评联动   84 MemberService.java 短评实现代码 --&gt;
                &lt;h6&gt;为$&#123;book.bookName&#125;写短评&lt;/h6&gt;
                &lt;form id=&quot;frmEvaluation&quot;&gt;
                    &lt;div class=&quot;input-group  mt-2 &quot;&gt;
                        &lt;span id=&quot;score&quot;&gt;&lt;/span&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;input-group  mt-2 &quot;&gt;
                        &lt;input type=&quot;text&quot; id=&quot;content&quot; name=&quot;content&quot; class=&quot;form-control p-4&quot;
                               placeholder=&quot;这里输入短评&quot;&gt;
                    &lt;/div&gt;
                &lt;/form&gt;
            &lt;/div&gt;
            &lt;div class=&quot;modal-footer&quot;&gt;
                &lt;button type=&quot;button&quot; id=&quot;btnSubmit&quot; class=&quot;btn btn-primary&quot;&gt;提交&lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
</code></pre>
<pre><code class="java">com/imooc/reader/service/MemberService.java
//84.短评代码!  MemberServiceImpl 组一个全新的对象
    public Evaluation evaluate(Long memberId, Long bookId, Integer score, String content);
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/MemberServiceImpl.java
/**
     * 发布新的短评
     * @param memberId 会员编号
     * @param bookId 图书编号
     * @param score 评分
     * @param content 短评内容
     * @return
     */ // 84 完成评论信息的更新 85在MemberController编写与web交互功能
    public Evaluation evaluate(Long memberId, Long bookId, Integer score, String content) &#123;
        Evaluation evaluation = new Evaluation();
        evaluation.setMemberId(memberId);
        evaluation.setBookId(bookId);
        evaluation.setScore(score);
        evaluation.setContent(content);
        evaluation.setCreateTime(new Date());
        evaluation.setState(&quot;enable&quot;);
        evaluation.setEnjoy(0); //注入evaluationMapper 完成数据新增
        evaluationMapper.insert(evaluation);
        return evaluation;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/MemberController.java
//85.与web交互功能 前台请求传入数据 86回到detail.ftl写
    @PostMapping(&quot;/evaluate&quot;)
    @ResponseBody
    public Map evaluate(Long memberId, Long bookId, Integer score, String content)&#123;
        Map result = new HashMap();
        try &#123;
//    Evaluation eva = memberService.evaluate(memberId, bookId, score, content);
            memberService.evaluate(memberId, bookId, score, content);
            result.put(&quot;code&quot;, &quot;0&quot;);
            result.put(&quot;msg&quot;, &quot;success&quot;);
//          result.put(&quot;evaluation&quot;, eva);
        &#125; catch (BussinessException ex) &#123;
            ex.printStackTrace();
            result.put(&quot;code&quot;, ex.getCode());
            result.put(&quot;msg&quot;, ex.getMsg());
        &#125;
        return result;
    &#125;
</code></pre>
<pre><code class="java">detail.ftl
//86.评论对话框提交数据  87完成点赞核心实现 MemberService
            $(&quot;#btnSubmit&quot;).click(function () &#123;
                var score = $(&quot;#score&quot;).raty(&quot;score&quot;);//获取评分
                var content = $(&quot;#content&quot;).val();
                if (score == 0 || $.trim(content) == &quot;&quot;)&#123; //没有进行选择 或 删除前后空格
                    return; //禁止提交方法中断
                &#125;
                $.post(&quot;/evaluate&quot;,&#123;
                    score : score,
                    bookId: $&#123;book.bookId&#125;,
                    memberId: $&#123;loginMember.memberId&#125;,
                    content: content
                &#125;,function (json) &#123;
                    if (json.code == &quot;0&quot;) &#123;//处理成功
                        window.location.reload();//列表进行刷新
                    &#125;
                &#125;,&quot;json&quot;)
            &#125;)
</code></pre>
<h3 id="完成会员短评点赞核心实现"><a href="#完成会员短评点赞核心实现" class="headerlink" title="完成会员短评点赞核心实现"></a>完成会员短评点赞核心实现</h3><pre><code class="java">com/imooc/reader/service/MemberService.java
 /**
     * 短评点赞
     * @param evaluationId 短评编号
     * @return 短评对象
     */
//    87完成点赞核心实现 MemberServiceImpl
    public Evaluation enjoy(Long evaluationId);
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/MemberServiceImpl.java
// 87.短评点赞 自增+1 Membercontroller
    public Evaluation enjoy(Long evaluationId) &#123;
        Evaluation evaluation = evaluationMapper.selectById(evaluationId);
        evaluation.setEnjoy(evaluation.getEnjoy()+1);
        evaluationMapper.updateById(evaluation);
        return evaluation;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/MemberController.java
 //87.实现controller 88让客户端页面发送ajax请求
    @PostMapping(&quot;/enjoy&quot;)
    @ResponseBody
    public Map evaluate(Long evaluationId) &#123;
        Map result = new HashMap();
        try &#123;
//    Evaluation eva = memberService.evaluate(memberId, bookId, score, content);
            Evaluation eva = memberService.enjoy(evaluationId);
            result.put(&quot;code&quot;, &quot;0&quot;);
            result.put(&quot;msg&quot;, &quot;success&quot;);
            result.put(&quot;evaluation&quot;, eva); //包含最新点赞数
        &#125; catch (BussinessException ex) &#123;
            ex.printStackTrace();
            result.put(&quot;code&quot;, ex.getCode());
            result.put(&quot;msg&quot;, ex.getMsg());
        &#125;
        return result;
    &#125;
</code></pre>
<pre><code class="java">detail.ftl
// 88.评论点赞
            $(&quot;*[data-evaluation-id]&quot;).click(function()&#123;
                var evaluationId = $(this).data(&quot;evaluation-id&quot;);
                $.post(&quot;/enjoy&quot;,&#123;evaluationId:evaluationId&#125;,function(json)&#123;
                    if(json.code == &quot;0&quot;)&#123;
                        $(&quot;*[data-evaluation-id=&#39;&quot; + evaluationId + &quot;&#39;] span&quot;).text(json.evaluation.enjoy);
                    &#125;
                &#125;,&quot;json&quot;)
            &#125;)
</code></pre>
<h3 id="Spring-Task定时任务-eg-闹钟命令"><a href="#Spring-Task定时任务-eg-闹钟命令" class="headerlink" title="Spring Task定时任务 [eg:  闹钟命令]"></a>Spring Task定时任务 [eg:  闹钟命令]</h3><ul>
<li>Spting Task 是 Spring 3.0后推出的定时任务模块</li>
<li>Spring Task的职责是按周期后台自动执行任务</li>
<li>Spring Task可利用Cron表达式实现灵活的定时处理</li>
</ul>
<h5 id="Cron表达式实例"><a href="#Cron表达式实例" class="headerlink" title="Cron表达式实例"></a>Cron表达式实例</h5><table>
<thead>
<tr>
<th align="center">秒</th>
<th align="center">分</th>
<th align="center">小时</th>
<th align="center">日</th>
<th align="center">月</th>
<th align="center">星期</th>
<th align="center">年</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">*</td>
<td align="center">*</td>
<td align="center">*</td>
<td align="center">*</td>
<td align="center">？</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">0,30</td>
<td align="center">0-5</td>
<td align="center">*</td>
<td align="center">*</td>
<td align="center">*</td>
<td align="center">?</td>
<td align="center">2000</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">9-18</td>
<td align="center">?</td>
<td align="center">*</td>
<td align="center">WED</td>
<td align="center"></td>
</tr>
</tbody></table>
<h5 id="利用Spring-Task自动计算图书评分-所有图书评价信息重算"><a href="#利用Spring-Task自动计算图书评分-所有图书评价信息重算" class="headerlink" title="利用Spring-Task自动计算图书评分 [所有图书评价信息重算]"></a>利用Spring-Task自动计算图书评分 [所有图书评价信息重算]</h5><pre><code class="java">mappers/book.xml
&lt;!--    89.增加平均评分增加信息  增加接口BookMapper --&gt;
    &lt;update id=&quot;updateEvaluation&quot;&gt;
        update book b SET evaluation_score = (
            select ifnull(avg(score),0) from evaluation where book_id = b.book_id and state=&#39;enable&#39;
        ),evaluation_quantity = (
            select ifnull(count(*),0) from evaluation where book_id = b.book_id and state=&#39;enable&#39;
        )
    &lt;/update&gt;
</code></pre>
<pre><code class="java">com/imooc/reader/mapper/BookMapper.java
package com.imooc.reader.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.imooc.reader.entity.Book;
//33.创建完Book接口  34与之对应的创建book.xml文件
//89. 更新图书评分  BookService去定义
public interface BookMapper extends BaseMapper&lt;Book&gt; &#123;
    /**
     * 更新图书评分/评价数量
     */
    public void updateEvaluation();
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/service/BookService.java
 /**
     * 更新图书评分/评价数量
     */
    //89. 定义完去impl定义实现类
    public void updateEvaluation();
&#125;
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/BookServiceImpl.java
/**
     * 更新图书评分/评价数量  Controller直接面向Service Service面向Mapper
     */
    //89. 更新操作需要声明式事务 开启  90applicationContext.xml开启task
    @Transactional
    public void updateEvaluation() &#123;
        bookMapper.updateEvaluation();
    &#125;
</code></pre>
<pre><code class="java">applicationContext.xml
&lt;!--  61.配置Kaptcha 的bean  62创造KaptchaController.java--&gt;
    &lt;bean id=&quot;KaptchaProducer&quot; class=&quot;com.google.code.kaptcha.impl.DefaultKaptcha&quot;&gt;
        &lt;property name=&quot;config&quot;&gt;
            &lt;bean class=&quot;com.google.code.kaptcha.util.Config&quot;&gt;
                &lt;constructor-arg&gt;
                    &lt;props&gt;
                        &lt;!-- 验证码图片不生成边框 --&gt;
                        &lt;prop key=&quot;kaptcha.border&quot;&gt;no&lt;/prop&gt;
                        &lt;!-- 验证码图片宽度为120像素  --&gt;
                        &lt;prop key=&quot;kaptcha.image.width&quot;&gt;120&lt;/prop&gt;
                        &lt;!-- 验证码图片字体颜色为蓝色  --&gt;
                        &lt;prop key=&quot;kaptcha.textproducer.font.color&quot;&gt;blue&lt;/prop&gt;
                        &lt;!-- 每个字符最大占用40像素  --&gt;
                        &lt;prop key=&quot;kaptcha.textproducer.font.size&quot;&gt;40&lt;/prop&gt;
                        &lt;!-- 验证码包含4个字符  --&gt;
                        &lt;prop key=&quot;kaptcha.textproducer.char.length&quot;&gt;4&lt;/prop&gt;
                    &lt;/props&gt;
                &lt;/constructor-arg&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
    &lt;!-- 90.开启Spring Task定时任务的注解模式 创建一个reader/task/ComputeTask.java--&gt;
    &lt;task:annotation-driven/&gt;
&lt;/beans&gt;
</code></pre>
<pre><code class="java">com/imooc/reader/task/ComputeTask.java
package com.imooc.reader.task;

import com.imooc.reader.service.BookService;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Component;

import javax.annotation.Resource;

//90.组件注解 不确定是哪个类 但是会被扫描实例化和管理
@Component
public class ComputeTask &#123;
    @Resource
    private BookService bookService;
//  每分钟0秒时候 执行一次Cron表达式
    @Scheduled(cron = &quot;0 * * * * ?&quot;)
    public void updateEvaluation()&#123;
        bookService.updateEvaluation();
        System.out.println(&quot;已更新所有图书评分&quot;);
    &#125;
&#125;
</code></pre>
<h3 id="后台管理功能-图书管理"><a href="#后台管理功能-图书管理" class="headerlink" title="后台管理功能-图书管理"></a>后台管理功能-图书管理</h3><h5 id="富文本编辑器wangEditor使用入门"><a href="#富文本编辑器wangEditor使用入门" class="headerlink" title="富文本编辑器wangEditor使用入门"></a>富文本编辑器<code>wangEditor</code>使用入门</h5><ul>
<li>基于Javascript与css开发的Web富文本编辑器</li>
</ul>
<pre><code class="java">test.ftl
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Title&lt;/title&gt;
    &lt;!-- 91.引入wangEditor  创建WEB-INF/ftl/management/book.ftl--&gt;
    &lt;script src=&quot;/resources/wangEditor.min.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div&gt;
    &lt;button id=&quot;btnRead&quot;&gt;读取内容&lt;/button&gt;
    &lt;button id=&quot;btnWrite&quot;&gt;写入内容&lt;/button&gt;
&lt;/div&gt;
&lt;div id=&quot;divEditor&quot; style=&quot;width: 800px;height:600px&quot;&gt;&lt;/div&gt;
&lt;script&gt;
    var E = window.wangEditor;
    var editor = new E(&quot;#divEditor&quot;);//完成富文本编辑器初始化
    editor.create();//创建富文本编辑器,显示在页面上
    document.getElementById(&quot;btnRead&quot;).onclick = function()&#123;
        var content = editor.txt.html();//获取编辑器现有的html内容
        alert(content);
    &#125;
    document.getElementById(&quot;btnWrite&quot;).onclick = function()&#123;
        var content = &quot;&lt;li style=&#39;color:red&#39;&gt;我是&lt;b&gt;新内容&lt;/b&gt;&lt;/li&gt;&quot;;
        editor.txt.html(content);
    &#125;
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="实现图书管理功能"><a href="#实现图书管理功能" class="headerlink" title="实现图书管理功能"></a>实现图书管理功能</h3><h6 id="在训练素材中导入图书管理页"><a href="#在训练素材中导入图书管理页" class="headerlink" title="在训练素材中导入图书管理页"></a>在训练素材中导入图书管理页</h6><pre><code class="java">book.ftl
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;#-- 91.创建后台图书管理控制器com/imooc/reader/controller/management/MBookController.java   --&gt;
    &lt;title&gt;图书管理功能&lt;/title&gt;
    &lt;style&gt;
        #dlgBook&#123;
            padding: 10px
        &#125;
    &lt;/style&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;/resources/layui/css/layui.css&quot;&gt;

    &lt;script src=&quot;/resources/wangEditor.min.js&quot;&gt;&lt;/script&gt;


    &lt;script type=&quot;text/html&quot; id=&quot;toolbar&quot;&gt;
        &lt;div class=&quot;layui-btn-container&quot;&gt;
            &lt;button class=&quot;layui-btn layui-btn-sm&quot; id=&quot;btnAdd&quot; onclick=&quot;showCreate()&quot;&gt;添加&lt;/button&gt;
        &lt;/div&gt;
    &lt;/script&gt;

&lt;/head&gt;
&lt;body&gt;


&lt;div class=&quot;layui-container&quot;&gt;
    &lt;blockquote class=&quot;layui-elem-quote&quot;&gt;图书列表&lt;/blockquote&gt;
    &lt;!-- 数据表格 --&gt;
    &lt;table id=&quot;grdBook&quot; lay-filter=&quot;grdBook&quot;&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;!--表单内容--&gt;
&lt;div id=&quot;dialog&quot; style=&quot;padding: 10px;display: none&quot;&gt;
    &lt;form class=&quot;layui-form&quot; &gt;
        &lt;div class=&quot;layui-form-item&quot;&gt;
            &lt;!-- 图书类别 --&gt;
            &lt;select id=&quot;categoryId&quot; name=&quot;categoryId&quot; lay-verify=&quot;required&quot; lay-filter=
            &quot;categoryId&quot;&gt;
                &lt;option value=&quot;&quot;&gt;&lt;/option&gt;
                &lt;option value=&quot;1&quot;&gt;前端&lt;/option&gt;
                &lt;option value=&quot;2&quot;&gt;后端&lt;/option&gt;
                &lt;option value=&quot;3&quot;&gt;测试&lt;/option&gt;
                &lt;option value=&quot;4&quot;&gt;产品&lt;/option&gt;
            &lt;/select&gt;

        &lt;/div&gt;
        &lt;div class=&quot;layui-form-item&quot;&gt;
            &lt;!-- 书名 --&gt;
            &lt;input type=&quot;text&quot; id=&quot;bookName&quot; name=&quot;bookName&quot; required lay-verify=&quot;required&quot; placeholder=&quot;请输入书名&quot;
                   autocomplete=&quot;off&quot; class=&quot;layui-input&quot;&gt;
        &lt;/div&gt;


        &lt;div class=&quot;layui-form-item&quot;&gt;
            &lt;!-- 子标题 --&gt;
            &lt;input type=&quot;text&quot; id=&quot;subTitle&quot; name=&quot;subTitle&quot; required lay-verify=&quot;required&quot; placeholder=&quot;请输入子标题&quot;
                   autocomplete=&quot;off&quot; class=&quot;layui-input&quot;&gt;
        &lt;/div&gt;

        &lt;div class=&quot;layui-form-item&quot;&gt;
            &lt;!-- 作者 --&gt;
            &lt;input type=&quot;text&quot; id=&quot;author&quot; name=&quot;author&quot; required lay-verify=&quot;required&quot; placeholder=&quot;请输入作者信息&quot;
                   autocomplete=&quot;off&quot; class=&quot;layui-input&quot;&gt;
        &lt;/div&gt;

        &lt;div style=&quot;margin-top: 30px;font-size: 130%&quot;&gt;图书介绍(默认第一图将作为图书封面)&lt;/div&gt;
        &lt;div class=&quot;layui-form-item&quot; &gt;
            &lt;!-- wangEditor编辑器 --&gt;
            &lt;div id=&quot;editor&quot; style=&quot;width: 100%&quot;&gt;

            &lt;/div&gt;
        &lt;/div&gt;
        &lt;!-- 图书编号 --&gt;
        &lt;input id=&quot;bookId&quot; type=&quot;hidden&quot;&gt;
        &lt;!-- 当前表单操作类型,create代表新增 update代表修改 --&gt;
        &lt;input id=&quot;optype&quot;  type=&quot;hidden&quot;&gt;
        &lt;div class=&quot;layui-form-item&quot; style=&quot;text-align: center&quot;&gt;
            &lt;!-- 提交按钮 --&gt;
            &lt;button class=&quot;layui-btn&quot; lay-submit=&quot;&quot; lay-filter=&quot;btnSubmit&quot;&gt;立即提交&lt;/button&gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/div&gt;
&lt;script src=&quot;/resources/layui/layui.all.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;

    var table = layui.table; //table数据表格对象
    var $ = layui.$; //jQuery
    var editor = null; //wangEditor富文本编辑器对象
    //初始化图书列表
    table.render(&#123;
        elem: &#39;#grdBook&#39;  //指定div
        , id : &quot;bookList&quot; //数据表格id
        , toolbar: &quot;#toolbar&quot; //指定工具栏,包含新增添加
        , url: &quot;/management/book/list&quot; //数据接口
        , page: true //开启分页
        , cols: [[ //表头
            &#123;field: &#39;bookName&#39;, title: &#39;书名&#39;, width: &#39;300&#39;&#125;
            , &#123;field: &#39;subTitle&#39;, title: &#39;子标题&#39;, width: &#39;200&#39;&#125;
            , &#123;field: &#39;author&#39;, title: &#39;作者&#39;, width: &#39;200&#39;&#125;
            , &#123;type: &#39;space&#39;, title: &#39;操作&#39;, width: &#39;200&#39; , templet : function(d)&#123;
                    //为每一行表格数据生成&quot;修改&quot;与&quot;删除&quot;按钮,并附加data-id属性代表图书编号
                    return &quot;&lt;button class=&#39;layui-btn layui-btn-sm btn-update&#39;  data-id=&#39;&quot; + d.bookId + &quot;&#39; data-type=&#39;update&#39; onclick=&#39;showUpdate(this)&#39;&gt;修改&lt;/button&gt;&quot; +
                        &quot;&lt;button class=&#39;layui-btn layui-btn-sm btn-delete&#39;  data-id=&#39;&quot; + d.bookId + &quot;&#39;   onclick=&#39;showDelete(this)&#39;&gt;删除&lt;/button&gt;&quot;;
                &#125;
            &#125;
        ]]
    &#125;);
    //显示更新图书对话框
    //obj对应点击的&quot;修改&quot;按钮对象
    function showUpdate(obj)&#123;
        //弹出&quot;编辑图书&quot;对话框
        layui.layer.open(&#123;
            id: &quot;dlgBook&quot;, //指定div
            title: &quot;编辑图书&quot;, //标题
            type: 1, 
            content: $(&#39;#dialog&#39;).html(), //设置对话框内容,复制自dialog DIV
            area: [&#39;820px&#39;, &#39;730px&#39;], //设置对话框宽度高度
            resize: false //是否允许调整尺寸
        &#125;)

        var bookId = $(obj).data(&quot;id&quot;); //获取&quot;修改&quot;按钮附带的图书编号
        $(&quot;#dlgBook #bookId&quot;).val(bookId); //为表单隐藏域赋值,提交表单时用到

        editor = new wangEditor(&#39;#dlgBook #editor&#39;); //初始化富文本编辑器
        editor.customConfig.uploadImgServer = &#39;/management/book/upload&#39; //设置图片上传路径
        editor.customConfig.uploadFileName = &#39;img&#39;; //图片上传时的参数名
        editor.create(); //创建wangEditor
        $(&quot;#dlgBook #optype&quot;).val(&quot;update&quot;); //设置当前表单提交时提交至&quot;update&quot;更新地址

        //发送ajax请求,获取对应图书信息
        $.get(&quot;/management/book/id/&quot; + bookId , &#123;&#125; , function(json)&#123;
            //文本框回填已有数据
            $(&quot;#dlgBook #bookName&quot;).val(json.data.bookName);//书名
            $(&quot;#dlgBook #subTitle&quot;).val(json.data.subTitle); //子标题
            $(&quot;#dlgBook #author&quot;).val(json.data.author);//作者
            $(&quot;#dlgBook #categoryId&quot;).val(json.data.categoryId); //分类选项
            editor.txt.html(json.data.description); //设置图文内容
            layui.form.render();//重新渲染LayUI表单
        &#125; , &quot;json&quot;)



    &#125;
    //显示新增图书对话框
    function showCreate()&#123;
        //弹出&quot;新增图书&quot;对话框
        layui.layer.open(&#123;
            id: &quot;dlgBook&quot;,
            title: &quot;新增图书&quot;,
            type: 1,
            content: $(&#39;#dialog&#39;).html(),
            area: [&#39;820px&#39;, &#39;730px&#39;],
            resize: false
        &#125;)
        //初始化wangEditor
        editor = new wangEditor(&#39;#dlgBook #editor&#39;);
        editor.customConfig.uploadImgServer = &#39;/management/book/upload&#39;;//设置图片上传地址
        editor.customConfig.uploadFileName = &#39;img&#39;;//设置图片上传参数
        editor.create();//创建wangEditor

        layui.form.render(); //LayUI表单重新
        $(&quot;#dlgBook #optype&quot;).val(&quot;create&quot;);//设置当前表单提交时提交至&quot;create&quot;新增地址

    &#125;;

    //对话框表单提交
    layui.form.on(&#39;submit(btnSubmit)&#39;, function(data)&#123;
        //获取表单数据
        var formData = data.field;
        
        //判断是否包含至少一副图片,默认第一图作为封面显示
        var description = editor.txt.html();
        if(description.indexOf(&quot;img&quot;) == -1)&#123;
            layui.layer.msg(&#39;请放置一副图片作为封面&#39;);
            return false;
        &#125;
        //获取当前表单要提交的地址
        //如果是新增数据则提交至create
        //如果是更新数据则提交至update
        var optype = $(&quot;#dlgBook #optype&quot;).val();
        
        if(optype == &quot;update&quot;)&#123;
            //更新数据时,提交时需要附加图书编号
            formData.bookId=$(&quot;#dlgBook #bookId&quot;).val();
        &#125;
        //附加图书详细描述的图文html
        formData.description = description;
        //向服务器发送请求
        $.post(&quot;/management/book/&quot; + optype , formData , function(json)&#123;
            if(json.code==&quot;0&quot;)&#123;
                //处理成功,关闭对话框,刷新列表,提示操作成功
                layui.layer.closeAll();
                table.reload(&#39;bookList&#39;);
                layui.layer.msg(&#39;数据操作成功,图书列表已刷新&#39;);
            &#125;else&#123;
                //处理失败,提示错误信息
                layui.layer.msg(json.msg);
            &#125;
        &#125; ,&quot;json&quot;)
        return false;
    &#125;);
    //删除图书
    function showDelete(obj)&#123;
        //获取当前点击的删除按钮中包含的图书编号
        var bookId = $(obj).data(&quot;id&quot;);
        //利用layui的询问对话框进行确认
        layui.layer.confirm(&#39;确定要执行删除操作吗?&#39;, &#123;icon: 3, title:&#39;提示&#39;&#125;, function(index)&#123;
                    
                //确认按钮后发送ajax请求,包含图书编号
                $.get(&quot;/management/book/delete/&quot; + bookId, &#123;&#125;, function (json) &#123;
                    if(json.code==&quot;0&quot;)&#123;
                        //删除成功刷新表格
                        table.reload(&#39;bookList&#39;);
                        //提示操作成功
                        layui.layer.msg(&#39;数据操作成功,图书列表已刷新&#39;);
                        //关闭对话框
                        layui.layer.close(index);
                    &#125;else&#123;
                        //处理失败,提示错误信息
                        layui.layer.msg(json.msg);
                    &#125;
                &#125;, &quot;json&quot;);
            
        &#125;);

    &#125;

&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/management/MBookController.java
package com.imooc.reader.controller.management;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import java.io.File;
import java.io.IOException;
import java.net.MalformedURLException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;

//http://localhost/management/book/index.html
//91.后台管理系统 编写富文本编辑器的图片上传功能book.ftl已全实现
//editor.customConfig.uploadImgServer = &#39;/management/book/upload&#39;;//设置图片上传地址
//92提供文件上传地址的接口 pom.xml增加文件上传依赖 apache
@Controller
@RequestMapping(&quot;/management/book&quot;)
public class MBookController &#123;
    @GetMapping(&quot;/index.html&quot;)
    public ModelAndView showBook()&#123;
        return new ModelAndView(&quot;/management/book&quot;);
    &#125;

    /**
     * wangEditor文件上传
     * @param file 上传文件
     * @param request 原生请求对象
     * @return
     * @throws IOException
     */
    //93. 接收提交的文件 上传的文件保存到upload目录中 代码编写
    @PostMapping(&quot;/upload&quot;)
    @ResponseBody
    public Map upload(@RequestParam(&quot;img&quot;) MultipartFile file, HttpServletRequest request) throws IOException &#123;
        //得到上传目录
        String uploadPath = request.getServletContext().getResource(&quot;/&quot;).getPath() + &quot;/upload/&quot;;//在out里 运行时执行获取路径
        //文件名
        String fileName = new SimpleDateFormat(&quot;yyyyMMddHHmmssSSS&quot;).format(new Date());
        //原始文件扩展名
        String suffix = file.getOriginalFilename().substring(file.getOriginalFilename().lastIndexOf(&quot;.&quot;));//最后一次获得点
        //保存文件到upload目录
        file.transferTo(new File(uploadPath + fileName + suffix));
        Map result = new HashMap();
        result.put(&quot;errno&quot;, 0);
        result.put(&quot;data&quot;, new String[]&#123;&quot;/upload/&quot; + fileName + suffix&#125;);
        return result;
    &#125;
&#125;
</code></pre>
<pre><code class="xml">pom.xml
&lt;!-- 92.增加文件上传依赖 SpringMVC文件上传底层依赖 93去applicationContext.xml激活--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
            &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
            &lt;version&gt;1.4&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>
<pre><code class="xml">applicationContext.xml
&lt;!--  93.激活文件上传功能 回到MBookController--&gt;
    &lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;
        &lt;property name=&quot;defaultEncoding&quot; value=&quot;UTF-8&quot;/&gt;
    &lt;/bean&gt;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/management/MBookController.java
 /**
     * wangEditor文件上传
     * @param file 上传文件
     * @param request 原生请求对象
     * @return
     * @throws IOException
     */
    //93. 接收提交的文件 上传的文件保存到upload目录中 代码编写 94book.ftl对话框表单提交
    @PostMapping(&quot;/upload&quot;)
    @ResponseBody
    public Map upload(@RequestParam(&quot;img&quot;) MultipartFile file, HttpServletRequest request) throws IOException &#123;
        //得到上传目录
        String uploadPath = request.getServletContext().getResource(&quot;/&quot;).getPath() + &quot;/upload/&quot;;//在out里 运行时执行获取路径
        //文件名
        String fileName = new SimpleDateFormat(&quot;yyyyMMddHHmmssSSS&quot;).format(new Date());
        //原始文件扩展名
        String suffix = file.getOriginalFilename().substring(file.getOriginalFilename().lastIndexOf(&quot;.&quot;));//最后一次获得点
        //保存文件到upload目录
        file.transferTo(new File(uploadPath + fileName + suffix));
        Map result = new HashMap();
        result.put(&quot;errno&quot;, 0);
        result.put(&quot;data&quot;, new String[]&#123;&quot;/upload/&quot; + fileName + suffix&#125;);
        return result;
    &#125;
</code></pre>
<h3 id="实现图书新增功能"><a href="#实现图书新增功能" class="headerlink" title="实现图书新增功能"></a>实现图书新增功能</h3><pre><code class="java">book.ftl
// 94.对话框表单提交 95增加全新方法声明BookService
    layui.form.on(&#39;submit(btnSubmit)&#39;, function(data)&#123;
        //获取表单数据
        var formData = data.field;
        
        //判断是否包含至少一副图片,默认第一图作为封面显示
        var description = editor.txt.html();
        if(description.indexOf(&quot;img&quot;) == -1)&#123;
            layui.layer.msg(&#39;请放置一副图片作为封面&#39;);
            return false;
        &#125;
        //获取当前表单要提交的地址
        //如果是新增数据则提交至create
        //如果是更新数据则提交至update
        var optype = $(&quot;#dlgBook #optype&quot;).val();
        
        if(optype == &quot;update&quot;)&#123;
            //更新数据时,提交时需要附加图书编号
            formData.bookId=$(&quot;#dlgBook #bookId&quot;).val();
        &#125;
        //附加图书详细描述的图文html
        formData.description = description;
        //向服务器发送请求
        $.post(&quot;/management/book/&quot; + optype , formData , function(json)&#123;
            if(json.code==&quot;0&quot;)&#123;
                //处理成功,关闭对话框,刷新列表,提示操作成功
                layui.layer.closeAll();
                table.reload(&#39;bookList&#39;);
                layui.layer.msg(&#39;数据操作成功,图书列表已刷新&#39;);
            &#125;else&#123;
                //处理失败,提示错误信息
                layui.layer.msg(json.msg);
            &#125;
        &#125; ,&quot;json&quot;)
        return false;
    &#125;);
</code></pre>
<pre><code class="java">com/imooc/reader/service/BookService.java
 //95.创建新的图书 BookServiceImpl
    public Book createBook(Book book);
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/BookServiceImpl.java
 //95.数据增加 MBookController
    @Transactional
    public Book createBook(Book book) &#123;
        bookMapper.insert(book);
        return book;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/management/MBookController.java
//95.获取书籍数据
    @PostMapping(&quot;/create&quot;)
    @ResponseBody
    public Map createBook(Book book)&#123;
        Map result = new HashMap();
        try &#123;
            book.setEvaluationQuantity(0);
            book.setEvaluationScore(0f);
            Document doc = Jsoup.parse(book.getDescription()); //一个个片段被解析
            Element img = doc.select(&quot;img&quot;).first();//选中所有标签提取第一个 获取图书详情第一图的元素对象
            String cover = img.attr(&quot;src&quot;);//获取当前元素指定值
            book.setCover(cover); //95.来自于description描述的第一幅图
            //用html解析器jsoup.jorg从前台的描述里截取图片位置 96加入依赖
            bookService.createBook(book); //此处可以打点debug
            result.put(&quot;code&quot;, &quot;0&quot;);
            result.put(&quot;msg&quot;, &quot;success&quot;);
        &#125; catch (BussinessException ex) &#123;
            ex.printStackTrace();
            result.put(&quot;code&quot;, ex.getCode());
            result.put(&quot;msg&quot;, ex.getMsg());
        &#125;
        return result;
    &#125;
</code></pre>
<h3 id="实现图书分页查询-显示图书列表"><a href="#实现图书分页查询-显示图书列表" class="headerlink" title="实现图书分页查询[显示图书列表]"></a>实现图书分页查询[显示图书列表]</h3><pre><code class="java">com/imooc/reader/controller/management/MBookController.java
 //96.设计列表显示加载 97回到book.ftl
    @GetMapping(&quot;/list&quot;)
    @ResponseBody
    public Map list(Integer page, Integer limit)&#123;
        if (page == null)&#123;
            page = 1;
        &#125;
        if (limit == null)&#123;
            limit = 10;
        &#125;
        IPage&lt;Book&gt; pageObject = bookService.paging(null, null, page, limit);//返回paging的分页对象
        Map result = new HashMap();
        result.put(&quot;code&quot;, &quot;0&quot;);
        result.put(&quot;msg&quot;, &quot;success&quot;);
        //layUI返回值必须要求写的
        result.put(&quot;data&quot;, pageObject.getRecords()); //当前页面数据
        result.put(&quot;count&quot;, pageObject.getTotal()); //未分页时记录总数
        return result;
    &#125;
</code></pre>
<h3 id="实现图书修改更新功能-原有数据调整-回填数据"><a href="#实现图书修改更新功能-原有数据调整-回填数据" class="headerlink" title="实现图书修改更新功能 [原有数据调整 回填数据]"></a>实现图书修改更新功能 [原有数据调整 回填数据]</h3><pre><code class="java">book.ftl
// 94.对话框表单提交 95增加全新方法声明BookService
    layui.form.on(&#39;submit(btnSubmit)&#39;, function(data)&#123;
        //获取表单数据
        var formData = data.field;
        
        //判断是否包含至少一副图片,默认第一图作为封面显示
        var description = editor.txt.html();
        if(description.indexOf(&quot;img&quot;) == -1)&#123;
            layui.layer.msg(&#39;请放置一副图片作为封面&#39;);
            return false;
        &#125;
        //获取当前表单要提交的地址
        //如果是新增数据则提交至create
        //如果是更新数据则提交至update
        var optype = $(&quot;#dlgBook #optype&quot;).val();
     // 97.从隐藏域拿数据   98 MBookController
        if(optype == &quot;update&quot;)&#123;
            //更新数据时,提交时需要附加图书编号
            formData.bookId=$(&quot;#dlgBook #bookId&quot;).val();
        &#125;
        //附加图书详细描述的图文html
        formData.description = description;
        //向服务器发送请求
        $.post(&quot;/management/book/&quot; + optype , formData , function(json)&#123;
            if(json.code==&quot;0&quot;)&#123;
                //处理成功,关闭对话框,刷新列表,提示操作成功
                layui.layer.closeAll();
                table.reload(&#39;bookList&#39;);
                layui.layer.msg(&#39;数据操作成功,图书列表已刷新&#39;);
            &#125;else&#123;
                //处理失败,提示错误信息
                layui.layer.msg(json.msg);
            &#125;
        &#125; ,&quot;json&quot;)
        return false;
    &#125;);
</code></pre>
<pre><code class="java">com/imooc/reader/controller/management/MBookController.java
//98 前台ajax发送的格式保持一致 /managemet/book/id/ + bookId
    @GetMapping(&quot;/id/&#123;id&#125;&quot;)
    @ResponseBody
    public Map selectById(@PathVariable(&quot;id&quot;) Long bookId) &#123;
        Book book = bookService.selectById(bookId);
        Map result = new HashMap();
        result.put(&quot;code&quot;, &quot;0&quot;);
        result.put(&quot;msg&quot;, &quot;success&quot;);
        result.put(&quot;data&quot;, book); //服务器返回json.data book.ftl132行
        return result;
        //99 点击修改后的确认提交 增添更新操作 BookService.java
    &#125;
</code></pre>
<pre><code class="java">com/imooc/reader/service/BookService.java
/**
     * 更新图书
     * @param book 新图书数据
     * @return 更新后的数据
     */
    //99.创建新的更新 BookServiceImpl
    public Book updateBook(Book book);
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/BookServiceImpl.java
/**
     * 更新图书
     * @param book 新图书数据
     * @return 更新后的数据
     */
    //99.更新数据 100 MBookController
    @Transactional
    public Book updateBook(Book book) &#123;
        bookMapper.updateById(book);
        return null;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/management/MBookController.java
    /**
     * 更新图书数据
     * @param book
     * @return
     */
    //100. 更新代码 不要轻易对Book book数据直接更新 根据传入的book编号把数据库记录查出来
//101 删除方法BookService
    @PostMapping(&quot;/update&quot;)
    @ResponseBody
    public Map updateBook(Book book)&#123;
        Map result = new HashMap();
        try &#123;
            Book rawBook = bookService.selectById(book.getBookId());
            //通过前台数据获取
            rawBook.setBookName(book.getBookName());
            rawBook.setSubTitle(book.getSubTitle());
            rawBook.setAuthor(book.getAuthor());
            rawBook.setCategoryId(book.getCategoryId());
            rawBook.setDescription(book.getDescription());
            Document doc = Jsoup.parse(book.getDescription());
            String cover = doc.select(&quot;img&quot;).first().attr(&quot;src&quot;);
            rawBook.setCover(cover);
            bookService.updateBook(rawBook);
            result.put(&quot;code&quot;, &quot;0&quot;);
            result.put(&quot;msg&quot;, &quot;success&quot;);
        &#125; catch (BussinessException ex) &#123;
            ex.printStackTrace();
            result.put(&quot;code&quot;, ex.getCode()); ///成功时
            result.put(&quot;msg&quot;, ex.getMsg());//失败时
        &#125;
        return result;
    &#125;
</code></pre>
<h3 id="实现图书删除功能"><a href="#实现图书删除功能" class="headerlink" title="实现图书删除功能"></a>实现图书删除功能</h3><p><a target="_blank" rel="noopener" href="http://localhost/management/book/index.html">http://localhost/management/book/index.html</a><br><a target="_blank" rel="noopener" href="http://localhost/">http://localhost/</a></p>
<pre><code class="java">com/imooc/reader/service/BookService.java
 //101.删除方法 BookServiceImpl
    public void deleteBook(Long book);
</code></pre>
<pre><code class="java">com/imooc/reader/service/impl/BookServiceImpl.java
//101.删除相关数据 上面增加memberReadStateMapper evaluationMapper
    //一次性三个表删除 有声明式事务不会删一半 102 MBookController.java
    /**
     * 删除图书及其数据
     * @param bookId 图书编号
     */
    @Transactional
    public void deleteBook(Long bookId) &#123;
        bookMapper.deleteById(bookId);//单独删除id效率太低 写个构造器
        QueryWrapper&lt;MemberReadState&gt; mrsQueryWrapper = new QueryWrapper&lt;MemberReadState&gt;();
        mrsQueryWrapper.eq(&quot;book_id&quot;, bookId);
        memberReadStateMapper.delete(mrsQueryWrapper);
        QueryWrapper&lt;Evaluation&gt; evaluationQueryWrapper = new QueryWrapper&lt;Evaluation&gt;();
        evaluationQueryWrapper.eq(&quot;book_id&quot;, bookId);
        evaluationMapper.delete(evaluationQueryWrapper);
    &#125;
</code></pre>
<pre><code class="java">com/imooc/reader/controller/management/MBookController.java
//102. 封装 以及 code输出  103加入后台首页=&gt;index.ftl 后增加ManagementController
    @GetMapping(&quot;/delete/&#123;id&#125;&quot;)
    @ResponseBody
    public Map deleteBook(@PathVariable(&quot;id&quot;) Long bookId) &#123;
        Map result = new HashMap();
        try &#123;
            bookService.deleteBook(bookId);
            result.put(&quot;code&quot;, &quot;0&quot;);
            result.put(&quot;msg&quot;, &quot;success&quot;);
        &#125; catch (BussinessException ex) &#123;
            ex.printStackTrace();
            result.put(&quot;code&quot;, ex.getCode()); ///成功时
            result.put(&quot;msg&quot;, ex.getMsg());//失败时
        &#125;
        return result;
    &#125;
</code></pre>
<h5 id="增加后台框架"><a href="#增加后台框架" class="headerlink" title="增加后台框架"></a>增加后台框架</h5><p><a target="_blank" rel="noopener" href="http://localhost/management/index.html">慕课书评网数据管理系统</a></p>
<pre><code class="java">com/imooc/reader/controller/management/ManagementController.java
package com.imooc.reader.controller.management;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.ModelAndView;
//103.后台管理系统控制器 104 修改index.ftl的静态地址
/**
 * 后台管理系统控制器
 */
@Controller
@RequestMapping(&quot;/management&quot;) //功能启动后台所需
public class ManagementController &#123;
    @GetMapping(&quot;/index.html&quot;)
    public ModelAndView showIndex()&#123;
        return new ModelAndView(&quot;/management/index&quot;);
    &#125;
&#125;
</code></pre>
<pre><code class="java">index.ftl

&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;慕课书评网数据管理系统&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;/resources/layui/css/layui.css&quot;&gt;
&lt;/head&gt;

&lt;body class=&quot;layui-layout-body&quot;&gt;
&lt;!-- Layui后台布局CSS --&gt;
&lt;div class=&quot;layui-layout layui-layout-admin&quot;&gt;
    &lt;!--头部导航栏--&gt;
    &lt;div class=&quot;layui-header&quot;&gt;
        &lt;!--系统标题--&gt;
        &lt;div class=&quot;layui-logo&quot; style=&quot;font-size:18px&quot;&gt;慕课书评网数据管理系统&lt;/div&gt;
        &lt;!--右侧当前用户信息--&gt;
        &lt;ul class=&quot;layui-nav layui-layout-right&quot;&gt;
            &lt;li class=&quot;layui-nav-item&quot;&gt;
                &lt;a href=&quot;javascript:void(0)&quot;&gt;
                    &lt;!--图标--&gt;
                    &lt;span class=&quot;layui-icon layui-icon-user&quot; style=&quot;font-size: 20px&quot;&gt;
                    &lt;/span&gt;
                    &lt;!--用户信息--&gt;
                    admin
                &lt;/a&gt;
            &lt;/li&gt;
            &lt;!--注销按钮--&gt;
            &lt;li class=&quot;layui-nav-item&quot;&gt;&lt;a href=&quot;/management/logout&quot;&gt;注销&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
    &lt;!--左侧菜单栏--&gt;
    &lt;div class=&quot;layui-side layui-bg-black&quot;&gt;
        &lt;!--可滚动菜单--&gt;
        &lt;div class=&quot;layui-side-scroll&quot;&gt;
            &lt;!--可折叠导航栏--&gt;
            &lt;ul class=&quot;layui-nav layui-nav-tree&quot;&gt;


                    &lt;li class=&quot;layui-nav-item layui-nav-itemed&quot;&gt;
                        &lt;a href=&quot;javascript:void(0)&quot;&gt;数据管理&lt;/a&gt;
                        &lt;dl class=&quot;layui-nav-child module&quot; data-node-id=&quot;xxx&quot;&gt;
&lt;#--       104.静态地址改为动态地址--&gt;
                            &lt;dd&gt;&lt;a href=&quot;/management/book/index.html&quot; target=&quot;ifmMain&quot;&gt;图书管理&lt;/a&gt;&lt;/dd&gt;
                            &lt;dd&gt;&lt;a href=&quot;短评管理.html&quot; target=&quot;ifmMain&quot;&gt;短评管理
                                &lt;/a&gt;&lt;/dd&gt;
                        &lt;/dl&gt;
                    &lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;!--主体部分采用iframe嵌入其他页面--&gt;
    &lt;div class=&quot;layui-body&quot; style=&quot;overflow-y: hidden&quot;&gt;
        &lt;iframe name=&quot;ifmMain&quot; style=&quot;border: 0px;width: 100%;height: 100%&quot; src=&quot;/management/book/index.html&quot;&gt;&lt;/iframe&gt;
    &lt;/div&gt;
    &lt;!--版权信息--&gt;
    &lt;div class=&quot;layui-footer&quot;&gt;
        Copyright © imooc. All Rights Reserved.
    &lt;/div&gt;
&lt;/div&gt;
&lt;!--LayUI JS文件--&gt;
&lt;script src=&quot;/resources/layui/layui.all.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
    //将所有功能根据parent_id移动到指定模块下
    layui.$(&quot;.function&quot;).each(function () &#123;
        var func = layui.$(this);
        var parentId = func.data(&quot;parent-id&quot;);
        layui.$(&quot;dl[data-node-id=&quot; + parentId + &quot;]&quot;).append(func);
    &#125;);
    //刷新折叠菜单
    layui.element.render(&#39;nav&#39;);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

    </div>

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <div id="comment">
        <div id="gitalk-container">
        </div>
    </div>
    
</div>
                     
<footer id="footer">
    <div class="footer-wrap">
        <div>
            © 2018 - 2025 P-luminary
            <span class="footer-icon">
                <a-icon type="flag" theme="filled" /></span>
            @Asuna
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a>
<!--         & <a target="_blank" rel="noopener" href="https://github.com/korilin/hexo-theme-particle">Particle Theme</a></div> -->
        
    </div>

</footer>

<script src="/js/highlight.min.js"></script>
<script src="/js/particle.js"></script>
                </div>
            </div>
        </transition>
    </div>

    <script>
    new Vue({
        el: "#layout",
        data: {
            show_page: false,
            onload_menu: false,
            menu_show: false,
            card_top: 100
        },
        created: function () {
            var that = this
            window.onload = function () {
                that.show_page = true
                document.getElementById("loadcontent").style.opacity = 0
                setTimeout(function () {
                    document.getElementById("loadleft").style.width = 0
                    document.getElementById("loadright").style.width = 0
                }, 300)
                setTimeout(function () {
                    document.getElementById("loading").style = "display:none"
                }, 600)
            }
        },
        mounted: function () {
            var that = this
            window.addEventListener('scroll', function (e) {
                that.menu_show = false
            })
        },
        methods: {
            home_click: function () {
                window.scrollTo({
                    top: window.innerHeight - 80,
                    behavior: "smooth",
                });
            }
        }
    })
</script>

<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
    const gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'hexo-theme-particle',      // The repository of store comments,
        owner: 'P-luminary',
        admin: ['P-luminary'],
        language: 'en',
        id: location.pathname,      // Ensure uniqueness and length less than 50
        distractionFreeMode: true  // Facebook-like distraction free mode
    })
    gitalk.render('gitalk-container')
</script>

</body>

</html>