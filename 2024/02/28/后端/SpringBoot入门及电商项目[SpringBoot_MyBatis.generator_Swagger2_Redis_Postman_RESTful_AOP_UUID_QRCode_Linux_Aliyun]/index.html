
<!DOCTYPE html>
<html lang="zh_CH ">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P-luminary || SpringBoot入门及电商项目[SpringBoot_MyBatis.generator_Swagger2_Redis_Postman_RESTful_AOP_UUID_QRCode_Linux_Aliyun]</title>
    <meta name="author" content="Asuna">
    <meta name="description" content=" ">
    <meta name="keywords" content=" ">
    <link rel="icon" href="/https://raw.githubusercontent.com/P-luminary/images/master/data/asuna.jpg">
    <link rel="stylesheet" href="/css/antd.min.css">
    
    <link rel="stylesheet" href="/css/maiden-theme.css">
    
    <script src="/js/vue.js"></script>
    <script src="/js/antd.min.js"></script>
<meta name="generator" content="Hexo 6.1.0"></head>

<body>

    <div id="loading"
        style="height: 100vh; width: 100%; position: fixed;display: flex;z-index: 200; justify-content: space-between;">
        <div id="loadleft" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div id="loadright" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div
            style="position: fixed; height: 100vh; width: 100%;display: flex;justify-content: center;align-items: center;">
            <div id="loadcontent"
                style="width:400px;height:400px;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px#a3ddfb; text-align:center;opacity:1;transition:opacity 0.3s ease-out;">
                <div>
                    <h2>LOADING...</h2>
                    <p>加载过慢请开启缓存(浏览器默认开启)</p>
                    <div>
                        <img src="/dancingkitty.gif" alt="loading">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="layout">
        <transition name="into">
            <div v-show="show_page" style="display: none;">
                <div id="menu_show">
                     
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">P-luminary</span>
        </a>
        
        <a href="/">
            <span>
                <a-icon type="home" theme="filled" />
            </span>
            <span>home</span>
        </a>
        
        <a href="/tags/语法">
            <span>
                <a-icon type="tags" theme="filled" />
            </span>
            <span>tags</span>
        </a>
        
    </div>

    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div :class="'title'" @click="menu_show=!menu_show">
            <span style="margin-right: 10px;">
                <a-icon type="appstore" theme="filled" />
            </span>
            <span>P-luminary</span>
        </div>
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="home" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">home</div>
                </div>
            </a>
            
            <a href="/tags/语法">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="tags" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">tags</div>
                </div>
            </a>
            
        </div>
        <div class="curtain" v-show="menu_show"></div>
    </div>

</nav>
                </div>

                <div id="main">
                     
<link rel="stylesheet" href="/css/post-body.css">
<div class="article">
    <div>
        <h1>SpringBoot入门及电商项目[SpringBoot_MyBatis.generator_Swagger2_Redis_Postman_RESTful_AOP_UUID_QRCode_Linux_Aliyun] </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <a-icon type="calendar" theme="filled" />
            </span>
            2024/2/28
        </span>

        

        

        <span class="tags">
            <span class="icon">
                <a-icon type="tags" theme="filled" />
            </span>
            
            <span class="tag">
                
                <a href="/tags/后端" style=color:#879cff>
                    后端
                </a>
            </span>
            
        </span>
        
    </div>

    <div class="content" v-pre>
        <h1 id="Spring-Boot电商项目入门与实战"><a href="#Spring-Boot电商项目入门与实战" class="headerlink" title="Spring Boot电商项目入门与实战"></a>Spring Boot电商项目入门与实战</h1><ul>
<li>重量级的电商项目，前后端彻底分离</li>
<li>体验企业级开发流程：需求分析、设计、编码、测试、上线</li>
<li>用户管理、商品分析、商品管理、购物车、订单等核心功能</li>
<li>数据库的设计与实现</li>
<li>应用<strong>RESTful</strong>进行接口设计，并使用<strong>Postman</strong>进行接口测试</li>
<li>应用<strong>MyBatis generator</strong>代码自动生成插件，提升开发效率</li>
<li>使用阿里云完成项目的线上部署</li>
<li>使用<strong>Swagger2</strong>构建强大的API文档</li>
<li>使用<strong>Redis</strong>对商品分类信息进行缓存</li>
<li>使用<strong>JSR-303</strong>实现请求参数校验</li>
</ul>
<h2 id="Spring-Boot入门"><a href="#Spring-Boot入门" class="headerlink" title="Spring Boot入门"></a>Spring Boot入门</h2><h5 id="软件版本"><a href="#软件版本" class="headerlink" title="软件版本"></a>软件版本</h5><ul>
<li>Java 1.8.0</li>
<li>MySQL 8.0.12</li>
<li>Maven 3.3.9</li>
<li>Spring Boot 2.2.1(严格一致)</li>
</ul>
<h3 id="Spring-Boot诞生历史"><a href="#Spring-Boot诞生历史" class="headerlink" title="Spring Boot诞生历史"></a>Spring Boot诞生历史</h3><ul>
<li>Spring的缺点：配置过于繁琐</li>
<li>Spring Boot开发团队：Pivotal</li>
</ul>
<h3 id="Spring-Boot简介"><a href="#Spring-Boot简介" class="headerlink" title="Spring Boot简介"></a>Spring Boot简介</h3><ul>
<li>简化初始搭建以及开发过程</li>
<li>不再需要定义样板化的配置</li>
<li>快速应用开发领域</li>
</ul>
<h3 id="Spring、Spring-MVC、Spring-Boot"><a href="#Spring、Spring-MVC、Spring-Boot" class="headerlink" title="Spring、Spring MVC、Spring Boot"></a>Spring、Spring MVC、Spring Boot</h3><ul>
<li><strong>Spring</strong>最初利用IOC和AOP解耦</li>
<li>按照这种模式搞了MVC框架</li>
<li>写很多样板代码很麻烦，就有了<strong>Spring Boot</strong></li>
<li><strong>Spring Cloud</strong>是在Spring Boot基础上</li>
</ul>
<h3 id="Spring-Boot核心特点"><a href="#Spring-Boot核心特点" class="headerlink" title="Spring Boot核心特点"></a>Spring Boot核心特点</h3><ul>
<li>开箱即用</li>
<li>约定优于配置</li>
</ul>
<h3 id="Spring-Boot版本介绍"><a href="#Spring-Boot版本介绍" class="headerlink" title="Spring Boot版本介绍"></a>Spring Boot版本介绍</h3><ul>
<li>CURRENT             2.2.1 CURRENT GA [最新版本]</li>
<li>GA                         2.2.2 SNAPSHOT [GA&#x3D;General Availability 面向大众稳定版本 版本永恒不变]</li>
<li>SNAPSHOT          2.1.11 SNAPSHOT [快照 版本随时被修改]</li>
<li>如何选择版本？   <strong>2.1.10 GA</strong></li>
</ul>
<h3 id="新建Spring-Boot项目演示"><a href="#新建Spring-Boot项目演示" class="headerlink" title="新建Spring Boot项目演示"></a>新建Spring Boot项目演示</h3><ul>
<li>Spring官网 <strong><a target="_blank" rel="noopener" href="https://start.spring.io/">Spring Initializr</a></strong></li>
</ul>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/c9c72f61bc8fdb6d207a1221c3e2fb6ed9dcad81/data/%E6%96%B0%E5%BB%BASpringBoot%E9%A1%B9%E7%9B%AE%E6%BC%94%E7%A4%BA.jpg"></p>
<ul>
<li>IDEA集成的Spring Initializr</li>
</ul>
<h3 id="第一个接口开发"><a href="#第一个接口开发" class="headerlink" title="第一个接口开发"></a>第一个接口开发</h3><pre><code class="java">com/imooc/springbootlearn/SpringBootlearnApplication.java
package com.imooc.springbootlearn;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class SpringBootlearnApplication &#123;

    public static void main(String[] args) &#123;
        SpringApplication.run(SpringBootlearnApplication.class, args);
    &#125;

&#125;
</code></pre>
<pre><code class="java">com/imooc/springbootlearn/ParaController.java
package com.imooc.springbootlearn;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

/**
 * 演示各种传参形式
 */
@RestController
public class ParaController &#123;
    @GetMapping(&#123;&quot;/firstrequest&quot;&#125;)
    public String firstRequest()&#123;
        return &quot;第一个Spring Boot接口&quot;;
    &#125;
&#125;
</code></pre>
<pre><code class="xml">pom.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.1.1.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.imooc&lt;/groupId&gt;
    &lt;artifactId&gt;SpringBootlearn&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;SpringBootlearn&lt;/name&gt;
    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
                    &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre>
<h3 id="多种配置URL的方式"><a href="#多种配置URL的方式" class="headerlink" title="多种配置URL的方式"></a>多种配置URL的方式</h3><pre><code class="java">com/imooc/springbootlearn/ParaController.java
package com.imooc.springbootlearn;

import org.springframework.web.bind.annotation.*;

/**
 * 演示各种传参形式
 */
@RestController
@RequestMapping(&quot;/prefix&quot;)//统一增加公共前缀
public class ParaController &#123;
    @GetMapping(&#123;&quot;/firstrequest&quot;&#125;)
    public String firstRequest() &#123;
        return &quot;第一个Spring Boot接口&quot;;
    &#125;

    //@RequestParam 从请求中找到这个参数进行绑定
    @GetMapping(&#123;&quot;/requestpara&quot;&#125;)
    public String requestpara(@RequestParam Integer num) &#123;
        return &quot;para from request: &quot; + num;
    &#125;

    //@PathVariable 从URL中寻找对应的参数进行绑定
    @GetMapping(&#123;&quot;/para/&#123;num&#125;&quot;&#125;)
    public String pathpara(@PathVariable Integer num) &#123;
        return &quot;para from path: &quot; + num;
    &#125;

    //多URL的用法
    @GetMapping(&#123;&quot;/multiurl1&quot;, &quot;/multiurl2&quot;&#125;)
    public String multiurl(@RequestParam Integer num) &#123;
        return &quot;para from path: &quot; + num;
    &#125;

    //增加程序健壮性 不一定必须传值
    @GetMapping(&#123;&quot;/required&quot;&#125;)
    public String required(@RequestParam(required =
            false, defaultValue = &quot;0&quot;) Integer num) &#123;
        return &quot;para form request: &quot; + num;
    &#125;
&#125;
</code></pre>
<h3 id="Web项目的三层结构"><a href="#Web项目的三层结构" class="headerlink" title="Web项目的三层结构"></a>Web项目的三层结构</h3><ul>
<li><strong>Controller职责</strong>：对外暴露接口</li>
<li><strong>Service职责</strong>：复杂业务场景下对业务逻辑做一层抽象和封装，保持Controller的简洁和独立，抽象出来的Service可以被Controller重复调用。具体业务代码写在service层，Controller只做简单的逻辑判断</li>
<li><strong>DAO层职责</strong>：和数据相关的、增删改查数据库代码</li>
</ul>
<h3 id="配置文件简介"><a href="#配置文件简介" class="headerlink" title="配置文件简介"></a>配置文件简介</h3><ul>
<li><p><strong>properties</strong>：容器端口名、数据库信息、日志级别…</p>
<ul>
<li>environments.dev.url&#x3D;<a target="_blank" rel="noopener" href="http://imooc.com/">http://imooc.com</a></li>
<li>environments.dev.name&#x3D;Developer</li>
</ul>
</li>
<li><p><strong>yml</strong>：分层级，冒号后需要空格</p>
<ul>
<li>enviroments:<ul>
<li>dev:<ul>
<li>url: <a target="_blank" rel="noopener" href="http://imooc.com/">http://imooc.com</a></li>
<li>name: Developer</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>可以自动转换的网址：<a target="_blank" rel="noopener" href="https://www.toyaml.com/">在线yaml转properties-在线properties转yaml-ToYaml.com</a></p>
<pre><code class="java">Properties:
server.port=8081
server.servlet.context-path=/first
============================================================
YAML:
server:
  port: 8081
  servlet:
    context-path: /first
</code></pre>
<h3 id="进行自定义配置"><a href="#进行自定义配置" class="headerlink" title="进行自定义配置"></a>进行自定义配置</h3><p><strong>注解类</strong>配置载入数据[利用@Value注解]</p>
<pre><code class="java">com/imooc/springbootlearn/PropertiesController.java
package com.imooc.springbootlearn;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

/**
 * 演示读取配置的Controller
 */
@RestController
public class PropertiesController &#123;
    //用@Value将properties的设置值进行绑定
    @Value(&quot;$&#123;school.grade&#125;&quot;)
    Integer grade;
    @Value(&quot;$&#123;school.classnum&#125;&quot;)
    Integer classnum;
    @GetMapping(&quot;/gradeclass&quot;)
    public String gradeClass()&#123;
        return &quot;年级： &quot; + grade + &quot; 班级：&quot; + classnum;
    &#125;
&#125;
</code></pre>
<pre><code class="java">resoources/application.properties
#server.port=8081
##对于整个项目建立统一的前缀 http://127.0.0.1:8081/first/prefix/required
#server.servlet.context-path=/first
#school.方便分类
school.grade=3
school.classnum=6
</code></pre>
<p><strong>配置类</strong>文件配置载入数据</p>
<pre><code class="java">com/imooc/springbootlearn/SchoolConfig.java
package com.imooc.springbootlearn;

import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.stereotype.Component;

/**
 * School配置类
 */
@Component
@ConfigurationProperties(prefix = &quot;school&quot;)
public class SchoolConfig &#123;
    //自动去配置信息里寻找且绑定
    Integer grade;
    Integer classnum;

    public Integer getGrade() &#123;
        return grade;
    &#125;

    public void setGrade(Integer grade) &#123;
        this.grade = grade;
    &#125;

    public Integer getClassnum() &#123;
        return classnum;
    &#125;

    public void setClassnum(Integer classnum) &#123;
        this.classnum = classnum;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/springbootlearn/ConfigController.java
package com.imooc.springbootlearn;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

/**
 * 读取配置类
 */
@RestController
public class ConfigController &#123;
    @Autowired
    SchoolConfig schoolConfig;
    @GetMapping(&#123;&quot;/gradefromconfig&quot;&#125;)
    public String gradeclass()&#123;
        return &quot;年级： &quot; + schoolConfig.grade + &quot; 班级：&quot; + schoolConfig.classnum;

    &#125;
&#125;
</code></pre>
<h3 id="Service和Dao的编写"><a href="#Service和Dao的编写" class="headerlink" title="Service和Dao的编写"></a>Service和Dao的编写</h3><ul>
<li><h5 id="学生信息查询案例"><a href="#学生信息查询案例" class="headerlink" title="学生信息查询案例"></a>学生信息查询案例</h5></li>
</ul>
<pre><code class="java">com/imooc/springbootlearn/Student.java
package com.imooc.springbootlearn;

/**
 * 学生实体类
 */
public class Student &#123;
    Integer id;
    String name;

    @Override
    public String toString() &#123;
        return &quot;Student&#123;&quot; +
                &quot;id=&quot; + id +
                &quot;, name=&#39;&quot; + name + &#39;\&#39;&#39; +
                &#39;&#125;&#39;;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/springbootlearn/StudentController.java
package com.imooc.springbootlearn;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

/**
 * 学生Controller
 */
@RestController
public class StudentController &#123;
    @Autowired
    StudentService studentService;
    //服务层 去中转

    @GetMapping(&quot;/student&quot;)
    public String student(@RequestParam Integer num)&#123;
        Student student = studentService.findStudent(num);
        return student.toString();
    &#125;
&#125;
/*
联系
@Autowired和@Resource注解都是作为bean对象注入的时候使用的
两者都可以声明在字段和setter方法上
注意：如果声明在字段上，那么就不需要再写setter方法。但是本质上，该对象还是作为set方法的实参，通过执行set方法注入，只是省略了setter方法罢了

区别
@Autowired注解是Spring提供的，而@Resource注解是J2EE本身提供的
@Autowird注解默认通过byType方式注入，而@Resource注解默认通过byName方式注入
@Autowired注解注入的对象需要在IOC容器中存在，否则需要加上属性required=false，表示忽略当前要注入的bean，如果有直接注入，没有跳过，不会报错
*/
</code></pre>
<pre><code class="java">com/imooc/springbootlearn/StudentService.java
package com.imooc.springbootlearn;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

/**
 * 学生Service  之后调用mapper操作数据库[interface]
 */
@Service
public class StudentService &#123;
    @Autowired
    StudentMapper studentMapper;

    public Student findStudent(Integer id)&#123;
        return studentMapper.findById(id);
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/springbootlearn/StudentMapper.java 【接口】
package com.imooc.springbootlearn;

import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Select;
import org.springframework.stereotype.Repository;

/**
 * 学生Mapper
 */
@Mapper
@Repository
public interface StudentMapper &#123;
    @Select(&quot;select * from students where id = #&#123;id&#125;&quot;)
    Student findById(Integer id);
&#125;
</code></pre>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.1.1.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.imooc&lt;/groupId&gt;
    &lt;artifactId&gt;springbootlearn&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;SpringBootlearn&lt;/name&gt;
    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;2.1.1&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
                    &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre>
<pre><code class="java">com/imooc/springbootlearn/SpringBootlearnApplication.java
package com.imooc.springbootlearn;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication(scanBasePackages=&quot;com.imooc&quot;)
public class SpringBootlearnApplication &#123;
    public static void main(String[] args) &#123;
        SpringApplication.run(SpringBootlearnApplication.class, args);
    &#125;

&#125;
</code></pre>
<pre><code class="java">application.properties
#server.port=8081
#server.servlet.context-path=/first
school.grade=10
school.classnum=6

spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/test?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true
spring.datasource.username=root
spring.datasource.password=root
</code></pre>
<hr>
<hr>
<h1 id="SpringBoot电商项目"><a href="#SpringBoot电商项目" class="headerlink" title="SpringBoot电商项目"></a>SpringBoot电商项目</h1><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8083/#/index">慕慕生鲜前台</a><br><a target="_blank" rel="noopener" href="http://127.0.0.1:8083//admin/index.html#/login">慕慕生鲜后台</a></p>
<h3 id="课程整体介绍"><a href="#课程整体介绍" class="headerlink" title="课程整体介绍"></a>课程整体介绍</h3><ul>
<li>为什么要做电商项目</li>
<li>项目亮点以及功能模块介绍</li>
<li>项目演示</li>
<li>项目开发所需要工具准备</li>
<li>数据库设计与项目初始化</li>
<li>功能模块开发</li>
<li>阿里云部署</li>
<li>项目总结</li>
</ul>
<h3 id="项目亮点"><a href="#项目亮点" class="headerlink" title="项目亮点"></a>项目亮点</h3><ul>
<li>最新的业界的互联网企业的优质技术</li>
<li>代码规范简介，充分优化</li>
<li>流程完整、电商功能丰富</li>
<li>前后端彻底分离，符合未来趋势，学了就能用</li>
</ul>
<h3 id="功能模块介绍"><a href="#功能模块介绍" class="headerlink" title="功能模块介绍"></a>功能模块介绍</h3><ul>
<li><h4 id="项目功能："><a href="#项目功能：" class="headerlink" title="项目功能："></a>项目功能：</h4><ul>
<li><h5 id="前台-用户、商品分类、商品信息、购物车、订单"><a href="#前台-用户、商品分类、商品信息、购物车、订单" class="headerlink" title="前台  {用户、商品分类、商品信息、购物车、订单}"></a><span style = "color:red">前台  {用户、商品分类、商品信息、购物车、订单}</span></h5><ul>
<li><strong>用户模块</strong>{注册、登录、更新签名、身份认证、登出}</li>
<li><strong>商品分类模块</strong>{多级目录、递归查询、缓存}</li>
<li><strong>商品模块</strong>{商品搜索、商品排序、商品列表、目录展示、商品详情}</li>
<li><strong>购物车模块</strong>{加入商品、列表显示、数量更改、删除商品、勾选反选、全选全不选}</li>
<li><strong>订单模块</strong>{下单、订单流程、订单详情、取消订单、支付二维码、扫码支付、个人订单、确认收货}</li>
</ul>
</li>
<li><h5 id="后台-用户、商品分类、商品信息、订单"><a href="#后台-用户、商品分类、商品信息、订单" class="headerlink" title="后台  {用户、商品分类、商品信息、订单}"></a><span style = "color:red">后台  {用户、商品分类、商品信息、订单}</span></h5><ul>
<li><strong>管理员模块</strong>{登录登出、身份认证、安全限制}</li>
<li><strong>商品分类模块</strong>{分类列表、增加分类、修改分类、删除分类}</li>
<li><strong>商品模块</strong>{商品列表、新增商品、图片上传、更新删除、批量上下架}</li>
<li><strong>订单模块</strong>{订单列表、地址信息、发货、订单完结}</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="项目演示"><a href="#项目演示" class="headerlink" title="项目演示"></a>项目演示</h3><ul>
<li>前后端分离</li>
<li>接口文档</li>
<li>全栈、CTO</li>
<li>核心是接口的设计</li>
</ul>
<h3 id="项目开发所需工具准备"><a href="#项目开发所需工具准备" class="headerlink" title="项目开发所需工具准备"></a>项目开发所需工具准备</h3><ul>
<li><strong>IDEA</strong>常用优质插件介绍<ul>
<li>Maven Helper</li>
<li>Free MyBatis plugin [跳转&#x2F;识别mapper语法错误]</li>
</ul>
</li>
<li><strong>Postman</strong>安装和常用功能演示</li>
<li><strong>MySQL可视化工具</strong></li>
</ul>
<h3 id="数据库设计与项目初始化"><a href="#数据库设计与项目初始化" class="headerlink" title="数据库设计与项目初始化"></a>数据库设计与项目初始化</h3><ul>
<li>表设计</li>
<li>技术选型、思路</li>
<li>新建项目，整合Mybatis，跑通接口</li>
<li>引用log4j2日志组件</li>
<li>使用AOP统一处理Web请求日志 [请求的参数  返回的商品、字段]</li>
</ul>
<h3 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h3><ul>
<li>Spring Boot 2.2.1RELEASE</li>
<li>MyBatis 3.4.6(优点)</li>
<li>Maven 3.6.1</li>
</ul>
<h3 id="技术选型需要考虑的点"><a href="#技术选型需要考虑的点" class="headerlink" title="技术选型需要考虑的点"></a>技术选型需要考虑的点</h3><ul>
<li>选择你最熟悉的技术 [最好不要超过30%的新技术]</li>
<li>选择拥有强大社区支撑的开源技术</li>
<li>确保技术前进步伐</li>
<li>学会从业务端开始思考</li>
<li>重视经验</li>
</ul>
<h3 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h3><ul>
<li>新建项目</li>
<li>mybatis-generator的安装配置</li>
<li>自动生成DAO层文件</li>
<li>跑通接口</li>
</ul>
<p>【下方链接的主要问题就是 由于项目中的jdk和你实际安装的jdk不匹配】<br>{修改Project Structure → Project的版本}<br>{修改启动Edit的版本}<br>{修改setting→Build,Execution,Deployment→Compiler→Java Compiler中的<strong>Project version</strong>以及项目的<strong>Target version</strong>}</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44664231/article/details/131544077">【Java异常】完美解决this version of the Java Runtime only recognizes class file versions up to xx.0异常_java runtime (class file version 61.0), this versi-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_51970165/article/details/128242289">fileversion 55.0 this version of the Java Runtime only recognizes class file versions up to 52.0：已解决_class file version 55.0-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_54878983/article/details/134912368">彻底解决：IDEA java: 警告: 源发行版 17 需要目标发行版 17-CSDN博客</a></p>
<pre><code class="xml">generatorConfig.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE generatorConfiguration
  PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;
  &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;
&lt;generatorConfiguration&gt;
  &lt;!-- 配置文件，放在resource目录下即可 --&gt;
  &lt;!--数据库驱动个人配置--&gt;
  &lt;classPathEntry
    location=&quot;/Users/Pluminary/.m2/repository/mysql/mysql-connector-java/8.0.18/mysql-connector-java-8.0.18.jar&quot;/&gt;
  &lt;context id=&quot;MysqlTables&quot; targetRuntime=&quot;MyBatis3&quot;&gt;
    &lt;property name=&quot;autoDelimitKeywords&quot; value=&quot;true&quot;/&gt;
    &lt;!--可以使用``包括字段名，避免字段名与sql保留字冲突报错--&gt;
    &lt;property name=&quot;beginningDelimiter&quot; value=&quot;`&quot;/&gt;
    &lt;property name=&quot;endingDelimiter&quot; value=&quot;`&quot;/&gt;
    &lt;!-- optional，旨在创建class时，对注释进行控制 --&gt;
    &lt;commentGenerator&gt;
      &lt;property name=&quot;suppressDate&quot; value=&quot;true&quot;/&gt;
      &lt;property name=&quot;suppressAllComments&quot; value=&quot;true&quot;/&gt;
    &lt;/commentGenerator&gt;
    &lt;!--数据库链接地址账号密码--&gt;
    &lt;jdbcConnection driverClass=&quot;com.mysql.cj.jdbc.Driver&quot;
      connectionURL=&quot;jdbc:mysql://127.0.0.1:3306/imooc_mall?useUnicode=true&amp;amp;characterEncoding=UTF-8&amp;amp;zeroDateTimeBehavior=convertToNull&quot;
      userId=&quot;root&quot;
      password=&quot;root&quot;&gt;
      &lt;property name=&quot;nullCatalogMeansCurrent&quot; value=&quot;true&quot;/&gt;
    &lt;/jdbcConnection&gt;
    &lt;!-- 非必需，类型处理器，在数据库类型和java类型之间的转换控制--&gt;
    &lt;javaTypeResolver&gt;
      &lt;property name=&quot;forceBigDecimals&quot; value=&quot;false&quot;/&gt;
    &lt;/javaTypeResolver&gt;
    &lt;!--生成Model类存放位置--&gt;
    &lt;javaModelGenerator targetPackage=&quot;com.imooc.mall.model.pojo&quot;
      targetProject=&quot;src/main/java&quot;&gt;
      &lt;!-- 是否允许子包，即targetPackage.schemaName.tableName --&gt;
      &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt;
      &lt;!-- 是否对类CHAR类型的列的数据进行trim操作 --&gt;
      &lt;property name=&quot;trimStrings&quot; value=&quot;true&quot;/&gt;
      &lt;!-- 建立的Model对象是否 不可改变  即生成的Model对象不会有 setter方法，只有构造方法 --&gt;
      &lt;property name=&quot;immutable&quot; value=&quot;false&quot;/&gt;
    &lt;/javaModelGenerator&gt;
    &lt;!--生成mapper映射文件存放位置--&gt;
    &lt;sqlMapGenerator targetPackage=&quot;mappers&quot; targetProject=&quot;src/main/resources&quot;&gt;
      &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt;
    &lt;/sqlMapGenerator&gt;
    &lt;!--生成Dao类存放位置--&gt;
    &lt;javaClientGenerator type=&quot;XMLMAPPER&quot; targetPackage=&quot;com.imooc.mall.model.dao&quot;
      targetProject=&quot;src/main/java&quot;&gt;
      &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot;/&gt;
    &lt;/javaClientGenerator&gt;
    &lt;!--生成对应表及类名--&gt;
    &lt;table schema=&quot;root&quot; tableName=&quot;imooc_mall_cart&quot; domainObjectName=&quot;Cart&quot;
      enableCountByExample=&quot;false&quot;
      enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot;
      selectByExampleQueryId=&quot;false&quot;&gt;
    &lt;/table&gt;
    &lt;table tableName=&quot;imooc_mall_category&quot; domainObjectName=&quot;Category&quot; enableCountByExample=&quot;false&quot;
      enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot;
      selectByExampleQueryId=&quot;false&quot;&gt;
    &lt;/table&gt;
    &lt;table tableName=&quot;imooc_mall_order&quot; domainObjectName=&quot;Order&quot; enableCountByExample=&quot;false&quot;
      enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot;
      selectByExampleQueryId=&quot;false&quot;&gt;
    &lt;/table&gt;
    &lt;table tableName=&quot;imooc_mall_order_item&quot; domainObjectName=&quot;OrderItem&quot;
      enableCountByExample=&quot;false&quot;
      enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot;
      selectByExampleQueryId=&quot;false&quot;&gt;
    &lt;/table&gt;
    &lt;table tableName=&quot;imooc_mall_product&quot; domainObjectName=&quot;Product&quot; enableCountByExample=&quot;false&quot;
      enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot;
      selectByExampleQueryId=&quot;false&quot;&gt;
    &lt;/table&gt;
    &lt;table tableName=&quot;imooc_mall_user&quot; domainObjectName=&quot;User&quot; enableCountByExample=&quot;false&quot;
      enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot;
      selectByExampleQueryId=&quot;false&quot;&gt;
    &lt;/table&gt;

  &lt;/context&gt;
&lt;/generatorConfiguration&gt;
</code></pre>
<pre><code class="xml">application.properties
spring.datasource.name=imooc_mall_datasource
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://127.0.0.1:3306/imooc_mall?useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai
spring.datasource.username=root
spring.datasource.password=root
</code></pre>
<pre><code class="xml">pom.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.2.1.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.imooc&lt;/groupId&gt;
    &lt;artifactId&gt;mall&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;small&lt;/name&gt;
    &lt;description&gt;small&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;17&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;!--  1.依赖mysql-connector-java  mybatis-spring-boot-starter 加入generatorConfig.xml 写下面的Plugins--&gt;
&lt;!-- 2. 加入imooc_mall_local.sql后 点Maven -&gt; Plugins -&gt; mybatis-generator -&gt; 点击第一个 --&gt;
&lt;!--  通过插件生成 此时就出来了com/imooc/mall/model/dao里面所有的 和 com/imooc/mall/model/pojo里面所有的 和 mappers--&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;1.3.2&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;
                &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;1.3.7&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;verbose&gt;true&lt;/verbose&gt;
                    &lt;overwrite&gt;true&lt;/overwrite&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre>
<pre><code class="java">package com.imooc.mall.controller;

import com.imooc.mall.model.pojo.User;
import com.imooc.mall.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ResponseBody;

/**
 * 用户控制器
 */
@Controller
public class UserController &#123;
    //4.返回对象的基本信息 return里面会写和service相关的  5建立Service层
    @Autowired
    UserService userService;
    @GetMapping(&quot;/test&quot;)
    @ResponseBody //返回Json格式内容
    public User personalPage()&#123;
//  6.补全return 7告诉mapper在哪里怎么去找 去application.properties编写 mybatis.mapper-locations:......
//  去主类里编写@MapperScan(basePackages = &quot;com.imooc.mall.model.dao&quot;) 以防找不到mapper 8.去配置端口8083
//   9.加入log4j2.xml
        return userService.getUser();
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/UserService.java
package com.imooc.mall.service;

import com.imooc.mall.model.pojo.User;

//5.这是抽象的接口 还要让它实现 再创建一个impl 实现接口类 UserServiceImpl.java
public interface UserService &#123;
    User getUser();
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/UserServiceImpl.java
package com.imooc.mall.service.impl;

import com.imooc.mall.model.dao.UserMapper;
import com.imooc.mall.model.pojo.User;
import com.imooc.mall.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

/**
 * UserService实现类
 */
@Service
//5.重写里面的方法  @Autowired引入一个mapper去查询数据库返回真正的信息 6返回UserController补全return
public class UserServiceImpl implements UserService &#123;
    @Autowired
    UserMapper userMapper;

    @Override
    public User getUser()&#123;
        //通过主键来查询一个对象
        return userMapper.selectByPrimaryKey(1);
    &#125;
&#125;
</code></pre>
<pre><code class="java">package com.imooc.mall;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
@MapperScan(basePackages = &quot;com.imooc.mall.model.dao&quot;)
public class MallApplication &#123;
    public static void main(String[] args) &#123;
        SpringApplication.run(MallApplication.class, args);
    &#125;
&#125;
</code></pre>
<h3 id="log4j2日志"><a href="#log4j2日志" class="headerlink" title="log4j2日志"></a>log4j2日志</h3><ul>
<li>日志级别(优先级降低)：error, warn, info, debug, trace</li>
<li>排除Logback依赖</li>
</ul>
<pre><code class="xml">        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                    &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
</code></pre>
<pre><code class="xml">log4j2.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Configuration status=&quot;fatal&quot;&gt;
  &lt;Properties&gt;
    &lt;Property name=&quot;baseDir&quot; value=&quot;$&#123;sys:user.home&#125;/Desktop/idea_Space/logs&quot;/&gt;
  &lt;/Properties&gt;

  &lt;Appenders&gt;
    &lt;Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt;
      &lt;!--控制台只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch） --&gt;
      &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;ACCEPT&quot;
        onMismatch=&quot;DENY&quot;/&gt;
      &lt;PatternLayout
        pattern=&quot;[%d&#123;MM:dd HH:mm:ss.SSS&#125;] [%level] [%logger&#123;36&#125;] - %msg%n&quot;/&gt;
    &lt;/Console&gt;

    &lt;!--debug级别日志文件输出--&gt;
    &lt;RollingFile name=&quot;debug_appender&quot; fileName=&quot;$&#123;baseDir&#125;/debug.log&quot;
      filePattern=&quot;$&#123;baseDir&#125;/debug_%i.log.%d&#123;yyyy-MM-dd&#125;&quot;&gt;
      &lt;!-- 过滤器 --&gt;
      &lt;Filters&gt;
        &lt;!-- 限制日志级别在debug及以上在info以下 --&gt;
        &lt;ThresholdFilter level=&quot;debug&quot;/&gt;
        &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;DENY&quot; onMismatch=&quot;NEUTRAL&quot;/&gt;
      &lt;/Filters&gt;
      &lt;!-- 日志格式 --&gt;
      &lt;PatternLayout pattern=&quot;[%d&#123;HH:mm:ss:SSS&#125;] [%p] - %l - %m%n&quot;/&gt;
      &lt;!-- 策略 --&gt;
      &lt;Policies&gt;
        &lt;!-- 每隔一天转存 --&gt;
        &lt;TimeBasedTriggeringPolicy interval=&quot;1&quot; modulate=&quot;true&quot;/&gt;
        &lt;!-- 文件大小 --&gt;
        &lt;SizeBasedTriggeringPolicy size=&quot;100 MB&quot;/&gt;
      &lt;/Policies&gt;
    &lt;/RollingFile&gt;

    &lt;!-- info级别日志文件输出 --&gt;
    &lt;RollingFile name=&quot;info_appender&quot; fileName=&quot;$&#123;baseDir&#125;/info.log&quot;
      filePattern=&quot;$&#123;baseDir&#125;/info_%i.log.%d&#123;yyyy-MM-dd&#125;&quot;&gt;
      &lt;!-- 过滤器 --&gt;
      &lt;Filters&gt;
        &lt;!-- 限制日志级别在info及以上在error以下 --&gt;
        &lt;ThresholdFilter level=&quot;info&quot;/&gt;
        &lt;ThresholdFilter level=&quot;error&quot; onMatch=&quot;DENY&quot; onMismatch=&quot;NEUTRAL&quot;/&gt;
      &lt;/Filters&gt;
      &lt;!-- 日志格式 --&gt;
      &lt;PatternLayout pattern=&quot;[%d&#123;HH:mm:ss:SSS&#125;] [%p] - %l - %m%n&quot;/&gt;
      &lt;!-- 策略 --&gt;
      &lt;Policies&gt;
        &lt;!-- 每隔一天转存 --&gt;
        &lt;TimeBasedTriggeringPolicy interval=&quot;1&quot; modulate=&quot;true&quot;/&gt;
        &lt;!-- 文件大小 --&gt;
        &lt;SizeBasedTriggeringPolicy size=&quot;100 MB&quot;/&gt;
      &lt;/Policies&gt;
    &lt;/RollingFile&gt;

    &lt;!-- error级别日志文件输出 --&gt;
    &lt;RollingFile name=&quot;error_appender&quot; fileName=&quot;$&#123;baseDir&#125;/error.log&quot;
      filePattern=&quot;$&#123;baseDir&#125;/error_%i.log.%d&#123;yyyy-MM-dd&#125;&quot;&gt;
      &lt;!-- 过滤器 --&gt;
      &lt;Filters&gt;
        &lt;!-- 限制日志级别在error及以上 --&gt;
        &lt;ThresholdFilter level=&quot;error&quot;/&gt;
      &lt;/Filters&gt;
      &lt;!-- 日志格式 --&gt;
      &lt;PatternLayout pattern=&quot;[%d&#123;HH:mm:ss:SSS&#125;] [%p] - %l - %m%n&quot;/&gt;
      &lt;Policies&gt;
        &lt;!-- 每隔一天转存 --&gt;
        &lt;TimeBasedTriggeringPolicy interval=&quot;1&quot; modulate=&quot;true&quot;/&gt;
        &lt;!-- 文件大小 --&gt;
        &lt;SizeBasedTriggeringPolicy size=&quot;100 MB&quot;/&gt;
      &lt;/Policies&gt;
    &lt;/RollingFile&gt;
  &lt;/Appenders&gt;
  &lt;Loggers&gt;
    &lt;Root level=&quot;debug&quot;&gt;
      &lt;AppenderRef ref=&quot;Console&quot;/&gt;
      &lt;AppenderRef ref=&quot;debug_appender&quot;/&gt;
      &lt;AppenderRef ref=&quot;info_appender&quot;/&gt;
      &lt;AppenderRef ref=&quot;error_appender&quot;/&gt;
    &lt;/Root&gt;

  &lt;/Loggers&gt;
&lt;/Configuration&gt;
</code></pre>
<h3 id="AOP统一处理Web请求日志"><a href="#AOP统一处理Web请求日志" class="headerlink" title="AOP统一处理Web请求日志"></a>AOP统一处理Web请求日志</h3><ul>
<li>为什么需要AOP统一处理Web请求日志 [对系统健壮性的保证 创建filter]</li>
</ul>
<pre><code class="java">com/imooc/mall/filter/WebLogAspect.java
package com.imooc.mall.filter;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.aspectj.lang.JoinPoint;
import org.aspectj.lang.annotation.AfterReturning;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;
import org.aspectj.lang.annotation.Pointcut;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Component;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import javax.servlet.http.HttpServletRequest;
import java.util.Arrays;

/**
 * 打印请求和响应信息
 */
@Aspect
@Component
public class WebLogAspect &#123;
    //生成loger类
    private final Logger log = LoggerFactory.getLogger(WebLogAspect.class);
//10.增加一个拦截点AOP
    @Pointcut(&quot;execution(public * com.imooc.mall.controller..*.*(..))&quot;)
    public void webLog()&#123;

    &#125;
//  10.提供请求参数
    @Before(&quot;webLog()&quot;)
    public void doBefore(JoinPoint joinPoint)&#123;
        //收到请求,记录请求内容  请求到来所作的事情
        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        HttpServletRequest request = attributes.getRequest();
        log.info(&quot;URL: &quot; + request.getRequestURI().toString());
        log.info(&quot;HTTP_METHOD: &quot; + request.getMethod());
        log.info(&quot;IP: &quot; + request.getRemoteAddr());
        log.info(&quot;CLASS_METHOD: &quot; + joinPoint.getSignature().getDeclaringTypeName() + &quot;.&quot; + joinPoint.getSignature().getName());
        log.info(&quot;ARGS: &quot; + Arrays.toString(joinPoint.getArgs()));
    &#125;
//  11.返回的时候也要拦截  返回参数res 拦截点webLog
    @AfterReturning(returning = &quot;res&quot;,pointcut = &quot;webLog()&quot;)
    public void doAfterReturning(Object res)throws Exception&#123;
        //处理完请求,返回内容
        log.info(&quot;RESPONSE: &quot; + new ObjectMapper().writeValueAsString(res));
    &#125;
&#125;
</code></pre>
<h3 id="用户模块"><a href="#用户模块" class="headerlink" title="用户模块"></a>用户模块</h3><ul>
<li>整体介绍：知识点、功能点<br> [<u>登录、注册、重名校验、密码加密存储、Session的使用、越权校验、统一响应对象、异常枚举、Java异常体系、Postman实操、统一异常处理、更新个人信息</u>]</li>
<li>接口设计</li>
<li>编码设计</li>
</ul>
<h3 id="API统一返回对象"><a href="#API统一返回对象" class="headerlink" title="API统一返回对象"></a>API统一返回对象</h3><pre><code class="java">package com.imooc.mall.common;

import com.imooc.mall.exception.ImoocMallExceptionEnum;

/**
 * 通用返回对象 T有可能是返回的购物车对象
 * 12.编写响应API      13创建枚举异常com/imooc/mall/exception/ImoocMallExceptionEnum.java
 */
public class ApiRestResponse&lt;T&gt; &#123;
    private Integer status;
    private String msg;
    private T data;
    private static final int OK_CODE = 10000;
    private static final String OK_MSG = &quot;SUCCESS&quot;;

    public ApiRestResponse(Integer status, String msg, T data) &#123;
        this.status = status;
        this.msg = msg;
        this.data = data;
    &#125;

    public ApiRestResponse(Integer status, String msg) &#123;
        this.status = status;
        this.msg = msg;
    &#125;

    public ApiRestResponse() &#123;
        //默认请求信息
        this(OK_CODE, OK_MSG);
    &#125;
    public static&lt;T&gt; ApiRestResponse&lt;T&gt; success()&#123;
//   建立带着10000 和 SUCCESS的方法
        return new ApiRestResponse&lt;&gt;();
    &#125;

    public static &lt;T&gt; ApiRestResponse&lt;T&gt; error(Integer code, String msg) &#123;
        return new ApiRestResponse&lt;&gt;(code, msg);
    &#125;
//  14.用枚举来搞错误 为了方便调试编写完后生成一个toString方法 15修改UserController的register()
    public static &lt;T&gt; ApiRestResponse&lt;T&gt; error(ImoocMallExceptionEnum ex) &#123;
        return new ApiRestResponse&lt;&gt;(ex.getCode(), ex.getMsg());
    &#125;
//   把错误[异常]创建成一个枚举类

    public static&lt;T&gt; ApiRestResponse&lt;T&gt; success(T result)&#123;
//    两个成功success的方法
        ApiRestResponse&lt;T&gt; response = new ApiRestResponse&lt;&gt;();
        response.setData(result);
        return response;
    &#125;

    @Override
    public String toString() &#123;
        return &quot;ApiRestResponse&#123;&quot; +
                &quot;status=&quot; + status +
                &quot;, msg=&#39;&quot; + msg + &#39;\&#39;&#39; +
                &quot;, data=&quot; + data +
                &#39;&#125;&#39;;
    &#125;

    public Integer getStatus() &#123;
        return status;
    &#125;

    public void setStatus(Integer status) &#123;
        this.status = status;
    &#125;

    public String getMsg() &#123;
        return msg;
    &#125;

    public void setMsg(String msg) &#123;
        this.msg = msg;
    &#125;

    public T getData() &#123;
        return data;
    &#125;

    public void setData(T data) &#123;
        this.data = data;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/exception/ImoocMallExceptionEnum.java
package com.imooc.mall.exception;

/**
 * 异常枚举
 */
//13.编写异常枚举 注意类是enum噢  14返回ApiRestResponse
public enum ImoocMallExceptionEnum &#123;
//  正确状态码是10000 这个错误的就10001 变红是因为没构造函数
    NEED_USER_NAME(10001,&quot;用户名不能为空&quot;),
    NEED_PASSWORD_NAME(10002,&quot;密码不能为空&quot;),
    PASSWORD_TOO_SHORT(10003,&quot;密码长度不能小于8位&quot;);


    //异常码
    Integer code;
    //异常信息
    String msg;

    ImoocMallExceptionEnum(Integer code, String msg) &#123;
        this.code = code;
        this.msg = msg;
    &#125;

    public Integer getCode() &#123;
        return code;
    &#125;

    public void setCode(Integer code) &#123;
        this.code = code;
    &#125;

    public String getMsg() &#123;
        return msg;
    &#125;

    public void setMsg(String msg) &#123;
        this.msg = msg;
    &#125;
&#125;
</code></pre>
<h3 id="注册接口开发"><a href="#注册接口开发" class="headerlink" title="注册接口开发"></a>注册接口开发</h3><pre><code class="java">com/imooc/mall/controller/UserController.java
package com.imooc.mall.controller;

import com.imooc.mall.common.ApiRestResponse;
import com.imooc.mall.exception.ImoocMallException;
import com.imooc.mall.exception.ImoocMallExceptionEnum;
import com.imooc.mall.model.pojo.User;
import com.imooc.mall.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.util.StringUtils;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

/**
 * 用户控制器
 */
@Controller
public class UserController &#123;
    //4.返回对象的基本信息 return里面会写和service相关的  5建立Service层
    @Autowired
    UserService userService;
    @GetMapping(&quot;/test&quot;)
    @ResponseBody //返回Json格式内容
    public User personalPage()&#123;
//  6.补全return 7告诉mapper在哪里怎么去找 去application.properties编写 mybatis.mapper-locations:......
//  去主类里编写@MapperScan(basePackages = &quot;com.imooc.mall.model.dao&quot;) 以防找不到mapper 8.去配置端口8083
//   9.加入log4j2.xml  增加aop的pom
        return userService.getUser();
    &#125;
// 12.创造一个统一返回对象 com/imooc/mall/common/ApiRestResponse.java
    // 15.参数加在请求中所以加上@RequestParam 编写校验  16去UserService增加register接口
    @PostMapping(&quot;/register&quot;)
    @ResponseBody
    public ApiRestResponse register(@RequestParam(&quot;userName&quot;) String userName, @RequestParam(&quot;password&quot;) String password) throws ImoocMallException &#123;
//    字符串为空 || 符合参数
        if (StringUtils.isEmpty(userName))&#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_USER_NAME);
        &#125;if (StringUtils.isEmpty(password))&#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_PASSWORD_NAME);
        &#125;
//   防止用户密码长度设置简单 密码长度不能少于8
        if (password.length()&lt;8)&#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.PASSWORD_TOO_SHORT);
        &#125;
 //18.补全操作  19进行统一处理异常[对前端安全考虑] GlobalExceptionHandler.java
        userService.register(userName, password);
        return ApiRestResponse.success();
    &#125;
&#125;

=========================================
http://127.0.0.1:8083/register

Whitelabel Error Page
This application has no explicit mapping for /error, so you are seeing this as a fallback.

Wed Mar 06 00:06:06 CST 2024
There was an unexpected error (type=Method Not Allowed, status=405).
Request method &#39;GET&#39; not supported
    
因为注册的时候采用的是@PostMapping(&quot;/register&quot;)
单纯查询用get 往数据库写东西post
@RequestMapping(&quot;/register&quot;)是GET和POST都支持的 但是不推荐
根据不同的业务逻辑选择类型

打开postman 新建一个去查询post
POST: 127.0.0.1:8083/register?userName=mumu&amp;password=12345678

&#123;
    &quot;status&quot;: 10000,
    &quot;msg&quot;: &quot;SUCCESS&quot;,
    &quot;data&quot;: null
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/UserService.java
package com.imooc.mall.service;

import com.imooc.mall.model.pojo.User;

//5.这是抽象的接口 还要让它实现 再创建一个impl 实现接口类 UserServiceImpl.java
public interface UserService &#123;
    User getUser();
// 16.写完接口去实现接口UserServiceImpl.java
    void register(String userName, String password);
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/UserServiceImpl.java
package com.imooc.mall.service.impl;

import com.imooc.mall.exception.ImoocMallException;
import com.imooc.mall.exception.ImoocMallExceptionEnum;
import com.imooc.mall.model.dao.UserMapper;
import com.imooc.mall.model.pojo.User;
import com.imooc.mall.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

/**
 * UserService实现类
 */
@Service
//5.重写里面的方法  @Autowired引入一个mapper去查询数据库返回真正的信息 6返回UserController补全return
public class UserServiceImpl implements UserService &#123;
    @Autowired
    UserMapper userMapper;

    @Override
    public User getUser()&#123;
        //通过主键来查询一个对象
        return userMapper.selectByPrimaryKey(1);
    &#125;
    @Override
    public void register(String userName, String password) throws ImoocMallException &#123;
//    16.查询用户名是否存在, 不允许重名 用userMapper去查数据
//    但未编写功能 去手动编写UserMapper.java
        User result = userMapper.selectByName(userName);
        if (result != null)&#123;
//    17. 用户已存在 在Service层不能直接return但是controller可以直接返回
            // 创建一个异常类 com/imooc/mall/exception/ImoocMallException.java
            throw new ImoocMallException(ImoocMallExceptionEnum.NAME_EXISTED);
        &#125;
    // 通过检测 允许写入数据库
        User user = new User();
        user.setUsername(userName);
        user.setPassword(password);
        //先判断是不是空 不是空才修改  实现完以后回到controller层进行调用
        int count = userMapper.insertSelective(user);
        if (count==0)&#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.INSERT_FAILED);
        &#125;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/model/dao/UserMapper.java
package com.imooc.mall.model.dao;

import com.imooc.mall.model.pojo.User;
import org.springframework.stereotype.Repository;

@Repository
public interface UserMapper &#123;
    int deleteByPrimaryKey(Integer id);

    int insert(User record);

    int insertSelective(User record);

    User selectByPrimaryKey(Integer id);

    int updateByPrimaryKeySelective(User record);

    int updateByPrimaryKey(User record);

    // 16. 新增功能 去对应的UserMapper.xml进行描述 117行  BaseResultMap就是一开始自动生成的User对象
    // &lt;include refid=&quot;Base_Column_List&quot;/&gt; 选取完整的User对象
    User selectByName(String userName);
&#125;
</code></pre>
<pre><code class="xml">mappers/UserMapper.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;com.imooc.mall.model.dao.UserMapper&quot;&gt;
  &lt;resultMap id=&quot;BaseResultMap&quot; type=&quot;com.imooc.mall.model.pojo.User&quot;&gt;
    &lt;id column=&quot;id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;id&quot; /&gt;
    &lt;result column=&quot;username&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;username&quot; /&gt;
    &lt;result column=&quot;password&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;password&quot; /&gt;
    &lt;result column=&quot;personalized_signature&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;personalizedSignature&quot; /&gt;
    &lt;result column=&quot;role&quot; jdbcType=&quot;INTEGER&quot; property=&quot;role&quot; /&gt;
    &lt;result column=&quot;create_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;createTime&quot; /&gt;
    &lt;result column=&quot;update_time&quot; jdbcType=&quot;TIMESTAMP&quot; property=&quot;updateTime&quot; /&gt;
  &lt;/resultMap&gt;
  &lt;sql id=&quot;Base_Column_List&quot;&gt;
    id, username, `password`, personalized_signature, `role`, create_time, update_time
  &lt;/sql&gt;
  &lt;select id=&quot;selectByPrimaryKey&quot; parameterType=&quot;java.lang.Integer&quot; resultMap=&quot;BaseResultMap&quot;&gt;
    select 
    &lt;include refid=&quot;Base_Column_List&quot; /&gt;
    from imooc_mall_user
    where id = #&#123;id,jdbcType=INTEGER&#125;
  &lt;/select&gt;
  &lt;delete id=&quot;deleteByPrimaryKey&quot; parameterType=&quot;java.lang.Integer&quot;&gt;
    delete from imooc_mall_user
    where id = #&#123;id,jdbcType=INTEGER&#125;
  &lt;/delete&gt;
  &lt;insert id=&quot;insert&quot; parameterType=&quot;com.imooc.mall.model.pojo.User&quot;&gt;
    insert into imooc_mall_user (id, username, `password`, 
      personalized_signature, `role`, create_time, 
      update_time)
    values (#&#123;id,jdbcType=INTEGER&#125;, #&#123;username,jdbcType=VARCHAR&#125;, #&#123;password,jdbcType=VARCHAR&#125;, 
      #&#123;personalizedSignature,jdbcType=VARCHAR&#125;, #&#123;role,jdbcType=INTEGER&#125;, #&#123;createTime,jdbcType=TIMESTAMP&#125;, 
      #&#123;updateTime,jdbcType=TIMESTAMP&#125;)
  &lt;/insert&gt;
  &lt;insert id=&quot;insertSelective&quot; parameterType=&quot;com.imooc.mall.model.pojo.User&quot;&gt;
    insert into imooc_mall_user
    &lt;trim prefix=&quot;(&quot; suffix=&quot;)&quot; suffixOverrides=&quot;,&quot;&gt;
      &lt;if test=&quot;id != null&quot;&gt;
        id,
      &lt;/if&gt;
      &lt;if test=&quot;username != null&quot;&gt;
        username,
      &lt;/if&gt;
      &lt;if test=&quot;password != null&quot;&gt;
        `password`,
      &lt;/if&gt;
      &lt;if test=&quot;personalizedSignature != null&quot;&gt;
        personalized_signature,
      &lt;/if&gt;
      &lt;if test=&quot;role != null&quot;&gt;
        `role`,
      &lt;/if&gt;
      &lt;if test=&quot;createTime != null&quot;&gt;
        create_time,
      &lt;/if&gt;
      &lt;if test=&quot;updateTime != null&quot;&gt;
        update_time,
      &lt;/if&gt;
    &lt;/trim&gt;
    &lt;trim prefix=&quot;values (&quot; suffix=&quot;)&quot; suffixOverrides=&quot;,&quot;&gt;
      &lt;if test=&quot;id != null&quot;&gt;
        #&#123;id,jdbcType=INTEGER&#125;,
      &lt;/if&gt;
      &lt;if test=&quot;username != null&quot;&gt;
        #&#123;username,jdbcType=VARCHAR&#125;,
      &lt;/if&gt;
      &lt;if test=&quot;password != null&quot;&gt;
        #&#123;password,jdbcType=VARCHAR&#125;,
      &lt;/if&gt;
      &lt;if test=&quot;personalizedSignature != null&quot;&gt;
        #&#123;personalizedSignature,jdbcType=VARCHAR&#125;,
      &lt;/if&gt;
      &lt;if test=&quot;role != null&quot;&gt;
        #&#123;role,jdbcType=INTEGER&#125;,
      &lt;/if&gt;
      &lt;if test=&quot;createTime != null&quot;&gt;
        #&#123;createTime,jdbcType=TIMESTAMP&#125;,
      &lt;/if&gt;
      &lt;if test=&quot;updateTime != null&quot;&gt;
        #&#123;updateTime,jdbcType=TIMESTAMP&#125;,
      &lt;/if&gt;
    &lt;/trim&gt;
  &lt;/insert&gt;
  &lt;update id=&quot;updateByPrimaryKeySelective&quot; parameterType=&quot;com.imooc.mall.model.pojo.User&quot;&gt;
    update imooc_mall_user
    &lt;set&gt;
      &lt;if test=&quot;username != null&quot;&gt;
        username = #&#123;username,jdbcType=VARCHAR&#125;,
      &lt;/if&gt;
      &lt;if test=&quot;password != null&quot;&gt;
        `password` = #&#123;password,jdbcType=VARCHAR&#125;,
      &lt;/if&gt;
      &lt;if test=&quot;personalizedSignature != null&quot;&gt;
        personalized_signature = #&#123;personalizedSignature,jdbcType=VARCHAR&#125;,
      &lt;/if&gt;
      &lt;if test=&quot;role != null&quot;&gt;
        `role` = #&#123;role,jdbcType=INTEGER&#125;,
      &lt;/if&gt;
      &lt;if test=&quot;createTime != null&quot;&gt;
        create_time = #&#123;createTime,jdbcType=TIMESTAMP&#125;,
      &lt;/if&gt;
      &lt;if test=&quot;updateTime != null&quot;&gt;
        update_time = #&#123;updateTime,jdbcType=TIMESTAMP&#125;,
      &lt;/if&gt;
    &lt;/set&gt;
    where id = #&#123;id,jdbcType=INTEGER&#125;
  &lt;/update&gt;
  &lt;update id=&quot;updateByPrimaryKey&quot; parameterType=&quot;com.imooc.mall.model.pojo.User&quot;&gt;
    update imooc_mall_user
    set username = #&#123;username,jdbcType=VARCHAR&#125;,
      `password` = #&#123;password,jdbcType=VARCHAR&#125;,
      personalized_signature = #&#123;personalizedSignature,jdbcType=VARCHAR&#125;,
      `role` = #&#123;role,jdbcType=INTEGER&#125;,
      create_time = #&#123;createTime,jdbcType=TIMESTAMP&#125;,
      update_time = #&#123;updateTime,jdbcType=TIMESTAMP&#125;
    where id = #&#123;id,jdbcType=INTEGER&#125;
  &lt;/update&gt;
  &lt;select id=&quot;selectByName&quot; parameterType=&quot;java.lang.String&quot; resultMap=&quot;BaseResultMap&quot;&gt;
    select
        &lt;include refid=&quot;Base_Column_List&quot;/&gt;
        from imooc_mall_user
        where username = #&#123;userName,jdbcType=VARCHAR&#125;
  &lt;/select&gt;
&lt;/mapper&gt;
</code></pre>
<pre><code class="java">com/imooc/mall/exception/ImoocMallException.java
package com.imooc.mall.exception;

/**
 * 17. 统一异常(感觉像递归之前编写的枚举异常)
 */
public class ImoocMallException extends Exception&#123;
    private final Integer code;
    private final String message;

    public ImoocMallException(Integer code, String message) &#123;
        this.code = code;
        this.message = message;
    &#125;

    public ImoocMallException(ImoocMallExceptionEnum exceptionEnum) &#123;
        this(exceptionEnum.getCode(), exceptionEnum.getMsg());
    &#125;

    public Integer getCode() &#123;
        return code;
    &#125;

    @Override
    public String getMessage() &#123;
        return message;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/exception/ImoocMallExceptionEnum.java
package com.imooc.mall.exception;

/**
 * 异常枚举
 */
//13.编写异常枚举 注意类是enum噢  14返回ApiRestResponse
public enum ImoocMallExceptionEnum &#123;
//  正确状态码是10000 这个错误的就10001 变红是因为没构造函数
    NEED_USER_NAME(10001,&quot;用户名不能为空&quot;),
    NEED_PASSWORD_NAME(10002,&quot;密码不能为空&quot;),
    PASSWORD_TOO_SHORT(10003,&quot;密码长度不能小于8位&quot;),
    NAME_EXISTED(10004,&quot;不允许重名，注册失败&quot;),
    INSERT_FAILED(10005,&quot;插入失败，请重试&quot;);


    //异常码
    Integer code;
    //异常信息
    String msg;

    ImoocMallExceptionEnum(Integer code, String msg) &#123;
        this.code = code;
        this.msg = msg;
    &#125;

    public Integer getCode() &#123;
        return code;
    &#125;

    public void setCode(Integer code) &#123;
        this.code = code;
    &#125;

    public String getMsg() &#123;
        return msg;
    &#125;

    public void setMsg(String msg) &#123;
        this.msg = msg;
    &#125;
&#125;
</code></pre>
<h3 id="GlobalExceptionHandler编写"><a href="#GlobalExceptionHandler编写" class="headerlink" title="GlobalExceptionHandler编写"></a>GlobalExceptionHandler编写</h3><ul>
<li>对前端安全考虑，敏感信息不会暴露给用户</li>
<li>抛出异常，直接转化为Json的APIResponse</li>
<li>抛出重名异常</li>
<li>拦截异常并且转变成APIRespond统一类型输出</li>
</ul>
<pre><code class="java">com/imooc/mall/exception/GlobalExceptionHandler.java
package com.imooc.mall.exception;

import com.imooc.mall.common.ApiRestResponse;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;

/**
 * 19.处理统一异常的handler 业务异常 处理不同逻辑异常  
   20对密码进行MD5加密UserServiceImpl 先创建MD5Utils
 */
@ControllerAdvice
public class GlobalExceptionHandler &#123;
    private final Logger log = LoggerFactory.getLogger(GlobalExceptionHandler.class);

    //   统一处理Exception.class异常
    @ExceptionHandler(Exception.class)
    @ResponseBody
    public Object handleException(Exception e) &#123;
        log.error(&quot;Default Exception: &quot;, e);
        return ApiRestResponse.error(ImoocMallExceptionEnum.SYSTEM_ERROR);
    &#125;
    @ExceptionHandler(ImoocMallException.class)
    @ResponseBody
    public Object handleImoocMallException(ImoocMallException e) &#123;
        log.error(&quot;ImoocMallException: &quot;, e); //传进来的是什么就传出去
        return ApiRestResponse.error(e.getCode(), e.getMessage());
    &#125;
&#125;
</code></pre>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/e682b6dfead4194de33f37c0a5d1f116f2d9ad96/data/Java%E5%BC%82%E5%B8%B8%E4%BD%93%E7%B3%BB.png"></p>
<h3 id="对密码进行MD5保护"><a href="#对密码进行MD5保护" class="headerlink" title="对密码进行MD5保护"></a>对密码进行MD5保护</h3><pre><code class="java">com/imooc/mall/util/MD5Utils.java
package com.imooc.mall.util;

import com.imooc.mall.common.Constant;
import org.apache.tomcat.util.codec.binary.Base64;

import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;

//20.不具备解密的协议 哈希算法  因为有破解MD5的网站所以需要加盐 21com/imooc/mall/common/Constant.java
public class MD5Utils &#123;
    public static String getMD5Str(String strValue) throws NoSuchAlgorithmException &#123;
        MessageDigest md5 = MessageDigest.getInstance(&quot;MD5&quot;);
        return Base64.encodeBase64String(md5.digest((strValue+ Constant.SALT).getBytes()));
    &#125;
//  用这个方法测试生成MD5的值
    public static void main(String[] args) throws NoSuchAlgorithmException &#123;
        String md5Str = getMD5Str(&quot;12345&quot;);
        System.out.println(md5Str);
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/common/Constant.java
package com.imooc.mall.common;

/**
 * 21.SALT常量值 写完以后去UserServiceImpl重写密码代码
 */
public class Constant &#123;
    public static final String SALT = &quot;aSp[PCx,aw.xq246&#125;&quot;;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/UserServiceImpl.java
package com.imooc.mall.service.impl;

import com.imooc.mall.exception.ImoocMallException;
import com.imooc.mall.exception.ImoocMallExceptionEnum;
import com.imooc.mall.model.dao.UserMapper;
import com.imooc.mall.model.pojo.User;
import com.imooc.mall.service.UserService;
import com.imooc.mall.util.MD5Utils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.security.NoSuchAlgorithmException;

/**
 * UserService实现类
 */
@Service
//5.重写里面的方法  @Autowired引入一个mapper去查询数据库返回真正的信息 6返回UserController补全return
public class UserServiceImpl implements UserService &#123;
    @Autowired
    UserMapper userMapper;

    @Override
    public User getUser()&#123;
        //通过主键来查询一个对象
        return userMapper.selectByPrimaryKey(1);
    &#125;
    @Override
    public void register(String userName, String password) throws ImoocMallException, NoSuchAlgorithmException &#123;
//    16.查询用户名是否存在, 不允许重名 用userMapper去查数据
//    但未编写功能 去手动编写UserMapper.java
        User result = userMapper.selectByName(userName);
        if (result != null)&#123;
//    17. 用户已存在 在Service层不能直接return但是controller可以直接返回
            // 创建一个异常类 com/imooc/mall/exception/ImoocMallException.java
            throw new ImoocMallException(ImoocMallExceptionEnum.NAME_EXISTED);
        &#125;
    // 通过检测 允许写入数据库
        User user = new User();
        user.setUsername(userName);
//        user.setPassword(password);
        //21.重写密码
        user.setPassword(MD5Utils.getMD5Str(password));
        //先判断是不是空 不是空才修改  18实现完以后回到controller层进行调用
        int count = userMapper.insertSelective(user);
        if (count==0)&#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.INSERT_FAILED);
        &#125;
    &#125;
&#125;
</code></pre>
<h3 id="登录功能分析"><a href="#登录功能分析" class="headerlink" title="登录功能分析"></a>登录功能分析</h3><ul>
<li>登录状态需要保持 </li>
<li>session的实现方案：登陆后，会保存用户信息到session</li>
<li>之后的访问，会先从session中获取用户信息，然后再执行业务逻辑</li>
</ul>
<pre><code class="java">com/imooc/mall/common/Constant.java
package com.imooc.mall.common;

/**
 * 21.SALT常量值 写完以后去UserServiceImpl重写密码代码
 */
public class Constant &#123;
    public static final String SALT = &quot;aSp[PCx,aw.xq246&#125;&quot;;
    public static final String IMOOC_MALL_USER = &quot;imooc_mall_user&quot;;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/exception/ImoocMallExceptionEnum.java
    NEED_USER_NAME(10001,&quot;用户名不能为空&quot;),
    NEED_PASSWORD_NAME(10002,&quot;密码不能为空&quot;),
    PASSWORD_TOO_SHORT(10003,&quot;密码长度不能小于8位&quot;),
    NAME_EXISTED(10004,&quot;不允许重名，注册失败&quot;),
    INSERT_FAILED(10005,&quot;插入失败，请重试&quot;),
    WRONG_PASSWORD(10006,&quot;密码错误&quot;),
    SYSTEM_ERROR(20000,&quot;系统异常&quot;);
</code></pre>
<pre><code class="java">com/imooc/mall/controller/UserController.java
//22登录login接口的开发 23返回UserServiceImpl写login
    @PostMapping(&quot;/login&quot;)
    @ResponseBody
    public ApiRestResponse login(@RequestParam(&quot;userName&quot;) String userName, @RequestParam(&quot;password&quot;) String password, HttpSession session) throws ImoocMallException, NoSuchAlgorithmException &#123;
        if (StringUtils.isEmpty(userName))&#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_USER_NAME);
        &#125;if (StringUtils.isEmpty(password))&#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_PASSWORD_NAME);
        &#125;//26.编写完毕login接口
        User user = userService.login(userName, password);
        //保存用户信息时，不保存密码
        user.setPassword(null);
        //把对象放入session中
        session.setAttribute(Constant.IMOOC_MALL_USER,user);
        return ApiRestResponse.success(user);
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/UserServiceImpl.java
    //23.写方法判断md5与其匹配
    @Override
    public User login(String userName, String password) throws ImoocMallException &#123;
        String md5Password = null;
        try &#123;
            md5Password = MD5Utils.getMD5Str(password);
        &#125; catch (NoSuchAlgorithmException e) &#123;
            e.printStackTrace();
        &#125;
//   23写方法判断md5与其匹配 UserMapper中写 login
        //25.匹配 且去接口增加
        User user = userMapper.selectLogin(userName, password);
        if (user == null) &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.WRONG_PASSWORD);
        &#125;//能找到就返回用户 直接从上面写@Override再自动修复就可以自动生成login的接口
        //26.返回UserController写完login接口
        return user;
    &#125;
</code></pre>
<h3 id="用户模块剩余接口开发-更新个性签名"><a href="#用户模块剩余接口开发-更新个性签名" class="headerlink" title="用户模块剩余接口开发 [更新个性签名]"></a>用户模块剩余接口开发 [更新个性签名]</h3><pre><code class="java">com/imooc/mall/exception/ImoocMallExceptionEnum.java
public enum ImoocMallExceptionEnum &#123;
//  正确状态码是10000 这个错误的就10001 变红是因为没构造函数
    NEED_USER_NAME(10001,&quot;用户名不能为空&quot;),
    NEED_PASSWORD_NAME(10002,&quot;密码不能为空&quot;),
    PASSWORD_TOO_SHORT(10003,&quot;密码长度不能小于8位&quot;),
    NAME_EXISTED(10004,&quot;不允许重名，注册失败&quot;),
    INSERT_FAILED(10005,&quot;插入失败，请重试&quot;),
    WRONG_PASSWORD(10006,&quot;密码错误&quot;),
    NEED_LOGIN(10007,&quot;用户未登录&quot;),
    UPDATE_FAILD(10008,&quot;更新失败&quot;),
    SYSTEM_ERROR(20000,&quot;系统异常&quot;);
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/controller/UserController.java
//22登录login接口的开发 23返回UserServiceImpl写login
    @PostMapping(&quot;/login&quot;)
    @ResponseBody
    public ApiRestResponse login(@RequestParam(&quot;userName&quot;) String userName, @RequestParam(&quot;password&quot;) String password, HttpSession session) throws ImoocMallException, NoSuchAlgorithmException &#123;
        if (StringUtils.isEmpty(userName)) &#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_USER_NAME);
        &#125;
        if (StringUtils.isEmpty(password)) &#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_PASSWORD_NAME);
        &#125;//26.编写完毕login接口  27更新个性签名接口
        User user = userService.login(userName, password);
        //保存用户信息时，不保存密码
        user.setPassword(null);
        //把对象放入session中 KEY
        session.setAttribute(Constant.IMOOC_MALL_USER, user);
        return ApiRestResponse.success(user);
    &#125;

    //  27.个性签名接口 28编写UserServiceImpl的updateUserInfo方法
    @PostMapping(&quot;/user/update&quot;)
    @ResponseBody
    public ApiRestResponse updateUserInfo(HttpSession session, @RequestParam String signature) throws ImoocMallException &#123;
        User currentUser = (User)session.getAttribute(Constant.IMOOC_MALL_USER);
        if (currentUser == null)&#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_LOGIN);
        &#125;
        User user = new User();
        user.setId(currentUser.getId());
        user.setPersonalizedSignature(signature);
        //29.搞全代码
        userService.updateInformation(user);
        return ApiRestResponse.success();
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/UserServiceImpl.java
//23.写方法判断md5与其匹配
    @Override
    public User login(String userName, String password) throws ImoocMallException &#123;
        String md5Password = null;
        try &#123;
            md5Password = MD5Utils.getMD5Str(password);
        &#125; catch (NoSuchAlgorithmException e) &#123;
            e.printStackTrace();
        &#125;
//   23写方法判断md5与其匹配 UserMapper中写 login
        //25.匹配 且去接口增加
        User user = userMapper.selectLogin(userName, md5Password);
        if (user == null) &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.WRONG_PASSWORD);
        &#125;//能找到就返回用户 直接从上面写@Override再自动修复就可以自动生成login的接口
        //26.返回UserController写完login接口
        return user;
    &#125;
// 28写updateUserInfo方法 不需要返回任何信息 只需要提醒更行成功即可
    @Override
    public void updateInformation(User user) throws ImoocMallException &#123;
//    更新个性签名
        int updateCount = userMapper.updateByPrimaryKeySelective(user);
        if(updateCount&gt;1)&#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.UPDATE_FAILD);
        &#125;
        //快速使用@Override 快速补全接口代码 29返回UserController补全代码
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/UserService.java
package com.imooc.mall.service;

import com.imooc.mall.exception.ImoocMallException;
import com.imooc.mall.model.pojo.User;

import java.security.NoSuchAlgorithmException;

//5.这是抽象的接口 还要让它实现 再创建一个impl 实现接口类 UserServiceImpl.java
public interface UserService &#123;
    User getUser();
// 16.写完接口去实现接口UserServiceImpl.java
    void register(String userName, String password) throws ImoocMallException, NoSuchAlgorithmException;

    //23.写方法判断md5与其匹配
    User login(String userName, String password) throws ImoocMallException;

    // 28写updateUserInfo方法 不需要返回任何信息 只需要提醒更行成功即可
    void updateInformation(User user) throws ImoocMallException;
&#125;
</code></pre>
<h3 id="退出登录"><a href="#退出登录" class="headerlink" title="退出登录"></a>退出登录</h3><pre><code class="java">com/imooc/mall/controller/UserController.java
//30.退出登录接口
    @PostMapping(&quot;/user/logout&quot;)
    @ResponseBody
    public ApiRestResponse logout(HttpSession session)&#123;
        session.removeAttribute(Constant.IMOOC_MALL_USER);
        return ApiRestResponse.success();
    &#125;
</code></pre>
<h3 id="管理员接口"><a href="#管理员接口" class="headerlink" title="管理员接口"></a>管理员接口</h3><pre><code class="java">com/imooc/mall/controller/UserController.java
    //  31.管理员登录接口 思路可以借鉴
    @PostMapping(&quot;/adminLogin&quot;)
    @ResponseBody
    public ApiRestResponse adminLogin(@RequestParam(&quot;userName&quot;) String userName, @RequestParam(&quot;password&quot;) String password, HttpSession session) throws ImoocMallException, NoSuchAlgorithmException &#123;
        if (StringUtils.isEmpty(userName)) &#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_USER_NAME);
        &#125;
        if (StringUtils.isEmpty(password)) &#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_PASSWORD_NAME);
        &#125;//31.拿到用户名和密码的时候 对其进行校验是否为管理员
        //数据库中 role=1是普通用户   role=2是管理员用户
        // 32去serviceImpl写一个方法
        User user = userService.login(userName, password);
        //33.判断是否为管理员
//        userService.checkAdminRole(user).if
        if (userService.checkAdminRole(user)) &#123;
            //是管理员
            //保存用户信息时，不保存密码
            user.setPassword(null);
            //把对象放入session中 KEY
            session.setAttribute(Constant.IMOOC_MALL_USER, user);
            return ApiRestResponse.success(user);
        &#125;else &#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_ADMIN);
        &#125;
    //  34.创建分类接口 CategoryController
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/UserServiceImpl.java
//  32.拿到用户  role=1是普通用户   role=2是管理员用户
    //33.回到Controller
    @Override
    public boolean checkAdminRole(User user)&#123;
        return user.getRole().equals(2);
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/exception/ImoocMallExceptionEnum.java
public enum ImoocMallExceptionEnum &#123;
//  正确状态码是10000 这个错误的就10001 变红是因为没构造函数
    NEED_USER_NAME(10001,&quot;用户名不能为空&quot;),
    NEED_PASSWORD_NAME(10002,&quot;密码不能为空&quot;),
    PASSWORD_TOO_SHORT(10003,&quot;密码长度不能小于8位&quot;),
    NAME_EXISTED(10004,&quot;不允许重名，注册失败&quot;),
    INSERT_FAILED(10005,&quot;插入失败，请重试&quot;),
    WRONG_PASSWORD(10006,&quot;密码错误&quot;),
    NEED_LOGIN(10007,&quot;用户未登录&quot;),
    UPDATE_FAILD(10008,&quot;更新失败&quot;),
    NEED_ADMIN(10009,&quot;无管理员权限&quot;),
    SYSTEM_ERROR(20000,&quot;系统异常&quot;);
&#125;
</code></pre>
<h3 id="总结用户模块"><a href="#总结用户模块" class="headerlink" title="总结用户模块"></a>总结用户模块</h3><ul>
<li><strong>重难点</strong>：统一响应对象、登录状态保持、统一异常处理</li>
<li><strong>常见错误</strong>：响应对象不规范、异常不统一处理</li>
</ul>
<h3 id="商品分类管理模块开发"><a href="#商品分类管理模块开发" class="headerlink" title="商品分类管理模块开发"></a>商品分类管理模块开发</h3><ul>
<li>模块介绍</li>
<li>编码</li>
<li>自测</li>
<li>总结</li>
</ul>
<h5 id="什么是商品分类"><a href="#什么是商品分类" class="headerlink" title="什么是商品分类"></a>什么是商品分类</h5><ul>
<li>条例清楚，层次分明</li>
<li>方便用户进行筛选和辨别</li>
<li>可以通过分类的设置快速的进入对应的商品列表页面进行商品选择</li>
</ul>
<h5 id="分类层级"><a href="#分类层级" class="headerlink" title="分类层级"></a>分类层级</h5><ul>
<li>在商品分类上需要继续做归类操作</li>
<li>分类设置成三级</li>
<li>层级太深的弊端：<ul>
<li>一是对用户不太友好，不利于寻找</li>
<li>二是对后台管理人员不友好，不方便管理</li>
</ul>
</li>
</ul>
<h3 id="分类模块的主要功能"><a href="#分类模块的主要功能" class="headerlink" title="分类模块的主要功能"></a>分类模块的主要功能</h3><ul>
<li>分类数据的设置</li>
<li>分类的父一级目录、递归</li>
</ul>
<h5 id="模块介绍"><a href="#模块介绍" class="headerlink" title="模块介绍"></a>模块介绍</h5><ul>
<li>接口设计</li>
<li>表设计</li>
</ul>
<h3 id="开发添加分类接口part1"><a href="#开发添加分类接口part1" class="headerlink" title="开发添加分类接口part1"></a>开发添加分类接口part1</h3><pre><code class="java">com/imooc/mall/controller/CategoryController.java
package com.imooc.mall.controller;

import com.imooc.mall.common.ApiRestResponse;
import com.imooc.mall.common.Constant;
import com.imooc.mall.exception.ImoocMallExceptionEnum;
import com.imooc.mall.model.model.AddCategoryReq;
import com.imooc.mall.model.pojo.User;
import com.imooc.mall.service.CategoryService;
import com.imooc.mall.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.ResponseBody;

import javax.servlet.http.HttpSession;

//  34.创建分类接口 CategoryController
@Controller
public class CategoryController &#123;
    @Autowired
    UserService userService;
    @Autowired
    CategoryService categoryService;
    @PostMapping(&quot;admin/category/add&quot;)
    @ResponseBody
    public ApiRestResponse addCategory(HttpSession session, @RequestBody AddCategoryReq addCategoryReq) &#123;
        //登录且必须为管理员才可以 参数中需要添加很多元素 可以使用封装来搞
        //com/imooc/mall/model/model/AddCategoryReq.java
        if (addCategoryReq.getName() == null || addCategoryReq.getType() == null || addCategoryReq.getParentId() == null || addCategoryReq.getOrderNum() == null) &#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.PARA_NOT_NULL);
        &#125;
        //对身份进行校验 用session获取当前的用户
        User currentUser = (User) session.getAttribute(Constant.IMOOC_MALL_USER);
        if (currentUser == null)&#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_LOGIN);
        &#125;//校验管理员 userService写过直接引用过来
        boolean adminRole = userService.checkAdminRole(currentUser);
        if (adminRole)&#123; //35.创建一个CategoryService 分类目录Service
        //37.补全代码 是管理员  在上面添加@RequestBody 去postman Body-&gt;(raw/JSON)里测试接口
            categoryService.add(addCategoryReq);
            return ApiRestResponse.success();
        &#125;else &#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_ADMIN);
        &#125;
//38.简化参数校验过程 || || || ||  @Valid  @Size(AddCategoryReq) @NotNull
        //39.增加GlobalExceptionHandler.java中的提示代码 不仅仅只提供20000 系统异常 handleMethodArg。。。
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/model/model/AddCategoryReq.java
package com.imooc.mall.model.model;

/**
 * 34.AddCategoryReq 新建一个类 供添加接口进行封装 回去引用
 */
public class AddCategoryReq &#123;
    private String name;
    private Integer type;
    private Integer parentId;
    private Integer orderNum;
&#125;+GETTER SETTER
</code></pre>
<pre><code class="java">com/imooc/mall/service/CategoryService.java
package com.imooc.mall.service;

import com.imooc.mall.model.model.AddCategoryReq;
import com.imooc.mall.model.pojo.Category;

//35.创建一个CategoryService 分类目录Service 36创建一个它的实现类CategoryServiceImpl
public interface CategoryService &#123;
    void add(AddCategoryReq addCategoryReq);
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/CategoryServiceImpl.java
package com.imooc.mall.service.impl;

import com.fasterxml.jackson.databind.util.BeanUtil;
import com.imooc.mall.exception.ImoocMallException;
import com.imooc.mall.exception.ImoocMallExceptionEnum;
import com.imooc.mall.model.dao.CategoryMapper;
import com.imooc.mall.model.model.AddCategoryReq;
import com.imooc.mall.model.pojo.Category;
import com.imooc.mall.service.CategoryService;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

/**
 * 36.目录分类Service实现类
 */
@Service
public class CategoryServiceImpl implements CategoryService &#123;
    @Autowired
//   去Mapper里增加selectbyName 117行
    CategoryMapper categoryMapper;
    public void add(AddCategoryReq addCategoryReq) &#123;
        Category category = new Category();
//        category.setName(addCategoryReq.getName());
        //字段类型一样 字段名一样的话可以自动拷贝进去
        BeanUtils.copyProperties(addCategoryReq,category);
        Category categoryOld = categoryMapper.selectByName(addCategoryReq.getName());
        if (categoryOld != null)&#123; //重名目录 不允许创建 (优化)将ImoocMallException中的extends换一个
            throw new ImoocMallException(ImoocMallExceptionEnum.NAME_EXISTED);
        &#125;
        int count = categoryMapper.insertSelective(category);
        if (count == 0)&#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.NEED_ADMIN);
        &#125;//37.回到CategoryController.java
    &#125;
&#125;
</code></pre>
<pre><code class="xml">mappers/CategoryMapper.xml
  &lt;select id=&quot;selectByName&quot; parameterType=&quot;java.lang.String&quot; resultMap=&quot;BaseResultMap&quot;&gt;
    select
    &lt;include refid=&quot;Base_Column_List&quot;/&gt;
    from imooc_mall_category
    where name = #&#123;name,jdbcType=VARCHAR&#125;
  &lt;/select&gt;
</code></pre>
<h3 id="参数校验"><a href="#参数校验" class="headerlink" title="参数校验"></a>参数校验</h3><table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Valid</td>
<td>需要验证</td>
</tr>
<tr>
<td>@NotNull</td>
<td>非空</td>
</tr>
<tr>
<td>@Max(value)</td>
<td>最大值</td>
</tr>
<tr>
<td>@Size(max, min)</td>
<td>字符串长度范围限制</td>
</tr>
</tbody></table>
<pre><code class="java">com/imooc/mall/model/model/AddCategoryReq.java
package com.imooc.mall.model.model;

import javax.validation.constraints.Max;
import javax.validation.constraints.NotNull;
import javax.validation.constraints.Size;

/**
 * 34.AddCategoryReq 新建一个类 供添加接口进行封装 回去引用
 */
public class AddCategoryReq &#123;
    @Size(min=2,max=5)
    private String name;
    @NotNull
    @Max(3)
    private Integer type;
    @NotNull(message = &quot;parentId不能为null&quot;)
    private Integer parentId;
    @NotNull
    private Integer orderNum;
    
===================================================
POST:127.0.0.1:8083/admin/category/add
Body→raw→JSON：&#123;&quot;name&quot;:&quot;鸭货伴手零食&quot;,&quot;type&quot;:2,&quot;parentId&quot;:6,&quot;orderNum&quot;:10&#125;

&#123;
    &quot;status&quot;: 20000,
    &quot;msg&quot;: &quot;系统异常&quot;,
    &quot;data&quot;: null
&#125;

org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [1] in public com.imooc.mall.common.ApiRestResponse com.imooc.mall.controller.CategoryController.addCategory(javax.servlet.http.HttpSession,com.imooc.mall.model.model.AddCategoryReq): [Field error in object &#39;addCategoryReq&#39; on field &#39;name&#39;: rejected value [鸭货伴手零食]; codes [Size.addCategoryReq.name,Size.name,Size.java.lang.String,Size]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [addCategoryReq.name,name]; arguments []; default message [name],5,2]; default message [个数必须在2和5之间]] 
</code></pre>
<pre><code class="java">com/imooc/mall/exception/GlobalExceptionHandler.java
package com.imooc.mall.exception;

import com.imooc.mall.common.ApiRestResponse;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.validation.BindingResult;
import org.springframework.validation.ObjectError;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;

import java.util.ArrayList;
import java.util.List;

/**
 * 19.处理统一异常的handler 业务异常 处理不同逻辑异常  20对密码进行MD5加密UserServiceImpl 先创建MD5Utils
 */
@ControllerAdvice
public class GlobalExceptionHandler &#123;
    private final Logger log = LoggerFactory.getLogger(GlobalExceptionHandler.class);

    //   统一处理Exception.class异常
    @ExceptionHandler(Exception.class)
    @ResponseBody
    public Object handleException(Exception e) &#123;
        log.error(&quot;Default Exception: &quot;, e);
        return ApiRestResponse.error(ImoocMallExceptionEnum.SYSTEM_ERROR);
    &#125;

    @ExceptionHandler(ImoocMallException.class)
    @ResponseBody
    public Object handleImoocMallException(ImoocMallException e) &#123;
        log.error(&quot;ImoocMallException: &quot;, e); //传进来的是什么就传出去
        return ApiRestResponse.error(e.getCode(), e.getMessage());
    &#125;

    //  39.处理方法参数不合规的情况
    @ExceptionHandler(MethodArgumentNotValidException.class)
    @ResponseBody
    public ApiRestResponse handleMethodArgumentNotValidException(MethodArgumentNotValidException e) &#123;
        log.error(&quot;handleMethodArgumentNotValidException: &quot;, e);
        return handleBindingResult(e.getBindingResult());
    &#125;
//  40.处理返回异常的ApiRespond 41去pom引入Swagger自动生成API文档
    private ApiRestResponse handleBindingResult(BindingResult result)&#123;
//  把异常处理为对外暴露的提示
        List&lt;String&gt; list = new ArrayList&lt;&gt;();
        if (result.hasErrors())&#123;
            List&lt;ObjectError&gt; allErrors = result.getAllErrors();
            for (ObjectError objectError : allErrors) &#123; //itli快速  对着for按alt+回车 改成增强for
                String message = objectError.getDefaultMessage();
                list.add(message);
            &#125;
        &#125;
        if (list.size() == 0)&#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.REQUEST_PARAM_ERROR);
        &#125; //list.toString()生成所创建的异常描述信息
        return ApiRestResponse.error(ImoocMallExceptionEnum.REQUEST_PARAM_ERROR.getCode(), list.toString());
    &#125;
&#125;
</code></pre>
<h3 id="Swagger自动生成API文档"><a href="#Swagger自动生成API文档" class="headerlink" title="Swagger自动生成API文档"></a>Swagger自动生成API文档</h3><pre><code class="xml">pom.xml
&lt;!--41.导入Swagger自动生成API文档 并在main函数中加入注解 @EnableSwagger2--&gt;
&lt;!--42.再去创造一个config  配置文件    --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.springfox&lt;/groupId&gt;
            &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;
            &lt;version&gt;2.9.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.springfox&lt;/groupId&gt;
            &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;
            &lt;version&gt;2.9.2&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>
<pre><code class="java">com/imooc/mall/config/SpringFoxConfig.java
package com.imooc.mall.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;

@Configuration
public class SpringFoxConfig &#123;
 //41.访问http://localhost:8083/swagger-ui.html可以看到API文档 
    //42创建ImoocMallWebMvcConfig
    @Bean
    public Docket api() &#123;
        return new Docket(DocumentationType.SWAGGER_2)
                .apiInfo(apiInfo())
                .select()
                .apis(RequestHandlerSelectors.any())
                .paths(PathSelectors.any())
                .build();
    &#125;

    private ApiInfo apiInfo() &#123;
        return new ApiInfoBuilder()
                .title(&quot;慕慕生鲜&quot;)
                .description(&quot;&quot;)
                .termsOfServiceUrl(&quot;&quot;)
                .build();
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/MallApplication.java
package com.imooc.mall;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

@SpringBootApplication
@MapperScan(basePackages = &quot;com.imooc.mall.model.dao&quot;)
@EnableSwagger2
public class MallApplication &#123;
    public static void main(String[] args) &#123;
        SpringApplication.run(MallApplication.class, args);
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/config/ImoocMallWebMvcConfig.java
package com.imooc.mall.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/**
 * 42.配置地址映射 
 * 43去CategoryController.java 加一个 @ApiOperation(&quot;后台添加目录&quot;)
   44.新增一个目录的updateCategory的参数 [UpdateCategoryReq.java  ]
 */
@Configuration  //代表是一个配置
public class ImoocMallWebMvcConfig implements WebMvcConfigurer &#123;

    public void addResourceHandles(ResourceHandlerRegistry registry)&#123;
//     把地址给到对应的目录下
        registry.addResourceHandler(&quot;swagger-ui.html&quot;)
                .addResourceLocations(&quot;classpath:/META-INF/resources/&quot;);
        registry.addResourceHandler(&quot;/webjars/**&quot;).addResourceLocations(
                &quot;classpath:/META-INF/resources/webjars&quot;);
    &#125;
&#125;
==================================================
http://localhost:8083/swagger-ui.html
</code></pre>
<h3 id="更新目录接口"><a href="#更新目录接口" class="headerlink" title="更新目录接口"></a>更新目录接口</h3><pre><code class="java">com/imooc/mall/model/request/UpdateCategoryReq.java
package com.imooc.mall.model.request;

import javax.validation.constraints.Max;
import javax.validation.constraints.NotNull;
import javax.validation.constraints.Size;

/**
 * 45.CategoryController.java中创建新增方法
 */
public class UpdateCategoryReq &#123;
    @NotNull(message = &quot;id不能为null&quot;)
    private Integer id;

    @Size(min=2,max=5)
    private String name;
    @Max(3)
    private Integer type;

    private Integer parentId;
    private Integer orderNum;
</code></pre>
<pre><code class="java">com/imooc/mall/controller/CategoryController.java
 //    45.创建新增接口   46在CategoryServiceImpl.java中新增更新方法
    @ApiOperation(&quot;后台更新目录&quot;)
    @PostMapping(&quot;admin/category/update&quot;)
    @ResponseBody
    public ApiRestResponse updateCategory( @Valid @RequestBody UpdateCategoryReq updateCategoryReq, HttpSession session) &#123;
        //对身份进行校验 用session获取当前的用户
        User currentUser = (User) session.getAttribute(Constant.IMOOC_MALL_USER);
        if (currentUser == null) &#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_LOGIN);
        &#125;//校验管理员 userService写过直接引用过来
        boolean adminRole = userService.checkAdminRole(currentUser);
        if (adminRole) &#123;
            //补全代码 是管理员  在上面添加@RequestBody 去postman Body-&gt;(raw/JSON)里测试接口
            //46.补全接口代码
            Category category = new Category(); //复制过来
            BeanUtils.copyProperties(updateCategoryReq, category);
            categoryService.update(category);
            return ApiRestResponse.success();
        &#125; else &#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_ADMIN);
        &#125;//47.为了统一接口校验管理员身份 NEED_LOGIN NEED_ADMIN
        // 创建一个com/imooc/mall/filter/AdminFilter.java
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/CategoryServiceImpl.java
 @Override //47.快速生成
    // 46在CategoryServiceImpl.java中新增更新方法
    public void update(Category updateCategory)&#123;
        if (updateCategory.getName() != null)&#123;
            Category categoryOld = categoryMapper.selectByName(updateCategory.getName());
            if (categoryOld != null &amp;&amp; !categoryOld.getId().equals(updateCategory.getId()))&#123; //不能为空且和原来的名字不一样
                throw new ImoocMallException(ImoocMallExceptionEnum.NAME_EXISTED);
            &#125;
        &#125;
        categoryMapper.updateByPrimaryKeySelective(updateCategory); //根据主键更新
// 不和其他名字冲突
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/CategoryService.java
package com.imooc.mall.service;

import com.imooc.mall.model.pojo.Category;
import com.imooc.mall .model.request.AddCategoryReq;

//35.创建一个CategoryService 分类目录Service 36创建一个它的实现类CategoryServiceImpl
public interface CategoryService &#123;
    void add(AddCategoryReq addCategoryReq);

    //47.快速生成
    // 46在CategoryServiceImpl.java中新增更新方法
    void update(Category updateCategory);
&#125;
</code></pre>
<h3 id="统一校验管理员身份"><a href="#统一校验管理员身份" class="headerlink" title="统一校验管理员身份"></a>统一校验管理员身份</h3><pre><code class="java">com/imooc/mall/controller/CategoryController.java
//    45.创建新增接口   46在CategoryServiceImpl.java中新增更新方法
    @ApiOperation(&quot;后台更新目录&quot;)
    @PostMapping(&quot;admin/category/update&quot;)
    @ResponseBody
    public ApiRestResponse updateCategory( @Valid @RequestBody UpdateCategoryReq updateCategoryReq, HttpSession session) &#123;
        //对身份进行校验 用session获取当前的用户
        User currentUser = (User) session.getAttribute(Constant.IMOOC_MALL_USER);
        if (currentUser == null) &#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_LOGIN);
        &#125;//校验管理员 userService写过直接引用过来
        boolean adminRole = userService.checkAdminRole(currentUser);
        if (adminRole) &#123;
            //补全代码 是管理员  在上面添加@RequestBody 去postman Body-&gt;(raw/JSON)里测试接口
            //46.补全接口代码
            Category category = new Category(); //复制过来
            BeanUtils.copyProperties(updateCategoryReq, category);
            categoryService.update(category);
            return ApiRestResponse.success();
        &#125; else &#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.NEED_ADMIN);
        &#125;//47.为了统一接口校验管理员身份 NEED_LOGIN NEED_ADMIN
        // 创建一个com/imooc/mall/filter/AdminFilter.java
    &#125;
    @ApiOperation(&quot;后台更新目录&quot;)
    @PostMapping(&quot;admin/category/update&quot;)
    @ResponseBody //没有在接口里做权限校验
    public ApiRestResponse deleteCategory()&#123;
        return null;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/filter/AdminFilter.java
package com.imooc.mall.filter;

import com.imooc.mall.common.ApiRestResponse;
import com.imooc.mall.common.Constant;
import com.imooc.mall.exception.ImoocMallExceptionEnum;
import com.imooc.mall.model.pojo.Category;
import com.imooc.mall.model.pojo.User;
import com.imooc.mall.service.UserService;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;

import javax.servlet.*;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpServletResponseWrapper;
import javax.servlet.http.HttpSession;
import java.io.IOException;
import java.io.PrintWriter;

/**
 *
 * 47. 管理员校验过滤器  48.Admin过滤器的配置
 */
public class AdminFilter implements Filter &#123;
    @Autowired
    UserService userService;
    @Override
    public void init(FilterConfig filterConfig) throws ServletException &#123;

    &#125;

    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123;
        //对身份进行校验 用session获取当前的用户
        HttpServletRequest request = (HttpServletRequest)servletRequest;
        HttpSession session = request.getSession();
        User currentUser = (User) session.getAttribute(Constant.IMOOC_MALL_USER);
        if (currentUser == null) &#123;
            PrintWriter out = new HttpServletResponseWrapper((HttpServletResponse) servletResponse).getWriter();
            out.write(&quot;&#123;\n&quot; //用户未登录
                    + &quot;    \&quot;status\&quot;: 10007,\n&quot;
                    + &quot;    \&quot;msg\&quot;: \&quot;NEED_LOGIN\&quot;,\n&quot;
                    + &quot;    \&quot;data\&quot;: null\n&quot;
                    + &quot;&#125;&quot;);
            out.flush();
            out.close();
            return;
        &#125;//校验管理员 userService写过直接引用过来
        boolean adminRole = userService.checkAdminRole(currentUser);
        if (adminRole) &#123; //放行代码
            filterChain.doFilter(servletRequest,servletResponse);
        &#125; else &#123;
            PrintWriter out = new HttpServletResponseWrapper(
                    (HttpServletResponse) servletResponse).getWriter();
            out.write(&quot;&#123;\n&quot;
                    + &quot;    \&quot;status\&quot;: 10009,\n&quot;
                    + &quot;    \&quot;msg\&quot;: \&quot;NEED_ADMIN\&quot;,\n&quot;
                    + &quot;    \&quot;data\&quot;: null\n&quot;
                    + &quot;&#125;&quot;);
            out.flush();
            out.close();
        &#125;
    &#125;

    @Override
    public void destroy() &#123;

    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/filter/AdminFilterConfig.java
package com.imooc.mall.filter;

import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * Admin过滤器的配置
 */
@Configuration
public class AdminFilterConfig &#123;
    @Bean
    public AdminFilter adminFilter()&#123;
        return new AdminFilter();
    &#125;
    @Bean(name = &quot;adminFilterConf&quot;)
    public FilterRegistrationBean adminFilterConfig()&#123;
        FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean();
        filterRegistrationBean.setFilter(adminFilter());
        filterRegistrationBean.addUrlPatterns(&quot;/admin/category/*&quot;);
        filterRegistrationBean.addUrlPatterns(&quot;/admin/product/*&quot;);
        filterRegistrationBean.addUrlPatterns(&quot;/admin/order/*&quot;);
        filterRegistrationBean.setName(&quot;adminFilterConfig&quot;);
        return filterRegistrationBean;
    &#125;
&#125;
com/imooc/mall/filter/AdminFilterConfig.java
</code></pre>
<h3 id="删除目录接口、分页功能开发"><a href="#删除目录接口、分页功能开发" class="headerlink" title="删除目录接口、分页功能开发"></a>删除目录接口、分页功能开发</h3><pre><code class="java">@RequestBody用来接收http post请求的body，前端传入序列化好的json数据，后端可以解析为json对象（Content-Type需要指定为 application/json）。
@RequestParam用来接收请求url?后面的参数，或者Content-Type为multipart/form-data、application/x-www-form-urlencoded时的http body数据。
</code></pre>
<pre><code class="java">com/imooc/mall/controller/CategoryController.java
     @ApiOperation(&quot;后台删除目录&quot;)
    @PostMapping(&quot;admin/category/delete&quot;)
    @ResponseBody //没有在接口里做权限校验
    //49.编写delete接口  再去CategoryServiceImpl.java 写delete方法
    public ApiRestResponse deleteCategory(@RequestParam Integer id) &#123;
        categoryService.delete(id);
        return ApiRestResponse.success();
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/CategoryServiceImpl.java
//49.写delete方法     @Override快速更新service
    @Override
    public void delete(Integer id)&#123;
        Category categoryOld = categoryMapper.selectByPrimaryKey(id);
        //查不到记录，无法删除，删除失败
        if (categoryOld == null)&#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.DELETE_FAILED);
        &#125;
        int count = categoryMapper.deleteByPrimaryKey(id);
        if (count == 0)&#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.DELETE_FAILED);
        &#125;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/controller/CategoryController.java
 //50.写后台查询商品分类列表的接口
    @ApiOperation(&quot;后台目录列表&quot;)
    @PostMapping(&quot;admin/category/list&quot;)
    @ResponseBody //没有在接口里做权限校验
    public ApiRestResponse listCategoryForAdmin(@RequestParam Integer pageNum, @RequestParam Integer pageSize)&#123;
        //51.去CategoryServiceImpl编写该接口的实现类
        PageInfo pageInfo = categoryService.listForAdmin(pageNum, pageSize);
        return ApiRestResponse.success(pageInfo);
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/model/vo/CategoryVO.java
package com.imooc.mall.model.vo;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;

public class CategoryVO &#123;
    private Integer id;
    private String name;
    private Integer type;
    private Integer parentId;
    private Integer orderNum;
    private Date createTime;
    private Date updateTime;
    private List&lt;CategoryVO&gt; childCategory = new ArrayList&lt;&gt;();
&#125;Setter+Getter
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/CategoryServiceImpl.java
//51.创建vo[转换过后反应给前端的一个类]  pageInfo里面蕴藏着一个List&lt;Category&gt;
    @Override
    public PageInfo listForAdmin(Integer pageNum, Integer pageSize)&#123;
        //把分页的功能包裹在List后 而不是直接返回
        //52.引入分页查询的pom 续写分页代码
        PageHelper.startPage(pageNum,pageSize,&quot;type,order_num&quot;);
        //53.写一个查询的mapper新的sql语句 CategoryMapper.java =&gt; List&lt;Category&gt; selectList();
        //54.返回Categorycontroller补全代码
        List&lt;Category&gt; categoryList = categoryMapper.selectList();
        PageInfo pageInfo = new PageInfo(categoryList);
        return pageInfo;
    &#125;
</code></pre>
<pre><code class="xml">pom.xml
&lt;!--  52.引入分页的依赖 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;
            &lt;artifactId&gt;pagehelper-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;1.2.13&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>
<h3 id="用户分类列表接口开发"><a href="#用户分类列表接口开发" class="headerlink" title="用户分类列表接口开发"></a>用户分类列表接口开发</h3><pre><code class="java">com/imooc/mall/controller/CategoryController.java
//54.用户分类列表接口开发 去Impl补写实现类
    @ApiOperation(&quot;前台目录列表&quot;)
    @GetMapping(&quot;category/list&quot;)
    @ResponseBody
    public ApiRestResponse listCategoryForCustomer()&#123;
        List&lt;CategoryVO&gt; categoryVOS = categoryService.listCategoryForCustomer();
        return ApiRestResponse.success(categoryVOS);
    &#125;

============================================
目录列表(給用户看)：127.0.0.1:8083/category/list
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/CategoryServiceImpl.java
//54.用户分类列表接口开发
    @Override
    public List&lt;CategoryVO&gt; listCategoryForCustomer()&#123;
        ArrayList&lt;CategoryVO&gt; categoryVOList = new ArrayList&lt;&gt;();
        recursivelyFindCategories(categoryVOList, 0);
        //55.去Mapper.java 和 Mapper.xml写方法
        return categoryVOList;
    &#125;

    private void recursivelyFindCategories(List&lt;CategoryVO&gt; categoryVOList, Integer parentId)&#123;
        //递归获取所有子类别并组合 合成一个&quot;目录树&quot;
        List&lt;Category&gt; categoryList = categoryMapper.selectCategoriesByParentId(parentId);
        if (!CollectionUtils.isEmpty(categoryList))&#123;
            //空 或 有无元素   itli
            for (int i = 0; i &lt; categoryList.size(); i++) &#123;
                Category category =  categoryList.get(i);
                CategoryVO categoryVO = new CategoryVO();
                //拷贝链接  比原来的多一个childCategory这个字段未被赋值
                BeanUtils.copyProperties(category, categoryVO);
                categoryVOList.add(categoryVO);
                //拿到childCategory字段并赋值 再从上面return categoryVOList;
                recursivelyFindCategories(categoryVO.getChildCategory(), categoryVO.getId());
            &#125;
        &#125;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/model/dao/CategoryMapper.java
package com.imooc.mall.model.dao;

import com.imooc.mall.model.pojo.Category;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface CategoryMapper &#123;
    int deleteByPrimaryKey(Integer id);
    int insert(Category record);
    int insertSelective(Category record);
    Category selectByPrimaryKey(Integer id);
    int updateByPrimaryKeySelective(Category record);
    int updateByPrimaryKey(Category record);
    Category selectByName(String name);
    List&lt;Category&gt; selectList();
    List&lt;Category&gt; selectCategoriesByParentId(Integer parentId);
&#125;
</code></pre>
<pre><code class="java">mappers/CategoryMapper.xml
&lt;mapper&gt;
 &lt;select id=&quot;selectList&quot; resultMap=&quot;BaseResultMap&quot;&gt;
    select &lt;include refid=&quot;Base_Column_List&quot;/&gt;
    from imooc_mall_category
  &lt;/select&gt;
  &lt;select id=&quot;selectCategoriesByParentId&quot; resultMap=&quot;BaseResultMap&quot; parameterType=&quot;int&quot;&gt;
    select &lt;include refid=&quot;Base_Column_List&quot;/&gt;
    from imooc_mall_category
    where parent_id = #&#123;parentId&#125;
  &lt;/select&gt;
&lt;/mapper&gt;
</code></pre>
<h3 id="利用Redis缓存加速响应-目录变化频繁-访问量大的-增加效率"><a href="#利用Redis缓存加速响应-目录变化频繁-访问量大的-增加效率" class="headerlink" title="利用Redis缓存加速响应 [目录变化频繁(访问量大的) 增加效率]"></a>利用Redis缓存加速响应 [目录变化频繁(访问量大的) 增加效率]</h3><pre><code class="xml">pom.xml
&lt;!--    55.导入Redis的pom文件    --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;
        &lt;/dependency&gt;
</code></pre>
<pre><code class="java">56.增加一个@EnableCaching注解让idea知道你想打开缓存功能
com/imooc/mall/MallApplication.java
package com.imooc.mall;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cache.annotation.EnableCaching;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

@SpringBootApplication
@MapperScan(basePackages = &quot;com.imooc.mall.model.dao&quot;)
@EnableSwagger2
@EnableCaching
//56.增加注解 并去想用的前面加注解 @Cacheable(value = &quot;listCategoryForCustomer&quot;)
public class MallApplication &#123;
    public static void main(String[] args) &#123;
        SpringApplication.run(MallApplication.class, args);
    &#125;
&#125;
</code></pre>
<blockquote>
<p>import org.springframework.cache.annotation.Cacheable; [对的]<br><del>import springfox.documentation.annotations.Cacheable;</del> [错的]</p>
</blockquote>
<pre><code class="java">com/imooc/mall/service/impl/CategoryServiceImpl.java
//这里要格外注意 不要导错包 不然运行不了redis 里面的keys会没有键值对
// import org.springframework.cache.annotation.Cacheable; [对的]
// import springfox.documentation.annotations.Cacheable; [错的]
 //54.用户分类列表接口开发
    @Override //56.在下方加想用Redis的注解  
  //57.创建一个对于缓存的配置类com/imooc/mall/config/CachingConfig.java
    @Cacheable(value = &quot;listCategoryForCustomer&quot;)
    public List&lt;CategoryVO&gt; listCategoryForCustomer()&#123;
        ArrayList&lt;CategoryVO&gt; categoryVOList = new ArrayList&lt;&gt;();
        recursivelyFindCategories(categoryVOList, 0);
        //55.去Mapper.java 和 Mapper.xml写方法
        return categoryVOList;
    &#125;

    private void recursivelyFindCategories(List&lt;CategoryVO&gt; categoryVOList, Integer parentId)&#123;
        //递归获取所有子类别并组合 合成一个&quot;目录树&quot;
        List&lt;Category&gt; categoryList = categoryMapper.selectCategoriesByParentId(parentId);
        if (!CollectionUtils.isEmpty(categoryList))&#123;
            //空 或 有无元素   itli
            for (int i = 0; i &lt; categoryList.size(); i++) &#123;
                Category category =  categoryList.get(i);
                CategoryVO categoryVO = new CategoryVO();
                //拷贝链接  比原来的多一个childCategory这个字段未被赋值
                BeanUtils.copyProperties(category, categoryVO);
                categoryVOList.add(categoryVO);
                //拿到childCategory字段并赋值 再从上面return categoryVOList;
                recursivelyFindCategories(categoryVO.getChildCategory(), categoryVO.getId());
            &#125;
        &#125;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/config/CachingConfig.java
package com.imooc.mall.config;

import org.springframework.context.annotation.Bean;
import org.springframework.data.redis.cache.RedisCacheConfiguration;
import org.springframework.data.redis.cache.RedisCacheManager;
import org.springframework.data.redis.cache.RedisCacheWriter;
import org.springframework.data.redis.connection.RedisConnectionFactory;

import java.time.Duration;

/**
 * 57.缓存的配置类 想要运行成功保存序列化 要去弄个序列化接口com/imooc/mall/model/vo/CategoryVO.java
 */
@Configuration
@EnableCaching
public class CachingConfig &#123;
    @Bean
    public RedisCacheManager redisCacheManager(RedisConnectionFactory connectionFactory) &#123;

        RedisCacheWriter redisCacheWriter = RedisCacheWriter
                .lockingRedisCacheWriter(connectionFactory);
        RedisCacheConfiguration cacheConfiguration = RedisCacheConfiguration.defaultCacheConfig();
        cacheConfiguration = cacheConfiguration.entryTtl(Duration.ofSeconds(30));

        RedisCacheManager redisCacheManager = new RedisCacheManager(redisCacheWriter,
                cacheConfiguration);
        return redisCacheManager;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/model/vo/CategoryVO.java
public class CategoryVO implements Serializable &#123;
     private Integer id;
    private String name;
    private Integer type;
    private Integer parentId;
    private Integer orderNum;
    private Date createTime;
    private Date updateTime;
    private List&lt;CategoryVO&gt; childCategory = new ArrayList&lt;&gt;();
&#125;Setter+Getter
</code></pre>
<h3 id="Idea调试技巧"><a href="#Idea调试技巧" class="headerlink" title="Idea调试技巧"></a>Idea调试技巧</h3><ul>
<li>断点统一开关</li>
<li>条件断点</li>
<li>单步调试<ul>
<li>step into 会进入方法内部</li>
<li>step out 跳出方法</li>
</ul>
</li>
<li>表达式求值 [Evaluate Expression]</li>
</ul>
<h3 id="总结商品分类模块"><a href="#总结商品分类模块" class="headerlink" title="总结商品分类模块"></a>总结商品分类模块</h3><ul>
<li>重难点：参数校验、Swagger[API文档自动]、统一鉴权[Filter过滤器]、Redis整合[Springboot整合]、调试功能</li>
<li>常见错误：参数手动校验、<span style = "color:red"><strong>项目没用Redis缓存</strong></span>、不善用调试</li>
</ul>
<h1 id="商品模块介绍"><a href="#商品模块介绍" class="headerlink" title="商品模块介绍"></a>商品模块介绍</h1><h6 id="演示、数据表设计、接口设计"><a href="#演示、数据表设计、接口设计" class="headerlink" title="演示、数据表设计、接口设计"></a>演示、数据表设计、接口设计</h6><h3 id="新增商品功能开发"><a href="#新增商品功能开发" class="headerlink" title="新增商品功能开发"></a>新增商品功能开发</h3><pre><code class="java">com\imooc\mall\controller\ProductAdminController.java
package com.imooc.mall.controller;

import com.imooc.mall.common.ApiRestResponse;
import org.springframework.stereotype.Controller;

/**
 * 58.后台商品管理Controller  pojo的product复制一份到request变成AddProductReq
   59.需要ProductService.java
 */
@Controller
public class ProductAdminController &#123;
    @Autowired
    ProductService productService;
    @PostMapping(&quot;admin/product/add&quot;)
    public ApiRestResponse addProduct(@Valid @RequestBody AddProductReq addProductReq)&#123;
    //61.补全代码  目前图片上传还未开发成功
        productService.add(addProductReq);
        return ApiRestResponse.success();
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/model/request/AddProductReq.java
package com.imooc.mall.model.request;

import javax.validation.constraints.Max;
import javax.validation.constraints.Min;
import javax.validation.constraints.NotNull;

public class AddProductReq &#123;
    @NotNull(message = &quot;商品名称不能为null&quot;)
    private String name;
    @NotNull(message = &quot;商品图片不能为null&quot;)
    private String image;

    private String detail;
    @NotNull(message = &quot;商品分类不能为null&quot;)
    private Integer categoryId;
    @NotNull(message = &quot;商品价格不能为null&quot;)
    @Min(value = 1, message = &quot;价格不能为null&quot;)
    private Integer price;

    @NotNull(message = &quot;商品库存不能为null&quot;)
    @Max(value = 10000, message = &quot;库存不能大于10000&quot;)
    private Integer stock;

    private Integer status;
&#125;Getter+Setter
</code></pre>
<pre><code class="java">com/imooc/mall/service/ProductService.java
package com.imooc.mall.service;

import com.imooc.mall.model.request.AddProductReq;

/**
 * 59.商品Service 再创建一个实现类ProductServiceImpl
 */
public interface ProductService &#123;

    void add(AddProductReq addProductReq);
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/ProductServiceImpl.java
package com.imooc.mall.service.impl;

import com.imooc.mall.exception.ImoocMallException;
import com.imooc.mall.exception.ImoocMallExceptionEnum;
import com.imooc.mall.model.dao.ProductMapper;
import com.imooc.mall.model.pojo.Product;
import com.imooc.mall.model.request.AddProductReq;
import com.imooc.mall.service.ProductService;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

/**
 * 59.商品服务实现类
 */
@Service
public class ProductServiceImpl implements ProductService &#123;
    @Autowired
    ProductMapper productMapper;//60.ProductMapper SQL通过名字查找product是否存在 151行
    @Override
    public void add(AddProductReq addProductReq)&#123;
        Product product = new Product();
        BeanUtils.copyProperties(addProductReq, product);//赋值
        //61.商品重名情况  返回ProductAdminController补全代码  
        //62.图片上传接口 ProductAdminController
        Product productOld = productMapper.selectByName(addProductReq.getName());
        if (productOld != null)&#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.NAME_EXISTED);
        &#125;
        int count = productMapper.insertSelective(product);
        if (count == 0)&#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.CREATE_FAILED);
        &#125;
    &#125;
&#125;
</code></pre>
<h3 id="图片上传"><a href="#图片上传" class="headerlink" title="图片上传"></a>图片上传</h3><ul>
<li>文件名UUID</li>
<li>通用唯一识别码(Universally Unique Identifier)</li>
<li>防止重名、防止爬图</li>
<li>生成规则：日期和时间、<strong>MAC地址、HashCode、随机数</strong></li>
</ul>
<pre><code class="java">com/imooc/mall/controller/ProductAdminController.java
//62.图片上传接口
    @PostMapping(&quot;admin/upload/file&quot;)
    public  ApiRestResponse upload(HttpServletRequest httpServletRequest, @RequestParam(&quot;file&quot;) MultipartFile file)&#123;
        String fileName = file.getOriginalFilename();
        String suffixName = fileName.substring(fileName.lastIndexOf(&quot;.&quot;));//用文件后面的名字
        //生成文件名称UUID
        UUID uuid = UUID.randomUUID();
        String newFileName = uuid.toString() + suffixName;
        //创建文件 放在常量类中 Constant.java
        //63.application.properties配置file.upload.dir
//        new File()
        File fileDirectory = new File(Constant.FILE_UPLOAD_DIR);
        File destFile = new File(Constant.FILE_UPLOAD_DIR + newFileName);
        if (!fileDirectory.exists())&#123;
            if (!fileDirectory.mkdir())&#123;//新建文件夹
                throw new ImoocMallException(ImoocMallExceptionEnum.MKDIR_FAILED);
            &#125;
        &#125;
        try &#123;
            file.transferTo(destFile); //传进来的写到空的方法中去
        &#125; catch (IOException e) &#123;
            throw new RuntimeException(e);
        &#125;
        try &#123;
            return ApiRestResponse.success(getHost(new URI(httpServletRequest.getRequestURL()+&quot;&quot;))+&quot;/images/&quot;+newFileName); //生成的路径IP和端口号
        &#125; catch (URISyntaxException e) &#123;
            return ApiRestResponse.error(ImoocMallExceptionEnum.UPLOAD_FAILED);
        &#125;
    &#125;
    private URI getHost(URI uri)&#123;
        URI effectiveURI;
        try &#123;
            effectiveURI = new URI(uri.getScheme(), uri.getUserInfo(), uri.getHost(), uri.getPort(),null,null,null);
        &#125; catch (URISyntaxException e) &#123;
            effectiveURI = null; //如果新建失败 就返回回去
        &#125;
        return effectiveURI;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/common/Constant.java
public class Constant &#123;
    public static final String SALT = &quot;aSp[PCx,aw.xq246&#125;&quot;;
    public static final String IMOOC_MALL_USER = &quot;imooc_mall_user&quot;;
    @Value(&quot;$&#123;file.upload.dir&#125;&quot;)
    public static String FILE_UPLOAD_DIR;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/exception/ImoocMallExceptionEnum.java
public enum ImoocMallExceptionEnum &#123;
//  正确状态码是10000 这个错误的就10001 变红是因为没构造函数
    NEED_USER_NAME(10001,&quot;用户名不能为空&quot;),
    NEED_PASSWORD_NAME(10002,&quot;密码不能为空&quot;),
    PASSWORD_TOO_SHORT(10003,&quot;密码长度不能小于8位&quot;),
    NAME_EXISTED(10004,&quot;不允许重名&quot;),
    INSERT_FAILED(10005,&quot;插入失败，请重试&quot;),
    WRONG_PASSWORD(10006,&quot;密码错误&quot;),
    NEED_LOGIN(10007,&quot;用户未登录&quot;),
    UPDATE_FAILD(10008,&quot;更新失败&quot;),
    NEED_ADMIN(10009,&quot;无管理员权限&quot;),
    NAME_NOT_NULL(10010,&quot;参数不能为空&quot;),
    PARA_NOT_NULL(10011,&quot;参数不能为空&quot;),
    CREATE_FAILED(10012,&quot;新增失败&quot;),
    REQUEST_PARAM_ERROR(10013,&quot;参数错误&quot;),
    DELETE_FAILED(10014,&quot;删除失败&quot;),
    MKDIR_FAILED(10015,&quot;文件夹创建失败&quot;),
    UPLOAD_FAILED(10015,&quot;图片上传失败&quot;),
    SYSTEM_ERROR(20000,&quot;系统异常&quot;);
&#125;
</code></pre>
<h3 id="资源映射开发"><a href="#资源映射开发" class="headerlink" title="资源映射开发"></a>资源映射开发</h3><blockquote>
<p>此时从postman中创建一个上传图片的接口<br>127.0.0.1:8083&#x2F;admin&#x2F;upload&#x2F;file<br>选择Body→form-data<br>此时上传图片会报错 {<br>  “status”: 20000,<br>  “msg”: “系统异常”,<br>  “data”: null<br>}</p>
</blockquote>
<pre><code class="java">com/imooc/mall/common/Constant.java
package com.imooc.mall.common;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

/**
 * 21.SALT常量值 写完以后去UserServiceImpl重写密码代码
 */
@Component //让spring帮注入value
public class Constant &#123;
    public static final String SALT = &quot;aSp[PCx,aw.xq246&#125;&quot;;
    public static final String IMOOC_MALL_USER = &quot;imooc_mall_user&quot;;
    public static String FILE_UPLOAD_DIR;
    //64.为了解决上传图片系统异常报错 注入失败的原因是上方是static普通变量 set方法把静态变量赋值
    @Value(&quot;$&#123;file.upload.dir&#125;&quot;)
    public void setFileUploadDir(String fileUploadDir)&#123;
        FILE_UPLOAD_DIR = fileUploadDir;
    &#125;//65.打开ImoocMallWebMvcConfig 加一个映射规则
&#125;
</code></pre>
<h3 id="自定义静态资源映射目录"><a href="#自定义静态资源映射目录" class="headerlink" title="自定义静态资源映射目录"></a>自定义静态资源映射目录</h3><ul>
<li>上传图片后回显</li>
<li>配置SpringBootWebMvcConfig</li>
<li>静态资源到本地目录的映射</li>
<li>演示打开图片</li>
</ul>
<pre><code class="java">com/imooc/mall/config/ImoocMallWebMvcConfig.java
package com.imooc.mall.config;

import com.imooc.mall.common.Constant;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/**
 * 42.配置地址映射 43去CategoryController.java 加一个 @ApiOperation(&quot;后台添加目录&quot;)
 * 44.新增一个目录的updateCategory的参数 [UpdateCategoryReq.java  ]
 */
@Configuration  //代表是一个配置
public class ImoocMallWebMvcConfig implements WebMvcConfigurer &#123;
    public void addResourceHandles(ResourceHandlerRegistry registry)&#123;
        registry.addResourceHandler(&quot;/images/**&quot;).addResourceLocations(&quot;file:&quot; + Constant.FILE_UPLOAD_DIR);
//     把地址给到对应的目录下
        registry.addResourceHandler(&quot;swagger-ui.html&quot;)
                .addResourceLocations(&quot;classpath:/META-INF/resources/&quot;);
        registry.addResourceHandler(&quot;/webjars/**&quot;).addResourceLocations(
                &quot;classpath:/META-INF/resources/webjars&quot;);
    &#125;
&#125;
</code></pre>
<h3 id="更新-UpdateProductReq-和新增-AddProductReq-商品"><a href="#更新-UpdateProductReq-和新增-AddProductReq-商品" class="headerlink" title="更新(UpdateProductReq)和新增(AddProductReq)商品"></a>更新(UpdateProductReq)和新增(AddProductReq)商品</h3><ul>
<li>合并写法不可取</li>
<li>业务逻辑清晰、独立</li>
</ul>
<pre><code class="java">com/imooc/mall/model/request/UpdateProductReq.java
public class UpdateProductReq &#123;
    @NotNull
    private Integer id; 
    private String name;
    private String image;
    private String detail;
    private Integer categoryId;
    @Min(value = 1, message = &quot;价格不能为null&quot;)
    private Integer price;

    @Max(value = 10000, message = &quot;库存不能大于10000&quot;)
    private Integer stock;

    private Integer status;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/config/ImoocMallWebMvcConfig.java
package com.imooc.mall.config;

import com.imooc.mall.common.Constant;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/**
 * 42.配置地址映射 43去CategoryController.java 加一个 @ApiOperation(&quot;后台添加目录&quot;)
 * 44.新增一个目录的updateCategory的参数 [UpdateCategoryReq.java  ]
 */
@Configuration  //代表是一个配置
public class ImoocMallWebMvcConfig implements WebMvcConfigurer &#123;
    public void addResourceHandles(ResourceHandlerRegistry registry)&#123;
        //65.增加一个registry  66.新增接口继续开发 ProductAdminController
        registry.addResourceHandler(&quot;/images/**&quot;).addResourceLocations(&quot;file:&quot; + Constant.FILE_UPLOAD_DIR);
//     把地址给到对应的目录下
        registry.addResourceHandler(&quot;swagger-ui.html&quot;)
                .addResourceLocations(&quot;classpath:/META-INF/resources/&quot;);
        registry.addResourceHandler(&quot;/webjars/**&quot;).addResourceLocations(
                &quot;classpath:/META-INF/resources/webjars&quot;);
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/controller/ProductAdminController.java
 //66. 接口 复制一个request中的AddProductReq 之后回来补全代码
    @ApiOperation(&quot;后台更新商品&quot;)
    @PostMapping(&quot;/admin/product/update&quot;)
    public ApiRestResponse updateProduct(@Valid @RequestBody UpdateProductReq updateProductReq)&#123;
        Product product = new Product();
        BeanUtils.copyProperties(updateProductReq, product);
        //67.进入ProductServiceImpl编写接口实现类
        productService.update(product);
        return ApiRestResponse.success();
    &#125;
    //68. 搞一个删除的接口 同理也在ProductServiceImpl中写实现类 之后回来补全代码
    @ApiOperation(&quot;后台删除商品&quot;)
    @PostMapping(&quot;/admin/product/delete&quot;)
    public ApiRestResponse deleteProduct(@RequestParam Integer id)&#123;
        productService.delete(id);
        return ApiRestResponse.success();
    &#125;com/imooc/mall/controller/ProductAdminController.java
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/ProductServiceImpl.java
//67.写updateProduct实现类 @Override自动导入
    @Override
    public void update(Product updateProduct) &#123;
        Product productOld = productMapper.selectByName(updateProduct.getName());
        //同名且不同id，不能继续修改
        if (productOld != null &amp;&amp; productOld.getId().equals(updateProduct.getId())) &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.NAME_EXISTED);
        &#125;
        int count = productMapper.updateByPrimaryKeySelective(updateProduct);
        if (count == 0) &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.UPDATE_FAILD);
        &#125;
    &#125;

    //68.删除实现类  @Override自动导入
    @Override
    public void delete(Integer id) &#123;
        Product productOld = productMapper.selectByPrimaryKey(id);
        //查不到该记录，无法删除
        if (productOld == null) &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.DELETE_FAILED);
        &#125;
        int count = productMapper.deleteByPrimaryKey(id);
        if (count == 0) &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.DELETE_FAILED);
        &#125;
    &#125;
</code></pre>
<h3 id="批量上下架"><a href="#批量上下架" class="headerlink" title="批量上下架"></a>批量上下架</h3><ul>
<li>MyBatis遍历List</li>
<li>where语句拼接</li>
</ul>
<pre><code class="java">com/imooc/mall/controller/ProductAdminController.java
//69. 批量上下架接口 同理也在ProductServiceImpl中写实现类 Napper中增加批量上下架的SQL
    // 之后回来补全代码
    @ApiOperation(&quot;后台批量上下架接口&quot;)
    @PostMapping(&quot;/admin/product/batchUpdateSellStatus&quot;)
    public ApiRestResponse batchUpdateSellStatus(@RequestParam Integer[] ids, @RequestParam Integer sellStatus)&#123;
        productService.batchUpdateSellStatus(ids,sellStatus);
        return ApiRestResponse.success();
    &#125;
=====================================================
127.0.0.1:8083//admin/product/batchUpdateSellStatus?ids=2,3&amp;sellStatus=0
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/ProductServiceImpl.java
//69.去ProductAdminController增加batchUpdateSellStatus接口
    @Override
    public void batchUpdateSellStatus(Integer[] ids, Integer sellStatus)&#123;
        productMapper.batchUpdateSellStatus(ids, sellStatus);
    return null;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/model/dao/ProductMapper.java
package com.imooc.mall.model.dao;

import com.imooc.mall.model.pojo.Product;
import org.apache.ibatis.annotations.Param;
import org.springframework.stereotype.Repository;

@Repository
public interface ProductMapper &#123;
    int deleteByPrimaryKey(Integer id);

    int insert(Product record);

    int insertSelective(Product record);

    Product selectByPrimaryKey(Integer id);

    int updateByPrimaryKeySelective(Product record);

    int updateByPrimaryKey(Product record);

    Product selectByName(String name);
    int batchUpdateSellStatus(@Param(&quot;ids&quot;) Integer[] ids, @Param(&quot;sellStatus&quot;) Integer sellStatus);

&#125;
</code></pre>
<pre><code class="java">mappers/ProductMapper.xml
  &lt;select id=&quot;selectByName&quot; parameterType=&quot;java.lang.String&quot; resultMap=&quot;BaseResultMap&quot;&gt;
    select &lt;include refid=&quot;Base_Column_List&quot;/&gt;
    from imooc_mall_product
    where name = #&#123;name,jdbcType = VARCHAR&#125;
  &lt;/select&gt;
  &lt;update id=&quot;batchUpdateSellStatus&quot;&gt;
    update imooc_mall_product
    set status=#&#123;sellStatus&#125;
    where id in
    &lt;foreach collection=&quot;ids&quot; close=&quot;)&quot; item=&quot;id&quot; open=&quot;(&quot; separator=&quot;,&quot;&gt;
      #&#123;id&#125;
    &lt;/foreach&gt;
  &lt;/update&gt;
</code></pre>
<h3 id="后台商品列表、商品详情接口"><a href="#后台商品列表、商品详情接口" class="headerlink" title="后台商品列表、商品详情接口"></a>后台商品列表、商品详情接口</h3><pre><code class="java">com/imooc/mall/service/impl/ProductServiceImpl.java
 //70.后台商品列表接口
    @Override
    public PageInfo listForAdmin(Integer pageNum, Integer pageSize)&#123;
        PageHelper.startPage(pageNum, pageSize); //在mapper里写查询sql
        List&lt;Product&gt; products = productMapper.selectListForAdmin();
        PageInfo pageInfo = new PageInfo(products);
        return pageInfo;
    &#125;
    //72.商品详情接口开发 再去ProductController调用
    @Override
    public Product detail(Integer id)&#123;
        Product product = productMapper.selectByPrimaryKey(id);
        return product;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/controller/ProductAdminController.java
 //70.后台商品列表接口 同理也在ProductServiceImpl中写实现类 Napper中增加批量上下架的SQL 补全代码
    //71.开发与前台商品ProductController.java
    @ApiOperation(&quot;后台商品列表接口&quot;)
    @PostMapping(&quot;/admin/product/list&quot;)
    public ApiRestResponse list(@RequestParam Integer[] pageNum, @RequestParam Integer pageSize)&#123;
        PageInfo pageInfo = productService.batchUpdateSellStatus(pageNum,pageSize);
        return ApiRestResponse.success(pageInfo);
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/controller/ProductController.java
package com.imooc.mall.controller;

import com.imooc.mall.common.ApiRestResponse;
import com.imooc.mall.model.pojo.Product;
import com.imooc.mall.service.ProductService;
import io.swagger.annotations.ApiOperation;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

/**
 * 71.前台商品Controller 72新增detail接口 ProductServiceImpl.java
 */
@RestController
public class ProductController &#123;
    @Autowired
    ProductService productService;

    @ApiOperation(&quot;商品详情&quot;)
    @GetMapping(&quot;product/detail&quot;)
    public ApiRestResponse detail(@RequestParam Integer id)&#123;
        Product product = productService.detail(id);
        return ApiRestResponse.success(product);
    &#125;
&#125;
</code></pre>
<h3 id="前台商品列表接口part1"><a href="#前台商品列表接口part1" class="headerlink" title="前台商品列表接口part1"></a>前台商品列表接口part1</h3><h5 id="商品列表：搜索功能"><a href="#商品列表：搜索功能" class="headerlink" title="商品列表：搜索功能"></a>商品列表：搜索功能</h5><p>入参判空 → 加%通配符 → like关键字</p>
<h5 id="对于查询目录的in处理"><a href="#对于查询目录的in处理" class="headerlink" title="对于查询目录的in处理"></a>对于查询目录的in处理</h5><ul>
<li>目录处理：如果查某个目录下的商品，不仅是需要查出来该目录的，还需要查出来子目录的所有商品</li>
<li>所以这里要拿到某一个目录Id下的所有子目录id的List</li>
</ul>
<h5 id="前台：商品列表"><a href="#前台：商品列表" class="headerlink" title="前台：商品列表"></a>前台：商品列表</h5><ul>
<li>排序功能</li>
<li>MyBatis PageHelper</li>
<li>枚举：order by [自定义]</li>
</ul>
<pre><code class="java">com/imooc/mall/service/impl/ProductServiceImpl.java
//72.商品详情接口开发 再去ProductController调用
    @Override
    public Product detail(Integer id)&#123;
        Product product = productMapper.selectByPrimaryKey(id);
        return product;
    &#125;
    //73.完成实现类
    @Override
    public PageInfo list(ProductListReq productListReq)&#123;
        //复杂查询就构建一个querry对象 ProductListQuery.java
        ProductListQuery productListQuery = new ProductListQuery();
        //☆☆搜索处理☆☆  拼接且转换成字符串去数据库查找
        if (!StringUtils.isEmpty(productListReq.getKeyword()))&#123;
            String keyword = new StringBuilder().append(&quot;%&quot;).append(productListReq.getKeyword()).append(&quot;%&quot;).toString();
            productListQuery.setKeyword(keyword);
        &#125;
        //☆☆目录处理☆☆：如果查某个目录下的商品，不仅是需要查出该目录下的，还要把所有子目录的所有商品都查出来，所以要拿到一个目录id的List
        if (productListReq.getCategoryId() != null)&#123;
            //要拿到子目录 引用CategoryService   CategoryVO原本是给前台目录用的 需要重构一下 不是所有目录而是指定目录
            //改动代码 CategoryServiceImpl.java中的listCategoryForCustomer 传入的参数是Integer parentId
            //productListReq获取了所有根节点的list  因为点开List&lt;CategoryVO&gt;里面包括一个  private List&lt;CategoryVO&gt;递归结构
            List&lt;CategoryVO&gt; categoryVOList = categoryService.listCategoryForCustomer(productListReq.getCategoryId());
            ArrayList&lt;Integer&gt; categoryIds = new ArrayList&lt;&gt;(); //拿过来之后存储的list
            categoryIds.add(productListReq.getCategoryId());
            getCategoryIds(categoryVOList,categoryIds);
            productListQuery.setCategoryIds(categoryIds);
        &#125;
        //74.排序能力 错误:前端传什么就 就传到sql中排序  这样是不安全的 要提前处理好
        //☆☆排序处理☆☆：去Constant定义支持的排序模式和手段
        String orderBy = productListReq.getOrderBy();
        if (Constant.ProductListOrderBy.PRICE_ASC_DESC.contains(orderBy)) &#123;
            PageHelper.startPage(productListReq.getPageNum(), productListReq.getPageSize(), orderBy);
        &#125;else &#123;//前端不一定包含数据的话就不排序了
            PageHelper.startPage(productListReq.getPageNum(), productListReq.getPageSize());
        &#125;//75.去写Mapper 最后回到ProductController写调用
        List&lt;Product&gt; productList = productMapper.selectList(productListQuery);
        PageInfo pageInfo = new PageInfo(productList);
        return pageInfo;
    &#125;
    //74.写一个方法拿到所有的id 拿到参数之后往哪里存放
    private void getCategoryIds(List&lt;CategoryVO&gt;categoryVOList, ArrayList&lt;Integer&gt; categoryIds)&#123;
        for (int i = 0; i &lt; categoryVOList.size(); i++) &#123;
            CategoryVO categoryVO =  categoryVOList.get(i);
            if (categoryVO != null)&#123;
                categoryIds.add(categoryVO.getId());
                //递归子节点 子子节点
                getCategoryIds(categoryVO.getChildCategory(), categoryIds); //去上面调用方法 传入对象
            &#125;
            
        &#125;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/model/query/ProductListQuery.java
package com.imooc.mall.model.query;

import java.util.List;

/**
 * 查询商品列表的Query
 */
public class ProductListQuery &#123;
    private String keyword;
    private List&lt;Integer&gt; categoryIds;
&#125;Getter+Setter
</code></pre>
<pre><code class="java">com/imooc/mall/model/dao/ProductMapper.java
package com.imooc.mall.model.dao;

import com.imooc.mall.model.pojo.Product;
import com.imooc.mall.model.query.ProductListQuery;
import org.apache.ibatis.annotations.Param;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface ProductMapper &#123;
    List&lt;Product&gt; selectListForAdmin(); //给前台用户用的
    List&lt;Product&gt; selectList(@Param(&quot;ids&quot;)ProductListQuery query); //给后台用户用的 Type是一个类

&#125;
</code></pre>
<pre><code class="java">mappers/ProductMapper.xml
 &lt;select id=&quot;selectList&quot; resultMap=&quot;BaseResultMap&quot;
          parameterType=&quot;com.imooc.mall.model.query.ProductListQuery&quot;&gt;
    select
    &lt;include refid=&quot;Base_Column_List&quot;/&gt;
    from imooc_mall_product
    &lt;where&gt;
      &lt;if test=&quot;query.keyword != null&quot;&gt;
        and name like #&#123;query.keyword&#125;
      &lt;/if&gt;
      &lt;if test=&quot;query.categoryIds != null&quot;&gt;
        and category_id in
        &lt;foreach collection=&quot;query.categoryIds&quot; close=&quot;)&quot; item=&quot;item&quot; open=&quot;(&quot; separator=&quot;,&quot;&gt;
          #&#123;item&#125;
        &lt;/foreach&gt;
      &lt;/if&gt;
      and status = 1
    &lt;/where&gt;
    order by update_time desc
  &lt;/select&gt;
</code></pre>
<pre><code class="java">com/imooc/mall/model/dao/ProductMapper.java
package com.imooc.mall.model.dao;

import com.imooc.mall.model.pojo.Product;
import com.imooc.mall.model.query.ProductListQuery;
import org.apache.ibatis.annotations.Param;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface ProductMapper &#123;
    int deleteByPrimaryKey(Integer id);

    int insert(Product record);

    int insertSelective(Product record);

    Product selectByPrimaryKey(Integer id);

    int updateByPrimaryKeySelective(Product record);

    int updateByPrimaryKey(Product record);

    Product selectByName(String name);
    int batchUpdateSellStatus(@Param(&quot;ids&quot;) Integer[] ids, @Param(&quot;sellStatus&quot;) Integer sellStatus);

    List&lt;Product&gt; selectListForAdmin(); //给前台用户用的

    List&lt;Product&gt; selectList(@Param(&quot;query&quot;)ProductListQuery query); //给后台用户用的 Type是一个类

&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/controller/ProductController.java
package com.imooc.mall.controller;

import com.github.pagehelper.PageInfo;
import com.imooc.mall.common.ApiRestResponse;
import com.imooc.mall.model.pojo.Product;
import com.imooc.mall.model.request.ProductListReq;
import com.imooc.mall.service.ProductService;
import io.swagger.annotations.ApiOperation;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

/**
 * 71.前台商品Controller 72新增detail接口 ProductServiceImpl.java
 */
@RestController
public class ProductController &#123;
    @Autowired
    ProductService productService;

    @ApiOperation(&quot;商品详情&quot;)
    @GetMapping(&quot;product/detail&quot;)
    public ApiRestResponse detail(@RequestParam Integer id)&#123;
        Product product = productService.detail(id);
        return ApiRestResponse.success(product);
    &#125;
    //73.开发前台商品列表 开一个ProductListReq.java 去ProductServiceImpl
    @ApiOperation(&quot;商品详情&quot;)
    @GetMapping(&quot;product/list&quot;)
    public ApiRestResponse list(ProductListReq productListReq)&#123;
        PageInfo list = productService.list(productListReq);
        return ApiRestResponse.success(list);
    &#125;
&#125;
</code></pre>
<h3 id="总结商品模块"><a href="#总结商品模块" class="headerlink" title="总结商品模块"></a>总结商品模块</h3><ul>
<li>重难点：<strong>商品的搜索</strong>[<u>like</u>]、<strong>排序</strong>[<u>枚举+自定义</u>]、<strong>目录查询</strong>[<u>所有目录id都查到  再用查询列表方式</u>]</li>
<li>常见错误：更新和新增放在同一个接口、排序字段不用枚举</li>
</ul>
<h3 id="购物车模块介绍"><a href="#购物车模块介绍" class="headerlink" title="购物车模块介绍"></a>购物车模块介绍</h3><h5 id="业务流程"><a href="#业务流程" class="headerlink" title="业务流程"></a>业务流程</h5><ul>
<li>添加商品到购物车 → 商品是否在售、是否有库存 <ul>
<li>→[否] 提示用户</li>
<li>→[是] 该商品之前就在购物车里<ul>
<li>→[否] 添加新商品</li>
<li>→[是] 原有基础上添加数量</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code class="java">com/imooc/mall/controller/CartController.java
package com.imooc.mall.controller;

import com.imooc.mall.common.ApiRestResponse;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

/**
 * 76.购物车Controller  77.用一个通用UserFilter逻辑
 */
@Controller
@RequestMapping(&quot;/cart&quot;)
public class CartController &#123;//因为放在url中 要加数据绑定 通过HttpSession获取用户信息太麻烦 用一个通用filter逻辑
    @PostMapping(&quot;/add&quot;)
    public ApiRestResponse add(@RequestParam Integer productId, @RequestParam Integer count)&#123;
        return null;
    &#125;
&#125;
========================================================
127.0.0.1:8083/cart/add?productId=22&amp;count=1
</code></pre>
<pre><code class="java">com/imooc/mall/filter/UserFilter.java
package com.imooc.mall.filter;

import com.imooc.mall.common.Constant;
import com.imooc.mall.model.pojo.User;
import com.imooc.mall.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;

import javax.servlet.*;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpServletResponseWrapper;
import javax.servlet.http.HttpSession;
import java.io.IOException;
import java.io.PrintWriter;

/**
 *
 * 77.用户过滤器 希望把用户信息currentUser保存下来
 */
public class UserFilter implements Filter &#123;
    public static User currentUser;
    @Autowired
    UserService userService;
    @Override
    public void init(FilterConfig filterConfig) throws ServletException &#123;

    &#125;

    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123;
        //对身份进行校验 用session获取当前的用户
        HttpServletRequest request = (HttpServletRequest)servletRequest;
        HttpSession session = request.getSession();
        currentUser = (User) session.getAttribute(Constant.IMOOC_MALL_USER);
        if (currentUser == null) &#123;
            PrintWriter out = new HttpServletResponseWrapper((HttpServletResponse) servletResponse).getWriter();
            out.write(&quot;&#123;\n&quot; //用户未登录
                    + &quot;    \&quot;status\&quot;: 10007,\n&quot;
                    + &quot;    \&quot;msg\&quot;: \&quot;NEED_LOGIN\&quot;,\n&quot;
                    + &quot;    \&quot;data\&quot;: null\n&quot;
                    + &quot;&#125;&quot;);
            out.flush();
            out.close();
            return;
        &#125;
        //78.续写过滤器链条 写好后对用户链条进行config配置 UserFilterConfig.java
        filterChain.doFilter(servletRequest,servletResponse);
    &#125;

    @Override
    public void destroy() &#123;

    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/config/UserFilterConfig.java
package com.imooc.mall.config;

import com.imooc.mall.filter.UserFilter;
import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * 78.对调用接口时对哪个类进行拦截 过滤器的配置 79创建cartService
 */
@Configuration
public class UserFilterConfig &#123;
    @Bean
    public UserFilter userFilter()&#123;
        return new UserFilter();
    &#125;
    @Bean(name = &quot;userFilterConf&quot;)
    public FilterRegistrationBean adminFilterConfig()&#123;
        FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean();
        filterRegistrationBean.setFilter(userFilter());
        //下面的是校验与拦截
        filterRegistrationBean.addUrlPatterns(&quot;/cart/*&quot;); //CartController.java
        filterRegistrationBean.addUrlPatterns(&quot;/order/*&quot;);
        filterRegistrationBean.setName(&quot;userFilterConf&quot;);
        return filterRegistrationBean;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/CartServiceImpl.java
package com.imooc.mall.service.impl;

import com.imooc.mall.common.Constant;
import com.imooc.mall.exception.ImoocMallException;
import com.imooc.mall.exception.ImoocMallExceptionEnum;
import com.imooc.mall.model.dao.CategoryMapper;
import com.imooc.mall.model.dao.ProductMapper;
import com.imooc.mall.model.pojo.Product;
import com.imooc.mall.model.vo.CartVO;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

/**
 * 80.购物车Service实现类 其中List&lt;&gt;中间是需要包括 商品id 图片 名字 商品选中 数量信息
 * 81.创建一个VO增加那些属性放在&lt;&gt;中 是返回给前端组合后的对象
 */
@Service
public class CartServiceImpl &#123;
    @Autowired
    ProductMapper productMapper;
    @Autowired
    CategoryMapper categoryMapper;

    public List&lt;CartVO&gt; add(Integer userId, Integer productId, Integer count) &#123;
        validProduct(productId, count);

    &#125;

    private void validProduct(Integer productId, Integer count) &#123;
        Product product = productMapper.selectByPrimaryKey(productId);
        //判断商品是否存在，商品是否上架
        if (product == null || product.getStatus().equals(Constant.SaleStatus.NOT_SALE)) &#123;
            //82. 1是上架 1不明确要形成代码让顾客知道 Constant.java
            throw new ImoocMallException(ImoocMallExceptionEnum.NOT_SALE);
        &#125;
        //判断商品库存 如果要买的比库存多 就买不了
        if (count &gt; product.getStock()) &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.NOT_ENOUGH);
        &#125;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/common/Constant.java
    //83.创建商品上下架的状态 创建CartMapper[Cart selectCartByUserIdAndProductId] 写sql 
    //84再去CartServiceImpl
    public interface SaleStatus&#123;
        int NOT_SALE = 0; //商品下架状态
        int SALE = 1; //商品上架状态
    &#125;
</code></pre>
<pre><code class="java">@Service
public class CartServiceImpl implements CartService &#123;
    @Autowired
    ProductMapper productMapper;
    @Autowired
    CategoryMapper categoryMapper;
    @Autowired
    CartMapper cartMapper;
@Override
    public List&lt;CartVO&gt; add(Integer userId, Integer productId, Integer count) &#123;
        validProduct(productId, count);
        Cart cart = cartMapper.selectCartByUserIdAndProductId(userId, productId);
        //84.补全代码
        if (cart==null)&#123;
            //这个商品之前不在购物车里，需要新增一个记录
            cart = new Cart();
            cart.setProductId(productId);
            cart.setUserId(userId);
            cart.setQuantity(count);
            cart.setSelected(Constant.Cart.CHECKED);
            cartMapper.insertSelective(cart);
        &#125;else &#123;
            //这个商品已经在购物车里了，数量相加
            count = cart.getQuantity() + count;
            Cart cartNew = new Cart();
            cartNew.setQuantity(count);
            cartNew.setId(cart.getId());
            cartNew.setProductId(cart.getProductId());
            cartNew.setUserId(cart.getUserId());
            //无论是否想买都选中
            cartNew.setSelected(Constant.Cart.CHECKED);
            cartMapper.updateByPrimaryKeySelective(cartNew);
        &#125;
        //85.去CartController补全代码逻辑 返回购物车列表哦~ 86.CartMapper.java
        return null;
    &#125;

    private void validProduct(Integer productId, Integer count) &#123;
        Product product = productMapper.selectByPrimaryKey(productId);
        //判断商品是否存在，商品是否上架
        if (product == null || product.getStatus().equals(Constant.SaleStatus.NOT_SALE)) &#123;
            //82. 1是上架 1不明确要形成代码让顾客知道 Constant.java
            throw new ImoocMallException(ImoocMallExceptionEnum.NOT_SALE);
        &#125;
        //判断商品库存 如果要买的比库存多 就买不了
        if (count &gt; product.getStock()) &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.NOT_ENOUGH);
        &#125;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/model/dao/CartMapper.java
package com.imooc.mall.model.dao;

import com.imooc.mall.model.pojo.Cart;
import com.imooc.mall.model.vo.CartVO;
import org.apache.ibatis.annotations.Param;
import org.springframework.stereotype.Repository;
import org.springframework.web.bind.annotation.ResponseBody;

import java.util.List;

@Repository
public interface CartMapper &#123;
    int deleteByPrimaryKey(Integer id);

    int insert(Cart record);

    int insertSelective(Cart record);

    Cart selectByPrimaryKey(Integer id);

    int updateByPrimaryKeySelective(Cart record);

    int updateByPrimaryKey(Cart record);

    //86.选中列表的方法 传入的参数是userId
    List&lt;CartVO&gt; selectList(@Param(&quot;userId&quot;) Integer userId);
    Cart selectCartByUserIdAndProductId(@Param(&quot;userId&quot;) Integer userId, @Param(&quot;productId&quot;)Integer productId);
&#125;
</code></pre>
<pre><code class="xml">mappers/CartMapper.xml
 &lt;select id=&quot;selectList&quot; resultType=&quot;com.imooc.mall.model.vo.CartVO&quot; parameterType=&quot;java.lang.Integer&quot;&gt;
    select
    c.id as id,
    p.id as productId,
    c.user_id as userId,
    c.quantity as quantity,
    c.selected as selected,
    p.price as price,
    p.name as productName,
    p.image as productImage
    from imooc_mall_cart c
    left join imooc_mall_product p on p.id = c.product_id
    where c.user_id = #&#123;userId&#125;
    and p.status = 1
  &lt;/select&gt;
</code></pre>
<pre><code class="java">com/imooc/mall/controller/CartController.java
package com.imooc.mall.controller;

import com.imooc.mall.common.ApiRestResponse;
import com.imooc.mall.filter.UserFilter;
import com.imooc.mall.model.vo.CartVO;
import com.imooc.mall.service.CartService;
import io.swagger.annotations.ApiOperation;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

/**
 * 76.购物车Controller  77.用一个通用User_filter逻辑
 */
@RestController //404的错误① 返回的json格式 要用RestController
@RequestMapping(&quot;/cart&quot;)
public class CartController &#123;//因为放在url中 要加数据绑定 通过HttpSession获取用户信息太麻烦 用一个通用filter逻辑
    @Autowired
    CartService cartService;
    @PostMapping(&quot;/list&quot;)
    @ApiOperation(&quot;购物车列表&quot;)
    public ApiRestResponse list()&#123;
        //86.去写service的list接口 CartMapper中写选中列表的方法
        //内部获取用户Id,防止横向越权
        List&lt;CartVO&gt; cartList = cartService.list(UserFilter.currentUser.getId());
        return ApiRestResponse.success();
    &#125;

    @PostMapping(&quot;/add&quot;)
    @ApiOperation(&quot;添加商品到购物车&quot;)
    public ApiRestResponse add(@RequestParam Integer productId, @RequestParam Integer count)&#123;
        //85.补全完逻辑代码 87在下面补全代码 List&lt;CartVO&gt; cartVOList =
        List&lt;CartVO&gt; cartVOList = cartService.add(UserFilter.currentUser.getId(), productId, count);
        return ApiRestResponse.success(cartVOList);
    &#125;
&#125;
</code></pre>
<h3 id="更新、删除购物车接口"><a href="#更新、删除购物车接口" class="headerlink" title="更新、删除购物车接口"></a>更新、删除购物车接口</h3><pre><code class="java">com/imooc/mall/controller/CartController.java
@PostMapping(&quot;/update&quot;)
    @ApiOperation(&quot;更新购物车&quot;)
    public ApiRestResponse update(@RequestParam Integer productId, @RequestParam Integer count)&#123;
        //86.去service层中写更新方法 CartServiceImpl.java
        List&lt;CartVO&gt; cartVOList = cartService.update(UserFilter.currentUser.getId(), productId, count);
        return ApiRestResponse.success(cartVOList);
    &#125;

    @PostMapping(&quot;/delete&quot;)
    @ApiOperation(&quot;删除保护购物车&quot;)
    public ApiRestResponse delete(@RequestParam Integer productId)&#123;
        //87.删除保护购物车方法
        //不能传入userId, cartId, 否则可以删除别人的购物车
        List&lt;CartVO&gt; cartVOList = cartService.delete(UserFilter.currentUser.getId(), productId);
        return ApiRestResponse.success(cartVOList);
    &#125;
=====================================================================
127.0.0.1:8083/cart/delete?productId=22
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/CartServiceImpl.java
 @Override
    public List&lt;CartVO&gt; update(Integer userId, Integer productId, Integer count)&#123;
        //86.去service层中写更新方法
        validProduct(productId, count);
        Cart cart = cartMapper.selectCartByUserIdAndProductId(userId, productId);
        if (cart==null)&#123;
            //这个商品之前不在购物车里，无法更新
            throw new ImoocMallException(ImoocMallExceptionEnum.UPDATE_FAILD);
        &#125;else &#123;
            //这个商品已经在购物车里了，则更新数量
            Cart cartNew = new Cart();
            cartNew.setQuantity(count);
            cartNew.setId(cart.getId());
            cartNew.setProductId(cart.getProductId());
            cartNew.setUserId(cart.getUserId());
            //无论是否想买都选中
            cartNew.setSelected(Constant.Cart.CHECKED);
            cartMapper.updateByPrimaryKeySelective(cartNew);
        &#125;
        return this.list(userId);
    &#125;

    @Override
    public List&lt;CartVO&gt; delete(Integer userId, Integer productId)&#123;
        //86.去service层中写更新方法
        Cart cart = cartMapper.selectCartByUserIdAndProductId(userId, productId);
        if (cart==null)&#123;
            //这个商品之前不在购物车里，无法更新
            throw new ImoocMallException(ImoocMallExceptionEnum.DELETE_FAILED);
        &#125;else &#123;
            //这个商品已经在购物车里了，则可以删除
            cartMapper.deleteByPrimaryKey(cart.getId());
        &#125;
        return this.list(userId);
    &#125;
======================================================================
127.0.0.1:8083/cart/update?productId=22&amp;count=1
</code></pre>
<pre><code class="java">com/imooc/mall/service/CartService.java
package com.imooc.mall.service;

import com.github.pagehelper.PageInfo;
import com.imooc.mall.model.pojo.Category;
import com.imooc.mall.model.request.AddCategoryReq;
import com.imooc.mall.model.vo.CartVO;
import com.imooc.mall.model.vo.CategoryVO;

import java.util.List;

/**
 * 79.购物车service 增加CartServiceImpl
 */
public interface CartService &#123;

    //87.补全list实现类
    List&lt;CartVO&gt; list(Integer userId);

    List&lt;CartVO&gt; add(Integer userId, Integer productId, Integer count);

    List&lt;CartVO&gt; update(Integer userId, Integer productId, Integer count);

    List&lt;CartVO&gt; delete(Integer userId, Integer productId);
&#125;
</code></pre>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/624114484">浅谈@RequestParam、@RequestBody、@PathVariable - 知乎 (zhihu.com)</a></p>
<h3 id="选中购物车相关接口"><a href="#选中购物车相关接口" class="headerlink" title="选中购物车相关接口"></a>选中购物车相关接口</h3><pre><code class="java">com/imooc/mall/controller/CartController.java
 @PostMapping(&quot;/select&quot;)
    @ApiOperation(&quot;选择/不选择购物车的某商品&quot;)
    public ApiRestResponse select(@RequestParam Integer productId, @RequestParam Integer selected)&#123;
        //88.选/不选购物车某商品
        //不能传入userId, cartId, 否则可以删除别人的购物车
        List&lt;CartVO&gt; cartVOList = cartService.selectOrNot(UserFilter.currentUser.getId(), productId,selected);
        return ApiRestResponse.success(cartVOList);
    &#125;

    @PostMapping(&quot;/selectAll&quot;)
    @ApiOperation(&quot;全选择/全不选择购物车的某商品&quot;)
    public ApiRestResponse selectAll(@RequestParam Integer selected)&#123;
        //89.全选/全不选购物车某商品
        //不能传入userId, cartId, 否则可以删除别人的购物车
////90.订单模块接口编写 91创建OrderController.java  OrderService.java  OrderServiceImpl.java
        List&lt;CartVO&gt; cartVOList = cartService.selectAllOrNot(UserFilter.currentUser.getId(), selected);
        return ApiRestResponse.success(cartVOList);
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/CartServiceImpl.java
    @Override
    public List&lt;CartVO&gt; selectOrNot(Integer userId, Integer productId, Integer selected)&#123;
        Cart cart = cartMapper.selectCartByUserIdAndProductId(userId, productId);
        if (cart==null)&#123;
            //88.这个商品之前不在购物车里，无法选择/不选中
            throw new ImoocMallException(ImoocMallExceptionEnum.UPDATE_FAILD);
        &#125;else &#123;
            //这个商品已经在购物车里了，则可以选中/不选中
            cartMapper.selectOrNot(userId, productId, selected);
        &#125;//返回购物车列表
        return this.list(userId);
    &#125;

    @Override
    public List&lt;CartVO&gt; selectAllOrNot(Integer userId, Integer selected)&#123;
        //89.这里填null是对mapper中的sql进行等于null判断的语句 改变选中状态
        cartMapper.selectOrNot(userId, null, selected);
        return this.list(userId);
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/CartService.java
package com.imooc.mall.service;

import com.github.pagehelper.PageInfo;
import com.imooc.mall.model.pojo.Category;
import com.imooc.mall.model.request.AddCategoryReq;
import com.imooc.mall.model.vo.CartVO;
import com.imooc.mall.model.vo.CategoryVO;

import java.util.List;

/**
 * 79.购物车service 增加CartServiceImpl
 */
public interface CartService &#123;

    //87.补全list实现类
    List&lt;CartVO&gt; list(Integer userId);

    List&lt;CartVO&gt; add(Integer userId, Integer productId, Integer count);

    List&lt;CartVO&gt; update(Integer userId, Integer productId, Integer count);

    List&lt;CartVO&gt; delete(Integer userId, Integer productId);

    List&lt;CartVO&gt; selectOrNot(Integer userId, Integer productId, Integer selected);

    List&lt;CartVO&gt; selectAllOrNot(Integer userId, Integer selected);
&#125;
</code></pre>
<h3 id="总结购物车模块"><a href="#总结购物车模块" class="headerlink" title="总结购物车模块"></a>总结购物车模块</h3><ul>
<li><h5 id="重难点"><a href="#重难点" class="headerlink" title="重难点"></a>重难点</h5><ul>
<li>MyBatis返回非标准对象、后期计算单样商品的总价 [数据库无法直接查到]</li>
<li>添加商品到购物车时，根据是否已经存在该商品，有不同逻辑</li>
</ul>
</li>
<li><p>常见错误：不做越权判断 [不允许前端传入Id]</p>
</li>
</ul>
<h3 id="创建订单接口-主流程框架搭建"><a href="#创建订单接口-主流程框架搭建" class="headerlink" title="创建订单接口 - 主流程框架搭建"></a>创建订单接口 - 主流程框架搭建</h3><ul>
<li>登录 → 浏览商品 → 加入购物车 → 下单 <ul>
<li>​                                                            → 取消订单</li>
<li>​                                                            → 扫码支付 → 发货 → 收获 → 订单完结</li>
</ul>
</li>
</ul>
<h3 id="生成订单-——-用户下单"><a href="#生成订单-——-用户下单" class="headerlink" title="生成订单 —— 用户下单"></a>生成订单 —— 用户下单</h3><ul>
<li>入参</li>
<li>从购物车中查找已经勾选的商品</li>
<li>判断商品是否正在售卖中</li>
<li>判断库存，保证不超卖，扣库存</li>
<li>数据库事务(实操演示效果)</li>
<li>删除购物车中对应的商品</li>
<li>生成订单</li>
<li>订单号生成规则</li>
<li>循环保存每个商品到order_item表</li>
<li>进入Coding阶段</li>
</ul>
<pre><code class="java">com/imooc/mall/controller/OrderController.java
package com.imooc.mall.controller;

import com.imooc.mall.common.ApiRestResponse;
import com.imooc.mall.model.request.CreateOrderReq;
import com.imooc.mall.service.OrderService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

/**
 * 91.订单Controller 新建一个根据pojo的Order → CreateOrderReq 新建一个OrderService
 */
@RestController
public class OrderController &#123;
    @Autowired
    OrderService orderService;

    @PostMapping(&quot;order/create&quot;)
    public ApiRestResponse create(@RequestBody CreateOrderReq createOrderReq)&#123;
        return null;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/OrderServiceImpl.java
package com.imooc.mall.service.impl;

import com.imooc.mall.common.Constant;
import com.imooc.mall.exception.ImoocMallException;
import com.imooc.mall.exception.ImoocMallExceptionEnum;
import com.imooc.mall.filter.UserFilter;
import com.imooc.mall.model.dao.CartMapper;
import com.imooc.mall.model.dao.CategoryMapper;
import com.imooc.mall.model.dao.ProductMapper;
import com.imooc.mall.model.pojo.Cart;
import com.imooc.mall.model.pojo.Product;
import com.imooc.mall.model.request.CreateOrderReq;
import com.imooc.mall.model.vo.CartVO;
import com.imooc.mall.service.CartService;
import com.imooc.mall.service.OrderService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.util.CollectionUtils;

import java.util.ArrayList;
import java.util.List;

/**
 * 91.★★ 订单Service实现类 ★★
 */
@Service
public class OrderServiceImpl implements OrderService &#123;
    @Autowired
    CartService cartService;

    public String create(CreateOrderReq createOrderReq) &#123;
        //拿到用户ID
        Integer userId = UserFilter.currentUser.getId();
        //从购物车查找已经勾选的商品 CartVO里面包含着任何信息
        List&lt;CartVO&gt; cartVOList = cartService.list(userId);
        //勾选的单独拿出来
        ArrayList&lt;CartVO&gt; cartVOListTemp = new ArrayList&lt;&gt;();
        for (int i = 0; i &lt; cartVOList.size(); i++) &#123;
            CartVO cartVO = cartVOList.get(i);
            if (cartVO.getSelected().equals(Constant.Cart.CHECKED)) &#123;
                cartVOListTemp.add(cartVO);
            &#125;
        &#125;
        cartVOList = cartVOListTemp;
        //如果购物车已勾选的为空,报错
        if (CollectionUtils.isEmpty(cartVOList))&#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.CART_EMPTY);
        &#125;
    &#125;
    //判断商品是否存在、上下架状态、库存
    //把购物车对象转换为订单item对象
    //扣库存
    //把购物车中的已勾选商品删除
    //生成订单
    //生成订单号,有独立的规则
    //循环保存每个商品的order_item表
    //把结果返回
&#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/exception/ImoocMallExceptionEnum.java
package com.imooc.mall.exception;

/**
 * 异常枚举
 */
//13.编写异常枚举 注意类是enum噢  14返回ApiRestResponse
public enum ImoocMallExceptionEnum &#123;
//  正确状态码是10000 这个错误的就10001 变红是因为没构造函数
    NEED_USER_NAME(10001,&quot;用户名不能为空&quot;),
    NEED_PASSWORD_NAME(10002,&quot;密码不能为空&quot;),
    PASSWORD_TOO_SHORT(10003,&quot;密码长度不能小于8位&quot;),
    NAME_EXISTED(10004,&quot;不允许重名&quot;),
    INSERT_FAILED(10005,&quot;插入失败，请重试&quot;),
    WRONG_PASSWORD(10006,&quot;密码错误&quot;),
    NEED_LOGIN(10007,&quot;用户未登录&quot;),
    UPDATE_FAILD(10008,&quot;更新失败&quot;),
    NEED_ADMIN(10009,&quot;无管理员权限&quot;),
    NAME_NOT_NULL(10010,&quot;参数不能为空&quot;),
    CREATE_FAILED(10011,&quot;新增失败&quot;),
    REQUEST_PARAM_ERROR(10012,&quot;参数错误&quot;),
    DELETE_FAILED(10013,&quot;删除失败&quot;),
    MKDIR_FAILED(10014,&quot;文件夹创建失败&quot;),
    UPLOAD_FAILED(10015,&quot;图片上传失败&quot;),
    NOT_SALE(10016,&quot;商品状态不可售&quot;),
    NOT_ENOUGH(10017,&quot;商品库存不足&quot;),
    CART_EMPTY(10018, &quot;购物车已勾选的商品为空&quot;),
    SYSTEM_ERROR(20000,&quot;系统异常&quot;);


    //异常码
    Integer code;
    //异常信息
    String msg;

    ImoocMallExceptionEnum(Integer code, String msg) &#123;
        this.code = code;
        this.msg = msg;
    &#125;

    public Integer getCode() &#123;
        return code;
    &#125;

    public void setCode(Integer code) &#123;
        this.code = code;
    &#125;

    public String getMsg() &#123;
        return msg;
    &#125;

    public void setMsg(String msg) &#123;
        this.msg = msg;
    &#125;
&#125;
</code></pre>
<h3 id="创建订单-——-对象转换与扣库存"><a href="#创建订单-——-对象转换与扣库存" class="headerlink" title="创建订单 —— 对象转换与扣库存"></a>创建订单 —— 对象转换与扣库存</h3><pre><code class="java">com/imooc/mall/controller/OrderController.java
package com.imooc.mall.controller;

import com.imooc.mall.common.ApiRestResponse;
import com.imooc.mall.model.request.CreateOrderReq;
import com.imooc.mall.service.OrderService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

/**
 * 91.订单Controller 新建一个根据pojo的Order → CreateOrderReq 新建一个OrderService
 */
@RestController
public class OrderController &#123;
    @Autowired
    OrderService orderService;

    @PostMapping(&quot;order/create&quot;)
    @ApiOperation(&quot;创建订单&quot;)
    public ApiRestResponse create(@RequestBody CreateOrderReq createOrderReq)&#123;
        //95.调用orderService
        String orderNo = orderService.create(createOrderReq);
        return ApiRestResponse.success(orderNo);
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/OrderServiceImpl.java
package com.imooc.mall.service.impl;

import com.imooc.mall.common.Constant;
import com.imooc.mall.exception.ImoocMallException;
import com.imooc.mall.exception.ImoocMallExceptionEnum;
import com.imooc.mall.filter.UserFilter;
import com.imooc.mall.model.dao.*;
import com.imooc.mall.model.pojo.Order;
import com.imooc.mall.model.pojo.OrderItem;
import com.imooc.mall.model.pojo.Product;
import com.imooc.mall.model.request.CreateOrderReq;
import com.imooc.mall.model.vo.CartVO;
import com.imooc.mall.service.CartService;
import com.imooc.mall.service.OrderService;
import com.imooc.mall.util.OrderCodeFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.util.CollectionUtils;

import java.util.ArrayList;
import java.util.List;

/**
 * 91.★★ 订单Service实现类 ★★
 */
@Service
public class OrderServiceImpl implements OrderService &#123;
    @Autowired
    CartService cartService;
    @Autowired
    ProductMapper productMapper;
    @Autowired
    CartMapper cartMapper;
    @Autowired
    OrderMapper orderMapper;
    @Autowired
    OrderItemMapper orderItemMapper;
    @Override
    public String create(CreateOrderReq createOrderReq) &#123;
        //拿到用户ID
        Integer userId = UserFilter.currentUser.getId();
        //从购物车查找已经勾选的商品 CartVO里面包含着任何信息
        List&lt;CartVO&gt; cartVOList = cartService.list(userId);
        //勾选的单独拿出来
        ArrayList&lt;CartVO&gt; cartVOListTemp = new ArrayList&lt;&gt;();
        for (int i = 0; i &lt; cartVOList.size(); i++) &#123;
            CartVO cartVO = cartVOList.get(i);
            if (cartVO.getSelected().equals(Constant.Cart.CHECKED)) &#123;
                cartVOListTemp.add(cartVO);
            &#125;
        &#125;
        cartVOList = cartVOListTemp;
        //如果购物车已勾选的为空,报错
        if (CollectionUtils.isEmpty(cartVOList))&#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.CART_EMPTY);
        &#125;
        //判断商品是否存在、上下架状态、库存
        validSaleStatusAndStock(cartVOList);
        //把购物车对象转换为订单item对象
        List&lt;OrderItem&gt; orderItemList = cartVOListToOrderItemList(cartVOList);
        //扣库存
        for (int i = 0; i &lt; orderItemList.size(); i++) &#123;
            OrderItem orderItem =  orderItemList.get(i);
            Product product = productMapper.selectByPrimaryKey(orderItem.getProductId());
            int stock = product.getStock() - orderItem.getQuantity();
            if (stock &lt; 0)&#123;
                throw new ImoocMallException(ImoocMallExceptionEnum.NOT_ENOUGH);
            &#125;
            product.setStock(stock);
            productMapper.updateByPrimaryKeySelective(product);
        &#125;
        //把购物车中的已勾选商品删除
        cleanCart(cartVOList);
        //生成订单
        Order order = new Order();
        //93.创建一个Util/OrderCodeFactory
        //生成订单号,有独立的规则
        String orderNo = OrderCodeFactory.getOrderCode(Long.valueOf(userId));
        order.setOrderNo(orderNo);
        order.setUserId(userId);
        order.setTotalPrice(totalPrice(orderItemList));
        order.setReceiverName(createOrderReq.getReceiverName());
        order.setReceiverMobile(createOrderReq.getReceiverMobile());
        order.setReceiverAddress(createOrderReq.getReceiverAddress());
        order.setOrderStatus(Constant.OrderStatusEnum.NOT_PAID.getCode()); //94.去Constant定义订单状态
        //循环保存每个商品的order_item表
        order.setPostage(0);
        order.setPaymentType(1);
        //插入到Order表
        orderMapper.insertSelective(order);
        //循环保存每个商品到order_item表
        for (int i = 0; i &lt; orderItemList.size(); i++) &#123;
            OrderItem orderItem =  orderItemList.get(i);
            orderItem.setOrderNo(order.getOrderNo());
            orderItemMapper.insertSelective(orderItem);
        &#125;
        //把结果返回
        return orderNo;
        //95.回到Controller调用
    &#125;
//92.生成相似代码并改造
    private void validSaleStatusAndStock(List&lt;CartVO&gt; cartVOList) &#123;
        for (int i = 0; i &lt; cartVOList.size(); i++) &#123;
            CartVO cartVO =  cartVOList.get(i);
            Product product = productMapper.selectByPrimaryKey(cartVO.getProductId());
            //判断商品是否存在，商品是否上架
            if (product == null || product.getStatus().equals(Constant.SaleStatus.NOT_SALE)) &#123;
                //82. 1是上架 1不明确要形成代码让顾客知道 Constant.java
                throw new ImoocMallException(ImoocMallExceptionEnum.NOT_SALE);
            &#125;
            //判断商品库存 如果要买的比库存多 就买不了
            if (cartVO.getQuantity() &gt; product.getStock()) &#123;
                throw new ImoocMallException(ImoocMallExceptionEnum.NOT_ENOUGH);
            &#125;
        &#125;
    &#125;
    private List&lt;OrderItem&gt; cartVOListToOrderItemList(List&lt;CartVO&gt; cartVOList) &#123;
        List&lt;OrderItem&gt; orderItemList = new ArrayList&lt;&gt;();
        for (int i = 0; i &lt; cartVOList.size(); i++) &#123;
            CartVO cartVO =  cartVOList.get(i);
            OrderItem orderItem = new OrderItem();
            orderItem.setProductId(cartVO.getProductId());
            //记录商品快照信息
            orderItem.setProductName(cartVO.getProductName());
            orderItem.setProductImg(cartVO.getProductImage());
            orderItem.setUnitPrice(cartVO.getPrice());
            orderItem.setQuantity(cartVO.getQuantity());
            orderItem.setTotalPrice(cartVO.getTotalPrice());
            orderItemList.add(orderItem);
        &#125;
        return orderItemList;
    &#125;
    private void cleanCart(List&lt;CartVO&gt; cartVOList)&#123;
        for (int i = 0; i &lt; cartVOList.size(); i++) &#123;
            CartVO cartVO =  cartVOList.get(i);
            cartMapper.deleteByPrimaryKey(cartVO.getId());

        &#125;
    &#125;
    private Integer totalPrice(List&lt;OrderItem&gt; orderItemList)&#123;
        Integer totalPrice = 0;
        for (int i = 0; i &lt; orderItemList.size(); i++) &#123;
            OrderItem orderItem =  orderItemList.get(i);
            totalPrice += orderItem.getTotalPrice();
        &#125;
        return totalPrice;
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/util/OrderCodeFactory.java
package com.imooc.mall.util;

import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Random;

/**
 * 描述：     生成订单No工具类
 */
public class OrderCodeFactory &#123;

    /**
     * 订单类别头
     */
    private static final String ORDER_CODE = &quot;1&quot;;
    /**
     * 随机编码
     */
    private static final int[] r = new int[]&#123;7, 9, 6, 2, 8, 1, 3, 0, 5, 4&#125;;
    /**
     * 用户id和随机数总长度
     */
    private static final int maxLength = 5;

    /**
     * 更具id进行加密+加随机数组成固定长度编码
     */
    private static String toCode(Long id) &#123;
        String idStr = id.toString();
        StringBuilder idSb = new StringBuilder();
        for (int i = idStr.length() - 1; i &gt;= 0; i--) &#123;
            idSb.append(r[idStr.charAt(i) - &#39;0&#39;]);
        &#125;
        return idSb.append(getRandom(maxLength - idStr.length())).toString();
    &#125;

    /**
     * 生成时间戳
     */
    private static String getDateTime() &#123;
        DateFormat sdf = new SimpleDateFormat(&quot;HHmmss&quot;);
        return sdf.format(new Date());
    &#125;

    /**
     * 生成固定长度随机码
     *
     * @param n 长度
     */
    private static long getRandom(long n) &#123;
        long min = 1, max = 9;
        for (int i = 1; i &lt; n; i++) &#123;
            min *= 10;
            max *= 10;
        &#125;
        long rangeLong = (((long) (new Random().nextDouble() * (max - min)))) + min;
        return rangeLong;
    &#125;

    /**
     * 生成不带类别标头的编码
     */
    private static synchronized String getCode(Long userId) &#123;
        userId = userId == null ? 10000 : userId;
        return getDateTime() + toCode(userId);
    &#125;

    /**
     * 生成订单单号编码
     */
    public static String getOrderCode(Long userId) &#123;
        return ORDER_CODE + getCode(userId);
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/common/Constant.java
package com.imooc.mall.common;

import com.google.common.collect.Sets;
import com.imooc.mall.exception.ImoocMallException;
import com.imooc.mall.exception.ImoocMallExceptionEnum;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import java.util.Set;


/**
 * 21.SALT常量值 写完以后去UserServiceImpl重写密码代码
 */
@Component //让spring帮注入value
public class Constant &#123;
    public static final String SALT = &quot;aSp[PCx,aw.xq246&#125;&quot;;
    public static final String IMOOC_MALL_USER = &quot;imooc_mall_user&quot;;
    public static String FILE_UPLOAD_DIR;
    //64.为了解决上传图片系统异常报错 注入失败的原因是上方是static普通变量 set方法把静态变量赋值
    @Value(&quot;$&#123;file.upload.dir&#125;&quot;)
    public void setFileUploadDir(String fileUploadDir)&#123;
        FILE_UPLOAD_DIR = fileUploadDir;
    &#125;//65.打开ImoocMallWebMvcConfig 加一个映射规则

    //74.排序处理 去Constant定义支持的排序模式和手段
    public interface ProductListOrderBy&#123;
        Set&lt;String&gt; PRICE_ASC_DESC = Sets.newHashSet(&quot;price desc&quot;,&quot;price asc&quot;);
    &#125;
    //83.创建商品上下架的状态 创建CartMapper[Cart selectCartByUserIdAndProductId] 写sql 84再去CartServiceImpl
    public interface SaleStatus&#123;
        int NOT_SALE = 0; //商品下架状态
        int SALE = 1; //商品上架状态
    &#125;
    public interface Cart&#123;
        int UN_CHECKED = 0; //购物车未选中状态
        int CHECKED = 1; //购物车选中状态
    &#125;
    public enum OrderStatusEnum&#123;
        CANCELED(0, &quot;用户已取消&quot;),
        NOT_PAID(10, &quot;未付款&quot;),
        PAID(20, &quot;已付款&quot;),
        DELIVERED(30, &quot;已发货&quot;),
        ;

        private String value;
        private int code;
        //94.去Constant定义订单状态
        OrderStatusEnum(int code,String value)&#123;
            this.value = value;
            this.code = code;
        &#125;
        public static OrderStatusEnum codeOf(int code)&#123;
            for (OrderStatusEnum orderStatusEnum : values())&#123;
                if (orderStatusEnum.getCode() == code)&#123;
                    return orderStatusEnum;
                &#125;
            &#125;
            throw new ImoocMallException(ImoocMallExceptionEnum.NO_ENUM);
        &#125;

        public String getValue() &#123;
            return value;
        &#125;

        public void setValue(String value) &#123;
            this.value = value;
        &#125;

        public int getCode() &#123;
            return code;
        &#125;

        public void setCode(int code) &#123;
            this.code = code;
        &#125;
    &#125;
&#125;
</code></pre>
<h3 id="添加数据库事务"><a href="#添加数据库事务" class="headerlink" title="添加数据库事务"></a>添加数据库事务</h3><pre><code class="java">//95.写数据库事务代码 @Transactional (要么全对全要 要么全不要)
    @Transactional(rollbackFor = Exception.class)
    @Override
    public String create(CreateOrderReq createOrderReq) &#123;
     ......
    &#125;
</code></pre>
<h3 id="订单详情"><a href="#订单详情" class="headerlink" title="订单详情"></a>订单详情</h3><pre><code class="java">com/imooc/mall/service/impl/OrderServiceImpl.java
/* 95.继续实现Service实现类 拷贝一个Order成OrderVo 新增两个属性
        private String orderStatusName;
        private List&lt;OrderItemVo&gt; orderItemVoList;
        因为没有&lt;OrderItemVo&gt;要根据需求去创建
        拷贝OrderItem成OrderItemVO 更改属性
        之后回来补写代码
     */
    public OrderVO detail(String orderNo)&#123;

    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/model/vo/OrderItemVO.java
public class OrderItemVO &#123;
    private Integer id;

    private String orderNo;

    private Integer productId;

    private String productName;

    private String productImg;

    private Integer unitPrice;

    private Integer quantity;

    private Integer totalPrice;
</code></pre>
<pre><code class="java">com/imooc/mall/model/vo/OrderVO.java
public class OrderVO &#123;
    private Integer id;

    private String orderNo;

    private Integer userId;

    private Integer totalPrice;

    private String receiverName;

    private String receiverMobile;

    private String receiverAddress;

    private Integer orderStatus;

    private Integer postage;

    private Integer paymentType;

    private Date deliveryTime;

    private Date payTime;

    private Date endTime;

    private Date createTime;

    private Date updateTime;
</code></pre>
<h5 id="订单状态"><a href="#订单状态" class="headerlink" title="订单状态"></a>订单状态</h5><ul>
<li>0 用户已取消</li>
<li>10 未付款(下单后的初始状态)</li>
<li>20 已付款</li>
<li>30 已发货</li>
<li>40 交易完成</li>
</ul>
<pre><code class="java">com/imooc/mall/service/impl/OrderServiceImpl.java
 /* 95.继续实现Service实现类 拷贝一个Order成OrderVo 新增两个属性
        private String orderStatusName;
        private List&lt;OrderItemVo&gt; orderItemVoList;
        因为没有&lt;OrderItemVo&gt;要根据需求去创建
        拷贝OrderItem成OrderItemVO 更改属性
        之后回来补写代码
     */
   @Override
    public OrderVO detail(String orderNo)&#123;
        //96.去创建mapper的方法后回来补写代码 97写订单controller
        Order order = orderMapper.selectByOrderNo(orderNo);
        //订单不存在,则报错
        if (order == null)&#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.NO_ORDER);
        &#125;
        //订单存在,需要判断所属
        Integer userId = UserFilter.currentUser.getId();
        if (!order.getUserId().equals(userId)) &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.NOT_YOUR_ORDER);
        &#125;
        OrderVO orderVO = getOrderVo(order);
        return orderVO;
    &#125;

    private OrderVO getOrderVo(Order order) &#123;
        OrderVO orderVO = new OrderVO();
        BeanUtils.copyProperties(order,orderVO);
        //获取订单对应的orderItemVOList
        List&lt;OrderItem&gt; orderItemList = orderItemMapper.selectByOrderNo(order.getOrderNo());
        //OrderItem和OrderItem相比少了几个字段
        List&lt;OrderItemVO&gt; orderItemVOList = new ArrayList&lt;&gt;();
        for (int i = 0; i &lt; orderItemList.size(); i++) &#123;
            OrderItem orderItem = orderItemList.get(i);
            OrderItemVO orderItemVO = new OrderItemVO();
            BeanUtils.copyProperties(orderItem, orderItemVO);
            orderItemVOList.add(orderItemVO);
        &#125;
        orderVO.setOrderItemVOList(orderItemVOList);
        //com/imooc/mall/common/Constant.java的列举枚举
        orderVO.setOrderStatusName(Constant.OrderStatusEnum.codeOf(orderVO.getOrderStatus()).getValue());
        return orderVO;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/model/dao/OrderMapper.java
package com.imooc.mall.model.dao;

import com.imooc.mall.model.pojo.Order;
import org.springframework.stereotype.Repository;

@Repository
public interface OrderMapper &#123;
    int deleteByPrimaryKey(Integer id);

    int insert(Order record);

    int insertSelective(Order record);

    Order selectByPrimaryKey(Integer id);

    int updateByPrimaryKeySelective(Order record);

    int updateByPrimaryKey(Order record);

    Order selectByOrderNo(String orderNo);
&#125;

=====================================================
 &lt;select id=&quot;selectByOrderNo&quot; resultMap=&quot;BaseResultMap&quot; parameterType=&quot;java.lang.String&quot;&gt;
    select
    &lt;include refid=&quot;Base_Column_List&quot;/&gt;
    from imooc_mall_order
    where order_no = #&#123;orderNo&#125;
  &lt;/select&gt;
</code></pre>
<pre><code class="java">com/imooc/mall/controller/OrderController.java
package com.imooc.mall.controller;

import com.imooc.mall.common.ApiRestResponse;
import com.imooc.mall.model.request.CreateOrderReq;
import com.imooc.mall.model.vo.OrderVO;
import com.imooc.mall.service.OrderService;
import io.swagger.annotations.ApiOperation;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

/**
 * 91.订单Controller 新建一个根据pojo的Order → CreateOrderReq 新建一个OrderService
 */
@RestController
public class OrderController &#123;
    @Autowired
    OrderService orderService;

    @PostMapping(&quot;order/create&quot;)
    @ApiOperation(&quot;创建订单&quot;)
    public ApiRestResponse create(@RequestBody CreateOrderReq createOrderReq)&#123;
        //95.调用orderService
        String orderNo = orderService.create(createOrderReq);
        return ApiRestResponse.success(orderNo);
    &#125;

    @GetMapping(&quot;order/detail&quot;)
    @ApiOperation(&quot;前台订单详情&quot;)
    public ApiRestResponse detail(@RequestParam String orderNo)&#123;
        //95.调用orderService  Service层具体实现
        OrderVO orderVO = orderService.detail(orderNo);
        return ApiRestResponse.success(orderVO);
    &#125;
&#125;
==========================================
生成订单详情 GET:127.0.0.1:8083/order/detail?orderNo=100233359639
</code></pre>
<h3 id="订单列表"><a href="#订单列表" class="headerlink" title="订单列表"></a>订单列表</h3><pre><code class="java">com/imooc/mall/controller/OrderController.java
//97.写一个订单列表controller
    @GetMapping(&quot;order/list&quot;)
    @ApiOperation(&quot;前台订单列表&quot;)
    public ApiRestResponse list(@RequestParam Integer pageNum, @RequestParam Integer pageSize)&#123;
        //95.调用list   Service  Service层具体实现
        PageInfo pageInfo = orderService.listForCustomer(pageNum, pageSize);
        return  ApiRestResponse.success(pageInfo);
    &#125;
===============================================
订单列表：GET:127.0.0.1:8083/order/list?pageNum=1&amp;pageSize=10
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/OrderServiceImpl.java
  //97.前台订单实现类 搞个OrderMapper中的selectForCustomer
    @Override
    public PageInfo listForCustomer(Integer pageNum, Integer pageSize)&#123;
        Integer userId = UserFilter.currentUser.getId();
        PageHelper.startPage(pageNum, pageSize);
        List&lt;Order&gt; orderList = orderMapper.selectForCustomer(userId);
        List&lt;OrderVO&gt; orderVOList = orderListToOrderVOList(orderList);
        //新建一个pageinfo返回 方便前端查看
        PageInfo pageInfo = new PageInfo&lt;&gt;(orderList);
        pageInfo.setList(orderVOList);
        return pageInfo;
    &#125;

    private List&lt;OrderVO&gt; orderListToOrderVOList(List&lt;Order&gt; orderList) &#123;
        List&lt;OrderVO&gt; orderVOList = new ArrayList&lt;&gt;();
        for (int i = 0; i &lt; orderList.size(); i++) &#123;
            Order order =  orderList.get(i);
            OrderVO orderVO = getOrderVo(order);
            orderVOList.add(orderVO);
        &#125;
        return  orderVOList;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/model/dao/OrderMapper.java
 List&lt;Order&gt; selectForCustomer(Integer userId);
===============================================
mappers/OrderMapper.xml
  &lt;select id=&quot;selectForCustomer&quot; resultMap=&quot;BaseResultMap&quot; parameterType=&quot;integer&quot;&gt;
    select
    &lt;include refid=&quot;Base_Column_List&quot;/&gt;
    from imooc_mall_order
    where user_id = #&#123;userId&#125;
    order by create_time desc
  &lt;/select&gt;
</code></pre>
<h3 id="取消订单"><a href="#取消订单" class="headerlink" title="取消订单"></a>取消订单</h3><pre><code class="java">com/imooc/mall/controller/OrderController.java
//98.写一个订单取消controller
    @PostMapping(&quot;order/cancel&quot;)
    @ApiOperation(&quot;前台取消订单&quot;)
    public ApiRestResponse cancel(@RequestParam String orderNo)&#123;
        orderService.cancel(orderNo);
        return  ApiRestResponse.success();
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/OrderServiceImpl.java
//98.写一个订单取消实现类
    @Override
    public void cancel(String orderNo)&#123;
        //能查到订单就取消
        Order order = orderMapper.selectByOrderNo(orderNo);
        //查不到订单，报错
        if (order == null)&#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.NO_ORDER);
        &#125;
        //验证用户身份
        //订单存在,需要判断所属
        Integer userId = UserFilter.currentUser.getId();
        if (!order.getUserId().equals(userId)) &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.NOT_YOUR_ORDER);
        &#125;
        //没有付款才可以取消
        if (order.getOrderStatus().equals(Constant.OrderStatusEnum.NOT_PAID.getCode())) &#123;
            order.setOrderStatus(Constant.OrderStatusEnum.CANCELED.getCode());
            order.setEndTime(new Date());
            //更新状态
            orderMapper.updateByPrimaryKeySelective(order);
        &#125;else &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.WRONG_ORDER_STATUS);
        &#125;
    &#125;
</code></pre>
<h3 id="二维码接口开发"><a href="#二维码接口开发" class="headerlink" title="二维码接口开发"></a>二维码接口开发</h3><p><a target="_blank" rel="noopener" href="https://tool.oschina.net/qr?type=2">在线生成 QR Code (oschina.net)</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42456466/article/details/91869955">Springboot 上传图片到项目路径下不能访问，需要重启_springboot能上传图片到win11中但无法访问图片-CSDN博客</a></p>
<pre><code class="java">com/imooc/mall/controller/OrderController.java
//99.生成支付二维码
    @GetMapping(&quot;order/qrcode&quot;)
    @ApiOperation(&quot;前台取消订单&quot;)
    public ApiRestResponse qrcode(@RequestParam String orderNo)&#123;
        orderService.cancel(orderNo);
        return  ApiRestResponse.success();
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/OrderServiceImpl.java
 //99.生成支付二维码 pom.xml生成新的二维码依赖 util新建一个QRCodeGenerator类
       @Override
    public String qrcode(String orderNo) &#123;
        //得到请求相关的信息
        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        HttpServletRequest request = attributes.getRequest();//不能直接拿到内网的信息 要经过多层转发才可以
        //去application.properties配置一下可以访问的ip  去上面String ip
        String address = ip + &quot;:&quot; + request.getLocalPort();//拼接一下 这下生成的是整个地址
        String payUrl = &quot;http://&quot; + address + &quot;/pay?orderNo=&quot; + orderNo;
        System.out.println(address);
        System.out.println(payUrl);
        try &#123;
            QRCodeGenerator.generateQRCodeImage(payUrl, 350, 350, Constant.FILE_UPLOAD_DIR + orderNo + &quot;.png&quot;);
        &#125; catch (WriterException e) &#123;
            throw new RuntimeException(e);
        &#125; catch (IOException e) &#123;
            throw new RuntimeException(e);
        &#125;
        //这个图片可以通过这个url访问到
        String pngAddress = &quot;http://&quot; + address + &quot;/images/&quot; + orderNo + &quot;.png&quot;;
        return pngAddress;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/util/QRCodeGenerator.java
package com.imooc.mall.util;

import com.google.zxing.BarcodeFormat;
import com.google.zxing.WriterException;
import com.google.zxing.client.j2se.MatrixToImageWriter;
import com.google.zxing.common.BitMatrix;
import com.google.zxing.qrcode.QRCodeWriter;

import java.io.IOException;
import java.nio.file.FileSystem;
import java.nio.file.FileSystems;
import java.nio.file.Path;

/**
 * 99.生成二维码工具
 */
public class QRCodeGenerator &#123;
    public static void generateQRCodeImage(String text, int width, int height, String filePath) throws WriterException, IOException &#123;
        QRCodeWriter qrCodeWriter = new QRCodeWriter();
        BitMatrix bitMatrix = qrCodeWriter.encode(text, BarcodeFormat.QR_CODE, width, height);
        Path path = FileSystems.getDefault().getPath(filePath);
        MatrixToImageWriter.writeToPath(bitMatrix,&quot;PNG&quot;,path);
    &#125;

    public static void main(String[] args) &#123;
        try &#123;
            generateQRCodeImage(&quot;PANCHUNYAO&quot;, 350,350,&quot;/Users/Pluminary/Desktop/idea_Space/mall_file_upload/QRTest.png&quot;);
        &#125; catch (WriterException e) &#123;
            throw new RuntimeException(e);
        &#125; catch (IOException e) &#123;
            throw new RuntimeException(e);
        &#125;
    &#125;
&#125;
</code></pre>
<pre><code class="java">application.properties
file.upload.dir=/Users/Pluminary/Desktop/idea_Space/mall_file_upload/
file.upload.ip=127.0.0.1
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/OrderServiceImpl.java
/**
 * 91.★★ 订单Service实现类 ★★
 */
@Service
public class OrderServiceImpl implements OrderService &#123;
    @Autowired
    CartService cartService;
    @Autowired
    ProductMapper productMapper;
    @Autowired
    CartMapper cartMapper;
    @Autowired
    OrderMapper orderMapper;
    @Autowired
    OrderItemMapper orderItemMapper;
    @Value(&quot;$&#123;file.upload.ip&#125;&quot;)
    String ip;
............
&#125;
</code></pre>
<h3 id="后台订单列表接口"><a href="#后台订单列表接口" class="headerlink" title="后台订单列表接口"></a>后台订单列表接口</h3><pre><code class="java">com/imooc/mall/controller/OrderAdminController.java
package com.imooc.mall.controller;

import com.github.pagehelper.PageInfo;
import com.imooc.mall.common.ApiRestResponse;
import com.imooc.mall.service.OrderService;
import io.swagger.annotations.ApiOperation;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

/**
 * 100.订单后台管理Controller
 */
@RestController
public class OrderAdminController &#123;
    @Autowired
    OrderService orderService;

    @GetMapping(&quot;admin/order/list&quot;)
    @ApiOperation(&quot;管理员订单列表&quot;)
    public ApiRestResponse listForAdmin(@RequestParam Integer pageNum, @RequestParam Integer pageSize)&#123;
        PageInfo pageInfo = orderService.listForAdmin(pageNum, pageSize);
        return ApiRestResponse.success(pageInfo);
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/OrderServiceImpl.java
 //100.实现类
    @Override
    public PageInfo listForAdmin(Integer pageNum, Integer pageSize) &#123;//想看到所有订单
        PageHelper.startPage(pageNum, pageSize);
        List&lt;Order&gt; orderList = orderMapper.selectAllForAdmin();
        List&lt;OrderVO&gt; orderVOList = orderListToOrderVOList(orderList);
        //新建一个pageinfo返回 方便前端查看
        PageInfo pageInfo = new PageInfo&lt;&gt;(orderList);
        pageInfo.setList(orderVOList);
        return pageInfo;
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/model/dao/OrderMapper.java
List&lt;Order&gt; selectAllForAdmin();
===========================================
mappers/OrderMapper.xml 
&lt;select id=&quot;selectAllForAdmin&quot; resultMap=&quot;BaseResultMap&quot; parameterType=&quot;integer&quot;&gt;
    select
    &lt;include refid=&quot;Base_Column_List&quot;/&gt;
    from imooc_mall_order
    order by create_time desc
  &lt;/select&gt;
</code></pre>
<h3 id="支付"><a href="#支付" class="headerlink" title="支付"></a>支付</h3><h6 id="根据订单号生成支付二维码-→-扫码支付-→-访问支付URL-完成支付"><a href="#根据订单号生成支付二维码-→-扫码支付-→-访问支付URL-完成支付" class="headerlink" title="根据订单号生成支付二维码 → 扫码支付 → 访问支付URL, 完成支付"></a>根据订单号生成支付二维码 → 扫码支付 → 访问支付URL, 完成支付</h6><pre><code class="java">com/imooc/mall/controller/OrderController.java
 //101.支付接口
    @GetMapping(&quot;pay&quot;)
    @ApiOperation(&quot;支付接口&quot;)
    public ApiRestResponse pay(@RequestParam String orderNo)&#123;
        orderService.pay(orderNo);
        return ApiRestResponse.success();
    &#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/OrderServiceImpl.java
//101.支付
    @Override
    public void pay(String orderNo)&#123;
        //能查到订单就取消
        Order order = orderMapper.selectByOrderNo(orderNo);
        //查不到订单，报错
        if (order == null) &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.NO_ORDER);
        &#125;
        //支付前的判断 未付款才可以付款
        if (order.getOrderStatus() == Constant.OrderStatusEnum.NOT_PAID.getCode()) &#123;
            order.setOrderStatus(Constant.OrderStatusEnum.PAID.getCode());
            order.setPayTime(new Date());
            orderMapper.updateByPrimaryKeySelective(order);
        &#125;else &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.WRONG_ORDER_STATUS);
        &#125;
    &#125;
</code></pre>
<h3 id="完结订单"><a href="#完结订单" class="headerlink" title="完结订单"></a>完结订单</h3><pre><code class="java">com/imooc/mall/controller/OrderAdminController.java
package com.imooc.mall.controller;

import com.github.pagehelper.PageInfo;
import com.imooc.mall.common.ApiRestResponse;
import com.imooc.mall.service.OrderService;
import io.swagger.annotations.ApiOperation;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

/**
 * 100.订单后台管理Controller
 */
@RestController
public class OrderAdminController &#123;
    @Autowired
    OrderService orderService;

    @GetMapping(&quot;admin/order/list&quot;)
    @ApiOperation(&quot;管理员订单列表&quot;)
    public ApiRestResponse listForAdmin(@RequestParam Integer pageNum, @RequestParam Integer pageSize)&#123;
        PageInfo pageInfo = orderService.listForAdmin(pageNum, pageSize);
        return ApiRestResponse.success(pageInfo);
    &#125;

    /**
     * 102.发货。订单状态流程：0用户已取消，10未付款，20已付款，30已发货，40交易完成
     */
    @GetMapping(&quot;admin/order/delivered&quot;)
    @ApiOperation(&quot;管理员发货&quot;)
    public ApiRestResponse delivered(@RequestParam String orderNo)&#123;
        orderService.deliver(orderNo);
        return ApiRestResponse.success();
    &#125;

    /**
     * 103.完结订单。订单状态流程：0用户已取消，10未付款，20已付款，30已发货，40交易完成
     * 管理员和用户都可以调用
     */
    @GetMapping(&quot;order/finish&quot;)
    @ApiOperation(&quot;完结订单&quot;)
    public ApiRestResponse finish(@RequestParam String orderNo)&#123;
        orderService.finish(orderNo);
        return ApiRestResponse.success();
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/imooc/mall/service/impl/OrderServiceImpl.java
 //102.管理订单实现类开发 发货
    @Override
    public void deliver(String orderNo)&#123;
        //能查到订单就取消
        Order order = orderMapper.selectByOrderNo(orderNo);
        //查不到订单，报错
        if (order == null) &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.NO_ORDER);
        &#125;
        //支付前的判断 判断已付款的
        if (order.getOrderStatus() == Constant.OrderStatusEnum.PAID.getCode()) &#123;
            order.setOrderStatus(Constant.OrderStatusEnum.DELIVERED.getCode());
            order.setDeliveryTime(new Date());
            orderMapper.updateByPrimaryKeySelective(order);
        &#125;else &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.WRONG_ORDER_STATUS);
        &#125;
    &#125;
    //103.完结订单
    @Override
    public void finish(String orderNo)&#123;
        //能查到订单就取消
        Order order = orderMapper.selectByOrderNo(orderNo);
        //查不到订单，报错
        if (order == null) &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.NO_ORDER);
        &#125;
        //有可能管理员调用 有可能用户调用 如果是普通用户, 要去校验一下订单所属
        if (!userService.checkAdminRole(UserFilter.currentUser) &amp;&amp; !order.getUserId().equals(UserFilter.currentUser.getId())) &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.NOT_YOUR_ORDER);
        &#125;
        //支付前的判断 判断已付款的 //发货后可以完结订单
        if (order.getOrderStatus() == Constant.OrderStatusEnum.DELIVERED.getCode()) &#123;
            order.setOrderStatus(Constant.OrderStatusEnum.FINISHED.getCode());
            order.setEndTime(new Date());
            orderMapper.updateByPrimaryKeySelective(order);
        &#125;else &#123;
            throw new ImoocMallException(ImoocMallExceptionEnum.WRONG_ORDER_STATUS);
        &#125;
    &#125;
</code></pre>
<h3 id="全流程测试"><a href="#全流程测试" class="headerlink" title="全流程测试"></a>全流程测试</h3><ul>
<li>Postman实操</li>
<li>登录 → 浏览商品 → 加入购物车 → 下单 <ul>
<li>​                                                            → 取消订单</li>
<li>​                                                            → 扫码支付 → 发货 → 收获 → 订单完结</li>
</ul>
</li>
</ul>
<h5 id="总结订单模块"><a href="#总结订单模块" class="headerlink" title="总结订单模块"></a>总结订单模块</h5><ul>
<li><p>重难点</p>
<ul>
<li>VO的封装、裁剪</li>
<li>一个订单内包括多个商品</li>
<li>订单状态流转</li>
<li>二维码生成</li>
</ul>
</li>
<li><p>常见错误：把POJO返回到前端</p>
</li>
</ul>
<h1 id="上线前准备工作"><a href="#上线前准备工作" class="headerlink" title="上线前准备工作"></a>上线前准备工作</h1><h3 id="阿里云部署"><a href="#阿里云部署" class="headerlink" title="阿里云部署"></a>阿里云部署</h3><p>把每个 com&#x2F;imooc&#x2F;mall&#x2F;model&#x2F;request&#x2F;… 类都加上**toString()**方法 方便调试<br><strong>后台、前台、获取类的行为</strong> 的目录列表都是 <strong>Get</strong>Mapping</p>
<h3 id="前端准备工作"><a href="#前端准备工作" class="headerlink" title="前端准备工作"></a>前端准备工作</h3><h6 id="把static里的前端文件导入项目中"><a href="#把static里的前端文件导入项目中" class="headerlink" title="把static里的前端文件导入项目中"></a>把static里的前端文件导入项目中</h6><pre><code class="java">com/imooc/mall/config/ImoocMallWebMvcConfig.java
//104.ImoocMallWebMvcConfig.java 根据路由配置相关文件 以admin开头的文件会被路由到下面的Locations
package com.imooc.mall.config;

import com.imooc.mall.common.Constant;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/**
 * 42.配置地址映射 43去CategoryController.java 加一个 @ApiOperation(&quot;后台添加目录&quot;)
 * 44.新增一个目录的updateCategory的参数 [UpdateCategoryReq.java  ]
 */
@Configuration  //代表是一个配置
public class ImoocMallWebMvcConfig implements WebMvcConfigurer &#123;
    public void addResourceHandles(ResourceHandlerRegistry registry)&#123;
        //104.根据路由配置相关文件 以admin开头的文件会被路由到下面的Locations
        registry.addResourceHandler(&quot;/admin/**&quot;).addResourceLocations(&quot;classpath:/static/admin&quot;);
        //65.增加一个registry  66.新增接口继续开发 ProductAdminController
        registry.addResourceHandler(&quot;/images/**&quot;).addResourceLocations(&quot;file:&quot; + Constant.FILE_UPLOAD_DIR);
//     把地址给到对应的目录下
        registry.addResourceHandler(&quot;swagger-ui.html&quot;)
                .addResourceLocations(&quot;classpath:/META-INF/resources/&quot;);
        registry.addResourceHandler(&quot;/webjars/**&quot;).addResourceLocations(
                &quot;classpath:/META-INF/resources/webjars&quot;);
    &#125;
&#125;
</code></pre>
<h3 id="部署云服务器"><a href="#部署云服务器" class="headerlink" title="部署云服务器"></a>部署云服务器</h3><ul>
<li>阿里云简介</li>
<li>选择云服务器并购买</li>
<li>环境配置</li>
<li>Spring Boot部署[包括maven打包 sql文件也要上传]</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://ecs.console.aliyun.com/server/region/cn-hangzhou">云服务器管理控制台 (aliyun.com)</a></p>
<blockquote>
<p>免费试用三个月<br>账号: root<br>密码: panchunyao123!</p>
</blockquote>
<pre><code class="java">复制服务器的公网ip：47.98.225.105
cmd本地电脑 → ssh root@47.98.225.105
</code></pre>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_57581439/article/details/124928451">在阿里云购买Linux服务器，配置宝塔环境，全图文，最最详细图解，保姆级教学_阿里云服务器怎么直接买宝塔-CSDN博客</a></p>
<blockquote>
<h2 id="【宝塔安装jdk1-8-yum安装-】"><a href="#【宝塔安装jdk1-8-yum安装-】" class="headerlink" title="【宝塔安装jdk1.8(yum安装)】"></a><strong>【宝塔安装jdk1.8(yum安装)】</strong></h2><p>1、检索检索1.8的列表</p>
<pre><code class="none">yum list java-1.8*
</code></pre>
<p>2、安装1.8.0的所有文件</p>
<pre><code class="none">yum install java-1.8.0-openjdk* -y
</code></pre>
<p>3、使用命令检查是否安装成功</p>
<pre><code class="none">java -version
</code></pre>
</blockquote>
<p>登录宝塔 → 绑定宝塔 → 下载软件<br>宝塔服务器[<a target="_blank" rel="noopener" href="http://47.98.225.105:22003/]">http://47.98.225.105:22003/]</a></p>
<pre><code class="sql">☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆ 宝塔BaoTa ☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆
========================面板账户登录信息=========================
 外网面板地址: http://47.98.225.105:22003/1259ebfa
 内网面板地址: http://172.24.91.49:22003/1259ebfa
 username: grltvl7d
 password: 46303f93


======================== mysql-5.7 ===========================
root密码成功修改为: Panchunyao123![mysql-8.0]

[root@iZbp1dssknxftmjczbtpndZ ~]# mysql -uroot -pPanchunyao123!
mysql&gt; create database imooc_mall;
mysql&gt; use imooc_mall;
Database changed
导入sql文件:imooc_mall_online.sql
从本机将其上传到服务器在cmd中运行:
scp /Users/Pluminary/Desktop/imooc_mall_online.sql root@47.98.225.105:22003:/root
输入服务器密码:panchunyao123!

回到服务器端输入：
mysql&gt; use imooc_mall
Database changed
mysql&gt; source /root/imooc_mall_online.sql
mysql&gt; show tables;
+-----------------------+
| Tables_in_imooc_mall  |
+-----------------------+
| imooc_mall_cart       |
| imooc_mall_category   |
| imooc_mall_order      |
| imooc_mall_order_item |
| imooc_mall_product    |
| imooc_mall_user       |
+-----------------------+
#为数据库赋予权限！！！
mysql&gt; grant all privileges on imooc_mall.* to &#39;root&#39;@&#39;127.0.0.1&#39; identified by &#39;Panchunyao123!&#39;;
--------------------------------------------------------------
MySql8.0
CREATE USER &#39;root&#39;@&#39;47.98.225.105&#39; IDENTIFIED BY &#39;Panchunyao123!&#39;;
GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;47.98.225.105&#39; WITH GRANT OPTION;
--------------------------------------------------------------
mysql&gt; quit
Bye
[root@iZbp1dssknxftmjczbtpndZ ~]# mysql -uroot -pPanchunyao123! -h127.0.0.1
去云服务器 安全组 访问规则 入方向 手动添加一个 目的:8081/8081 源:0.0.0.0/0
==============================================================
</code></pre>
<p>整理文件上传到服务器 先**Build → Rebuild Project **<br>打包 <strong>Maven → Lifecycle → clean[之前的内容删除 不容易出错] → package[打包操作]</strong><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_62488212/article/details/132412209">spring打包报错：Java Runtime (class file version 55.0), class file versions up to 52.0_there was an error in the forked process org&#x2F;testn-CSDN博客</a></p>
<pre><code class="sql">[INFO] Building jar: C:\Users\Pluminary\Desktop\idea_Space\mall\target\mall-0.0.1-SNAPSHOT.jar
在本机cmd中运行把导好的包发送給服务器
C:\Users\Pluminary&gt;scp C:\Users\Pluminary\Desktop\idea_Space\mall\target\mall-0.0.1-SNAPSHOT.jar root@c:/root
#rm -rf images/ 删除images文件夹
新建一个文件夹
[root@iZbp1dssknxftmjczbtpndZ ~]# pwd
[root@iZbp1dssknxftmjczbtpndZ ~]# mkdir image

图片上传到服务器中[图片尽量在没有根目录空格的文件夹下 比如Spring Boot 中间有空格]
C:\Users\Pluminary&gt;scp C:/Users/Pluminary/Desktop/images/. root@47.98.225.105:/root/images/

在Xshell7中阿里云服务器
[root@iZbp1dssknxftmjczbtpndZ ~]# ls
images  imooc_mall_online.sql  install.sh  mall-0.0.1-SNAPSHOT.jar

每一次部署之前要把当前的java停止掉
[root@iZbp1dssknxftmjczbtpndZ images]# lsof -i:8081
[root@iZbp1dssknxftmjczbtpndZ images]# kill -9 12345 //按照PID杀死端口号
-bash: kill: (12345) - No such process

部署到云服务器 [/root/null 2&gt;&amp;1 &amp;]将日志输出到哪里 这里是丢弃的意思
[root@iZbp1dssknxftmjczbtpndZ ~]# nohup java -jar -Dserver.port=8081 -Dspring.profiles.active=prod /root/mall-0.0.1-SNAPSHOT.jar &gt; /root/null 2&gt;&amp;1 &amp;
[1] 18656
如果没有别名就一个本来的application.properties
[root@iZbp1dssknxftmjczbtpndZ ~]# nohup java -jar -Dserver.port=8081 /root/mall-0.0.1-SNAPSHOT.jar &gt; /root/null 2&gt;&amp;1 &amp;


 #代表当前程序的进程号
[root@iZbp1dssknxftmjczbtpndZ ~]# lsof -i:8081   //查询端口号
COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
java    18656 root   19u  IPv6 195648      0t0  TCP *:tproxy (LISTEN)

============================================================================

若打不开请检查网页报错 寻找传入的application.prod.properties的 
spring.datasource.url地址和spring.datasource.username &amp;&amp; password数据库用户和密码

查看服务器的端口: mysql&gt; show global variables like &#39;port&#39;;

阿里云控制台:
https://ecs.console.aliyun.com/server/i-bp1dssknxftmjczbtpnd/detail?regionId=cn-hangzhou

如何查看linux服务器安装了tomcat：
rpm -qa|grep tomcat

宝塔安装目录: $cd /www/server/.....
[root@iZbp1dssknxftmjczbtpndZ data]# cd /www/server/tomcat/bin
#找到文件后启动tomcat
[root@iZbp1dssknxftmjczbtpndZ bin]# ./startup.sh
#看进程，如果返回一大串东西，说明tomcat启动成功。
[root@iZbp1dssknxftmjczbtpndZ ~]# ps -ef|grep tomcat

运行SpringBoot: 
[root@iZbp1dssknxftmjczbtpndZ ~]# ls
Desktop  images  imooc_mall_online.sql  install.sh  logs  mall-0.0.1-SNAPSHOT.jar  null
[root@iZbp1dssknxftmjczbtpndZ ~]# java -jar mall-0.0.1-SNAPSHOT.jar 

===============================================
当把SpringBoot项目的jar包部署到linux服务器中，启动SpringBoot项目，却无法正常访问，这是怎么回事呢？
主要的原因是端口号被Linux的firewall防火墙拦截掉了
解决办法：
1、查询已开启的端口列表：firewall-cmd --list-ports 
不出意外的话，是啥也没有，这也表示，所有端口都未放行，当然springboot项目的80端口也被拦截掉了
2、firewall-cmd --zone=public --add-port=1-12345/tcp --permanent
将端口1~12345全都开启
3、重启防火墙
service firewalld restart
4、重新运行springboot项目
5、成功访问
===============================================
</code></pre>
<blockquote>
<p>server.port&#x3D;8083<br>spring.datasource.name&#x3D;imooc_mall_datasource<br>spring.datasource.url&#x3D;jdbc:mysql:&#x2F;&#x2F;47.98.225.105&#x2F;imooc_mall?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf8&amp;autoReconnect&#x3D;true&amp;useSSL&#x3D;true&amp;allowPublicKeyRetrieval&#x3D;true&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai<br>spring.datasource.driver-class-name&#x3D;com.mysql.cj.jdbc.Driver<br>spring.datasource.username&#x3D;root<br>spring.datasource.password&#x3D;Panchunyao123!<br>mybatis.mapper-locations&#x3D;classpath:mappers&#x2F;*.xml<br>spring.redis.host&#x3D;localhost<br>spring.redis.port&#x3D;6379<br>spring.redis.password&#x3D;<br>file.upload.dir&#x3D;&#x2F;root&#x2F;images&#x2F;<br>file.upload.ip&#x3D;47.98.225.105<br>icode&#x3D;ABCDE</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46070108/article/details/116495116">SpringBoot上传图片，图片不能及时显示问题_springboot项目上传照片到uoload 不会实时更新-CSDN博客</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42456466/article/details/91869955">Springboot 上传图片到项目路径下不能访问，需要重启_springboot能上传图片到win11中但无法访问图片-CSDN博客</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/twotwo22222/article/details/124680688">关于springboot项目图片上传到本地，必须重启之后才能访问的解决方案_springboot上传图片需要重启-CSDN博客</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/rqz__/article/details/130304492">关于IDEA2022开启热部署没有compiler.automake.allow.when.app.running的解决方案-CSDN博客</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37954460/article/details/125842857">Linux部署SpringBoot项目无法访问问题_linux springboot项目启动外面不能访问-CSDN博客</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/terry711/article/details/106226298/">linux服务器部署SpringBoot项目并查看项目运行日志_linux 怎么实时查看springboot 日志-CSDN博客</a><br><a target="_blank" rel="noopener" href="https://class.imooc.com/course/qadetail/269346">线上发布报数据库没有连接成功，麻烦帮忙看…-慕课网 (imooc.com)</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_63693805/article/details/132626318">linux安装mysql 8 数据库（保姆级）_linux安装mysql8-CSDN博客</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_52885524/article/details/127076560">慕慕生鲜详细步骤全部打通(从无到上线)-CSDN博客</a></p>
<p>mysql8.0密码&#x3D;&gt; root &amp; Panchunyao123!</p>

    </div>

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <div id="comment">
        <div id="gitalk-container">
        </div>
    </div>
    
</div>
                     
<footer id="footer">
    <div class="footer-wrap">
        <div>
            © 2018 - 2026 P-luminary
            <span class="footer-icon">
                <a-icon type="flag" theme="filled" /></span>
            @Asuna
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a>
<!--         & <a target="_blank" rel="noopener" href="https://github.com/korilin/hexo-theme-particle">Particle Theme</a></div> -->
        
    </div>

</footer>

<script src="/js/highlight.min.js"></script>
<script src="/js/particle.js"></script>
                </div>
            </div>
        </transition>
    </div>

    <script>
    new Vue({
        el: "#layout",
        data: {
            show_page: false,
            onload_menu: false,
            menu_show: false,
            card_top: 100
        },
        created: function () {
            var that = this
            window.onload = function () {
                that.show_page = true
                document.getElementById("loadcontent").style.opacity = 0
                setTimeout(function () {
                    document.getElementById("loadleft").style.width = 0
                    document.getElementById("loadright").style.width = 0
                }, 300)
                setTimeout(function () {
                    document.getElementById("loading").style = "display:none"
                }, 600)
            }
        },
        mounted: function () {
            var that = this
            window.addEventListener('scroll', function (e) {
                that.menu_show = false
            })
        },
        methods: {
            home_click: function () {
                window.scrollTo({
                    top: window.innerHeight - 80,
                    behavior: "smooth",
                });
            }
        }
    })
</script>

<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
    const gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'hexo-theme-particle',      // The repository of store comments,
        owner: 'P-luminary',
        admin: ['P-luminary'],
        language: 'en',
        id: location.pathname,      // Ensure uniqueness and length less than 50
        distractionFreeMode: true  // Facebook-like distraction free mode
    })
    gitalk.render('gitalk-container')
</script>

</body>

</html>