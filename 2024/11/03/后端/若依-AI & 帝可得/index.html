
<!DOCTYPE html>
<html lang="zh_CH ">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P-luminary || 若依-AI &amp; 帝可得</title>
    <meta name="author" content="Asuna">
    <meta name="description" content=" ">
    <meta name="keywords" content=" ">
    <link rel="icon" href="/https://raw.githubusercontent.com/P-luminary/images/master/data/asuna.jpg">
    <link rel="stylesheet" href="/css/antd.min.css">
    
    <link rel="stylesheet" href="/css/maiden-theme.css">
    
    <script src="/js/vue.js"></script>
    <script src="/js/antd.min.js"></script>
<meta name="generator" content="Hexo 6.1.0"></head>

<body>

    <div id="loading"
        style="height: 100vh; width: 100%; position: fixed;display: flex;z-index: 200; justify-content: space-between;">
        <div id="loadleft" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div id="loadright" style="width: 50%;background-color: #ffffff;transition: width 0.6s ease-out;"></div>
        <div
            style="position: fixed; height: 100vh; width: 100%;display: flex;justify-content: center;align-items: center;">
            <div id="loadcontent"
                style="width:400px;height:400px;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px#a3ddfb; text-align:center;opacity:1;transition:opacity 0.3s ease-out;">
                <div>
                    <h2>LOADING...</h2>
                    <p>加载过慢请开启缓存(浏览器默认开启)</p>
                    <div>
                        <img src="/dancingkitty.gif" alt="loading">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="layout">
        <transition name="into">
            <div v-show="show_page" style="display: none;">
                <div id="menu_show">
                     
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">P-luminary</span>
        </a>
        
        <a href="/">
            <span>
                <a-icon type="home" theme="filled" />
            </span>
            <span>home</span>
        </a>
        
        <a href="/tags/语法">
            <span>
                <a-icon type="tags" theme="filled" />
            </span>
            <span>tags</span>
        </a>
        
    </div>

    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div :class="'title'" @click="menu_show=!menu_show">
            <span style="margin-right: 10px;">
                <a-icon type="appstore" theme="filled" />
            </span>
            <span>P-luminary</span>
        </div>
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="home" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">home</div>
                </div>
            </a>
            
            <a href="/tags/语法">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="tags" theme="filled" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;">tags</div>
                </div>
            </a>
            
        </div>
        <div class="curtain" v-show="menu_show"></div>
    </div>

</nav>
                </div>

                <div id="main">
                     
<link rel="stylesheet" href="/css/post-body.css">
<div class="article">
    <div>
        <h1>若依-AI &amp; 帝可得 </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <a-icon type="calendar" theme="filled" />
            </span>
            2024/11/3
        </span>

        

        

        <span class="tags">
            <span class="icon">
                <a-icon type="tags" theme="filled" />
            </span>
            
            <span class="tag">
                
                <a href="/tags/后端" style=color:#00bcd4>
                    后端
                </a>
            </span>
            
        </span>
        
    </div>

    <div class="content" v-pre>
        <h3 id="RuoYi-Vue"><a href="#RuoYi-Vue" class="headerlink" title="RuoYi-Vue"></a>RuoYi-Vue</h3><ul>
<li>RuoYi-Vue版本，采用了前后端分离的单体架构设计<br><a target="_blank" rel="noopener" href="https://gitee.com/ys-gitee/RuoYi-Vue3">https://gitee.com/ys-gitee/RuoYi-Vue3</a><br><a target="_blank" rel="noopener" href="https://gitee.com/y_project/RuoYi-Vue">https://gitee.com/y_project/RuoYi-Vue</a></li>
</ul>
<table>
<thead>
<tr>
<th align="center">课程版本</th>
</tr>
</thead>
<tbody><tr>
<td align="center">JDK 11</td>
</tr>
<tr>
<td align="center">MySQL 8</td>
</tr>
<tr>
<td align="center">Redis 5</td>
</tr>
<tr>
<td align="center">Maven 3.6</td>
</tr>
<tr>
<td align="center">Node 16 (Vue3)</td>
</tr>
</tbody></table>
<ul>
<li>技术选型：SpringBoot、SpringSecurity、MyBatis、Jwt、VUE3、Element-Plus</li>
</ul>
<ol>
<li><p><strong>从VCS导入项目</strong>：</p>
<ul>
<li><p>点击<code>VCS</code>菜单。</p>
</li>
<li><p>选择<code>Get from Version Control...</code>选项。</p>
</li>
<li><pre><code class="java">URL：https://gitee.com/y_project/RuoYi-Vue.git
Directory：C:\Users\Pluminary\Desktop\RuoYi-Vue
</code></pre>
</li>
</ul>
</li>
<li><p><strong>输入项目地址</strong>：</p>
<ul>
<li>在弹出的窗口中，您可以看到不同的版本控制系统（例如Git, SVN等）。</li>
<li>选择您要导入的项目所使用的版本控制系统。</li>
<li>在接下来的窗口中，您需要输入项目的URL地址。这通常是项目的仓库地址，例如Git仓库的HTTPS或SSH链接。</li>
</ul>
</li>
</ol>
<blockquote>
<p>① 若模块没有导入进去没有亮 就<strong>Maven → clean → package</strong></p>
<p>C:\Users\Pluminary\Desktop\RuoYi-Vue\sql 导入Sql文件两个<br><strong>sql&#x2F;quartz.sql</strong><br><strong>sql&#x2F;ry_20240629.sql</strong></p>
</blockquote>
<p>先git<a target="_blank" rel="noopener" href="https://github.com/wzs28150/RuoYi-Vue3">wzs28150&#x2F;RuoYi-Vue3: :tada: (RuoYi)官方仓库 基于SpringBoot，Spring Security，JWT，Vue3 &amp; Vite、Element Plus 的前后端分离权限管理系统</a>下载这里面的资料，在里面<code>C:\Users\Pluminary\Desktop\itcast&gt;code ./RuoYi-Vue3</code>导入vscode里面，再安装依赖(要进入Vue3里面才能利用package.json去生成)<code>npm install</code> → 运行前端项目<code>npm run dev</code></p>
<pre><code class="java">// npm install慢的话 就用中国镜像去下载
npm install --registr=https://registry.npmmirror.com

C:\Users\Pluminary\Desktop\itcast\RuoYi-Vue3&gt;npm run dev

&gt; ruoyi@3.8.8 dev
&gt; vite


  VITE v5.3.2  ready in 2026 ms

  ➜  Local:   http://localhost:8080/
  ➜  Network: http://10.254.3.124:8080/
  ➜  Network: http://192.168.104.38:8080/
  ➜  Network: http://192.168.22.1:8080/
  ➜  Network: http://192.168.36.1:8080/
  ➜  press h + enter to show help
</code></pre>
<p>再导入<code>课程管理.sql</code>数据库 → 在若依的后台系统 → 系统工具 → 代码生成 → 配置好后下载代码 → 导入数据库</p>
<p> → 导入RuoYi生成的前端代码<code>C:\Users\Pluminary\Downloads\ruoyi\vue\api</code> 的<strong>course</strong>导入vscode中 <code>C:\Users\Pluminary\Desktop\itcast\RuoYi-Vue3\src\api\course</code> &amp;&amp; <code>C:\Users\Pluminary\Downloads\ruoyi\vue\views</code> 的<strong>course</strong>导入vscode中 <code>C:\Users\Pluminary\Desktop\itcast\RuoYi-Vue3\src\api\course</code></p>
<p>→ 导入RuoYi生成的后端代码<code>C:\Users\Pluminary\Desktop\itcast\RuoYi-Vue3\src\views\course</code>的<strong>com</strong> 并且导入配置文件 &amp;&amp; <code>C:\Users\Pluminary\Downloads\ruoyi\main\resources</code>的<strong>mapper</strong>导入到idea的resource中</p>
<h3 id="功能详解"><a href="#功能详解" class="headerlink" title="功能详解"></a>功能详解</h3><h5 id="权限控制"><a href="#权限控制" class="headerlink" title="权限控制"></a>权限控制</h5><ul>
<li>若依内置了强大的权限控制系统，为企业级项目提供了通用的解决方案<ul>
<li>**demo账号 (超级管理员)**，查看所有功能菜单</li>
<li>**zhangsan账号 (市场专员)**，查看线索菜单</li>
<li>**yueyue账号 (销售专员)**，查看商机、合同等菜单</li>
</ul>
</li>
<li><strong>RBAC (基于<span style = "color:red">角色的控制访问</span>)</strong> 是一种广泛使用的访问控制模型，通过<strong>角色</strong>来分配和管理<strong>用户</strong>的菜单<strong>权限</strong></li>
</ul>
<table>
<thead>
<tr>
<th align="center">表名</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">sys_dept</td>
<td align="center">部门表</td>
</tr>
<tr>
<td align="center">sys_post</td>
<td align="center">岗(职)位信息表</td>
</tr>
<tr>
<td align="center"><span style = "color:red"><strong>sys_menu</strong></span></td>
<td align="center"><span style = "color:red"><strong>菜单权限表</strong></span></td>
</tr>
<tr>
<td align="center"><span style = "color:red"><strong>sys_role</strong></span></td>
<td align="center"><span style = "color:red"><strong>角色信息表</strong></span></td>
</tr>
<tr>
<td align="center">sys_role_dept</td>
<td align="center">角色和部门关联表</td>
</tr>
<tr>
<td align="center"><span style = "color:red"><strong>sys_role_menu</strong></span></td>
<td align="center"><span style = "color:red"><strong>角色和菜单关联表</strong></span></td>
</tr>
<tr>
<td align="center"><span style = "color:red"><strong>sys_user</strong></span></td>
<td align="center"><span style = "color:red"><strong>用户信息表</strong></span></td>
</tr>
<tr>
<td align="center">sys_user_post</td>
<td align="center">用户与岗位关联表</td>
</tr>
<tr>
<td align="center"><span style = "color:red"><strong>sys_user_role</strong></span></td>
<td align="center"><span style = "color:red"><strong>用户和角色关联表</strong></span></td>
</tr>
</tbody></table>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/e34a8982a14929c9b4d00cae2f337c3e043708da/%E8%8B%A5%E4%BE%9D-%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6.jpg"></p>
<h6 id="创建新用户小智并关联课研人员角色，仅限课程管理和统计分析菜单访问。"><a href="#创建新用户小智并关联课研人员角色，仅限课程管理和统计分析菜单访问。" class="headerlink" title="创建新用户小智并关联课研人员角色，仅限课程管理和统计分析菜单访问。"></a>创建新用户小智并关联课研人员角色，仅限课程管理和统计分析菜单访问。</h6><p>① <strong>创建菜单</strong><br>② <strong>创建角色，并分配权限</strong><del>课研人员</del><br>③ <strong>创建用户，并关联角色</strong><del>xiaozhi</del></p>
<pre><code class="java">若依通过简单的功能配置实现RBC的权限管理
</code></pre>
<h5 id="数据字典"><a href="#数据字典" class="headerlink" title="数据字典"></a>数据字典</h5><ul>
<li>若依内置的数据字典，用于维护系统中常见的静态数据。例如：性别、状态</li>
<li>功能包括：字典类型管理、字典数据管理</li>
<li>表关系说明【一对多】</li>
</ul>
<table>
<thead>
<tr>
<th>表名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>sys_dict_type</td>
<td>字典类型表</td>
</tr>
<tr>
<td>sys_dict_data</td>
<td>字典数据表</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>dict_id</th>
<th>dict_name</th>
<th><span style = "color:red">dict_type</span></th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>用户性别</td>
<td>sys_user_sex</td>
</tr>
<tr>
<td>2</td>
<td>菜单状态</td>
<td>sys_show_hide</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>dict_code</th>
<th>dict_sort</th>
<th>dict_label</th>
<th>dict_value</th>
<th><span style = "color:red">dict_type</span></th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>男</td>
<td>0</td>
<td>sys_user_sex</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>女</td>
<td>1</td>
<td>sys_user_sex</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>未知</td>
<td>2</td>
<td>sys_user_sex</td>
</tr>
</tbody></table>
<ul>
<li><p><strong>将一些不经常修改的数据(课程管理的学科字段)改为数据字典维护，以免占用大量空间</strong></p>
<ul>
<li><p>添加字典类型和数据</p>
<blockquote>
<p>系统管理 → 字典管理 → 新增 → <strong>添加字典类型</strong><br>字典名称：学科<br>字典类型：course_subject<br>第二页点进去<strong>添加字典数据</strong><br>javaEE → 0 → 1 </p>
</blockquote>
</li>
<li><p>修改代码生成信息</p>
<blockquote>
<p>系统工具 → 代码生成 → 编辑课程管理 → subject课程学科 显示类型从<strong>文本框</strong>改成<strong>下拉框</strong> → 字典类型 是学科 → 下载最新的代码<br>只需要修改前端vue组件 因为只改了从前端文本框到下拉框 和一些数据字典</p>
</blockquote>
</li>
<li><p>下载代码，导入前端</p>
<blockquote>
<p>C:\Users\Pluminary\Downloads\ruoyi (1)\vue\views\course\course\index.vue去替换前端的index.vue  此时去若依前端查看课程管理→课程学科就会发现已经添加新的进去了</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>此时去<code>课程管理</code>里面找<code>课程学科：JavaEE</code>进行筛选不会出 因为若依底层<br><a target="_blank" rel="noopener" href="http://10.254.2.179/dev-api/course/course/list?pageNum=1&amp;pageSize=10&amp;subject=0">http://10.254.2.179/dev-api/course/course/list?pageNum=1&amp;pageSize=10&amp;subject=0</a><br>要从数据库里把JavaEE的subject改成0<br>优点：<strong>降低数据库的存储压力 提高磁盘利用率</strong></p>
</blockquote>
<h5 id="其他功能"><a href="#其他功能" class="headerlink" title="其他功能"></a>其他功能</h5><ul>
<li><p><strong>参数设置</strong>：对系统中的参数进行动态维护</p>
<blockquote>
<p>系统管理 → 参数设置 → 验证码开关 → 修改 → 参数键值 → false<br>还可以开启是否 <u>用户注册功能</u> → 前端代码隐藏需要修改 → src&#x2F;views&#x2F;login.vue → 97行注册开关<br>const register &#x3D; ref(true) 此时登录界面就有立即注册 跳转注册</p>
</blockquote>
</li>
<li><p><strong>通知公告(半成品)：</strong>促进组织内部信息传递</p>
<blockquote>
<p>系统管理 → 通知公告 → 新增</p>
</blockquote>
</li>
<li><p><strong>日志管理：</strong>轻松追踪用户行为和系统运行状况</p>
<blockquote>
<p>系统管理 → 通知公告 → 日志管理 → 操作日志</p>
</blockquote>
</li>
</ul>
<h5 id="系统监控"><a href="#系统监控" class="headerlink" title="系统监控"></a>系统监控</h5><ul>
<li><p>若依提供了一些列强大的监控工具，能够帮助开发者和运维快速了解应用程序的性能状态</p>
<blockquote>
<p>系统监控 → 在线用户 &amp;&amp; 缓存列表<br>数据监控【Druid Monitor】 → ruoyi &amp;&amp; 123456</p>
</blockquote>
</li>
</ul>
<h5 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h5><ul>
<li><p>若依为定时任务功能提供方便友好的web界面，实现动态管理任务</p>
<pre><code class="java">@Component
public class MyTask&#123;
  @Scheduled(cron = &quot;0/5 *****?&quot;)
  public void showTime()&#123;
     sout(&quot;定时任务开始执行：&quot; + new Date());
  &#125;
&#125;
// 硬编码 改代码需要重新修改 重新编译 重新上传...
</code></pre>
</li>
<li><p><strong>每间隔5秒，控制台输出系统时间</strong></p>
<ul>
<li><p>创建任务类</p>
<blockquote>
<p>创建一个类 <code>C:\Users\Pluminary\Desktop\RuoYi-Vue\ruoyi-quartz\src\main\java\com\ruoyi\quartz\task\MyTask.java</code></p>
<pre><code class="java">package com.ruoyi.quartz.task;

import org.springframework.stereotype.Component;

import java.util.Date;

@Component
public class MyTask &#123;
    public void showTime()&#123;
        System.out.println(&quot;定时任务开始执行：&quot; + new Date());
    &#125;
&#125;
</code></pre>
</blockquote>
</li>
<li><p>添加任务规则</p>
<blockquote>
<p>系统监控 → 定时任务 → 新增 →<br>任务名称：输出时间        任务分组：默认<br>调用方式：myTask.showTime()<br>Cron表达式生成器：<u>从0秒开始，每5秒执行一次</u> → 0&#x2F;5 * * * * ?<br>开启输出时间 状态打开！</p>
<h2 id="然后每间隔5秒就会向控制台输出时间"><a href="#然后每间隔5秒就会向控制台输出时间" class="headerlink" title="然后每间隔5秒就会向控制台输出时间"></a>然后每间隔5秒就会向控制台输出时间</h2><p>定时任务开始执行：Wed Nov 06 18:12:30 CST 2024<br>18:12:30.001 [quartzScheduler_Worker-4] DEBUG c.r.q.m.S.insertJobLog - [debug,135] - &gt; Preparing: insert into sys_job_log( job_name, job_group, invoke_target, job_message, status, create_time )values( ?, ?, ?, ?, ?, sysdate() ) 18:12:30.002 [quartzScheduler_Worker-4] DEBUG c.r.q.m.S.insertJobLog - [debug,135] - –&gt; Parameters: 输出时间(String), DEFAULT(String), myTask.showTime()(String), 输出时间 总共耗时：0毫秒(String), 0(String) 18:12:30.009 [quartzScheduler_Worker-4] DEBUG c.r.q.m.S.insertJobLog - [debug,135] - &lt; Updates: 1 定时任务开始执行：Wed Nov 06 18:12:35 CST 2024 18:12:35.006 [quartzScheduler_Worker-5] DEBUG c.r.q.m.S.insertJobLog - [debug,135] - &gt; Preparing: insert into sys_job_log( job_name, job_group, invoke_target, job_message, status, create_time )values( ?, ?, ?, ?, ?, sysdate() ) 18:12:35.006 [quartzScheduler_Worker-5] DEBUG c.r.q.m.S.insertJobLog - [debug,135] - –&gt; Parameters: 输出时间(String), DEFAULT(String), myTask.showTime()(String), 输出时间 总共耗时：0毫秒(String), 0(String) 18:12:35.012 [quartzScheduler_Worker-5] DEBUG c.r.q.m.S.insertJobLog - [debug,135] - &lt; Updates: 1</p>
</blockquote>
</li>
<li><p><strong>启动任务</strong></p>
<p>官方有提供可以训练的模型</p>
<blockquote>
<p>在这里面：com&#x2F;ruoyi&#x2F;quartz&#x2F;task&#x2F;RyTask.java</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h5 id="表单构建"><a href="#表单构建" class="headerlink" title="表单构建"></a>表单构建</h5><ul>
<li><h6 id="通过表单构建工具，单独制作一个添加课程的表单页面"><a href="#通过表单构建工具，单独制作一个添加课程的表单页面" class="headerlink" title="通过表单构建工具，单独制作一个添加课程的表单页面"></a>通过表单构建工具，单独制作一个添加课程的表单页面</h6><ul>
<li><p>制作表单并导出</p>
<blockquote>
<p>系统工具 → 表单构建 → 左侧<strong>行容器</strong> → 拖入第一个单行文本 → 右侧可以改名字 如果想实现一行两个文本的化 就把<code>表单栅格调小一点</code> → 选择性组件的<strong>下拉选择</strong>托到右面 → 修改字段名、标题、表单栅格…<br>日期范围 → 课程有效期 → 选择型组件里的日期范围 命名为：课程有效期<br>文件上传组件 → 课程封面<br>评分 → 推荐指数<br>多行文本 → 课程介绍</p>
</blockquote>
</li>
<li><p>复制到前端工程</p>
<blockquote>
<p>搞完后打开前端工程把add.vue它放在 src&#x2F;views&#x2F;course&#x2F;course&#x2F;中</p>
</blockquote>
</li>
<li><p>创建动态菜单</p>
<blockquote>
<p>系统管理 → 菜单管理 → 添加菜单 →<br>菜单类型：菜单<br>菜单名称：添加课程<br>显示排序：1<br>路由地址：course&#x2F;add<br>组件路径：course&#x2F;course&#x2F;add<br>刷新界面 就会有菜单管理→添加课程了</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h4 id="系统工具"><a href="#系统工具" class="headerlink" title="系统工具"></a>系统工具</h4><h5 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h5><ul>
<li>代码生成器，根据数据库表结构自动生成前后端CRUD代码</li>
<li>提供三种生成模板：单表、树表、主子表(一对多)</li>
<li>树表是一种展示层级数据的表格，能展开折叠，清晰呈现父子关系，便于管理</li>
</ul>
<blockquote>
<p>系统工具 → 代码生成 → 导入部门表 → 编辑 → 生成信息 → 生成模板：树表 →<br>树编码字段：dept_id：部门id<br>树父编码字段：parent_id：父部门id<br>树名称字段：dept_name：部门名称<br>提交后下载代码<br>导入后就是 系统管理&#x2F;部门管理 的树型结构界面了</p>
</blockquote>
<table>
<thead>
<tr>
<th>dept_id</th>
<th>parent_id</th>
<th>ancestors</th>
<th>dept_name</th>
</tr>
</thead>
<tbody><tr>
<td>100</td>
<td>0</td>
<td>0</td>
<td>若依科技</td>
</tr>
<tr>
<td>101</td>
<td>100</td>
<td>0,100</td>
<td>深圳总公司</td>
</tr>
<tr>
<td><span style = "color:red">102</span></td>
<td>100</td>
<td>0,100</td>
<td>长沙分公司</td>
</tr>
<tr>
<td>108</td>
<td><span style = "color:red">102</span></td>
<td>0,100,101</td>
<td>市场部门</td>
</tr>
<tr>
<td>109</td>
<td><span style = "color:red">102</span></td>
<td>0,100,102</td>
<td>财务部门</td>
</tr>
</tbody></table>
<h5 id="系统接口"><a href="#系统接口" class="headerlink" title="系统接口"></a>系统接口</h5><ul>
<li><p>Swagger，能够自动生成API的同步在线文档，并提供Web界面进行接口调用和测试</p>
<blockquote>
<p>系统工具 → 系统接口<br>若依的Token在应用程序里 需要搞token进去<br>测试：获取用户列表GET<br>得到Token(F12后找应用程序 → Cookie<del>若依</del> → 找到Admin-Token<del>一定是当前ip地址的Token</del> → 在Authorize中设置Token令牌 → 去后端改swagger的请求前缀pathMapping：&#x2F;<del>因为他的地址前面默认佩戴&#x2F;dev-api</del></p>
<pre><code class="yaml"># Swagger配置
swagger:
  # 是否开启swagger
  enabled: true
  # 请求前缀
  pathMapping: /
</code></pre>
<p>然后重启后台项目刷新浏览器打开接口再调用Token再去测试<br>此时就操作成功了</p>
<pre><code class="json">&#123;
  &quot;code&quot;: 200,
  &quot;msg&quot;: &quot;操作成功&quot;,
  &quot;data&quot;: [
    &#123;
      &quot;userId&quot;: 1,
      &quot;username&quot;: &quot;admin&quot;,
      &quot;password&quot;: &quot;admin123&quot;,
      &quot;mobile&quot;: &quot;15888888888&quot;
    &#125;,
    &#123;
      &quot;userId&quot;: 2,
      &quot;username&quot;: &quot;ry&quot;,
      &quot;password&quot;: &quot;admin123&quot;,
      &quot;mobile&quot;: &quot;15666666666&quot;
    &#125;
  ]
&#125;
</code></pre>
</blockquote>
</li>
</ul>
<p><span style = "color:red"><strong>若依常用功能？</strong></span></p>
<p>① <strong>权限控制</strong><br>② <strong>数据字典</strong><br>③ <strong>定时任务</strong><br>④ <strong>表单构建</strong><br>⑤ <strong>代码生成</strong></p>
<h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><img src="https://raw.githubusercontent.com/P-luminary/images/2d1ced51ed4dfb918b78181cb385e58594e7bdaa/RuoYi%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.jpg"  />

<h5 id="表结构"><a href="#表结构" class="headerlink" title="表结构"></a>表结构</h5><img src="https://raw.githubusercontent.com/P-luminary/images/f157a27c9825e2305562a5f7a5917ad511ee7ac5/RuoYi%E8%A1%A8%E7%BB%93%E6%9E%84.jpg" style="zoom:150%;" />

<h5 id="前端代码分析"><a href="#前端代码分析" class="headerlink" title="前端代码分析"></a>前端代码分析</h5><ul>
<li><code>api/course/course.js</code>  用于向后端发送Ajax请求的接口代码</li>
<li><code>views/course/course/index.vue</code>用于在浏览器展示课程的视图组件</li>
</ul>
<pre><code class="vue">src\views\course\course\index.vue
&lt;template&gt;
  &lt;div class=&quot;app-container&quot;&gt;
    &lt;!-- :model做双向绑定 将前端录入条件封装给响应对象  v-show控制搜索栏显示隐藏--&gt;
    &lt;el-form :model=&quot;queryParams&quot; ref=&quot;queryRef&quot; :inline=&quot;true&quot; v-show=&quot;showSearch&quot; label-width=&quot;68px&quot;&gt;
      &lt;el-form-item label=&quot;课程编码&quot; prop=&quot;code&quot;&gt;
        &lt;!-- v-model双向绑定code(前端课程编码) clearable清理用户输入信息 @keyup键盘回车事件完成搜索--&gt;
        &lt;el-input
          v-model=&quot;queryParams.code&quot;
          placeholder=&quot;请输入课程编码&quot;
          clearable
          @keyup.enter=&quot;handleQuery&quot;
        /&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item label=&quot;课程学科&quot; prop=&quot;subject&quot;&gt;
        &lt;!-- v-for遍历课程学科的字典数据列表 :lable展示label :value提交value值--&gt;
        &lt;el-select v-model=&quot;queryParams.subject&quot; placeholder=&quot;请选择课程学科&quot; clearable&gt;
          &lt;el-option
            v-for=&quot;dict in course_subject&quot;
            :key=&quot;dict.value&quot;
            :label=&quot;dict.label&quot;
            :value=&quot;dict.value&quot;
          /&gt;
        &lt;/el-select&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item label=&quot;课程名称&quot; prop=&quot;name&quot;&gt;
        &lt;el-input
          v-model=&quot;queryParams.name&quot;
          placeholder=&quot;请输入课程名称&quot;
          clearable
          @keyup.enter=&quot;handleQuery&quot;
        /&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item label=&quot;适用人群&quot; prop=&quot;applicablePerson&quot;&gt;
        &lt;el-select v-model=&quot;queryParams.applicablePerson&quot; placeholder=&quot;请选择适用人群&quot; clearable&gt;
          &lt;el-option
            v-for=&quot;dict in course_applicable_person&quot;
            :key=&quot;dict.value&quot;
            :label=&quot;dict.label&quot;
            :value=&quot;dict.value&quot;
          /&gt;
        &lt;/el-select&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item&gt;
        &lt;el-button type=&quot;primary&quot; icon=&quot;Search&quot; @click=&quot;handleQuery&quot;&gt;搜索&lt;/el-button&gt;
        &lt;el-button icon=&quot;Refresh&quot; @click=&quot;resetQuery&quot;&gt;重置&lt;/el-button&gt;
      &lt;/el-form-item&gt;
    &lt;/el-form&gt;

    &lt;el-row :gutter=&quot;10&quot; class=&quot;mb8&quot;&gt;
      &lt;el-col :span=&quot;1.5&quot;&gt;
        &lt;!-- @click点击新增按钮弹出新增 v-hasPermi自定义属性完成菜单显示/隐藏 --&gt;
        &lt;el-button
          type=&quot;primary&quot;
          plain
          icon=&quot;Plus&quot;
          @click=&quot;handleAdd&quot;
          v-hasPermi=&quot;[&#39;course:course:add&#39;]&quot;
        &gt;新增&lt;/el-button&gt;
      &lt;/el-col&gt;
      &lt;!-- :disabled表示这个框是否可用 --&gt;
      &lt;el-col :span=&quot;1.5&quot;&gt;
        &lt;el-button
          type=&quot;success&quot;
          plain
          icon=&quot;Edit&quot;
          :disabled=&quot;single&quot;
          @click=&quot;handleUpdate&quot;
          v-hasPermi=&quot;[&#39;course:course:edit&#39;]&quot;
        &gt;修改&lt;/el-button&gt;
      &lt;/el-col&gt;
      &lt;el-col :span=&quot;1.5&quot;&gt;
        &lt;el-button
          type=&quot;danger&quot;
          plain
          icon=&quot;Delete&quot;
          :disabled=&quot;multiple&quot;
          @click=&quot;handleDelete&quot;
          v-hasPermi=&quot;[&#39;course:course:remove&#39;]&quot;
        &gt;删除&lt;/el-button&gt;
      &lt;/el-col&gt;
      &lt;el-col :span=&quot;1.5&quot;&gt;
        &lt;el-button
          type=&quot;warning&quot;
          plain
          icon=&quot;Download&quot;
          @click=&quot;handleExport&quot;
          v-hasPermi=&quot;[&#39;course:course:export&#39;]&quot;
        &gt;导出&lt;/el-button&gt;
      &lt;/el-col&gt;
      &lt;!-- 点击会控制&#39;搜索栏&#39;显示隐藏 @queryTable重新加载表格展示数据 --&gt;
      &lt;right-toolbar v-model:showSearch=&quot;showSearch&quot; @queryTable=&quot;getList&quot;&gt;&lt;/right-toolbar&gt;
    &lt;/el-row&gt;
    &lt;!-- v-loading展示表格的加载状态 遍历展示courseList 事件监听器监听选中行 --&gt;
    &lt;el-table v-loading=&quot;loading&quot; :data=&quot;courseList&quot; @selection-change=&quot;handleSelectionChange&quot;&gt;
      &lt;!-- 当用户勾选复选框 触发@selection-change --&gt;
      &lt;el-table-column type=&quot;selection&quot; width=&quot;55&quot; align=&quot;center&quot; /&gt;
      &lt;!-- 展示具体数据源数据 --&gt;
      &lt;el-table-column label=&quot;课程id&quot; align=&quot;center&quot; prop=&quot;id&quot; /&gt;
      &lt;el-table-column label=&quot;课程编码&quot; align=&quot;center&quot; prop=&quot;code&quot; /&gt;
      &lt;el-table-column label=&quot;课程学科&quot; align=&quot;center&quot; prop=&quot;subject&quot;&gt;
 &lt;!-- 通过scope拿到整个表格数据 通过:value=&quot;scope.row.subject&quot;拿到字典值去匹配字典数据列表 找到该值对应的标签显示给前端--&gt;
        &lt;template #default=&quot;scope&quot;&gt;
          &lt;dict-tag :options=&quot;course_subject&quot; :value=&quot;scope.row.subject&quot;/&gt;
        &lt;/template&gt;
      &lt;/el-table-column&gt;
      &lt;el-table-column label=&quot;课程名称&quot; align=&quot;center&quot; prop=&quot;name&quot; /&gt;
      &lt;el-table-column label=&quot;价格&quot; align=&quot;center&quot; prop=&quot;price&quot; /&gt;
      &lt;el-table-column label=&quot;适用人群&quot; align=&quot;center&quot; prop=&quot;applicablePerson&quot;&gt;
        &lt;template #default=&quot;scope&quot;&gt;
          &lt;dict-tag :options=&quot;course_applicable_person&quot; :value=&quot;scope.row.applicablePerson&quot;/&gt;
        &lt;/template&gt;
      &lt;/el-table-column&gt;
      &lt;el-table-column label=&quot;课程介绍&quot; align=&quot;center&quot; prop=&quot;info&quot; /&gt;
      &lt;el-table-column label=&quot;操作&quot; align=&quot;center&quot; class-name=&quot;small-padding fixed-width&quot;&gt;
&lt;!-- 使用了模板插槽 --&gt;
        &lt;template #default=&quot;scope&quot;&gt;
          &lt;!-- @click=&quot;handleUpdate(scope.row)把当前行的数据传给当前方法  v-hasPermi自定义权限属性--&gt;
          &lt;el-button link type=&quot;primary&quot; icon=&quot;Edit&quot; @click=&quot;handleUpdate(scope.row)&quot; v-hasPermi=&quot;[&#39;course:course:edit&#39;]&quot;&gt;修改&lt;/el-button&gt;
          &lt;el-button link type=&quot;primary&quot; icon=&quot;Delete&quot; @click=&quot;handleDelete(scope.row)&quot; v-hasPermi=&quot;[&#39;course:course:remove&#39;]&quot;&gt;删除&lt;/el-button&gt;
        &lt;/template&gt;
      &lt;/el-table-column&gt;
    &lt;/el-table&gt;
    
    &lt;!-- 分页区域 --&gt;
     &lt;!-- v-show如果大于0条就显示反之隐藏 :total展示总条数 展示分页页码 @pagination=&quot;getList&quot;换页后新数据的查询--&gt;
    &lt;pagination
      v-show=&quot;total&gt;0&quot;
      :total=&quot;total&quot;
      v-model:page=&quot;queryParams.pageNum&quot;
      v-model:limit=&quot;queryParams.pageSize&quot;
      @pagination=&quot;getList&quot;
    /&gt;

    &lt;!-- 添加或修改课程管理对话框 --&gt;
     &lt;!-- el-dialog默认隐藏的 点击会显示 append-to-body默认将对话框在body上追加显示 :title动态绑定标题(新增和修改不一样)--&gt;
    &lt;el-dialog :title=&quot;title&quot; v-model=&quot;open&quot; width=&quot;500px&quot; append-to-body&gt;
      &lt;!-- :model来双向绑定 :rules校验规则--&gt;
      &lt;el-form ref=&quot;courseRef&quot; :model=&quot;form&quot; :rules=&quot;rules&quot; label-width=&quot;80px&quot;&gt;
        &lt;el-form-item label=&quot;课程编码&quot; prop=&quot;code&quot;&gt;
          &lt;el-input v-model=&quot;form.code&quot; placeholder=&quot;请输入课程编码&quot; /&gt;
        &lt;/el-form-item&gt;
        &lt;el-form-item label=&quot;课程学科&quot; prop=&quot;subject&quot;&gt;
          &lt;el-select v-model=&quot;form.subject&quot; placeholder=&quot;请选择课程学科&quot;&gt;
            &lt;el-option
              v-for=&quot;dict in course_subject&quot;
              :key=&quot;dict.value&quot;
              :label=&quot;dict.label&quot;
              :value=&quot;dict.value&quot;
            &gt;&lt;/el-option&gt;
          &lt;/el-select&gt;
        &lt;/el-form-item&gt;
        &lt;el-form-item label=&quot;课程名称&quot; prop=&quot;name&quot;&gt;
          &lt;el-input v-model=&quot;form.name&quot; placeholder=&quot;请输入课程名称&quot; /&gt;
        &lt;/el-form-item&gt;
        &lt;el-form-item label=&quot;价格&quot; prop=&quot;price&quot;&gt;
          &lt;el-input v-model=&quot;form.price&quot; placeholder=&quot;请输入价格&quot; /&gt;
        &lt;/el-form-item&gt;
        &lt;el-form-item label=&quot;适用人群&quot; prop=&quot;applicablePerson&quot;&gt;
          &lt;el-select v-model=&quot;form.applicablePerson&quot; placeholder=&quot;请选择适用人群&quot;&gt;
            &lt;el-option
              v-for=&quot;dict in course_applicable_person&quot;
              :key=&quot;dict.value&quot;
              :label=&quot;dict.label&quot;
              :value=&quot;dict.value&quot;
            &gt;&lt;/el-option&gt;
          &lt;/el-select&gt;
        &lt;/el-form-item&gt;
        &lt;el-form-item label=&quot;课程介绍&quot; prop=&quot;info&quot;&gt;
          &lt;el-input v-model=&quot;form.info&quot; placeholder=&quot;请输入课程介绍&quot; /&gt;
        &lt;/el-form-item&gt;
      &lt;/el-form&gt;
      &lt;template #footer&gt;
        &lt;div class=&quot;dialog-footer&quot;&gt;
          &lt;!-- 提交前先进行表单规则的校验:rules=&quot;rules&quot;  --&gt;
          &lt;el-button type=&quot;primary&quot; @click=&quot;submitForm&quot;&gt;确 定&lt;/el-button&gt;
          &lt;el-button @click=&quot;cancel&quot;&gt;取 消&lt;/el-button&gt;
        &lt;/div&gt;
      &lt;/template&gt;
    &lt;/el-dialog&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup name=&quot;Course&quot;&gt;
// 引入后端api接口文件
import &#123; listCourse, getCourse, delCourse, addCourse, updateCourse &#125; from &quot;@/api/course/course&quot;;
// 获取当前实例代理对象，用于访问组件数据、方法
const &#123; proxy &#125; = getCurrentInstance();
// 获取课程学科的数据字典
const &#123; course_applicable_person, course_subject &#125; = proxy.useDict(&#39;course_applicable_person&#39;, &#39;course_subject&#39;);
// 列表数据
const courseList = ref([]);
// 是否显示弹框
const open = ref(false);
// 是否显示加载状态
const loading = ref(true);
// 是否显示搜索栏
const showSearch = ref(true);
// 复选框，被选中id的数组
const ids = ref([]);
// 复选框，是否单选，用于高亮修改、删除按钮
const single = ref(true);
// 复选框，是否多选，仅高亮删除按钮
const multiple = ref(true);
// 总(记录)条数
const total = ref(0);
// 用于区分新增、修改对话框标题
const title = ref(&quot;&quot;);
// 定义reactive响应式对象
const data = reactive(&#123;
  // 新增或修改表单数据
  form: &#123;&#125;,
  // 搜索条件参数
  queryParams: &#123;
    pageNum: 1,
    pageSize: 10,
    code: null,
    subject: null,
    name: null,
    applicablePerson: null,
  &#125;,
  // 表单校验规则
  rules: &#123;
    code: [
      &#123; required: true, message: &quot;课程编码不能为空&quot;, trigger: &quot;blur&quot; &#125;
    ],
    subject: [
      &#123; required: true, message: &quot;课程学科不能为空&quot;, trigger: &quot;change&quot; &#125;
    ],
    name: [
      &#123; required: true, message: &quot;课程名称不能为空&quot;, trigger: &quot;blur&quot; &#125;
    ],
    price: [
      &#123; required: true, message: &quot;价格不能为空&quot;, trigger: &quot;blur&quot; &#125;
    ],
    applicablePerson: [
      &#123; required: true, message: &quot;适用人群不能为空&quot;, trigger: &quot;change&quot; &#125;
    ],
    info: [
      &#123; required: true, message: &quot;课程介绍不能为空&quot;, trigger: &quot;blur&quot; &#125;
    ],
  &#125;
&#125;);
// 将data对象的三个属性，转换为ref响应式对象
const &#123; queryParams, form, rules &#125; = toRefs(data);

/** 查询课程管理列表 */
function getList() &#123;
  loading.value = true;
  listCourse(queryParams.value).then(response =&gt; &#123;
    courseList.value = response.rows;
    total.value = response.total;
    loading.value = false;
  &#125;);
&#125;

// 取消按钮
function cancel() &#123;
  open.value = false;
  reset();
&#125;

// 表单重置
function reset() &#123;
  form.value = &#123;
    id: null,
    code: null,
    subject: null,
    name: null,
    price: null,
    applicablePerson: null,
    info: null,
    createTime: null,
    updateTime: null
  &#125;;
  proxy.resetForm(&quot;courseRef&quot;);
&#125;

/** 搜索按钮操作 */
function handleQuery() &#123;
  // 最新的从第一页开始 再发送请求
  queryParams.value.pageNum = 1;
  getList();
&#125;

/** 重置按钮操作 */
function resetQuery() &#123;
  proxy.resetForm(&quot;queryRef&quot;);
  handleQuery();
&#125;

// 多选框选中数据
// 把选中的复选框对象传递过来
function handleSelectionChange(selection) &#123;
  // 拿到对象调用map方法进行遍历取每个复选框的id
  // 封装给ids的响应式数组对象
  ids.value = selection.map(item =&gt; item.id);
  // 控制修改和删除按钮是否高亮可用的 23默认为true
  single.value = selection.length != 1;
  // 修改按钮只要大于0 就是false 那么修改按钮可用使用
  multiple.value = !selection.length;
&#125;

/** 新增按钮操作 */
function handleAdd() &#123;
  reset();
  open.value = true;
  title.value = &quot;添加课程管理&quot;;
&#125;

/** 修改按钮操作 */
// 拿到行对象 重置 取出当前行id或一个id
function handleUpdate(row) &#123;
  reset();
  const _id = row.id || ids.value
  getCourse(_id).then(response =&gt; &#123;
    form.value = response.data;
    open.value = true;
    title.value = &quot;修改课程管理&quot;;
  &#125;);
&#125;

/** 提交按钮 */
function submitForm() &#123;
  // &#39;修改课程&#39;对表单进行校验 正则规则...是否必填
  proxy.$refs[&quot;courseRef&quot;].validate(valid =&gt; &#123;
    if (valid) &#123;// 区分新增还是修改的操作
      if (form.value.id != null) &#123;
        updateCourse(form.value).then(response =&gt; &#123;
          proxy.$modal.msgSuccess(&quot;修改成功&quot;);
          open.value = false;
          getList();
        &#125;);
      &#125; else &#123;
        addCourse(form.value).then(response =&gt; &#123;
          proxy.$modal.msgSuccess(&quot;新增成功&quot;);
          open.value = false;
          getList();
        &#125;);
      &#125;
    &#125;
  &#125;);
&#125;

/** 删除按钮操作 */
function handleDelete(row) &#123;
  // 一行或数组
  const _ids = row.id || ids.value;
  // 防止误操作
  proxy.$modal.confirm(&#39;是否确认删除课程管理编号为&quot;&#39; + _ids + &#39;&quot;的数据项？&#39;).then(function() &#123;
    return delCourse(_ids);
  &#125;).then(() =&gt; &#123;
    getList();
    proxy.$modal.msgSuccess(&quot;删除成功&quot;);
  &#125;).catch(() =&gt; &#123;&#125;);
&#125;

/** 导出按钮操作 */
function handleExport() &#123;
  proxy.download(&#39;course/course/export&#39;, &#123;
    ...queryParams.value
  &#125;, `course_$&#123;new Date().getTime()&#125;.xlsx`)
&#125;

getList();
&lt;/script&gt;
</code></pre>
<pre><code class="js">src\api\course\course.js
// 封装了请求和响应拦截器 下面return每个都调用请求
import request from &#39;@/utils/request&#39;

// 查询课程管理列表
// 接收用户输入参数 调用工具类把参数传过去 向后端发送请求完成课程列表的查询
// 然后返回前端并展示数据
export function listCourse(query) &#123;
  return request(&#123;
    url: &#39;/course/course/list&#39;,
    method: &#39;get&#39;,
    params: query
  &#125;)
&#125;

// 查询课程管理详细
// 点击修改按钮时候根据id去查询 返回给前端
export function getCourse(id) &#123;
  return request(&#123;
    url: &#39;/course/course/&#39; + id,
    method: &#39;get&#39;
  &#125;)
&#125;

// 新增课程管理
// 当点击确定按钮的时候 就把数据添加进来发送请求后返回前端
export function addCourse(data) &#123;
  return request(&#123;
    url: &#39;/course/course&#39;,
    method: &#39;post&#39;,
    data: data
  &#125;)
&#125;

// 修改课程管理
// 修改完毕(根据id去查找数据库的)
export function updateCourse(data) &#123;
  return request(&#123;
    url: &#39;/course/course&#39;,
    method: &#39;put&#39;,
    data: data
  &#125;)
&#125;

// 删除课程管理
// 批量/单体删除
export function delCourse(id) &#123;
  return request(&#123;
    url: &#39;/course/course/&#39; + id,
    method: &#39;delete&#39;
  &#125;)
&#125;
</code></pre>
<h3 id="再次熟悉：前-后端结构"><a href="#再次熟悉：前-后端结构" class="headerlink" title="再次熟悉：前+后端结构"></a><span style = "color:red">再次熟悉：前+后端结构</span></h3><p><img src="https://raw.githubusercontent.com/P-luminary/images/2d1ced51ed4dfb918b78181cb385e58594e7bdaa/RuoYi%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.jpg"></p>
<h6 id="若i18n乱码的情况下"><a href="#若i18n乱码的情况下" class="headerlink" title="若i18n乱码的情况下"></a>若i18n乱码的情况下</h6><blockquote>
<p>file -&gt; settings -&gt; editor -&gt; file ecoding -&gt; <strong>default encoding for properties files</strong>：utf-8</p>
</blockquote>
<h3 id="后端代码分析"><a href="#后端代码分析" class="headerlink" title="后端代码分析"></a>后端代码分析</h3><ul>
<li><p><strong>CourseController</strong></p>
</li>
<li><p><strong>ICourseService及实现类</strong></p>
</li>
<li><p><strong>CourseMapper及映射方法</strong></p>
</li>
<li><p><strong>Course</strong></p>
</li>
<li><p><strong><u>BaseController：web层通用数据处理</u></strong></p>
</li>
</ul>
<img src="https://raw.githubusercontent.com/P-luminary/images/afd799acd589023d8452649e6565150168bee83b/BaseController%E5%86%85%E5%AE%B9.jpg" style="zoom:200%;" />

<pre><code class="java">/**
     * 查询课程管理列表
     */
    @PreAuthorize(&quot;@ss.hasPermi(&#39;course:course:list&#39;)&quot;)
    @GetMapping(&quot;/list&quot;)
    public TableDataInfo list(Course course) &#123;
        //1.开启分页
        startPage();
        //2.查询课程列表
        List&lt;Course&gt; list = courseService.selectCourseList(course);
        return getDataTable(list);
    &#125;
// 在分页查询那块会附带着两个封装好的sql语句
// select * from tb_course where xxx 【逐步细分成两个小sql】
  1. select count(*) from tb_course where xxx      //总记录数
  2. select * from tb_course where xxx limit ?,?   //获取当前的数据列表
</code></pre>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/644e3ab525e8c4aaf75d6f6f3e3879cb2a196303/%E5%88%86%E9%A1%B5%E9%80%BB%E8%BE%91%E5%8E%9F%E7%90%86.jpg"></p>
<h5 id="分页原理"><a href="#分页原理" class="headerlink" title="分页原理"></a>分页原理</h5><p><img src="https://raw.githubusercontent.com/P-luminary/images/14bbabe082a07e29da26ea9d5f0c648dcf91677a/%E5%88%86%E9%A1%B5%E9%80%BB%E8%BE%91%E5%8E%9F%E7%90%862.jpg"></p>
<h5 id="AjaxResult：操作消息提醒"><a href="#AjaxResult：操作消息提醒" class="headerlink" title="AjaxResult：操作消息提醒"></a>AjaxResult：操作消息提醒</h5><p><img src="https://raw.githubusercontent.com/P-luminary/images/92f34019d9a098b23780c66e99a5bab18541ee9a/AjaxResult%E6%93%8D%E4%BD%9C%E4%BF%A1%E6%81%AF%E6%8F%90%E9%86%92.jpg"></p>
<h5 id="权限解读"><a href="#权限解读" class="headerlink" title="权限解读"></a>权限解读</h5><ul>
<li><code>@PreAuthorize</code>注解是Spring Security框架中用来做权限检查的。</li>
<li>它在运行方法前先验证权限，权限够就放行，不够就拦截</li>
</ul>
<pre><code class="java">@RestController
@RequestMapping(&quot;/course/course&quot;)
public class CourseController extends BaseController &#123;
    @Autowired
    private ICourseService courseService;

    /**
     * 查询课程管理列表
     */
// 问题：我怎么知道该用户有没有权限呢？基于RBC权限模型 
    @PreAuthorize(&quot;@ss.hasPermi(&#39;course:course:list&#39;)&quot;)
    @GetMapping(&quot;/list&quot;)
    public TableDataInfo list(Course course) &#123;
        startPage();
        List&lt;Course&gt; list = courseService.selectCourseList(course);
        return getDataTable(list);
    &#125;
&#125;
</code></pre>
<table>
<thead>
<tr>
<th>菜单名称</th>
<th>排序</th>
<th>权限标识</th>
</tr>
</thead>
<tbody><tr>
<td>课程管理</td>
<td>1</td>
<td>course:course:list</td>
</tr>
<tr>
<td>课程管理查询</td>
<td>1</td>
<td>course:course:query</td>
</tr>
<tr>
<td>课程管理新增</td>
<td>2</td>
<td>course:course:add</td>
</tr>
<tr>
<td>课程管理修改</td>
<td>3</td>
<td>course:course:edit</td>
</tr>
<tr>
<td>课程管理删除</td>
<td>4</td>
<td>course:course:remove</td>
</tr>
<tr>
<td>课程管理导出</td>
<td>5</td>
<td>course:course:export</td>
</tr>
</tbody></table>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/623caf468a6f636c5fe27e119368bfabc1e20aa2/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E6%B5%81%E7%A8%8B%E5%9B%BE.jpg"></p>
<pre><code class="java">PermissionService.java
源码解读在后期

/**
 * RuoYi首创 自定义权限实现，ss取自SpringSecurity首字母
 * 
 * @author ruoyi
 */
@Service(&quot;ss&quot;)
public class PermissionService
&#123;
    /**
     * 验证用户是否具备某权限
     * 
     * @param permission 权限字符串
     * @return 用户是否具备某权限
     */
    public boolean hasPermi(String permission)
    &#123;
        if (StringUtils.isEmpty(permission))
        &#123;
            return false;
        &#125;
        LoginUser loginUser = SecurityUtils.getLoginUser();
        if (StringUtils.isNull(loginUser) || CollectionUtils.isEmpty(loginUser.getPermissions()))
        &#123;
            return false;
        &#125;
        PermissionContextHolder.setContext(permission);
        return hasPermissions(loginUser.getPermissions(), permission);
    &#125;
</code></pre>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/7e976e8ec0b1bb90abd5f6fc94d23c9b8ba39a8b/%E5%89%8D%E5%90%8E%E8%81%94%E8%B0%83.jpg"></p>
<h3 id="二次开发-——-苍穹外卖"><a href="#二次开发-——-苍穹外卖" class="headerlink" title="二次开发 —— 苍穹外卖"></a>二次开发 —— 苍穹外卖</h3><h5 id="若依框架修改器"><a href="#若依框架修改器" class="headerlink" title="若依框架修改器"></a>若依框架修改器</h5><ul>
<li>若依框架修改器是一个可以一键修改RuoYi框架包名、项目名等的工具</li>
</ul>
<blockquote>
<p>E:\Java实例项目1-20套\2024-Java若依框架专题课\01-基础篇\资料\04-二次开发\若依框架修改器.exe</p>
</blockquote>
<pre><code class="java">选择系列：RuoYi-Vue
目录名称: sky
项目名：sky
包名：com.sky
artifactId：sky
groupId：com.sky
站点名称：外卖管理系统


C:\Users\Pluminary\Desktop\20241108150415\sky
</code></pre>
<h5 id="新建业务模块"><a href="#新建业务模块" class="headerlink" title="新建业务模块"></a>新建业务模块</h5><ul>
<li><p>新建<code>sky-merchant</code>子模块<del>商家管理</del></p>
<ul>
<li><p>新建子模块<br><code>sky-merchant</code> → Advanced Settings → GroupId：com.sky</p>
</li>
<li><p>父工程版本锁定</p>
<pre><code class="xml">pom.xml(sky总)
&lt;!-- 商家管理--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.sky&lt;/groupId&gt;
                &lt;artifactId&gt;sky-merchant&lt;/artifactId&gt;
                &lt;version&gt;$&#123;sky.version&#125;&lt;/version&gt;
            &lt;/dependency&gt;
</code></pre>
<pre><code class="xml">pom.xml(sky-merchant)
&lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.sky&lt;/groupId&gt;
            &lt;artifactId&gt;sky-framework&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
</code></pre>
</li>
<li><p>sky-admin添加依赖</p>
<pre><code class="xml">pom.xml(sky-admin) 
&lt;dependency&gt;
            &lt;groupId&gt;com.sky&lt;/groupId&gt;
            &lt;artifactId&gt;sky-merchant&lt;/artifactId&gt;
        &lt;/dependency&gt;
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="菜品管理"><a href="#菜品管理" class="headerlink" title="菜品管理"></a>菜品管理</h3><ul>
<li><strong>利用若依代码生成器(主子表模板)，生成菜品管理的前后端代码</strong></li>
</ul>
<table>
<thead>
<tr>
<th align="left">tb_dish【菜品管理】</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><span style = "color:red"><strong>id</strong></span></td>
</tr>
<tr>
<td align="left">name</td>
</tr>
<tr>
<td align="left">price</td>
</tr>
<tr>
<td align="left">image</td>
</tr>
<tr>
<td align="left">description</td>
</tr>
<tr>
<td align="left">status</td>
</tr>
<tr>
<td align="left">create_time</td>
</tr>
<tr>
<td align="left">update_time</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>tb_dish_flavor【菜品口味关系表】</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
</tr>
<tr>
<td><span style = "color:red"><strong>dish_id</strong></span></td>
</tr>
<tr>
<td>name</td>
</tr>
<tr>
<td>value</td>
</tr>
</tbody></table>
<ul>
<li><p>准备SQL并导入数据库</p>
<blockquote>
<p>E:\Java实例项目1-20套\2024-Java若依框架专题课\01-基础篇\资料\04-二次开发\菜品管理</p>
</blockquote>
</li>
<li><p>配置代码生成信息【主子表的生成】</p>
<blockquote>
<p>在若依代码生成 → 导入表<strong>tb_dish</strong> 和 <strong>tb_dish_flavor</strong></p>
</blockquote>
</li>
<li><p>下载代码并导入项目</p>
</li>
<li><p>修改代码 → 系统工具 → 代码生成 → 菜品管理(修改) → </p>
<blockquote>
<p>基本信息：实体类名称→Dish     作者→itheima</p>
</blockquote>
<p>字段信息<del>参考页面原型生成</del> → 系统管理 → 字典管理 →</p>
<blockquote>
<p>字典名称：售卖状态<br>字典类型：dish_status<br>第二页点进去售卖状态的字典类型 dish_status → 新增</p>
<blockquote>
<p>数据标签：停售  +  起售<br>数据键值：0  +  1<br>显示排序：1  +  2</p>
</blockquote>
</blockquote>
</li>
</ul>
<p>​      回到系统工具 → 代码生成 → 菜品管理修改 → 售卖状态 → 显示类型：下拉框 → 字典类型：售卖状态</p>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/f50e3c057b0a8fae3fb16f4e3bcc1c9b507ed227/%E8%8F%9C%E5%8D%95%E8%8B%A5%E4%BE%9D%E4%BD%BF%E7%94%A8.jpg"></p>
<p>→ 代码生成 → 修改菜单配置信息 → 菜品</p>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/26b0d18887d1c565926b28e8d450fa2a773ccadb/%E6%B7%BB%E5%8A%A0%E8%8F%9C%E5%93%81.jpg"></p>
<p>→ 上面的生成信息</p>
<blockquote>
<p>生成模板：主子表<br>生成模块名：merchant<br>生成业务名：dish<br>关联子表的表名：tb_dish_flavor：菜品口味关系表<br>子表关联的外键名：dish_id：菜品</p>
</blockquote>
<p>→ 在代码生成 → tb_dish_flavor菜品口味关系表 → 点击编辑</p>
<blockquote>
<p>基本信息：<br>实体名：DishFalvor</p>
</blockquote>
<p>→ 生成代码(main后端 + vue前端 + dishMenu.sql数据库动态菜单) → 动态sql导入进去 → 前端vue将merchant导入到.&#x2F;src&#x2F;api中，将views导入到views中 → 在前端中将java和resources导入到merchant模块中</p>
<h4 id="对菜品管理进行升级改造"><a href="#对菜品管理进行升级改造" class="headerlink" title="对菜品管理进行升级改造"></a>对菜品管理进行升级改造</h4><h6 id="主键隐藏掉-售价前缀￥-修改时间时分秒"><a href="#主键隐藏掉-售价前缀￥-修改时间时分秒" class="headerlink" title="主键隐藏掉 售价前缀￥ 修改时间时分秒"></a>主键隐藏掉 售价前缀￥ 修改时间时分秒</h6><pre><code class="java">src\views\merchant\dish\index.vue 
把  &lt;el-table-column label=&quot;主键&quot; align=&quot;center&quot; prop=&quot;id&quot; /&gt;  打注释符
////////////////////////////////////////////////////////////////////////////
插入￥流程：
&lt;el-table-column label=&quot;售价&quot; align=&quot;center&quot; prop=&quot;price&quot; /&gt; 修改为 →
&lt;el-table-column label=&quot;售价&quot; align=&quot;center&quot; prop=&quot;price&quot;&gt;
        &lt;template #default=&quot;scope&quot;&gt;
          &lt;div&gt;
            ￥&#123;&#123; scope.row.price &#125;&#125;
          &lt;/div&gt;
        &lt;/template&gt;
      &lt;/el-table-column&gt;
通义灵码操作：
先解析那行代码，然后输入使用vue3语法在售价前显示￥
////////////////////////////////////////////////////////////////////////////
生成年月日时分秒：
&lt;el-table-column label=&quot;更新时间&quot; align=&quot;center&quot; prop=&quot;updateTime&quot; width=&quot;180&quot;&gt;
        &lt;template #default=&quot;scope&quot;&gt;
          &lt;span&gt;&#123;&#123; parseTime(scope.row.updateTime, '&#123;y&#125;-&#123;m&#125;-&#123;d&#125;') &#125;&#125;&lt;/span&gt;
        &lt;/template&gt;
      &lt;/el-table-column&gt;
修改为：

</code></pre>
<h6 id="修改图片回显bug"><a href="#修改图片回显bug" class="headerlink" title="修改图片回显bug"></a>修改图片回显bug</h6><blockquote>
<p>新增毛血旺的图片若依默认保存在了本地服务器而不是阿里云上<br><code>/profile/upload/2024/11/10/毛血旺_20241110093243A001.jpg</code></p>
<p>C:\Users\Pluminary\Desktop\20241108150415\sky\sky-admin\src\main\resources\application.yml</p>
<pre><code class="yaml"># 项目相关配置
ruoyi:
  # 名称
  name: RuoYi
  # 版本
  version: 3.8.8
  # 版权年份
  copyrightYear: 2024
  # 文件路径 示例（ Windows配置D:/ruoyi/uploadPath，Linux配置 /home/ruoyi/uploadPath）
  profile: D:/ruoyi/uploadPath
  # 获取ip地址开关
  addressEnabled: false
  # 验证码类型 math 数字计算 char 字符验证
  captchaType: math
</code></pre>
<p><code>D:\ruoyi\uploadPath\upload\2024\11\10</code><br>文件上传组件标签修改 增加<code>&amp;&amp; item.indexOf(&quot;http&quot;) === -1</code></p>
<pre><code class="js">watch(() =&gt; props.modelValue, val =&gt; &#123;
  if (val) &#123;
    // 首先将值转为数组
    const list = Array.isArray(val) ? val : props.modelValue.split(&quot;,&quot;);
    // 然后将数组转为对象数组
    fileList.value = list.map(item =&gt; &#123;
      if (typeof item === &quot;string&quot;) &#123;
        if (item.indexOf(baseUrl) === -1 &amp;&amp; item.indexOf(&quot;http&quot;) === -1) &#123;
          item = &#123; name: baseUrl + item, url: baseUrl + item &#125;;
        &#125; else &#123;
          item = &#123; name: item, url: item &#125;;
        &#125;
      &#125;
      return item;
    &#125;);
  &#125; else &#123;
    fileList.value = [];
    return [];
  &#125;
&#125;,&#123; deep: true, immediate: true &#125;);
</code></pre>
</blockquote>
<h6 id="修改口味列表数组格式-改为下拉框的口味搭配"><a href="#修改口味列表数组格式-改为下拉框的口味搭配" class="headerlink" title="修改口味列表数组格式 改为下拉框的口味搭配"></a>修改口味列表数组格式 改为下拉框的口味搭配</h6><pre><code class="js">src\views\merchant\dish\index.vue
//------------------------------------------------
// 定义口味名称和口味列表静态数据
const dishFlavorListSelect = ref([
  &#123;name:&quot;辣度&quot;, value:[&quot;不辣&quot;,&quot;微辣&quot;,&quot;中辣&quot;,&quot;重辣&quot;]&#125;,
  &#123;name:&quot;忌口&quot;, value:[&quot;不要葱&quot;,&quot;不要蒜&quot;,&quot;不要香菜&quot;,&quot;不要辣&quot;]&#125;,
  &#123;name:&quot;甜味&quot;, value:[&quot;无糖&quot;,&quot;少糖&quot;,&quot;半糖&quot;]&#125;
]);
//------------------------------------------------
</code></pre>
<pre><code class="js">src\views\merchant\dish\index.vue
&lt;template #default=&quot;scope&quot;&gt;
      &lt;!-- &lt;el-input v-model=&quot;scope.row.name&quot; placeholder=&quot;请输入口味名称&quot; /&gt; --&gt;
               &lt;!-- label是最终看到下拉框的内容 value是用户提交的内容 --&gt;
           &lt;el-select v-model=&quot;scope.row.name&quot;  placeholder=&quot;请选择口味名称&quot;&gt;
                &lt;el-option
                  v-for=&quot;dishFlavor in dishFlavorListSelect&quot;
                  :key=&quot;dishFlavor.name&quot;
                  :label=&quot;dishFlavor.name&quot; 
                  :value=&quot;dishFlavor.name&quot;
                &gt;
                &lt;/el-option&gt;
            &lt;/el-select&gt;
           &lt;/template&gt;
       &lt;/el-table-column&gt;
</code></pre>
<pre><code class="js">src\views\merchant\dish\index.vue【修改当选中辣度时候 后面的规格】
// 存储当前选中口味列表数组
const checkValueList = ref([]);
// 定义改变口味名称时更新当前选中的口味列表
function changeFlavorName(row)&#123;
  // 清空当前行的value
  row.value = [];
  // 根据选中的name去查找静态数据的value
  checkValueList.value = dishFlavorListSelect.value.find(item=&gt;item.name==row.name).value;
&#125;
</code></pre>
<pre><code class="js">//增加了一个 @change   注意：如果是多选框一定要 → multiple

&lt;el-table-column label=&quot;口味名称&quot; prop=&quot;name&quot; width=&quot;150&quot;&gt;
            &lt;template #default=&quot;scope&quot;&gt;
              &lt;!-- &lt;el-input v-model=&quot;scope.row.name&quot; placeholder=&quot;请输入口味名称&quot; /&gt; --&gt;
               &lt;!-- label是最终看到下拉框的内容 value是用户提交的内容 --&gt;
               &lt;el-select v-model=&quot;scope.row.name&quot;  placeholder=&quot;请选择口味名称&quot;
               @change=&quot;changeFlavorName(scope.row)&quot;&gt;
                &lt;el-option
                  v-for=&quot;dishFlavor in dishFlavorListSelect&quot;
                  :key=&quot;dishFlavor.name&quot;
                  :label=&quot;dishFlavor.name&quot; 
                  :value=&quot;dishFlavor.name&quot;
                &gt;
                &lt;/el-option&gt;
               &lt;/el-select&gt;
            &lt;/template&gt;
          &lt;/el-table-column&gt;
          &lt;el-table-column label=&quot;口味列表&quot; prop=&quot;value&quot; width=&quot;150&quot;&gt;
            &lt;template #default=&quot;scope&quot;&gt;
              &lt;!-- &lt;el-input v-model=&quot;scope.row.value&quot; placeholder=&quot;请输入口味列表&quot; /&gt; --&gt;
          &lt;el-select v-model=&quot;scope.row.value&quot;  placeholder=&quot;请选择口味列表&quot; multiple&gt;
                &lt;el-option
                  v-for=&quot;value in checkValueList&quot;
                  :key=&quot;value&quot;
                  :label=&quot;value&quot; 
                  :value=&quot;value&quot;
                /&gt;
          &lt;/el-select&gt;
          &lt;/template&gt;
          &lt;/el-table-column&gt;
</code></pre>
<pre><code class="js">//------------------------------------------------
// 定义口味名称和口味列表静态数据
const dishFlavorListSelect = ref([
  &#123;name:&quot;辣度&quot;, value:[&quot;不辣&quot;,&quot;微辣&quot;,&quot;中辣&quot;,&quot;重辣&quot;]&#125;,
  &#123;name:&quot;忌口&quot;, value:[&quot;不要葱&quot;,&quot;不要蒜&quot;,&quot;不要香菜&quot;,&quot;不要辣&quot;]&#125;,
  &#123;name:&quot;甜味&quot;, value:[&quot;无糖&quot;,&quot;少糖&quot;,&quot;半糖&quot;]&#125;
]);


// 存储当前选中口味列表数组
const checkValueList = ref([]);
// 定义改变口味名称时更新当前选中的口味列表
function changeFlavorName(row)&#123;
  // 根据选中的name去查找静态数据的value
  checkValueList.value =       dishFlavorListSelect.value.find(item=&gt;item.name==row.name).value;
&#125;
//------------------------------------------------
</code></pre>
<pre><code class="java">// 此时报错了 
11:59:00.441 [http-nio-8080-exec-64] ERROR c.s.f.w.e.GlobalExceptionHandler - [handleRuntimeException,100] - 请求地址&#39;/merchant/dish&#39;,发生未知异常.
org.springframework.http.converter.HttpMessageNotReadableException: JSON parse error: Cannot deserialize value of type `java.lang.String` from Array value (token `JsonToken.START_ARRAY`); nested exception is com.fasterxml.jackson.databind.exc.MismatchedInputException: Cannot deserialize value of type `java.lang.String` from Array value (token `JsonToken.START_ARRAY`)
 at [Source: (org.springframework.util.StreamUtils$NonClosingInputStream); line: 1, column: 239] (through reference chain: com.sky.system.domain.Dish[&quot;dishFlavorList&quot;]-&gt;java.util.ArrayList[0]-&gt;com.sky.system.domain.DishFlavor[&quot;value&quot;])
    
/*
根据错误日志，问题出在请求地址 /merchant/dish 处理过程中，JSON 解析时出现了类型不匹配的问题。具体来说，Dish 对象中的 dishFlavorList 字段下的 DishFlavor 对象的 value 字段期望接收一个 String 类型的值，但实际接收到的是一个数组。
*/
</code></pre>
<h6 id="解决序列化问题bug将口味列表中value通过JSON工具类转换为字符串"><a href="#解决序列化问题bug将口味列表中value通过JSON工具类转换为字符串" class="headerlink" title="解决序列化问题bug将口味列表中value通过JSON工具类转换为字符串"></a>解决序列化问题bug<del>将口味列表中value通过JSON工具类转换为字符串</del></h6><p>提交数据后是字符串 而不是数组</p>
<pre><code class="js">在331行
/** 提交按钮 */
function submitForm() &#123;
  proxy.$refs[&quot;dishRef&quot;].validate(valid =&gt; &#123;
    if (valid) &#123;
      form.value.dishFlavorList = dishFlavorList.value;
      // 将口味列表中value通过JSON工具类转换为字符串
      form.value.dishFlavorList.forEach(item=&gt;item.value = JSON.stringify(item.value))
      if (form.value.id != null) &#123;
        updateDish(form.value).then(response =&gt; &#123;
          proxy.$modal.msgSuccess(&quot;修改成功&quot;);
          open.value = false;
          getList();
        &#125;);
      &#125; else &#123;
        addDish(form.value).then(response =&gt; &#123;
          proxy.$modal.msgSuccess(&quot;新增成功&quot;);
          open.value = false;
          getList();
        &#125;);
      &#125;
    &#125;
  &#125;);
</code></pre>
<h6 id="解决后端添加成功后-修改后口味列表无法回显再增加个非空判断"><a href="#解决后端添加成功后-修改后口味列表无法回显再增加个非空判断" class="headerlink" title="解决后端添加成功后 修改后口味列表无法回显再增加个非空判断"></a>解决后端添加成功后 修改后口味列表无法回显<del>再增加个非空判断</del></h6><p>因为前端提交了字符串給后端，后端再回去修改的时候无法解析字符串 <code>拿到字符串后返回JSON数组即可</code></p>
<pre><code class="js">/** 修改按钮操作 */
function handleUpdate(row) &#123;
  reset();
  const _id = row.id || ids.value
  getDish(_id).then(response =&gt; &#123;
    form.value = response.data;
    dishFlavorList.value = response.data.dishFlavorList;
    // 将口味列表的value字符串转成json数组
    if(dishFlavorList.value!=null)&#123;
      form.value.dishFlavorList.forEach(item=&gt;item.value = JSON.parse(item.value))
    &#125;
    open.value = true;
    title.value = &quot;修改菜品管理&quot;;
  &#125;);
&#125;

/** 提交按钮 */
function submitForm() &#123;
  proxy.$refs[&quot;dishRef&quot;].validate(valid =&gt; &#123;
    if (valid) &#123;
      form.value.dishFlavorList = dishFlavorList.value;
      // 将口味列表中value通过JSON工具类转换为字符串
      if(form.value.dishFlavorList!=null)&#123;
        form.value.dishFlavorList.forEach(item=&gt;item.value = JSON.stringify(item.value))
      &#125;
      if (form.value.id != null) &#123;
        updateDish(form.value).then(response =&gt; &#123;
          proxy.$modal.msgSuccess(&quot;修改成功&quot;);
          open.value = false;
          getList();
        &#125;);
      &#125; else &#123;
        addDish(form.value).then(response =&gt; &#123;
          proxy.$modal.msgSuccess(&quot;新增成功&quot;);
          open.value = false;
          getList();
        &#125;);
      &#125;
    &#125;
  &#125;);
&#125;
</code></pre>
<h6 id="解决修改时无法修改口味列表的下拉框"><a href="#解决修改时无法修改口味列表的下拉框" class="headerlink" title="解决修改时无法修改口味列表的下拉框"></a>解决修改时无法修改口味列表的下拉框</h6><blockquote>
<p>給口味下拉框绑定一个获取焦点事件 再该事件内调用方法根据当前行的口味名称去查询静态数据 再赋值給静态数组</p>
</blockquote>
<pre><code class="js">// 删除清除策略
// 定义口味列表获取焦点时更新当前选中的口味列表
function FocusFlavorName(row)&#123;
  // 根据选中的name去查找静态数据的value
  checkValueList.value = dishFlavorListSelect.value.find(item=&gt;item.name==row.name).value;
&#125;
</code></pre>
<pre><code class="js">// 加个 @focus
&lt;el-table-column label=&quot;口味列表&quot; prop=&quot;value&quot; width=&quot;150&quot;&gt;
            &lt;template #default=&quot;scope&quot;&gt;
              &lt;!-- &lt;el-input v-model=&quot;scope.row.value&quot; placeholder=&quot;请输入口味列表&quot; /&gt; --&gt;
              &lt;el-select v-model=&quot;scope.row.value&quot;  placeholder=&quot;请选择口味列表&quot; multiple
              @focus = &quot;FocusFlavorName(scope.row)&quot;&gt;
                &lt;el-option
                  v-for=&quot;value in checkValueList&quot;
                  :key=&quot;value&quot;
                  :label=&quot;value&quot; 
                  :value=&quot;value&quot;
                /&gt;
               &lt;/el-select&gt;
            &lt;/template&gt;
          &lt;/el-table-column&gt;
</code></pre>
<h3 id="二次开发——页面调整"><a href="#二次开发——页面调整" class="headerlink" title="二次开发——页面调整"></a>二次开发——页面调整</h3><h6 id="将原有的页面，调整为外卖管理系统的项目标识"><a href="#将原有的页面，调整为外卖管理系统的项目标识" class="headerlink" title="将原有的页面，调整为外卖管理系统的项目标识"></a>将原有的页面，调整为外卖管理系统的项目标识</h6><ul>
<li>浏览器标签页icon、标题</li>
<li>系统页面中的logo、标题</li>
<li>去除源码 &amp; 文档 </li>
<li>主题和自定义图标</li>
<li>登录页面中标题、背景图</li>
</ul>
<blockquote>
<p><strong>icon</strong>：public中的favicon.ico 改为 favicon.ico.bak 就作废了<br>把新的图标复制进来改成favicon.ico</p>
<p><strong>标题</strong>：最外层index.html<br>&lt; title&gt; 外卖管理系统 &lt; &#x2F;title&gt;<br>但是改完没有效果 是因为运行环境給覆盖了<br><code>.env.development</code>修改一下</p>
<p><strong>logo</strong>放在了静态资源页面<br>src\assets\logo\logo.png</p>
<p><strong>修改顶部源码和文档图标内容</strong><br>src\layout\components\Navbar.vue</p>
<pre><code class="js">&lt;!-- &lt;el-tooltip content=&quot;源码地址&quot; effect=&quot;dark&quot; placement=&quot;bottom&quot;&gt;
          &lt;ruo-yi-git id=&quot;ruoyi-git&quot; class=&quot;right-menu-item hover-effect&quot; /&gt;
        &lt;/el-tooltip&gt;

        &lt;el-tooltip content=&quot;文档地址&quot; effect=&quot;dark&quot; placement=&quot;bottom&quot;&gt;
          &lt;ruo-yi-doc id=&quot;ruoyi-doc&quot; class=&quot;right-menu-item hover-effect&quot; /&gt;
        &lt;/el-tooltip&gt; --&gt;
</code></pre>
<p><a target="_blank" rel="noopener" href="https://www.iconfont.cn/">iconfont-阿里巴巴矢量图标库</a><br>下载一个<strong>菜品管理的小图标</strong><br>然后给它复制进去src\assets\icons\svg\菜品管理.svg<br>随后回到菜单管理修改图标就好</p>
<p><strong>登录界面图片修改：</strong><br>src\views\login.vue 修改一下标题<br>背景图 → src\assets\images\login-background1.jpg<br>通过css样式修改背景图<br>171行<br> <code>background-image: url(&quot;../assets/images/login-background.jpg&quot;);</code><br>修改为<br><code> background-image: url(&quot;../assets/images/login-background1.jpg&quot;);</code></p>
<pre><code class="css">.login &#123;
  display: flex;
  justify-content: right;
  align-items: center;
  height: 100%;
  background-image: url(&quot;../assets/images/login-background1.jpg&quot;);
  background-size: cover;
&#125;
</code></pre>
</blockquote>
<h6 id="給外卖商家的员工创建角色和用户分配菜单的权限-登录后只能看到自己的功能"><a href="#給外卖商家的员工创建角色和用户分配菜单的权限-登录后只能看到自己的功能" class="headerlink" title="給外卖商家的员工创建角色和用户分配菜单的权限 登录后只能看到自己的功能"></a>給外卖商家的员工创建角色和用户分配菜单的权限 登录后只能看到自己的功能</h6><blockquote>
<p>系统管理 → 角色管理 →  新增 →<br>角色名称：商家员工<br>权限字符串：merchant<br>角色顺序：4<br>菜单权限：父子联动<br>√ 菜品管理</p>
<p>再到用户管理 → 新增 → 添加用户 →<br>用户昵称：波妞<br>用户名称：boniu<br>用户密码：admin123<br>角色：商家员工</p>
</blockquote>
<h1 id="帝可得"><a href="#帝可得" class="headerlink" title="帝可得"></a>帝可得</h1><ul>
<li><p>帝可得是一个基于<strong>物联网</strong>概念下的<strong>智能售货机</strong>运营管理系统</p>
<ul>
<li><p><strong>物联网</strong>(IOT)</p>
<p>让各种物品通过互联网链接起来，实现信息的交换和通信</p>
<ul>
<li>智能家居</li>
<li>共享充电桩</li>
<li>智能售货机</li>
</ul>
</li>
<li><p><strong>智能售货机</strong></p>
<p>是物联网技术的一个典型应用</p>
<ul>
<li>物联网技术</li>
<li>智能分析与推荐</li>
<li>人员设备绑定管理</li>
<li>线上线下融合</li>
</ul>
</li>
</ul>
</li>
<li><h6 id="售货机术语"><a href="#售货机术语" class="headerlink" title="售货机术语"></a>售货机术语</h6><ul>
<li><p><strong>区域管理</strong></p>
<p>为了更高效地进行经营管理，公司将运营范围划分为若干个逻辑区域</p>
</li>
<li><p><strong>点位选择</strong></p>
<p>点位指的是智能售货机的具体放置位置</p>
</li>
<li><p><strong>售货机功能</strong></p>
<p>自动小店，摆满了各种零食</p>
</li>
<li><p><strong>货道设计</strong></p>
<p>售货机里的货道</p>
</li>
</ul>
</li>
</ul>
<h3 id="角色与功能"><a href="#角色与功能" class="headerlink" title="角色与功能"></a>角色与功能</h3><ul>
<li>一个完整的售货机系统由**<u>五端五角色</u>**组成:</li>
<li><strong>管理员</strong>：对基础数据(区域、点位、设备、货道、商品等)进行管理</li>
<li><strong>运维人员</strong>：投放设备、撤除设备、维修设备。</li>
<li><strong>运营人员</strong>：补货。</li>
<li><strong>合作商</strong>：仅提供点位，坐收渔翁之利。</li>
<li><strong>消费者</strong>：在小程序或屏幕端下单购买商品。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://ksg50j5gph.feishu.cn/docx/NxIqdCZVzo2tRfxNL6Nc1BD1nnf">帝可得在线功能文档_Docs</a></p>
<p>帝可得项目点击链接立即查看 <a target="_blank" rel="noopener" href="https://codesign.qq.com/s/426304924036117">https://codesign.qq.com/s/426304924036117</a></p>
<h3 id="库表设计"><a href="#库表设计" class="headerlink" title="库表设计"></a>库表设计</h3><ul>
<li>系统后台基础数据表关系说明：</li>
</ul>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/e677e01fa90ed813fd68cab1fabdde7b958ec9df/%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E8%A1%A8%E5%85%B3%E7%B3%BB%E8%AF%B4%E6%98%8E.png"></p>
<h3 id="AIGC"><a href="#AIGC" class="headerlink" title="AIGC"></a>AIGC</h3><ul>
<li><p><strong>AI</strong> (Artificial Intelligence)：即<strong>人工智能</strong>，是指通过计算机系统模拟人类<strong>思维</strong>和<strong>行为</strong>一种技术</p>
</li>
<li><p>它通过机器学习、深度学习等算法，使计算机具备对数据分析、理解、推理和决策的能力</p>
</li>
<li><p><strong>AIGC</strong> (AI Generated content)：是AI领域的一个应用分支，专注于利用AI技术自动生成内容</p>
</li>
<li><p>国内常见的通用大模型(AGI)产品：</p>
<ul>
<li>文心一言</li>
<li>讯飞星火</li>
<li>通义千问</li>
<li>KIMI</li>
</ul>
</li>
</ul>
<h3 id="Prompt的组成"><a href="#Prompt的组成" class="headerlink" title="Prompt的组成"></a>Prompt的组成</h3><ul>
<li><strong>角色</strong>：给 AI 定义一个最匹配任务的角色，比如：「你是一位软件工程师」「你是一位小学老师」</li>
<li><strong>指示</strong>：对任务进行描述</li>
<li><strong>上下文</strong>：给出与任务相关的其它背景信息（尤其在多轮交互中）</li>
<li><strong>例子</strong>：必要时给出举例，[实践证明其对输出正确性有帮助]</li>
<li><strong>输入</strong>：任务的输入信息；在提示词中明确的标识出输入</li>
<li><strong>输出</strong>：输出的格式描述，以便后继模块自动解析模型的输出结果，比如（JSON、Java）</li>
</ul>
<blockquote>
<p>先定义角色，其实就是在<strong>开头把问题域收窄</strong>，减少二义性。</p>
</blockquote>
<p><strong>案例：</strong></p>
<pre><code class="markdown">角色：你是一位专业的博客作者。

指示：撰写一篇关于最新AI技术发展的文章。

上下文：文章应该涵盖AI技术的当前状态和未来趋势。

例子：可以引用最近的AI技术突破和行业专家的见解。

输入：当前AI技术的相关信息和数据。

输出：一篇结构清晰、观点鲜明的文章草稿。
</code></pre>
<pre><code class="markdown">角色：你是一位资深的Java开发工程师。

指示：编写一个Java函数，该函数接收两个整数参数，并返回它们的和。

上下文：这个函数将被用于一个简单的数学应用程序，该程序帮助学生练习基本的算术运算。

例子：如果你调用函数 `addNumbers(3, 5)`，它应该返回 `8`。

输入：两个整数参数，分别为 `int a` 和 `int b`。

输出：返回这两个整数的和，类型为 `int`。
</code></pre>
<h3 id="常见的编程相关的Prompt"><a href="#常见的编程相关的Prompt" class="headerlink" title="常见的编程相关的Prompt"></a>常见的编程相关的Prompt</h3><h4 id="表结构-1"><a href="#表结构-1" class="headerlink" title="表结构"></a>表结构</h4><pre><code class="markdown">你是一个软件工程师，帮我生成MySQL的表结构
需求如下：
    1，课程管理表，表名tb_course，字段有主键id、课程编码、课程学科、课程名称、课程价格、适用人群、课程介绍
其他要求：
    1，每个表中都有创建时间(create_time)、修改时间(date_time)、创建人(create_by)、修改人(update_by)、备注(remark)这些字段
    2，每个表的主键都是自增的
    3，课程价格是整型、课程编码是字符串
    4，请为每个字段都添加上comment
    5，帮我给生成的表中插入一些IT课程示例数据
        课程学科：Java、人工智能、大数据
        适用人群：小白学员、中级程序员
</code></pre>
<h4 id="生成数据库说明文档"><a href="#生成数据库说明文档" class="headerlink" title="生成数据库说明文档"></a>生成数据库说明文档</h4><pre><code class="markdown">你是一个软件工程师，现在要根据数据库的sql脚本，编写数据库说明文档，sql脚本如下：
CREATE TABLE `tb_course` (
    `id` INT AUTO_INCREMENT COMMENT &#39;主键ID&#39;,
    `course_code` VARCHAR(255) NOT NULL COMMENT &#39;课程编码&#39;,
    `course_subject` VARCHAR(100) NOT NULL COMMENT &#39;课程学科&#39;,
    `course_name` VARCHAR(255) NOT NULL COMMENT &#39;课程名称&#39;,
    `course_price` INT COMMENT &#39;课程价格&#39;,
    `target_audience` VARCHAR(100) COMMENT &#39;适用人群&#39;,
    `course_introduction` TEXT COMMENT &#39;课程介绍&#39;,
    `create_time` DATETIME COMMENT &#39;创建时间&#39;,
    `update_time` DATETIME COMMENT &#39;修改时间&#39;,
    `create_by` VARCHAR(64) COMMENT &#39;创建人&#39;,
    `update_by` VARCHAR(64) COMMENT &#39;修改人&#39;,
    `remark` VARCHAR(255) COMMENT &#39;备注&#39;,
    PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#39;课程管理表&#39;;

输出要求是：
    1，每个表以及每个表的字段都要详细说明，包括，字段名称、类型、作用
    2，使用markdown的输出格式，字段的描述需要使用表格展示
    3，如果表之间有关系，需要描述清楚表之间的关系
</code></pre>
<h4 id="生成代码"><a href="#生成代码" class="headerlink" title="生成代码"></a>生成代码</h4><p>代码生成算是比较常规的方案，用的也比较多，分为了几种情况</p>
<ul>
<li>给出表生成代码（项目中常见）<ul>
<li>给出表结构的ddl，可以输出这个表的增删改查的所有代码</li>
<li>给出表结构的dll，可以输出增删改查的接口文档</li>
</ul>
</li>
<li>补全代码<ul>
<li>例1-给出实体类，帮助编写getter、setter、toString、构造方法等等</li>
<li>例2-给出一个controller，帮助编写swagger注解等</li>
</ul>
</li>
<li>提取结构（无含金量，费时间的编程）<ul>
<li>例1-根据接口文档提取dto类或者vo类</li>
</ul>
</li>
</ul>
<h4 id="生成代码流程图"><a href="#生成代码流程图" class="headerlink" title="生成代码流程图"></a>生成代码流程图</h4><p>有一些比较复杂的业务流程，往往需要画出流程图，现在就可以使用ai协助我们画流程图</p>
<pre><code class="java">你是一个软件工程师，为了方便理解代码执行流程，需要给出代码执行的流程图，代码如下：
    // 创建工单
    @Transactional
    @Override
    public int insertTaskDto(TaskDto taskDto) &#123;
    //1. 查询售货机是否存在
    VendingMachine vm = vendingMachineService.selectVendingMachineByInnerCode(taskDto.getInnerCode());
    if (vm == null) &#123;
        throw new ServiceException(&quot;设备不存在&quot;);
    &#125;
    //2. 校验售货机状态与工单类型是否相符
    checkCreateTask(vm.getVmStatus(), taskDto.getProductTypeId());
    //3. 校验这台设备是否有未完成的同类型工单，如果存在则不能创建
    hasTask(taskDto.getInnerCode(), taskDto.getProductTypeId());
    //4. 校验员工是否存在
    Emp emp = empService.selectEmpById(taskDto.getUserId());
    if (emp == null) &#123;
        throw new ServiceException(&quot;员工不存在&quot;);
    &#125;
    // 5. 校验非同区域下的工作人员不能接受工单
    if (emp.getRegionId() != vm.getRegionId()) &#123;
        throw new ServiceException(&quot;非同区域下的工作人员不能接受工单&quot;);
    &#125;
    //6. 保存工单信息
    Task task = new Task();
    BeanUtil.copyProperties(taskDto, task);// 属性赋值
    task.setCreateTime(DateUtils.getNowDate());// 创建时间
    task.setTaskCode(generateTaskCode());// 工单编号 202405150001
    task.setTaskStatus(DkdContants.TASK_STATUS_CREATE);// 创建工单
    task.setAddr(vm.getAddr());
    task.setRegionId(vm.getRegionId());
    task.setUserName(emp.getUserName());
    int taskResult = taskMapper.insertTask(task);
    //7. 如果是补货工单，向工单明细表插入记录
    if (task.getProductTypeId() == DkdContants.TASK_TYPE_SUPPLY) &#123;
        if (CollUtil.isEmpty(taskDto.getDetails())) &#123;
            throw new ServiceException(&quot;补货工单明细不能为空&quot;);
        &#125;
        List&lt;TaskDetails&gt; taskDetailsList = taskDto.getDetails().stream().map(details -&gt; &#123;
            TaskDetails taskDetails = BeanUtil.copyProperties(details, TaskDetails.class);
            taskDetails.setTaskId(task.getTaskId());
            return taskDetails;
        &#125;).collect(Collectors.toList());
        taskDetailsService.insertBatch(taskDetailsList);
    &#125;

    return taskResult;
&#125;

输出：请使用mermaid语言来描述这个方法的流程
</code></pre>
<pre><code class="mermaid">graph TD;
    A[查询售货机] --&gt; B(售货机不存在?)
    B -- 是 --&gt; C[抛出异常: 设备不存在]
    B -- 否 --&gt; D[校验售货机状态与工单类型]
    D --&gt; E(校验失败?)
    E -- 是 --&gt; F[抛出异常]
    E -- 否 --&gt; G[检查未完成同类型工单]
    G --&gt; H(存在未完成同类型工单?)
    H -- 是 --&gt; I[抛出异常]
    H -- 否 --&gt; J[查询员工]
    J --&gt; K(员工不存在?)
    K -- 是 --&gt; L[抛出异常: 员工不存在]
    K -- 否 --&gt; M[校验员工区域与售货机区域是否一致]
    M --&gt; N(不一致?)
    N -- 是 --&gt; O[抛出异常: 非同区域工作人员不能接受工单]
    N -- 否 --&gt; P[保存工单信息]
    P --&gt; Q(保存成功?)
    Q -- 否 --&gt; R[处理保存失败]
    Q -- 是 --&gt; S(工单类型为补货?)
    S -- 是 --&gt; T[处理补货工单明细]
    T --&gt; U[补货明细处理结果?]
    U -- 失败 --&gt; V[抛出异常: 补货工单明细不能为空]
    U -- 成功 --&gt; END(结束)
    S -- 否 --&gt; END
</code></pre>
<h3 id="项目搭建-后端"><a href="#项目搭建-后端" class="headerlink" title="项目搭建(后端)"></a>项目搭建(后端)</h3><blockquote>
<p>复制gitee克隆的地址<code>https://gitee.com/Pluminary/dkd-parent.git</code>，在新的idea中找到<code>Get from Version Control</code>在URL中导入<code>xxx.git</code><br>若左列模块没有高亮 右侧找maven→clean→package<br>MySQL的配置和导入 → sql里的sql文件导入到Database<br>C:\Users\Pluminary\Desktop\dkd-parent\dkd-admin\src\main\resources\application-druid.yml<br>连接好数据库配置信息<br>Redis的配置(搞个密码)<br>为了方便学习我没有搞redis的password 项目里的是：root【application.yml的redis里面】<br>打开redis服务后就可以启动啦<code>dkd-parent\dkd-admin\src\main\java\com\dkd\DkdApplication.java</code></p>
</blockquote>
<h3 id="项目搭建-前端"><a href="#项目搭建-前端" class="headerlink" title="项目搭建(前端)"></a>项目搭建(前端)</h3><blockquote>
<p>通过vscode克隆源码，仓库地址：<a target="_blank" rel="noopener" href="https://gitee.com/ys-gitee/dkd-vue.git/">https://gitee.com/ys-gitee/dkd-vue.git\</a></p>
<ul>
<li>打开VS Code，并确保已经安装了Git。如果未安装Git，请先下载并安装。</li>
<li>在VS Code<strong>左侧的活动栏</strong>中点击”Source Control”图标，或者按下Ctrl+Shift+G，打开Git集成面板。</li>
<li>在Git集成面板上方的输入框中，选择并输入要克隆的Git仓库地址。可以是HTTP或SSH地址。</li>
<li>点击Enter键，VS Code将连接到Git仓库并拉取最新的代码</li>
</ul>
<p>在vscode中右上角第二个小框框 点击打开命令行 导入jar包 <code>npm install</code><br>然后<code>npm run dev</code>打开项目<br><a target="_blank" rel="noopener" href="http://10.254.1.228/index">帝可得管理系统 http://10.254.1.228/index</a></p>
<pre><code class="java">在VSCode项目中运行npm install命令主要是用于安装项目所需的Node.js包依赖。以下是具体的作用和步骤：

安装依赖包：当你创建一个Node.js项目或者从版本控制系统中克隆一个项目到本地时，项目中通常会包含一个package.json文件。这个文件里列出了项目所有依赖的包及其版本号。运行npm install命令会读取这个文件，然后从npm（Node Package Manager）仓库下载并安装所有列出的依赖包到项目的node_modules目录。

确保环境一致性：通过npm install，可以确保在不同的开发环境和生产环境中，项目使用的是相同版本的依赖包，这有助于避免因为环境差异导致的bug。

项目初始化：如果你是第一次在一个项目中运行npm install，它还会运行每个依赖包的install脚本，这些脚本可能会进行一些设置工作，比如编译代码、生成必要的文件等。

脚本命令：在package.json中，除了依赖项，还可以定义一些脚本命令（scripts）。npm install会使得这些命令变为可用状态，你可以在项目目录下通过npm run &lt;script-name&gt;来执行这些脚本。
</code></pre>
<p>[npm 加速，命令行修改国内镜像源【附带国内最新几个镜像】超简约版<del>_npm 修改国内镜像-CSDN博客](<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_52172586/article/details/142930356#">https://blog.csdn.net/m0_52172586/article/details/142930356#</a>:</del>:text&#x3D;1.查看目前的镜像源 &gt;npm get registry 2.设置镜像源 &gt;npm,config set registry https%3A %2F%2Fregistry.npmmirror.com 3.验证)</p>
<pre><code class="java">1.查看目前的镜像源
&gt; npm get registry
2.设置镜像源
&gt; npm config set registry https://registry.npmmirror.com
3.验证
&gt; npm get registry
    
/////////////////////////////////////////
后端maven镜像就先设置好maven地址(非C盘)
然后再去配置maven里的文件设置镜像
</code></pre>
</blockquote>
<h1 id="点位管理"><a href="#点位管理" class="headerlink" title="点位管理"></a>点位管理</h1><h2 id="需求说明"><a href="#需求说明" class="headerlink" title="需求说明"></a>需求说明</h2><p><strong>业务场景</strong>： 假设我们的公司现在有一个宏伟的计划——在北京发展业务。首先，我们需要确定几个有潜力的区域，这些区域可能是人流量大、消费能力高的商业区或居民区。然后，我们要与这些区域内的潜在合作商进行洽谈，比如商场、写字楼、学校等地方的管理者或所有者。</p>
<p>一旦我们与合作商达成协议，确定了合作的细节和点位，我们就可以安排工作人员去投放智能售货机了。这些点位将成为我们智能售货机的“家”，为消费者提供便捷的购买服务。</p>
<p>点位管理主要涉及到三个功能模块，业务流程如下：</p>
<ol>
<li><strong>登录系统</strong>：后台管理人员登录后台系统</li>
<li><strong>新增区域</strong>: 后台管理人员可以添加区域范围，区域范围与运维&#x2F;运维人员挂钩，区域下可关联点位。</li>
<li><strong>新增合作商</strong>: 管理人员可以添加合作商，合作商与点位进行关联。</li>
<li><strong>新增区域点位</strong>: 后台管理人员可以在特定区域内新增点位，这些点位是放置智能售货机的具体位置。</li>
</ol>
<pre><code class="mermaid">graph TD
    A[登录系统] 
    A --&gt; B[新增区域]
    B --&gt; C[新增合作商]
    C --&gt; D[新增区域点位]
</code></pre>
<h2 id="库表设计-1"><a href="#库表设计-1" class="headerlink" title="库表设计"></a>库表设计</h2><ul>
<li>参考页面原型和具体需求完成库表设计</li>
</ul>
<blockquote>
<p><strong>区域表</strong>: 主键id、区域名称、备注说明<br><strong>合作商表</strong>: 主键id、合作商名称、联系人、联系电话、分成比例、账号、密码<br><strong>点位表</strong>: 主键id、点位名称、详细地址、商圈类型、区域外键、合作商外键</p>
</blockquote>
<pre><code class="java">// 你是一位软件工程师，帮我生成MySQL的表结构
需求如下：
1，区域表，表名tb_region，字段有主键id、区域名称
2，合作商表，表名tb_partner，字段有主键id、合作商名称、联系人、联系电话、分成比例（int类型）、账号、密码
3，点位表，表名tb_node，字段有主键id、点位名称、详细地址、商圈类型（int类型）
    
其他要求：
1，每张表中都有创建时间(create_time)、修改时间(date_time)、创建人(create_by)、修改人(update_by)、备注(remark)这些字段
2，每张表的主键都是自增的
3，区域与点位是一对多的关系，合作商与点位是一对多的关系，请用字段表示出来，并建立外键约束
4，请为所有字段都添加上comment
5，帮我给生成的表中插入一些北京城市相关区域、点位、合作商的测试数据
</code></pre>
<pre><code class="sql">CREATE TABLE `tb_region` (
  `id` INT AUTO_INCREMENT COMMENT &#39;主键id&#39; PRIMARY KEY,
  `region_name` VARCHAR(255) NOT NULL COMMENT &#39;区域名称&#39;,
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#39;修改时间&#39;,
  `create_by` VARCHAR(64) COMMENT &#39;创建人&#39;,
  `update_by` VARCHAR(64) COMMENT &#39;修改人&#39;,
  `remark` TEXT COMMENT &#39;备注&#39;
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#39;区域表&#39;;

-- 插入测试数据
INSERT INTO `tb_region` (`region_name`,`remark`) VALUES (&#39;北京市朝阳区&#39;,&#39;北京市朝阳区&#39;), (&#39;北京市海淀区&#39;,&#39;北京市海淀区&#39;), (&#39;北京市东城区&#39;,&#39;北京市东城区&#39;);

CREATE TABLE `tb_partner` (
  `id` INT AUTO_INCREMENT COMMENT &#39;主键id&#39; PRIMARY KEY,
  `partner_name` VARCHAR(255) NOT NULL COMMENT &#39;合作商名称&#39;,
  `contact_person` VARCHAR(64) COMMENT &#39;联系人&#39;,
  `contact_phone` VARCHAR(15) COMMENT &#39;联系电话&#39;,
  `profit_ratio` INT COMMENT &#39;分成比例&#39;,
  `account` VARCHAR(64) COMMENT &#39;账号&#39;,
  `password` VARCHAR(64) COMMENT &#39;密码&#39;,
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#39;修改时间&#39;,
  `create_by` VARCHAR(64) COMMENT &#39;创建人&#39;,
  `update_by` VARCHAR(64) COMMENT &#39;修改人&#39;,
  `remark` TEXT COMMENT &#39;备注&#39;
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#39;合作商表&#39;;

-- 插入测试数据
INSERT INTO `tb_partner` (`partner_name`, `contact_person`, `contact_phone`, `profit_ratio`, `account`, `password`) VALUES
(&#39;合作商A&#39;, &#39;张三&#39;, &#39;13800138000&#39;, 30, &#39;a001&#39;, &#39;pwdA&#39;),
(&#39;合作商B&#39;, &#39;李四&#39;, &#39;13912345678&#39;, 25, &#39;b002&#39;, &#39;pwdB&#39;);

CREATE TABLE `tb_node` (
  `id` INT AUTO_INCREMENT COMMENT &#39;主键id&#39; PRIMARY KEY,
  `node_name` VARCHAR(255) NOT NULL COMMENT &#39;点位名称&#39;,
  `address` VARCHAR(255) NOT NULL COMMENT &#39;详细地址&#39;,
  `business_type` INT COMMENT &#39;商圈类型&#39;,
  `region_id` INT COMMENT &#39;区域ID&#39;,
  `partner_id` INT COMMENT &#39;合作商ID&#39;,
  `create_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#39;修改时间&#39;,
  `create_by` VARCHAR(64) COMMENT &#39;创建人&#39;,
  `update_by` VARCHAR(64) COMMENT &#39;修改人&#39;,
  `remark` TEXT COMMENT &#39;备注&#39;,
  FOREIGN KEY (`region_id`) REFERENCES `tb_region`(`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`partner_id`) REFERENCES `tb_partner`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#39;点位表&#39;;


-- 插入测试数据
-- 假设区域ID为1对应&#39;北京市朝阳区&#39;，合作商ID为1对应&#39;合作商A&#39;
INSERT INTO `tb_node` (`node_name`, `address`, `business_type`, `region_id`, `partner_id`) VALUES
(&#39;三里屯点位&#39;, &#39;北京市朝阳区三里屯路&#39;, 1, 1, 1),
(&#39;五道口点位&#39;, &#39;北京市海淀区五道口&#39;, 2, 2, 2);
</code></pre>
<p>对于点位管理数据模型，下面是示意图：</p>
<ul>
<li><p>关系字段：region_id、partner_id</p>
</li>
<li><p>数据字典：business_type</p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/2aea3c59b88952c77f32514636619e7de0202c16/dkd%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1.jpg"></p>
<h3 id="生成基础代码"><a href="#生成基础代码" class="headerlink" title="生成基础代码"></a>生成基础代码</h3><h6 id="使用若依代码生成器，生成区域管理、合作商管理、点位管理前后端基础代码，导入项目中："><a href="#使用若依代码生成器，生成区域管理、合作商管理、点位管理前后端基础代码，导入项目中：" class="headerlink" title="使用若依代码生成器，生成区域管理、合作商管理、点位管理前后端基础代码，导入项目中："></a>使用若依代码生成器，生成区域管理、合作商管理、点位管理前后端基础代码，导入项目中：</h6><ul>
<li>创建目录菜单</li>
<li>添加数据字典</li>
<li>配置代码生成信息</li>
<li>下载代码并导入项目</li>
</ul>
<blockquote>
<p>系统管理 → 菜单管理 → 新增菜单<br>→ <u>主类目、点位管理、2、node</u></p>
<p>→ 系统管理 → 字典管理<br>→ <u>字典名称：商圈类型</u><br>     <u>字典类型：business_type</u><br>→ 在第二页找到商圈类型点进去<br>→ <u>新增：旅游区</u><br>     &lt;u<u>&gt;数据标签：旅游区</u><br>     <u>数据键值：1</u><br>     <u>显示排序：1</u><br>→ 新增：商场写字楼、2、2；学校33、交通枢纽44</p>
<p>→ 系统工具 → 代码生成 → 导入表(<u>tb_node、tb_partner、tb_region</u>)<br>分别配置表的生成信息<br>→ 点击<u><strong>区域表</strong></u> → <u>字段信息</u><br>→ 根据新增区域弹出菜单显示 需要增加<u>区域名称全打勾 备注说明除了查询全打勾 其余全×</u></p>
<p>→ 点击**<u>合作商表</u>** → 生成信息<br>→ <u>包路径：com.dkd.manage、生成模块名：manage、生成业务名：region、生成功能名：区域管理、上级菜单：点位管理</u><br>→ 代码生成：Partner<br>→  基本信息：<br><u>实体类名称：Partner</u><br><u>作者：itheima</u><br>→ 字段信息：见**<u>帝可得后台管理系统.md</u>**<br>→ 生成信息：<br><u>生成包路径：com.dkd.manage</u><br><u>生成模块名：manage</u><br><u>生成功能名：合作商管理</u><br><u>上级菜单：点位管理</u></p>
<p>→ 点击**<u>点位表</u>**<br>→ 生成信息：<br><u>生成包路径：com.dkd.manage</u><br><u>生成模块名：manage</u><br><u>生成功能名：点位管理</u><br><u>上级菜单：点位管理</u><br>→ 字段信息：见**<u>帝可得后台管理系统.md</u>**<br>→ 基本信息：<br><u>实体类名称：Node</u><br><u>表描述：点位表</u><br><u>作者：itheima</u></p>
<p>回到代码生成 选中三张表 生成！！<br>分别在前后端和数据库 导入java&#x2F;manage、vue&#x2F;manage、sql代码</p>
</blockquote>
<blockquote>
<p><strong>细节</strong>：如果当你创建一个模块以后 src.main.java里面没有任何代码 resources里面也没有 它提交仓库的时候是默认空的 所以可以手动添加一个占位符<code>.gitkeep</code>虽然什么都不是，但是可以提交空项目模块</p>
</blockquote>
<h3 id="区域管理改造"><a href="#区域管理改造" class="headerlink" title="区域管理改造"></a>区域管理改造</h3><h4 id="基础页面"><a href="#基础页面" class="headerlink" title="基础页面"></a>基础页面</h4><h4 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h4><ul>
<li>参考页面原型，完成基础布局展示改造</li>
</ul>
<pre><code class="html">// 让前端页面自动排序
src\views\manage\region\index.vue
&lt;el-table-column label=&quot;序号&quot; type=&quot;index&quot; width=&quot;50&quot; align=&quot;center&quot; prop=&quot;id&quot; /&gt;
</code></pre>
<h5 id="区域管理改造-1"><a href="#区域管理改造-1" class="headerlink" title="区域管理改造"></a>区域管理改造</h5><ul>
<li><p>查看详情，需要显示所有区域下所有点位列表(<strong>稍后完成</strong>)</p>
</li>
<li><p><strong>在查询区域列表时，同时显示每个区域的点位数，还要新增查看详情</strong></p>
<p><span style="color:red; font-family: 'KaiTi';"><strong>修改<u>后端</u>要参考<u>接口文档</u>，修改<u>前端</u>要参考<u>产品原型</u></strong></span></p>
</li>
<li><p>实现此功能方案：</p>
<p>(1) <strong>同步存储</strong>在区域表中有点位数的字段，当点位发生变化时候，同步区域表中的点位数(<u>在tb_region里面新增一个<code>node_count</code></u> 方案可行考虑缺点：每次点位数据变化时都要更新区域表[增加了工作量]，添加数据不一致也会)<br>(2) <span style="color:red"><strong>关联查询</strong></span>编写关联查询语句，在mapper层封装</p>
</li>
</ul>
<p>SQL查询：先聚合统计每个区域的点位数，然后与区域表进行关联查询<br>[提前在idea中下面的通义灵码状态勾选 <code>本地补全模型</code>、<code>云端模型自动触发</code>]<br><span style="color:red; font-family: 'KaiTi';"><strong>数据库返回的数据 要结合前端所需要的返回数据来写</strong> </span><br><span style="color:blue; font-family: 'KaiTi';"><strong>比如接口文档需要返回remark id name nodeCount</strong> &#x3D;&#x3D;&gt; select r.id,r.region_name,r.remark,ifnull(n.node_count,0) as node_count</span></p>
<pre><code class="sql">-- 传统模式
-- 1.先聚合统计每个区域下的点位数
-- 确定查询表 tb_node
-- 确定分组字段 region_id
select region_id,count(*) as node_count from tb_node group by region_id;
-- 2.然后与区域表进行关联查询   内连接是两个表的交集
select r.id,r.region_name,r.remark,ifnull(n.node_count,0) as node_count 
   from tb_region r
left join (select region_id,count(*) as node_count 
   from tb_node group by region_id) n 
on r.id=n.region_id;

-- AI辅助编程模式
-- 查询区域表所有的信息,需要显示每个区域的点位数
SELECT r.*, COUNT(n.id) AS node_count FROM tb_region r LEFT JOIN tb_node n ON r.id = n.region_id GROUP BY r.id;
</code></pre>
<pre><code class="java">com/dkd/manage/domain/Region.java
package com.dkd.manage.domain;

import org.apache.commons.lang3.builder.ToStringBuilder;
import org.apache.commons.lang3.builder.ToStringStyle;
import com.dkd.common.annotation.Excel;
import com.dkd.common.core.domain.BaseEntity;

/**
 * 区域管理对象 tb_region
 * 
 * @author itheima
 * @date 2024-11-12
 */
public class Region extends BaseEntity
&#123;
    private static final long serialVersionUID = 1L;

    /** 主键id */
    private Long id;

    /** 区域名称 */
    @Excel(name = &quot;区域名称&quot;)
    private String regionName;

    public void setId(Long id) 
    &#123;
        this.id = id;
    &#125;

    public Long getId() 
    &#123;
        return id;
    &#125;
    public void setRegionName(String regionName) 
    &#123;
        this.regionName = regionName;
    &#125;

    public String getRegionName() 
    &#123;
        return regionName;
    &#125;

    @Override
    public String toString() &#123;
        return new ToStringBuilder(this,ToStringStyle.MULTI_LINE_STYLE)
            .append(&quot;id&quot;, getId())
            .append(&quot;regionName&quot;, getRegionName())
            .append(&quot;createTime&quot;, getCreateTime())
            .append(&quot;updateTime&quot;, getUpdateTime())
            .append(&quot;createBy&quot;, getCreateBy())
            .append(&quot;updateBy&quot;, getUpdateBy())
            .append(&quot;remark&quot;, getRemark())
            .toString();
    &#125;
&#125;
</code></pre>
<pre><code class="java">com/dkd/manage/domain/vo/RegionVo.java
package com.dkd.manage.domain.vo;

import com.dkd.manage.domain.Region;
import lombok.Data;

@Data
public class RegionVo extends Region &#123;
    // 点位数量
    private Integer nodeCount;

&#125;
</code></pre>
<pre><code class="java">com/dkd/manage/mapper/RegionMapper.java
/**
     * 查询区域列表
     * @param regionVo
     * @return
     */
    public List&lt;RegionVo&gt; selectRegionVoList(RegionVo regionVo);
</code></pre>
<pre><code class="xml">mapper/manage/RegionMapper.xml    
&lt;select id=&quot;selectRegionVoList&quot; resultType=&quot;com.dkd.manage.domain.vo.RegionVo&quot;&gt;
        SELECT r.*, COUNT(n.id) AS node_count FROM tb_region r LEFT JOIN tb_node n ON r.id = n.region_id GROUP BY r.id
    &lt;/select&gt;
</code></pre>
<h6 id="思考：上面的xml中提取的字段是-node-count-而前端让返回的是驼峰式命名-nodeCount-若依默认关闭了此功能需要手动开启此功能"><a href="#思考：上面的xml中提取的字段是-node-count-而前端让返回的是驼峰式命名-nodeCount-若依默认关闭了此功能需要手动开启此功能" class="headerlink" title="思考：上面的xml中提取的字段是 node_count 而前端让返回的是驼峰式命名 nodeCount,  若依默认关闭了此功能需要手动开启此功能"></a>思考：上面的xml中提取的字段是 <u>node_count</u> 而前端让返回的是驼峰式命名 <u>nodeCount</u>,  若依默认关闭了此功能需要手动开启此功能</h6><pre><code class="xml">dkd-parent → resources → mybatis → mybatis-config.xml
&lt;!-- 使用驼峰命名法转换字段 --&gt;
&lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;
</code></pre>
<h6 id="Ctrl-F9是热部署-在不新增文件的时候可以直接部署"><a href="#Ctrl-F9是热部署-在不新增文件的时候可以直接部署" class="headerlink" title="Ctrl+F9是热部署 在不新增文件的时候可以直接部署"></a>Ctrl+F9是热部署 在不新增文件的时候可以直接部署</h6><h4 id="RegionMapper"><a href="#RegionMapper" class="headerlink" title="RegionMapper"></a>RegionMapper</h4><pre><code class="java">/**
 * 查询区域管理列表
 * @param region
 * @return RegionVo集合
 */
public List&lt;RegionVo&gt; selectRegionVoList(Region region);
</code></pre>
<h4 id="RegionMapper-xml"><a href="#RegionMapper-xml" class="headerlink" title="RegionMapper.xml"></a>RegionMapper.xml</h4><pre><code class="xml">&lt;select id=&quot;selectRegionVoList&quot; resultType=&quot;com.dkd.manage.domain.vo.RegionVo&quot;&gt;
select r.id,r.region_name,r.remark,ifnull(n.node_count,0) as node_count from tb_region r
    left join (select region_id,count(*) as node_count from tb_node group by region_id) n on r.id=n.region_id
    &lt;where&gt;
       &lt;if test=&quot;regionName != null  and regionName != &#39;&#39;&quot;&gt; and r.region_name like concat(&#39;%&#39;, #&#123;regionName&#125;, &#39;%&#39;)&lt;/if&gt;
    &lt;/where&gt;
&lt;/select&gt; 
</code></pre>
<h4 id="IRegionService"><a href="#IRegionService" class="headerlink" title="IRegionService"></a>IRegionService</h4><pre><code class="java">/**
 * 查询区域管理列表
 * @param region
 * @return RegionVo集合
 */
public List&lt;RegionVo&gt; selectRegionVoList(Region region);
</code></pre>
<h4 id="RegionServiceImpl"><a href="#RegionServiceImpl" class="headerlink" title="RegionServiceImpl"></a>RegionServiceImpl</h4><pre><code class="java">/**
 * 查询区域管理列表
 * @param region
 * @return RegionVo集合
 */
@Override
public List&lt;RegionVo&gt; selectRegionVoList(Region region) &#123;
    return regionMapper.selectRegionVoList(region);
&#125;
</code></pre>
<h4 id="RegionController"><a href="#RegionController" class="headerlink" title="RegionController"></a>RegionController</h4><pre><code class="java">/**
 * 查询区域管理列表
 */
@PreAuthorize(&quot;@ss.hasPermi(&#39;manage:region:list&#39;)&quot;)
@GetMapping(&quot;/list&quot;)
public TableDataInfo list(Region region)
&#123;
    startPage();
    List&lt;RegionVo&gt; voList = regionService.selectRegionVoList(region);
    return getDataTable(voList);
&#125;
</code></pre>
<h4 id="region-x2F-index-vue"><a href="#region-x2F-index-vue" class="headerlink" title="region&#x2F;index.vue"></a>region&#x2F;index.vue</h4><pre><code class="vue">&lt;!-- 区域列表 --&gt;
&lt;el-table v-loading=&quot;loading&quot; :data=&quot;regionList&quot; @selection-change=&quot;handleSelectionChange&quot;&gt;
  &lt;el-table-column type=&quot;selection&quot; width=&quot;55&quot; align=&quot;center&quot; /&gt;
  &lt;el-table-column label=&quot;序号&quot; type=&quot;index&quot; width=&quot;50&quot; align=&quot;center&quot; prop=&quot;id&quot; /&gt;
  &lt;el-table-column label=&quot;区域名称&quot; align=&quot;center&quot; prop=&quot;regionName&quot; /&gt;
  &lt;el-table-column label=&quot;点位数&quot; align=&quot;center&quot; prop=&quot;nodeCount&quot; /&gt;
  &lt;el-table-column label=&quot;备注说明&quot; align=&quot;center&quot; prop=&quot;remark&quot; /&gt;
  &lt;el-table-column label=&quot;操作&quot; align=&quot;center&quot; class-name=&quot;small-padding fixed-width&quot;&gt;
    &lt;template #default=&quot;scope&quot;&gt;
      &lt;el-button link type=&quot;primary&quot;  @click=&quot;handleUpdate(scope.row)&quot; v-hasPermi=&quot;[&#39;manage:region:edit&#39;]&quot;&gt;修改&lt;/el-button&gt;
      &lt;el-button link type=&quot;primary&quot;  @click=&quot;handleDelete(scope.row)&quot; v-hasPermi=&quot;[&#39;manage:region:remove&#39;]&quot;&gt;删除&lt;/el-button&gt;
    &lt;/template&gt;
  &lt;/el-table-column&gt;
&lt;/el-table&gt;
</code></pre>
<h5 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h5><ul>
<li><strong>区域列表改造步骤</strong><ul>
<li>确定关联查询方案并编写sql</li>
<li>创建RegionVo</li>
<li>在RegionMapper和xml中添加查询Vo方法和sql</li>
<li>在RegionService接口和实现类中添加查询Vo方法</li>
<li>修改RegionController查询方法</li>
<li>修改前端视图组件</li>
</ul>
</li>
</ul>
<h3 id="合作商改造-查看详情"><a href="#合作商改造-查看详情" class="headerlink" title="合作商改造-查看详情"></a>合作商改造-查看详情</h3><h5 id="密码是明文-改成密文"><a href="#密码是明文-改成密文" class="headerlink" title="密码是明文 改成密文"></a>密码是明文 改成密文</h5><pre><code class="html">&lt;el-form-item label=&quot;密码&quot; prop=&quot;password&quot;&gt;
   &lt;el-input v-model=&quot;form.password&quot; type=&quot;password&quot; placeholder=&quot;请输入密码&quot; /&gt;
&lt;/el-form-item&gt;
</code></pre>
<h5 id="隐藏修改时的账号密码id存在时隐藏不存在显示-因为修改和新增共用了一个对话框ui"><a href="#隐藏修改时的账号密码id存在时隐藏不存在显示-因为修改和新增共用了一个对话框ui" class="headerlink" title="隐藏修改时的账号密码id存在时隐藏不存在显示,因为修改和新增共用了一个对话框ui"></a>隐藏修改时的账号密码<del>id存在时隐藏不存在显示,因为修改和新增共用了一个对话框ui</del></h5><pre><code class="html">&lt;el-form-item label=&quot;账号&quot; prop=&quot;account&quot; v-if=&quot;form.id==null&quot;&gt;
    &lt;el-input v-model=&quot;form.account&quot; placeholder=&quot;请输入账号&quot; /&gt;
&lt;/el-form-item&gt;
&lt;el-form-item label=&quot;密码&quot; prop=&quot;password&quot; v-if=&quot;form.id==null&quot;&gt;
    &lt;el-input v-model=&quot;form.password&quot; type=&quot;password&quot; placeholder=&quot;请输入密码&quot; /&gt;
&lt;/el-form-item&gt;
</code></pre>
<h5 id="前端需要返回创建时间因为数据返回时有，用v-if判断是否修改显示创建时间"><a href="#前端需要返回创建时间因为数据返回时有，用v-if判断是否修改显示创建时间" class="headerlink" title="前端需要返回创建时间因为数据返回时有，用v-if判断是否修改显示创建时间"></a>前端需要返回创建时间<del>因为数据返回时有，用v-if判断是否修改显示创建时间</del></h5><pre><code class="html"> &lt;el-form-item label=&quot;创建时间&quot; prop=&quot;contactPhone&quot; v-if=&quot;form.id!=null&quot;&gt;
          &#123;&#123;form.createTime&#125;&#125;
        &lt;/el-form-item&gt;
</code></pre>
<h5 id="新增时保存的数据是以明文保存到了数据库此时新增的合作商就是密文了"><a href="#新增时保存的数据是以明文保存到了数据库此时新增的合作商就是密文了" class="headerlink" title="新增时保存的数据是以明文保存到了数据库此时新增的合作商就是密文了"></a>新增时保存的数据是以明文保存到了数据库<del>此时新增的合作商就是密文了</del></h5><pre><code class="java">com/dkd/manage/service/impl/PartnerServiceImpl.java  
/**
     * 新增合作商管理
     *
     * @param partner 合作商管理
     * @return 结果
     */
    @Override
    public int insertPartner(Partner partner) &#123;
        // 使用SpringSecurity工具类，对前端传入的密码进行加密
        partner.setPassword(SecurityUtils.encryptPassword(partner.getPassword()));
        partner.setCreateTime(DateUtils.getNowDate());
        return partnerMapper.insertPartner(partner);
    &#125;
</code></pre>
<h5 id="合作商管理改造—合作商详情"><a href="#合作商管理改造—合作商详情" class="headerlink" title="合作商管理改造—合作商详情"></a>合作商管理改造—合作商详情</h5><ul>
<li>查看详情，需要显示合作商名称、联系人、联系电话、分成比例</li>
<li>在查询合作商列表时，同时显示每个合作商的点位数</li>
<li>重置密码，初始密码为123456</li>
</ul>
<pre><code class="js">/** 借鉴修改流程
/** 修改按钮操作 */
function handleUpdate(row) &#123;
  reset();
  const _id = row.id || ids.value
  getPartner(_id).then(response =&gt; &#123;
    form.value = response.data;
    open.value = true;
    title.value = &quot;修改合作商管理&quot;;
  &#125;);
&#125;
</code></pre>
<pre><code class="html">&lt;el-table-column label=&quot;操作&quot; align=&quot;center&quot; class-name=&quot;small-padding fixed-width&quot;&gt;
  &lt;template #default=&quot;scope&quot;&gt;
    &lt;el-button link type=&quot;primary&quot; icon=&quot;Edit&quot; @click=&quot;getPartnerInfo(scope.row)&quot; v-hasPermi=&quot;[&#39;manage:partner:query&#39;]&quot;&gt;查看详情&lt;/el-button&gt;
  &lt;/template&gt;
&lt;/el-table-column&gt;
</code></pre>
<pre><code class="java">com/dkd/manage/controller/PartnerController.java
    /**
     * 获取合作商管理详细信息
     */
    @PreAuthorize(&quot;@ss.hasPermi(&#39;manage:partner:query&#39;)&quot;)
    @GetMapping(value = &quot;/&#123;id&#125;&quot;)
    public AjaxResult getInfo(@PathVariable(&quot;id&quot;) Long id)
    &#123;
        return success(partnerService.selectPartnerById(id));
    &#125;
</code></pre>
<pre><code class="js">/** 查看合作商详情 **/
  const partnerInfoOpen = ref(false)
  function getPartnerInfo(row)&#123;
    reset();
    const _id = row.id
    getPartner(_id).then(response =&gt; &#123;
      form.value = response.data;
      partnerInfoOpen.value = true;
    &#125;);
  &#125;
</code></pre>
<pre><code class="html">    &lt;!-- 查看合作商详情对话框 --&gt;
&lt;el-dialog title=&quot;合作商详情&quot; v-model=&quot;partnerInfoOpen&quot; width=&quot;500px&quot; append-to-body&gt;
    &lt;!-- 使用el-descriptions组件以卡片形式展示信息，更加整洁 --&gt;
    &lt;el-descriptions :column=&quot;2&quot; border&gt;
        &lt;el-descriptions-item label=&quot;合作商名称&quot;&gt;&#123;&#123; form.partnerName &#125;&#125;&lt;/el-descriptions-item&gt;
        &lt;el-descriptions-item label=&quot;联系人&quot;&gt;&#123;&#123; form.contactPerson &#125;&#125;&lt;/el-descriptions-item&gt;
        &lt;el-descriptions-item label=&quot;联系电话&quot;&gt;&#123;&#123; form.contactPhone &#125;&#125;&lt;/el-descriptions-item&gt;
        &lt;el-descriptions-item label=&quot;分成比例&quot;&gt;&#123;&#123; form.profitRatio &#125;&#125;%&lt;/el-descriptions-item&gt;
    &lt;/el-descriptions&gt;
&lt;/el-dialog&gt;
</code></pre>
<h3 id="合作商改造—列表查询点位管理→合作商管理→增加点位数"><a href="#合作商改造—列表查询点位管理→合作商管理→增加点位数" class="headerlink" title="合作商改造—列表查询点位管理→合作商管理→增加点位数"></a>合作商改造—列表查询<del>点位管理→合作商管理→增加点位数</del></h3><ul>
<li>实现此功能方案：</li>
</ul>
<h4 id="后端改造"><a href="#后端改造" class="headerlink" title="后端改造"></a>后端改造</h4><p><strong>关联查询</strong>编写关联查询语句，在mapper层封装</p>
<blockquote>
<p><strong>tb_node</strong>(点位表)的partner_id(合作商ID)<br><u>关联</u><br><strong>tb_partner</strong>(合作商表)的id</p>
<pre><code class="sql">-- 查询合作商表的所有信息，同时显示每个合作商的点位数
select p.*, count(n.id) as node_count
from tb_partner p
    left join tb_node n on p.id = n.partner_id
group by p.id
</code></pre>
</blockquote>
<p><strong>首先先创建一个需要查询新东西的方法<del>增加</del></strong></p>
<pre><code class="java">com/dkd/manage/domain/vo/PartnerVo.java
package com.dkd.manage.domain.vo;

import com.dkd.manage.domain.Partner;
import lombok.Data;

@Data
public class PartnerVo extends Partner &#123;
    // 点位数量
    private Integer nodeCount;
&#125;
</code></pre>
<pre><code class="java">com/dkd/manage/controller/PartnerController.java
 /**
     * 查询合作商管理列表
     */
    @PreAuthorize(&quot;@ss.hasPermi(&#39;manage:partner:list&#39;)&quot;)
    @GetMapping(&quot;/list&quot;)
    public TableDataInfo list(Partner partner) &#123;
        startPage();
        List&lt;PartnerVo&gt; voList = partnerService.selectPartnerVoList(partner);
        return getDataTable(voList);
    &#125;
</code></pre>
<pre><code class="java">com/dkd/manage/service/IPartnerService.java
/**
     * 查询合作商列表
     * @param partner
     * @return
     */
    public List&lt;PartnerVo&gt; selectPartnerVoList(Partner partner);
</code></pre>
<pre><code class="java">com/dkd/manage/service/impl/PartnerServiceImpl.java
/**
     * 查询合作商列表
     * @param partner
     * @return
     */
    @Override
    public List&lt;PartnerVo&gt; selectPartnerVoList(Partner partner) &#123;
        return partnerMapper.selectPartnerVoList(partner);
    &#125;
</code></pre>
<pre><code class="java">com/dkd/manage/mapper/PartnerMapper.java
/**
     * 查询合作商列表
     * @param partner
     * @return
     */
    public List&lt;PartnerVo&gt; selectPartnerVoList(Partner partner);
</code></pre>
<pre><code class="java">mapper/manage/PartnerMapper.xml
&lt;/select&gt;
        &lt;select id=&quot;selectPartnerVoList&quot; resultType=&quot;com.dkd.manage.domain.vo.PartnerVo&quot;&gt;
        select p.*, count(n.id) as node_count
        from tb_partner p
                 left join tb_node n on p.id = n.partner_id
        &lt;where&gt;
            &lt;if test=&quot;partnerName != null  and partnerName != &#39;&#39;&quot;&gt; and partner_name like concat(&#39;%&#39;, #&#123;partnerName&#125;, &#39;%&#39;)&lt;/if&gt;
        &lt;/where&gt;
        group by p.id
    &lt;/select&gt;
</code></pre>
<h4 id="前端改造"><a href="#前端改造" class="headerlink" title="前端改造"></a>前端改造</h4><pre><code class="html">&lt;el-table-column type=&quot;selection&quot; width=&quot;55&quot; align=&quot;center&quot; /&gt;
      &lt;el-table-column label=&quot;序号&quot; type=&quot;index&quot; width=&quot;50&quot; align=&quot;center&quot; prop=&quot;id&quot; /&gt;
      &lt;el-table-column label=&quot;合作商名称&quot; align=&quot;center&quot; prop=&quot;partnerName&quot; /&gt;
      &lt;el-table-column label=&quot;点位数&quot; align=&quot;center&quot; prop=&quot;nodeCount&quot; /&gt;
      &lt;el-table-column label=&quot;账号&quot; align=&quot;center&quot; prop=&quot;account&quot; /&gt;
      &lt;el-table-column label=&quot;分成比例&quot; align=&quot;center&quot; prop=&quot;profitRatio&quot;&gt;
        &lt;template #default=&quot;scope&quot;&gt;
          &#123;&#123; scope.row.profitRatio + '%' &#125;&#125;
        &lt;/template&gt;
      &lt;/el-table-column&gt;
      &lt;el-table-column label=&quot;联系人&quot; align=&quot;center&quot; prop=&quot;contactPerson&quot; /&gt;
      &lt;el-table-column label=&quot;联系电话&quot; align=&quot;center&quot; prop=&quot;contactPhone&quot; /&gt;
      &lt;el-table-column label=&quot;操作&quot; align=&quot;center&quot; class-name=&quot;small-padding fixed-width&quot;&gt;
</code></pre>
<h3 id="合作商改造——重置密码"><a href="#合作商改造——重置密码" class="headerlink" title="合作商改造——重置密码"></a>合作商改造——重置密码</h3><ul>
<li>查看详情，需要显示合作商名称、联系人、联系电话、分成比例</li>
<li>在查询合作商列表时，同时显示每个合作商的点位数</li>
<li>重置密码，初始密码为123456</li>
</ul>
<h4 id="后端部分"><a href="#后端部分" class="headerlink" title="后端部分"></a>后端部分</h4><p>在PartnerController中</p>
<pre><code class="java">/**
 * 重置合作商密码
 */
@PreAuthorize(&quot;@ss.hasPermi(&#39;manage:partner:edit&#39;)&quot;)
@Log(title = &quot;重置合作商密码&quot;, businessType = BusinessType.UPDATE)
@PutMapping(&quot;/resetPwd/&#123;id&#125;&quot;)
public AjaxResult resetpwd(@PathVariable Long id) &#123;//1. 接收参数
    //2. 创建合作商对象
    Partner partner = new Partner();
    partner.setId(id);// 设置id
    partner.setPassword(SecurityUtils.encryptPassword(&quot;123456&quot;));// 设置加密后的初始密码
    //3. 调用service更新密码
    return toAjax(partnerService.updatePartner(partner));
&#125;
</code></pre>
<h4 id="前端部分"><a href="#前端部分" class="headerlink" title="前端部分"></a>前端部分</h4><p>在<code>manage/partner.js</code>请求api中</p>
<pre><code class="js">// 重置合作商密码
export function resetPartnerPwd(id)&#123;
  return request(&#123;
    url: &#39;/manage/partner/resetPwd/&#39; + id,
    method: &#39;put&#39;
  &#125;)
&#125;
</code></pre>
<p>在<code>partner/index.vue</code>视图组件中<del>参考@click&#x3D;”handleDelete”，此方法删除时弹出对话框</del></p>
<pre><code class="vue">&lt;el-table-column label=&quot;操作&quot; align=&quot;center&quot; class-name=&quot;small-padding fixed-width&quot; width=&quot;300px&quot;&gt;
    &lt;template #default=&quot;scope&quot;&gt;
        &lt;el-button link type=&quot;primary&quot; @click=&quot;resetPwd(scope.row)&quot; v-hasPermi=&quot;[&#39;manage:partner:edit&#39;]&quot;&gt;重置密码&lt;/el-button&gt;
    &lt;/template&gt;
&lt;/el-table-column&gt;

&lt;script&gt;
    import &#123; listPartner, getPartner, delPartner, addPartner, updatePartner,resetPartnerPwd &#125; from &quot;@/api/manage/partner&quot;;
    /* 重置合作商密码 */
    function resetPwd(row) &#123;
        proxy.$modal.confirm(&#39;你确定要重置该合作商密码吗？&#39;).then(function () &#123;
            return resetPartnerPwd(row.id);
        &#125;).then(() =&gt; &#123;
            proxy.$modal.msgSuccess(&quot;重置成功&quot;);
        &#125;).catch(() =&gt; &#123; &#125;);
    &#125;
&lt;/script&gt;
</code></pre>
<h3 id="点位管理改造——基础布局"><a href="#点位管理改造——基础布局" class="headerlink" title="点位管理改造——基础布局"></a>点位管理改造——基础布局</h3><p>修改前端更简单一些 可以把前端一次性请求1w条数据 后端接口就可以重复调用</p>
<p>在<code>src\views\manage\node\index.vue</code>视图组件中</p>
<pre><code class="js">import &#123;listRegion&#125; from &quot;@/api/manage/region&quot;;

/* 查询所有条件对象 */
const loadAllParams=reactive(&#123;
  pageNum:1,
  pageSize:10000
&#125;)
/** 查询区域列表 **/
const regionList=ref([]);
function getRegionList() &#123;
  listRegion(loadAllParams).then(response=&gt;&#123;
    regionList.value=response.rows;
  &#125;)
&#125;
getRegionList();
getList();
</code></pre>
<p>在<code>src\api\manage\region.js</code>中</p>
<pre><code class="js">// 查询区域管理列表
export function listRegion(query) &#123;
  return request(&#123;
    url: &#39;/manage/region/list&#39;,
    method: &#39;get&#39;,
    params: query
  &#125;)
&#125;
</code></pre>
<h6 id="新增点位管理的时候想把合作商输入的改成自动获取的下拉框"><a href="#新增点位管理的时候想把合作商输入的改成自动获取的下拉框" class="headerlink" title="新增点位管理的时候想把合作商输入的改成自动获取的下拉框"></a>新增点位管理的时候想把合作商输入的改成自动获取的下拉框</h6><ul>
<li>定义js代码向后台发送请求，将请求后的结果封装给合作商parnterList集合</li>
<li>将文本框改成下拉框来遍历展示每个合作商的名称，提交时关联合作商的id</li>
</ul>
<pre><code class="js">      &lt;el-table-column label=&quot;详细地址&quot; align=&quot;center&quot; prop=&quot;address&quot; show-overflow-tooltip/&gt; 详细地址多出的部分隐藏只有鼠标移动到才会显示


import &#123;listPartner&#125; from &quot;@/api/manage/partner&quot;

&lt;el-form-item label=&quot;合作商ID&quot; prop=&quot;partnerId&quot;&gt;
          &lt;!-- &lt;el-input v-model=&quot;form.partnerId&quot; placeholder=&quot;请输入合作商ID&quot; /&gt; --&gt;
           &lt;el-select v-model=&quot;form.partnerId&quot; placeholder=&quot;请选择合作商&quot;&gt;
            &lt;el-option
              v-for=&quot;item in partnerList&quot;
              :key=&quot;item.id&quot;
              :label=&quot;item.partnerName&quot;
              :value=&quot;item.id&quot;&gt;
            &lt;/el-option&gt;
           &lt;/el-select&gt;
&lt;/el-form-item&gt;

/* 查询合作商列表 */
const partnerList=ref([]);
function getPartnerList()&#123;
  listPartner(loadAllParams).then(response=&gt;&#123;
    partnerList.value = response.rows;
  &#125;)
&#125;
getPartnerList();
</code></pre>
<h6 id="避免每次都要写pageSize：10000-直接搞入js里面"><a href="#避免每次都要写pageSize：10000-直接搞入js里面" class="headerlink" title="避免每次都要写pageSize：10000 直接搞入js里面"></a>避免每次都要写pageSize：10000 直接搞入js里面</h6><pre><code class="java">src\api\page.js
/* 查询所有条件对象 */
// const loadAllParams=reactive(&#123;
//   pageNum:1,
//   pageSize:10000
// &#125;) →

export const loadAllParams = reactive(&#123;
  pageNum: 1,
  pageSize: 10000,
&#125;);
</code></pre>
<h3 id="点位管理改造点位中增加个查看详情-将单表查询改为多表查询咯"><a href="#点位管理改造点位中增加个查看详情-将单表查询改为多表查询咯" class="headerlink" title="点位管理改造点位中增加个查看详情(将单表查询改为多表查询咯)"></a>点位管理改造<del>点位中增加个查看详情(将单表查询改为多表查询咯)</del></h3><ul>
<li>查看详情，需要显示当前点位下所有设备列表(稍后完成)</li>
<li>在区域详情中，需要显示每个点位的设备数</li>
<li>在点位列表查询中，关联显示区域、合作商等信息</li>
<li><strong>关联查询：</strong><u>对于设备数量的统计，我们需要执行关联查询，在mapper层封装</u></li>
<li><strong>关联实体</strong>：<u>对于区域和合作商的数据，我们会采用Mybatis提供的嵌套查询功能</u></li>
</ul>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/601b425cc8b355cd33badf92ed988dbdabef1b9d/%E7%82%B9%E4%BD%8D%E7%AE%A1%E7%90%86%E6%94%B9%E9%80%A0%E8%A1%A8%E8%AE%BE%E8%AE%A1.png" alt="点位管理改造表设计.png"></p>
<pre><code class="mysql">&lt;resultMap&gt;......&lt;/resultMap&gt;   #完成手动映射

#解决一对一 或 多对一 映射结果集只有一个对象时完成的ORM的映射封装
&lt;association&gt;......&lt;/association&gt;  #点位和点位1对1  点位和合作商1对多

#解决一对多场景下来映射多个结果的集合 单个区域表+区域点位列表 映射的是集合！！
&lt;collection&gt;......&lt;/collection&gt; 
</code></pre>
<pre><code class="mysql"># AI辅助编程模式
-- AI辅助编程模式
-- 你是一个软件开发工程师，现在要根据数据库的sql脚本，查询并显示点位表所有的字段信息,同时显示每个点位的设备数量，sql脚本如下：
create table tb_node
(
    id            int auto_increment comment &#39;主键id&#39;
        primary key,
    node_name     varchar(255)                        not null comment &#39;点位名称&#39;,
    address       varchar(255)                        not null comment &#39;详细地址&#39;,
    business_type int                                 null comment &#39;商圈类型&#39;,
    region_id     int                                 null comment &#39;区域ID&#39;,
    partner_id    int                                 null comment &#39;合作商ID&#39;,
    create_time   timestamp default CURRENT_TIMESTAMP null comment &#39;创建时间&#39;,
    update_time   timestamp default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP comment &#39;修改时间&#39;,
    create_by     varchar(64)                         null comment &#39;创建人&#39;,
    update_by     varchar(64)                         null comment &#39;修改人&#39;,
    remark        text                                null comment &#39;备注&#39;,
    constraint tb_node_ibfk_1
        foreign key (region_id) references tb_region (id)
            on update cascade on delete cascade,
    constraint tb_node_ibfk_2
        foreign key (partner_id) references tb_partner (id)
            on update cascade on delete cascade
)
    comment &#39;点位表&#39;;
    
create table tb_vending_machine
(
    id                   bigint auto_increment comment &#39;主键&#39;
        primary key,
    inner_code           varchar(15) default &#39;000&#39;                 null comment &#39;设备编号&#39;,
    channel_max_capacity int                                       null comment &#39;设备容量&#39;,
    node_id              int                                       not null comment &#39;点位Id&#39;,
    addr                 varchar(100)                              null comment &#39;详细地址&#39;,
    last_supply_time     datetime    default &#39;2000-01-01 00:00:00&#39; not null comment &#39;上次补货时间&#39;,
    business_type        int                                       not null comment &#39;商圈类型&#39;,
    region_id            int                                       not null comment &#39;区域Id&#39;,
    partner_id           int                                       not null comment &#39;合作商Id&#39;,
    vm_type_id           int         default 0                     not null comment &#39;设备型号&#39;,
    vm_status            int         default 0                     not null comment &#39;设备状态，0:未投放;1-运营;3-撤机&#39;,
    running_status       varchar(100)                              null comment &#39;运行状态&#39;,
    longitudes           double      default 0                     null comment &#39;经度&#39;,
    latitude             double      default 0                     null comment &#39;维度&#39;,
    client_id            varchar(50)                               null comment &#39;客户端连接Id,做emq认证用&#39;,
    policy_id            bigint                                    null comment &#39;策略id&#39;,
    create_time          timestamp   default CURRENT_TIMESTAMP     not null comment &#39;创建时间&#39;,
    update_time          timestamp   default CURRENT_TIMESTAMP     null comment &#39;修改时间&#39;,
    constraint vendingmachine_VmId_uindex
        unique (inner_code),
    constraint tb_vending_machine_ibfk_1
        foreign key (vm_type_id) references tb_vm_type (id),
    constraint tb_vending_machine_ibfk_2
        foreign key (node_id) references tb_node (id),
    constraint tb_vending_machine_ibfk_3
        foreign key (policy_id) references tb_policy (policy_id)
)
    comment &#39;设备表&#39;;
</code></pre>
<pre><code class="sql">-- 查询并显示点位表所有的字段信息,同时显示每个点位的设备数量
SELECT
    n.id,
    n.node_name,
    n.address,
    n.business_type,
    n.region_id,
    n.partner_id,
    n.create_time,
    n.update_time,
    n.create_by,
    n.update_by,
    n.remark,
    COUNT(v.id) AS vm_count
FROM
    tb_node n
LEFT JOIN
    tb_vending_machine v ON n.id = v.node_id
GROUP BY
    n.id;
</code></pre>
<pre><code class="java">package com.dkd.manage.domain.vo;

import com.dkd.manage.domain.Node;
import com.dkd.manage.domain.Partner;
import com.dkd.manage.domain.Region;
import lombok.Data;

@Data
public class NodeVo extends Node &#123;
    // 设备数量
    private Integer vmCount;
    // 区域信息
    private Region region;
    // 合作商信息
    private Partner partner;
&#125;
</code></pre>
<pre><code class="java">com/dkd/manage/mapper/NodeMapper.java
/**
     *  查询点位管理列表
     * @param node
     * @return
     */
    public List&lt;NodeVo&gt; selectNodeVoList(Node node);
</code></pre>
<pre><code class="xml">&lt;!--
resultType=&quot;com.dkd.manage.domin.vo.NodeVo&quot;&gt;...
这个是mybatis以前搞的自动映射封装直接把结果映射给了NodeVo的实体类了
嵌套查询就不能使用resultType自动映射 要改为resultMap做自动映射
&lt;resultMap type=&quot;NodeVo&quot; id=&quot;NodeVoResult&quot;&gt;
多表查询一定要起别名噢 不然会报错没有指明where的子句是来自tb_node表的region_id  还是来自tb_vending_machine表的region_id
--&gt;

&lt;select id=&quot;selectNodeVoList&quot; parameterType=&quot;Node&quot; resultMap=&quot;NodeVoResult&quot;&gt;
        SELECT
        n.id,
        n.node_name,
        n.address,
        n.business_type,
        n.region_id,
        n.partner_id,
        n.create_time,
        n.update_time,
        n.create_by,
        n.update_by,
        n.remark,
        COUNT(v.id) AS vm_count
        FROM
        tb_node n
        LEFT JOIN
        tb_vending_machine v ON n.id = v.node_id
        &lt;where&gt;
            &lt;if test=&quot;nodeName != null  and nodeName != &#39;&#39;&quot;&gt; and n.node_name like concat(&#39;%&#39;, #&#123;nodeName&#125;, &#39;%&#39;)&lt;/if&gt;
            &lt;if test=&quot;regionId != null &quot;&gt; and n.region_id = #&#123;regionId&#125;&lt;/if&gt;
            &lt;if test=&quot;partnerId != null &quot;&gt; and n.partner_id = #&#123;partnerId&#125;&lt;/if&gt;
        &lt;/where&gt;
        GROUP BY
        n.id
    &lt;/select&gt;
</code></pre>
<pre><code class="xml">多对一标签用association
&lt;resultMap type=&quot;NodeVo&quot; id=&quot;NodeVoResult&quot;&gt;
        &lt;result property=&quot;id&quot;    column=&quot;id&quot;    /&gt;
        &lt;result property=&quot;nodeName&quot;    column=&quot;node_name&quot;    /&gt;
        &lt;result property=&quot;address&quot;    column=&quot;address&quot;    /&gt;
        &lt;result property=&quot;businessType&quot;    column=&quot;business_type&quot;    /&gt;
        &lt;result property=&quot;regionId&quot;    column=&quot;region_id&quot;    /&gt;
        &lt;result property=&quot;partnerId&quot;    column=&quot;partner_id&quot;    /&gt;
        &lt;result property=&quot;createTime&quot;    column=&quot;create_time&quot;    /&gt;
        &lt;result property=&quot;updateTime&quot;    column=&quot;update_time&quot;    /&gt;
        &lt;result property=&quot;createBy&quot;    column=&quot;create_by&quot;    /&gt;
        &lt;result property=&quot;updateBy&quot;    column=&quot;update_by&quot;    /&gt;
        &lt;result property=&quot;remark&quot;    column=&quot;remark&quot;    /&gt;
        &lt;result property=&quot;vmCount&quot;    column=&quot;vm_count&quot;    /&gt;
&lt;!--
sql语法拿到region_id去执行区域当中的selectRegionById 方法执行的时候需要传递区域的id
原理：RegionMapper.java中的 public Region selectRegionById(Long id)把条件拿到手并封装给区域的Region对象 返回的Region对象最终映射给NodeVo.java的 private Region region;
怎么执行的映射呢？需要指定java属性名和执行的类型：
property=&quot;region&quot; 
javaType=&quot;Region&quot;
至此完成了mybatis的嵌套查询
--&gt;
        &lt;association property=&quot;region&quot; javaType=&quot;Region&quot; column=&quot;region_id&quot; select=&quot;com.dkd.manage.mapper.RegionMapper.selectRegionById&quot;/&gt;
        &lt;association property=&quot;partner&quot; javaType=&quot;Partner&quot; column=&quot;partner_id&quot; select=&quot;com.dkd.manage.mapper.PartnerMapper.selectPartnerById&quot;/&gt;
    &lt;/resultMap&gt;
</code></pre>
<pre><code class="java">&lt;resultMap&gt;......&lt;/resultMap&gt;   // 完成手动映射 为了实现多表映射情况组合查询

// 解决一对一 或 多对一 映射结果集只有一个对象时完成的ORM的映射封装
&lt;association&gt;......&lt;/association&gt;  #点位和点位1对1  点位和合作商1对多

// 解决一对多场景下来映射多个结果的集合 单个区域表+区域点位列表 映射的是集合！！
&lt;collection&gt;......&lt;/collection&gt; 


/*
// &lt;association&gt; 标签允许你在查询结果中嵌套另一个对象。
 这样可以方便地在 NodeVo 对象中直接访问 Region 和 Partner 的属性，而不需要额外的查询
 
property：指定 NodeVo 类中的属性名称，该属性将引用关联的对象。
javaType：指定关联对象的 Java 类型。
column：指定用于关联查询的列名，通常是外键。
select：指定一个子查询的方法，用于根据外键查询关联对象
*/
</code></pre>
<h4 id="NodeService"><a href="#NodeService" class="headerlink" title="NodeService"></a>NodeService</h4><pre><code class="java">/**
 * 查询点位管理列表
 * @param node
 * @return NodeVo集合
 */
public List&lt;NodeVo&gt; selectNodeVoList(Node node);
</code></pre>
<h4 id="NodeServiceImpl"><a href="#NodeServiceImpl" class="headerlink" title="NodeServiceImpl"></a>NodeServiceImpl</h4><pre><code class="java">/**
 * 查询点位管理列表
 *
 * @param node
 * @return NodeVo集合
 */
@Override
public List&lt;NodeVo&gt; selectNodeVoList(Node node) &#123;
    return nodeMapper.selectNodeVoList(node);
&#125;
</code></pre>
<h4 id="NodeController"><a href="#NodeController" class="headerlink" title="NodeController"></a>NodeController</h4><pre><code class="java">/**
 * 查询点位管理列表
 */
@PreAuthorize(&quot;@ss.hasPermi(&#39;manage:node:list&#39;)&quot;)
@GetMapping(&quot;/list&quot;)
public TableDataInfo list(Node node)
&#123;
    startPage();
    List&lt;NodeVo&gt; voList = nodeService.selectNodeVoList(node);
    return getDataTable(voList);
&#125;
</code></pre>
<pre><code class="java">com/dkd/manage/mapper/NodeMapper.java
/**
     *  查询点位管理列表
     * @param node
     * @return
     */
    public List&lt;NodeVo&gt; selectNodeVoList(Node node);
</code></pre>
<h4 id="node-x2F-index-vue"><a href="#node-x2F-index-vue" class="headerlink" title="node&#x2F;index.vue"></a>node&#x2F;index.vue</h4><pre><code class="vue">&lt;!-- 点位列表 --&gt;
&lt;el-table v-loading=&quot;loading&quot; :data=&quot;nodeList&quot; @selection-change=&quot;handleSelectionChange&quot;&gt;
  &lt;el-table-column type=&quot;selection&quot; width=&quot;55&quot; align=&quot;center&quot; /&gt;
  &lt;el-table-column label=&quot;序号&quot; type=&quot;index&quot; width=&quot;50&quot; align=&quot;center&quot; prop=&quot;id&quot; /&gt;
  &lt;el-table-column label=&quot;点位名称&quot; align=&quot;center&quot; prop=&quot;nodeName&quot; /&gt;
  &lt;el-table-column label=&quot;所在区域&quot; align=&quot;center&quot; prop=&quot;region.regionName&quot; /&gt;
  &lt;el-table-column label=&quot;商圈类型&quot; align=&quot;center&quot; prop=&quot;businessType&quot;&gt;
    &lt;template #default=&quot;scope&quot;&gt;
      &lt;dict-tag :options=&quot;business_type&quot; :value=&quot;scope.row.businessType&quot; /&gt;
    &lt;/template&gt;
  &lt;/el-table-column&gt;
  &lt;el-table-column label=&quot;合作商&quot; align=&quot;center&quot; prop=&quot;partner.partnerName&quot; /&gt;
  &lt;el-table-column label=&quot;详细地址&quot; align=&quot;center&quot; prop=&quot;address&quot; show-overflow-tooltip=&quot;true&quot;/&gt;
  &lt;el-table-column label=&quot;操作&quot; align=&quot;center&quot; class-name=&quot;small-padding fixed-width&quot;&gt;
    &lt;template #default=&quot;scope&quot;&gt;
      &lt;el-button link type=&quot;primary&quot; icon=&quot;Edit&quot; @click=&quot;handleUpdate(scope.row)&quot; v-hasPermi=&quot;[&#39;manage:node:edit&#39;]&quot;&gt;修改&lt;/el-button&gt;
      &lt;el-button link type=&quot;primary&quot; icon=&quot;Delete&quot; @click=&quot;handleDelete(scope.row)&quot; v-hasPermi=&quot;[&#39;manage:node:remove&#39;]&quot;&gt;删除&lt;/el-button&gt;
    &lt;/template&gt;
  &lt;/el-table-column&gt;
&lt;/el-table&gt;
</code></pre>
<h3 id="区域管理改造-地区详情新增查看详情"><a href="#区域管理改造-地区详情新增查看详情" class="headerlink" title="区域管理改造-地区详情新增查看详情"></a>区域管理改造-地区详情<del>新增查看详情</del></h3><pre><code class="html">src\views\manage\region\index.vue
&lt;el-table-column label=&quot;操作&quot; align=&quot;center&quot; class-name=&quot;small-padding fixed-width&quot;&gt;
        &lt;template #default=&quot;scope&quot;&gt;
          &lt;el-button link type=&quot;primary&quot;  @click=&quot;getRegionInfo(scope.row)&quot; v-hasPermi=&quot;[&#39;manage:region:list&#39;]&quot;&gt;查看详情&lt;/el-button&gt;
          &lt;el-button link type=&quot;primary&quot;  @click=&quot;handleUpdate(scope.row)&quot; v-hasPermi=&quot;[&#39;manage:region:edit&#39;]&quot;&gt;修改&lt;/el-button&gt;
          &lt;el-button link type=&quot;primary&quot;  @click=&quot;handleDelete(scope.row)&quot; v-hasPermi=&quot;[&#39;manage:region:remove&#39;]&quot;&gt;删除&lt;/el-button&gt;
        &lt;/template&gt;
      &lt;/el-table-column&gt;

&lt;!-- 
template 插槽：
#default=&quot;scope&quot;：定义默认插槽，scope 是当前行的数据对象。

@click=&quot;getRegionInfo(scope.row)&quot;：点击按钮时调用 getRegionInfo 函数，并传入当前行的数据。
--&gt;

...
...

/* 查看详情操作按钮 */
function getRegionInfo(row) &#123;
  // 查询区域信息
  reset();
  const _id = row.id
  getRegion(_id).then(response =&gt; &#123;
    form.value = response.data
  &#125;);
&#125;

&lt;!-- 
nodeList 变量：

const nodeList = ref([])：定义一个响应式数组 nodeList，用于存储点位列表。
getRegionInfo 函数：

reset()：调用 reset 函数，可能用于重置表单或其他状态。
const _id = row.id：获取当前行的 id。
getRegion(_id).then(response =&gt; &#123; form.value = response.data &#125;)：调用 getRegion 函数查询区域信息，并将返回的数据赋值给 form.value。
loadAllParams.regionId = row.id：设置 loadAllParams 对象的 regionId 属性为当前行的 id。
listNode(loadAllParams).then(response =&gt; &#123; nodeList.value = response.rows &#125;)：调用 listNode 函数查询点位列表，并将返回的行数据赋值给 nodeList.value。
--&gt;
</code></pre>
<h5 id="区域管理里引入点位的api文件"><a href="#区域管理里引入点位的api文件" class="headerlink" title="区域管理里引入点位的api文件"></a>区域管理里引入点位的api文件</h5><pre><code class="js">import &#123; listNode &#125; from &quot;@/api/manage/node&quot;;
import &#123; loadAllParams &#125; from &quot;@/api/page&quot;;
...
/* 查看详情操作按钮 */
const nodeList = ref([]);
function getRegionInfo(row) &#123;
  // 查询区域信息
  reset();
  const _id = row.id
  getRegion(_id).then(response =&gt; &#123;
    form.value = response.data
  &#125;);
  // 查看点位列表
  loadAllParams.regionId=row_id
  listNode(loadAllParams).then(response =&gt; &#123;
    nodeList.value = response.rows;
  &#125;);
&#125;
</code></pre>
<h6 id="添加区域管理对话框"><a href="#添加区域管理对话框" class="headerlink" title="添加区域管理对话框"></a>添加区域管理对话框</h6><pre><code class="html"> &lt;!-- 添加或修改区域管理对话框 --&gt;
    &lt;el-dialog :title=&quot;title&quot; v-model=&quot;open&quot; width=&quot;500px&quot; append-to-body&gt;
      &lt;el-form ref=&quot;regionRef&quot; :model=&quot;form&quot; :rules=&quot;rules&quot; label-width=&quot;80px&quot;&gt;
        &lt;el-form-item label=&quot;区域名称&quot; prop=&quot;regionName&quot;&gt;
          &lt;el-input v-model=&quot;form.regionName&quot; placeholder=&quot;请输入区域名称&quot; /&gt;
        &lt;/el-form-item&gt;
        &lt;el-form-item label=&quot;备注说明&quot; prop=&quot;remark&quot;&gt;
          &lt;el-input v-model=&quot;form.remark&quot; type=&quot;textarea&quot; placeholder=&quot;请输入内容&quot; /&gt;
        &lt;/el-form-item&gt;
      &lt;/el-form&gt;
      &lt;template #footer&gt;
        &lt;div class=&quot;dialog-footer&quot;&gt;
          &lt;el-button type=&quot;primary&quot; @click=&quot;submitForm&quot;&gt;确 定&lt;/el-button&gt;
          &lt;el-button @click=&quot;cancel&quot;&gt;取 消&lt;/el-button&gt;
        &lt;/div&gt;
      &lt;/template&gt;
    &lt;/el-dialog&gt;
   &lt;!-- 查看详情对话框 --&gt;
&lt;el-dialog title=&quot;区域详情&quot; v-model=&quot;regionInfoOpen&quot; width=&quot;500px&quot; append-to-body&gt;
    &lt;el-form-item label=&quot;区域名称&quot; prop=&quot;regionName&quot;&gt;
        &lt;el-input v-model=&quot;form.regionName&quot; disabled /&gt;
    &lt;/el-form-item&gt;
    &lt;label&gt;包含点位：&lt;/label&gt;
    &lt;el-table :data=&quot;nodeList&quot;&gt;
        &lt;el-table-column label=&quot;序号&quot; type=&quot;index&quot; width=&quot;50&quot; align=&quot;center&quot; /&gt;
        &lt;el-table-column label=&quot;点位名称&quot; align=&quot;center&quot; prop=&quot;nodeName&quot; /&gt;
        &lt;el-table-column label=&quot;设备数量&quot; align=&quot;center&quot; prop=&quot;vmCount&quot; /&gt;
    &lt;/el-table&gt;
&lt;/el-dialog&gt;
</code></pre>
<pre><code class="js">/* 查看详情操作按钮 */
const nodeList = ref([]);
const regionInfoOpen=ref(false);
function getRegionInfo(row) &#123;
  // 查询区域信息
  reset();
  const _id = row.id
  getRegion(_id).then(response =&gt; &#123;
    form.value = response.data
  &#125;);
  // 查看点位列表
  loadAllParams.regionId=row_id
  listNode(loadAllParams).then(response =&gt; &#123;
    nodeList.value = response.rows;
  &#125;);
  regionInfoOpen.value=true;
&#125;
</code></pre>
<h5 id="数据完整性"><a href="#数据完整性" class="headerlink" title="数据完整性"></a>数据完整性</h5><ul>
<li>在删除区域或合作商数据时，关联的点位数据该如何处理？</li>
</ul>
<p><img src="https://raw.githubusercontent.com/P-luminary/images/05e49c8d5a61f85f41c20ded647d7f32c03ae296/%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7_%E5%AD%97%E6%AE%B5%E4%BE%9D%E8%B5%96.png"></p>
<blockquote>
<p>tb_region(区域表)                     tb_node(点位表)                       tb_partner(合作商表)<br>id           ←region_id:id ←        region_id                                                  id<br>                                                    partner_id             partner_id:id →→→↑     </p>
</blockquote>
<p>找到设置外键约束<del>(取消约束)</del><code>dkd → tb_node → Modify Table(old)</code> 找到<code>Foreign Keys</code>  双击打开后将<u>Update rule</u>和<u>Delete rule</u>修改为：<strong>no action</strong></p>
<blockquote>
<p>**CASCADE（级联操作）:**当父表中的某行记录被删除或更新时，与其关联的所有子表中的匹配行也会自动被删除或更新。这种方式适用于希望保持数据一致性的场景，即父记录不存在时，相关的子记录也应该被移除。</p>
<p>**SET NULL（设为空）:**若父表中的记录被删除或更新，子表中对应的外键字段会被设置为NULL。选择此选项的前提是子表的外键列允许为NULL值。这适用于那些子记录不再需要明确关联到任何父记录的情况。</p>
<p>**RESTRICT（限制）:**在尝试删除或更新父表中的记录之前，数据库首先检查是否有相关联的子记录存在。如果有，则拒绝执行删除或更新操作，以防止意外丢失数据或破坏数据关系的完整性。这是一种保守策略，确保数据间的引用完整性。</p>
<p>**NO ACTION（无操作）:**在标准SQL中，NO ACTION是一个关键字，它要求数据库在父表记录被删除或更新前，检查是否会影响子表中的相关记录。在MySQL中，NO ACTION的行为与RESTRICT相同，即如果子表中有匹配的行，则禁止执行父表的删除或更新操作。这意味着如果存在依赖关系，操作将被阻止，从而保护数据的参照完整性。</p>
</blockquote>
<p>修改完毕后，如果你尝试进行删除操作，会发现数据库的完整性约束生效了，它会阻止删除操作并给出错误提示。但是，这个错误提示信息可能对于用户来说不够友好，可能会让用户感到困惑。</p>
<p><code>SQLIntegrityConstraintViolationException</code>是Java中的一个异常类，这个类通常用于表示SQL数据库操作中的完整性约束违反异常</p>
<p>例如：外键约束、唯一约束等。当数据库操作违反了这些约束时，就会抛出这个异常。</p>
<p>这个错误是由于外键约束导致的。它表明在删除或更新父表的行时，存在外键约束，子表中的相关行会受到影响。</p>
<p>是因为在删除tb_region表中的行时，tb_node表中的region_id外键约束会阻止操作。</p>
<p>如果你在使用Spring框架进行数据库操作，可能会先遇到DataIntegrityViolationException，它是对SQLIntegrityConstraintViolationException的一个更高层次的抽象，旨在提供一种更加面向应用的错误表示。</p>
<p>而SQLIntegrityConstraintViolationException是更底层的异常，直接来源于数据库驱动，包含更多底层数据库相关的细节。</p>
<p>在实际开发中，推荐捕获并处理DataIntegrityViolationException，因为它更符合Spring应用的异常处理模式，同时也可以通过其内部的cause（原因）属性来获取具体的SQLIntegrityConstraintViolationException，进而获取详细的错误信息。</p>
<p>为了提升用户体验，我们可以使用Spring Boot框架的全局异常处理器来捕获这些错误信息，并返回更友好的提示信息给用户。这样，当用户遇到这种情况时，他们将收到一个清晰、易懂的提示，告知他们操作无法完成的原因。</p>
<pre><code class="java">com/dkd/framework/web/exception/GlobalExceptionHandler.java
/**
     * 数据完整性异常
     */
    @ExceptionHandler(DataIntegrityViolationException.class)
    public AjaxResult handleDataIntegrityViolationException(DataIntegrityViolationException e) &#123;
        log.error(e.getMessage(), e);
        if (e.getMessage().contains(&quot;foreign&quot;)) &#123;
            return AjaxResult.error(&quot;无法删除该数据，有其他数据引用&quot;);
        &#125;
        return AjaxResult.error(&quot;数据完整性异常，请联系管理员&quot;);
    &#125;
</code></pre>
<p>16</p>

    </div>

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <div id="comment">
        <div id="gitalk-container">
        </div>
    </div>
    
</div>
                     
<footer id="footer">
    <div class="footer-wrap">
        <div>
            © 2018 - 2025 P-luminary
            <span class="footer-icon">
                <a-icon type="flag" theme="filled" /></span>
            @Asuna
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a>
<!--         & <a target="_blank" rel="noopener" href="https://github.com/korilin/hexo-theme-particle">Particle Theme</a></div> -->
        
    </div>

</footer>

<script src="/js/highlight.min.js"></script>
<script src="/js/particle.js"></script>
                </div>
            </div>
        </transition>
    </div>

    <script>
    new Vue({
        el: "#layout",
        data: {
            show_page: false,
            onload_menu: false,
            menu_show: false,
            card_top: 100
        },
        created: function () {
            var that = this
            window.onload = function () {
                that.show_page = true
                document.getElementById("loadcontent").style.opacity = 0
                setTimeout(function () {
                    document.getElementById("loadleft").style.width = 0
                    document.getElementById("loadright").style.width = 0
                }, 300)
                setTimeout(function () {
                    document.getElementById("loading").style = "display:none"
                }, 600)
            }
        },
        mounted: function () {
            var that = this
            window.addEventListener('scroll', function (e) {
                that.menu_show = false
            })
        },
        methods: {
            home_click: function () {
                window.scrollTo({
                    top: window.innerHeight - 80,
                    behavior: "smooth",
                });
            }
        }
    })
</script>

<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
    const gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'hexo-theme-particle',      // The repository of store comments,
        owner: 'P-luminary',
        admin: ['P-luminary'],
        language: 'en',
        id: location.pathname,      // Ensure uniqueness and length less than 50
        distractionFreeMode: true  // Facebook-like distraction free mode
    })
    gitalk.render('gitalk-container')
</script>

</body>

</html>